(self.webpackChunkvk=self.webpackChunkvk||[]).push([[44216],{477246:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon12LiveBadge","live_badge_12","0 0 24 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 12" id="live_badge_12"><path fill="#FF3347" d="M0 4.8c0-1.68 0-2.52.327-3.162A3 3 0 0 1 1.638.327C2.28 0 3.12 0 4.8 0h14.4c1.68 0 2.52 0 3.162.327a3 3 0 0 1 1.311 1.311C24 2.28 24 3.12 24 4.8v2.4c0 1.68 0 2.52-.327 3.162a3 3 0 0 1-1.311 1.311C21.72 12 20.88 12 19.2 12H4.8c-1.68 0-2.52 0-3.162-.327a3 3 0 0 1-1.311-1.311C0 9.72 0 8.88 0 7.2V4.8Z" /><path fill="#fff" d="M3.625 8.923h2.743c.344 0 .567-.19.567-.506s-.227-.506-.567-.506H4.25V3.64c0-.405-.232-.64-.625-.64S3 3.235 3 3.64v4.643c0 .405.232.64.625.64ZM8.684 9c.393 0 .625-.235.625-.636V3.64c0-.405-.232-.64-.625-.64s-.625.235-.625.64v4.724c0 .401.232.636.625.636Zm4.451 0c.484 0 .774-.21.956-.704l1.672-4.405a.92.92 0 0 0 .062-.328c0-.332-.26-.563-.641-.563-.327 0-.514.142-.617.47l-1.395 4.194h-.029l-1.398-4.182C11.64 3.15 11.443 3 11.107 3c-.393 0-.658.235-.658.579 0 .117.021.23.063.344l1.663 4.368c.182.498.472.709.96.709Zm4.459-.077h2.84c.342 0 .566-.19.566-.506s-.228-.506-.567-.506H18.22V6.437h2.107c.314 0 .52-.178.52-.47 0-.29-.21-.469-.52-.469H18.22V4.093h2.214c.34 0 .567-.19.567-.506s-.224-.506-.567-.506h-2.839c-.393 0-.625.235-.625.636v4.566c0 .405.232.64.625.64Z" /></symbol>',24,12,!1,void 0)},873960:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon16LogoLinux","logo_linux_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_linux_16"><path fill="currentColor" d="M12.744 12.112c-.336-.26-.205-.835-.554-1.118.338-1.963-.61-3.693-1.739-4.802-.948-.93-.642-1.836-.642-2.62C9.809 2.322 9.27 1 7.639 1 5.896 1 5.418 2.388 5.401 3.18c-.042 1.903.403 2.398-.764 3.783-1.373 1.63-1.575 3.254-1.265 4.116-.145.161-.34.34-.706.487-1.01.42-.27 1.123-.549 1.622A.884.884 0 0 0 2 13.62c0 .437.364.816 1.026.76.893-.077 1.717.527 2.25.527.47 0 .856-.255 1.036-.607.842-.198 1.88-.173 2.721.034.151.403.56.666 1.016.666.997 0 1.189-1.079 2.332-1.444a.9.9 0 0 0 .619-.868c0-.227-.085-.444-.256-.576Zm-5.59-6.105c-.195 0-.356-.15-.611-.331-.323-.229-.65-.36-.647-.6 0-.166.231-.217.53-.398.322-.194.448-.391.764-.391.324 0 .422.156.862.337.432.18.734.25.734.451 0 .207-.453.355-.708.507-.375.22-.567.425-.924.425Zm1.018-3.042c.539.083.6.987.341 1.432l-.217-.085c.113-.317.11-.838-.266-.871-.239-.021-.393.28-.426.537a1.07 1.07 0 0 0-.32-.074c.039-.538.403-1.013.888-.939Zm-2.08.193c.413-.098.657.36.659.837l-.19.111c-.025-.2-.119-.523-.353-.454-.252.075-.21.632-.07.746l-.188.1c-.256-.413-.256-1.245.142-1.34ZM4.8 14.383c-1.2-.52-1.608-.402-1.837-.402-.475 0-.63-.338-.452-.657.152-.272.105-.556.068-.784-.058-.35-.068-.463.292-.614.498-.201.72-.461.884-.655.463-.547.93.313 1.314 1.079.249.496.738.748.89 1.298.138.508-.435 1.05-1.16.735Zm4.27-1.093c-.846.393-1.924.573-2.73.175-.12-.329-.31-.541-.515-.755.33-.082.574-.474.281-.868-.312-.42-.95-.714-1.595-1.19-.603-.445-.794-1.542.028-2.769-.4 1.087-.167 2.088.034 2.374.042-.576.09-1.539.915-2.692.416-.582.422-1.351.431-1.832l.379.248c.279.196.512.413.847.413.495 0 .769-.272 1.15-.498.15-.088.375-.176.564-.3.318 1.445 1.634 3.182 1.708 4.171.306-.601-.087-2.05-.087-2.05.515.75.556 1.375.578 2.142.36.14.747.506.782.989l-.15-.016c-.077-.537-1.593-1.324-1.73-.315-.726.106-.462 1.205-.608 1.918-.068.326-.192.584-.283.855Zm2.96-.024c-.601.222-1.008.693-1.287.985-.538.564-1.249.293-1.325-.234-.08-.563.22-.87.35-1.501.118-.576-.014-1.462.263-1.557.18 1.023 1.263.593 1.51.314.401 0 .435.13.525.488.056.225.133.414.353.636.255.26.177.661-.388.87ZM7.143 5.68c-.398 0-.696-.253-.938-.45-.124-.099.031-.283.155-.183.237.192.475.394.783.394.37 0 .698-.303 1.14-.47.152-.056.238.167.088.223-.43.162-.775.486-1.228.486Z" /></symbol>',16,16,!1,void 0)},771455:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon16LogoWindows","logo_windows_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="logo_windows_16"><path fill="currentColor" d="M2 8V3.677l5-.678V8H2Zm5.5 0H14V2l-6.5.903V8Zm-.5.5H2v3.823L7 13V8.5Zm.5 0v4.597L14 14V8.5H7.5Z" /></symbol>',16,16,!1,void 0)},138906:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon20LiveBadge","live_badge_20","0 0 42 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 42 20" id="live_badge_20"><path fill="#FF3347" d="M0 8c0-2.8 0-4.2.545-5.27A5 5 0 0 1 2.73.545C3.8 0 5.2 0 8 0h26c2.8 0 4.2 0 5.27.545a5 5 0 0 1 2.185 2.185C42 3.8 42 5.2 42 8v4c0 2.8 0 4.2-.545 5.27a5 5 0 0 1-2.185 2.185C38.2 20 36.8 20 34 20H8c-2.8 0-4.2 0-5.27-.545A5 5 0 0 1 .545 17.27C0 16.2 0 14.8 0 12V8Z" /><path fill="#F2F3F5" d="M8 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2H9V6a1 1 0 0 0-1-1Zm7 1a1 1 0 1 1 2 0v8a1 1 0 1 1-2 0V6Zm15-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2h-3v-2h3a1 1 0 1 0 0-2h-3V7h3a1 1 0 1 0 0-2h-4Zm-8.325 9.31-2.55-7.824a.993.993 0 0 1-.117-.363L19 6.1h.005a1 1 0 1 1 1.99-.199L21 5.9l2 6.4 2-6.4h.005a1 1 0 0 1 1.99.2H27l-.008.023a.993.993 0 0 1-.118.363l-2.55 7.824a1 1 0 0 1-.95.69h-.748a1 1 0 0 1-.95-.69Z" /></symbol>',42,20,!1,void 0)},480365:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("IconLiveText20h","live_text_20h","0 0 42 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 42 20" id="live_text_20h"><path d="M8 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2H9V6a1 1 0 0 0-1-1Zm7 1a1 1 0 1 1 2 0v8a1 1 0 1 1-2 0V6Zm15-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4a1 1 0 1 0 0-2h-3v-2h3a1 1 0 1 0 0-2h-3V7h3a1 1 0 1 0 0-2h-4Zm-8.325 9.31-2.55-7.824a.993.993 0 0 1-.117-.363L19 6.1h.005a1 1 0 1 1 1.99-.199L21 5.9l2 6.4 2-6.4h.005a1 1 0 0 1 1.99.2H27l-.008.023a.993.993 0 0 1-.118.363l-2.55 7.824a1 1 0 0 1-.95.69h-.748a1 1 0 0 1-.95-.69Z" /></symbol>',42,20,!1,void 0)},685311:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon20LogoVkCallsColor","logo_vk_calls_color_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="logo_vk_calls_color_20"><path fill="#07F" d="M13.067 0C18.667 0 20 1.333 20 6.933v6.134c0 5.6-1.333 6.933-6.933 6.933H6.933C1.333 20 0 18.667 0 13.067V6.933C0 1.333 1.333 0 6.933 0h6.134Z" /><path fill="#77BEFF" fill-rule="evenodd" d="M19.92 15.097a11.633 11.633 0 0 1-4.087.736c-2.21 0-4.278-.615-6.04-1.683a.533.533 0 0 0-.495-.029c-1.113.503-2.366.766-3.77.879-.384.03-.641-.375-.477-.722.554-1.173.915-2.233 1.133-3.289a.5.5 0 0 0-.077-.377 11.612 11.612 0 0 1-1.94-6.445c0-1.438.26-2.816.736-4.088A22.61 22.61 0 0 1 6.933 0h6.134C18.667 0 20 1.333 20 6.933v6.134c0 .75-.024 1.425-.08 2.03Z" clip-rule="evenodd" /><path fill="#fff" d="M19.582 16.965c.165-.535.274-1.156.34-1.876a.24.24 0 0 0-.001.008 11.64 11.64 0 0 1-4.088.736c-2.21 0-4.278-.615-6.04-1.683a.533.533 0 0 0-.495-.029c-.818.37-1.713.61-2.687.756l-.008.001a14.497 14.497 0 0 1-1.076.121c-.383.031-.64-.374-.476-.72a18.135 18.135 0 0 0 .414-.945v-.002c.328-.81.56-1.578.718-2.343a.5.5 0 0 0-.076-.377 11.612 11.612 0 0 1-1.94-6.445c0-1.439.26-2.816.736-4.088-.717.065-1.336.174-1.868.338a13.337 13.337 0 0 0-.535 3.75c0 2.54.712 4.918 1.947 6.94a13.288 13.288 0 0 1-.903 2.459c-.66 1.396.338 3.238 2.117 3.095 1.32-.106 2.588-.34 3.776-.793a13.28 13.28 0 0 0 6.396 1.632c1.3 0 2.559-.186 3.75-.535ZM8.784 3.34c.546-.065.999.384 1.26.907l.294.587a1.436 1.436 0 0 1-.555 1.88.212.212 0 0 0-.07.3 11.84 11.84 0 0 0 3.273 3.272.212.212 0 0 0 .3-.069 1.436 1.436 0 0 1 1.88-.555l.587.294c.523.261.972.715.907 1.26a1.276 1.276 0 0 1-.377.774c-.562.563-1.551.653-2.705.303-1.149-.349-2.443-1.13-3.592-2.28-1.148-1.148-1.93-2.442-2.28-3.592-.35-1.153-.26-2.142.304-2.704.222-.223.482-.343.774-.378Z" /></symbol>',20,20,!1,void 0)},203287:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon24LogoVkCallsColor","logo_vk_calls_color_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="logo_vk_calls_color_24"><path fill="#07F" d="M15.68 0C22.4 0 24 1.6 24 8.32v7.36C24 22.4 22.4 24 15.68 24H8.32C1.6 24 0 22.4 0 15.68V8.32C0 1.6 1.6 0 8.32 0h7.36Z" /><path fill="#77BEFF" fill-rule="evenodd" d="M23.905 18.117A13.97 13.97 0 0 1 19 19c-2.653 0-5.134-.738-7.248-2.02a.64.64 0 0 0-.595-.034c-1.335.603-2.839.918-4.524 1.053-.46.037-.769-.449-.572-.865.665-1.408 1.098-2.68 1.36-3.947a.601.601 0 0 0-.093-.453A13.935 13.935 0 0 1 5 5c0-1.726.312-3.379.883-4.905A27.132 27.132 0 0 1 8.32 0h7.36C22.4 0 24 1.6 24 8.32v7.36a27.2 27.2 0 0 1-.095 2.437Z" clip-rule="evenodd" /><path fill="#fff" d="M23.499 20.358c.198-.641.329-1.387.407-2.251v.01A13.97 13.97 0 0 1 19 19c-2.653 0-5.134-.738-7.248-2.02a.64.64 0 0 0-.595-.034c-.982.443-2.055.731-3.224.906l-.01.002-.261.037c-.335.044-.678.08-1.03.108-.459.037-.768-.449-.571-.865A21.702 21.702 0 0 0 6.558 16h.001a16.13 16.13 0 0 0 .861-2.812.601.601 0 0 0-.092-.453A13.934 13.934 0 0 1 5 5c0-1.726.312-3.379.883-4.905-.86.078-1.602.209-2.241.406A16.005 16.005 0 0 0 3 5c0 3.048.854 5.902 2.337 8.33-.232.92-.578 1.877-1.084 2.95-.792 1.675.405 3.884 2.54 3.713 1.584-.127 3.106-.407 4.531-.951A15.937 15.937 0 0 0 19 21c1.56 0 3.07-.224 4.499-.642ZM10.54 4.007c.655-.077 1.2.461 1.513 1.09l.352.704c.405.81.115 1.795-.666 2.255a.254.254 0 0 0-.083.36 14.206 14.206 0 0 0 1.771 2.157 14.208 14.208 0 0 0 2.157 1.77.254.254 0 0 0 .36-.082 1.724 1.724 0 0 1 2.255-.666l.704.352c.629.314 1.167.858 1.09 1.512a1.532 1.532 0 0 1-.453.93c-.675.675-1.862.783-3.246.363-1.38-.419-2.932-1.357-4.31-2.736-1.379-1.378-2.317-2.93-2.736-4.31-.42-1.384-.312-2.57.364-3.246.266-.267.578-.411.929-.453Z" /></symbol>',24,24,!1,void 0)},92086:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon24LogoVkVideo","logo_vk_video_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="logo_vk_video_24"><path fill="currentColor" fill-rule="evenodd" d="M16.93 20.97c.885-.058 1.442-.208 2.007-.51a3.681 3.681 0 0 0 1.526-1.526c.412-.77.54-1.526.54-3.115V8.181c0-1.59-.128-2.346-.54-3.115a3.681 3.681 0 0 0-1.526-1.527c-.565-.301-1.123-.45-2.007-.509a7 7 0 0 1 1.537 2.291c.287.694.413 1.44.474 2.328.059.87.059 1.948.059 3.314v2.074c0 1.367 0 2.443-.06 3.314-.06.888-.186 1.634-.473 2.328a6.998 6.998 0 0 1-1.537 2.29zm-8.99.029c-1.426-.013-2.144-.149-2.874-.539a3.681 3.681 0 0 1-1.526-1.526c-.412-.77-.54-1.526-.54-3.115V8.181c0-1.59.128-2.346.54-3.115.35-.656.87-1.176 1.526-1.527.724-.386 1.436-.523 2.84-.538L9 3c1.411 0 2.42 0 3.215.055.786.053 1.29.156 1.698.326a5 5 0 0 1 2.706 2.706c.17.409.273.912.326 1.698C17 8.58 17 9.588 17 11v2c0 1.412 0 2.42-.055 3.215-.053.786-.156 1.29-.326 1.698a5 5 0 0 1-2.706 2.706c-.409.17-.912.273-1.698.326-.702.048-1.57.054-2.737.055h-.956l-.582-.001zm.33-11.436a.18.18 0 0 0-.247.137 11.663 11.663 0 0 0-.223 2.278c0 .796.08 1.573.232 2.322a.18.18 0 0 0 .247.137 11.64 11.64 0 0 0 3.855-2.296.181.181 0 0 0 0-.279A11.64 11.64 0 0 0 8.27 9.563zm.602-1.696A1.98 1.98 0 0 0 6.258 9.35c-.17.85-.258 1.73-.258 2.629 0 .917.092 1.814.268 2.68a1.98 1.98 0 0 0 2.615 1.474 13.44 13.44 0 0 0 4.453-2.65 1.981 1.981 0 0 0 0-2.96 13.44 13.44 0 0 0-4.464-2.655z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},189554:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon24UsersSubtract","users_subtract_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="users_subtract_24"><path d="M16.5 12.75c2.294 0 6.5.857 6.5 4.285 0 1.5-.382 1.715-1.147 1.715h-6.09c.158-.489.237-1.062.237-1.715 0-1.723-.631-3.066-1.672-4.062.783-.16 1.548-.223 2.172-.223Zm-9 0c2.294 0 6.5.857 6.5 4.285 0 1.5-.382 1.715-1.147 1.715H2.147C1.382 18.75 1 18.535 1 17.035c0-3.428 4.206-4.285 6.5-4.285Zm0-7.5a3 3 0 1 1 0 6 3 3 0 1 1 0-6Z" /></symbol>',24,24,!1,void 0)},812095:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon28VmojiOutline","vmoji_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="vmoji_outline_28"><g fill="currentColor"><path d="M12 3a1 1 0 0 1-1 1 7 7 0 0 0-7 7 1 1 0 1 1-2 0 9 9 0 0 1 9-9 1 1 0 0 1 1 1zM12 25a1 1 0 0 0-1-1 7 7 0 0 1-7-7 1 1 0 1 0-2 0 9 9 0 0 0 9 9 1 1 0 0 0 1-1zM9.75 11a1.75 1.75 0 1 1 0 3.5 1.75 1.75 0 0 1 0-3.5zm7.145.878c1.033-.556 2.224-.556 3.274.385.41.368.444.998.074 1.407s-1.001.442-1.412.074l-.1-.082c-.298-.22-.565-.203-.885-.03-.097.051-.162.1-.177.112l-.099.078a1.003 1.003 0 0 1-1.313-.152.994.994 0 0 1 .074-1.407c.124-.111.314-.25.564-.385zM16 16.5c.552 0 1 .45.921.996-.037.26-.087.501-.15.652a3 3 0 0 1-5.543 0 3.007 3.007 0 0 1-.15-.652c-.077-.546.37-.996.922-.996zM16 3a1 1 0 0 0 1 1 7 7 0 0 1 7 7 1 1 0 1 0 2 0 9 9 0 0 0-9-9 1 1 0 0 0-1 1zM16 25a1 1 0 0 1 1-1 7 7 0 0 0 7-7 1 1 0 1 1 2 0 9 9 0 0 1-9 9 1 1 0 0 1-1-1z" /></g></symbol>',28,28,!1,void 0)},265212:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon40AppStoreButtonEn","app_store_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="app_store_button_en_40"><path d="M40.228 17.793h2.295l4.745 12.313h-2.313l-1.155-3.26h-4.918l-1.156 3.26H35.5l4.728-12.313Zm-.76 7.415h3.762l-1.846-5.294h-.052l-1.863 5.294Zm8.922-4.018h1.863v1.207h.034c.276-.517.662-.885 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.311.127 1.829.38.529.241.966.58 1.311 1.017.345.426.604.926.777 1.5a6.39 6.39 0 0 1 .258 1.846c0 .598-.08 1.178-.241 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.425-.707.77-1.19 1.035-.483.253-1.053.38-1.708.38a4.39 4.39 0 0 1-.863-.087 3.431 3.431 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.432 2.66 2.66 0 0 1-.552-.638h-.035v4.45H48.39V21.19Zm6.866 4.466a4.41 4.41 0 0 0-.155-1.172 3.08 3.08 0 0 0-.466-1 2.284 2.284 0 0 0-.776-.708 2.06 2.06 0 0 0-1.07-.275c-.828 0-1.455.287-1.88.862-.415.575-.622 1.34-.622 2.294 0 .448.052.867.155 1.258.115.38.282.707.5.983.22.276.478.495.777.656.31.16.667.241 1.07.241.449 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707a2.79 2.79 0 0 0 .431-1 4.88 4.88 0 0 0 .138-1.155Zm3.854-4.466h1.863v1.207h.035c.276-.517.661-.885 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.31.127 1.829.38.529.241.966.58 1.31 1.017.346.426.605.926.777 1.5a6.39 6.39 0 0 1 .26 1.846c0 .598-.081 1.178-.242 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.425-.707.77-1.19 1.035-.484.253-1.053.38-1.709.38a4.39 4.39 0 0 1-.862-.087 3.43 3.43 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.432 2.657 2.657 0 0 1-.553-.638h-.034v4.45H59.11V21.19Zm6.867 4.466c0-.402-.052-.793-.155-1.172a3.084 3.084 0 0 0-.466-1 2.284 2.284 0 0 0-.776-.708 2.06 2.06 0 0 0-1.07-.275c-.828 0-1.455.287-1.881.862-.414.575-.621 1.34-.621 2.294 0 .448.052.867.155 1.258.115.38.282.707.5.983.22.276.478.495.777.656.31.16.667.241 1.07.241.448 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707a2.79 2.79 0 0 0 .431-1c.092-.38.138-.765.138-1.155Zm10.468.345c0 .472.08.874.241 1.207.161.334.386.61.673.828.288.207.616.362.984.466.38.092.788.138 1.225.138.471 0 .874-.052 1.207-.155a2.56 2.56 0 0 0 .811-.431 1.55 1.55 0 0 0 .45-.587c.091-.23.137-.46.137-.69 0-.471-.11-.816-.328-1.034a1.72 1.72 0 0 0-.69-.483 13.31 13.31 0 0 0-1.535-.449c-.576-.149-1.289-.339-2.14-.569-.53-.138-.972-.316-1.329-.534a3.325 3.325 0 0 1-.828-.759 2.771 2.771 0 0 1-.448-.88 3.734 3.734 0 0 1-.121-.948c0-.62.126-1.155.38-1.604a3.49 3.49 0 0 1 1.035-1.138 4.382 4.382 0 0 1 1.449-.655 6.124 6.124 0 0 1 1.64-.224 6.16 6.16 0 0 1 1.81.258 4.27 4.27 0 0 1 1.502.742 3.61 3.61 0 0 1 1.035 1.241c.253.483.38 1.047.38 1.69h-2.157c-.057-.793-.328-1.35-.81-1.672-.484-.334-1.1-.5-1.847-.5-.253 0-.512.028-.777.086a2.181 2.181 0 0 0-.724.258 1.585 1.585 0 0 0-.552.483c-.138.207-.207.466-.207.776 0 .437.132.782.396 1.035.276.241.633.425 1.07.552.046.011.225.063.535.155a79.013 79.013 0 0 1 2.209.586c.38.092.65.161.81.207.403.127.754.3 1.053.518.3.218.547.471.742.759.207.275.357.574.449.896.103.322.155.644.155.966 0 .69-.144 1.282-.431 1.776-.276.483-.645.88-1.105 1.19a4.71 4.71 0 0 1-1.57.673 7.244 7.244 0 0 1-1.794.224 7.39 7.39 0 0 1-1.985-.259 4.646 4.646 0 0 1-1.621-.793 3.9 3.9 0 0 1-1.105-1.363c-.276-.563-.42-1.224-.431-1.983h2.157Zm8.773-4.811H86.7v-2.673h1.967v2.673h1.778v1.466h-1.778v4.76c0 .206.006.385.018.534.023.15.063.276.12.38a.68.68 0 0 0 .294.24c.126.047.299.07.517.07h.415c.138-.012.276-.035.414-.07v1.518c-.219.023-.432.046-.639.07-.207.022-.42.034-.638.034-.518 0-.938-.046-1.26-.138a1.862 1.862 0 0 1-.742-.431 1.658 1.658 0 0 1-.362-.725 6 6 0 0 1-.104-.982v-5.26h-1.483V21.19Zm10.905 9.157c-.714 0-1.352-.115-1.916-.345a4.28 4.28 0 0 1-1.415-.983 4.341 4.341 0 0 1-.88-1.483 5.858 5.858 0 0 1-.293-1.897c0-.678.098-1.305.293-1.88.207-.574.5-1.069.88-1.483a4.075 4.075 0 0 1 1.415-.965c.564-.242 1.202-.363 1.916-.363.713 0 1.345.121 1.898.363.563.23 1.035.552 1.415.965.39.414.684.909.879 1.483a5.51 5.51 0 0 1 .311 1.88c0 .69-.104 1.322-.311 1.897a4.057 4.057 0 0 1-2.294 2.466c-.553.23-1.185.345-1.898.345Zm0-1.552c.437 0 .816-.092 1.138-.276a2.39 2.39 0 0 0 .794-.724c.207-.3.357-.633.449-1a4.308 4.308 0 0 0 0-2.294 2.834 2.834 0 0 0-.449-1 2.4 2.4 0 0 0-.794-.725c-.322-.183-.701-.275-1.138-.275-.438 0-.817.092-1.14.275a2.4 2.4 0 0 0-.793.725 3.08 3.08 0 0 0-.466 1 4.815 4.815 0 0 0 0 2.294c.104.367.259.7.466 1a2.4 2.4 0 0 0 .794.724c.322.184.702.276 1.139.276Zm6.311-7.605h1.846v1.724h.035a2.06 2.06 0 0 1 .327-.707c.173-.23.374-.436.604-.62a3.05 3.05 0 0 1 .794-.466c.288-.115.581-.172.88-.172.23 0 .385.005.466.017l.276.034v1.897a4.936 4.936 0 0 0-.431-.051 2.514 2.514 0 0 0-.414-.035c-.334 0-.65.069-.949.207a2.057 2.057 0 0 0-.76.586 2.78 2.78 0 0 0-.517.949c-.127.38-.19.816-.19 1.31v4.243h-1.967V21.19Zm12.061 3.673a2.967 2.967 0 0 0-.208-.897 2.1 2.1 0 0 0-.448-.741 1.95 1.95 0 0 0-.69-.518 1.915 1.915 0 0 0-.898-.206c-.345 0-.661.063-.949.19a2.1 2.1 0 0 0-.724.5 2.562 2.562 0 0 0-.483.74 2.731 2.731 0 0 0-.19.932h4.59Zm-4.59 1.294c0 .345.046.678.138 1 .103.322.253.603.448.845.196.241.443.437.742.586.3.138.656.207 1.07.207.575 0 1.035-.12 1.381-.362.356-.253.621-.627.793-1.121h1.864a3.717 3.717 0 0 1-.535 1.293 3.83 3.83 0 0 1-.915.966 3.893 3.893 0 0 1-1.207.57 4.57 4.57 0 0 1-1.381.206c-.701 0-1.323-.115-1.863-.345a3.94 3.94 0 0 1-1.381-.965 4.263 4.263 0 0 1-.845-1.484 6.196 6.196 0 0 1-.276-1.896c0-.633.098-1.23.293-1.794a4.702 4.702 0 0 1 .863-1.5 4.161 4.161 0 0 1 1.363-1.035c.529-.253 1.127-.38 1.794-.38.702 0 1.329.15 1.881.449.564.287 1.03.673 1.398 1.155a4.61 4.61 0 0 1 .794 1.673c.172.62.218 1.265.138 1.932h-6.557ZM39.007 6.315a2.827 2.827 0 0 1 3.005 3.17c0 2.039-1.103 3.21-3.005 3.21H36.7v-6.38h2.307Zm-1.315 5.478h1.204a2.008 2.008 0 0 0 2.106-2.295 2.009 2.009 0 0 0-1.238-2.137 2.015 2.015 0 0 0-.868-.145h-1.204v4.577Zm5.44-1.507a2.28 2.28 0 0 1 3.196-2.304 2.283 2.283 0 0 1 1.35 2.304 2.278 2.278 0 0 1-1.349 2.308 2.284 2.284 0 0 1-3.197-2.308Zm3.567 0c0-1.044-.47-1.655-1.293-1.655-.827 0-1.292.61-1.292 1.655 0 1.052.466 1.658 1.292 1.658.824 0 1.293-.61 1.293-1.658Zm7.02 2.41h-.986l-.996-3.547h-.076l-.992 3.547h-.977L48.364 7.88h.965l.863 3.675h.07l.992-3.675h.912l.99 3.675h.076l.86-3.675h.95l-1.323 4.816Zm2.44-4.816h.916v.765h.071a1.442 1.442 0 0 1 1.438-.858 1.569 1.569 0 0 1 1.668 1.791v3.118h-.95v-2.88c0-.773-.337-1.158-1.04-1.158a1.107 1.107 0 0 0-1.151 1.22v2.818h-.951V7.88ZM61.769 6h.95v6.696h-.95V6Zm2.273 4.286a2.28 2.28 0 0 1 3.197-2.304 2.283 2.283 0 0 1 1.349 2.304 2.28 2.28 0 0 1-2.273 2.502 2.286 2.286 0 0 1-2.168-1.564 2.28 2.28 0 0 1-.105-.938Zm3.567 0c0-1.044-.47-1.655-1.293-1.655-.826 0-1.291.61-1.291 1.655 0 1.052.465 1.658 1.291 1.658.824 0 1.293-.61 1.293-1.658Zm1.98 1.048c0-.867.646-1.367 1.793-1.438l1.305-.075v-.416c0-.508-.337-.795-.987-.795-.53 0-.898.194-1.004.535h-.92c.096-.827.875-1.358 1.968-1.358 1.208 0 1.89.601 1.89 1.618v3.29h-.916v-.676h-.075a1.62 1.62 0 0 1-1.447.756 1.457 1.457 0 0 1-1.607-1.441Zm3.098-.412v-.402l-1.177.075c-.664.044-.965.27-.965.694 0 .434.377.686.894.686a1.138 1.138 0 0 0 1.248-1.053Zm2.197-.636c0-1.522.783-2.486 2-2.486a1.59 1.59 0 0 1 1.478.845h.071V6h.951v6.696h-.911v-.761h-.075a1.674 1.674 0 0 1-1.514.84c-1.226 0-2-.964-2-2.49Zm.982 0c0 1.021.482 1.636 1.288 1.636.801 0 1.297-.624 1.297-1.632 0-1.004-.5-1.636-1.297-1.636-.8 0-1.288.619-1.288 1.632Zm7.453 0a2.28 2.28 0 0 1 3.197-2.304 2.283 2.283 0 0 1 1.349 2.304 2.281 2.281 0 0 1-3.198 2.308 2.281 2.281 0 0 1-1.348-2.308Zm3.567 0c0-1.044-.469-1.655-1.293-1.655-.826 0-1.291.61-1.291 1.655 0 1.052.465 1.658 1.291 1.658.824 0 1.293-.61 1.293-1.658ZM89.14 7.88h.915v.765h.071a1.442 1.442 0 0 1 1.438-.858 1.568 1.568 0 0 1 1.669 1.791v3.118h-.952v-2.88c0-.773-.336-1.158-1.04-1.158a1.106 1.106 0 0 0-1.15 1.22v2.818h-.951V7.88Zm9.467-1.199v1.221h1.044v.8h-1.044v2.477c0 .504.208.725.681.725.121 0 .242-.008.363-.022v.792c-.171.03-.344.046-.518.048-1.057 0-1.478-.372-1.478-1.3v-2.72h-.766v-.8h.766v-1.22h.952Zm2.343-.68h.943v2.653h.075a1.479 1.479 0 0 1 1.469-.863 1.586 1.586 0 0 1 1.66 1.796v3.109h-.952V9.82c0-.77-.359-1.159-1.031-1.159a1.122 1.122 0 0 0-.89.329 1.125 1.125 0 0 0-.323.892v2.813h-.951V6Zm9.693 5.394a1.959 1.959 0 0 1-2.089 1.393 2.186 2.186 0 0 1-2.226-2.485 2.224 2.224 0 0 1 2.222-2.516c1.341 0 2.15.915 2.15 2.428v.331h-3.403v.054a1.269 1.269 0 0 0 .767 1.276c.163.07.339.105.516.103a1.159 1.159 0 0 0 1.147-.584h.916Zm-3.346-1.552h2.434a1.166 1.166 0 0 0-1.186-1.248 1.23 1.23 0 0 0-1.248 1.248Z" /><path fill-rule="evenodd" d="M22.91 7a5.15 5.15 0 0 1-1.177 3.687 4.328 4.328 0 0 1-3.416 1.616 4.9 4.9 0 0 1 1.207-3.55A5.232 5.232 0 0 1 22.91 7Zm4.196 7.847a5.228 5.228 0 0 0-2.488 4.385 5.05 5.05 0 0 0 3.082 4.646 11.6 11.6 0 0 1-1.602 3.267c-.945 1.413-1.935 2.793-3.506 2.819-.747.017-1.25-.198-1.776-.422-.549-.234-1.12-.477-2.014-.477-.948 0-1.545.251-2.12.493-.498.21-.98.412-1.658.44-1.496.056-2.64-1.508-3.618-2.907-1.955-2.86-3.478-8.057-1.437-11.593a5.609 5.609 0 0 1 4.722-2.881c.848-.017 1.662.31 2.376.597.546.219 1.033.415 1.432.415.35 0 .825-.188 1.377-.408.87-.345 1.933-.767 3.017-.654a5.347 5.347 0 0 1 4.213 2.28Z" clip-rule="evenodd" /></symbol>',126,40,!1,void 0)},978374:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon40AppStoreButtonRu","app_store_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="app_store_button_ru_40"><path d="M40.228 17.293h2.295l4.745 12.313h-2.313l-1.155-3.26h-4.918l-1.156 3.26H35.5l4.728-12.313Zm-.76 7.416h3.762l-1.846-5.295h-.052L39.47 24.71Zm8.922-4.019h1.863v1.208h.034c.276-.518.662-.886 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.311.127 1.829.38.529.24.966.58 1.311 1.017.345.425.604.925.777 1.5a6.39 6.39 0 0 1 .258 1.845c0 .598-.08 1.179-.241 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.426-.707.77-1.19 1.035-.483.253-1.053.38-1.708.38a4.39 4.39 0 0 1-.863-.087 3.431 3.431 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.431 2.66 2.66 0 0 1-.552-.638h-.035V32.9H48.39V20.69Zm6.866 4.467c0-.402-.051-.793-.155-1.173a3.08 3.08 0 0 0-.466-1 2.283 2.283 0 0 0-.776-.707 2.06 2.06 0 0 0-1.07-.276c-.828 0-1.455.287-1.88.862-.415.575-.622 1.34-.622 2.294 0 .448.052.868.155 1.259.115.38.282.707.5.983.22.276.478.494.777.655.31.161.667.242 1.07.242.449 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707.207-.3.35-.633.431-1 .092-.38.138-.765.138-1.156Zm3.854-4.467h1.863v1.208h.035c.276-.518.661-.886 1.156-1.104a3.76 3.76 0 0 1 1.605-.345c.701 0 1.31.127 1.829.38.529.24.966.58 1.31 1.017.346.425.605.925.777 1.5a6.39 6.39 0 0 1 .26 1.845c0 .598-.081 1.179-.242 1.742a4.405 4.405 0 0 1-.708 1.5c-.31.426-.707.77-1.19 1.035-.484.253-1.053.38-1.709.38a4.39 4.39 0 0 1-.862-.087 3.43 3.43 0 0 1-.828-.241 3.674 3.674 0 0 1-.742-.431 2.657 2.657 0 0 1-.553-.638h-.034V32.9H59.11V20.69Zm6.867 4.467c0-.402-.052-.793-.155-1.173a3.084 3.084 0 0 0-.466-1 2.283 2.283 0 0 0-.776-.707 2.06 2.06 0 0 0-1.07-.276c-.828 0-1.455.287-1.881.862-.414.575-.621 1.34-.621 2.294 0 .448.052.868.155 1.259.115.38.282.707.5.983.22.276.478.494.777.655.31.161.667.242 1.07.242.448 0 .828-.092 1.139-.276.31-.184.563-.42.759-.707.207-.3.35-.633.431-1 .092-.38.138-.765.138-1.156Zm10.468.345c0 .471.08.874.241 1.207.161.333.386.61.673.828.288.207.616.362.984.465.38.092.788.138 1.225.138.471 0 .874-.051 1.207-.155.334-.115.604-.258.811-.431.208-.172.357-.368.45-.586.091-.23.137-.46.137-.69 0-.471-.11-.816-.328-1.035a1.72 1.72 0 0 0-.69-.483 13.31 13.31 0 0 0-1.535-.448 248.2 248.2 0 0 1-2.14-.57c-.53-.137-.972-.315-1.329-.534a3.322 3.322 0 0 1-.828-.758 2.771 2.771 0 0 1-.448-.88 3.76 3.76 0 0 1-.121-.948c0-.621.126-1.156.38-1.604.264-.46.609-.84 1.035-1.139a4.38 4.38 0 0 1 1.449-.655 6.123 6.123 0 0 1 1.64-.224 6.16 6.16 0 0 1 1.81.259A4.27 4.27 0 0 1 82.57 18a3.61 3.61 0 0 1 1.035 1.242c.253.483.38 1.046.38 1.69h-2.157c-.057-.793-.328-1.351-.81-1.673-.484-.333-1.1-.5-1.847-.5a3.65 3.65 0 0 0-.777.086 2.179 2.179 0 0 0-.724.259 1.585 1.585 0 0 0-.552.483c-.138.207-.207.465-.207.776 0 .437.132.782.396 1.035.276.24.633.425 1.07.551.046.012.225.064.535.156a79.013 79.013 0 0 1 2.209.586c.38.092.65.16.81.207.403.126.754.299 1.053.517.3.219.547.472.742.759.207.276.357.575.449.897.103.322.155.643.155.965 0 .69-.144 1.282-.431 1.777-.276.483-.645.88-1.105 1.19-.46.31-.983.534-1.57.672a7.244 7.244 0 0 1-1.794.224 7.39 7.39 0 0 1-1.985-.258 4.646 4.646 0 0 1-1.621-.794 3.9 3.9 0 0 1-1.105-1.362c-.276-.563-.42-1.224-.431-1.983h2.157Zm8.773-4.812H86.7v-2.673h1.967v2.674h1.778v1.465h-1.778v4.76c0 .207.006.385.018.535.023.149.063.276.12.379a.68.68 0 0 0 .294.241c.126.046.299.07.517.07h.415c.138-.012.276-.035.414-.07v1.518l-.639.069a5.78 5.78 0 0 1-.638.034c-.518 0-.938-.046-1.26-.138a1.86 1.86 0 0 1-.742-.43 1.658 1.658 0 0 1-.362-.725 6.002 6.002 0 0 1-.104-.983v-5.26h-1.483v-1.465Zm10.905 9.158c-.714 0-1.352-.115-1.916-.345a4.28 4.28 0 0 1-1.415-.983 4.34 4.34 0 0 1-.88-1.483 5.858 5.858 0 0 1-.293-1.897c0-.679.098-1.305.293-1.88.207-.575.5-1.07.88-1.483a4.075 4.075 0 0 1 1.415-.966c.564-.241 1.202-.362 1.916-.362.713 0 1.345.12 1.898.362.563.23 1.035.552 1.415.966.39.414.684.908.879 1.483a5.51 5.51 0 0 1 .311 1.88c0 .69-.104 1.322-.311 1.897a4.056 4.056 0 0 1-2.294 2.466c-.553.23-1.185.345-1.898.345Zm0-1.552c.437 0 .816-.092 1.138-.276.323-.184.587-.426.794-.725.207-.299.357-.632.449-1a4.308 4.308 0 0 0 0-2.294 2.834 2.834 0 0 0-.449-1 2.4 2.4 0 0 0-.794-.724c-.322-.184-.701-.276-1.138-.276-.438 0-.817.092-1.14.276a2.4 2.4 0 0 0-.793.724 3.08 3.08 0 0 0-.466 1 4.815 4.815 0 0 0 0 2.294c.104.368.259.701.466 1 .207.3.472.54.794.725.322.184.702.276 1.139.276Zm6.311-7.606h1.846v1.725h.035a2.06 2.06 0 0 1 .327-.707c.173-.23.374-.437.604-.62a3.06 3.06 0 0 1 .794-.466c.288-.116.581-.173.88-.173.23 0 .385.006.466.017l.276.035v1.897a4.936 4.936 0 0 0-.431-.052 2.514 2.514 0 0 0-.414-.035c-.334 0-.65.07-.949.207a2.056 2.056 0 0 0-.76.587 2.775 2.775 0 0 0-.517.948c-.127.38-.19.816-.19 1.31v4.243h-1.967V20.69Zm12.061 3.674a2.967 2.967 0 0 0-.208-.897 2.1 2.1 0 0 0-.448-.742 1.949 1.949 0 0 0-.69-.517 1.915 1.915 0 0 0-.898-.207c-.345 0-.661.063-.949.19a2.098 2.098 0 0 0-.724.5 2.562 2.562 0 0 0-.483.741 2.73 2.73 0 0 0-.19.932h4.59Zm-4.59 1.293c0 .345.046.678.138 1 .103.322.253.604.448.845.196.242.443.437.742.587.3.138.656.207 1.07.207.575 0 1.035-.121 1.381-.363.356-.253.621-.626.793-1.12h1.864a3.717 3.717 0 0 1-.535 1.293c-.253.38-.558.701-.915.966a3.893 3.893 0 0 1-1.207.569 4.57 4.57 0 0 1-1.381.207c-.701 0-1.323-.115-1.863-.345a3.94 3.94 0 0 1-1.381-.966 4.264 4.264 0 0 1-.845-1.483 6.197 6.197 0 0 1-.276-1.897c0-.632.098-1.23.293-1.794a4.703 4.703 0 0 1 .863-1.5 4.159 4.159 0 0 1 1.363-1.035c.529-.252 1.127-.379 1.794-.379.702 0 1.329.15 1.881.448.564.288 1.03.673 1.398 1.156a4.61 4.61 0 0 1 .794 1.673c.172.62.218 1.264.138 1.931h-6.557ZM38.974 13.574c-.43 0-.826-.051-1.19-.152a2.71 2.71 0 0 1-.947-.467 2.167 2.167 0 0 1-.615-.79c-.148-.318-.222-.697-.222-1.136h.917c.007.324.068.601.182.831.12.223.276.406.464.548.195.135.42.233.675.294.256.06.528.091.817.091.248 0 .48-.034.696-.101.215-.075.4-.176.554-.305a1.414 1.414 0 0 0 .514-1.105c0-.263-.05-.476-.151-.639a1.006 1.006 0 0 0-.403-.385 1.602 1.602 0 0 0-.575-.192 4.417 4.417 0 0 0-.686-.051c-.1 0-.215.003-.342.01a3.43 3.43 0 0 0-.303.01v-.79c.08.013.188.02.323.02h.322c.229 0 .437-.02.626-.061.194-.047.36-.122.494-.223a.977.977 0 0 0 .322-.396c.08-.169.121-.375.121-.618 0-.223-.044-.409-.13-.558a.913.913 0 0 0-.344-.355 1.411 1.411 0 0 0-.494-.202 2.63 2.63 0 0 0-.574-.061c-.531 0-.948.118-1.25.355-.303.23-.481.608-.535 1.135h-.917c.013-.385.09-.72.231-1.004a2.02 2.02 0 0 1 .585-.71 2.5 2.5 0 0 1 .847-.425c.33-.095.686-.142 1.069-.142.343 0 .662.04.958.122.302.074.564.192.786.355.222.162.397.368.524.618.128.243.192.534.192.872 0 .196-.034.378-.1.547a1.642 1.642 0 0 1-.273.457 1.75 1.75 0 0 1-.817.567v.03c.235.048.444.13.625.244a1.614 1.614 0 0 1 .726.913c.06.189.09.382.09.578a2.133 2.133 0 0 1-.645 1.47c-.221.23-.51.422-.866.578-.35.148-.777.223-1.28.223Zm5.437-.051a2.64 2.64 0 0 1-.665-.081 1.527 1.527 0 0 1-.555-.244 1.373 1.373 0 0 1-.373-.456 1.612 1.612 0 0 1-.13-.679c0-.297.05-.54.15-.73.101-.19.233-.341.394-.456.168-.122.356-.213.564-.274.215-.06.434-.111.656-.152.235-.047.457-.081.665-.101.215-.027.403-.061.565-.102a1.02 1.02 0 0 0 .383-.192c.094-.088.141-.213.141-.376a.833.833 0 0 0-.11-.456.682.682 0 0 0-.273-.263 1.055 1.055 0 0 0-.373-.122 2.701 2.701 0 0 0-.403-.03c-.363 0-.666.07-.908.212-.242.136-.373.396-.393.781h-.857a1.87 1.87 0 0 1 .202-.821 1.49 1.49 0 0 1 .484-.538c.201-.142.43-.243.685-.304.262-.06.541-.091.837-.091.235 0 .467.017.696.05.235.035.447.105.635.214.188.101.34.246.454.436.114.189.17.436.17.74v2.697c0 .202.011.351.031.446.027.094.108.142.242.142.06 0 .148-.017.262-.051v.67c-.148.087-.353.13-.615.13-.222 0-.4-.06-.534-.182-.128-.128-.192-.334-.192-.618-.235.284-.51.49-.826.618a2.73 2.73 0 0 1-1.009.183Zm.192-.75c.282 0 .524-.037.726-.112a1.65 1.65 0 0 0 .494-.294c.128-.122.222-.25.282-.385.06-.142.09-.274.09-.396v-.882a.94.94 0 0 1-.422.183c-.175.034-.36.064-.555.091l-.575.081c-.195.027-.37.075-.524.142a.975.975 0 0 0-.383.294c-.094.122-.141.29-.141.507a.77.77 0 0 0 .08.365.81.81 0 0 0 .222.233.98.98 0 0 0 .323.132c.12.027.248.04.383.04Zm3.903-4.603h3.569v.76h-2.712v4.481h-.857V8.17Zm4.384 0h.857v.71h.02c.141-.291.363-.5.665-.63.303-.134.636-.202.998-.202.404 0 .753.074 1.049.223.302.149.551.352.746.608.202.25.353.541.454.872.1.332.151.683.151 1.055 0 .378-.05.733-.151 1.064a2.438 2.438 0 0 1-.444.862 2.059 2.059 0 0 1-.746.578 2.375 2.375 0 0 1-1.038.213 2.528 2.528 0 0 1-.898-.172 2.04 2.04 0 0 1-.443-.244 1.498 1.498 0 0 1-.343-.395h-.02v2.697h-.857v-7.24Zm2.47 4.603c.289 0 .534-.058.736-.173.202-.115.363-.267.484-.456a1.99 1.99 0 0 0 .262-.649c.054-.243.08-.493.08-.75 0-.243-.033-.48-.1-.71a1.8 1.8 0 0 0-.293-.628 1.379 1.379 0 0 0-.504-.436 1.494 1.494 0 0 0-.715-.163c-.29 0-.535.058-.736.173a1.458 1.458 0 0 0-.494.456 1.907 1.907 0 0 0-.283.629 3.237 3.237 0 0 0 .01 1.47c.06.236.155.446.282.628.135.183.306.332.515.447.208.108.46.162.756.162Zm4.111 2.727c-.1 0-.202-.007-.302-.02a1.427 1.427 0 0 1-.293-.071v-.791l.242.081a.88.88 0 0 0 .262.04c.175 0 .316-.04.424-.121.107-.081.201-.2.282-.355l.353-.882-2.067-5.211h.968l1.522 4.288h.02l1.462-4.288h.908l-2.269 5.93c-.1.258-.201.474-.302.65a1.536 1.536 0 0 1-.323.426.963.963 0 0 1-.393.243 1.377 1.377 0 0 1-.494.081Zm6.523-1.977c-.692 0-1.233-.155-1.623-.466-.39-.311-.602-.754-.635-1.329h.867c.027.386.168.663.423.832.256.169.575.253.958.253.41 0 .726-.088.948-.263a.818.818 0 0 0 .332-.67c0-.263-.084-.47-.252-.618-.168-.149-.453-.223-.857-.223h-.695v-.7h.554c.303 0 .562-.06.777-.182.215-.129.322-.348.322-.66 0-.195-.094-.368-.282-.516-.181-.149-.454-.223-.817-.223a2.21 2.21 0 0 0-.463.05 1.33 1.33 0 0 0-.404.163.968.968 0 0 0-.302.294c-.08.121-.131.27-.151.446h-.867c.02-.325.097-.592.231-.801a1.51 1.51 0 0 1 .504-.507c.202-.129.43-.22.686-.274.255-.054.514-.081.776-.081.27 0 .521.027.757.081.235.054.44.142.614.264.182.115.323.26.424.436.108.175.161.385.161.628 0 .304-.087.551-.262.74a1.07 1.07 0 0 1-.575.355v.02c.121.02.242.061.363.122s.229.146.323.254c.094.101.172.23.232.385.06.149.09.324.09.527 0 .284-.06.53-.18.74-.122.21-.283.382-.485.517a2.246 2.246 0 0 1-.695.305 3.13 3.13 0 0 1-.797.1ZM69.28 8.17h.856v4.278l2.46-4.278h1.1v5.241h-.858V9.133l-2.46 4.278H69.28V8.17Zm7.071.76h-1.865v-.76h4.587v.76h-1.865v4.481h-.857v-4.48Zm5.725 4.593c-.416 0-.782-.068-1.098-.203a2.128 2.128 0 0 1-.777-.568 2.478 2.478 0 0 1-.474-.872 3.853 3.853 0 0 1-.15-1.105c0-.392.06-.753.18-1.085a2.67 2.67 0 0 1 .505-.871 2.38 2.38 0 0 1 .776-.568c.303-.135.632-.203.988-.203.464 0 .847.098 1.15.294.309.19.554.433.736.73.188.297.315.622.383.973.073.352.104.686.09 1.004h-3.901c-.007.23.02.45.08.66.06.202.158.384.293.547.134.155.305.28.514.375.208.094.454.142.736.142.363 0 .659-.085.887-.254.235-.169.39-.426.464-.77h.847c-.115.595-.367 1.04-.757 1.338-.39.29-.88.436-1.472.436Zm1.402-3.234a1.696 1.696 0 0 0-.141-.578 1.322 1.322 0 0 0-.313-.467 1.314 1.314 0 0 0-.463-.314 1.373 1.373 0 0 0-.585-.122c-.222 0-.424.041-.605.122a1.35 1.35 0 0 0-.454.314 1.513 1.513 0 0 0-.302.477 1.75 1.75 0 0 0-.131.568h2.994Zm4.803-2.119h2.41c.228 0 .447.017.655.05.215.034.407.098.575.193.168.088.302.216.403.385.101.17.151.386.151.65 0 .283-.067.513-.201.689a1.507 1.507 0 0 1-.565.436v.01c.303.06.541.203.716.425.181.224.272.51.272.862 0 .223-.04.43-.12.619a1.34 1.34 0 0 1-.323.486c-.142.136-.31.244-.504.325a1.77 1.77 0 0 1-.636.111h-2.833V8.17Zm2.672 4.511c.282 0 .494-.08.635-.243a.92.92 0 0 0 .222-.629.734.734 0 0 0-.232-.567c-.154-.142-.413-.213-.776-.213h-1.674v1.652h1.825ZM90.6 10.32c.37 0 .625-.068.766-.203a.693.693 0 0 0 .222-.537c0-.216-.07-.382-.212-.497-.14-.121-.4-.182-.776-.182h-1.472v1.42H90.6Zm-65.982 8.912a5.228 5.228 0 0 1 2.488-4.386 5.347 5.347 0 0 0-4.213-2.279c-1.772-.186-3.49 1.062-4.394 1.062-.92 0-2.312-1.043-3.808-1.012a5.609 5.609 0 0 0-4.722 2.881c-2.041 3.536-.518 8.734 1.437 11.593.978 1.4 2.121 2.964 3.618 2.908 1.464-.061 2.011-.934 3.778-.934 1.751 0 2.264.934 3.79.899 1.57-.025 2.561-1.406 3.506-2.82a11.57 11.57 0 0 0 1.602-3.266 5.05 5.05 0 0 1-3.081-4.646h-.001Zm-2.884-8.545A5.15 5.15 0 0 0 22.911 7a5.232 5.232 0 0 0-3.386 1.753 4.9 4.9 0 0 0-1.208 3.55 4.328 4.328 0 0 0 3.417-1.616Z" /></symbol>',126,40,!1,void 0)},967285:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon40GooglePlayButtonEn","google_play_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="google_play_button_en_40"><path fill-rule="evenodd" d="M42.296 24.277V22.55h5.914c.095.288.095.672.095 1.055 0 1.246-.381 2.876-1.526 4.026-1.145 1.246-2.48 1.821-4.388 1.821-3.434 0-6.391-2.875-6.391-6.326 0-3.451 2.957-6.327 6.391-6.327 1.908 0 3.244.767 4.293 1.726l-1.24 1.246c-.763-.671-1.813-1.246-3.148-1.246-2.48 0-4.484 2.012-4.484 4.6 0 2.589 1.908 4.602 4.484 4.602 1.621 0 2.575-.671 3.148-1.246.477-.48.858-1.247.954-2.205h-4.102Zm35.103 4.889h-1.813V17.184H77.4v11.982Zm12.21-11.982H93.9c2.003 0 3.911 1.438 3.911 3.738S95.903 24.66 93.9 24.66h-2.48v4.506h-1.813V17.184Zm9.158 11.982h1.812V17.184h-1.812v11.982Zm3.053-6.135c.477-1.246 1.812-1.822 3.148-1.822 2.003 0 3.624 1.247 3.815 3.356v4.6h-1.717v-.958h-.095c-.477.575-1.05 1.15-2.29 1.15-1.526 0-2.957-1.054-2.957-2.684 0-1.725 1.717-2.684 3.434-2.684.763 0 1.527.288 1.813.48v-.096c-.096-.959-.954-1.534-1.908-1.534-.668 0-1.24.192-1.622.863l-1.621-.671Zm10.969 3.642 2.003-5.176h1.908l-4.865 11.311h-1.812l1.812-4.026-3.148-7.285h1.908l2.099 5.176h.095Zm-27.186-2.78c-.382-.958-1.336-2.588-3.434-2.588-2.1 0-3.816 1.63-3.816 4.122 0 2.3 1.717 4.122 4.006 4.122 1.813 0 2.957-1.15 3.339-1.821l-1.335-.959c-.477.671-1.05 1.15-2.004 1.15s-1.526-.383-2.003-1.245l5.437-2.301-.19-.48Zm-12.878-1.725c-.477-.48-1.24-.959-2.194-.959-2.003 0-3.91 1.822-3.91 4.122 0 2.301 1.812 4.027 3.91 4.027.954 0 1.717-.48 2.099-.96h.095v.576c0 1.534-.858 2.396-2.194 2.396-1.05 0-1.812-.766-2.003-1.437l-1.526.67C67.479 31.659 68.623 33 70.626 33c2.1 0 3.816-1.246 3.816-4.218v-7.285h-1.717v.671Zm-15.072 3.26c0-2.397 1.812-4.123 4.102-4.123s4.102 1.63 4.102 4.122c0 2.397-1.813 4.122-4.102 4.122-2.29 0-4.102-1.821-4.102-4.122Zm-4.77-4.123c-2.289 0-4.101 1.726-4.101 4.122 0 2.3 1.812 4.122 4.102 4.122s4.102-1.725 4.102-4.122c0-2.492-1.813-4.122-4.102-4.122Zm38.539 1.63h2.575c1.24 0 2.004-1.054 2.099-2.109 0-.863-.763-2.013-2.099-2.013h-2.575v4.122Zm11.924 3.834c0 .767.859 1.055 1.431 1.055.954 0 1.908-.767 2.099-1.917l-.142-.058c-.416-.17-.794-.326-1.48-.326-.858 0-1.908.288-1.908 1.246Zm-23.277-1.534c0-1.533 1.24-2.396 2.099-2.396.668 0 1.335.384 1.526.863l-3.625 1.533Zm-11.733.096c0 1.438 1.05 2.493 2.29 2.493s2.194-1.055 2.194-2.493-.954-2.492-2.194-2.492-2.29 1.055-2.29 2.492Zm-6.58 2.493c-1.24 0-2.29-1.055-2.29-2.493s1.05-2.492 2.29-2.492 2.29.959 2.29 2.492c0 1.438-1.05 2.493-2.29 2.493ZM50.594 25.33c0 1.438 1.05 2.493 2.29 2.493s2.288-1.055 2.288-2.493c0-1.533-1.049-2.492-2.289-2.492-1.24 0-2.29 1.055-2.29 2.492Z" clip-rule="evenodd" /><path d="M64.258 13.2c-.83 0-1.53-.304-2.084-.901a3.146 3.146 0 0 1-.841-2.2c0-.873.283-1.612.841-2.198.551-.597 1.251-.901 2.082-.901.82 0 1.52.304 2.083.901.558.605.842 1.344.842 2.198-.01.875-.293 1.614-.842 2.197-.551.603-1.25.904-2.081.904Zm-24.703 0a2.83 2.83 0 0 1-2.093-.89c-.572-.588-.862-1.331-.862-2.209 0-.877.29-1.62.862-2.21a2.798 2.798 0 0 1 2.093-.889c.402 0 .794.084 1.169.254.368.165.668.39.89.665l.054.069-.62.636-.064-.079c-.35-.435-.818-.648-1.438-.648-.554 0-1.036.206-1.434.612-.4.409-.604.945-.604 1.593s.203 1.183.604 1.592c.398.406.88.612 1.434.612.59 0 1.086-.206 1.473-.612.228-.24.37-.574.42-.997h-1.987v-.894h2.84l.012.081c.02.15.041.306.041.45 0 .824-.238 1.492-.709 1.984-.535.583-1.235.88-2.081.88Zm32.845-.127h-.876l-2.683-4.488.023.808v3.678h-.876V7.129h1l.027.046 2.523 4.227-.023-.806V7.13h.885v5.944Zm-14.724 0h-.888v-5.05H55.25V7.13h3.963v.894h-1.539v5.05h.003Zm-3.15 0h-.885V7.13h.885v5.944Zm-4.974 0h-.885v-5.05h-1.54V7.13h3.964v.894h-1.54v5.05Zm-2.985-.01h-3.394V7.13h3.394v.894H44.06v1.631h2.262v.885H44.06v1.63h2.507v.895Zm16.257-1.379c.395.414.876.622 1.434.622a1.87 1.87 0 0 0 1.434-.622c.389-.406.585-.94.585-1.583s-.196-1.179-.583-1.583a1.92 1.92 0 0 0-1.434-.621 1.86 1.86 0 0 0-1.432.621c-.388.407-.585.94-.585 1.583s.194 1.179.58 1.583Zm-44.366 6.769L9.17 9.693a2.142 2.142 0 0 1 3.063-.989l.006.003 10.426 6.018-4.208 3.728ZM9 11.015l8.408 8.368.032.034L9 28.336V11.015ZM11.132 31a2.13 2.13 0 0 1-1.965-1.3l9.302-9.26 4.25 4.232-10.472 6.016-.003.002-.031.018h-.001a2.126 2.126 0 0 1-1.08.292Zm8.283-11.5 4.227-4.208 4.41 2.545.015.01.023.013a2.117 2.117 0 0 1-.013 3.732l-.007.004-.006.004-4.386 2.52-4.263-4.62Z" /></symbol>',126,40,!1,void 0)},267509:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon40GooglePlayButtonRu","google_play_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="google_play_button_ru_40"><path d="M98.726 29.122h1.776V17.23h-1.776v11.892Zm15.999-7.609-2.036 5.157h-.062l-2.113-5.157h-1.913l3.169 7.207-1.806 4.009h1.852l4.884-11.216h-1.975Zm-10.074 6.259c-.582 0-1.393-.291-1.393-1.01 0-.918 1.01-1.27 1.883-1.27.78 0 1.148.168 1.623.398a2.154 2.154 0 0 1-2.113 1.882Zm.215-6.518c-1.286 0-2.619.566-3.171 1.82l1.578.658c.337-.658.964-.872 1.623-.872.919 0 1.853.55 1.868 1.53v.122c-.322-.184-1.011-.459-1.852-.459-1.7 0-3.43.934-3.43 2.677 0 1.593 1.393 2.617 2.954 2.617 1.195 0 1.853-.534 2.267-1.163h.061v.919h1.715v-4.56c0-2.111-1.577-3.29-3.613-3.29Zm-10.978 1.708h-2.526v-4.078h2.526c1.328 0 2.082 1.1 2.082 2.039 0 .922-.754 2.039-2.082 2.039Zm-.046-5.732h-4.256v11.892h1.776v-4.505h2.48c1.969 0 3.904-1.425 3.904-3.694 0-2.27-1.935-3.693-3.904-3.693ZM70.633 27.773c-1.227 0-2.254-1.026-2.254-2.436 0-1.425 1.027-2.468 2.254-2.468 1.213 0 2.162 1.043 2.162 2.468 0 1.41-.95 2.436-2.162 2.436Zm2.04-5.593h-.061c-.399-.475-1.166-.905-2.132-.905-2.025 0-3.88 1.778-3.88 4.062 0 2.268 1.855 4.03 3.88 4.03.966 0 1.733-.428 2.132-.919h.06v.582c0 1.55-.826 2.376-2.161 2.376-1.089 0-1.764-.782-2.04-1.44l-1.549.644c.445 1.073 1.626 2.39 3.589 2.39 2.085 0 3.85-1.226 3.85-4.215V21.52h-1.689v.66Zm2.913 6.942h1.78V17.23h-1.78v11.893Zm4.402-3.923c-.046-1.564 1.212-2.36 2.116-2.36.706 0 1.305.352 1.504.858l-3.62 1.502Zm5.521-1.349c-.338-.905-1.365-2.575-3.466-2.575-2.085 0-3.818 1.64-3.818 4.047 0 2.268 1.717 4.046 4.017 4.046 1.857 0 2.929-1.134 3.375-1.793l-1.38-.92c-.46.674-1.09 1.118-1.995 1.118-.904 0-1.549-.413-1.963-1.225l5.414-2.238-.184-.46Zm-43.13-1.333v1.717h4.11c-.123.965-.444 1.67-.935 2.16-.598.598-1.534 1.257-3.174 1.257-2.532 0-4.51-2.038-4.51-4.567 0-2.53 1.978-4.567 4.51-4.567 1.364 0 2.361.535 3.097 1.226l1.212-1.21c-1.028-.982-2.392-1.733-4.31-1.733-3.466 0-6.379 2.82-6.379 6.284s2.913 6.284 6.38 6.284c1.87 0 3.28-.614 4.385-1.763 1.135-1.134 1.488-2.727 1.488-4.015 0-.4-.03-.766-.093-1.073h-5.78Zm10.546 5.256c-1.226 0-2.285-1.01-2.285-2.451 0-1.456 1.06-2.453 2.285-2.453 1.227 0 2.286.997 2.286 2.453 0 1.44-1.06 2.451-2.286 2.451Zm0-6.498c-2.24 0-4.064 1.702-4.064 4.047 0 2.329 1.825 4.046 4.064 4.046 2.24 0 4.065-1.717 4.065-4.046 0-2.345-1.826-4.047-4.065-4.047Zm8.866 6.498c-1.227 0-2.285-1.01-2.285-2.451 0-1.456 1.058-2.453 2.285-2.453s2.285.997 2.285 2.453c0 1.44-1.058 2.451-2.285 2.451Zm0-6.498c-2.239 0-4.064 1.702-4.064 4.047 0 2.329 1.825 4.046 4.064 4.046s4.064-1.717 4.064-4.046c0-2.345-1.825-4.047-4.064-4.047Zm20.993-8.46c-.373-.255-.628-.63-.766-1.127l.836-.331c.071.309.211.551.418.729.207.176.451.265.733.265.303 0 .563-.096.778-.286a.906.906 0 0 0 .323-.708.869.869 0 0 0-.157-.502 1.088 1.088 0 0 0-.431-.36 1.342 1.342 0 0 0-.596-.132h-.489v-.795h.44c.298 0 .545-.082.744-.245a.805.805 0 0 0 .299-.658.767.767 0 0 0-.278-.605 1.02 1.02 0 0 0-.691-.24.923.923 0 0 0-.63.224 1.17 1.17 0 0 0-.355.53l-.803-.332a1.97 1.97 0 0 1 .633-.865c.307-.251.694-.377 1.163-.377.359 0 .678.07.957.211.278.141.496.335.654.58.157.246.235.523.235.832 0 .575-.25 1-.753 1.276v.05a1.7 1.7 0 0 1 .687.554c.177.244.265.539.265.887a1.7 1.7 0 0 1-.26.92 1.815 1.815 0 0 1-.716.65 2.187 2.187 0 0 1-1.019.235c-.442 0-.849-.127-1.221-.38Zm-6.379-5.682h.902v3.28l-.05 1.143h.05l2.658-4.423H81v5.93h-.903V9.7l.05-1.143h-.05l-2.699 4.505h-.993v-5.93Zm-4.926 5.077c.215 0 .405-.05.57-.15.166-.099.294-.23.381-.393a1.07 1.07 0 0 0-.951-1.586h-1.325v2.129h1.325Zm-2.236-5.077h.911v2.111h1.259c.37 0 .711.077 1.026.228.315.152.566.373.754.663.188.29.28.628.28 1.014 0 .387-.093.725-.28 1.015-.189.29-.44.512-.754.667a2.294 2.294 0 0 1-1.026.232h-2.17v-5.93Zm-3.51.861h-1.665v-.861H68.3v.861h-1.656v5.069h-.91V7.994Zm-3.387 2.7-.662-1.818-.223-.68h-.05l-.223.68-.663 1.818h1.821Zm-1.431-3.561h1.034l2.244 5.93H63.19l-.546-1.524h-2.418l-.546 1.524h-1.002l2.236-5.93Zm-3.941 3.288c-.37.326-.825.488-1.366.488-.359 0-.684-.073-.973-.22a1.643 1.643 0 0 1-.683-.633 1.869 1.869 0 0 1-.249-.977V7.133h.92v1.789c0 .359.104.636.314.832.21.196.492.294.844.294.481 0 .878-.187 1.193-.563V7.133h.902v5.93h-.902V10.42Zm-5.274.273-.662-1.818-.224-.68h-.05l-.223.68-.662 1.818h1.82Zm-1.433-3.561h1.036l2.243 5.93h-1.002l-.546-1.524h-2.417l-.547 1.524h-1.002l2.235-5.93Zm-7.401 0h.91v2.874h.05l2.36-2.874h1.142v.05l-2.5 2.964 2.633 2.866v.05H46.27l-2.442-2.717h-.05v2.716h-.91v-5.93ZM37.92 12.79a2.945 2.945 0 0 1-1.114-1.119 3.125 3.125 0 0 1-.406-1.573c0-.575.135-1.1.406-1.574.27-.475.641-.848 1.114-1.118.471-.27.994-.406 1.568-.406.889 0 1.62.323 2.194.97l-.637.62a2.08 2.08 0 0 0-.683-.546 1.97 1.97 0 0 0-.866-.183c-.403 0-.77.093-1.1.278a2.038 2.038 0 0 0-.787.787c-.194.34-.29.73-.29 1.172 0 .441.096.832.29 1.172.193.34.455.602.787.786.33.186.697.278 1.1.278.674 0 1.24-.279 1.698-.837l.654.63a3.026 3.026 0 0 1-2.36 1.068 3.097 3.097 0 0 1-1.569-.405Zm-19.462 5.663L9.17 9.693a2.142 2.142 0 0 1 3.063-.989l.006.003 10.426 6.018-4.208 3.728ZM9 11.015l8.408 8.368.032.034L9 28.336V11.015ZM11.132 31a2.13 2.13 0 0 1-1.965-1.3l9.302-9.26 4.25 4.232-10.472 6.016-.003.002-.031.018h-.001a2.126 2.126 0 0 1-1.08.292Zm8.283-11.5 4.227-4.208 4.41 2.545.015.01.023.013a2.117 2.117 0 0 1-.013 3.732l-.007.004-.006.004-4.386 2.52-4.263-4.62Z" /></symbol>',126,40,!1,void 0)},933378:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon40RustoreButtonEn","rustore_button_en_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="rustore_button_en_40"><path fill-rule="evenodd" d="M63.773 31.4c-1.115 0-2.099-.296-2.952-.89a4.345 4.345 0 0 1-1.689-2.428l1.98-.342c.33.604.699 1.055 1.108 1.351.41.285.933.428 1.57.428.591 0 1.075-.131 1.45-.394a1.29 1.29 0 0 0 .58-1.111c0-.343-.108-.628-.324-.856a2.423 2.423 0 0 0-.82-.581 14.447 14.447 0 0 0-1.313-.496 15.093 15.093 0 0 1-1.876-.736 3.67 3.67 0 0 1-1.263-1.077c-.341-.479-.512-1.095-.512-1.847 0-.696.171-1.3.512-1.813a3.38 3.38 0 0 1 1.416-1.198c.592-.273 1.257-.41 1.996-.41 1.047 0 1.945.274 2.696.821.75.547 1.28 1.3 1.586 2.258l-1.945.325c-.216-.49-.517-.867-.904-1.13-.386-.262-.841-.393-1.364-.393-.535 0-.984.126-1.348.377-.364.25-.546.604-.546 1.06 0 .342.102.627.307.855.216.228.489.416.819.565.33.148.773.319 1.33.513.763.262 1.388.519 1.877.77.49.25.904.615 1.245 1.094.353.479.53 1.089.53 1.83 0 .696-.188 1.306-.564 1.83-.364.525-.864.93-1.5 1.215-.627.273-1.32.41-2.082.41Zm-18.103-.171h2.406l-3.344-4.584c.899-.228 1.615-.667 2.15-1.317.546-.661.819-1.442.819-2.343 0-.741-.182-1.397-.546-1.967a3.65 3.65 0 0 0-1.519-1.351c-.648-.33-1.382-.496-2.2-.496H39v12.058h2.047v-4.43h1.45l3.173 4.43Zm-4.623-6.311v-3.866h2.389c.637 0 1.154.183 1.552.548.41.353.614.815.614 1.385 0 .57-.204 1.038-.614 1.403-.398.353-.915.53-1.552.53h-2.389Zm10.101 6.003c.512.32 1.08.479 1.706.479.535 0 1.035-.131 1.501-.393a3.19 3.19 0 0 0 1.126-1.112l.393 1.334h1.467v-8.894h-1.962v5.148c0 .627-.188 1.146-.563 1.557-.375.399-.847.598-1.416.598-.557 0-1.018-.2-1.382-.598-.352-.4-.529-.918-.529-1.557v-5.148h-1.962v5.37c0 .708.142 1.34.427 1.9.296.558.694.997 1.194 1.316Zm23.933.308.17-1.71h-1.825c-.66 0-.99-.331-.99-.992v-4.482h2.645v-1.71h-2.644V19.77h-1.468l-.494 2.565h-1.45v1.71h1.45v4.482c0 .878.25 1.55.75 2.018.5.456 1.234.684 2.201.684h1.655Zm5.948.171c-.91 0-1.73-.194-2.457-.581a4.415 4.415 0 0 1-1.689-1.642c-.398-.707-.597-1.506-.597-2.395 0-.89.199-1.682.597-2.377a4.257 4.257 0 0 1 1.689-1.642c.728-.4 1.547-.599 2.457-.599.91 0 1.723.2 2.44.599.727.387 1.29.935 1.688 1.642.41.695.614 1.488.614 2.377 0 .89-.204 1.688-.614 2.395a4.263 4.263 0 0 1-1.689 1.642c-.716.387-1.53.581-2.44.581Zm0-1.796c.796 0 1.444-.256 1.945-.77.5-.524.75-1.208.75-2.052 0-.844-.25-1.522-.75-2.035-.501-.525-1.15-.787-1.945-.787-.796 0-1.445.262-1.945.787-.5.513-.75 1.191-.75 2.035 0 .844.25 1.528.75 2.052.5.514 1.148.77 1.945.77Zm8.086-7.269h-1.467v8.894h1.962v-5.25c0-1.175.58-1.762 1.74-1.762h1.126l-.171-1.882h-.375c-.558 0-1.035.097-1.433.29-.387.195-.723.525-1.007.993l-.375-1.283ZM102.3 26.68c0 .172-.011.382-.034.633h-7.131c.09.696.375 1.255.853 1.676.477.41 1.086.616 1.825.616.5 0 .95-.097 1.348-.29.41-.195.722-.457.938-.787l1.843.307a3.645 3.645 0 0 1-1.655 1.899c-.774.445-1.638.667-2.593.667-.887 0-1.684-.194-2.389-.581a4.36 4.36 0 0 1-1.638-1.642c-.386-.707-.58-1.506-.58-2.395 0-.89.194-1.682.58-2.377a4.203 4.203 0 0 1 1.638-1.642c.705-.4 1.502-.599 2.389-.599.887 0 1.677.2 2.371.599a4.086 4.086 0 0 1 1.638 1.625c.398.684.597 1.448.597 2.291Zm-4.606-2.804a2.47 2.47 0 0 0-1.553.513c-.432.342-.728.803-.887 1.385h4.913a2.625 2.625 0 0 0-.92-1.368c-.433-.354-.95-.53-1.553-.53Z" clip-rule="evenodd" /><path d="M45.403 14.371h-1.121l-.546-1.667H40.83l-.555 1.667h-1.092l2.48-6.994h1.34l2.4 6.994Zm-3.135-5.942-1.121 3.353h2.291l-1.09-3.353h-.08Zm6.504 5.942h-1.24l-1.766-5.238h1.082l1.3 4.147h.049l1.399-4.147h1.041l-1.865 5.238Zm4.825-5.367c.628 0 1.117.182 1.468.546.35.363.526.866.526 1.507v3.314h-.804l-.11-.565c-.495.463-1.05.694-1.666.694-.516 0-.932-.149-1.25-.446-.31-.298-.466-.695-.466-1.19 0-.523.195-.933.585-1.231.39-.298.913-.446 1.568-.446h1.12v-.14c0-.39-.088-.687-.267-.892-.172-.205-.42-.308-.744-.308-.205 0-.39.047-.556.14a.803.803 0 0 0-.367.386h-1.061c.119-.443.36-.78.724-1.012.37-.238.803-.357 1.3-.357Zm-1.27 3.81c0 .25.082.453.248.605.172.152.393.228.664.228.225 0 .457-.053.695-.159.238-.106.45-.245.635-.417v-1.11h-1.111c-.35 0-.629.075-.834.227a.745.745 0 0 0-.297.625Zm5.876 1.557H57.18V9.133h1.022v5.238Zm-.506-6.091a.63.63 0 0 1-.466-.179.63.63 0 0 1-.179-.466c0-.192.06-.344.179-.456A.63.63 0 0 1 57.697 7c.192 0 .344.06.456.179.12.112.179.264.179.456a.63.63 0 0 1-.179.466.598.598 0 0 1-.456.179Zm3.198 6.091h-1.021V7.179h1.021v7.192Zm3.695-5.367c.627 0 1.117.182 1.467.546.35.363.526.866.526 1.507v3.314h-.803l-.11-.565c-.496.463-1.051.694-1.666.694-.516 0-.933-.149-1.25-.446-.311-.298-.466-.695-.466-1.19 0-.523.195-.933.585-1.231.39-.298.913-.446 1.567-.446h1.121v-.14c0-.39-.089-.687-.268-.892-.172-.205-.42-.308-.744-.308-.205 0-.39.047-.555.14a.803.803 0 0 0-.367.386h-1.062c.12-.443.36-.78.724-1.012.37-.238.804-.357 1.3-.357Zm-1.27 3.81c0 .25.082.453.247.605.172.152.394.228.665.228a1.7 1.7 0 0 0 .694-.159c.239-.106.45-.245.635-.417v-1.11h-1.11c-.351 0-.63.075-.834.227a.744.744 0 0 0-.298.625Zm7.344-3.81c.443 0 .83.112 1.16.337.331.219.586.533.764.943.179.41.268.886.268 1.428 0 .55-.1 1.035-.297 1.459a2.34 2.34 0 0 1-.814.982c-.35.231-.757.347-1.22.347a2.062 2.062 0 0 1-1.439-.575l-.09.446h-.803V7.179h1.022v2.37c.443-.363.926-.545 1.449-.545Zm-.318 4.633c.456 0 .814-.172 1.072-.516.257-.344.386-.814.386-1.409 0-.569-.122-1.018-.367-1.349a1.147 1.147 0 0 0-.992-.506c-.41 0-.82.166-1.23.496v2.867c.337.278.715.417 1.131.417Zm4.894.734h-1.022V7.179h1.022v7.192Zm6.055-2.768c0 .053-.01.189-.03.407h-3.64c.032.529.171.936.416 1.22.251.278.598.417 1.041.417.232 0 .44-.043.626-.13a.829.829 0 0 0 .406-.386h1.052a1.864 1.864 0 0 1-.774 1.012c-.37.238-.823.357-1.36.357-.489 0-.918-.112-1.289-.337a2.233 2.233 0 0 1-.843-.953c-.198-.416-.298-.903-.298-1.458 0-.556.096-1.038.288-1.448.192-.417.463-.738.814-.963.357-.225.773-.337 1.25-.337.47 0 .88.106 1.23.317.357.212.631.516.823.913.192.39.288.847.288 1.37Zm-2.341-1.766c-.364 0-.658.126-.883.377-.225.245-.367.592-.427 1.042h2.629c-.053-.45-.195-.797-.427-1.042-.225-.251-.522-.377-.892-.377Zm7.239 4.534h-1.022V9.133h1.022v5.238Zm-.506-6.091a.63.63 0 0 1-.466-.179.63.63 0 0 1-.178-.466.6.6 0 0 1 .178-.456.63.63 0 0 1 .466-.179.6.6 0 0 1 .457.179.598.598 0 0 1 .178.456.63.63 0 0 1-.178.466.598.598 0 0 1-.457.179Zm4.618.724c.37 0 .694.086.972.258.284.172.506.42.665.744.158.317.238.691.238 1.121v3.244h-1.022v-3.214c0-.404-.1-.718-.298-.943-.192-.225-.463-.337-.813-.337-.41 0-.804.179-1.18.536v3.958h-1.023V9.133h.804l.1.516a3.24 3.24 0 0 1 .763-.486 1.98 1.98 0 0 1 .794-.159Z" /><path fill-rule="evenodd" d="M19.52 32c-5.43 0-8.146 0-9.833-1.688C8 28.625 8 25.91 8 20.48v-.96c0-5.43 0-8.146 1.687-9.833C11.374 8 14.089 8 19.52 8h.96c5.43 0 8.145 0 9.832 1.687C32 11.374 32 14.089 32 19.52v.96c0 5.43 0 8.145-1.688 9.832C28.625 32 25.91 32 20.48 32h-.96Zm5.387-8.453 1.622.405a1.162 1.162 0 0 0 1.447-1.122v-7.816c0-.663-.454-1.242-1.1-1.403l-4.652-1.162a1.162 1.162 0 0 0-1.446 1.123v1.409l-2.93-.732A1.162 1.162 0 0 0 16.4 15.37v1.41l-2.93-.733a1.162 1.162 0 0 0-1.447 1.123v7.815c0 .664.453 1.242 1.1 1.404l4.651 1.161a1.162 1.162 0 0 0 1.447-1.122v-7.804c0-.66-.417-1.042-.568-1.16a.07.07 0 0 1-.016-.093.082.082 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.969a.473.473 0 0 0 .317.43l1.646.411a1.162 1.162 0 0 0 1.447-1.123v-7.803c0-.66-.416-1.042-.567-1.159a.07.07 0 0 1-.016-.094.083.083 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.968a.47.47 0 0 0 .34.436Z" clip-rule="evenodd" /></symbol>',126,40,!1,void 0)},714772:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon40RustoreButtonRu","rustore_button_ru_40","0 0 126 40",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 126 40" id="rustore_button_ru_40"><path fill-rule="evenodd" d="M63.773 31.4c-1.115 0-2.099-.296-2.952-.89a4.345 4.345 0 0 1-1.689-2.428l1.98-.342c.33.604.699 1.055 1.108 1.351.41.285.933.428 1.57.428.591 0 1.075-.131 1.45-.394a1.29 1.29 0 0 0 .58-1.111c0-.343-.108-.628-.324-.856a2.423 2.423 0 0 0-.82-.581 14.447 14.447 0 0 0-1.313-.496 15.093 15.093 0 0 1-1.876-.736 3.67 3.67 0 0 1-1.263-1.077c-.341-.479-.512-1.095-.512-1.847 0-.696.171-1.3.512-1.813a3.38 3.38 0 0 1 1.416-1.198c.592-.273 1.257-.41 1.996-.41 1.047 0 1.945.274 2.696.821.75.547 1.28 1.3 1.586 2.258l-1.945.325c-.216-.49-.517-.867-.904-1.13-.386-.262-.841-.393-1.364-.393-.535 0-.984.126-1.348.377-.364.25-.546.604-.546 1.06 0 .342.102.627.307.855.216.228.489.416.819.565.33.148.773.319 1.33.513.763.262 1.388.519 1.877.77.49.25.904.615 1.245 1.094.353.479.53 1.089.53 1.83 0 .696-.188 1.306-.564 1.83-.364.525-.864.93-1.5 1.215-.627.273-1.32.41-2.082.41Zm-18.103-.171h2.406l-3.344-4.584c.899-.228 1.615-.667 2.15-1.317.546-.661.819-1.442.819-2.343 0-.741-.182-1.397-.546-1.967a3.65 3.65 0 0 0-1.519-1.351c-.648-.33-1.382-.496-2.2-.496H39v12.058h2.047v-4.43h1.45l3.173 4.43Zm-4.623-6.311v-3.866h2.389c.637 0 1.154.183 1.552.548.41.353.614.815.614 1.385 0 .57-.204 1.038-.614 1.403-.398.353-.915.53-1.552.53h-2.389Zm10.101 6.003c.512.32 1.08.479 1.706.479.535 0 1.035-.131 1.501-.393a3.19 3.19 0 0 0 1.126-1.112l.393 1.334h1.467v-8.894h-1.962v5.148c0 .627-.188 1.146-.563 1.557-.375.399-.847.598-1.416.598-.557 0-1.018-.2-1.382-.598-.352-.4-.529-.918-.529-1.557v-5.148h-1.962v5.37c0 .708.142 1.34.427 1.9.296.558.694.997 1.194 1.316Zm23.933.308.17-1.71h-1.825c-.66 0-.99-.331-.99-.992v-4.482h2.645v-1.71h-2.644V19.77h-1.468l-.494 2.565h-1.45v1.71h1.45v4.482c0 .878.25 1.55.75 2.018.5.456 1.234.684 2.201.684h1.655Zm5.948.171c-.91 0-1.73-.194-2.457-.581a4.415 4.415 0 0 1-1.689-1.642c-.398-.707-.597-1.506-.597-2.395 0-.89.199-1.682.597-2.377a4.257 4.257 0 0 1 1.689-1.642c.728-.4 1.547-.599 2.457-.599.91 0 1.723.2 2.44.599.727.387 1.29.935 1.688 1.642.41.695.614 1.488.614 2.377 0 .89-.204 1.688-.614 2.395a4.263 4.263 0 0 1-1.689 1.642c-.716.387-1.53.581-2.44.581Zm0-1.796c.796 0 1.444-.256 1.945-.77.5-.524.75-1.208.75-2.052 0-.844-.25-1.522-.75-2.035-.501-.525-1.15-.787-1.945-.787-.796 0-1.445.262-1.945.787-.5.513-.75 1.191-.75 2.035 0 .844.25 1.528.75 2.052.5.514 1.148.77 1.945.77Zm8.086-7.269h-1.467v8.894h1.962v-5.25c0-1.175.58-1.762 1.74-1.762h1.126l-.171-1.882h-.375c-.558 0-1.035.097-1.433.29-.387.195-.723.525-1.007.993l-.375-1.283ZM102.3 26.68c0 .172-.011.382-.034.633h-7.131c.09.696.375 1.255.853 1.676.477.41 1.086.616 1.825.616.5 0 .95-.097 1.348-.29.41-.195.722-.457.938-.787l1.843.307a3.645 3.645 0 0 1-1.655 1.899c-.774.445-1.638.667-2.593.667-.887 0-1.684-.194-2.389-.581a4.36 4.36 0 0 1-1.638-1.642c-.386-.707-.58-1.506-.58-2.395 0-.89.194-1.682.58-2.377a4.203 4.203 0 0 1 1.638-1.642c.705-.4 1.502-.599 2.389-.599.887 0 1.677.2 2.371.599a4.086 4.086 0 0 1 1.638 1.625c.398.684.597 1.448.597 2.291Zm-4.606-2.804a2.47 2.47 0 0 0-1.553.513c-.432.342-.728.803-.887 1.385h4.913a2.625 2.625 0 0 0-.92-1.368c-.433-.354-.95-.53-1.553-.53Z" clip-rule="evenodd" /><path d="M39 15.791v-2.715h.209a.792.792 0 0 0 .536-.189c.146-.132.269-.361.368-.686.106-.331.19-.789.249-1.372L40.74 7h4.343v6.076h1.044v2.695h-1.044v-1.76h-5.04v1.78H39Zm1.78-2.715h3.23V7.935h-2.306l-.288 2.953c-.06.604-.14 1.068-.24 1.393-.092.324-.224.573-.397.745v.05Zm8.572 1.064c-.49 0-.921-.112-1.292-.338a2.217 2.217 0 0 1-.855-.954c-.2-.418-.298-.909-.298-1.472 0-.557.099-1.041.298-1.452.199-.418.483-.736.855-.955.37-.225.801-.338 1.292-.338.49 0 .918.113 1.282.338.371.219.656.537.855.955.199.41.298.895.298 1.452 0 .563-.1 1.054-.298 1.472-.199.41-.484.729-.855.954-.364.226-.792.338-1.282.338Zm0-.875c.43 0 .769-.166 1.014-.497.245-.338.368-.802.368-1.392 0-.584-.123-1.041-.368-1.373-.245-.331-.583-.497-1.014-.497-.43 0-.769.166-1.014.497-.245.332-.368.79-.368 1.373 0 .59.123 1.054.368 1.392.245.331.583.497 1.014.497Zm5.92.875c-.497 0-.93-.112-1.302-.338a2.217 2.217 0 0 1-.855-.954c-.198-.418-.298-.905-.298-1.462 0-.557.1-1.045.298-1.462.2-.418.48-.736.845-.955.371-.225.809-.338 1.312-.338.557 0 1.028.136 1.412.408.391.265.646.646.765 1.143h-1.063c-.219-.45-.58-.676-1.084-.676-.45 0-.802.166-1.053.497-.246.332-.368.793-.368 1.383s.122 1.05.368 1.382c.251.331.606.497 1.063.497.279 0 .52-.066.726-.199a.97.97 0 0 0 .417-.567h1.064a1.98 1.98 0 0 1-.795 1.204c-.404.292-.888.437-1.452.437Zm5.535-.129h-1.024V9.635h-1.71V8.76h4.444v.875h-1.71v4.376Zm6.238-5.251h1.044l-1.929 5.65c-.145.424-.301.749-.467.974a1.348 1.348 0 0 1-.616.478c-.245.093-.57.139-.974.139h-.398v-.905h.427c.22 0 .391-.023.517-.07a.641.641 0 0 0 .308-.238 2.38 2.38 0 0 0 .249-.507l.05-.14-2.147-5.38h1.103l1.501 4.008h.05l1.282-4.008Zm3.147 5.251h-1.024v-5.25h4.294v5.25H72.44V9.635h-2.247v4.376Zm8.266-3.103V8.76h1.024v5.251h-1.024v-2.228h-2.326v2.228h-1.024v-5.25h1.024v2.147h2.326Zm4.814 3.232c-.49 0-.92-.112-1.292-.338a2.217 2.217 0 0 1-.855-.954c-.199-.418-.298-.909-.298-1.472 0-.557.1-1.041.298-1.452.199-.418.484-.736.855-.955.371-.225.802-.338 1.292-.338s.918.113 1.283.338c.37.219.656.537.854.955.2.41.299.895.299 1.452 0 .563-.1 1.054-.299 1.472-.198.41-.483.729-.854.954-.365.226-.792.338-1.283.338Zm0-.875c.431 0 .769-.166 1.014-.497.245-.338.368-.802.368-1.392 0-.584-.123-1.041-.368-1.373-.245-.331-.583-.497-1.014-.497-.43 0-.768.166-1.014.497-.245.332-.367.79-.367 1.373 0 .59.122 1.054.367 1.392.246.331.584.497 1.014.497Zm9.703-2.019c.617.213.925.627.925 1.243 0 .465-.169.836-.507 1.114-.338.272-.792.408-1.362.408h-2.356v-5.25h2.297c.53 0 .954.125 1.272.377.325.245.487.57.487.975a1.1 1.1 0 0 1-.199.656 1.26 1.26 0 0 1-.556.428v.05ZM90.7 9.586v1.312h1.253c.232 0 .414-.06.546-.179a.597.597 0 0 0 .21-.477.597.597 0 0 0-.21-.477c-.139-.12-.321-.18-.546-.18H90.7Zm1.312 3.6c.265 0 .474-.07.627-.21a.703.703 0 0 0 .238-.556.674.674 0 0 0-.238-.547c-.153-.14-.362-.209-.627-.209H90.7v1.522h1.312Z" /><path fill-rule="evenodd" d="M19.52 32c-5.43 0-8.146 0-9.833-1.688C8 28.625 8 25.91 8 20.48v-.96c0-5.43 0-8.146 1.687-9.833C11.374 8 14.089 8 19.52 8h.96c5.43 0 8.145 0 9.832 1.687C32 11.374 32 14.089 32 19.52v.96c0 5.43 0 8.145-1.688 9.832C28.625 32 25.91 32 20.48 32h-.96Zm5.387-8.453 1.622.405a1.162 1.162 0 0 0 1.447-1.122v-7.816c0-.663-.454-1.242-1.1-1.403l-4.652-1.162a1.162 1.162 0 0 0-1.446 1.123v1.409l-2.93-.732A1.162 1.162 0 0 0 16.4 15.37v1.41l-2.93-.733a1.162 1.162 0 0 0-1.447 1.123v7.815c0 .664.453 1.242 1.1 1.404l4.651 1.161a1.162 1.162 0 0 0 1.447-1.122v-7.804c0-.66-.417-1.042-.568-1.16a.07.07 0 0 1-.016-.093.082.082 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.969a.473.473 0 0 0 .317.43l1.646.411a1.162 1.162 0 0 0 1.447-1.123v-7.803c0-.66-.416-1.042-.567-1.159a.07.07 0 0 1-.016-.094.083.083 0 0 1 .091-.033c.613.185 1.2.813 1.258 1.603l.202 5.968a.47.47 0 0 0 .34.436Z" clip-rule="evenodd" /></symbol>',126,40,!1,void 0)},727980:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon48PlayButton","play_button_48","0 0 48 48",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 48 48" id="play_button_48"><path fill="currentColor" fill-rule="evenodd" d="M24 48c13.255 0 24-10.745 24-24S37.255 0 24 0 0 10.745 0 24s10.745 24 24 24z" clip-rule="evenodd" opacity=".4" /><path fill="#fff" d="M31.65 21.922c1.181.682 1.772 1.023 1.97 1.468a1.5 1.5 0 0 1 0 1.22c-.198.445-.789.786-1.97 1.468L21.6 31.881c-1.181.682-1.772 1.023-2.257.972a1.5 1.5 0 0 1-1.056-.61C18 31.849 18 31.166 18 29.803V18.197c0-1.364 0-2.047.287-2.44a1.5 1.5 0 0 1 1.056-.611c.485-.05 1.076.29 2.257.972l10.05 5.803z" /></symbol>',48,48,!1,void 0)},107359:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon56LogoSferumColor","logo_sferum_color_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="logo_sferum_color_56"><path fill="#07F" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_a)" d="M0 26.623C0 14.073 0 7.798 3.899 3.899 7.798 0 14.073 0 26.623 0h2.754c12.55 0 18.825 0 22.724 3.899C56 7.798 56 14.073 56 26.623v2.754c0 12.55 0 18.825-3.899 22.724C48.202 56 41.927 56 29.377 56h-2.754c-12.55 0-18.825 0-22.724-3.899C0 48.202 0 41.927 0 29.377v-2.754Z" /><path fill="url(#logo_sferum_color_56_b)" d="M41.468 19.586c-.898-.897-2.067-1.436-3.412-1.643-.206-1.344-.745-2.513-1.642-3.411-6.042-6.043-15.84-6.043-21.882 0-6.043 6.042-6.043 15.84 0 21.882.898.898 2.067 1.436 3.411 1.643.207 1.345.745 2.514 1.643 3.411 6.042 6.043 15.84 6.043 21.882 0 6.043-6.042 6.043-15.84 0-21.882Z" /><path fill="url(#logo_sferum_color_56_c)" d="M24.12 24.12c4.51-4.511 9.98-6.785 13.937-6.177-.206-1.344-.745-2.514-1.642-3.411-3.539-3.539-11.306-1.51-17.348 4.534-6.043 6.042-8.073 13.81-4.534 17.348.898.898 2.067 1.436 3.411 1.643-.609-3.956 1.665-9.427 6.176-13.938Z" /><defs><radialGradient id="logo_sferum_color_56_a" cx="0" cy="0" r="1" gradientTransform="matrix(29.98957 -32.53844 17.18804 15.84163 27.683 27.922)" gradientUnits="userSpaceOnUse"><stop offset=".281" stop-color="#4BF9E8" /><stop offset=".319" stop-color="#41D8D3" /><stop offset=".384" stop-color="#32A4B2" /><stop offset=".451" stop-color="#247696" /><stop offset=".518" stop-color="#19517E" /><stop offset=".584" stop-color="#11356C" /><stop offset=".65" stop-color="#0B205F" /><stop offset=".716" stop-color="#071458" /><stop offset=".779" stop-color="#061055" /></radialGradient><radialGradient id="logo_sferum_color_56_c" cx="0" cy="0" r="1" gradientTransform="rotate(-128.972 23.696 8.511) scale(13.7017 20.209)" gradientUnits="userSpaceOnUse"><stop stop-color="#0B25CE" /><stop offset=".486" stop-color="#2C93DB" /><stop offset=".838" stop-color="#42DCE4" /><stop offset="1" stop-color="#4BF9E8" /></radialGradient><linearGradient id="logo_sferum_color_56_b" x1="16.716" x2="39.042" y1="37.874" y2="18.339" gradientUnits="userSpaceOnUse"><stop stop-color="#0000C9" /><stop offset=".128" stop-color="#2006C9" /><stop offset=".322" stop-color="#4A0EC8" /><stop offset=".511" stop-color="#6B14C8" /><stop offset=".691" stop-color="#8318C7" /><stop offset=".858" stop-color="#911BC7" /><stop offset="1" stop-color="#961CC7" /></linearGradient></defs></symbol>',56,56,!1,void 0)},944587:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon64PauseButton","pause_button_64","0 0 64 64",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 64 64" id="pause_button_64"><path fill="#000" fill-rule="evenodd" d="M32 64c17.673 0 32-14.327 32-32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32z" clip-rule="evenodd" opacity=".4" /><path fill="#fff" fill-rule="evenodd" d="M22.183 20.915C22 21.273 22 21.742 22 22.68v18.64c0 .938 0 1.407.183 1.765.16.316.416.572.732.732.358.183.827.183 1.765.183h2.14c.938 0 1.407 0 1.765-.183a1.66 1.66 0 0 0 .732-.732c.183-.358.183-.827.183-1.765V22.68c0-.938 0-1.407-.183-1.765a1.675 1.675 0 0 0-.732-.732C28.227 20 27.758 20 26.82 20h-2.14c-.938 0-1.407 0-1.765.183a1.66 1.66 0 0 0-.732.732zm13 0C35 21.273 35 21.742 35 22.68v18.64c0 .938 0 1.407.183 1.765.16.316.416.572.732.732.358.183.827.183 1.765.183h2.14c.938 0 1.407 0 1.765-.183a1.66 1.66 0 0 0 .732-.732c.183-.358.183-.827.183-1.765V22.68c0-.938 0-1.407-.183-1.765a1.675 1.675 0 0 0-.732-.732C41.227 20 40.758 20 39.82 20h-2.14c-.938 0-1.407 0-1.765.183a1.66 1.66 0 0 0-.732.732z" clip-rule="evenodd" /></symbol>',64,64,!1,void 0)},114332:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon64PlayButton","play_button_64","0 0 64 64",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 64 64" id="play_button_64"><path fill="#000" fill-rule="evenodd" d="M32 64c17.673 0 32-14.327 32-32C64 14.327 49.673 0 32 0 14.327 0 0 14.327 0 32c0 17.673 14.327 32 32 32z" clip-rule="evenodd" opacity=".4" /><path fill="#fff" fill-rule="evenodd" d="M24 22.023a1.5 1.5 0 0 1 2.267-1.29L43.023 30.7a1.5 1.5 0 0 1 .001 2.578l-16.756 9.987A1.5 1.5 0 0 1 24 41.976V22.023z" clip-rule="evenodd" /></symbol>',64,64,!1,void 0)},265477:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon96LogoVkCallsColor","logo_vk_calls_color_96","0 0 96 96",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 96 96" id="logo_vk_calls_color_96"><path fill="#07F" d="M62.72 0C89.6 0 96 6.4 96 33.28v29.44C96 89.6 89.6 96 62.72 96H33.28C6.4 96 0 89.6 0 62.72V33.28C0 6.4 6.4 0 33.28 0h29.44Z" /><path fill="#77BEFF" d="M95.999 63.146c-.01 3.725-.146 7.051-.446 10.018a55.994 55.994 0 0 1-20.404 3.823c-10.73 0-20.756-3.01-29.281-8.232a2.563 2.563 0 0 0-2.38-.15c-5.3 2.357-11.26 3.594-17.93 4.13-1.841.148-3.08-1.8-2.29-3.471 2.633-5.574 4.358-10.617 5.41-15.635a2.41 2.41 0 0 0-.365-1.821c-5.877-8.875-9.3-19.516-9.3-30.957 0-7.198 1.355-14.08 3.823-20.404C25.916.135 29.382 0 33.28 0h29.44c26.77 0 33.227 6.348 33.279 32.952V63.146Z" /><path fill="#fff" d="M22.834.447a55.996 55.996 0 0 0-3.821 20.398c0 11.44 3.423 22.082 9.3 30.957a2.41 2.41 0 0 1 .365 1.821c-.758 3.618-1.866 7.25-3.413 11.083l-.004.01a77.91 77.91 0 0 1-.289.706 87.244 87.244 0 0 1-1.705 3.836c-.79 1.67.45 3.619 2.292 3.47a79.068 79.068 0 0 0 5.177-.584l.038-.006c4.605-.69 8.836-1.815 12.715-3.539.77-.342 1.66-.29 2.379.15 8.525 5.222 18.551 8.232 29.28 8.232 7.2 0 14.081-1.355 20.405-3.824-.356 3.523-.945 6.539-1.83 9.111A64.15 64.15 0 0 1 75.149 85c-11.245 0-21.833-2.9-31.036-7.995-5.64 2.12-11.655 3.215-17.913 3.718-8.562.687-13.358-8.176-10.183-14.892 2-4.232 3.376-8.019 4.303-11.659-5.918-9.717-9.326-21.135-9.326-33.327 0-6.448.953-12.683 2.729-18.565 2.572-.886 5.588-1.476 9.11-1.833Z" /><path fill="#fff" fill-rule="evenodd" d="M43.164 15.03c2.618-.308 4.793 1.844 6.05 4.356l1.408 2.817a6.894 6.894 0 0 1-2.664 9.022c-.501.296-.659.952-.333 1.44a56.82 56.82 0 0 0 7.084 8.626 56.826 56.826 0 0 0 8.626 7.084 1.017 1.017 0 0 0 1.44-.333 6.894 6.894 0 0 1 9.022-2.664l2.817 1.409c2.512 1.256 4.664 3.431 4.357 6.05-.165 1.403-.744 2.65-1.81 3.717-2.702 2.701-7.448 3.134-12.984 1.453-5.518-1.675-11.729-5.428-17.242-10.942-5.514-5.513-9.267-11.724-10.942-17.242-1.68-5.536-1.248-10.282 1.453-12.984 1.066-1.066 2.313-1.645 3.718-1.81Z" clip-rule="evenodd" /></symbol>',96,96,!1,void 0)},480538:(e,t,a)=>{"use strict";a.d(t,{default:()=>n});const n=(0,a(825028).makeIcon)("Icon96LogoVkMeColor","logo_vk_me_color_96","0 0 96 96",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 96 96" id="logo_vk_me_color_96"><g fill="none"><path fill="#07F" d="M0 45.64C0 24.124 0 13.366 6.684 6.683 13.367 0 24.124 0 45.639 0h4.722c21.514 0 32.272 0 38.955 6.684C96 13.367 96 24.124 96 45.639v4.722c0 21.514 0 32.272-6.684 38.955C82.633 96 71.876 96 50.361 96h-4.722c-21.514 0-32.272 0-38.955-6.684C0 82.633 0 71.876 0 50.361v-4.722z" /><path fill="#00EAFF" d="M89.316 6.684c5.873 5.873 6.586 14.892 6.672 31.591v5.989l-.001.489-.001 3.662v.428l-.001 4.603v4.844l-.003.462C86.262 71.933 71.612 81.257 54.753 84V69.722C30.161 67.122 11 46.317 11 21.036a48.807 48.807 0 0 1 3.829-19.013C20.974.186 29.449.017 41.769.002H54.23c18.96.024 28.815.411 35.085 6.682z" /><circle cx="32" cy="30" r="8" fill="#FFF" /><circle cx="55" cy="30" r="8" fill="#FFF" /><circle cx="78" cy="30" r="8" fill="#FFF" /></g></symbol>',96,96,!1,void 0)},337057:(e,t,a)=>{"use strict";a.d(t,{VkIndexer:()=>n});var n=function(){function e(e,t,a){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=a||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var a=this.list[t];try{a._order=t}catch(e){}this.add(a)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,a={},n=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(a=t)?1:parseInt(a)||0)>=32?String.fromCharCode(t):e;var a})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),o=n.length;o--;){var i=n[o],r="";if(i){for(var s=0;s<6;s++){var l=i.charCodeAt(s);if(l){var c=this.toTranslit[l],d=i.substr(s,1);r+=null!=c?c:d}}a[r]=1}}return a},e.prototype.strToSearchPrefixes=function(e){for(var t=[],a=e.toLowerCase().split(this.delimiter),n=a.length;n--;){var o={},i=a[n],r="",s="",l="",c=i.length>1;if(i){for(var d=0;d<6;d++){var u=i.charCodeAt(d);if(u){var p=this.toTranslit[u],_=i.substr(d,1);if(r+=null!=p?p:_,c){var m=this.toLocalCase[_],h=this.toLocalTranslit[u];s+=null!=m?m:_,l+=null!=h?h:_}}}o[r]=1,c&&(o[s]=2,o[l]=3),t.push(o)}}return t},e.prototype.toIndexTree=function(e,t){for(var a=this.index,n=0;n<6;n++){var o=e.substr(n,1)||-1;a=a[o]?a[o]:a[o]=5==n?[]:{}}a.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),a=this.strToPrefixes(t);for(var n in a)if(a.hasOwnProperty(n)){for(var o=this.index,i=0;i<6;i++){var r=n.substr(i,1)||-1;if(!o[r])break;o=o[r]}if(o.length)for(var i in o)if(this.equals(o[i],e)){o.splice(i,1);break}}},e.prototype.equals=function(e,t){for(var a in e)if(e.hasOwnProperty(a))switch(typeof e[a]){case"object":if(!this.equals(e[a],t[a]))return!1;break;case"function":if(void 0===e[a]||e[a].toString()!=t[a].toString())return!1;break;default:if(e[a]!=t[a])return!1}for(var a in t)if(void 0===t[a])return!1;return!0},e.prototype.intersect=function(e,t){var a=[];if(o(e[0])||o(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var n=e.shift();n&&a.push(n)}t.shift()}return a},e.prototype.add=function(e){var t=this.prepareFunc(e),a=this.strToPrefixes(t);for(var n in a)a.hasOwnProperty(n)&&this.toIndexTree(n,e)},e.prototype.search=function(e){var t=this.index,a=this.strToSearchPrefixes(e),n=[],o=!1;for(var i in a)if(a.hasOwnProperty(i)){if(o&&!n)break;var r=this.localSearch(a[i],0,t);r.sort((function(e,t){return e._order-t._order})),n=o?this.intersect(n,r):r,o=!0}for(var s=n[0],l=n.length+1,c=[],d=1;d<l;d++){var u=n[d];u!=s&&(c.push(s),s=u)}return c},e.prototype.localSearch=function(e,t,a){if(!a)return[];var n={};for(var o in e)e.hasOwnProperty(o)&&(n[r=o.substr(t,1)||-1]||(n[r]={}),n[r][o]=1);if(6==t++)return a;var i=[];for(var r in n)if("-1"===r)for(var s in a)a.hasOwnProperty(s)&&i.push.apply(i,this.localSearch(n[r],t,a[s]));else{var l=this.localSearch(n[r],t,a[r]);i.push.apply(i,l)}return i},e}();function o(e){return!isNaN(e)}},465127:(e,t,a)=>{"use strict";a.d(t,{BlurFastWithMask:()=>W,EffectBackground:()=>z,EffectBlur:()=>Z,ImageEdit:()=>v,Segmentation:()=>P,VideoEffects:()=>w,isSupported:()=>C});var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])},n(e,t)};function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function a(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)}function i(e,t,a,n){return new(a||(a=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))}function r(e,t){var a,n,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(a)throw new TypeError("Generator is already executing.");for(;r;)try{if(a=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return r.label++,{value:i[1],done:!1};case 5:r.label++,n=i[1],i=[0];continue;case 7:i=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){r=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){r.label=i[1];break}if(6===i[0]&&r.label<o[1]){r.label=o[1],o=i;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(i);break}o[2]&&r.ops.pop(),r.trys.pop();continue}i=t.call(e,r)}catch(e){i=[6,e],n=0}finally{a=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var s,l=function(e,t){void 0===t&&(t=[]);var a=t.join(","),n=new Blob(["("+e+")("+a+");"],{type:"application/javascript; charset=utf-8"});return window.URL.createObjectURL(n)};!function(e){e.IE="IE",e.Safari="Safari",e.Chrome="Chrome",e.Edge="Edge",e.Firefox="Firefox",e.Yandex="Yandex",e.Opera="Opera",e.Sferum="Sferum"}(s||(s={}));var c,d,u,p,_,m,h,g=(c=navigator.appVersion,d=navigator.appName,u=navigator.userAgent,p=[],function(){return p.length?p:p=function(){var e,t=!1,a=0,n=u.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(n[1]))return e=/\brv[ :]+(\d+)/g.exec(u),[s.IE,e&&e[1]||"Unknown",t,a];if("Safari"===n[1]){if(e=u.match(/\bEdge\/(\d+)/))return[s.Edge,e[1]||"Unknown",t,a];if(e=u.match(/\bCriOS\/(\d+)/))return[s.Chrome,e[1],!0,+e[1]];if(e=u.match(/\bFxiOS\/(\d+)/))return[s.Firefox,e[1],!1,a];if(e=u.match(/\bYaBrowser\/(\d+)/))return[s.Yandex,e[1],!1,a];if(e=u.match(/\bOPT\/(\d+)/))return[s.Opera,e[1],!1,a]}if(n[1]===s.Chrome){if(t=!0,a=Number(n[2]),e=u.match(/\bOPR\/(\d+)/))return[s.Opera,e[1]||"Unknown",t,a];if(e=u.match(/\bYaBrowser\/(\d+)/))return[s.Yandex,e[1]||"Unknown",t,a];if(e=u.match(/\bSferum\/((\d+)(?:\.\d+)*)/))return[s.Sferum,e[1]||"Unknown",t,a];if(e=u.match(/\bEdge?\/(\d+)/))return[s.Edge,e[1]||"Unknown",t,a];if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return[s.Opera,"Hidden",t,a]}return e=u.match(/version\/(\d+)/i),[n[2]?n[1]:d,e&&e[1]||n[2]||c,t,a]}()}),A=function(e){return i(void 0,void 0,void 0,(function(){return r(this,(function(t){return[2,new Promise((function(t,a){var n=document.createElement("img");n.crossOrigin="anonymous",n.onerror=function(e){a("Failed image loading: "+e)},n.onload=function(){return t(n)},n.src=e}))]}))}))},C=function(){try{var e=window,t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.captureStream&&e.CanvasCaptureMediaStreamTrack&&!0,a=g()[0]===s.Safari;return t&&!a}catch(e){return!1}},v=function(){function e(){this._backgroundCanvas=document.createElement("canvas")}return e.prototype.resize=function(e,t,a,n){var o,i,r=(void 0===n?{}:n).ctxOptions,s=(i={width:0,height:0},"number"==typeof(o=e).width&&"number"==typeof o.height&&(i.height=o.height,i.width=o.width),i),l=s.height,c=s.width,d=this._backgroundCanvas,u=d.getContext("2d",r);if(!u)throw new Error("ctx did not initialized");d.width=t,d.height=a;var p=Math.max(d.width/c,d.height/l),_=d.width/2-c/2*p,m=d.height/2-l/2*p;return u.drawImage(e,_,m,c*p,l*p),d},e}(),f=(_=function(e,t){e.exports=function(e){var t,a,n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,o=void 0!==(e=e||{})?e:{};o.ready=new Promise((function(e,n){t=e,a=n}));var i,r={};for(i in o)o.hasOwnProperty(i)&&(r[i]=o[i]);var s="./this.program",l=function(e,t){throw t},c="";"undefined"!=typeof document&&document.currentScript&&(c=document.currentScript.src),void 0!==n&&n&&(c=n),c=0!==c.indexOf("blob:")?c.substr(0,c.lastIndexOf("/")+1):"";var d,u=o.print||console.log.bind(console),p=o.printErr||console.warn.bind(console);for(i in r)r.hasOwnProperty(i)&&(o[i]=r[i]);r=null,o.arguments,o.thisProgram&&(s=o.thisProgram),o.quit&&(l=o.quit),o.wasmBinary&&(d=o.wasmBinary);var _,m=o.noExitRuntime||!0;"object"!=typeof WebAssembly&&R("no native wasm support detected");var h,g,A,C,v,f=!1,S="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function E(e,t,a){for(var n=t+a,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.subarray&&S)return S.decode(e.subarray(t,o));for(var i="";t<o;){var r=e[t++];if(128&r){var s=63&e[t++];if(192!=(224&r)){var l=63&e[t++];if((r=224==(240&r)?(15&r)<<12|s<<6|l:(7&r)<<18|s<<12|l<<6|63&e[t++])<65536)i+=String.fromCharCode(r);else{var c=r-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&r)<<6|s)}else i+=String.fromCharCode(r)}return i}function T(e){h=e,o.HEAP8=g=new Int8Array(e),o.HEAP16=new Int16Array(e),o.HEAP32=C=new Int32Array(e),o.HEAPU8=A=new Uint8Array(e),o.HEAPU16=new Uint16Array(e),o.HEAPU32=new Uint32Array(e),o.HEAPF32=new Float32Array(e),o.HEAPF64=new Float64Array(e)}o.INITIAL_MEMORY;var I,y,N,b=[],x=[],M=[],O=0,P=null;function R(e){o.onAbort&&o.onAbort(e),p(e+=""),f=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw a(t),t}function k(e){return e.startsWith("data:application/octet-stream;base64,")}function w(e){try{if(e==I&&d)return new Uint8Array(d);throw"both async and sync fetching of the wasm failed"}catch(e){R(e)}}function D(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var a=t.func;"number"==typeof a?void 0===t.arg?v.get(a)():v.get(a)(t.arg):a(void 0===t.arg?null:t.arg)}else t(o)}}function L(e){try{return _.grow(e-h.byteLength+65535>>>16),T(_.buffer),1}catch(e){}}o.preloadedImages={},o.preloadedAudios={},k(I="https://st.mycdn.me/static/callseffects/0-0-3/tflite-simd.wasm")||(y=I,I=o.locateFile?o.locateFile(y,c):c+y),N=function(){return performance.now()};var j={};function B(){if(!B.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var t in j)void 0===j[t]?delete e[t]:e[t]=j[t];var a=[];for(var t in e)a.push(t+"="+e[t]);B.strings=a}return B.strings}var U={mappings:{},buffers:[null,[],[]],printChar:function(e,t){var a=U.buffers[e];0===t||10===t?((1===e?u:p)(E(a,0)),a.length=0):a.push(t)},varargs:void 0,get:function(){return U.varargs+=4,C[U.varargs-4>>2]},getStr:function(e){var t=function(e,t){return e?E(A,e,void 0):""}(e);return t},get64:function(e,t){return e}},H={a:function(){R()},m:function(e,t){var a;if(0===e)a=Date.now();else{if(1!==e&&4!==e)return 28,C[V()>>2]=28,-1;a=N()}return C[t>>2]=a/1e3|0,C[t+4>>2]=a%1e3*1e3*1e3|0,0},i:function(e,t){R("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},c:function(e,t){R("To use dlopen, you need to use Emscripten's linking support, see https://github.com/emscripten-core/emscripten/wiki/Linking")},g:function(){return 2147483648},k:function(e,t,a){A.copyWithin(e,t,t+a)},l:function(e){var t,a=A.length,n=2147483648;if((e>>>=0)>n)return!1;for(var o=1;o<=4;o*=2){var i=a*(1+.2/o);if(i=Math.min(i,e+100663296),L(Math.min(n,((t=Math.max(e,i))%65536>0&&(t+=65536-t%65536),t))))return!0}return!1},d:function(e){for(var t=N();N()-t<e;);},e:function(e,t){var a=0;return B().forEach((function(n,o){var i=t+a;C[e+4*o>>2]=i,function(e,t,a){for(var n=0;n<e.length;++n)g[t++>>0]=e.charCodeAt(n);g[t>>0]=0}(n,i),a+=n.length+1})),0},f:function(e,t){var a=B();C[e>>2]=a.length;var n=0;return a.forEach((function(e){n+=e.length+1})),C[t>>2]=n,0},o:function(e){!function(e,t){var a;a=e,m||(o.onExit&&o.onExit(a),f=!0),l(a,new G(a))}(e)},h:function(e){return 0},j:function(e,t,a,n,o){},b:function(e,t,a,n){for(var o=0,i=0;i<a;i++){for(var r=C[t+8*i>>2],s=C[t+(8*i+4)>>2],l=0;l<s;l++)U.printChar(e,A[r+l]);o+=s}return C[n>>2]=o,0},n:function e(t,a){e.randomDevice||(e.randomDevice=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var e=new Uint8Array(1);return function(){return crypto.getRandomValues(e),e[0]}}return function(){R("randomDevice")}}());for(var n=0;n<a;n++)g[t+n>>0]=e.randomDevice();return 0}};!function(){var e={a:H};function t(e,t){var a,n=e.exports;o.asm=n,T((_=o.asm.p).buffer),v=o.asm.A,a=o.asm.q,x.unshift(a),function(e){if(O--,o.monitorRunDependencies&&o.monitorRunDependencies(O),0==O&&P){var t=P;P=null,t()}}()}function n(e){t(e.instance)}function i(t){return(d||"function"!=typeof fetch?Promise.resolve().then((function(){return w(I)})):fetch(I,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+I+"'";return e.arrayBuffer()})).catch((function(){return w(I)}))).then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){p("failed to asynchronously prepare wasm: "+e),R(e)}))}if(O++,o.monitorRunDependencies&&o.monitorRunDependencies(O),o.instantiateWasm)try{return o.instantiateWasm(e,t)}catch(e){return p("Module.instantiateWasm callback failed with error: "+e),!1}(d||"function"!=typeof WebAssembly.instantiateStreaming||k(I)||"function"!=typeof fetch?i(n):fetch(I,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return p("wasm streaming compile failed: "+e),p("falling back to ArrayBuffer instantiation"),i(n)}))}))).catch(a)}(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.q).apply(null,arguments)},o._setNumThreads=function(){return(o._setNumThreads=o.asm.r).apply(null,arguments)},o._getModelBufferMemoryOffset=function(){return(o._getModelBufferMemoryOffset=o.asm.s).apply(null,arguments)},o._getInputMemoryOffset=function(){return(o._getInputMemoryOffset=o.asm.t).apply(null,arguments)},o._getOutputMemoryOffset=function(){return(o._getOutputMemoryOffset=o.asm.u).apply(null,arguments)},o._getInputDim=function(){return(o._getInputDim=o.asm.v).apply(null,arguments)},o._getOutputDim=function(){return(o._getOutputDim=o.asm.w).apply(null,arguments)},o._loadModel=function(){return(o._loadModel=o.asm.x).apply(null,arguments)},o._updateRecurrentState=function(){return(o._updateRecurrentState=o.asm.y).apply(null,arguments)},o._runInference=function(){return(o._runInference=o.asm.z).apply(null,arguments)};var F,V=o.___errno_location=function(){return(V=o.___errno_location=o.asm.B).apply(null,arguments)};function G(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function W(e){function a(){F||(F=!0,o.calledRun=!0,f||(D(x),t(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)e=o.postRun.shift(),M.unshift(e);var e;D(M)}()))}O>0||(function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)e=o.preRun.shift(),b.unshift(e);var e;D(b)}(),O>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),a()}),1)):a()))}if(P=function e(){F||W(),F||(P=e)},o.run=W,o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();return W(),e.ready}},_(m={exports:{}}),m.exports),S="https://st.mycdn.me/static/callseffects",E=S+"/0-0-3",T=S+"/0-0-5",I=S+"/0-0-6",y=S+"/0-0-8",N=S+"/0-0-9",b=S+"/0-0-12",x=S+"/0-0-13",M={segmentation:{models:{"192x256":E+"/segmentation-model.tflite"},wasm:{tfliteSimd:E+"/tflite-simd.wasm"}},backgrounds:[{id:3012,preview:T+"/3012-preview.png",original:T+"/3012-original.jpg",description:"elephant in the white room",tags:["default"]},{id:3013,preview:T+"/3013-preview.png",original:T+"/3013-original.jpg",description:"old native stove in russian historic house",tags:["default"]},{id:3014,preview:T+"/3014-preview.png",original:T+"/3014-original.jpg",description:"flying baloons surrounded by mountains",tags:["default"]},{id:3015,preview:T+"/3015-preview.png",original:T+"/3015-original.jpg",description:"two pilots driving a plate",tags:["default"]},{id:3016,preview:T+"/3016-preview.png",original:T+"/3016-original.jpg",description:"sauna",tags:["default"]},{id:3017,preview:T+"/3017-preview.png",original:T+"/3017-original.jpg",description:"red chairs in movie theater",tags:["default"]},{id:3018,preview:T+"/3018-preview.png",original:T+"/3018-original.jpg",description:"sleeping person in train cart",tags:["default"]},{id:3019,preview:T+"/3019-preview.jpg",original:T+"/3019-original.jpg",description:"Little Big icons on pink background",tags:["star"]},{id:3020,preview:T+"/3020-preview.jpg",original:T+"/3020-original.jpg",description:"Violet wild mint (2 colors split background)",tags:["star"]},{id:3021,preview:T+"/3021-preview.jpg",original:T+"/3021-original.jpg",description:"Klava Koka left the chat and in love with MDK",tags:["star"]},{id:3022,preview:T+"/3022-preview.jpg",original:T+"/3022-original.jpg",description:"Some half-naked dude with rifle",tags:["star"]},{id:3023,preview:T+"/3023-preview.jpg",original:T+"/3023-original.jpg",description:'"Cirle" photo collage',tags:["star"]},{id:3024,preview:T+"/3024-preview.jpg",original:T+"/3024-original.jpg",description:"Gazgolder & red carpet on the wall",tags:["star"]},{id:3025,preview:T+"/3025-preview.jpg",original:T+"/3025-original.jpg",description:"Gazgolder & VK Clips collab pink-yellow-blue collage",tags:["star"]},{id:3026,preview:T+"/3026-preview.jpg",original:T+"/3026-original.jpg",description:"Crem Soda people collage",tags:["star"]},{id:3027,preview:T+"/3027-preview.jpg",original:T+"/3027-original.jpg",description:"Dmitry Glukhovsky collage",tags:["star"]},{id:3028,preview:I+"/3028-preview.jpeg",original:I+"/3028-original.jpeg",description:"Dogs in space",tags:["cosmonautics-day-2022"]},{id:3029,preview:y+"/3029-preview.jpg",original:y+"/3029-original.jpg",description:"Blackboard with e=mc2 formulas",tags:["teachers-day-2022"]},{id:3030,preview:N+"/3030-preview.jpg",original:N+"/3030-original.jpg",description:"vk 2022 birthday",tags:["vk-2022-birthday"]},{id:3031,preview:b+"/3031-preview.png",original:b+"/3031-original.png",description:"vk 2022 mothers day",tags:["vk-2022-mothers-day"]},{id:3032,preview:x+"/3032-preview.png",original:x+"/3032-original.png",description:"vk 2022 new year",tags:["default"]},{id:3033,preview:x+"/3033-preview.png",original:x+"/3033-original.png",description:"vk 2023 lovers day",tags:["vk-2023-lovers-day"]}],icons:{starBackground:{id:"icon-star-background",description:"Icon for indicating that virtual background is from stars",url:T+"/icon-star-background.svg",type:"svg"}}},O=function(){function e(){}return e.workerFn=function(e){console.log("here goes the worker...");var t=null,a=!1,n={"192x256":[192,256]},o={processSizeKey:"192x256",inputMemoryOffset:0,outputMemoryOffset:0,maskArray:null,numThreads:2},i={log:function(){l.call(null,"log",Array.from(arguments))},warn:function(){l.call(null,"warn",Array.from(arguments))}};function r(r,l,c){return void 0===l&&(l={}),void 0===c&&(c=!1),a=c,i.log("[createModel]",r,l,{debugFlag:c}),e().then((function(e){return function(e,t){return i.log("[loadModel][modelPath]",e,t),fetch(t).then((function(e){return e.arrayBuffer()})).then((function(t){i.log("Model buffer size:",t.byteLength);var a=o.numThreads,n=e._getModelBufferMemoryOffset();return i.log("Model buffer memory offset:",n),i.log("Loading model buffer..."),e.HEAPU8.set(new Uint8Array(t),n),i.log("_loadModel result:",e._loadModel(t.byteLength,a)),{inputMemoryOffset:e._getInputMemoryOffset(0)/4,outputMemoryOffset:e._getOutputMemoryOffset(0)/4}}))}(e,r).then((function(a){return t=e,a}))})).then((function(e){var t=l.processSizeKey||o.processSizeKey,a=n[t],i=a[0],r=a[1],c=new Float32Array(i*r);s(Object.assign({maskArray:c},e,l))})).catch((function(e){t=null,i.warn("simd error",e),self.postMessage({type:"error",error:e})}))}function s(e){Object.assign(o,e),i.log("settings updated",o)}function l(e,t){if(void 0===e&&(e="log"),"function"==typeof console[e]&&a){var n=["[segmentation-worker]"].concat(t);console[e].apply(null,n)}}self.onmessage=function(e){try{switch(e.data.type){case"create":r(e.data.modelPath,e.data.settings,e.data.debug).then((function(){self.postMessage({type:"ready"})}));break;case"frame":var a=function(e){var a=o.maskArray,r=o.inputMemoryOffset,s=o.outputMemoryOffset,l=n[o.processSizeKey],c=l[0],d=l[1];if(t){if(a){for(var u=0,p=0;u<c*d;u++,p+=4)t.HEAPF32[r+p]=e.data[p]/255,t.HEAPF32[r+p+1]=e.data[p+1]/255,t.HEAPF32[r+p+2]=e.data[p+2]/255,t.HEAPF32[r+p+3]=a[u];t._runInference(),t._updateRecurrentState(1,1);var _=new ImageData(d,c);for(u=0,p=0;u<c*d;u++,p+=4)a[u]=t.HEAPF32[s+u],_.data[p+3]=255*a[u];return _}i.warn("no maskArray created")}else i.warn("no tfliteSIMD instance!")}(e.data.imageData);a&&self.postMessage({type:"frame",segmentationMask:a,resizedImage:e.data.imageData},[a.data.buffer,e.data.imageData.data.buffer]);break;case"params":s(e.data.params);break;default:i.warn("unhandled event",e.data)}}catch(e){i.warn("onmessage error",e),self.postMessage({type:"error",error:e})}}},e}(),P=function(){function e(e){var t=this,a=e.onFrame,n=e.onReady,o=e.onError;this._settings={modelKey:"192x256",processSizeKey:"192x256"},this._processSize={"192x256":[192,256]},this._worker=null,this._worker=new Worker(l(O.workerFn,[f,JSON.stringify({})])),this._worker.onmessage=function(e){switch(e.data.type){case"ready":n(t);break;case"frame":a({image:t._canvasImageBackup,resizedImage:e.data.resizedImage,segmentationMask:e.data.segmentationMask});break;case"error":null==o||o(e.data);break;default:console.warn("unhandled event type",e.data)}},this._canvas=document.createElement("canvas"),this._canvasImageBackup=document.createElement("canvas");var i=this._canvas.getContext("2d"),r=this._canvasImageBackup.getContext("2d");if(!i||!r)throw new Error("can't get ctx for canvas");this._ctx=i,this._ctxImageBackup=r}return e.prototype.createModel=function(e){var t,a=this._settings,n=M.segmentation.models[a.modelKey];null===(t=this._worker)||void 0===t||t.postMessage({type:"create",modelPath:n,settings:a,debug:e})},e.prototype.setParams=function(e){var t=this._worker,a=this._settings;Object.assign(a,e),null==t||t.postMessage({type:"params",params:a})},e.prototype.requestSegmentation=function(e){var t=this,a=t._settings,n=t._canvas,o=t._ctx,i=t._worker,r=t._processSize[a.processSizeKey],s=r[0],l=r[1];this._saveImage(e),n.width=l,n.height=s,o.drawImage(e,0,0,l,s);var c=o.getImageData(0,0,l,s);null==i||i.postMessage({type:"frame",imageData:c},[c.data.buffer])},e.prototype._saveImage=function(e){var t=this._ctxImageBackup,a=this._canvasImageBackup,n=function(e){var t={height:0,width:0};return"number"==typeof e.height?t.height=e.height:t.height=e.height.baseVal.value,"number"==typeof e.width?t.width=e.width:t.width=e.width.baseVal.value,t}(e),o=n.height,i=n.width;a.height=o,a.width=i,t.clearRect(0,0,i,o),t.drawImage(e,0,0,i,o)},e.prototype.destroy=function(){this._worker&&(this._worker.terminate(),this._worker=null)},e}(),R=function(){function e(){}return e.updateSegmentationParams=function(t){Object.assign(e._params.segmentation,t)},e.getSegmentationParams=function(){return e._params.segmentation},e.setDebug=function(t){e._params.debug=t},e.getDebug=function(){return!!e._params.debug},e._params={segmentation:{processSizeKey:"192x256",modelKey:"192x256"}},e}(),k=function(){function e(){this._timeouts=new Map,this._throttles=new Map,this._worker=new Worker(l(e.workerFn))}return e.prototype.initWorker=function(e){var t=void 0===e?{}:e,a=t.onError,n=t.onTimeout,o=t.onThrottle,s=t.onReady;return i(this,void 0,void 0,(function(){var e=this;return r(this,(function(t){return[2,new Promise((function(t,i){e._worker.addEventListener("message",(function(r){switch(r.data.type){case"timeout":e._callTimeout(r.data.id),null==n||n(r.data);break;case"throttle":e._callThrottle(r.data.id),null==o||o(r.data);break;case"error":null==a||a(r.data),i(r.data);break;case"ready":null==s||s(r.data),t()}})),e._worker.addEventListener("error",(function(e){null==a||a(e),i(e)})),e._worker.postMessage({type:"ready"})}))]}))}))},e.workerFn=function(){var e=new Map,t=new Map;self.onmessage=function(a){switch(a.data.type){case"timeout":!function(t,a){void 0===a&&(a=5);var n=setTimeout((function(){self.postMessage({type:"timeout",id:t}),e.delete(t)}),a);e.set(t,n)}(a.data.id,a.data.ms);break;case"throttle":!function(e,a){void 0===a&&(a=5);var n=t.get(e);n&&clearTimeout(n);var o=setTimeout((function(){self.postMessage({type:"throttle",id:e}),t.delete(e)}),a);t.set(e,o)}(a.data.id,a.data.ms);break;case"ready":self.postMessage({type:"ready"});break;default:self.postMessage({type:"error",data:a.data})}},self.postMessage({type:"ready"})},e.prototype.postTimeout=function(e,t,a){void 0===a&&(a=5),this._timeouts.set(e,t),this._worker.postMessage({type:"timeout",id:e,ms:a})},e.prototype.postThrottle=function(e,t,a){void 0===a&&(a=5),this._throttles.set(e,t),this._worker.postMessage({type:"throttle",id:e,ms:a})},e.prototype._callTimeout=function(e){var t=this._timeouts.get(e);t&&(this._timeouts.delete(e),t())},e.prototype._callThrottle=function(e){var t=this._throttles.get(e);t&&(this._throttles.delete(e),t())},e.prototype.destroy=function(){this._worker.terminate(),this._throttles.clear(),this._timeouts.clear()},e}();!function(e){e.NONE="none",e.BLUR="blur",e.BACKGROUND="background"}(h||(h={}));var w=function(){function e(e){var t=void 0===e?{}:e,a=t.segmentation,n=t.debug;this._effect=null,this._net=null,this._video=null,this._videoWaitTimeout=null,this._canvas=null,this._stream=null,this._track=null,this._sendNextFrame=null,this._timerWorker=null,a&&R.updateSegmentationParams(a),n&&R.setDebug(n)}return e.prototype._createDom=function(e){var t=function(e){var t,a,n=e.defaults,o=e.track,i=o.getSettings(),r=o.getConstraints(),s=n;return a=["width","height"],"object"==typeof(t=i)&&(Array.isArray(a)?a.every((function(e){return e in t})):a in t)||!function(e){return"object"==typeof e?Array.isArray(e)?!e.length:!Object.keys(e).length:"string"==typeof e?!e.length:!e}(r)?(i.height?s.height=i.height:"number"==typeof r.height?s.height=r.height:"object"==typeof r.height&&(s.height=r.height.exact||r.height.ideal||r.height.max||r.height.min||s.height),i.width?s.width=i.width:"number"==typeof r.width?s.width=r.width:"object"==typeof r.width&&(s.width=r.width.exact||r.width.ideal||r.width.max||r.width.min||s.width),s):s}({track:e,defaults:{height:360,width:640}}),a=t.width,n=t.height;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.height=n,this._canvas.width=a,this._canvas.style.bottom="0",this._canvas.style.left="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas)),this._video||(this._video=document.createElement("video"),this._video.controls=!1,this._video.autoplay=!1,this._video.preload="auto",this._video.muted=!0,this._video.style.pointerEvents="none",this._video.style.visibility="hidden",this._video.style.position="absolute",this._video.style.width="160px",this._video.style.height="90px",this._video.height=n,this._video.width=a,this._video.style.bottom="0",this._video.style.right="0",this._video.style.zIndex="5000",document.body.appendChild(this._video))},e.prototype._removeDom=function(){try{this._canvas&&document.body.removeChild(this._canvas),this._video&&document.body.removeChild(this._video)}catch(e){}this._canvas=null,this._video=null},e.prototype._createStream=function(e){return i(this,void 0,void 0,(function(){var t=this;return r(this,(function(a){if(!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._stream=this._canvas.captureStream(0),[2,new Promise((function(a,n){var o=t._video;o.srcObject=new MediaStream([e]),o.onloadeddata=function(){var e;o.width=o.videoWidth,o.height=o.videoHeight,t._track=null===(e=t._stream)||void 0===e?void 0:e.getVideoTracks()[0],t._videoWaitTimeout&&(window.clearTimeout(t._videoWaitTimeout),t._videoWaitTimeout=null),a()},o.onerror=function(){return n(new Error("Video element error"))},t._videoWaitTimeout=window.setTimeout((function(){t._videoWaitTimeout=null,n(new Error("Video element timeout"))}),3e3);var i=o.play(),r=function(){return n(new Error("Autoplay is disabled"))};i?i.catch(r):r()}))]}))}))},e.prototype._createNet=function(){return i(this,void 0,void 0,(function(){var e=this;return r(this,(function(t){return[2,new Promise((function(t,a){var n=R.getDebug()?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,e),a()}:void 0;new P({onFrame:function(t){e._drawFrame(t)},onReady:t,onError:n}).createModel(R.getDebug())}))]}))}))},e.prototype._removeStream=function(){this._stream&&(this._stream.getTracks().forEach((function(e){return e.stop()})),this._stream=null,this._track=null),this._video&&(this._video.pause(),this._video.srcObject=null),this._videoWaitTimeout&&(window.clearTimeout(this._videoWaitTimeout),this._videoWaitTimeout=null)},e.prototype._drawFrame=function(e){var t,a=this;this._net&&this._video&&this._effect&&this._canvas&&this._video&&this._effect&&(this._effect.draw(e),this._track&&(this._track.requestFrame(),null===(t=this._timerWorker)||void 0===t||t.postTimeout(Date.now(),(function(){a._video&&a._sendNextFrame&&a._sendNextFrame(a._video)}))))},e.prototype._cleanup=function(e){var t=void 0===e?{}:e,a=t.removeWorkerNet,n=t.removeWorkerTimer;this._effect&&(this._effect.destroy(),this._effect=null),this._removeStream(),this._removeDom(),a&&this._net&&(this._net.destroy(),this._net=null),n&&this._timerWorker&&(this._timerWorker.destroy(),this._timerWorker=null)},e.prototype._setEffect=function(e,t){return i(this,void 0,void 0,(function(){var a,n=this;return r(this,(function(o){switch(o.label){case 0:return this._timerWorker?[3,2]:(this._timerWorker=new k,[4,this._timerWorker.initWorker()]);case 1:o.sent(),o.label=2;case 2:return this._net?[3,4]:(a=this,[4,this._createNet()]);case 3:a._net=o.sent(),o.label=4;case 4:return this._effect&&(this._effect=null),this._sendNextFrame=function(e){var t;null===(t=n._timerWorker)||void 0===t||t.postThrottle("img-segm",(function(){var t;null===(t=n._net)||void 0===t||t.requestSegmentation(e)}),1e3/60)},this._removeStream(),this._createDom(t),[4,this._createStream(t)];case 5:if(o.sent(),!this._canvas||!this._video)throw new Error("Video element or canvas not found");return this._effect=e,this._effect.video=this._video,this._effect.canvas=this._canvas,this._sendNextFrame(this._video),[2]}}))}))},e.prototype.setEffect=function(e,t){var a,n;return i(this,void 0,void 0,(function(){var o;return r(this,(function(i){switch(i.label){case 0:if(!e)return this._cleanup(),[2,t];e.effect!==(null===(a=this._effect)||void 0===a?void 0:a.effect)&&(null===(n=this._effect)||void 0===n||n.destroy()),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._setEffect(e,t)];case 2:return i.sent(),[2,this._track||t];case 3:throw o=i.sent(),this._cleanup(),o;case 4:return[2]}}))}))},e.prototype.stopEffect=function(){this._cleanup()},Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect?this._effect.effect:h.NONE},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){this._cleanup({removeWorkerNet:!0,removeWorkerTimer:!0})},e}(),D=function(e){var t=e.gl,a=e.fs,n=e.vs,o=t.createShader(t.VERTEX_SHADER);if(!o)throw new Error("vertex shader didn't initialized");t.shaderSource(o,n),t.compileShader(o);var i=t.createShader(t.FRAGMENT_SHADER);if(!i)throw new Error("fragment shader didn't initialized");t.shaderSource(i,a),t.compileShader(i);var r=t.createProgram();if(!r)throw new Error("shader program didn't initialized");if(t.attachShader(r,o),t.attachShader(r,i),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw t.getProgramInfoLog(r);return t.deleteShader(o),t.deleteShader(i),{program:r}},L=function(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),t},j=function(e,t,a){var n=L(e);if(!n)throw new Error("texture was not created");e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,a,0,e.RGBA,e.UNSIGNED_BYTE,null);var o=e.createFramebuffer();if(!o)throw new Error("framebuffer was not created");return e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),{framebuffer:o,texture:n}},B=function(e,t){return{aTextureCoord:e.getAttribLocation(t,"aTextureCoord"),aVertexCoord:e.getAttribLocation(t,"aVertexCoord")}},U="attribute vec3 aVertexCoord;\nattribute vec2 aTextureCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexCoord, 1.0);\n  vTextureCoord = aTextureCoord;\n}",H=function(){function e(e){var t=this;this.gl=e,this.program=D({fs:"precision highp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uAlphaTexture;\nuniform float uLowerBound;\nuniform float uUpperBound;\n\nvoid main(void) {\n  vec4 color = texture2D(uAlphaTexture, vTextureCoord);\n  if (color.a < uLowerBound) {\n    color.a = 0.0;\n  } else {\n    if (color.a < uUpperBound) {\n      color.a = (color.a - uLowerBound) / (uUpperBound - uLowerBound);\n    } else {\n      color.a = 1.0;\n    }\n  }\n  gl_FragColor = color;\n}",gl:e,vs:U}).program,this.uniforms={uAlphaTexture:function(e){var a=t.gl.getUniformLocation(t.program,"uAlphaTexture");t.gl.uniform1i(a,e)},uLowerBound:function(e){var a=t.gl.getUniformLocation(t.program,"uLowerBound");t.gl.uniform1f(a,e)},uUpperBound:function(e){var a=t.gl.getUniformLocation(t.program,"uUpperBound");t.gl.uniform1f(a,e)}},this.attributes=B(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),F=function(){function e(e){var t=this;this.gl=e,this.program=D({fs:"precision highp float;\n\nuniform sampler2D uCameraFrameTexture;\nuniform sampler2D uBackgroundTexture;\nuniform sampler2D uAlphaTexture;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  vec4 cameraFrameColor = texture2D(uCameraFrameTexture, vTextureCoord);\n  vec4 backgroundColor = texture2D(uBackgroundTexture, vTextureCoord);\n  vec4 alphaMask = texture2D(uAlphaTexture, vTextureCoord);\n  gl_FragColor = mix(backgroundColor, cameraFrameColor, alphaMask.a);\n}",gl:e,vs:U}).program,this.uniforms={uAlphaTexture:function(e){var a=t.gl.getUniformLocation(t.program,"uAlphaTexture");t.gl.uniform1i(a,e)},uCameraFrameTexture:function(e){var a=t.gl.getUniformLocation(t.program,"uCameraFrameTexture");t.gl.uniform1i(a,e)},uBackgroundTexture:function(e){var a=t.gl.getUniformLocation(t.program,"uBackgroundTexture");t.gl.uniform1i(a,e)}},this.attributes=B(this.gl,this.program)}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),V=function(){function e(e){var t=this;this.gl=e,this.program=D({fs:"// https://github.com/Jam3/glsl-fast-gaussian-blur\n\nprecision highp float;\n\nuniform sampler2D texture;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3333333333333333) * direction;\n  color += texture2D(image, uv) * 0.29411764705882354;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n  return color;\n}\n\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  color += texture2D(image, uv) * 0.1964825501511404;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n  return color;\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor = blur13(texture, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={texture:function(e){var a=t.gl.getUniformLocation(t.program,"texture");t.gl.uniform1i(a,e)},iResolution:function(e,a,n){var o=t.gl.getUniformLocation(t.program,"iResolution");t.gl.uniform3f(o,e,a,n)},flip:function(e){var a=t.gl.getUniformLocation(t.program,"flip");t.gl.uniform1f(a,e)},direction:function(e,a){var n=t.gl.getUniformLocation(t.program,"direction");t.gl.uniform2f(n,e,a)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),G=function(){function e(e){var t=this;this.gl=e,this.program=D({fs:"precision highp float;\n\nuniform sampler2D uTextureOriginal;\nuniform sampler2D uTextureMask;\nuniform vec3 iResolution;\nuniform bool flip;\nuniform vec2 direction;\n\nvec4 blur13(sampler2D image, sampler2D maskTexture, vec2 uv, vec2 resolution,\n            vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.411764705882353) * direction;\n  vec2 off2 = vec2(3.2941176470588234) * direction;\n  vec2 off3 = vec2(5.176470588235294) * direction;\n  float sumCof = 0.0;\n\n  vec4 c = texture2D(image, uv);\n  vec4 m = texture2D(maskTexture, uv);\n  color += c * 0.1964825501511404 * (1.0 - m.a);\n  sumCof += 0.1964825501511404 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off1 / resolution));\n  m = texture2D(maskTexture, uv + (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off1 / resolution));\n  m = texture2D(maskTexture, uv - (off1 / resolution));\n  color += c * 0.2969069646728344 * (1.0 - m.a);\n  sumCof += 0.2969069646728344 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off2 / resolution));\n  m = texture2D(maskTexture, uv + (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off2 / resolution));\n  m = texture2D(maskTexture, uv - (off2 / resolution));\n  color += c * 0.09447039785044732 * (1.0 - m.a);\n  sumCof += 0.09447039785044732 * (1.0 - m.a);\n\n  c = texture2D(image, uv + (off3 / resolution));\n  m = texture2D(maskTexture, uv + (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  c = texture2D(image, uv - (off3 / resolution));\n  m = texture2D(maskTexture, uv - (off3 / resolution));\n  color += c * 0.010381362401148057 * (1.0 - m.a);\n  sumCof += 0.010381362401148057 * (1.0 - m.a);\n\n  return sumCof > 0.0 ? color / sumCof : vec4(0.0, 0.0, 0.0, 0.0);\n}\n\nvoid main() {\n  vec2 uv = vec2(gl_FragCoord.xy / iResolution.xy);\n\n  if (flip) {\n    uv.y = 1.0 - uv.y;\n  }\n\n  gl_FragColor =\n      blur13(uTextureOriginal, uTextureMask, uv, iResolution.xy, direction);\n}",gl:e,vs:"attribute vec3 position;\n\nvoid main() { gl_Position = vec4(position, 1.0); }"}).program,this.uniforms={uTextureOriginal:function(e){var a=t.gl.getUniformLocation(t.program,"uTextureOriginal");t.gl.uniform1i(a,e)},uTextureMask:function(e){var a=t.gl.getUniformLocation(t.program,"uTextureMask");t.gl.uniform1i(a,e)},iResolution:function(e,a,n){var o=t.gl.getUniformLocation(t.program,"iResolution");t.gl.uniform3f(o,e,a,n)},flip:function(e){var a=t.gl.getUniformLocation(t.program,"flip");t.gl.uniform1f(a,e)},direction:function(e,a){var n=t.gl.getUniformLocation(t.program,"direction");t.gl.uniform2f(n,e,a)}},this.attributes={position:this.gl.getAttribLocation(this.program,"position")}}return e.prototype.bind=function(){this.gl.useProgram(this.program)},e.prototype.destroy=function(){this.gl.deleteProgram(this.program)},e}(),W=function(){function e(e){this.textures={background:null,image:null,resizedImage:null,segmentationMask:null},this.parameters={blurStrength:.8,fixSegmentation:!0,fixSegmentationBlurStrength:.25,fixSegmentationIterations:8,alphaCutterLowerBound:.4,alphaCutterUpperBound:.6},this.$canvas=e;var t=this.$canvas.getContext("webgl");if(!t)throw new Error("getting ctx failed");this.gl=t;var a=this.gl;this.onresize=this.onresize.bind(this),this.onresize(),this.pBlurFastWithMask=new G(this.gl),this.pBackgroundComposer=new F(this.gl),this.pBlurFast=new V(this.gl),this.pAlphaCutter=new H(this.gl),this.vertices=[1,1,0,1,1,1,-1,0,1,0,-1,-1,0,0,0,-1,1,0,0,1],this.indices=[0,1,3,1,2,3];var n=a.createBuffer(),o=a.createBuffer();if(!n||!o)throw new Error("create buffer error");this.positionBuffer=n,this.indexBuffer=o,a.bindBuffer(a.ARRAY_BUFFER,this.positionBuffer),a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertices),a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),a.STATIC_DRAW),this.fbs={blur:this.createTextureLayers(),segmentationFix:this.createTextureLayers()},this.textures={background:L(a),image:L(a),resizedImage:L(a),segmentationMask:L(a)},window.addEventListener("resize",this.onresize)}return e.prototype.onresize=function(){var e=this,t=e.$canvas,a=e.gl,n=e.fbs,o=t.width||t.clientWidth,i=t.height||t.clientHeight;t.width=o,t.height=i,a.viewport(0,0,o,i),n&&function(e,t){for(var a=t.height,n=t.width,o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];o.forEach((function(t){t.forEach((function(t){(function(e,t){e.bindFramebuffer(e.FRAMEBUFFER,t),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null)})(e,t.framebuffer),function(e,t,a,n){e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,a,n,0,e.RGBA,e.UNSIGNED_BYTE,null),e.bindTexture(e.TEXTURE_2D,null)}(e,t.texture,n,a)}))}))}(a,{width:o,height:i},n.blur,n.segmentationFix)},e.prototype.loadTextures=function(e){var t=e.image,a=e.resizedImage,n=e.segmentationMask,o=e.background,i=this.gl,r=this.textures;return i.bindTexture(i.TEXTURE_2D,r.image),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),o||(i.bindTexture(i.TEXTURE_2D,r.resizedImage),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,a)),i.bindTexture(i.TEXTURE_2D,r.segmentationMask),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,n),o&&(i.bindTexture(i.TEXTURE_2D,r.background),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,o)),i.bindTexture(i.TEXTURE_2D,null),r},e.prototype.close=function(){var e=this,t=e.gl,a=e.positionBuffer,n=e.indexBuffer,o=e.pBackgroundComposer,i=e.pBlurFast,r=e.pBlurFastWithMask,s=e.pAlphaCutter,l=e.fbs,c=e.textures;window.removeEventListener("resize",this.onresize),t.bindBuffer(t.ARRAY_BUFFER,null),t.deleteBuffer(a),t.deleteBuffer(n),t.useProgram(null),o.destroy(),i.destroy(),r.destroy(),s.destroy(),function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];t.forEach((function(t){t.forEach((function(t){e.deleteFramebuffer(t.framebuffer),e.deleteTexture(t.texture)}))}))}(t,l.blur,l.segmentationFix),function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];t.forEach((function(t){return e.deleteTexture(t)}))}(t,c.background,c.image,c.resizedImage,c.segmentationMask)},e.prototype.drawGeometry=function(){var e=this,t=e.gl,a=e.indexBuffer,n=e.indices;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.drawElements(t.TRIANGLES,n.length,t.UNSIGNED_SHORT,0)},e.prototype.createTextureLayers=function(){var e=this.gl,t=this.$canvas,a=t.width,n=t.height;return[j(e,a,n),j(e,a,n)]},e.prototype.setGeometry=function(e,t){var a=this.gl,n=this.positionBuffer;a.bindBuffer(a.ARRAY_BUFFER,n),a.enableVertexAttribArray(e),a.vertexAttribPointer(e,3,a.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,0),void 0!==t&&(a.enableVertexAttribArray(t),a.vertexAttribPointer(t,2,a.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT))},e.prototype.setParameters=function(e){Object.assign(this.parameters,e)},e.prototype.draw=function(e){var t,a,n=this,o=n.gl,i=n.$canvas,r=n.parameters,s=n.pBlurFastWithMask,l=n.pBackgroundComposer,c=n.pBlurFast,d=n.pAlphaCutter,u=n.fbs,p=r.fixSegmentation,_=r.fixSegmentationBlurStrength,m=r.blurStrength,h=r.fixSegmentationIterations,g=r.alphaCutterLowerBound,A=r.alphaCutterUpperBound,C=i.width,v=i.height;o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT),o.viewport(0,0,C,v),o.disable(o.BLEND),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!0);var f=this.loadTextures(e),S=null,E=e.background?f.background:null;if(p){c.bind(),this.setGeometry(c.attributes.position),c.uniforms.iResolution(C,v,0),c.uniforms.flip(0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,f.segmentationMask),c.uniforms.texture(0);for(var T=0,I=0;I<h;++I){var y=(h-I-1)*_,N=I%2==0?[y,0]:[0,y];(t=c.uniforms).direction.apply(t,N),o.bindFramebuffer(o.FRAMEBUFFER,u.segmentationFix[T%2].framebuffer),this.drawGeometry(),o.bindTexture(o.TEXTURE_2D,u.segmentationFix[T%2].texture),++T}d.bind(),this.setGeometry(d.attributes.aVertexCoord,d.attributes.aTextureCoord),d.uniforms.uLowerBound(g),d.uniforms.uUpperBound(A),d.uniforms.uAlphaTexture(0),o.bindFramebuffer(o.FRAMEBUFFER,u.segmentationFix[T%2].framebuffer),this.drawGeometry(),S=u.segmentationFix[T%2].texture}if(!E){s.bind(),this.setGeometry(s.attributes.position),s.uniforms.iResolution(C,v,0),s.uniforms.flip(0),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,S||f.segmentationMask),s.uniforms.uTextureMask(0),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,f.resizedImage),s.uniforms.uTextureOriginal(1);var b=0;for(I=0;I<8;++I)y=(8-I-1)*m,N=I%2==0?[y,0]:[0,y],(a=s.uniforms).direction.apply(a,N),o.bindFramebuffer(o.FRAMEBUFFER,u.blur[b%2].framebuffer),this.drawGeometry(),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,u.blur[b%2].texture),++b;E=u.blur[(b-1)%2].texture}l.bind(),this.setGeometry(l.attributes.aVertexCoord,l.attributes.aTextureCoord),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,S||f.segmentationMask),l.uniforms.uAlphaTexture(0),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,E),l.uniforms.uBackgroundTexture(1),o.activeTexture(o.TEXTURE2),o.bindTexture(o.TEXTURE_2D,f.image),l.uniforms.uCameraFrameTexture(2),o.bindFramebuffer(o.FRAMEBUFFER,null),this.drawGeometry()},e}(),$=function(){function e(e){this._effect=e}return Object.defineProperty(e.prototype,"video",{set:function(e){this._video=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{set:function(e){this._canvas=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"effect",{get:function(){return this._effect},enumerable:!1,configurable:!0}),e.prototype.destroy=function(){},e}(),z=function(e){function t(){var t=e.call(this,h.BACKGROUND)||this;return t._imageEdit=new v,t._WebGlBlend=null,t}return o(t,e),t.prototype.setBackgroundImage=function(e){return i(this,void 0,void 0,(function(){var t,a;return r(this,(function(n){switch(n.label){case 0:return t=this,e?[4,A(e)]:[3,2];case 1:return a=n.sent(),[3,3];case 2:a=void 0,n.label=3;case 3:return t._nextBackgroundImage=a,[2]}}))}))},t.prototype._updateBackground=function(){try{if(this._nextBackgroundImage){var e=this._canvas,t=this._imageEdit,a=e.width,n=e.height;this._backgroundImage=t.resize(this._nextBackgroundImage,a,n),delete this._nextBackgroundImage}}catch(e){console.warn(e)}},t.prototype.draw=function(e){try{if(this._WebGlBlend||(this._WebGlBlend=new W(this._canvas)),this._nextBackgroundImage&&this._updateBackground(),this._WebGlBlend){var t=Object.assign({background:this._backgroundImage},e);this._WebGlBlend.draw(t)}}catch(e){console.warn(e)}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGlBlend&&(this._WebGlBlend.close(),this._WebGlBlend=null)},t}($),Z=function(e){function t(){var t=e.call(this,h.BLUR)||this;return t._WebGLEffects=null,t._savedOptions=null,t}return o(t,e),t.prototype.draw=function(e){try{this._WebGLEffects||(this._WebGLEffects=new W(this._canvas),this._savedOptions&&this._WebGLEffects.setParameters(this._savedOptions)),this._WebGLEffects.draw(e)}catch(e){console.warn(e)}},t.prototype.setEffects=function(e){this._savedOptions=e,this._WebGLEffects&&this._WebGLEffects.setParameters(e)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this._WebGLEffects&&(this._WebGLEffects.close(),this._WebGLEffects=null)},t}($)},504580:(e,t,a)=>{"use strict";function n(e,t,a,n){return new(a||(a=Promise))((function(o,i){function r(e){try{l(n.next(e))}catch(e){i(e)}}function s(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))}var o;a.r(t),a.d(t,{AnimojiPreviewGenerator:()=>y,AnimojiReceiver:()=>x,AnimojiSender:()=>R,isBrowserSupported:()=>d,setSDK:()=>c}),function(e){e.DEBUG="DEBUG",e.LOG="LOG",e.WARN="WARN",e.ERROR="ERROR"}(o||(o={}));const i={},r="[🙎‍♂️ Vmoji]";var s;!function(e){function t(e){const t=new Map([[/id for ssrc/,{lock:!1,cooldown:5e3}],[/no svg/,{lock:!1,cooldown:5e3}],[/_send failed/,{lock:!1,cooldown:5e3}],[/failed to increase/,{lock:!1,cooldown:15e3}],[/No available/,{lock:!1,cooldown:15e3}]]);return function(...a){for(const e of Array.from(t.keys()))if(a.filter((e=>"string"==typeof e)).some((t=>e.test(t)))){const{cooldown:a,lock:n}=t.get(e);if(n)return;t.set(e,{cooldown:a,lock:!0}),window.setTimeout((()=>{t.set(e,{cooldown:a,lock:!1})}),a)}e(...a)}}e.debug=()=>{},e.log=()=>{},e.warn=()=>{},e.error=()=>{},e.setDebugMessageFunction=function(a){e.debug=t(a.bind(null,o.DEBUG,r)),e.log=t(a.bind(null,o.LOG,r)),e.warn=t(a.bind(null,o.WARN,r)),e.error=t(a.bind(null,o.ERROR,r))}}(s||(s={}));let l=null;function c(e){l=e,s.setDebugMessageFunction(e.debugMessage)}const d=()=>{try{const e=window,t=e.WebAssembly&&e.Worker&&(e.CanvasCaptureMediaStream||e.CanvasCaptureMediaStreamTrack)&&e.OffscreenCanvas&&(e.AudioContext||e.webkitAudioContext)&&e.AudioWorkletNode&&!0,a="Safari"===(null==l?void 0:l.browser.browserName())&&15===Number(null==l?void 0:l.browser.browserVersion());return t&&!a}catch(e){return!1}},u=(e,t=[])=>{const a=t.join(","),n=new Blob([`(${e})(${a});`],{type:"application/javascript; charset=utf-8"});return window.URL.createObjectURL(n)};var p,_,m="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==a.g?a.g:"undefined"!=typeof self?self:{},h=(p=function(e,t){var a=("undefined"!=typeof document&&document.currentScript&&document.currentScript.src,function(e={}){var t,a,n=void 0!==e?e:{};n.ready=new Promise((function(e,n){t=e,a=n}));var o=Object.assign({},n),i="object"==typeof window,r="function"==typeof importScripts;"object"==typeof process&&"object"==typeof process.versions&&process.versions.node;var s,l="";(i||r)&&(r?l=self.location.href:"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),l=0!==l.indexOf("blob:")?l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):"",r&&(s=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)})),n.print||console.log.bind(console);var c,d,u=n.printErr||console.warn.bind(console);Object.assign(n,o),o=null,n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.quit&&n.quit,n.wasmBinary&&(c=n.wasmBinary),n.noExitRuntime,"object"!=typeof WebAssembly&&M("no native wasm support detected");var p,_,h,g,A,C,v,f,S,E=!1;function T(){var e=d.buffer;n.HEAP8=p=new Int8Array(e),n.HEAP16=h=new Int16Array(e),n.HEAP32=A=new Int32Array(e),n.HEAPU8=_=new Uint8Array(e),n.HEAPU16=g=new Uint16Array(e),n.HEAPU32=C=new Uint32Array(e),n.HEAPF32=v=new Float32Array(e),n.HEAPF64=f=new Float64Array(e)}var I=[],y=[],N=[],b=0,x=null;function M(e){n.onAbort&&n.onAbort(e),u(e="Aborted("+e+")"),E=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw a(t),t}var O,P;function R(e){return e.startsWith("data:application/octet-stream;base64,")}function k(e){try{if(e==O&&c)return new Uint8Array(c);if(s)return s(e);throw"both async and sync fetching of the wasm failed"}catch(e){M(e)}}function w(e,t,a){return function(e){return c||!i&&!r||"function"!=typeof fetch?Promise.resolve().then((function(){return k(e)})):fetch(e,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()})).catch((function(){return k(e)}))}(e).then((function(e){return WebAssembly.instantiate(e,t)})).then((function(e){return e})).then(a,(function(e){u("failed to asynchronously prepare wasm: "+e),M(e)}))}function D(e){for(;e.length>0;)e.shift()(n)}function L(e){this.excPtr=e,this.ptr=e-24,this.set_type=function(e){C[this.ptr+4>>2]=e},this.get_type=function(){return C[this.ptr+4>>2]},this.set_destructor=function(e){C[this.ptr+8>>2]=e},this.get_destructor=function(){return C[this.ptr+8>>2]},this.set_refcount=function(e){A[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,p[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=p[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,p[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=p[this.ptr+13>>0]},this.init=function(e,t){this.set_adjusted_ptr(0),this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=A[this.ptr>>2];A[this.ptr>>2]=e+1},this.release_ref=function(){var e=A[this.ptr>>2];return A[this.ptr>>2]=e-1,1===e},this.set_adjusted_ptr=function(e){C[this.ptr+16>>2]=e},this.get_adjusted_ptr=function(){return C[this.ptr+16>>2]},this.get_exception_ptr=function(){if(ct(this.get_type()))return C[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}R(O="vmoji.wasm")||(P=O,O=n.locateFile?n.locateFile(P,l):l+P);var j={};function B(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function U(e){return this.fromWireType(A[e>>2])}var H={},F={},V={},G=48,W=57;function $(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=G&&t<=W?"_"+e:e}function z(e,t){return{[e=$(e)]:function(){return t.apply(this,arguments)}}[e]}function Z(e,t){var a=z(t,(function(e){this.name=t,this.message=e;var a=new Error(e).stack;void 0!==a&&(this.stack=this.toString()+"\n"+a.replace(/^Error(:[^\n]*)?\n/,""))}));return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,a.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},a}var K=void 0;function Q(e){throw new K(e)}function Y(e,t,a){function n(t){var n=a(t);n.length!==e.length&&Q("Mismatched type converter count");for(var o=0;o<e.length;++o)ae(e[o],n[o])}e.forEach((function(e){V[e]=t}));var o=new Array(t.length),i=[],r=0;t.forEach(((e,t)=>{F.hasOwnProperty(e)?o[t]=F[e]:(i.push(e),H.hasOwnProperty(e)||(H[e]=[]),H[e].push((()=>{o[t]=F[e],++r===i.length&&n(o)})))})),0===i.length&&n(o)}function q(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var J=void 0;function X(e){for(var t="",a=e;_[a];)t+=J[_[a++]];return t}var ee=void 0;function te(e){throw new ee(e)}function ae(e,t,a={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=t.name;if(e||te('type "'+n+'" must have a positive integer typeid pointer'),F.hasOwnProperty(e)){if(a.ignoreDuplicateRegistrations)return;te("Cannot register type '"+n+"' twice")}if(F[e]=t,delete V[e],H.hasOwnProperty(e)){var o=H[e];delete H[e],o.forEach((e=>e()))}}function ne(e){te(e.$$.ptrType.registeredClass.name+" instance already deleted")}var oe=!1;function ie(e){}function re(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function se(e,t,a){if(t===a)return e;if(void 0===a.baseClass)return null;var n=se(e,t,a.baseClass);return null===n?null:a.downcast(n)}var le={};var ce=[];function de(){for(;ce.length;){var e=ce.pop();e.$$.deleteScheduled=!1,e.delete()}}var ue=void 0;var pe={};function _e(e,t){return t.ptrType&&t.ptr||Q("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!=!!t.smartPtr&&Q("Both smartPtrType and smartPtr must be specified"),t.count={value:1},me(Object.create(e,{$$:{value:t}}))}function me(e){return"undefined"==typeof FinalizationRegistry?(me=e=>e,e):(oe=new FinalizationRegistry((e=>{re(e.$$)})),me=e=>{var t=e.$$;if(t.smartPtr){var a={$$:t};oe.register(e,a,e)}return e},ie=e=>oe.unregister(e),me(e))}function he(){}function ge(e,t,a){if(void 0===e[t].overloadTable){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||te("Function '"+a+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}}function Ae(e,t,a,n,o,i,r,s){this.name=e,this.constructor=t,this.instancePrototype=a,this.rawDestructor=n,this.baseClass=o,this.getActualType=i,this.upcast=r,this.downcast=s,this.pureVirtualFunctions=[]}function Ce(e,t,a){for(;t!==a;)t.upcast||te("Expected null or instance of "+a.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function ve(e,t){if(null===t)return this.isReference&&te("null is not a valid "+this.name),0;t.$$||te('Cannot pass "'+De(t)+'" as a '+this.name),t.$$.ptr||te("Cannot pass deleted object as a pointer of type "+this.name);var a=t.$$.ptrType.registeredClass;return Ce(t.$$.ptr,a,this.registeredClass)}function fe(e,t){var a;if(null===t)return this.isReference&&te("null is not a valid "+this.name),this.isSmartPointer?(a=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,a),a):0;t.$$||te('Cannot pass "'+De(t)+'" as a '+this.name),t.$$.ptr||te("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&te("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;if(a=Ce(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&te("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?a=t.$$.smartPtr:te("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:a=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)a=t.$$.smartPtr;else{var o=t.clone();a=this.rawShare(a,we.toHandle((function(){o.delete()}))),null!==e&&e.push(this.rawDestructor,a)}break;default:te("Unsupporting sharing policy")}return a}function Se(e,t){if(null===t)return this.isReference&&te("null is not a valid "+this.name),0;t.$$||te('Cannot pass "'+De(t)+'" as a '+this.name),t.$$.ptr||te("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&te("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var a=t.$$.ptrType.registeredClass;return Ce(t.$$.ptr,a,this.registeredClass)}function Ee(e,t,a,n,o,i,r,s,l,c,d){this.name=e,this.registeredClass=t,this.isReference=a,this.isConst=n,this.isSmartPointer=o,this.pointeeType=i,this.sharingPolicy=r,this.rawGetPointee=s,this.rawConstructor=l,this.rawShare=c,this.rawDestructor=d,o||void 0!==t.baseClass?this.toWireType=fe:n?(this.toWireType=ve,this.destructorFunction=null):(this.toWireType=Se,this.destructorFunction=null)}var Te=[];function Ie(e){var t=Te[e];return t||(e>=Te.length&&(Te.length=e+1),Te[e]=t=S.get(e)),t}function ye(e,t,a){return e.includes("j")?function(e,t,a){var o=n["dynCall_"+e];return a&&a.length?o.apply(null,[t].concat(a)):o.call(null,t)}(e,t,a):Ie(t).apply(null,a)}function Ne(e,t){var a,n,o,i=(e=X(e)).includes("j")?(a=e,n=t,o=[],function(){return o.length=0,Object.assign(o,arguments),ye(a,n,o)}):Ie(t);return"function"!=typeof i&&te("unknown function pointer with signature "+e+": "+t),i}var be=void 0;function xe(e){var t=st(e),a=X(t);return rt(t),a}function Me(e,t){var a=[],n={};throw t.forEach((function e(t){n[t]||F[t]||(V[t]?V[t].forEach(e):(a.push(t),n[t]=!0))})),new be(e+": "+a.map(xe).join([", "]))}function Oe(e,t){for(var a=[],n=0;n<e;n++)a.push(C[t+4*n>>2]);return a}function Pe(e,t,a,n,o,i){var r=t.length;r<2&&te("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var s=null!==t[1]&&null!==a,l=!1,c=1;c<t.length;++c)if(null!==t[c]&&void 0===t[c].destructorFunction){l=!0;break}var d="void"!==t[0].name,u=r-2,p=new Array(u),_=[],m=[];return function(){var a;arguments.length!==u&&te("function "+e+" called with "+arguments.length+" arguments, expected "+u+" args!"),m.length=0,_.length=s?2:1,_[0]=o,s&&(a=t[1].toWireType(m,this),_[1]=a);for(var i=0;i<u;++i)p[i]=t[i+2].toWireType(m,arguments[i]),_.push(p[i]);return function(e){if(l)B(m);else for(var n=s?1:2;n<t.length;n++){var o=1===n?a:p[n-2];null!==t[n].destructorFunction&&t[n].destructorFunction(o)}if(d)return t[0].fromWireType(e)}(n.apply(null,_))}}var Re=new function(){this.allocated=[void 0],this.freelist=[],this.get=function(e){return this.allocated[e]},this.allocate=function(e){let t=this.freelist.pop()||this.allocated.length;return this.allocated[t]=e,t},this.free=function(e){this.allocated[e]=void 0,this.freelist.push(e)}};function ke(e){e>=Re.reserved&&0==--Re.get(e).refcount&&Re.free(e)}var we={toValue:e=>(e||te("Cannot use deleted val. handle = "+e),Re.get(e).value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Re.allocate({refcount:1,value:e})}}};function De(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function Le(e,t){switch(t){case 2:return function(e){return this.fromWireType(v[e>>2])};case 3:return function(e){return this.fromWireType(f[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function je(e,t,a){switch(t){case 0:return a?function(e){return p[e]}:function(e){return _[e]};case 1:return a?function(e){return h[e>>1]}:function(e){return g[e>>1]};case 2:return a?function(e){return A[e>>2]}:function(e){return C[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function Be(e,t,a){return function(e,t,a,n){if(!(n>0))return 0;for(var o=a,i=a+n-1,r=0;r<e.length;++r){var s=e.charCodeAt(r);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++r)),s<=127){if(a>=i)break;t[a++]=s}else if(s<=2047){if(a+1>=i)break;t[a++]=192|s>>6,t[a++]=128|63&s}else if(s<=65535){if(a+2>=i)break;t[a++]=224|s>>12,t[a++]=128|s>>6&63,t[a++]=128|63&s}else{if(a+3>=i)break;t[a++]=240|s>>18,t[a++]=128|s>>12&63,t[a++]=128|s>>6&63,t[a++]=128|63&s}}return t[a]=0,a-o}(e,_,t,a)}function Ue(e){for(var t=0,a=0;a<e.length;++a){var n=e.charCodeAt(a);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++a):t+=3}return t}var He="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function Fe(e,t){return e?function(e,t,a){for(var n=t+a,o=t;e[o]&&!(o>=n);)++o;if(o-t>16&&e.buffer&&He)return He.decode(e.subarray(t,o));for(var i="";t<o;){var r=e[t++];if(128&r){var s=63&e[t++];if(192!=(224&r)){var l=63&e[t++];if((r=224==(240&r)?(15&r)<<12|s<<6|l:(7&r)<<18|s<<12|l<<6|63&e[t++])<65536)i+=String.fromCharCode(r);else{var c=r-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&r)<<6|s)}else i+=String.fromCharCode(r)}return i}(_,e,t):""}var Ve="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function Ge(e,t){for(var a=e,n=a>>1,o=n+t/2;!(n>=o)&&g[n];)++n;if((a=n<<1)-e>32&&Ve)return Ve.decode(_.subarray(e,a));for(var i="",r=0;!(r>=t/2);++r){var s=h[e+2*r>>1];if(0==s)break;i+=String.fromCharCode(s)}return i}function We(e,t,a){if(void 0===a&&(a=2147483647),a<2)return 0;for(var n=t,o=(a-=2)<2*e.length?a/2:e.length,i=0;i<o;++i){var r=e.charCodeAt(i);h[t>>1]=r,t+=2}return h[t>>1]=0,t-n}function $e(e){return 2*e.length}function ze(e,t){for(var a=0,n="";!(a>=t/4);){var o=A[e+4*a>>2];if(0==o)break;if(++a,o>=65536){var i=o-65536;n+=String.fromCharCode(55296|i>>10,56320|1023&i)}else n+=String.fromCharCode(o)}return n}function Ze(e,t,a){if(void 0===a&&(a=2147483647),a<4)return 0;for(var n=t,o=n+a-4,i=0;i<e.length;++i){var r=e.charCodeAt(i);if(r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++i)),A[t>>2]=r,(t+=4)+4>o)break}return A[t>>2]=0,t-n}function Ke(e){for(var t=0,a=0;a<e.length;++a){var n=e.charCodeAt(a);n>=55296&&n<=57343&&++a,t+=4}return t}function Qe(e,t){var a=F[e];return void 0===a&&te(t+" has unknown type "+xe(e)),a}var Ye={};function qe(e){var t=Ye[e];return void 0===t?X(e):t}var Je=[];function Xe(){if("object"==typeof globalThis)return globalThis;function e(e){e.$$$embind_global$$$=e;var t="object"==typeof $$$embind_global$$$&&e.$$$embind_global$$$==e;return t||delete e.$$$embind_global$$$,t}if("object"==typeof $$$embind_global$$$)return $$$embind_global$$$;if("object"==typeof m&&e(m)?$$$embind_global$$$=m:"object"==typeof self&&e(self)&&($$$embind_global$$$=self),"object"==typeof $$$embind_global$$$)return $$$embind_global$$$;throw Error("unable to get global object.")}var et,tt=[],at={};function nt(e){var t=d.buffer;try{return d.grow(e-t.byteLength+65535>>>16),T(),1}catch(e){}}et=()=>performance.now(),K=n.InternalError=Z(Error,"InternalError"),function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);J=e}(),ee=n.BindingError=Z(Error,"BindingError"),he.prototype.isAliasOf=function(e){if(!(this instanceof he))return!1;if(!(e instanceof he))return!1;for(var t=this.$$.ptrType.registeredClass,a=this.$$.ptr,n=e.$$.ptrType.registeredClass,o=e.$$.ptr;t.baseClass;)a=t.upcast(a),t=t.baseClass;for(;n.baseClass;)o=n.upcast(o),n=n.baseClass;return t===n&&a===o},he.prototype.clone=function(){if(this.$$.ptr||ne(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=me(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t},he.prototype.delete=function(){this.$$.ptr||ne(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&te("Object already scheduled for deletion"),ie(this),re(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},he.prototype.isDeleted=function(){return!this.$$.ptr},he.prototype.deleteLater=function(){return this.$$.ptr||ne(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&te("Object already scheduled for deletion"),ce.push(this),1===ce.length&&ue&&ue(de),this.$$.deleteScheduled=!0,this},n.getInheritedInstanceCount=function(){return Object.keys(pe).length},n.getLiveInheritedInstances=function(){var e=[];for(var t in pe)pe.hasOwnProperty(t)&&e.push(pe[t]);return e},n.flushPendingDeletes=de,n.setDelayFunction=function(e){ue=e,ce.length&&ue&&ue(de)},Ee.prototype.getPointee=function(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e},Ee.prototype.destructor=function(e){this.rawDestructor&&this.rawDestructor(e)},Ee.prototype.argPackAdvance=8,Ee.prototype.readValueFromPointer=U,Ee.prototype.deleteObject=function(e){null!==e&&e.delete()},Ee.prototype.fromWireType=function(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var a=function(e,t){return t=function(e,t){for(void 0===t&&te("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),pe[t]}(this.registeredClass,t);if(void 0!==a){if(0===a.$$.count.value)return a.$$.ptr=t,a.$$.smartPtr=e,a.clone();var n=a.clone();return this.destructor(e),n}function o(){return this.isSmartPointer?_e(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):_e(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var i,r=this.registeredClass.getActualType(t),s=le[r];if(!s)return o.call(this);i=this.isConst?s.constPointerType:s.pointerType;var l=se(t,this.registeredClass,i.registeredClass);return null===l?o.call(this):this.isSmartPointer?_e(i.registeredClass.instancePrototype,{ptrType:i,ptr:l,smartPtrType:this,smartPtr:e}):_e(i.registeredClass.instancePrototype,{ptrType:i,ptr:l})},be=n.UnboundTypeError=Z(Error,"UnboundTypeError"),Re.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),Re.reserved=Re.allocated.length,n.count_emval_handles=function(){for(var e=0,t=Re.reserved;t<Re.allocated.length;++t)void 0!==Re.allocated[t]&&++e;return e};var ot={j:function(e,t,a){throw new L(e).init(t,a),e},I:function(e){var t=j[e];delete j[e];var a=t.rawConstructor,n=t.rawDestructor,o=t.fields;Y([e],o.map((e=>e.getterReturnType)).concat(o.map((e=>e.setterArgumentType))),(e=>{var i={};return o.forEach(((t,a)=>{var n=t.fieldName,r=e[a],s=t.getter,l=t.getterContext,c=e[a+o.length],d=t.setter,u=t.setterContext;i[n]={read:e=>r.fromWireType(s(l,e)),write:(e,t)=>{var a=[];d(u,e,c.toWireType(a,t)),B(a)}}})),[{name:t.name,fromWireType:function(e){var t={};for(var a in i)t[a]=i[a].read(e);return n(e),t},toWireType:function(e,t){for(var o in i)if(!(o in t))throw new TypeError('Missing field:  "'+o+'"');var r=a();for(o in i)i[o].write(r,t[o]);return null!==e&&e.push(n,r),r},argPackAdvance:8,readValueFromPointer:U,destructorFunction:n}]}))},w:function(e,t,a,n,o){},E:function(e,t,a,n,o){var i=q(a);ae(e,{name:t=X(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?n:o},argPackAdvance:8,readValueFromPointer:function(e){var n;if(1===a)n=p;else if(2===a)n=h;else{if(4!==a)throw new TypeError("Unknown boolean type size: "+t);n=A}return this.fromWireType(n[e>>i])},destructorFunction:null})},C:function(e,t,a,o,i,r,s,l,c,d,u,p,_){u=X(u),r=Ne(i,r),l&&(l=Ne(s,l)),d&&(d=Ne(c,d)),_=Ne(p,_);var m=$(u);!function(e,t,a){n.hasOwnProperty(e)?(te("Cannot register public name '"+e+"' twice"),ge(n,e,e),n.hasOwnProperty(a)&&te("Cannot register multiple overloads of a function with the same number of arguments ("+a+")!"),n[e].overloadTable[a]=t):n[e]=t}(m,(function(){Me("Cannot construct "+u+" due to unbound types",[o])})),Y([e,t,a],o?[o]:[],(function(t){var a,i;t=t[0],i=o?(a=t.registeredClass).instancePrototype:he.prototype;var s=z(m,(function(){if(Object.getPrototypeOf(this)!==c)throw new ee("Use 'new' to construct "+u);if(void 0===p.constructor_body)throw new ee(u+" has no accessible constructor");var e=p.constructor_body[arguments.length];if(void 0===e)throw new ee("Tried to invoke ctor of "+u+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(p.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),c=Object.create(i,{constructor:{value:s}});s.prototype=c;var p=new Ae(u,s,c,_,a,r,l,d),h=new Ee(u,p,!0,!1,!1),g=new Ee(u+"*",p,!1,!1,!1),A=new Ee(u+" const*",p,!1,!0,!1);return le[e]={pointerType:g,constPointerType:A},function(e,t,a){n.hasOwnProperty(e)||Q("Replacing nonexistant public symbol"),n[e].overloadTable,n[e]=t,n[e].argCount=a}(m,s),[h,g,A]}))},v:function(e,t,a,n,o,i){t>0||M(undefined);var r=Oe(t,a);o=Ne(n,o),Y([],[e],(function(e){var a="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new ee("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=()=>{Me("Cannot construct "+e.name+" due to unbound types",r)},Y([],r,(function(n){return n.splice(1,0,null),e.registeredClass.constructor_body[t-1]=Pe(a,n,null,o,i),[]})),[]}))},e:function(e,t,a,n,o,i,r,s,l){var c=Oe(a,n);t=X(t),i=Ne(o,i),Y([],[e],(function(e){var n=(e=e[0]).name+"."+t;function o(){Me("Cannot call "+n+" due to unbound types",c)}t.startsWith("@@")&&(t=Symbol[t.substring(2)]),s&&e.registeredClass.pureVirtualFunctions.push(t);var l=e.registeredClass.instancePrototype,d=l[t];return void 0===d||void 0===d.overloadTable&&d.className!==e.name&&d.argCount===a-2?(o.argCount=a-2,o.className=e.name,l[t]=o):(ge(l,t,n),l[t].overloadTable[a-2]=o),Y([],c,(function(o){var s=Pe(n,o,e,i,r);return void 0===l[t].overloadTable?(s.argCount=a-2,l[t]=s):l[t].overloadTable[a-2]=s,[]})),[]}))},D:function(e,t){ae(e,{name:t=X(t),fromWireType:function(e){var t=we.toValue(e);return ke(e),t},toWireType:function(e,t){return we.toHandle(t)},argPackAdvance:8,readValueFromPointer:U,destructorFunction:null})},q:function(e,t,a){var n=q(a);ae(e,{name:t=X(t),fromWireType:function(e){return e},toWireType:function(e,t){return t},argPackAdvance:8,readValueFromPointer:Le(t,n),destructorFunction:null})},f:function(e,t,a,n,o){t=X(t);var i=q(a),r=e=>e;if(0===n){var s=32-8*a;r=e=>e<<s>>>s}var l=t.includes("unsigned");ae(e,{name:t,fromWireType:r,toWireType:l?function(e,t){return this.name,t>>>0}:function(e,t){return this.name,t},argPackAdvance:8,readValueFromPointer:je(t,i,0!==n),destructorFunction:null})},b:function(e,t,a){var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function o(e){var t=C,a=t[e>>=2],o=t[e+1];return new n(t.buffer,o,a)}ae(e,{name:a=X(a),fromWireType:o,argPackAdvance:8,readValueFromPointer:o},{ignoreDuplicateRegistrations:!0})},p:function(e,t){var a="std::string"===(t=X(t));ae(e,{name:t,fromWireType:function(e){var t,n=C[e>>2],o=e+4;if(a)for(var i=o,r=0;r<=n;++r){var s=o+r;if(r==n||0==_[s]){var l=Fe(i,s-i);void 0===t?t=l:(t+=String.fromCharCode(0),t+=l),i=s+1}}else{var c=new Array(n);for(r=0;r<n;++r)c[r]=String.fromCharCode(_[o+r]);t=c.join("")}return rt(e),t},toWireType:function(e,t){var n;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var o="string"==typeof t;o||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||te("Cannot pass non-string to std::string"),n=a&&o?Ue(t):t.length;var i=it(4+n+1),r=i+4;if(C[i>>2]=n,a&&o)Be(t,r,n+1);else if(o)for(var s=0;s<n;++s){var l=t.charCodeAt(s);l>255&&(rt(r),te("String has UTF-16 code units that do not fit in 8 bits")),_[r+s]=l}else for(s=0;s<n;++s)_[r+s]=t[s];return null!==e&&e.push(rt,i),i},argPackAdvance:8,readValueFromPointer:U,destructorFunction:function(e){rt(e)}})},o:function(e,t,a){var n,o,i,r,s;a=X(a),2===t?(n=Ge,o=We,r=$e,i=()=>g,s=1):4===t&&(n=ze,o=Ze,r=Ke,i=()=>C,s=2),ae(e,{name:a,fromWireType:function(e){for(var a,o=C[e>>2],r=i(),l=e+4,c=0;c<=o;++c){var d=e+4+c*t;if(c==o||0==r[d>>s]){var u=n(l,d-l);void 0===a?a=u:(a+=String.fromCharCode(0),a+=u),l=d+t}}return rt(e),a},toWireType:function(e,n){"string"!=typeof n&&te("Cannot pass non-string to C++ string type "+a);var i=r(n),l=it(4+i+t);return C[l>>2]=i>>s,o(n,l+4,i+t),null!==e&&e.push(rt,l),l},argPackAdvance:8,readValueFromPointer:U,destructorFunction:function(e){rt(e)}})},K:function(e,t,a,n,o,i){j[e]={name:X(t),rawConstructor:Ne(a,n),rawDestructor:Ne(o,i),fields:[]}},t:function(e,t,a,n,o,i,r,s,l,c){j[e].fields.push({fieldName:X(t),getterReturnType:a,getter:Ne(n,o),getterContext:i,setterArgumentType:r,setter:Ne(s,l),setterContext:c})},F:function(e,t){ae(e,{isVoid:!0,name:t=X(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},z:function(){return true},u:function(e,t,a){e=we.toValue(e),t=Qe(t,"emval::as");var n=[],o=we.toHandle(n);return C[a>>2]=o,t.toWireType(n,e)},r:function(e,t,a,n,o){return(e=Je[e])(t=we.toValue(t),a=qe(a),function(e){var t=[];return C[e>>2]=we.toHandle(t),t}(n),o)},g:function(e,t,a,n){(e=Je[e])(t=we.toValue(t),a=qe(a),null,n)},a:ke,m:function(e){return 0===e?we.toHandle(Xe()):(e=qe(e),we.toHandle(Xe()[e]))},c:function(e,t){var a=function(e,t){for(var a=new Array(e),n=0;n<e;++n)a[n]=Qe(C[t+4*n>>2],"parameter "+n);return a}(e,t),n=a[0],o=n.name+"_$"+a.slice(1).map((function(e){return e.name})).join("_")+"$",i=tt[o];if(void 0!==i)return i;var r,s,l=new Array(e-1);return r=(t,o,i,r)=>{for(var s=0,c=0;c<e-1;++c)l[c]=a[c+1].readValueFromPointer(r+s),s+=a[c+1].argPackAdvance;var d=t[o].apply(t,l);for(c=0;c<e-1;++c)a[c+1].deleteObject&&a[c+1].deleteObject(l[c]);if(!n.isVoid)return n.toWireType(i,d)},s=Je.length,Je.push(r),i=s,tt[o]=i,i},s:function(e,t){return e=we.toValue(e),t=we.toValue(t),we.toHandle(e[t])},i:function(e){e>4&&(Re.get(e).refcount+=1)},G:function(e,t,a,n){e=we.toValue(e);var o=at[t];return o||(o=function(e){var t=new Array(e+1);return function(a,n,o){t[0]=a;for(var i=0;i<e;++i){var r=Qe(C[n+4*i>>2],"parameter "+i);t[i+1]=r.readValueFromPointer(o),o+=r.argPackAdvance}var s=new(a.bind.apply(a,t));return we.toHandle(s)}}(t),at[t]=o),o(e,a,n)},H:function(){return we.toHandle([])},J:function(e){e=we.toValue(e);for(var t=new Array(e.length),a=0;a<e.length;a++)t[a]=e[a];return we.toHandle(t)},d:function(e){return we.toHandle(qe(e))},l:function(e){B(we.toValue(e)),ke(e)},h:function(e,t,a){e=we.toValue(e),t=we.toValue(t),a=we.toValue(a),e[t]=a},k:function(e,t){var a=(e=Qe(e,"_emval_take_value")).readValueFromPointer(t);return we.toHandle(a)},n:function(){M("")},A:function(){return Date.now()},y:et,B:function(e,t,a){_.copyWithin(e,t,t+a)},x:function(e){var t,a=_.length,n=2147483648;if((e>>>=0)>n)return!1;for(var o=1;o<=4;o*=2){var i=a*(1+.2/o);if(i=Math.min(i,e+100663296),nt(Math.min(n,(t=Math.max(e,i))+(65536-t%65536)%65536)))return!0}return!1}};!function(){var e,t,o,i,r={a:ot};function s(e,t){var a,o=e.exports;return n.asm=o,d=n.asm.L,T(),S=n.asm.O,a=n.asm.M,y.unshift(a),function(e){if(b--,n.monitorRunDependencies&&n.monitorRunDependencies(b),0==b&&x){var t=x;x=null,t()}}(),o}if(b++,n.monitorRunDependencies&&n.monitorRunDependencies(b),n.instantiateWasm)try{return n.instantiateWasm(r,s)}catch(e){u("Module.instantiateWasm callback failed with error: "+e),a(e)}(e=c,t=O,o=r,i=function(e){s(e.instance)},e||"function"!=typeof WebAssembly.instantiateStreaming||R(t)||"function"!=typeof fetch?w(t,o,i):fetch(t,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,o).then(i,(function(e){return u("wasm streaming compile failed: "+e),u("falling back to ArrayBuffer instantiation"),w(t,o,i)}))}))).catch(a)}();var it=n._malloc=function(){return(it=n._malloc=n.asm.N).apply(null,arguments)},rt=n._free=function(){return(rt=n._free=n.asm.P).apply(null,arguments)},st=n.___getTypeName=function(){return(st=n.___getTypeName=n.asm.Q).apply(null,arguments)};n.__embind_initialize_bindings=function(){return(n.__embind_initialize_bindings=n.asm.R).apply(null,arguments)};var lt,ct=function(){return(ct=n.asm.S).apply(null,arguments)};function dt(){function e(){lt||(lt=!0,n.calledRun=!0,E||(D(y),t(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),N.unshift(e);var e;D(N)}()))}b>0||(function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),I.unshift(e);var e;D(I)}(),b>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),e()}),1)):e()))}if(n.stringToUTF8=Be,n.lengthBytesUTF8=Ue,x=function e(){lt||dt(),lt||(x=e)},n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return dt(),e.ready});e.exports=a,a.getUrl=function(e){return"https://st.mycdn.me/static/vmoji/1-2-3/"+e}},p(_={exports:{}}),_.exports);const g=65534;function A(e,t,a,n=null,o=null,i=null){if(e<=0||t<=0)throw new RangeError("animojiWidth and animojiHeight must be greater than 0");null!=n||(n=1.3),null!=o||(o=i?i.width/i.height:16/9);let r=0,s=0,l=0,c=0,d=1;if(t>=e?(r=t*o/n,s=t/n):(r=e/n,s=e/o/n),l=(r-e)/2,c=s/2-a,i){const{width:e,height:t}=i;d=Math.max(e/r,t/s),r=e,s=t,l*=d,c*=d}return{canvasWidth:Math.round(r),canvasHeight:Math.round(s),posX:Math.floor(l),posY:Math.floor(c),scale:d}}function C(e,t){let a;if(t){const t=Number.isNaN(e)?250:e>15?e:16;a=10-5*Math.log((t-15)/75)}else{const t=Number.isNaN(e)?250:e>9?e:9.1;a=10-3*Math.log((t-9)/75)}return a>24?a=24:a<10&&(a=10),Math.floor(a)}function v(e,t,a,n,o,i){const r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,s=r?self:null==i?void 0:i.messagePort,l="animojiCtxStorage",c={width:1280,height:720};let d=null;const u={};let p,_,m=[];const h=Object.assign(Object.assign({},{useFrameBatching:!1,useLowResolution:!1,isFpsLimitCalculated:!1,fpsLimit:10}),JSON.parse(o)),{useLowResolution:g,useFrameBatching:A}=h;let{fpsLimit:C,isFpsLimitCalculated:v}=h,f=!0,S=250,E=0,T=0,I=0,y=0;self[l]||(self[l]={});let N=!0;function b(){var e;const t=["A6EDBD","A1DDF0","AACCF2","B5AAF2","F2AAB5","F2D983","F2C0A5"];return null!==(e=function(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}(t[Math.floor(Math.random()*t.length)]))&&void 0!==e?e:[0,0,0]}function x(e){var t,a,n;if(!d)return s.postMessage({type:"frame",error:"Fatal initialization error"}),null;let o=u[e];return o||(o={participantId:e,illustration:new d.Illustration,fill:b(),hasSvg:!1,toUpdateTransformation:!1,eyesPosY:0,outImgSize:null,positioningParams:null,canvas:null!==(t=null==i?void 0:i.animojiCanvasStorage[e])&&void 0!==t?t:null,ctx:null!==(n=null===(a=null===self||void 0===self?void 0:self[l])||void 0===a?void 0:a[e])&&void 0!==n?n:null},u[e]=o,P(),s.postMessage({type:"debug",message:`AnimojiDecoderWorker: new illustration created for participantId ${e}`})),o}function M(e,t){const{illustration:n}=e;let{outImgSize:o,eyesPosY:i,positioningParams:r}=e,s=t&&o&&((null==o?void 0:o.width)!==(null==t?void 0:t.width)||(null==o?void 0:o.height)!==(null==t?void 0:t.height));o||(o=n.getOutImgSize(),e.outImgSize=o,s=!0),i||(i=n.getEyesPosY(),e.eyesPosY=i,s=!0);const{width:l,height:c}=o;return r&&!s||(r=a(l,c,i,null,null,t),e.positioningParams=r,e.toUpdateTransformation=!0),r}function O(){C=n(S,r),S<=(r?10:5)&&(f=g),s.postMessage({type:"debug",message:`AnimojiDecoderWorker: calculated fpsLimit: ${C}, normalizedTimeToRender: ${S.toFixed(2)}, useLowResolution: ${f}`}),s.postMessage({type:"fps_limit",fpsLimit:C,normalizedTimeToRender:S})}function P(){m=Object.keys(u).sort(),N=!0}function R({participantId:e,svg:t}){var a;const n=x(e);if(n&&t){if(!n.illustration.checkSVGData(t))return void s.postMessage({type:"frame",error:"Svg provided for a new participantId is not valid"});n.hasSvg&&d&&(null===(a=n.illustration)||void 0===a||a.delete(),n.illustration=new d.Illustration,n.outImgSize=null,n.eyesPosY=0,n.positioningParams=null,s.postMessage({type:"debug",message:`AnimojiDecoderWorker: updated vmoji SVG for participantId ${e}`})),n.illustration.initFromData(t),n.hasSvg=!0}}function k(e=(f?null:c)){A?function(e){for(const t of m){const a=u[t];if(!a||!a.hasSvg){s.postMessage({type:"frame",error:`Trying to draw frame with no svg attached to participantId ${t}`,participantId:t});continue}const{illustration:n,fill:[o,i,r]}=a,{canvasWidth:c,canvasHeight:d,posX:h,posY:g,scale:A}=M(a,e);(a.canvas||a.ctx)&&(a.canvas=null,a.ctx=null),p||(p=new OffscreenCanvas(c,d),_=p.getContext("2d",{alpha:!1,willReadFrequently:!0}),self[l][l]=_);const C=m.indexOf(t);N&&(p.width=c*m.length,p.height=d,N=!1),_&&(_.setTransform(1,0,0,1,c*C,0),_.fillStyle=`rgb(${o},${i},${r})`,_.fillRect(0,0,c,d),_.setTransform(A,0,0,A,c*C+h,g),n.renderOnCanvas(l,l))}if(p&&_){const e=r?_.getImageData(0,0,p.width,p.height).data.buffer:l;s.postMessage({type:"frame",image:e,participantIds:m,width:p.width,height:p.height},e instanceof ArrayBuffer?[e]:[])}}(e):function(e){for(const t of m){const a=u[t];if(!a||!a.hasSvg){s.postMessage({type:"frame",error:`Trying to draw frame with no svg attached to participantId ${t}`,participantId:t});continue}const n=w(a,e);n&&a.canvas&&s.postMessage({type:"frame",image:n,participantIds:t,width:a.canvas.width,height:a.canvas.height},n instanceof ArrayBuffer?[n]:[])}}(e)}function w(e,t){if(!d)return null;let{canvas:a,ctx:n}=e;const{illustration:o,participantId:i,fill:[s,c,u]}=e,{canvasWidth:p,canvasHeight:_,posX:m,posY:h,scale:g}=M(e,t);let A=null;return a||(a=new OffscreenCanvas(p,_),e.canvas=a,n=e.canvas.getContext("2d",{alpha:!1,willReadFrequently:!0}),e.ctx=n,n.setTransform(g,0,0,g,m,h),self[l][i]=n),n&&(e.toUpdateTransformation&&(a.width=p,a.height=_,n.setTransform(g,0,0,g,m,h),e.toUpdateTransformation=!1),n.fillStyle=`rgb(${s},${c},${u})`,n.fillRect(-m,-h,p,_),o.renderOnCanvas(l,i),A=r?n.getImageData(0,0,a.width,a.height).data.buffer:i),A}e({locateFile:t}).then((e=>d=e)).then((()=>{s.onmessage=({data:e})=>{switch(e.type){case"set_bg_fill":!function({participantId:e,fill:t}){const a=x(e);a&&t&&(a.fill=t)}(e);break;case"set_svg":R(e);break;case"set_svg_ecnrypted":!function({participantId:e,svgEncrypted:t,userId:a}){if(!d)return void s.postMessage({type:"frame",error:"Fatal initialization error"});const n=x(e);if(!n)return;const o=d._malloc(t.byteLength);let i;d.HEAPU8.set(new Uint8Array(t),o);try{i=n.illustration.decryptSVG(a,o,t.byteLength)}catch(e){s.postMessage({type:"frame",error:"Error decrypting SVG: "+String(e)})}finally{d._free(o)}i&&R({type:"set_svg",participantId:e,svg:i})}(e);break;case"frame":!function({participantId:e,data:t,targetDimensions:a=(f?null:c)}){if(!d)return void s.postMessage({type:"frame",error:"Fatal initialization error"});const n=performance.now(),o=u[e];if(!o||!o.hasSvg)return void s.postMessage({type:"frame",error:`Trying to draw frame with no svg attached to participantId ${e}`,participantId:e});const i=d.HEAPF32.BYTES_PER_ELEMENT,r=d._malloc(t.byteLength),l=t.byteLength/i/2,p=new Float32Array(t);if(d.HEAPF32.set(p,r/i),o.illustration.update(r,l),d._free(r),v)return void(I||(I=self.setInterval(k,1e3/C)));const _=w(o,a);!function(e){T+=e,E+=1,S=T/E}(performance.now()-n),y||(y=self.setTimeout(O,1e3)),_&&o.canvas&&s.postMessage({type:"frame",participantIds:e,image:_,width:o.canvas.width,height:o.canvas.height},_ instanceof ArrayBuffer?[_]:[])}(e);break;case"remove_participant":t=e.participantId,u.hasOwnProperty(t)&&(null===(a=u[t].illustration)||void 0===a||a.delete(),delete u[t],P(),s.postMessage({type:"debug",message:`AnimojiDecoderWorker: illustration removed for participantId ${t}`}));break;case"set_fps_limit":!function(e){if(!(v&&C<=e.fpsLimit)){if(C=e.fpsLimit,v=!0,C>=24){N=!0;for(const e of m){const t=u[e];t&&(t.positioningParams=null)}}I>0&&self.clearInterval(I),I=self.setInterval(k,1e3/C),s.postMessage({type:"debug",message:`AnimojiDecoderWorker: force set fpsLimit command received: ${C}`})}}(e)}var t,a},s.postMessage({type:"init"})})).catch((e=>{s.postMessage({type:"error",error:String(e)})}))}class f{}class S extends f{constructor(){super(...arguments),this._worker=null}init(e,t,a,o={}){return n(this,void 0,void 0,(function*(){s.debug("AnimojiDecoder started"),yield this._createWorker(v,(a=>{if(a.error)s.warn("AnimojiDecoder",a.error),t(a.participantIds);else{const t=a,n=new ImageData(new Uint8ClampedArray(t.image),t.width,t.height);e(Object.assign(t,{image:n}))}}),(e=>a(e.fpsLimit,e.normalizedTimeToRender)),[h,h.getUrl,A,C,`'${JSON.stringify(o)}'`])}))}sendTask(e){switch(e.type){case"frame":this._sendToWorker(e,[e.data]);break;case"set_svg_ecnrypted":case"set_bg_fill":case"set_svg":case"remove_participant":case"set_fps_limit":this._sendToWorker(e)}}destroy(){this._removeWorker(),s.debug("AnimojiDecoder destroyed")}_removeWorker(){var e;null===(e=this._worker)||void 0===e||e.terminate(),this._worker=null}_sendToWorker(e,t=[]){var a;null===(a=this._worker)||void 0===a||a.postMessage(e,t)}_createWorker(e,t,a,o=[],i={},r=[]){return n(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{this._worker=new Worker(u(e,o)),this._worker.onmessage=({data:e})=>{switch(e.type){case"init":n();break;case"error":i(e.error);break;case"frame":t(e);break;case"fps_limit":a(e);break;case"debug":s.debug(e.message)}}}))}))}}class E extends f{constructor(){super(...arguments),this.messagePort=null}init(e,t,a,n={}){return s.debug("AnimojiDecoder started"),new Promise(((o,r)=>{const l=new MessageChannel;this.messagePort=l.port1,v(h,h.getUrl,A,C,JSON.stringify(n),{animojiCanvasStorage:i,messagePort:l.port2}),this.messagePort.onmessage=({data:n})=>{switch(n.type){case"init":o();break;case"error":r(n.error);break;case"frame":const i=n;if(i.error)s.warn("AnimojiDecoder",i.error),t(i.participantIds);else{const t=n;e(Object.assign(t,{image:t.image}))}break;case"fps_limit":{const e=n;a(e.fpsLimit,e.normalizedTimeToRender);break}case"debug":s.debug(n.message)}}}))}sendTask(e){switch(e.type){case"frame":this._sendToWorker(e,[e.data]);break;case"set_svg_ecnrypted":case"set_bg_fill":case"set_svg":case"remove_participant":case"set_fps_limit":this._sendToWorker(e)}}destroy(){this.messagePort=null,s.debug("AnimojiDecoder destroyed")}_sendToWorker(e,t=[]){var a;null===(a=this.messagePort)||void 0===a||a.postMessage(e,t)}}class T{constructor(e,t,a,n=!1){this._countIn=0,this._countOut=0,this._countThresholdReached=0,this._reportIntervalId=0,this._resumeTimeoutId=0,this._debug=!1,this.onThrottling=()=>{},this._reportRateMs=e,this._ratioThreshold=t,this._controlSequenceCount=a,this._debug=n,this.resume()}clearReportInterval(){window.clearInterval(this._reportIntervalId),this._reportIntervalId=0}clearResumeTimeout(){window.clearTimeout(this._resumeTimeoutId),this._resumeTimeoutId=0}setCountIn(e){this._countIn=e}incIn(){this._countIn+=1}incOut(){this._countOut+=1}resetCounters(){this._countIn=0,this._countOut=0}report(){let e=this._countOut/this._countIn;e=Number.isNaN(e)?1:e,this.resetCounters(),this._debug&&s.debug(`RatioReporter: Decoding ratio for the last ${this._reportRateMs} ms: ${e.toFixed(2)}`),e>=this._ratioThreshold?this._countThresholdReached=0:(this._countThresholdReached+=1,s.debug(`RatioReporter: Ratio threshold reached, ${this._countThresholdReached} in sequence`),this._countThresholdReached>=this._controlSequenceCount&&(s.warn(`RatioReporter: ${this._countThresholdReached} total threshold reaches in sequence, calling onThrottling callback...`),this._countThresholdReached=0,this.onThrottling()))}pause(e){this.clearReportInterval(),e&&(this.clearResumeTimeout(),this._resumeTimeoutId=window.setTimeout((()=>{this._resumeTimeoutId=0,this.resume()}),e))}resume(){this._reportIntervalId||(this.clearResumeTimeout(),this.resetCounters(),this._reportIntervalId=window.setInterval(this.report.bind(this),this._reportRateMs))}destroy(){window.clearInterval(this._reportIntervalId),window.clearTimeout(this._resumeTimeoutId)}}class I{constructor(e=(()=>{}),t=(()=>{}),a=(()=>{}),n=!1,o=!1,i=!1,r=!1,l=null,c=null,d=null){if(this._maxDecoderCapacity=null,this._tasksQueue=[],this._fpsLimit=24,this._useTaskThrottling=!1,this._useInitialFPSLimiting=!1,this._useMainThreadRendering=!1,this._isMainThreadDecoderUsed=!1,this._throttledTaskSender=null,this._onFrame=()=>{},this._onParticipantRemoved=()=>{},this._onTimeToRender=()=>{},this._decoderByParticipantId={},this._availableDecoders=[],this._decodersIsReady=new Map,this._decodersLoad=new Map,this._ratioReporter=null,s.debug("AnimojiDecoderPool: started"),null!==c&&c<1)throw new RangeError("Max pool size must be greater than 0");if(null!==d&&d<1)throw new RangeError("Decoder capacity must be greater than 0");this._decoderOptions=null!=l?l:{},this.maxPoolSize=null!=c?c:navigator.hardwareConcurrency-1||2,this._decoderCapacity=null!=d?d:1,this._onFrame=e,this._onParticipantRemoved=t,this._onTimeToRender=a,this._useTaskThrottling=i,this._useInitialFPSLimiting=o,this._useMainThreadRendering=r,n&&(this._ratioReporter=new T(1500,.94,3),this._ratioReporter.pause(5e3),this._ratioReporter.onThrottling=()=>{if(!this._decreaseDecoderCapacity()){const e=Math.floor(this._fpsLimit/1.25)||1;s.warn(`AnimojiDecoderPool: throttling detected, lowering FPS limit: ${this._fpsLimit} -> ${e}`),this._fpsLimit=e,this.load>0&&(this._updateThrottledTaskSender(),this._sendSetFPSLimit(e))}})}get size(){return this._decodersLoad.size}get load(){return Array.from(this._decodersLoad.values()).reduce(((e,t)=>e+t),0)}get capacity(){return this._decoderCapacity*this.maxPoolSize}get tasksQueueLength(){return this._tasksQueue.length}_updateThrottledTaskSender(){this._useTaskThrottling&&(this._throttledTaskSender=this._fpsLimit<24?function(e,t){let a,n,o=!1;return function i(...r){if(o)return a=r,void(n=this);e.apply(this,r),o=!0,setTimeout((function(){o=!1,a&&(i.apply(n,a),a=null,n=null)}),t)}}(this._sendTask,1e3/this._fpsLimit/this.load):null,s.debug("AnimojiDecoderPool: updated throttled task sender",this._throttledTaskSender?{_fpsLimit:this._fpsLimit,load:this.load}:null))}_sendTask(e,t){var a;this._ratioReporter&&(this._useTaskThrottling?"frame"===t.type&&(null===(a=this._ratioReporter)||void 0===a||a.incIn()):this._ratioReporter.setCountIn(this._fpsLimit*this.load*1.5)),e.sendTask(t)}_sendTaskThrottled(e,t){this._fpsLimit<24&&!this._throttledTaskSender&&this._updateThrottledTaskSender(),"frame"===t.type&&this._throttledTaskSender?this._throttledTaskSender(e,t):this._sendTask(e,t)}_removeDecoder(e){var t;const a=this._availableDecoders.indexOf(e);-1!==a&&this._availableDecoders.splice(a,1),e instanceof E&&(this._isMainThreadDecoderUsed=!1),this._decodersIsReady.delete(e),this._decodersLoad.delete(e),e.destroy(),0===this.size&&(null===(t=this._ratioReporter)||void 0===t||t.pause()),this._updateThrottledTaskSender(),s.debug(`AnimojiDecoderPool: decoder removed, pool size: ${this.size+1} -> ${this.size}`)}_runNext(){const e=[];this._tasksQueue.forEach((t=>{const a=this._decoderByParticipantId[t.participantId];this._decodersIsReady.get(a)?this._sendTaskThrottled(a,t):e.push(t)})),this._tasksQueue=e}_sendSetFPSLimit(e){this._decodersLoad.forEach(((t,a)=>{this._sendTask(a,{type:"set_fps_limit",participantId:"",fpsLimit:e})}))}_addNewDecoder(){var e;if(this.size===this.maxPoolSize)return null;let t;return this._useMainThreadRendering&&!this._isMainThreadDecoderUsed?(t=new E,this._isMainThreadDecoderUsed=!0):t=new S,this._decodersIsReady.set(t,!1),this._decodersLoad.set(t,0),this._availableDecoders.push(t),t.init((e=>{var t;null===(t=this._ratioReporter)||void 0===t||t.incOut(),this._onFrame(e)}),(e=>{var t;null===(t=this._ratioReporter)||void 0===t||t.incOut(),e&&(Array.isArray(e)?e:[e]).forEach((e=>this._onParticipantRemoved(e)))}),((e,t)=>{this._onTimeToRender(t),!this._useInitialFPSLimiting||this._decoderOptions.isFpsLimitCalculated&&e>=this._fpsLimit||(s.debug(`AnimojiDecoderPool: received fpsLimit from decoder, setting FPS limit: ${this._fpsLimit} -> ${e}`),this._fpsLimit=e,this._updateThrottledTaskSender(),this._sendSetFPSLimit(e))}),this._decoderOptions).then((()=>{this._decodersIsReady.set(t,!0),this._runNext()})),1===this.size&&(null===(e=this._ratioReporter)||void 0===e||e.resume()),s.debug(`AnimojiDecoderPool: new decoder allocated, pool size: ${this.size-1} -> ${this.size}`),t}_forceAvailableDecoder(){var e;const t=null===(e=Object.keys(this._decoderByParticipantId))||void 0===e?void 0:e[0];t&&this.removeParticipant(t)}_increaseDecoderCapacity(e=1){this._maxDecoderCapacity&&this._decoderCapacity+e>this._maxDecoderCapacity?s.warn(`AnimojiDecoderPool: failed to increase decoder capacity\n                ${this._decoderCapacity} -> ${this._decoderCapacity+e}.\n                Max capacity reached: ${this._maxDecoderCapacity}.\n            `):(this._decoderCapacity+=e,this._decodersLoad.forEach(((e,t)=>{this._availableDecoders.push(t)})),s.log(`AnimojiDecoderPool: increased decoder capacity ${this._decoderCapacity-e} -> ${this._decoderCapacity}`))}_decreaseDecoderCapacity(e=1){return!(this._decoderCapacity-e<1||(this._decoderCapacity-=e,this._maxDecoderCapacity=this._decoderCapacity,this._rebalanceDecoders(),s.warn(`AnimojiDecoderPool: decreased decoder capacity ${this._decoderCapacity+e} -> ${this._decoderCapacity}`),0))}_rebalanceDecoders(){var e;null===(e=this._ratioReporter)||void 0===e||e.pause(5e3),this._decodersLoad.forEach(((e,t)=>{var a;if(this._maxDecoderCapacity&&e>this._maxDecoderCapacity){let n=e-this._maxDecoderCapacity;const o=Object.entries(this._decoderByParticipantId);for(;n;){const e=null===(a=o.find((([e,a])=>a===t)))||void 0===a?void 0:a[0];if(!e)break;this.removeParticipant(e),n-=1}}this._maxDecoderCapacity&&e===this._maxDecoderCapacity&&this._availableDecoders.includes(t)&&this._availableDecoders.splice(this._availableDecoders.indexOf(t),1)}))}_updateDecoderLoad(e,t){0!==t?(this._decodersLoad.set(e,t),this._updateThrottledTaskSender(),this._availableDecoders.includes(e)?this._maxDecoderCapacity&&t>=this._maxDecoderCapacity&&this._availableDecoders.splice(this._availableDecoders.indexOf(e),1):(!this._maxDecoderCapacity||t<this._maxDecoderCapacity)&&this._availableDecoders.unshift(e)):this._removeDecoder(e)}_getAvailableDecoder(){return this._availableDecoders.length>0?this._availableDecoders[0]:this._addNewDecoder()}_addTaskExistingParticipant(e,t){this._decodersIsReady.get(e)?this._sendTaskThrottled(e,t):this._tasksQueue.push(t)}_addTaskNewParticipant(e){var t;if("frame"!==e.type)return void this._tasksQueue.push(e);this.load===this.capacity&&this._increaseDecoderCapacity();let a=this._getAvailableDecoder();if(!a){if("frame"!==e.type||!e.isMe)return void s.warn("AnimojiDecoderPool: No available decoders found for a new participant task",e);if(s.warn("AnimojiDecoderPool: Forcing participant removal to serve own animoji rendering",e),this._forceAvailableDecoder(),a=this._getAvailableDecoder(),!a)return void s.warn("AnimojiDecoderPool: Failed to get available decoder after force freeing",e);this._onParticipantRemoved(e.participantId)}this._decoderByParticipantId[e.participantId]=a,s.debug(`AnimojiDecoderPool: new participant added, participantId ${e.participantId}`);const n=(null!==(t=this._decodersLoad.get(a))&&void 0!==t?t:0)+1;n===this._decoderCapacity&&this._availableDecoders.splice(this._availableDecoders.indexOf(a),1),this._decodersLoad.set(a,n),this._updateThrottledTaskSender(),this._decodersIsReady.get(a)?this._sendTaskThrottled(a,e):this._tasksQueue.push(e),this._runNext()}addTask(e){const t=this._decoderByParticipantId[e.participantId];return t?this._addTaskExistingParticipant(t,e):this._addTaskNewParticipant(e),this}removeParticipant(e){var t;const a=this._decoderByParticipantId[e];if(a){delete this._decoderByParticipantId[e],s.debug(`AnimojiDecoderPool: participant removed, participantId ${e}`),this._tasksQueue=this._tasksQueue.filter((t=>t.participantId!==e||["set_svg","set_svg_ecnrypted"].includes(t.type))),this._sendTask(a,{type:"remove_participant",participantId:e});const n=(null!==(t=this._decodersLoad.get(a))&&void 0!==t?t:this._decoderCapacity)-1;this._updateDecoderLoad(a,n),this._onParticipantRemoved(e)}return this}destroy(){var e;s.debug("AnimojiDecoderPool: destroy"),null===(e=this._ratioReporter)||void 0===e||e.destroy(),this._decodersLoad.forEach(((e,t)=>{t.destroy()}))}}class y{static setSvgData(e){y.svgData=e}static getPreview(e=null,t=720,a=720){return n(this,void 0,void 0,(function*(){const n=e||y.svgData;if(!n)throw new Error("No svg");const o="preview";return new Promise(((e,i)=>{let r=0;const s=new I((t=>{e(t),window.clearTimeout(r),s.destroy()}),(()=>{}));if(r=window.setTimeout((()=>{s.destroy(),i("Timeout")}),3e3),n.svg instanceof ArrayBuffer){const{svg:e,userId:t}=n;s.addTask({type:"set_svg_ecnrypted",participantId:o,svgEncrypted:e,userId:t})}else s.addTask({type:"set_svg",participantId:o,svg:n.svg});const l=new Uint8Array(248);s.addTask({type:"frame",participantId:o,isMe:!0,data:l.buffer,targetDimensions:{width:t,height:a}})}))}))}}y.timeToRender=0,y.onTimeToRender=null;const N="animojiCtxStorage";class b{constructor(e,t,a){this._canvas=null,this._canvasContext=null,this._stream=null,this._track=null,this._onStream=()=>{},this._useImageBitmap="ImageBitmap"in window,this._onStream=e,this._participantId=t,this._useImageBitmap=a,this._createCanvas(1280,720),s.debug("AnimojiRenderer started")}_createCanvas(e,t){this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this._canvas.style.pointerEvents="none",this._canvas.style.visibility="hidden",this._canvas.style.position="absolute",this._canvas.style.width="160px",this._canvas.style.height="90px",this._canvas.style.bottom="0",this._canvas.style.right="0",this._canvas.style.zIndex="5000",document.body.appendChild(this._canvas),this._useImageBitmap?this._canvasContext=this._canvas.getContext("bitmaprenderer"):this._canvasContext=this._canvas.getContext("2d",{alpha:!1}),i[this._participantId]=this._canvas,self[N]||(self[N]={}),self[N][this._participantId]=this._canvasContext)}_removeStream(){this._stream&&(this._stream.getTracks().forEach((e=>e.stop())),this._stream=null,this._track=null),this._canvasContext=null;try{this._canvas&&document.body.removeChild(this._canvas)}catch(e){}this._canvas=null}_requestCanvasFrame(){this._track&&this._track.requestFrame?this._track.requestFrame():this._stream&&this._stream.requestFrame&&this._stream.requestFrame()}drawImage({image:e,width:t,height:a,index:o}){var i;return n(this,void 0,void 0,(function*(){const n=void 0!==o;this._track||(this._stream=null===(i=this._canvas)||void 0===i?void 0:i.captureStream(0),this._track=this._stream.getVideoTracks()[0],this._stream&&this._onStream(this._stream));const r=this._canvas;if(r){if(r.width!==t&&(r.width=t,r.height=a),e instanceof ImageData)if(n)if(this._useImageBitmap){const n=yield createImageBitmap(e,t*o,0,t,a);this._canvasContext.transferFromImageBitmap(n),n.close()}else this._canvasContext.putImageData(e,-t*o,0,t*o,0,t,a);else if(this._useImageBitmap){const n=yield createImageBitmap(e,0,0,t,a);this._canvasContext.transferFromImageBitmap(n),n.close()}else this._canvasContext.putImageData(e,0,0);this._requestCanvasFrame()}}))}destroy(){this._removeStream(),s.debug("AnimojiRenderer destroyed")}}class x{constructor(e,t,a={}){this._datachannel=null,this._participantIdRegistry=null,this._participantId=null,this._myParticipantId=null,this._renderers={},this._svgCache={},this._lastFrameReceivedByParticipantId={},this._clearIdleParticipantsInterval=0,this._animojiDecoderPool=null,this._onStream=()=>{},this._onEos=()=>{},s.debug("AnimojiReceiver started"),this._onStream=e,this._onEos=t;const{useImageBitmapIfAvailable:n,useFPSControl:o,useMainThreadRendering:i,useInitialFPSLimiting:r,useTaskThrottling:l,maxPoolSize:c,decoderCapacity:d,decoderOptions:u}=Object.assign({useImageBitmapIfAvailable:!1,useFPSControl:!1,useInitialFPSLimiting:!1,useTaskThrottling:!1,useMainThreadRendering:!1,useFullClientRendering:!1,maxPoolSize:null,decoderCapacity:null,decoderOptions:{}},a);this._useImageBitmap=n&&"ImageBitmap"in window,this._animojiDecoderPool=new I(this._onFrame.bind(this),this._onParticipantRemoved.bind(this),(e=>{var t;y.timeToRender=e,null===(t=y.onTimeToRender)||void 0===t||t.call(y,e)}),o,r,l,i,u,c,d),this._datachannel&&(this._datachannel.onmessage=e=>this._onDataChannelMessage(e.data)),this._clearIdleParticipantsInterval=window.setInterval(this._clearIdleParticipants.bind(this),1e3)}_onFrame(e){const t=Array.isArray(e.participantIds),a=t?e.participantIds:[e.participantIds],{width:n,height:o,image:i}=e;for(const e of a){const r=this._renderers[e],l={width:Math.floor(n/a.length),height:o,image:i};t&&(l.index=a.indexOf(e)),r?r.drawImage(l):s.warn(`AnimojiReceiver: No renderer found for participant id ${e}`)}}_onDataChannelMessage(e){var t,a,n;const o=function(e){const t=new DataView(e),a=t.getUint8(0),n=t.getUint16(1),o=t.getUint32(3),i=t.getUint16(7),r=!!(1&t.getUint8(9));return{version:a,sequence:n,timestamp:o,ssrc:i,eos:r,data:r?null:e.slice(10)}}(e);let i;i=o.ssrc===g?this._myParticipantId:null!==(n=null===(a=null===(t=this._participantIdRegistry)||void 0===t?void 0:t.getStreamDescription(o.ssrc))||void 0===a?void 0:a.participantId)&&void 0!==n?n:this._participantId,i?this._onAnimojiPacket(i,o):s.warn(`AnimojiReceiver: Participant id for ssrc ${o.ssrc} not found in registry`)}_onAnimojiPacket(e,t){var a,n;if(t.eos)return void this.close(e);this._lastFrameReceivedByParticipantId[e]=Date.now();let o=this._renderers[e];o||(o=new b((t=>this._onStream(e,t)),e,this._useImageBitmap),this._renderers[e]=o),(null===(a=this._svgCache[e])||void 0===a?void 0:a.svgData)&&!this._svgCache[e].isSet&&this.setParticipantSvg(e,this._svgCache[e].svgData),t.data&&(null===(n=this._animojiDecoderPool)||void 0===n||n.addTask({type:"frame",participantId:e,isMe:this._myParticipantId===e,data:t.data}))}_onParticipantRemoved(e){this._svgCache[e]&&(this._svgCache[e].isSet=!1),this._destroyRenderer(e),this._onEos(e)}_clearIdleParticipants(){for(const[e,t]of Object.entries(this._lastFrameReceivedByParticipantId))Date.now()-t>=3e3&&(s.warn(`AnimojiReceiver: Participant ${e} timed out after idling for 3000 ms, freeing resources...`),this.close(e))}receive(e){this._onDataChannelMessage(e)}setDataChannel(e){this._datachannel&&(this._datachannel.onbufferedamountlow=null,this._datachannel.onmessage=null),e&&(e.onmessage=e=>this._onDataChannelMessage(e.data)),this._datachannel=e}setParticipantId(e){this._participantId=e}setParticipantIdRegistry(e){this._participantIdRegistry=e}setParticipantSvg(e,t){var a,n;if(t.isMe&&(this._myParticipantId=e),this._svgCache[e]={svgData:t,isSet:!0},t.svg instanceof ArrayBuffer){const{svg:n,userId:o}=t;null===(a=this._animojiDecoderPool)||void 0===a||a.addTask({type:"set_svg_ecnrypted",participantId:e,svgEncrypted:n,userId:o})}else null===(n=this._animojiDecoderPool)||void 0===n||n.addTask({type:"set_svg",participantId:e,svg:t.svg})}close(e){var t;delete this._lastFrameReceivedByParticipantId[e],this._destroyRenderer(e),null===(t=this._animojiDecoderPool)||void 0===t||t.removeParticipant(e)}_destroyRenderer(e){const t=this._renderers[e];t&&(t.destroy(),delete this._renderers[e])}destroy(){var e;this._datachannel&&(this._datachannel.onbufferedamountlow=null,this._datachannel.onmessage=null),window.clearInterval(this._clearIdleParticipantsInterval),this._onStream=()=>{},Object.values(this._renderers).forEach((e=>e.destroy())),null===(e=this._animojiDecoderPool)||void 0===e||e.destroy(),this._renderers={},this._animojiDecoderPool=null,this._participantId=null,this._participantIdRegistry=null,this._svgCache={},s.debug("AnimojiReceiver destroyed")}}function M(){class e extends AudioWorkletProcessor{constructor(){super(),this.lastTimestamp=0,this.frameSampleCount=0,this.frameSampleAverage=0,this.maxInputVolume=.3,this.sequence=0,this.port.postMessage({type:"init"})}process(e){var t;const a=Date.now();let n=0;const o=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t[0];if((null==o?void 0:o.length)&&(n=o.reduce(((e,t)=>e+Math.abs(t)),0)/o.length),this.frameSampleAverage=(this.frameSampleAverage*this.frameSampleCount+n)/(this.frameSampleCount+1),this.frameSampleCount+=1,a-this.lastTimestamp>40){const e=[];for(let t=0;t<62;t+=1)e.push(0);this.frameSampleAverage>.015&&(e[59]=this.frameSampleAverage/this.maxInputVolume>.5&&this.sequence%2==0?this.frameSampleAverage/2:this.frameSampleAverage,e[0]=this.maxInputVolume/.432),this.sequence+=1,this.frameSampleCount=1,this.maxInputVolume=Math.max(this.maxInputVolume,this.frameSampleAverage),this.lastTimestamp=a;const t=new Float32Array(e).buffer;this.port.postMessage({type:"frame",timestamp:Math.round(a),data:t},[t])}return!0}}registerProcessor("animoji-processor",e)}class O{constructor(){this._audioContext=null,this._worklet=null,this._streamSource=null}init(e,t){return n(this,void 0,void 0,(function*(){s.debug("AnimojiEncoder started"),yield this._createWorklet((t=>{t.error?s.warn("AnimojiEncoder",t.error):e(t)}),t)}))}setStream(e){var t;if(this._audioContext&&this._worklet){const a=e?this._audioContext.createMediaStreamSource(e):null;null===(t=this._streamSource)||void 0===t||t.disconnect(this._worklet),null==a||a.connect(this._worklet),this._streamSource=a}}destroy(){var e;null===(e=this._audioContext)||void 0===e||e.close(),this._worklet=null,this._streamSource=null,this._audioContext=null,s.debug("AnimojiEncoder destroyed")}resume(){var e;null===(e=this._audioContext)||void 0===e||e.resume()}pause(){var e;null===(e=this._audioContext)||void 0===e||e.suspend()}_createWorklet(e,t){return n(this,void 0,void 0,(function*(){return new Promise(((a,n)=>{const o=new(window.AudioContext||window.webkitAudioContext);this._audioContext=o,o.resume().then((()=>o.audioWorklet.addModule(u(M)))).then((()=>{const i=new AudioWorkletNode(o,"animoji-processor");this._worklet=i,t||o.suspend(),i.port.onmessage=({data:t})=>{switch(t.type){case"init":a();break;case"error":n(t.error);break;case"frame":e(t);break;case"debug":s.debug(t.message)}}})).catch((e=>s.warn("Error constructing audio worklet node",e)))}))}))}}let P=0;class R{constructor(e=null,t){this._datachannel=null,this._stream=null,this._workletReady=!1,this._destroyed=!1,this._isPaused=!1,this.onLocalData=()=>{},s.debug("AnimojiSender started"),this._encoder=new O,this._encoder.init(this._onFrame.bind(this),t).then((()=>{this._workletReady=!0,this._stream&&this._encoder.setStream(this._stream)})).catch((e=>s.warn("AnimojiEncoder failed to init:",e))),e&&this.setStream(e)}setStream(e){this._stream=e,this._workletReady&&this._encoder.setStream(e)}setDataChannel(e){this._datachannel=e}resume(){this._encoder.resume(),this._isPaused=!1}pause(){this._isPaused=!0,this._encoder.pause(),this._sendStopPacket()}_onFrame(e,t){if(this._destroyed||this._isPaused)return;if(!e)return void s.warn("Animoji encoding failed: ",t);const a=this._wrapHeader(g,e.timestamp,e.data);this.onLocalData(a),this._send(e)}_wrapHeader(e,t,a=null,n=!1){const o=function(e,t,a,n=null,o=!1){let i=0;o&&(i|=1);const r=new ArrayBuffer(10),s=new DataView(r);if(s.setUint8(0,1),s.setUint16(1,t),s.setUint32(3,a),s.setUint16(7,e),s.setUint8(9,i),!n)return r;const l=new Uint8Array(r.byteLength+n.byteLength);return l.set(new Uint8Array(r),0),l.set(new Uint8Array(n),r.byteLength),l.buffer}(e,t,P,a,n);return P=(P+1)%65536,o}_createStopPacket(e){return this._wrapHeader(e,Date.now(),null,!0)}_send({timestamp:e,data:t}){if(null===this._datachannel)return;if(!this._datachannel||"open"!==this._datachannel.readyState)return void s.warn("AnimojiSender: _send failed, DataChannel is not available");const a=this._wrapHeader(0,e,t);try{this._datachannel.send(a)}catch(e){return void s.warn("AnimojiSender: error sending data to DataChannel",e)}}_sendStopPacket(){var e;if("open"===(null===(e=this._datachannel)||void 0===e?void 0:e.readyState)){const e=this._createStopPacket(0);this._datachannel.send(e)}const t=this._createStopPacket(g);this.onLocalData(t)}destroy(){this._sendStopPacket(),this.onLocalData=()=>{},this._destroyed=!0,this._encoder.destroy(),s.debug("AnimojiSender destroyed")}}},489588:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{IPHONE_SAFARI_BOTTOM_BAR:function(){return o},IPHONE_X_SAFARI_BOTTOM_BAR:function(){return i},IPHONE_KEYBOARD_REJECT_OFFSET:function(){return r},IOS_NO_KEYBOARD_ALLOWED_OFFSET:function(){return s},detectIOS:function(){return l},isIPad:function(){return d},isIPhone:function(){return u},isIOS:function(){return p},isIPadOS:function(){return _},iosMajor:function(){return m},iosMinor:function(){return h},isWKWebView:function(){return g},isScrollBasedViewport:function(){return A},isIPhoneX:function(){return C},isIOSChrome:function(){return v},isLandscapePhone:function(){return f},checkIPadOS:function(){return S}});var n=a(279405),o=45,i=85,r=180,s=70;function l(e){e||(e=n.canUseDOM?navigator.userAgent:"");var t=S(e=e.toLowerCase()),a=t||-1!==e.indexOf("ipad"),o=!a&&-1!==e.search(/iphone|ipod/),i=o||a,r=i&&e.match(/os ([\d_]+) like mac os x/i),s=0,l=0;t?(s=13,l=0):r&&(s=+(r=r[1].split("_"))[0],l=+r[1]),r=null;var c=s<13&&!(11===s&&l<3),d=i&&function(e){if(!n.canUseDOM)return!1;var t=window.webkit;if(t&&t.messageHandlers)return!0;var a=/constructor/i.test(String(window.HTMLElement)),o=!!window.indexedDB;if(-1===e.indexOf("safari")||-1===e.indexOf("version")||navigator.standalone){if(!o&&a||!window.statusbar||!window.statusbar.visible);else if(!a||o)return!0}else;return!1}(e),u=!1;return n.canUseDOM&&(u=i&&375===screen.width&&812===screen.height&&3===window.devicePixelRatio),{isIPad:a,isIPhone:o,isIOS:i,isIPadOS:t,iosMajor:s,iosMinor:l,isWKWebView:d,isScrollBasedViewport:c,isIPhoneX:u,isIOSChrome:-1!==e.search(/crios/i)}}var c=l(),d=function(){return c.isIPad}(),u=function(){return c.isIPhone}(),p=function(){return c.isIOS}(),_=function(){return c.isIPadOS}(),m=function(){return c.iosMajor}(),h=function(){return c.iosMinor}(),g=function(){return c.isWKWebView}(),A=function(){return c.isScrollBasedViewport}(),C=function(){return c.isIPhoneX}(),v=function(){return c.isIOSChrome}();function f(){return 90===Math.abs(window.orientation)&&!d}function S(e){if(!n.canUseDOM)return!1;var t=!/ipad|iphone|ipod/.test(e);return!(!/mac os/.test(e)||!t||"boolean"!=typeof navigator.standalone)}},279405:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{canUseDOM:function(){return a},canUseEventListeners:function(){return n},onDOMLoaded:function(){return o}});var a=function(){return!("undefined"==typeof window||!window.document||!window.document.createElement)}(),n=function(){return a&&!!window.addEventListener}();function o(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}},800582:(e,t,a)=>{"use strict";a.d(t,{loadActiveCallDataAction:()=>f,loadAllowedToCallGroupMembersAction:()=>A,loadAndCopyJoinLink:()=>O,loadCallParticipantsAccumulate:()=>E,loadCallPeersWithWaitingImagesAction:()=>C,loadCallPeersWithoutWaitingImagesAction:()=>v,loadCallUrlLink:()=>T,loadChatMembersAction:()=>h,loadFriendsAction:()=>m,serverSearchGroupMembers:()=>M,setActiveCallData:()=>I,setAnonymousJoin:()=>b,setScrollPosition:()=>P,setWaitingHall:()=>x,startCallStream:()=>N,startUpcomingStream:()=>y});var n=a(11010),o=a(50533),i=a(22412),r=a(878198),s=a(890713),l=a(162532),c=a(455319),d=a(985292),u=a(464380),p=a(659397),_=a(465768);function m(e,t,a){if(e.authorizedGroupId)return Promise.resolve();if((0,r.unpackState)(t).friends.length>0)return Promise.resolve();if(e.getFriends){const t=e.getFriends();if(null!==t)return a({type:i.E_ACTION.SET_FRIENDS,data:t}),Promise.resolve()}return(0,l.loadFriends)().then((({items:e,count:t})=>({friends:e.map(c.normalizeUser),count:t}))).then((({count:e,friends:t})=>{a({type:i.E_ACTION.SET_FRIENDS,data:t,friendsCount:e})}))}function h(e,t,a,n){return(0,l.loadChatMembers)(a).then((a=>{a.profiles&&t({type:i.E_ACTION.SET_CHAT_INFO,data:g(a).sort(((t,a)=>{const n=(0,r.unpackState)(e).me;return t.peerId===n?-1:a.peerId===n?1:0})),conversation:n})}))}function g(e){const t=function(e){const t={};if(!e)return t;for(const a of e)t[a.id]=a;return t}(e.profiles),a=[];for(const n of e.items){const e=t[n.member_id];e&&a.push((0,c.normalizeUser)(e))}return a}function A(e,t,a){return e.authorizedGroupId?t.groupMembers.length>0?Promise.resolve():(0,l.getGroupMembers)(-e.authorizedGroupId,0,i.COUNT_OF_GROUP_MEMBERS_TO_LOAD).then((({items:e,count:t})=>{let a=[],n=[];return e.forEach((e=>{e.deactivated||(a.push((0,c.normalizeUser)(e)),e.can_call_from_group||n.push(e.id))})),{groupMembers:a,unableToCallGroupMembersIds:n,count:t}})).then((({groupMembers:e,unableToCallGroupMembersIds:t,count:n})=>(a({type:i.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:n,groupMembers:e,unableToCallGroupMembersIds:t}),Promise.resolve()))):Promise.resolve()}function C(e,t,a){return(0,l.retryLoadCallPeers)(a).then((e=>{const[a,n,o]=(0,r.convertServerData)(e);return I(t,o),(0,d.preloadImagesFromResponse)({conversation:a,members:n})})).then((({conversation:e,members:n})=>{t({type:i.E_ACTION.LOAD_PEERS,conversation:e,members:n,peerId:a})}))}function v(e,t,a,o,s){return(0,l.retryLoadCallPeers)(o).then((0,n._)((function*(n){const[o,p]=(0,r.convertServerData)(n),_=e.me,m=e.anonymSecret,h=(0,r.vou)(_<0,_),g=p.map((e=>e.peerId)),{profiles:A=[],anonyms:C=[],groups:v=[]}=yield(0,l.getCallParticipants)(s,g,h,_<0,m),f=[];for(let e of C)f.push((0,c.normalizeUser)(e));for(let e of A)f.push((0,c.normalizeUser)(e));for(let e of v)f.push((0,c.normalizeGroup)(e));I(t,p),(0,d.preloadImagesFromResponse)([o,f]).catch((e=>{a.eventHandlers.onError&&e&&a.eventHandlers.onError(e),(0,u.debugMessage)(u.DebugMessageType.ERROR,e),console.error(e)})),t({type:i.E_ACTION.LOAD_PEERS,conversation:o,members:f})}))).catch(_.handlePromiseError)}function f(e,t,a){return a?(0,l.loadCallPeers)(a).then((({items:a,profiles:n})=>{const[r]=a;(0,o.batch)((()=>{I(t,r),function(e,t,a){if(!a||e.config.enableParticipantListChunk)return;t({type:i.E_ACTION.LOAD_PEERS,members:a.map(c.normalizeUser)})}(e,t,n)}))})).catch(_.handlePromiseError):Promise.resolve()}const S={acc:[],timer:0,promise:null,promiseResolve:null,tasks:0,timeout:300};function E(e,t,a,n,o,s){var p;return S.acc.push(...o),S.timer&&clearTimeout(S.timer),S.timer=window.setTimeout((()=>{const o=S.acc,p=S.promiseResolve;S.promise=null,S.promiseResolve=null,S.acc=[],function(e,t,a,n,o,s){const p=(0,r.unpackState)(e).me,_=(0,r.unpackState)(e).anonymSecret,m=p<0?p:void 0;return(0,l.getCallParticipants)(n,o,m,p<0,_).then((({profiles:e=[],anonyms:r=[],secret:l,groups:u=[]})=>{l&&t({type:i.E_ACTION.UPDATE_ANON_SECRET,secret:l});const p=[...e,...r,...u],_=o.filter((e=>!p.find((t=>t&&t.id===e))));_.length>0&&a.eventHandlers.onError&&a.eventHandlers.onError(new Error(`callId: ${n}, timestamp: ${Date.now()}, cant find in participants: ${_.join(", ")}`));const m=[];for(let e of r)m.push((0,c.normalizeUser)(e));for(let t of e)m.push((0,c.normalizeUser)(t));for(let e of u)m.push((0,c.normalizeGroup)(e));const h=(0,d.preloadImagesFromResponse)([{},m]);return s.awaitImages?h.then((()=>[null,m])):[null,m]})).then((([,e])=>{e.length>0&&t({type:i.E_ACTION.LOAD_PEERS,members:e})})).catch((e=>{a.eventHandlers.onError&&e&&a.eventHandlers.onError(e),(0,u.debugMessage)(u.DebugMessageType.ERROR,e),console.error(e)}))}(e,t,a,n,o,s).catch((e=>{a.eventHandlers.onError&&e&&a.eventHandlers.onError(e),(0,u.debugMessage)(u.DebugMessageType.ERROR,e),console.error(e)})).finally(p)}),S.timeout),S.promise=null!=(p=S.promise)?p:new Promise((e=>{S.promiseResolve=e}))}function T(e,t,a,n=0){return(0,l.getCallUrlLink)(t,a,n).then((({join_link:t})=>(e({type:i.E_ACTION.CALL_STATE,callData:{callUrlLink:t}}),t)))}function I(e,t){if(t&&t.call_in_progress){const a=t.unread_count,n=t.last_message_id,o=t.call_in_progress.has_link,r=t.call_in_progress.can_finish_call;e({type:i.E_ACTION.CALL_STATE,callData:{canFinishCall:r,hasUrlLink:o}}),(a||n)&&e({type:i.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:a,chatUpToMsgId:n})}}function y(e,t=!1){return(0,u.startStream)(t,null,e).catch((e=>{(0,u.debugMessage)(u.DebugMessageType.ERROR,e),console.error(e)}))}function N(e,t=null){return(0,l.videoStartStreaming)(e).then((a=>(0,u.startStream)(!!e.is_call_record,null,String(a.stream.ov_id),void 0,void 0,t))).catch((e=>{(0,u.debugMessage)(u.DebugMessageType.ERROR,e),console.error(e)}))}function b(e){return(0,u.changeConversationOptions)({[u.ConversationOption.REQUIRE_AUTH_TO_JOIN]:e})}function x(e){return(0,u.changeConversationOptions)({[u.ConversationOption.WAITING_HALL]:e})}function M(e,t="",a,n){return(0,l.searchGroupMembers)(e,t).then((({items:e})=>{let t=[],o=[];return e&&e.forEach((e=>{e.deactivated||e.id in a.groupMembersCache||(t.push((0,c.normalizeUser)(e)),e.can_call_from_group||o.push(e.id))})),t.length>0&&n({type:i.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:a.groupMembersCount,groupMembers:[...a.groupMembers,...t],unableToCallGroupMembersIds:[...a.unableToCallGroupMembersIds,...o]}),t}))}function O(e,t,a=0){T(e,t,!1,a).then((t=>{(0,p.copyTextToClipboard)(t).then((t=>{t&&e({type:i.E_ACTION.CALL_NOTIFICATION,notification:{type:i.NotificationType.LINK_COPIED_TO_CLIPBOARD}})}))})).catch(console.log)}function P(e,t,a,n){t(a),(0,s.isUseParticipantListChunk)(e)&&(0,s.getParticipantListChunkOnScroll)(n,t,a)}},394406:(e,t,a)=>{"use strict";a.d(t,{clearAsr:()=>i,setAsr:()=>o});var n=a(22412);function o(e,t){e({type:n.E_ACTION.SET_ASR,data:t})}function i(e){e({type:n.E_ACTION.SET_ASR,data:null})}},172927:(e,t,a)=>{"use strict";a.d(t,{onForceCallFinish:()=>r});var n=a(22412),o=a(162532),i=a(419125);function r(e,t,a,r){const s=t.callData.callId||"";a({type:n.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),a({type:n.E_ACTION.SET_LAST_CALL_DATA,data:{isMeEndedCallForAll:!0}}),(0,o.forceCallFinish)(s).catch((e=>{console.error(e),a({type:n.E_ACTION.ERROR,text:r("calls_error_force_call_finish"),handleType:n.ErrorHandleType.FATAL}),a({type:n.E_ACTION.CLEAN_LAST_CALL_DATA})})).finally((()=>{a({type:n.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})),(0,i.sendVirtualBackgroundDisabled)(t)}},972205:(e,t,a)=>{"use strict";a.d(t,{setFeatureEndedNotification:()=>o});var n=a(22412);function o(e,t){e({type:n.E_ACTION.SET_FEATURE_ENDED_NOTIFICATION,data:t})}},124798:(e,t,a)=>{"use strict";a.d(t,{setAdminPinnedParticipant:()=>i,setOrator:()=>s,setPinnedParticipant:()=>r,setScreenSharingPinnedParticipant:()=>o});var n=a(22412);function o(e,t=null){e({type:n.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:t})}function i(e,t=null){e({type:n.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:t})}function r(e,t=null){e({type:n.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:t})}function s(e,t=null){e({type:n.E_ACTION.SET_ORATOR,orator:t})}},152575:(e,t,a)=>{"use strict";a.d(t,{clearRoomParticipants:()=>u,clearRooms:()=>g,deleteRoom:()=>c,enterToRoomNotification:()=>p,exitFromRoomNotification:()=>_,roomHelpRequestedNotification:()=>m,setRoomActivate:()=>s,setRoomChatId:()=>h,setRoomId:()=>r,updateRoomParticipants:()=>d,updateRooms:()=>l});var n=a(22412),o=a(496111),i=a(1628);function r(e,t){e({type:n.E_ACTION.SET_ROOM_ID,data:t})}function s(e,t,a){e({type:n.E_ACTION.SET_ROOM_ACTIVE,data:{id:t,active:a}})}function l(e,t,a){const r={};for(const n of a){var s,l,c,d;const a=e.rooms.rooms[n.id];var u;let h=null!=(u=null==a?void 0:a.participantIds)?u:[];if((null==n||null==(s=n.participants)?void 0:s.participants)&&n.participants.participants.forEach((e=>{(0,i.throttleAccumulateDispatchParticipant)(t,e.uid,{roomId:n.id})})),(null==n?void 0:n.participantIds)&&(null==(l=n.participantIds)?void 0:l.length)&&(h=n.participantIds),(null==n?void 0:n.addParticipantIds)&&(null==(c=n.addParticipantIds)?void 0:c.length)&&(h=h.concat(n.addParticipantIds)),(null==n?void 0:n.removeParticipantIds)&&(null==(d=n.removeParticipantIds)?void 0:d.length)){const e=n.removeParticipantIds;h=h.filter((t=>{for(const a of e)if((0,o.isSameExternalId)(t,a))return!1;return!0}))}var p,_,m;r[n.id]={id:n.id,active:null!=(_=null!=(p=n.active)?p:null==a?void 0:a.active)&&_,name:n.name||(null==a?void 0:a.name)||"",participantIds:h,muteStates:n.muteStates||(null!=(m=null==a?void 0:a.muteStates)?m:{})}}t({type:n.E_ACTION.UPDATE_ROOMS,data:r})}function c(e,t){e({type:n.E_ACTION.REMOVE_ROOM,data:t})}function d(e,t,{participantIds:a,addedParticipantIds:o,removedParticipantIds:i}){e({type:n.E_ACTION.UPDATE_ROOM_PARTICIPANTS,roomId:t,participantIds:a,addedParticipantIds:o,removedParticipantIds:i})}function u(e,t){e({type:n.E_ACTION.CLEAR_ROOM_PARTICIPANTS,roomId:t})}function p(e,t){e({type:n.E_ACTION.CALL_NOTIFICATION,notification:{type:n.NotificationType.ENTER_TO_ROOM,data:t}})}function _(e){e({type:n.E_ACTION.CALL_NOTIFICATION,notification:{type:n.NotificationType.EXIT_FROM_ROOM}})}function m(e){e({type:n.E_ACTION.CALL_NOTIFICATION,notification:{type:n.NotificationType.ROOM_HELP_REQUESTED}})}function h(e,t,a=0){e({type:n.E_ACTION.SET_ROOM_CHAT_ID,roomId:t,chatId:a})}function g(e){e({type:n.E_ACTION.CLEAR_ROOMS})}},182330:(e,t,a)=>{"use strict";a.d(t,{clearWaitingList:()=>c,loadAdditionalWaitingHall:()=>p,loadWaitingHall:()=>d,loadWaitingHallFromScratch:()=>u,promoteUserAndRemoveFromWaitingHall:()=>s,removeUserFromWaitingHall:()=>l,resetWaitingHallNew:()=>_});var n=a(22412),o=a(455319),i=a(464380),r=a(162532);function s(e,t,a){const n=(0,o.getExternalIdByUserId)(e);return(0,i.promoteParticipant)(n).then((()=>{l(e,t,a)}))}function l(e,t,a){t&&(t.totalCount-=1,t.members.delete(e),a({type:n.E_ACTION.SET_WAITING_HALL,data:t}))}function c(e){e({type:n.E_ACTION.SET_WAITING_HALL,data:void 0})}function d(e,t,a,s){return function(e,t){if(0===t.length)return Promise.resolve([]);if(e>t.length)return(0,i.getWaitingHall)(null,e).then((e=>e.participants));return Promise.resolve(t)}(e,t).then((t=>{const{members:n,hasNew:i}=a.waitingHall||{members:new Map,hasNew:!1},[s,l]=function(e,t){return e.reduce((([e,a],{id:n})=>{const o=+n;return t.has(o)?a.push(o):e.push(o),[e,a]}),[[],[]])}(t,n),c=s.length>0,d=l.reduce(((e,t)=>{const a=n.get(t);return a&&e.set(t,a),e}),new Map),u={totalCount:e,members:d,hasNew:!!c||i};return c?function(e,t){const{me:a,callData:n,anonymSecret:i}=e,s=n.callId||"",l=a<0,c=l?a:0;return(0,r.getCallParticipantsApiCall)(s,t,l,i,c).then((({profiles:e=[],anonyms:t=[],groups:a=[]})=>[...t.map(o.normalizeUser),...e.map(o.normalizeUser),...a.map(o.normalizeGroup)]))}(a,s).then((e=>(e.forEach((e=>{e&&e.peerId&&u.members.set(e.peerId,e)})),u))).catch((()=>u)):u})).then((e=>{e.members&&s({type:n.E_ACTION.SET_WAITING_HALL,data:e})}))}function u(e,t){return(0,i.getWaitingHall)(null,void 0).then((a=>d(a.totalCount,a.participants,e,t)))}function p(e,t){if(!e.waitingHall)return Promise.resolve();const a=e.waitingHall.totalCount;return a>e.waitingHall.members.size?new Promise((n=>{(0,i.getWaitingHall)(null,a).then((a=>{d(a.totalCount,a.participants,e,t).then((()=>{n()}))}))})):Promise.resolve()}function _(e,t){e&&(e.hasNew=!1,t({type:n.E_ACTION.SET_WAITING_HALL,data:e}))}},993240:(e,t,a)=>{"use strict";a.d(t,{removeWatchTogether:()=>i,setWatchTogether:()=>o});var n=a(22412);function o(e,t){e({type:n.E_ACTION.SET_WATCH_TOGETHER,data:t})}function i(e){e({type:n.E_ACTION.SET_WATCH_TOGETHER,data:null})}},650570:(e,t,a)=>{"use strict";a.d(t,{AddParticipants:()=>m});var n=a(785893),o=a(50533),i=a(86894),r=a(413437),s=a(869048),l=a(555948),c=a(320434),d=a(491257),u=a(926691),p=a(146509),_=a(659397);const m=({onChange:e,onChangeTab:t,tab:a,tabs:m,selected:h})=>{const g=(0,o.useSelector)((e=>e.friends)),A=(0,o.useSelector)((e=>e.chatMembers)),C=(0,o.useSelector)((e=>e.groupMembers)),{personCache:v}=(0,d.usePersonCache)(),f=(0,c.useTokens)({selected:h,personCache:v});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.AppRootProvider,{children:(0,n.jsx)(i.Tabs,{children:m.map((({id:e,label:o,counter:i})=>(0,n.jsx)(l.TabsItem,{onClick:()=>t(e),selected:e===a,after:(0,n.jsx)("div",{className:(0,_.classNames)("AddParticipants__count",{"AddParticipants__count--inactive":e!==a}),children:i}),children:o},e)))})}),a===r.ETabName.Participants&&(0,n.jsx)(u.Tab,{onChange:e,personCache:v,selected:h,tokens:f,initMembers:A,memberType:p.EMembersType.Members},r.ETabName.Participants),a===r.ETabName.Friends&&(0,n.jsx)(u.Tab,{onChange:e,personCache:v,selected:h,tokens:f,initMembers:g,memberType:p.EMembersType.Friends},r.ETabName.Friends),a===r.ETabName.Community&&(0,n.jsx)(u.Tab,{onChange:e,personCache:v,selected:h,tokens:f,initMembers:C,memberType:p.EMembersType.CommunityMembers},r.ETabName.Community)]})}},926691:(e,t,a)=>{"use strict";a.d(t,{Tab:()=>r});var n=a(785893),o=a(456332),i=a(559376);const r=({tokens:e,onChange:t,selected:a,personCache:r,initMembers:s,memberType:l})=>{const c=(0,i.useTabContentController)({selected:a,onChange:t,personCache:r,initMembers:s,memberType:l});return(0,n.jsx)(o.CallsMultiSelect,{tokens:e,onRemoveToken:c.onRemoveToken,value:c.query,onChange:c.onChangeHandler,onSelect:c.onSelect,renderSuggest:c.renderSuggest,data:c.found,hideInputWithName:!0})}},146509:(e,t,a)=>{"use strict";var n;a.d(t,{EMembersType:()=>n}),function(e){e.Friends="friends",e.CommunityMembers="groupMembers",e.Members="members"}(n||(n={}))},491257:(e,t,a)=>{"use strict";a.d(t,{usePersonCache:()=>i});var n=a(667294),o=a(50533);const i=()=>{const e=(0,o.useSelector)((e=>e.groupMembers)),t=(0,o.useSelector)((e=>e.chatMembers)),a=(0,o.useSelector)((e=>e.friends)),i=(0,n.useRef)({}),r=(0,n.useRef)();r.current||(r.current=new Map);const s=(...e)=>{e.forEach((e=>{e.forEach((e=>{r.current.set(e.id,e)}))}))};return i.current.chatMembers!==t&&(s(t),i.current.chatMembers=t),i.current.groupMembers!==e&&(s(e),i.current.groupMembers=e),i.current.friends!==a&&(s(a),i.current.friends=a),(0,n.useEffect)((()=>()=>{r.current.clear(),i.current={}}),[]),{personCache:r}}},559376:(e,t,a)=>{"use strict";a.d(t,{useTabContentController:()=>m});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(248450),l=a(800582),c=a(22412),d=a(823877),u=a(915961),p=a(337057),_=a(465768);const m=({onChange:e,initMembers:t,selected:a,personCache:m,memberType:h})=>{const g=(0,o.useRef)(!1),A=(0,o.useRef)(),C=(0,i.useSelector)((e=>e)),v=(0,r.useTypedDispatch)(),{getLang:f}=(0,u.useLang)(),[S,E]=(0,o.useState)(t),[T,I]=(0,o.useState)(""),[y,N]=(0,o.useState)(!1),[b,x]=(0,o.useState)(!1),M=(0,o.useMemo)((()=>a.reduce(((e,t)=>(e[t]=!0,e)),{})),[a]),O=C.groupMembersCount>c.COUNT_OF_GROUP_MEMBERS_TO_LOAD,P=(0,o.useMemo)((()=>new p.VkIndexer(S,d.nameGetter)),[]),R=(0,o.useCallback)((e=>{if(e){const t=P.search(e);if(g.current){let e={};return t.forEach((t=>{e[t.id]=t})),Object.values(e)}return t}return(0,d.getDefaultSuggests)({getLang:f,members:S,showMore:y,memberType:h})}),[S,P,f,y,h]),[k,w]=(0,o.useState)((()=>R(T))),D=(0,o.useCallback)((t=>{const n=[...a,+t];e(n)}),[a,e]),L=(0,o.useCallback)((t=>{const n=a.filter((e=>e!==+t));e(n)}),[a,e]);(0,o.useEffect)((()=>{w(R(T))}),[y]),(0,o.useEffect)((()=>{const e=T;return O&&(e.length>=3&&!b?A.current=setTimeout((()=>{(0,l.serverSearchGroupMembers)(-C.groupId,e,C,v).then((t=>{if(x(!1),t.length){g.current=!0;const a=[...S];for(const e of t)a.push(e),P.add(e);E(a),w(R(e))}})).catch(_.handlePromiseError)}),1e3):A.current&&(x(!1),clearTimeout(A.current))),()=>{A.current&&clearTimeout(A.current)}}),[T]);const j=(0,o.useCallback)((e=>{I(e.target.value),w(R(e.target.value))}),[R]),B=(0,o.useCallback)((e=>(L(e),Promise.resolve())),[L]),U=(0,o.useCallback)((e=>((0,d.isSelectedItem)(e,C,M)?L(e):(0,d.isParticipantDisabled)({member:m.current.get(+e),state:C,selectedMap:M})||(D(e),I(""),w(R(""))),Promise.resolve())),[C,M,R,D,L]),H=(0,o.useCallback)(((e,t)=>"type"in e?()=>N(!0):t),[]),F=(0,o.useCallback)(((e,t)=>{const a="peerId"in e?e.peerId:0;return(0,n.jsx)(s.CallsSearchResult,{data:e,onClick:H(e,t),selected:(0,d.isSelectedItem)(a,C,M),disabled:(0,d.isParticipantDisabled)({member:m.current.get(+a),state:C,selectedMap:M})},a||"text"in e&&e.text||void 0)}),[M,C.groupId,C.participants,C.me,C.unableToCallGroupMembersIds]);return{query:T,found:k,onRemoveToken:B,onChangeHandler:j,onSelect:U,renderSuggest:F}}},355922:(e,t,a)=>{"use strict";a.d(t,{ETabName:()=>i.ETabName,useTabs:()=>r});var n=a(667294),o=a(915961),i=a(413437);const r=({friendsCount:e,membersCount:t,defaultTab:a,groupMembersCount:r,displayTabs:s})=>{const{getLang:l}=(0,o.useLang)(),[c,d]=(0,n.useState)(a||i.ETabName.Participants),u=a=>{switch(a){case i.ETabName.Participants:return{id:i.ETabName.Participants,label:l("calls_call_patricipants"),counter:t};case i.ETabName.Friends:return{id:i.ETabName.Friends,label:l("calls_call_friends"),counter:e};case i.ETabName.Community:return{id:i.ETabName.Community,label:l("calls_call_community_members"),counter:r}}};return{tab:c,tabs:(0,n.useMemo)((()=>{const e=[];for(const t of s)t&&e.push(u(t));return e}),[l,t,e,c,r,s]),onChangeTab:(0,n.useCallback)((e=>{d(e)}),[])}}},320434:(e,t,a)=>{"use strict";a.d(t,{useTokens:()=>l});var n=a(667294),o=a(50533),i=a(823877),r=a(496111),s=a(788822);const l=({selected:e,personCache:t})=>{const a=(0,o.useSelector)((e=>e));return(0,n.useMemo)((()=>{const n=(0,r.getActiveDevices)(a).activeDevices,o=new Map;for(const e of n){const t=a.participants[e.externalId.id];t&&o.set(t.peerId,{id:t.peerId.toString(),text:(0,s.decodeHTMLEntities)((0,i.unclean)(t.name)),locked:!0})}for(const n of e){const e=a.participants[n]||t.current.get(n);o.set(n,{text:(0,s.decodeHTMLEntities)((0,i.unclean)(null==e?void 0:e.name)),id:n.toString(),locked:!1})}return[...o.values()]}),[e,a.participants,a.me,a.groupId,a.meGroup,a.adminPinnedParticipant,a.isOratorMode,a.oratorScrollFirstVisible,a.gridScrollFirstVisible,a.oratorScrollNumberOfVisible])}},413437:(e,t,a)=>{"use strict";var n;a.d(t,{ETabName:()=>n}),function(e){e.Participants="participants",e.Friends="friends",e.Community="community"}(n||(n={}))},823877:(e,t,a)=>{"use strict";a.d(t,{getDefaultSuggests:()=>c,isParticipantDisabled:()=>u,isSelectedItem:()=>d,nameGetter:()=>m,prepareCallAllData:()=>_,unclean:()=>p});var n=a(788822),o=a(22412),i=a(271831),r=a(496111),s=a(495457),l=a(146509);function c({getLang:e,members:t,showMore:a,memberType:n}){const i={type:o.SearchResultType.MEMBERS_MORE,text:e("calls_show_all_members")},r={type:o.SearchResultType.FRIENDS_MORE,text:e("calls_show_all_friends")},s={type:o.SearchResultType.GROUP_MEMBERS_MORE,text:e("calls_show_all_group_members")},c=[];switch(n){case l.EMembersType.Members:if(t&&t.length>0)if(a||t.length<=10)c.push(...t);else{for(let e=0;e<10;e++)c.push(t[e]);c.push(i)}break;case l.EMembersType.Friends:if(t&&t.length>0)if(a||t.length<=10)c.push(...t);else{for(let e=0;e<10;e++)c.push(t[e]);c.push(r)}break;case l.EMembersType.CommunityMembers:if(t&&t.length>0)if(a||t.length<=10)c.push(...t);else{for(let e=0;e<10;e++)c.push(t[e]);c.push(s)}}return c}function d(e,t,a){return a&&a[e]||(0,r.isParticipantInCall)(t,e)}function u({member:e,state:t,selectedMap:a}){const n=(null==e?void 0:e.peerId)||0;if((0,r.isParticipantInCall)(t,n))return!0;if(d(n,t,a))return!1;if((0,s.isAuthedByGroupId)(t)){if((0,r.isParticipantUnavailableToCallFromGroup)(t,n))return!0}else if(!(null==e?void 0:e.canCall))return!0;return!(0,i.isUserPeer)(n)}const p=e=>e?(0,n.escape)(e.replace(/\t/g,"\n")):"",_=({state:e,selectedMap:t})=>{const a=(0,r.getActiveDevices)(e).activeDevices.reduce(((e,t)=>(e[t.externalId.id]=!0,e)),{});return e.chatMembers.reduce(((n,o)=>{const{peerId:i}=o;return a[i]||u({member:o,state:e,selectedMap:t})||n.push(i),n}),[])},m=e=>e.name},737666:(e,t,a)=>{"use strict";a.d(t,{AdminPinUnmuteRequestModal:()=>i});var n=a(785893),o=a(513885);const i=({onClose:e,actionButtons:t,title:a,description:i})=>(0,n.jsx)(o.default,{className:"AdminPinUnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:e,children:(0,n.jsx)("div",{className:"AdminPinUnmuteRequestModal__content",children:i})})},771345:(e,t,a)=>{"use strict";a.d(t,{AppDownloadBanner:()=>b});var n=a(785893),o=a(667294),i=a(154080),r=a(203287),s=a(978374),l=a(265212),c=a(267509),d=a(967285),u=a(714772),p=a(933378),_=a(197264),m=a(700200),h=a(219934),g=a(558791),A=a(768296),C=a(851820),v=a(224654),f=a(669181),S=a(1262),E=a(589897),T=a(292071),I=a(504391);const y=({onCreateCall:e})=>{const{getLang:t}=(0,g.useLangContext)(),{locale:a}=(0,A.useLocale)();return(0,n.jsx)(v.Dropdown,{className:"CallsAppDownloadBanner__dropdown",trigger:"hover",position:"l",dataJsx:()=>{const[a,o]=t("calls_dropdown_ios_download_disabled_v2").split("{link}");return(0,n.jsxs)("div",{className:"CallsAppDownloadBanner__dropdown__ctx CallsDropdownComponent__in",children:[(0,n.jsxs)("p",{className:"CallsAppDownloadBanner__dropdown__desc",children:[a.trim()," ",(0,n.jsx)(m.default,{target:"_blank",href:"https://calls.vk.com",rel:"noreferrer",children:"calls.vk.com"}),o?` ${o}`:""]}),(0,n.jsx)(E.default,{stretched:!0,mode:"primary",size:"s",onClick:()=>e(T.CallStatSource.HISTORY_CREATE),children:t("calls_dropdown_ios_call_from_web")})]})},marginLeft:-221,useFixedPosition:!0,children:(0,n.jsxs)("div",{className:"CallsAppDownloadBanner__row","data-platform":"ios",children:[(0,n.jsx)("div",{className:"CallsAppDownloadBanner__link","data-platform":"ios",children:x(a)}),(0,n.jsx)("div",{className:"CallsAppDownloadBanner__qrLink","data-platform":"ios",children:(0,n.jsx)(i.Icon24Qr,{})})]})})},N=({onCreateCall:e,useDisabledAppStoreBtn:t})=>{const{getLang:a}=(0,g.useLangContext)(),{locale:o}=(0,A.useLocale)(),{openedModal:i,openAppStoreModal:s,openGooglePlayModal:l,openRuStoreModal:c,closeModal:d}=(0,C.useDownloadModal)(),{mainButton:u,otherButtons:p}=(0,S.useDownloadButtons)();return(0,n.jsxs)(_.default,{className:"CallsAppDownloadBanner--banner",children:[(0,n.jsxs)("div",{className:"CallsAppDownloadBanner--iconContainer",children:[(0,n.jsx)(r.default,{className:"CallsAppDownloadBanner--icon",width:28,height:28}),a("calls_app_banner_vk_calls")]}),(0,n.jsx)("div",{className:"CallsAppDownloadBanner--bannerDesc",children:a("calls_history_desktop_banner_description")}),(0,n.jsx)("div",{className:"CallsAppDownloadBanner--bannerSubDesc",children:a("calls_history_desktop_banner_sub_description")}),(0,n.jsx)("div",{className:"CallsAppDownloadBanner__device-text",children:a("calls_app_for_mobile")}),t&&(0,n.jsx)(y,{onCreateCall:e}),!t&&(0,n.jsx)(I.AppDownloadBannerRow,{link:f.LINK_IOS,linkLabel:a("calls_download_in_appstore"),qrLabel:a("calls_show_ios_app_qr"),storeIcon:x(o),onClick:s}),(0,n.jsx)(I.AppDownloadBannerRow,{link:f.LINK_GOOGLE_PLAY,linkLabel:a("calls_download_from_google_play"),qrLabel:a("calls_show_android_app_qr"),storeIcon:M(o),onClick:l}),(0,n.jsx)(I.AppDownloadBannerRow,{link:f.LINK_RUSTORE,linkLabel:a("calls_available_in_rustore"),qrLabel:a("calls_show_android_app_qr"),storeIcon:O(o),onClick:c}),(0,n.jsxs)("div",{className:"CallsAppDownloadBanner--bannerButtons",children:[(0,n.jsx)("div",{className:"CallsAppDownloadBanner__device-text",children:a("calls_app_for_desktop")}),u,p]}),i&&(0,n.jsx)(h.ModalMobileAppDownload,{appMarket:i,onClose:d})]})},b=(0,o.memo)(N);function x(e){return"ru"===e?(0,n.jsx)(s.default,{}):(0,n.jsx)(l.default,{})}function M(e){return"ru"===e?(0,n.jsx)(c.default,{}):(0,n.jsx)(d.default,{})}function O(e){return"ru"===e?(0,n.jsx)(u.default,{}):(0,n.jsx)(p.default,{})}},504391:(e,t,a)=>{"use strict";a.d(t,{AppDownloadBannerRow:()=>i});var n=a(785893),o=a(532201);const i=({link:e,storeIcon:t,onClick:a,linkLabel:i,qrLabel:r})=>(0,n.jsx)("div",{className:"CallsAppDownloadBanner__row",children:(0,n.jsx)(o.StoreButton,{href:e,target:"_blank",rel:"noreferrer",stretched:!0,"aria-label":i,qrLabel:r,showQR:!0,onQRClick:a,children:t})})},211469:(e,t,a)=>{"use strict";a.d(t,{AppDownloadButton:()=>r});var n=a(785893),o=a(558791),i=a(832550);const r=({icon:e,text:t,onClick:a})=>{const{getLang:r}=(0,o.useLangContext)(),s=r("calls_app_for_desktop");return(0,n.jsx)(i.Button,{mode:"secondary","aria-label":`${s} ${t}`,onClick:a,after:e,children:t})}},669181:(e,t,a)=>{"use strict";a.d(t,{DOWNLOAD_APP_PROXY_PAGE:()=>r,LINK_GOOGLE_PLAY:()=>n,LINK_IOS:()=>i,LINK_RUSTORE:()=>o});const n="https://play.google.com/store/apps/details?id=com.vk.calls",o="https://apps.rustore.ru/app/com.vk.calls",i="https://apps.apple.com/app/id1612939275",r="/calls?act=download_app"},1262:(e,t,a)=>{"use strict";a.d(t,{useDownloadButtons:()=>_});var n=a(785893),o=a(241291),i=a(899426),r=a(495195),s=a(274706),l=a(771455),c=a(873960),d=a(94176),u=a(669181),p=a(211469);const _=()=>{const e=()=>{d.mailRuCounter.push(d.EMailRuGoals.DownloadAppVkCalls,{os:d.EOS.Mac}),(0,i.download)(u.DOWNLOAD_APP_PROXY_PAGE+"&type=mac",r.DESKTOP_CALLS_FILENAME[s.OS.MAC],!0)},t=()=>{d.mailRuCounter.push(d.EMailRuGoals.DownloadAppVkCalls,{os:d.EOS.Windows}),(0,i.download)(u.DOWNLOAD_APP_PROXY_PAGE+"&type=windows",r.DESKTOP_CALLS_FILENAME[s.OS.WINDOWS],!0)},a=()=>{d.mailRuCounter.push(d.EMailRuGoals.DownloadAppVkCalls,{os:d.EOS.Linux}),(0,i.openDesktopPage)(u.DOWNLOAD_APP_PROXY_PAGE+"&type=linux")};let _=null,m=(0,n.jsx)(n.Fragment,{});switch(s.Platform.OS){case s.OS.WINDOWS:m=(0,n.jsx)(p.AppDownloadButton,{icon:(0,n.jsx)(l.default,{}),text:"Windows",onClick:t});break;case s.OS.MAC:m=(0,n.jsx)(p.AppDownloadButton,{icon:(0,n.jsx)(o.Icon16LogoApple,{}),text:"Mac",onClick:e});break;case s.OS.LINUX:m=(0,n.jsx)(p.AppDownloadButton,{icon:(0,n.jsx)(c.default,{}),text:"Linux",onClick:a});break;default:m=(0,n.jsx)(p.AppDownloadButton,{icon:(0,n.jsx)(l.default,{}),text:"Windows",onClick:t}),_=(0,n.jsxs)("div",{className:"CallsAppDownloadBanner--bannerButtonsSecond",children:[(0,n.jsx)(p.AppDownloadButton,{icon:(0,n.jsx)(o.Icon16LogoApple,{}),text:"Mac",onClick:e}),(0,n.jsx)(p.AppDownloadButton,{icon:(0,n.jsx)(c.default,{}),text:"Linux",onClick:a})]})}return{mainButton:m,otherButtons:_}}},851820:(e,t,a)=>{"use strict";a.d(t,{useDownloadModal:()=>i});var n=a(667294),o=a(650653);const i=()=>{const[e,t]=(0,n.useState)(!1),a=(0,n.useCallback)((()=>{t(!1)}),[]);return{openedModal:e,openAppStoreModal:(0,n.useCallback)((()=>{t(o.AppMarket.APP_STORE)}),[]),openGooglePlayModal:(0,n.useCallback)((()=>{t(o.AppMarket.GOOGLE_PLAY)}),[]),openRuStoreModal:(0,n.useCallback)((()=>{t(o.AppMarket.RU_STORE)}),[]),closeModal:a}}},330168:(e,t,a)=>{"use strict";a.d(t,{AsrModal:()=>i});var n=a(785893),o=a(513885);const i=({children:e,title:t,actionButtons:a,onClose:i})=>(0,n.jsx)(o.default,{className:"CallsAsrModal",onClose:i,title:t,appearance:"blue",hasScroll:!1,actionButtons:a,children:e})},47988:(e,t,a)=>{"use strict";a.d(t,{AsrStatus:()=>p});var n=a(785893),o=a(869048),i=a(384627),r=a(622284),s=a(732621),l=a(141343),c=a(558791),d=a(667294),u=a(86894);const p=({actions:e,isCanManage:t,ownerName:a,isMeOwner:p})=>{const[_,m]=(0,d.useState)(!1),[h,g]=(0,d.useState)(!1),{getLang:A,langReplace:C}=(0,c.useLangContext)(),v=p?A("calls_asr_owner_tooltip_me"):C(A("calls_asr_owner_tooltip"),{name:a});return(0,n.jsx)(o.AppRootProvider,{children:(0,n.jsx)("div",{className:"AsrStatus",children:(0,n.jsx)(u.AppearanceProvider,{appearance:"dark",children:(0,n.jsx)(i.DropdownActionSheet,{action:"click",content:e,shown:_&&t,onShownChange:m,children:(0,n.jsxs)("div",{className:"AsrStatus__container",children:[(0,n.jsx)(r.TextTooltip,{text:v,shown:h&&!_,onShownChange:g,children:(0,n.jsx)(s.Icon20Articles,{})}),t&&(0,n.jsx)("div",{className:"AsrStatus__containerDropdown",children:(0,n.jsx)(l.Icon12Dropdown,{})})]})})})})})}},692837:(e,t,a)=>{"use strict";a.d(t,{AssignAdminModal:()=>i});var n=a(785893),o=a(513885);const i=({title:e,description:t,onClose:a,actionButtons:i})=>(0,n.jsx)(o.default,{className:"AssignAdminModal",appearance:"blue",title:e,actionButtons:i,onClose:a,children:(0,n.jsx)("div",{className:"AssignAdminModal__content",children:t})})},230823:(e,t,a)=>{"use strict";a.d(t,{BlurredBackground:()=>r});var n=a(785893),o=a(667294),i=a(659397);const r=({id:e,className:t,children:a})=>{const r=(0,o.useMemo)((()=>`radial-gradient(circle, rgb(${48+Math.abs(e)%3*4},${48+Math.abs(e)%4*5},${52+Math.abs(e)%5*6}) 40%, #0a0a0a 100%)`),[]),s=(0,i.classNames)("BlurredBackground",t);return(0,n.jsx)("div",{className:s,style:{background:r},children:a})}},625460:(e,t,a)=>{"use strict";a.d(t,{Call:()=>w});var n=a(785893),o=a(667294),i=a(136486),r=a(687054),s=a(318761),l=a(659397),c=a(836326),d=a(937026),u=a(346880),p=a(22412),_=a(39616),m=a(627835),h=a(17784),g=a(742384),A=a(896022),C=a(390020),v=a(690113),f=a(375535),S=a(939418),E=a(27733),T=a(335302),I=a(25184),y=a(219239),N=a(355226),b=a(92086),x=a(273142),M=a(291773),O=a(573339),P=a(751210),R=a(573491),k=a(869048);const w=(0,o.forwardRef)(((e,t)=>{const{info:a,chatUnreadCount:w=0,callMenuActions:D,isAudioAllowed:L=!1,isVideoAllowed:j=!1,isVideoEnabled:B=!1,isAudioEnabled:U=!1,isScreenSharingEnabled:H=!1,isMovieStreamEnabled:F=!1,isOratorMode:V=!0,isFullScreen:G=!1,onToggleVideo:W,onToggleAudio:$,onLeaveCall:z,onToggleOratorMode:Z,onChat:K,onHandClick:Q,onFullScreenToggle:Y,onDeferredStreamStart:q,isLayoutSwitchShown:J=!1,isScreenShareControlShown:X=!1,isHandRaised:ee=!1,isHandControlShown:te=!1,isChatControlShown:ae=!1,isRoomControlShown:ne=!1,isStreamingControlShown:oe=!1,onParticipantsClick:ie,onTooltipChange:re,tooltips:se,notificationWithButton:le,isWaitingHall:ce=!1,participantCount:de=0,children:ue,onOpenWatchTogetherFeature:pe,callControlsVisibilityController:_e,handleReactionClick:me,isFeedbackPanelEnabled:he,iconReaction:ge,refContentHeight:Ae,isWatchTogetherEnabled:Ce,isCanManageWatchTogether:ve,onCollapseCall:fe,isInRoom:Se=!1,onLeaveRoom:Ee,onRoomControl:Te,toggleScreenShareDropdown:Ie,isScreenShareDropdownShown:ye,onStopScreenShare:Ne,onStartScreenShare:be,onStartFastScreenShare:xe,isFastScreenSharingAvailable:Me}=e,{getLang:Oe}=(0,o.useContext)(u.LangContext),Pe=(0,l.classNames)("Call",{"Call--fullscreen":G}),Re=(0,l.classNames)("Call__content",{"Call__content--waitingHall":ce}),ke=(0,l.classNames)("Call__controlPanelButtonsGroup","Call__controlPanelButtonsGroup--left"),we=(0,l.classNames)({Call__controlPanelButtonsGroup:!0,"Call__controlPanelButtonsGroup--right":!0,"Call__controlPanelButtonsGroup--rightFullScreen":G}),De=300,Le=(0,o.useRef)(null),[je,Be]=(0,o.useState)(!1),Ue=(0,R.useReactionsController)({onTooltipChange:re,onReaction:me,onHand:Q}),He="boolean"!=typeof(null==_e?void 0:_e.isShowControls)||_e.isShowControls,Fe=(0,O.useWatchTogetherHint)(),Ve=(0,o.useRef)(null);(0,o.useEffect)((()=>{if(!Ve.current||!Ae)return;const e=new ResizeObserver((e=>{for(const t of e)Ae.current=t.contentRect.height}));return e.observe(Ve.current),()=>e.disconnect()}),[]);const Ge=(0,o.useCallback)((e=>{e.code===p.KeyboardCodes.KeyM&&e.ctrlKey&&(null==$||$())}),[U,$]);return(0,o.useEffect)((()=>(document.addEventListener("keydown",Ge),()=>{document.removeEventListener("keydown",Ge)})),[Ge]),(0,n.jsx)(k.AppRootProvider,{children:(0,n.jsxs)("section",{ref:t,className:Pe,onMouseOver:null==_e?void 0:_e.handleMouseOver,onMouseLeave:null==_e?void 0:_e.handleMouseLeave,onMouseMove:null==_e?void 0:_e.handleMouseMove,children:[a,(0,n.jsx)("div",{className:Re,ref:Ve,children:ue}),(0,n.jsx)("footer",{className:"Call__footer",ref:Le,children:He&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:ke,children:[ae&&(0,n.jsx)(d.TooltipNew,{content:Oe("calls_chat"),open:se.chat,delay:De,onOpen:()=>re("chat",!0),onClose:()=>re("chat",!1),children:(0,n.jsx)(s.ChatIconButton,{"aria-label":Oe("calls_chat"),unreadCount:w,onClick:K})}),ne&&(0,n.jsx)(d.TooltipNew,{content:Oe("calls_room_control"),open:se.roomControl,delay:De,onOpen:()=>re("roomControl",!0),onClose:()=>re("roomControl",!1),children:(0,n.jsx)(r.CallIconButton,{"aria-label":Oe("calls_room_control"),icon:(0,n.jsx)(_.Icon28UserSquareOnSquare,{height:24,width:24}),onClick:Te})}),X&&(0,n.jsx)(M.CallScreenShareButton,{isScreenSharingEnabled:H,onStopScreenShare:Ne,onStartScreenShare:be,onStartFastScreenShare:xe,onTooltipChange:re,tooltips:se,isDropdownOpen:Boolean(ye),toggleDropdown:Ie,isFastScreenSharingAvailable:Me}),Ce&&(0,n.jsx)(d.TooltipNew,{content:Fe,open:se.movieChoose,delay:De,onOpen:()=>re("movieChoose",!0),onClose:()=>re("movieChoose",!1),children:(0,n.jsx)(r.CallIconButton,{"aria-label":Fe,icon:(0,n.jsx)(b.default,{}),onClick:pe,isActive:F&&ve,disabled:!ve})}),oe&&(0,n.jsx)(d.TooltipNew,{content:Oe("calls_call_menu_translation"),open:se.streaming,delay:De,onOpen:()=>re("streaming",!0),onClose:()=>re("streaming",!1),children:(0,n.jsx)(r.CallIconButton,{"aria-label":Oe("calls_call_menu_translation"),icon:(0,n.jsx)(m.Icon24Live,{}),isActive:oe,onClick:q})})]}),(0,n.jsxs)("div",{className:"Call__buttons",children:[!he&&te&&(0,n.jsx)(d.TooltipNew,{tooltipClassName:"Call__footerButton__tooltip",content:Oe(ee?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),open:se.hand,delay:De,onOpen:()=>re("hand",!0),onClose:()=>re("hand",!1),children:(0,n.jsx)(i.CallButton,{"aria-label":Oe(ee?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),"aria-pressed":ee,icon:(0,n.jsx)(h.Icon24Privacy,{}),type:ee?i.CallButtonTypes.OFF:i.CallButtonTypes.ON,onClick:Q,className:"Call__footerButton"})}),he&&(0,n.jsx)(P.CallReactionsButton,{onReaction:Ue.onReactionClick,onHand:Ue.onHandClick,onTooltipChange:Ue.onTooltipChange,tooltips:se,isHand:ee,tooltipTitle:Oe(ee?"calls_tooltip_lower_hand":"calls_tooltip_raise_hand"),iconReaction:ge,isMovieStreamEnabled:F}),(0,n.jsx)(d.TooltipNew,{content:Oe(B?"calls_camera_turn_off":"calls_camera_turn_on"),open:se.video,delay:De,onOpen:()=>re("video",!0),onClose:()=>re("video",!1),tooltipClassName:"Call__footerButton__tooltip",preferPointerEvents:!0,children:(0,n.jsx)(i.CallButton,{"aria-label":Oe(B?"calls_camera_turn_off":"calls_camera_turn_on"),"aria-pressed":B,type:j?B?i.CallButtonTypes.ON:i.CallButtonTypes.OFF:i.CallButtonTypes.DISABLED,icon:B?(0,n.jsx)(g.Icon24Videocam,{}):(0,n.jsx)(A.Icon24VideocamSlash,{}),onClick:W,className:"Call__footerButton"})}),$&&(0,n.jsx)(d.TooltipNew,{content:Oe(U?"calls_mic_turn_off":"calls_mic_turn_on"),open:se.audio,delay:De,onOpen:()=>re("audio",!0),onClose:()=>re("audio",!1),tooltipClassName:"Call__footerButton__tooltip",preferPointerEvents:!0,children:(0,n.jsx)(N.MicIconButton,{ariaLabel:Oe(U?"calls_mic_turn_off":"calls_mic_turn_on"),isAudioAllowed:L,isAudioEnabled:U,onToggleAudio:$})}),!Se&&(0,n.jsx)(d.TooltipNew,{content:Oe("calls_exit"),open:se.leaveCall,delay:De,onOpen:()=>re("leaveCall",!0),onClose:()=>re("leaveCall",!1),tooltipClassName:"Call__footerButton__tooltip",children:(0,n.jsx)(i.CallButton,{"aria-label":Oe("calls_exit"),type:i.CallButtonTypes.NEGATIVE,icon:(0,n.jsx)(C.Icon28CancelOutline,{}),onClick:z,className:"Call__footerButton"})}),Se&&(0,n.jsx)(d.TooltipNew,{content:Oe("calls_leave_room"),open:se.leaveRoom,delay:De,onOpen:()=>re("leaveRoom",!0),onClose:()=>re("leaveRoom",!1),tooltipClassName:"Call__footerButton__tooltip",children:(0,n.jsx)(i.CallButton,{"aria-label":Oe("calls_leave_room"),type:i.CallButtonTypes.NEGATIVE,icon:(0,n.jsx)(v.Icon24DoorArrowRightOutline,{}),onClick:Ee,className:"Call__footerButton"})})]}),(0,n.jsxs)("div",{className:we,children:[ie&&(0,n.jsx)(d.TooltipNew,{content:Oe("calls_participants"),open:se.participants,delay:De,onOpen:()=>re("participants",!0),onClose:()=>re("participants",!1),children:(0,n.jsx)(y.ParticipantIconButton,{ariaLabel:Oe("calls_participants"),onClick:ie,participantCount:de})}),J&&(0,n.jsx)(d.TooltipNew,{content:Oe(V?"calls_show_grid":"calls_show_orator"),open:se.layout,delay:De,onOpen:()=>re("layout",!0),onClose:()=>re("layout",!1),children:(0,n.jsx)(r.CallIconButton,{icon:V?(0,n.jsx)(f.Icon24Square4Outline,{}):(0,n.jsx)(S.Icon243SquareOutline,{}),"aria-label":Oe(V?"calls_show_grid":"calls_show_orator"),onClick:Z})}),D&&(0,n.jsx)(c.CallsDropdown,{items:D,open:je,setOpen:Be,placement:"top-end",className:"Call__dropdown",appearance:"dark",children:(0,n.jsx)(x.CallSettingsButton,{onTooltipChange:re,tooltips:se,isDropdownOpen:je,tooltipTitle:Oe("calls_settings")})}),fe&&(0,n.jsx)(d.TooltipNew,{content:Oe("calls_collapse"),open:se.collapse,delay:De,onOpen:()=>re("collapse",!0),onClose:()=>re("collapse",!1),children:(0,n.jsx)(r.CallIconButton,{"aria-label":Oe("calls_collapse"),icon:(0,n.jsx)(E.Icon24PictureInPictureSquareFilled,{}),onClick:fe})}),Y&&(0,n.jsx)(d.TooltipNew,{content:Oe(G?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),open:se.fullscreen,delay:De,onOpen:()=>re("fullscreen",!0),onClose:()=>re("fullscreen",!1),children:(0,n.jsx)(r.CallIconButton,{"aria-label":Oe(G?"calls_tooltip_fullscreen_off":"calls_tooltip_fullscreen_on"),onClick:Y,icon:G?(0,n.jsx)(T.Icon24FullscreenExit,{}):(0,n.jsx)(I.Icon24Fullscreen,{})})})]})]})}),le&&le]})})}));w.displayName="Call"},573339:(e,t,a)=>{"use strict";a.d(t,{useWatchTogetherHint:()=>c});var n=a(490287),o=a(737598),i=a(954982),r=a(915961),s=a(93481),l=a(743679);const c=()=>{const{getLang:e}=(0,r.useLang)(),t=!!(0,n.useTypedSelector)(l.getWatchTogetherInfo),a=(0,i.useIsSharedMovieOwner)(),c=(0,o.useIsMeCanManageWatchTogether)(),d=(0,s.useIsWatchTogetherAllowed)();switch(!0){case c:return e("calls_watch_movie_together");case!d:return e("calls_notification_admin_permanent_mute_watch_together");case t&&!a:return e("calls_movie_already_started");default:return e("calls_watch_movie_together")}}},210475:(e,t,a)=>{"use strict";a.d(t,{CallBaseWidget:()=>T});var n=a(785893),o=a(496111),i=a(464380),r=a(667294),s=a(346880),l=a(266247),c=a(543083),d=a(838891),u=a(742384),p=a(896022),_=a(37240),m=a(687054),h=a(487416),g=a(659397),A=a(869048),C=a(619141),v=a(490287),f=a(878198),S=a(308316),E=a(329050);const T=e=>{const{localVideoStreamData:t,onToggleAudio:a,onRestoreCall:T,participantId:I,isLocalScreenSharing:y,name:N,isWithVideo:b,isWithAudio:x,isScreenSharing:M,isRecord:O,streamData:P,photo:R,networkStatus:k,isNFT:w,children:D,isLocalAudioEnabled:L,isLocalAudioAllowed:j,rightButton:B,widgetClass:U,status:H=i.ParticipantStatus.CONNECTED,isMe:F=!1,isVmoji:V,isMiniApp:G=!1,isLocalVideoAllowed:W,isLocalVideoEnabled:$,onToggleVideo:z,isCollapsedPip:Z}=e,{getLang:K}=(0,r.useContext)(s.LangContext),[Q,Y]=(0,r.useState)(!1),{storedVideoOptions:q}=(0,l.useVideoOptions)(),J=(0,v.useTypedSelector)((e=>!(!e.externalId||!e.speakers[(0,o.externalIdToString)(e.externalId)])));(0,r.useEffect)((()=>{(null==t?void 0:t.data)||Y(!1)}),[t,Q]);const X=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),j&&a&&a()}),[a,j]),ee=(0,r.useCallback)((e=>{G||(null==e.target.closest?void 0:e.target.closest(".CallBaseWidget__buttons"))||(T(),e.stopPropagation())}),[T]),te=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),T()}),[T]),ae=(0,E.usePipController)({handleDblClick:ee,handleMicButtonClick:X,onToggleVideo:z,isCollapsedPip:Z,isLocalVideoAllowed:W});return(0,n.jsx)(A.AppRootProvider,{children:(0,n.jsxs)("div",{className:(0,g.classNames)("CallBaseWidget",U,{"CallBaseWidget--pip":Z}),onDoubleClick:(0,f.vou)(!Z,ee),ref:(0,f.vou)(Z,ae.refContainer),children:[t&&t.data&&(0,n.jsx)(c.Video,{className:"CallBaseWidget__local",participantId:(0,o.externalIdToString)(I),stream:t.data,isMirrored:!y&&q[l.EVideoOptionType.IS_VIDEO_MIRRORED],isLocalSchreenShare:y,isContained:!1,isStartWithVisible:!0}),O&&(0,n.jsx)(d.Icon20RecordingCircleFill,{className:"CallBaseWidget__is-record-icon",fill:"var(--vkui--color_accent_red)",width:16,height:16}),(0,n.jsx)(_.Participant,{externalId:I,hasVideo:b,hasAudio:x,isSharingScreen:M,isMe:F,streamData:P,photo:R,name:N,status:H,allowContain:!1,networkStatus:k,isNFT:(0,f.vou)(!Z,w),isVmoji:V,isMiniApp:G}),D,(0,n.jsx)(h.CallIconButtonGroup,{alignX:"l",alignY:"b",size:"s",className:"CallBaseWidget__buttons",children:(0,n.jsx)("div",{className:"CallBaseWidget__tooltip",children:(0,n.jsx)(C.TextTooltip,{placement:"top-start",offsetDistance:-5,offsetSkidding:5,forcePortal:!0,sameWidth:!1,text:K(L?"calls_mute":"calls_unmute"),shown:(0,f.vou)(Z,!1),children:(0,n.jsx)(m.VKUICallIconButton,{icon:(0,n.jsx)(S.MicrophoneIcon,{amISpeaking:J,isLocalAudioEnabled:L,isMiniApp:G}),"aria-label":K(L?"calls_mute":"calls_unmute"),onClick:(0,f.vou)(!Z,X),getRootRef:(0,f.vou)(Z,ae.refBtnMic),disabled:!j})})})}),!Z&&(0,n.jsx)(h.CallIconButtonGroup,{alignX:"r",alignY:"b",size:"s",className:"CallBaseWidget__buttons",children:(0,n.jsx)("div",{className:"CallBaseWidget__tooltip",children:(0,n.jsx)(C.TextTooltip,{placement:"top-end",offsetDistance:-5,offsetSkidding:-5,forcePortal:!0,sameWidth:!1,text:B?B.text:K("calls_restore"),children:B?(0,n.jsx)(m.VKUICallIconButton,{className:B.buttonClass,"aria-label":B.text,icon:B.icon,onClick:B.onClick}):(0,n.jsx)(m.VKUICallIconButton,{"data-focus-first":!0,"aria-label":K("calls_restore"),type:"restore",onClick:te})})})}),Z&&(0,n.jsx)(h.CallIconButtonGroup,{alignX:"r",alignY:"b",size:"s",className:"CallVideoWidget__buttons",children:(0,n.jsx)("div",{className:"CallBaseWidget__tooltip",children:(0,n.jsx)(C.TextTooltip,{shown:!1,text:"any_text",forcePortal:!0,sameWidth:!1,children:(0,n.jsx)(m.VKUICallIconButton,{icon:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(u.Icon24Videocam,{style:(0,f.vou)(!$,{display:"none"})}),(0,n.jsx)(p.Icon24VideocamSlash,{style:(0,f.vou)($,{display:"none"})})]}),"aria-label":K($?"calls_camera_turn_off":"calls_camera_turn_on"),getRootRef:ae.refBtnCam,disabled:!W})})})})]})})}},308316:(e,t,a)=>{"use strict";a.d(t,{MicrophoneIcon:()=>l});var n=a(785893),o=a(986558),i=a(35566),r=a(589481),s=a(878198);function l({amISpeaking:e,isLocalAudioEnabled:t,isMiniApp:a}){return a?(0,n.jsxs)(n.Fragment,{children:[t&&(e?(0,n.jsx)(r.MicIconWithSpeakingIndicator,{}):(0,n.jsx)(o.Icon24Voice,{})),!t&&(0,n.jsx)(i.Icon24MicrophoneSlash,{})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Icon24Voice,{style:(0,s.vou)(!t,{display:"none"})}),(0,n.jsx)(i.Icon24MicrophoneSlash,{style:(0,s.vou)(t,{display:"none"})})]})}},329050:(e,t,a)=>{"use strict";a.d(t,{usePipController:()=>o});var n=a(667294);function o(e){const t=(0,n.useCallback)((t=>{t.preventDefault(),t.stopPropagation(),e.isLocalVideoAllowed&&e.onToggleVideo&&e.onToggleVideo()}),[e.onToggleVideo,e.isLocalVideoAllowed]),a=(0,n.useRef)(null),o=(0,n.useRef)(null),i=(0,n.useRef)(null);return(0,n.useEffect)((()=>{e.isCollapsedPip&&(a.current&&(a.current.ondblclick=e.handleDblClick),o.current&&(o.current.onclick=e.handleMicButtonClick),i.current&&(i.current.onclick=t))}),[e.isCollapsedPip,e.handleDblClick,e.handleMicButtonClick,t]),{handleCamButtonClick:t,refContainer:a,refBtnMic:o,refBtnCam:i}}},136486:(e,t,a)=>{"use strict";a.d(t,{CallButton:()=>c,CallButtonTypes:()=>n});var n,o=a(434788),i=a(820224),r=a(785893),s=a(667294),l=a(659397);!function(e){e.POSITIVE="positive",e.NEGATIVE="negative",e.REGULAR="regular",e.ON="on",e.OFF="off",e.CLEAR="clear",e.DISABLED="disabled"}(n||(n={}));const c=(0,s.forwardRef)(((e,t)=>{var{icon:a,text:n,type:s,className:c}=e,d=(0,i._)(e,["icon","text","type","className"]);const u=(0,l.classNames)("CallButton",`CallButton--${s}`,c,{"CallButton--withText":!!n},"CallButton--withAnimation"),p=(0,l.classNames)("CallButton__icon","CallButton__icon--withAnimation"),_=(0,o._)({},d,{onMouseDown:e=>{e.preventDefault(),d.onMouseDown&&d.onMouseDown(e)}});return(0,r.jsxs)("button",(0,o._)({className:u},_,{disabled:_.disabled||"disabled"===s,ref:t,children:[(0,r.jsx)("figure",{className:p,children:a}),n]}))}));c.displayName="CallButton"},504900:(e,t,a)=>{"use strict";a.d(t,{CallByNameModal:()=>C});var n=a(785893),o=a(667294),i=a(937107),r=a(463365),s=a(749856),l=a(346880),c=a(222574),d=a(224050),u=a(502592),p=a(479720),_=a(417174),m=a(512334),h=a(661307),g=a(659397),A=a(869048);const C=({items:e,actionButtons:t,onListItemClick:a,selectedId:C,onClose:v,onSearchChange:f})=>{const{getLang:S}=(0,o.useContext)(l.LangContext);return(0,n.jsx)(i.default,{className:"CallByNameModal",onClose:v,children:(0,n.jsxs)(A.AppRootProvider,{children:[(0,n.jsx)(r.ModalHeader,{title:S("calls_call_by_name_title"),onClose:v}),(0,n.jsxs)("div",{className:"CallByNameModal__content",children:[(0,n.jsx)(c.BlockSearchInput,{className:"CallByNameModalList__input",placeholder:S("calls_call_by_name_search_placeholder"),onChange:f,onInput:f,onPaste:f}),(0,n.jsx)(d.ListHeader,{extra:e.length||"",children:S("calls_call_by_name_list_header")}),0!==e.length&&(0,n.jsx)(u.default,{border:!1,className:"CallByNameModalList__list",children:e.map((e=>((e,t)=>{let o=null;return o=t===e.id?(0,n.jsx)("span",{className:"CallByNameModalList__selected",children:S("calls_call_by_name_selected")}):(0,n.jsx)("span",{className:"CallByNameModalList__select",children:S("calls_call_by_name_select")}),(0,n.jsx)(m.default,{onClick:()=>a(e.id),className:(0,g.classNames)("CallByNameModalList__listItem",{"CallByNameModalList__listItem--is-nft":!!e.isNFT}),aside:o,children:(0,n.jsx)(p.default,{photo:(0,n.jsx)(_.CallPhoto,{id:e.id,photo:e.photo,alt:e.name||"",className:"CallByNameModalList__photo",isNFT:e.isNFT}),title:e.name,href:e.link,target:"_blank"})},e.id)})(e,C)))}),0===e.length&&(0,n.jsx)(h.default,{children:S("calls_call_by_name_not_found")})]}),(0,n.jsx)(s.ModalFooter,{actionButtons:t})]})})}},292065:(e,t,a)=>{"use strict";a.d(t,{CallChangeNameModal:()=>A});var n=a(785893),o=a(667294),i=a(22412),r=a(86894),s=a(690839),l=a(827701),c=a(869048),d=a(400856),u=a(126116),p=a(56976),_=a(193527),m=a(119783),h=a(915961),g=a(788822);const A=({items:e,actionButtons:t,onListItemClick:a,selectedId:A,onClose:C,onNameChange:v,onClearName:f,changedName:S,error:E,disabled:T,participantMe:I})=>{const{getLang:y}=(0,h.useLang)(),N=(0,o.createRef)(),b=(0,o.useMemo)((()=>e.find((e=>e.id===A))),[A]);(0,o.useEffect)((()=>{var e;0===A&&(null==(e=N.current)||e.focus())}),[A]);const x=e=>{switch(e){case i.CallByNameProfileType.PROFILE:return y("calls_your_profile");case i.CallByNameProfileType.GROUP:return y("calls_your_group");case i.CallByNameProfileType.ANONYM:return y("calls_your_profile_will_hidden");default:return""}};return(0,n.jsx)(_.BaseModal,{className:"CallChangeNameModal",onClose:C,disableBackdropClick:!0,children:(0,n.jsx)(m.FocusTrap,{hasFirstFocusableElement:!0,children:(0,n.jsxs)(c.AppRootProvider,{children:[(0,n.jsx)(d.ModalHeader,{closeAriaLabel:y("calls_close"),onClose:C,children:y("calls_join_as")}),(0,n.jsxs)("div",{className:"CallChangeNameModal__content",children:[0!==e.length&&(0,n.jsx)(r.Group,{mode:"plain",separator:"show",children:(0,n.jsx)("div",{className:"CallChangeNameModal__items",children:e.map((e=>((e,t)=>{const o=t===e.id?(0,n.jsx)(s.Icon24CheckCircleOn,{}):null;return(0,n.jsx)(r.SimpleCell,{onClick:()=>a(e.id),after:o,"data-focus-first":t===e.id,before:0!==e.id&&e.photo?(0,n.jsx)(r.Avatar,{src:e.photo}):(0,n.jsx)(r.Avatar,{children:(0,n.jsx)(l.Icon28IncognitoOutline,{})}),subtitle:x(e.type),children:(0,g.decodeHTMLEntities)(e.name||"")},e.id)})(e,A)))})}),(0,n.jsx)("div",{className:"CallChangeNameModal__name",children:(0,n.jsx)(p.ChangeParticipantName,{onClearName:f,disabled:T,changedName:S,onNameChange:v,placeholder:null==b?void 0:b.name,error:E,top:y("calls_name_that_will_be_seen_in_calls"),participantRealName:I.name})})]}),(0,n.jsx)(u.ModalFooter,{actionButtons:t})]})})})}},482823:(e,t,a)=>{"use strict";a.d(t,{CallError:()=>r});var n=a(785893),o=a(513885),i=a(590028);const r=({title:e,onClose:t,actionButtons:a,text:r})=>(0,n.jsx)(o.default,{appearance:"blue",title:e,onClose:t,actionButtons:a,className:"CallError",children:(0,n.jsx)(i.ErrorPopupText,{children:r})})},120107:(e,t,a)=>{"use strict";a.d(t,{CallExitModal:()=>i});var n=a(785893),o=a(513885);const i=({onClose:e,actionButtons:t,description:a,title:i})=>(0,n.jsx)(o.default,{onClose:e,title:i,appearance:"blue",actionButtons:t,className:"CallExitModal",children:(0,n.jsx)("div",{className:"CallExitModal__text",children:a})})},331234:(e,t,a)=>{"use strict";a.d(t,{CallGridNew:()=>l});var n=a(785893),o=a(667294),i=a(659397),r=a(910434),s=a(22412);const l=({onScroll:e,scrollPosition:t,participantsCount:a,participantsShiftCount:l,children:c})=>{const d=o.Children.toArray(c),u=(0,i.classNames)("CallGridNew",`CallGridNew--c${a}`),p=(0,o.useRef)(null);(0,o.useEffect)((()=>{const t=()=>{null!==p.current&&e(p.current.scrollTop)};return null!==p.current&&p.current.addEventListener("scroll",t),()=>{p.current&&p.current.removeEventListener("scroll",t)}}),[]),(0,o.useEffect)((()=>{var a;e(t),null==(a=p.current)||a.scrollTo(0,t)}),[p.current]);const _=(0,o.useMemo)((()=>new Array(l).fill(0).map(((e,t)=>(0,n.jsx)("article",{className:"CallGridNew__item CallGridNew__item--empty"},-t)))),[l]),m=a-l-d.length>0;return(0,n.jsxs)("section",{className:u,id:s.ID_CALLS_PARTICIPANTS_BOX,ref:p,children:[(0,n.jsxs)("div",{className:"CallGridNew__in",children:[_,d.map(((e,t)=>(0,n.jsx)("article",{className:"CallGridNew__item","data-calls-id":"grid-item",children:e},e.key||t)))]}),m&&(0,n.jsx)(r.default,{color:"white",size:64,duration:1,className:"CallGridNew__spinner"})]})}},59547:(e,t,a)=>{"use strict";a.d(t,{CallHeader:()=>p});var n=a(785893),o=a(667294),i=a(659397),r=a(355268),s=a(888235),l=a(40598),c=a(752654),d=a(86894),u=a(915961);const p=(0,o.memo)((function({translation:e,roomStatus:t,speakers:a,hands:o,time:p,network:_,networkTooltipText:m,isTranslationRecord:h,isChainControls:g,onChainClick:A,asr:C}){const{getLang:v}=(0,u.useLang)(),f=(0,i.classNames)("CallHeader__hands",{"CallHeader__hands--visible":o>0}),S=!!t||!!h||!!C;return(0,n.jsxs)("div",{className:"CallHeader",children:[(0,n.jsxs)("div",{className:"CallHeader__main",children:[(0,n.jsxs)("div",{className:(0,i.classNames)({CallHeader__timeAndNetwork:!0,"CallHeader__timeAndNetwork--is-smaller":S}),children:[_<.6&&(0,n.jsx)(c.default,{text:m,align:"left",className:"Call__oldTooltip",children:(0,n.jsx)("div",{className:"CallHeader__network",children:(0,n.jsx)(r.Icon16Connection,{fill:_<=.3?"#ff5c5c":"#FECE00"})})}),p]}),S&&(0,n.jsx)("div",{className:"CallHeader__divider"}),t&&(0,n.jsx)("div",{className:"CallHeader__rooms",children:t}),e&&(0,n.jsx)("div",{className:"CallHeader__translation",children:e}),C&&(0,n.jsx)("div",{className:"CallHeader__asr",children:C})]}),(0,n.jsxs)("div",{className:"CallHeader__aside",children:[(0,n.jsx)("div",{className:"CallHeader__participants",children:a}),(0,n.jsxs)("div",{className:f,children:[(0,n.jsx)(s.Icon16Hand,{})," ",o]}),g&&(0,n.jsx)("div",{children:(0,n.jsx)(d.Button,{className:"CallHeader__chain-controls__btn","data-focus-first":!0,before:(0,n.jsx)(l.Icon12Chain,{}),size:"s",onClick:A,"aria-label":v("calls_copy_invite_link"),children:v("calls_link")})})]})]})}))},218284:(e,t,a)=>{"use strict";a.d(t,{CallHistoryList:()=>c});var n=a(785893),o=a(502592),i=a(661307),r=a(694379),s=a(444953),l=a(625533);const c=({calls:e,onMenuItemClick:t,stubText:a,hasMore:c,onLoadMore:d,selectedOwnerId:u=0})=>{const{isVkme:p}=(0,r.useVkmeContext)();return(0,n.jsx)(l.default,{useIntersectionObserver:p,useWindowScroll:!0,hasMore:c,loadMore:d,children:(0,n.jsxs)(o.default,{className:"CallHistoryList",border:!1,children:[e.map(((e,a)=>(0,n.jsx)(s.CallHistoryListItem,{selectedOwnerId:u,onMenuItemClick:t,call:e,index:a},a))),0===e.length&&(0,n.jsx)(i.default,{className:"CallHistoryList--stub",children:a})]})})}},444953:(e,t,a)=>{"use strict";a.d(t,{CallHistoryListItem:()=>P,HistoryCallMenuActionsEnum:()=>b});var n=a(785893),o=a(667294),i=a(659397),r=a(392772),s=a(141580),l=a(956996),c=a(25398),d=a(277659),u=a(59077),p=a(874908),_=a(432483),m=a(512334),h=a(694379),g=a(167810),A=a(563247),C=a(26660),v=a(558791),f=a(752654),S=a(514995),E=a(881310),T=a(562886),I=a(384627),y=a(347845),N=a(129502);var b;!function(e){e[e.AUDIO=0]="AUDIO",e[e.VIDEO=1]="VIDEO",e[e.MESSAGE=2]="MESSAGE",e[e.DELETE=3]="DELETE",e[e.PARTICIPANTS=4]="PARTICIPANTS"}(b||(b={}));const x=(e,t=0)=>{let a="";if(t){const n=new Date(t);if((0,i.isDateToday)(n)){const e=(0,i.leadingZero)(n.getMinutes());a=`${n.getHours()}:${e}`}else a=t?e(t,!1):""}return a},M=(e,t,a)=>(0,n.jsx)(E.DropdownActionSheetItem,{onClick:a,before:e,children:t},t),O=({index:e,call:t,onMenuItemClick:a,selectedOwnerId:E=0})=>{const b=(0,C.useHistoryScreenSelector)((e=>e.profiles)),{getLang:O,langShortDate:P}=(0,v.useLangContext)(),{isVkme:R}=(0,h.useVkmeContext)(),{member:k,chat:w}=(0,A.getHistoryItemOwner)(t,b),{navigateToConvo:D}=(0,g.useNavigationContext)(),{title:L,photo:j,href:B,hint:U,actions:H,peerId:F}=(0,o.useMemo)((()=>{const{type:o,items:u,started_at:p,finished_at:_,can_download_call_join_history:m}=t;let h="";p&&_&&(h=(0,i.formatDuration)(Math.floor((_-p)/1e3)));const{date:g,time:C}=((e=0)=>{if(!e)return{date:"",time:""};const t=new Date(e),a=t.getDate(),n=t.getMonth()+1,o=t.getFullYear(),r=t.getHours(),s=t.getMinutes();return{date:[(0,i.leadingZero)(a),(0,i.leadingZero)(n),o].join("."),time:[(0,i.leadingZero)(r),(0,i.leadingZero)(s)].join(":")}})(_);let{title:v="",photo:f="",href:E="",hint:I="",status:y=""}=w?((e,t,{title:a="",photo_100:o="",id:i=0},{finished_at:r=0})=>{const s=i?"/im?sel=c"+i:"";let l="";const c=e("calls_history_call_type_group_hint");let d=x(t,r);return l=d?e("calls_history_call_type_group_time_hint").replace("{time}",d):"",{title:a,href:s,hint:l,photo:(0,n.jsx)(S.AvatarRich,{isNFT:!1,src:o||"/images/camera_c.gif",imgAlt:a,size:32}),status:c}})(O,P,w,t):k?((e,t,{name:a="",photo:o="",id:l=0,link:c="",is_nft:d},{is_inbound:u=!1,finished_at:p=0,reach_status:_=""})=>{const m=(0,n.jsx)(S.AvatarRich,{isNFT:!!d,src:o,imgAlt:a,size:32}),h=u?(0,n.jsx)(r.Icon12ArrowDownLeft,{className:"CallHistoryListItem--hintIcon"}):(0,n.jsx)(s.Icon12ArrowUpRight,{className:"CallHistoryListItem--hintIcon"});let g=x(t,p),A="",C=!1;return u?"CANCELLED_BY_INITIATOR"===_?(A=e("calls_history_status_inb_cancelled_by_initiator"),C=!0):A=e("REACHED"===_?"calls_history_status_inb_reached":"REJECTED_BY_RECEIVER"===_?"calls_history_status_inb_reject_by_receiver":"calls_history_status_inb"):"CANCELLED_BY_INITIATOR"===_?A=e("calls_history_status_out_cancelled_by_initiator"):"REACHED"===_?A=e("calls_history_status_out_reached"):"REJECTED_BY_RECEIVER"===_?(A=e("calls_history_status_out_reject_by_receiver"),C=!0):A=e("calls_history_status_out"),{title:a,href:c||"/id"+l,hint:(0,n.jsxs)("div",{className:(0,i.classNames)({"CallHistoryListItem--important":C}),children:[h,e("calls_history_call_list_item_description").replace("%type",A).replace("%time",g)]}),photo:m,status:A}})(O,P,k,t):{};v+="merged"===o?` (${null==u?void 0:u.length})`:"";const N=(0,A.getHistoryCallPeerId)(t),b=[],R=n=>()=>a(t,n,e);return b.push((0,n.jsxs)("div",{className:"CallHistoryListItem--dropdownItemStatus",children:[(0,n.jsxs)("div",{className:"CallHistoryListItem--dropdownItemStatusFinishTime",children:[(0,n.jsx)("div",{className:"CallHistoryListItem--dropdownItemStatusDate",children:g}),(0,n.jsx)("div",{className:"CallHistoryListItem--dropdownItemStatusTime",children:C})]}),(0,n.jsx)("div",{className:"CallHistoryListItem--dropdownItemStatusType",children:y}),!!h&&(0,n.jsx)("div",{className:"CallHistoryListItem--dropdownItemStatusDuration",children:h})]},g)),m&&b.push(M((0,n.jsx)(l.Icon20UserOutline,{}),O("calls_history_dropdown_item_participants"),R(4))),N&&(b.push(M((0,n.jsx)(c.Icon20MessageOutline,{}),O("calls_history_dropdown_item_message"),R(2))),b.push((0,n.jsx)(T.DropdownActionSheetSeparator,{},"separator"))),b.push(M((0,n.jsx)(d.Icon20DeleteOutline,{}),O("calls_history_dropdown_item_delete"),R(3))),{title:v,photo:f,href:E,hint:I,actions:b,peerId:N}}),[t]);return k||w?(0,n.jsx)(m.default,{className:"CallHistoryListItem",selectable:!1,canBeHovered:!1,aside:(0,n.jsxs)("div",{className:"CallHistoryListItem--aside",children:[!!F&&!(null==w?void 0:w.left_or_kicked)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.default,{marginTop:-7,position:"t",text:O("calls_history_join_with_audio"),children:(0,n.jsx)(N.SmallIconButton,{"aria-label":`${O("calls_history_dropdown_item_audio")} ${L}`,onClick:()=>a(t,0,e,E),children:(0,n.jsx)(u.Icon24PhoneOutline,{})})}),(0,n.jsx)(f.default,{marginTop:-7,position:"t",text:O("calls_history_join_with_video"),children:(0,n.jsx)(N.SmallIconButton,{"aria-label":`${O("calls_history_dropdown_item_video")} ${L}`,onClick:()=>a(t,1,e,E),children:(0,n.jsx)(p.Icon24VideocamOutline,{})})})]}),(0,n.jsx)(I.DropdownActionSheet,{action:"hover",width:250,placement:"bottom-end",content:(0,n.jsx)(n.Fragment,{children:H}),children:(0,n.jsx)(N.SmallIconButton,{"aria-expanded":"false","aria-label":O("calls_actions"),children:(0,n.jsx)(_.Icon24MoreHorizontal,{})})})]}),children:(0,n.jsx)(y.CallsRichCell,{before:(0,n.jsx)("div",{className:"CallHistoryListItem__Avatar",children:j}),caption:U||O("calls_history_call_type_group_hint"),href:B,onClick:e=>{R&&(e.preventDefault(),e.stopPropagation(),D(F))},title:L})}):(0,n.jsx)(n.Fragment,{})},P=(0,o.memo)(O)},434378:(e,t,a)=>{"use strict";a.d(t,{CallHistoryScreen:()=>d});var n=a(785893),o=a(169968),i=a(86894),r=a(256885),s=a(292071),l=a(694379),c=a(611654);const d=({showCreateCall:e,onCreateCallClick:t,activeMenuItem:a,menuItems:d,onMenuItemClick:u,loading:p,banner:_,children:m,onPlanCalendarEvent:h})=>{const{isVkme:g}=(0,l.useVkmeContext)();return(0,n.jsx)(o.PageColumns,{narrow:g?(0,n.jsx)(i.ButtonGroup,{gap:"m",className:"CallHistoryScreen--vkmeButtonsGroup",children:d.map((e=>"item"===e.type&&(0,n.jsx)(i.Button,{mode:a===e.id?"primary":"secondary",onClick:()=>u(e.id),children:e.label},e.id)))}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.RightMenu,{items:d,selectedId:a,onSelect:u,isLoading:p,className:"page_block_cell",separator:"hide"}),_]}),children:(0,n.jsxs)("div",{className:"CallHistoryScreen",children:[e&&(0,n.jsx)(r.CallHistoryScreenCreateCall,{onCreateCallClick:()=>t(s.CallStatSource.HISTORY_CREATE),onPlanCalendarEvent:h}),m]})})}},256885:(e,t,a)=>{"use strict";a.d(t,{CallHistoryScreenCreateCall:()=>c});var n=a(785893),o=a(86894),i=a(415080),r=a(775427),s=a(558791),l=a(545637);const c=({onCreateCallClick:e,onPlanCalendarEvent:t})=>{const{getLang:a}=(0,s.useLangContext)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Spacing,{size:16}),(0,n.jsx)(o.Group,{separator:"hide",children:(0,n.jsxs)(l.Div,{className:"CallHistoryScreenCreateCall",mode:"horizontal",spacing:4,children:[(0,n.jsx)(o.Text,{children:a("calls_page_call_by_link_header_v2")}),(0,n.jsxs)(o.ButtonGroup,{gap:"s",children:[(0,n.jsx)(o.Button,{onClick:e,size:"s",mode:"primary",before:(0,n.jsx)(i.Icon20PhoneOutline,{width:16,height:16}),children:a("calls_page_call_by_link_create")}),(0,n.jsx)(o.Button,{onClick:t,size:"s",mode:"secondary",before:(0,n.jsx)(r.Icon16CalendarOutline,{}),children:a("calls_landing_standalone_schedule_call")})]})]})})]})}},814850:(e,t,a)=>{"use strict";a.d(t,{CallHistoryScreenLanding:()=>u});var n=a(785893),o=a(163749),i=a(518653),r=a(453505),s=a(292071),l=a(558791),c=a(418366),d=a(86894);const u=({onCreateCallClick:e})=>{const{getLang:t}=(0,l.useLangContext)();return(0,n.jsx)("div",{className:"CallHistoryScreenLanding",children:(0,n.jsxs)("div",{className:"CallHistoryScreenLanding--content",children:[(0,n.jsx)("div",{className:"CallHistoryScreenLanding--header",children:t("calls_screen_landing_header")}),(0,n.jsx)("div",{className:"CallHistoryScreenLanding--subheader",children:t("calls_screen_landing_subheader")}),(0,n.jsxs)("div",{className:"CallHistoryScreenLanding--list",children:[(0,n.jsx)(c.OnboardingBenefit,{before:(0,n.jsx)(o.Icon28UserOutline,{}),children:t("calls_screen_landing_feature_participants")}),(0,n.jsx)(c.OnboardingBenefit,{before:(0,n.jsx)(i.Icon28ChainOutline,{}),children:t("calls_screen_landing_feature_anon")}),(0,n.jsx)(c.OnboardingBenefit,{before:(0,n.jsx)(r.Icon28ArrowUpRectangleOutline,{}),children:t("calls_screen_landing_feature_share")})]}),(0,n.jsx)(d.Button,{mode:"primary",size:"l",onClick:()=>e(s.CallStatSource.HISTORY_CREATE),children:t("calls_current_calls_create_call_by_link")})]})})}},687054:(e,t,a)=>{"use strict";a.d(t,{CallIconButton:()=>d,VKUICallIconButton:()=>u});var n=a(434788),o=a(820224),i=a(785893),r=a(667294),s=a(659397),l=a(86894);const c=({className:e,isActive:t,disabled:a,type:n})=>(0,s.classNames)("CallIconButton",e,"CallIconButton--withAnimation",{"CallIconButton--active":t,"CallIconButton--disabled":a,[`CallIconButton--${n}`]:!!n}),d=(0,r.forwardRef)(((e,t)=>{var{type:a,isActive:r,icon:s,className:l,disabled:d=!1}=e,u=(0,o._)(e,["type","isActive","icon","className","disabled"]);const p=c({className:l,isActive:r,disabled:d,type:a}),_=(0,n._)({},u,{onMouseDown:e=>{e.preventDefault(),u.onMouseDown&&u.onMouseDown(e)}});return(0,i.jsx)("button",(0,n._)({},_,{className:p,ref:t,children:s}))})),u=e=>{const{icon:t,className:a,isActive:r,disabled:s,type:d}=e,u=(0,o._)(e,["icon","className","isActive","disabled","type"]),p=c({className:a,isActive:r,disabled:s,type:d});return(0,i.jsx)(l.IconButton,(0,n._)({sizeY:l.SizeType.REGULAR,style:{padding:0,maxHeight:"48px"},hasActive:!1,hasHover:!1},u,{children:(0,i.jsx)("div",{className:p,children:t})}))};d.displayName="CallIconButton"},487416:(e,t,a)=>{"use strict";a.d(t,{CallIconButtonGroup:()=>l});var n=a(434788),o=a(820224),i=a(785893),r=a(667294),s=a(659397);const l=(0,r.forwardRef)((function(e,t){var{children:a,className:r,alignX:l,alignY:c,size:d="m"}=e,u=(0,o._)(e,["children","className","alignX","alignY","size"]);const p=(0,s.classNames)("CallIconButtonGroup",`CallIconButtonGroup--${l}`,`CallIconButtonGroup--${c}`,`CallIconButtonGroup--size-${d}`,r);return(0,i.jsx)("div",(0,n._)({className:p,ref:t},u,{children:a}))}))},77324:(e,t,a)=>{"use strict";a.d(t,{CallLink:()=>d});var n=a(785893),o=a(667294),i=a(511527),r=a(3046),s=a(86424),l=a(159868),c=a(346880);const d=({link:e="",isLinkLoading:t,isCopied:a,hideCopiedText:d})=>{const{getLang:u}=(0,o.useContext)(c.LangContext);return(0,n.jsxs)("div",{className:"CallLink",children:[(0,n.jsx)("label",{htmlFor:"CallLink__input",className:"CallLink__info",children:u("calls_management_link_info_desc")}),t?(0,n.jsx)(s.default,{className:"CallLink__input",children:(0,n.jsx)(l.default,{})}):(0,n.jsxs)("div",{className:"CallLink__input",children:[(0,n.jsx)(i.default,{id:"CallLink__input",readOnly:"readonly",value:e}),(0,n.jsx)("div",{children:(0,n.jsxs)("div",{className:"CallLink__hint",children:[u("calls_management_add_warning"),(0,n.jsx)(r.default,{className:"CallLink__copied",shown:a,callback:d,children:u("calls_link_copied")})]})})]})]})}},511008:(e,t,a)=>{"use strict";a.d(t,{CallLinkSettings:()=>_});var n=a(785893),o=a(667294),i=a(346880),r=a(472007),s=a(512334),l=a(502592),c=a(43291),d=a(556294),u=a(536457),p=a(315226);const _=({requireAuthToJoin:e=!1,onRequireAuthToJoinChanged:t,isWaitingHallBlockShown:a=!1,isWaitingHallEnabled:_=!1,onWaitingHallEnabledChanged:m})=>{const{getLang:h}=(0,o.useContext)(i.LangContext),[g,A]=(0,o.useState)(!e),[C,v]=(0,o.useState)(_);let f=!1;const S=(0,o.useCallback)((()=>{if(f)return;f=!0;const e=!g;A(e),t&&t(!e)}),[e]);let E=!1;const T=(0,o.useCallback)((()=>{if(E)return;E=!0;const e=!C;v(e),m&&m(e)}),[_]);return(0,n.jsxs)(l.default,{children:[a&&(0,n.jsxs)("button",{role:"checkbox","aria-checked":C,className:"CallLinkSettings__a11y-button",onClick:T,children:[(0,n.jsx)(c.ListItemWithHint,{canBeHovered:!1,icon:(0,n.jsx)(d.ListIcon,{icon:(0,n.jsx)(u.Icon24DoorArrowLeftOutline,{width:20,height:20}),color:d.ListIconColors.BLUE}),hint:h("calls_menu_waiting_hall_description"),selectable:!0,aside:(0,n.jsx)(r.default,{tabIndex:-1,onChange:T,checked:C}),children:h("calls_menu_waiting_hall_title")}),(0,n.jsx)("li",{className:"CallLinkSettings__a11y-button-fake-list-item"})]}),(0,n.jsx)("button",{role:"checkbox","aria-checked":g,className:"CallLinkSettings__a11y-button",onClick:S,children:(0,n.jsx)(s.default,{border:!0,canBeHovered:!1,selectable:!0,icon:(0,n.jsx)(p.Icon28SunglassesCircleFillGray,{}),aside:(0,n.jsx)(r.default,{tabIndex:-1,onChange:S,checked:g}),children:h("calls_management_link_allow_anonymous")})})]})}},368754:(e,t,a)=>{"use strict";a.d(t,{CallManagementMenu:()=>u});var n=a(785893),o=a(667294),i=a(502592),r=a(512334),s=a(556294),l=a(202716),c=a(718069),d=a(346880);const u=({isLinkBlockShown:e,linkBlockTitle:t,onLinkBlockClick:a,callUrlLink:u})=>{const{getLang:p}=(0,o.useContext)(d.LangContext);return(0,n.jsx)(i.default,{children:e&&(0,n.jsxs)(r.default,{onClick:a,chevron:!0,icon:(0,n.jsx)(s.ListIcon,{icon:(0,n.jsx)(l.LinkIcon,{}),color:s.ListIconColors.GREEN}),aside:(0,n.jsx)("span",{className:"CallManagementMenu__asideHint",children:p("calls_menu_link_setup")}),children:[t,u&&(0,n.jsx)(c.ListCopyControl,{value:u,copyText:p("calls_menu_link_copy"),doneText:p("calls_menu_link_copied")})]})})}},645329:(e,t,a)=>{"use strict";a.d(t,{CallManagementModal:()=>s});var n=a(785893),o=a(667294),i=a(513885),r=a(346880);const s=({title:e,onCloseModal:t,hint:a,actionButtons:s,isWithBackButton:l,onBackClick:c,children:d})=>{const{getLang:u}=(0,o.useContext)(r.LangContext);return(0,n.jsx)(i.default,{className:"CallManagementModal",onClose:t,actionButtons:s||[],footerHint:a,backText:l?u("calls_back"):void 0,onBack:c,title:e,children:(0,n.jsx)("div",{className:"CallManagementModal__content",children:o.Children.toArray(d).map(((e,t)=>(0,n.jsx)("div",{className:"CallManagementModal__section",children:e},t)))})})}},230768:(e,t,a)=>{"use strict";a.d(t,{CallManagementModalActionButtons:()=>l});var n=a(785893),o=a(589897),i=a(915961),r=a(413437),s=a(64195);const l=({isAddSubmitDisabled:e,onAdd:t,onAddAll:a,tab:l,showCallAll:c})=>{const{getLang:d}=(0,i.useLang)();return(0,n.jsxs)(n.Fragment,{children:[l===r.ETabName.Participants&&c&&(0,n.jsxs)(o.default,{className:"CallManagementModal__callAllButton",size:"m",mode:"secondary",onClick:a,children:[(0,n.jsx)(s.Icon16Phone,{height:15,className:"CallManagementModal__callAllButton__icon"}),(0,n.jsx)("div",{children:d("calls_call_all")})]}),(0,n.jsx)(o.default,{mode:"primary",size:"m",disabled:e,onClick:t,children:d("calls_add")})]})}},409157:(e,t,a)=>{"use strict";a.d(t,{CallMiniAppWidget:()=>A});var n=a(434788),o=a(785893),i=a(667294),r=a(346880),s=a(336470),l=a(696137),c=a(50533),d=a(22412),u=a(755836),p=a(210475),_=a(86894),m=a(562090),h=a(396901),g=a(152789);const A=e=>{const{localDeviceStatus:t=1}=e,a=(0,g.useActiveDevicesListCount)(),{getLang:A}=(0,i.useContext)(r.LangContext),C=(0,c.useSelector)((e=>e)),v=(0,h.useTypedDispatch)(),f=(0,m.useCallNotifications)("CallOrator__notification"),{canTransferAdminRights:S,showTransferAdminRightsDialog:E,showLeaveBox:T}=(0,u.useLeaveCall)(C,a),I=(0,i.useMemo)((()=>S?E:T),[S,E,T]),y=(0,i.useCallback)((()=>{v({type:d.E_ACTION.CALL_NOTIFICATION,notification:null})}),[v]);(0,i.useEffect)((()=>{t>.6?y():v({type:d.E_ACTION.CALL_NOTIFICATION,notification:{type:d.NotificationType.NETWORK_PROBLEMS,data:{status:t<.3?"bad":"weak"}}})}),[t]);const N=(0,i.useMemo)((()=>({text:A("calls_exit"),buttonClass:"CallIconButton--leaveCall",icon:(0,o.jsx)(s.Icon28PhoneDownFilled,{width:24,height:24}),onClick:I})),[I]);return(0,o.jsxs)(p.CallBaseWidget,(0,n._)({rightButton:N,widgetClass:"CallMiniAppWidget",isMiniApp:!0},e,{children:[f,(0,o.jsxs)("div",{className:"CallMiniAppWidget__bottomInfo",children:[(0,o.jsx)(l.Icon16Users,{}),(0,o.jsx)(_.Footnote,{weight:"3",style:{lineHeight:"48px"},children:a})]})]}))}},807083:(e,t,a)=>{"use strict";a.d(t,{CallModal:()=>d});var n=a(785893),o=a(667294),i=a(396901),r=a(937107),s=a(212169),l=a(22412),c=a(659397);const d=({onClose:e,onBackdropClick:t,isIncoming:a=!1,isCautionBoxShown:d=!1,className:u,children:p})=>{const _=(0,i.useTypedDispatch)(),m=(0,c.classNames)("CallModal","CallModal--withAnimation",u,{"CallModal--isIncoming":a});(0,s.usePseudoLayer)();const h=()=>{_({type:l.E_ACTION.SHOW_CAUTION_BOX,isOpen:!0,isIncoming:a||!1})},g=(0,o.useCallback)((()=>d?h():e()),[d,h,e]);return(0,n.jsx)(r.default,{className:m,disableBodyScroll:!0,onClose:g,onBackdropClick:t,children:p})}},687889:(e,t,a)=>{"use strict";a.d(t,{CallNotification:()=>i});var n=a(785893),o=a(659397);const i=({children:e,className:t})=>{const a=(0,o.classNames)("CallNotification",t);return(0,n.jsx)("div",{className:a,children:e})}},52929:(e,t,a)=>{"use strict";a.d(t,{CallOrator:()=>g});var n=a(785893),o=a(667294),i=a(659397),r=a(712924),s=a(714308),l=a(364548),c=a(849081),d=a(542602),u=a(496111),p=a(808714),_=a(850144),m=a(562090),h=a(558791);const g=({children:e,onToggleParticipantsAside:t,isShownParticipantsAside:a,onScroll:g,scrollPosition:A,participantsAsideCount:C,firstRenderedParticipantIndex:v,isFullScreen:f,onStopScreenShare:S,orator:E,handleShowCallControls:T,watchTogetherMovieState:I,localExternalId:y,me:N,groupId:b,meGroup:x,isPinned:M,isPinnedByAdmin:O,isPinnedByShareScreen:P,isUnpinAllowed:R,onUnpin:k,tooltips:w,onTooltipChange:D,onFullScreenToggle:L,isServerTopology:j})=>{const{getLang:B}=(0,h.useLangContext)(),{device:U,externalId:H}=E,F=(0,s.useSetStreamMode)(H),V=(0,o.useMemo)((()=>(0,u.getAvailableStreamModes)(U)),[U]),G=o.Children.toArray(e),W=(0,i.classNames)("CallOrator__toggleIcon","CallOrator__toggleIcon--withAnimation"),$=(0,i.classNames)("CallOrator",{"CallOrator--withoutOthers":!a}),z=(0,i.classNames)("CallOrator__others",{"CallOrator__others--hide":!a}),Z=(0,i.classNames)("CallOrator__orator",{"CallOrator__orator--fullScreen":f}),K=(0,i.classNames)("CallOrator__toggleOthers",{"CallOrator__orator--fullScreen":f}),Q=(0,o.useRef)(null);(0,o.useEffect)((()=>{const e=()=>{null!==Q.current&&g(Q.current.scrollTop)};return null!==Q.current&&Q.current.addEventListener("scroll",e),()=>{Q.current&&Q.current.removeEventListener("scroll",e)}}),[]),(0,o.useEffect)((()=>{var e;g(A),null==(e=Q.current)||e.scrollTo(0,A)}),[Q.current]);const Y=0===v?0:v*(_.SAUSAGE_PARTICIPANT_HEIGHT+_.SAUSAGE_PARTICIPANT_MARGIN)-_.PARTICIPANTS_LIST_ORATOR_BOTTOM_OFFSET,q=(0,m.useCallNotifications)("CallOrator__notification");return(0,n.jsxs)("article",{className:$,ref:Q,children:[(0,n.jsxs)("main",{className:Z,onDoubleClick:L,children:[(0,n.jsxs)("div",{className:"CallOrator__topControlPanel",children:[(0,n.jsx)(p.OratorTitle,{orator:E.participant,oratorDevice:E.device,me:N,isPinned:M,isPinnedByAdmin:O,isPinnedByShareScreen:P,isUnpinAllowed:R,onUnpin:k,tooltips:w,onTooltipChange:D,meGroup:x}),q,V.length>1&&U.streamMode&&(0,n.jsx)(r.StreamModeSwitcher,{availableModes:V,currentMode:U.streamMode,setMode:F})]}),(0,n.jsx)(d.OratorMain,{onStopScreenShare:S,orator:E,handleShowCallControls:T,watchTogetherMovieState:I,localExternalId:y,me:N,groupId:b,meGroup:x,isServerTopology:j})]}),(0,n.jsx)("button",{className:K,onClick:t,"aria-label":B(a?"callsdesktop_34":"callsdesktop_33"),children:a?(0,n.jsx)(l.Icon16Chevron,{className:W}):(0,n.jsx)(c.Icon16ChevronLeft,{className:W})}),(0,n.jsx)("aside",{className:z,children:(0,n.jsxs)("ul",{className:"CallOrator__list",style:{height:C*(_.SAUSAGE_PARTICIPANT_HEIGHT+_.SAUSAGE_PARTICIPANT_MARGIN)},children:[Y>0&&(0,n.jsx)("li",{className:"CallOrator__participant","data-calls-id":"participant",style:{height:`${Y}px`}},-1),G.map((e=>(0,n.jsx)("li",{className:"CallOrator__participant","data-calls-id":"participant",children:e},"key"in e?e.key:void 0)))]})})]})}},542602:(e,t,a)=>{"use strict";a.d(t,{OratorMain:()=>m});var n=a(785893),o=a(667294),i=a(37240),r=a(496111),s=a(464380),l=a(455319),c=a(130658),d=a(558791),u=a(808474),p=a(737598),_=a(878198);const m=({onStopScreenShare:e,orator:t,handleShowCallControls:a,watchTogetherMovieState:m,localExternalId:h,me:g,groupId:A,meGroup:C,isServerTopology:v})=>{var f,S,E;const{getLang:T}=(0,d.useLangContext)();let I,y,N,{device:b,participant:x}=t;"externalId"in b?(I=(0,r.isSameExternalId)(b.externalId,h),y=(0,r.externalIdToString)(b.externalId),N=b.externalId):(I=(null==x?void 0:x.peerId)===g,y=null==x?void 0:x.peerId,N=h||(0,r.getDefaultExternalId)()),I&&A&&C&&(x=x&&(0,l.mergeGroupToParticipant)(C,x));const M=(0,o.useMemo)((()=>(0,r.getStream)(b,{animojiBackendRender:!I&&v})),[b,I,v]),O=!(!(0,r.isParticipantWithVideo)(b)||!(null==M?void 0:M.data)),P=(0,p.useIsMeCanManageWatchTogether)(),{handleRemoveMovie:R,handleMovieSoundChange:k,handleMoviePause:w,handleMovieRewind:D,handleMoviePlay:L,handleMovieMute:j,handleMovieUnMute:B}=(0,u.useMovieShareActions)(),{movieStreamInfo:U,movieStream:H,streamMode:F}=b;return H&&U&&(F===s.MediaType.MOVIE||F===s.MediaType.STREAM)?(0,n.jsx)(c.MoviePlayer,{title:null==U?void 0:U.title,vkMovieId:null==U?void 0:U.movieId,current:(null==m?void 0:m.offset)||0,volumeValue:null==m?void 0:m.gain,isPlayed:!(null==m?void 0:m.pause),isMuted:null==m?void 0:m.mute,total:null==U?void 0:U.duration,streamData:M,onPause:w,onPlay:L,onRewind:D,onChangeVolume:k,onMute:j,onUnMute:B,onRemove:R,isEditable:P,handleShowCallControls:a,isMovieStreamEnabled:!0,mode:U.source}):(0,n.jsx)(i.Participant,{externalId:N,isOrator:!0,isMe:I,hasVideo:!!O,hasAudio:!!(null==(f=b.mediaSettings)?void 0:f.isAudioEnabled),isSharingScreen:!!(null==(S=b.mediaSettings)?void 0:S.isScreenSharingEnabled),streamData:M,photo:null==x?void 0:x.photo,name:I?T("calls_own_label"):(0,l.getUserName)(x),status:b.status,wasConnected:b.wasConnected,networkStatus:b.networkStatus,allowContain:!0,onStopScreenShare:e,isNFT:(0,_.vou)(!C,null==x?void 0:x.is_nft),isVmoji:!!(null==(E=b.mediaSettings)?void 0:E.isAnimojiEnabled)},y)}},850144:(e,t,a)=>{"use strict";a.d(t,{PARTICIPANTS_LIST_ORATOR_BOTTOM_OFFSET:()=>i,SAUSAGE_PARTICIPANT_HEIGHT:()=>n,SAUSAGE_PARTICIPANT_MARGIN:()=>o});const n=130,o=4,i=6},104712:(e,t,a)=>{"use strict";a.d(t,{CallParticipantList:()=>c});var n=a(785893),o=a(667294),i=a(222574),r=a(224050),s=a(502592),l=a(346880);const c=({searchQuery:e,onSearchChange:t,length:a,children:c,waitingHallList:d})=>{const{getLang:u}=(0,o.useContext)(l.LangContext);return(0,n.jsxs)("div",{className:"CallParticipantList",children:[(0,n.jsx)(i.BlockSearchInput,{value:e,placeholder:u("calls_search_participants_placeholder"),onChange:t,onInput:t,onPaste:t,className:"CallParticipantList__input"}),!!d&&d,(0,n.jsx)(r.ListHeader,{extra:a||"",children:u("calls_participant_list_header")}),(0,n.jsx)(s.default,{border:!1,className:"CallParticipantList__list",children:c})]})}},260929:(e,t,a)=>{"use strict";a.d(t,{CallParticipantListRow:()=>v});var n=a(785893),o=a(667294),i=a(496111),r=a(490287),s=a(464380),l=a(512334),c=a(952815),d=a(711501),u=a(479720),p=a(417174),_=a(971),m=a(878198),h=a(455319),g=a(444972),A=a(167810);const C=({device:e,canMute:t,onUnmuteDevice:a,SDK:o,deviceId:C})=>{var v,f,S,E;const{navigateToProfile:T}=(0,A.useNavigationContext)(),I=(0,r.useTypedSelector)((e=>e.me)),y=(0,r.useTypedSelector)((t=>t.participants[e.externalId.id])),N=(0,r.useTypedSelector)((e=>e.externalId)),b=(0,r.useTypedSelector)((e=>e.speakers[C])),x=(0,i.isSameExternalId)(e.externalId,N),M=x?_.GlobalStore.getCallsState().localDevice:y,O=(null==y?void 0:y.peerId)!==I&&e.status===s.ParticipantStatus.WAITING,P=!O&&!(null==(v=e.mediaSettings)?void 0:v.isAudioEnabled),R=!O&&!(null==(f=e.mediaSettings)?void 0:f.isVideoEnabled),k=!O&&!!(null==(S=e.statusData)||null==(E=S.hand)?void 0:E.state),w=O||P||k||b,D=!O&&(P||R)&&t&&!x;return(0,n.jsx)(l.default,{selectable:!1,border:!1,aside:(0,n.jsxs)(n.Fragment,{children:[w&&(0,n.jsx)(c.ParticipantIndicators,{showSpeaking:b,showRaisedHand:k,showAudioDisabled:P,showConnecting:O,showRaisedHandTooltip:D,onRaisedHandClick:D?()=>a(e):void 0},"indicators"),(0,n.jsx)(d.ParticipantMenuContainer,{SDK:o,participant:y,device:e},"menu")]}),children:(0,n.jsx)(u.default,{className:"CallParticipantList__Entity",onLinkClick:(e,t)=>{T(e,t,y.peerId)},photo:(0,n.jsx)(p.CallPhoto,{id:null==y?void 0:y.peerId,photo:null==y?void 0:y.photo,alt:(null==y?void 0:y.name)||"",showCreatorBadge:(0,i.isCreator)(M),showAdminBadge:(0,i.isAdmin)(M),isNFT:null==y?void 0:y.is_nft,className:(0,m.vou)(null==y?void 0:y.is_nft,"CallPhoto--nft")}),title:(0,h.getUserName)(y)||(0,n.jsx)(g.Skeleton,{width:100,height:15}),href:null==y?void 0:y.link,target:"_blank",ignoreDecodeHTML:!0})},C)},v=(0,o.memo)(C)},732926:(e,t,a)=>{"use strict";a.d(t,{useReactionsColumn:()=>u});var n=a(667294),o=a(464380),i=a(659397),r=a(151582),s=a(22412),l=a(878198),c=a(752540);const d=[[4e3,600],[3e3,450],[2e3,300]],u=({refCall:e,onAdd:t})=>{const a=(0,r.useIsMounted)(),u=(0,n.useRef)(0),p=(0,n.useRef)(null),_=function(e){const t=(0,n.useRef)(0);return(0,n.useEffect)((()=>{if(!e.current)return;const a=new ResizeObserver((e=>{for(const a of e){const{height:e}=a.contentRect;if((0,l.minmax)(e,s.CALL_MIN_H,s.CALL_MAX_H)){const a=s.CALL_MAX_H-s.CALL_MIN_H,n=e-s.CALL_MIN_H;t.current=n/a}else e<s.CALL_MIN_H?t.current=.001:t.current=0}}));return a.observe(e.current),()=>{a.disconnect()}}),[]),t}(e),m=(0,c.useRef)((()=>new o.ArrayDequeue(100))),h=(0,n.useRef)(d[0][0]),g=(0,n.useRef)(d[0][1]),A=(0,n.useRef)(!1),C=(0,n.useRef)([]),v=()=>{const e=h.current,t=m.current.left;if(t>=30?(h.current=d[2][0],g.current=d[2][1]):t>=20?(h.current=d[1][0],g.current=d[1][1]):(h.current=d[0][0],g.current=d[0][1]),_.current&&(g.current+=Math.floor((1-_.current)*g.current/3)),!(0,i.isEqual)(e,h.current)&&C.current)return A.current=e>h.current,!0},f=e=>{C.current=C.current.filter((t=>t.id!==e))},S=()=>{if(p.current||!m.current.left||!a())return;if(A.current)return C.current.length||(A.current=!1),void E(g.current);const e=Date.now()-u.current;if(e>g.current){if(u.current=Date.now(),v())return void S();const e=m.current.next();return e&&"visible"===document.visibilityState&&(e.animationSpeed=h.current,e.onAnimationEnd=f,C.current.push(e),t(e)),void S()}E(g.current-e)};function E(e){p.current=setTimeout((()=>{p.current=null,S()}),e)}const T=(0,n.useCallback)((e=>{(0,l.createImmediate)((()=>{if(Array.isArray(e))for(const t of e)m.current.add(t);else m.current.add(e);v(),S()}))}),[]);return{add:T}}},573491:(e,t,a)=>{"use strict";a.d(t,{useReactionsController:()=>o});var n=a(667294);const o=({onHand:e,onReaction:t,onTooltipChange:a})=>({onReactionClick:(0,n.useCallback)((e=>{a("hand",!1),null==t||t(e)}),[t]),onHandClick:(0,n.useCallback)((()=>{a("hand",!1),null==e||e()}),[e]),onTooltipChange:a})},668122:(e,t,a)=>{"use strict";a.d(t,{useReactionsLastChosenIcon:()=>l});var n=a(785893),o=a(667294),i=a(490287),r=a(878198),s=a(22412);const l=()=>{const[e,t]=(0,o.useState)(),a=(0,i.useTypedSelector)((e=>e.localDevice.lastChosenReaction)),l=(0,i.useTypedSelector)((e=>{var t;return null==(t=e.reactions)?void 0:t.reactions}));return(0,o.useEffect)((()=>{const e=Date.now()-((null==a?void 0:a.ts)||0);if(!l||!a||e>s.REACTION_FADE_OUT_DELAY)return;const o=l[24][a.key],i=l[48][a.key];return t((0,n.jsx)("img",{src:o,srcSet:`${i} 1.5x`,alt:a.key})),(0,r.createTimeout)((()=>t(void 0)),s.REACTION_FADE_OUT_DELAY-e)}),[a]),e}},252123:(e,t,a)=>{"use strict";a.d(t,{useReactionsStore:()=>u});var n=a(667294),o=a(490287),i=a(455877),r=a(878198),s=a(496111),l=a(844873),c=a(915961),d=a(22412);const u=({add:e,ignorePersonal:t})=>{const{getLang:a}=(0,c.useLang)(),u=(0,o.useTypedSelector)((e=>e.externalId)),p=(0,o.useTypedSelector)((e=>{var t;return null==(t=e.reactions)?void 0:t.feedback})),_=(0,o.useTypedSelector)((e=>e.participants)),m=(0,o.useTypedSelector)(l.isFeedbackEnabled),h=(0,n.useRef)();(0,n.useEffect)((()=>{if(!m||!p||h.current===p)return;const n=[];for(const e of p)for(const o of e.items){if(Date.now()-((0,r.last)(o.times)||0)>d.REACTION_FADE_OUT_DELAY/2)continue;if((0,s.isSameExternalId)(u,o.participantId)){t||n.push({id:(0,i.v1)(),key:e.key,name:a("calls_you")});continue}const l=_[o.participantId.id],c=(null==l?void 0:l.shortName)||(null==l?void 0:l.name);c&&n.push({id:(0,i.v1)(),key:e.key,name:c})}e(n),h.current=p}),[e,p])}},751210:(e,t,a)=>{"use strict";a.d(t,{CallReactionsButton:()=>A});var n=a(434788),o=a(785893),i=a(667294),r=a(340367),s=a(136486),l=a(847829),c=a(86894),d=a(965857),u=a(972598),p=a(655739),_=a(878198),m=a(870179),h=a(845634);const g=({onHand:e,onReaction:t,onTooltipChange:a,tooltipTitle:i,tooltips:_,isHand:m,iconReaction:g,isMovieStreamEnabled:A})=>{const f=(0,h.useDelayedHide)();return(0,o.jsxs)("div",{className:"CallReactionsButton",children:[(0,o.jsx)(l.RichTooltip,{className:"CallReactionsButton__tooltip",appearance:"black",placement:A?"left":"top",offsetDistance:A?-8:3,content:(0,o.jsx)(c.Button,{className:"CallReactionsButton__button",size:"m",stretched:!0,appearance:"accent",before:(0,o.jsx)(d.Icon20Hand,{className:"CallReactionsButton__button-icon"}),onClick:e,children:i}),shown:C({isHand:m,tooltips:_}),forcePortal:!1,children:(0,o.jsx)(p.DivWithRootRef,{className:"CallReactionsButton__anchor--hand"})}),(0,o.jsx)(l.RichTooltip,{appearance:"black",placement:"top",shown:_.hand,onShownChange:e=>a("hand",e),hideDelay:f.delay,content:(0,o.jsx)(r.CallReactionsMenu,(0,n._)({},v(t),{onHand:e,handBtnTitle:i,isHand:m,onMoving:f.onMoving})),arrow:!1,forcePortal:!1,children:(0,o.jsx)(p.DivWithRootRef,{children:(0,o.jsx)(s.CallButton,{className:"Call__footerButton",type:s.CallButtonTypes.ON,icon:g||(0,o.jsx)(u.Icon24HandHeartFilled,{})})})})]})},A=(0,i.memo)(g);function C({tooltips:e,isHand:t}){const a=(0,i.useRef)(!1),[n,o]=(0,i.useState)(!1);return(0,i.useLayoutEffect)((()=>{const n=Boolean(!e.hand&&t);return!n||a.current?o(n):(0,_.createTimeout)((()=>o(n)),300)}),[e.hand,t]),(0,i.useEffect)((()=>{a.current=!0}),[]),n}function v(e){const t=(0,m.useTimeout)(),[a,n]=(0,i.useState)(!1);(0,i.useEffect)((()=>()=>t.clear()),[]);return{disabled:a,onReaction:(0,i.useCallback)((a=>{e(a),n(!0),t.add((()=>n(!1)),1e3)}),[e])}}A.displayName="CallReactionsButton"},323214:(e,t,a)=>{"use strict";a.d(t,{CallReactionsColumn:()=>c});var n=a(785893),o=a(667294),i=a(659397),r=a(732926),s=a(252123),l=a(490287);const c=({isGridView:e,isShownParticipantsAside:t,refCall:a})=>{const c=(0,l.useTypedSelector)((e=>{var t;return null==(t=e.reactions)?void 0:t.reactions})),d=(0,o.useRef)(null),u=(0,o.useCallback)((e=>{if(!d.current)return;const t=null==c?void 0:c[24][e.key],a=null==c?void 0:c[48][e.key];if(!t||!a)return;const n=function({imgUrl:e,imgUrl2x:t,reaction:a}){const n=document.createElement("div");n.classList.add("CallsReactionsColumn__reaction"),n.style.setProperty("--calls-reaction-up-speed",`${a.animationSpeed}ms`),n.onanimationend=()=>{null==a.onAnimationEnd||a.onAnimationEnd(a.id),requestAnimationFrame((()=>{n.remove()}))};const o=document.createElement("img");o.classList.add("CallsReactionsColumn__reaction__icon"),o.src=e,o.srcset=`${t} 1.5x`,o.alt=a.key;const i=document.createElement("h5");return i.classList.add("vkuiSubhead","vkuiSubhead--sizeY-compact","CallsReactionsColumn__reaction__name"),i.textContent=a.name,n.append(o,i),n}({reaction:e,imgUrl:t,imgUrl2x:a});requestAnimationFrame((()=>{var e;null==(e=d.current)||e.append(n)}))}),[]),{add:p}=(0,r.useReactionsColumn)({refCall:a,onAdd:u});return(0,s.useReactionsStore)({add:p}),(0,n.jsx)("div",{ref:d,className:(0,i.classNames)("CallsReactionsColumn",{"CallsReactionsColumn--grid":!!e,"CallsReactionsColumn--aside-hidden":!e&&!t})})}},340367:(e,t,a)=>{"use strict";a.d(t,{CallReactionsMenu:()=>d});var n=a(785893),o=a(667294),i=a(86894),r=a(965857),s=a(490287),l=a(659397),c=a(795964);const d=({onReaction:e,onHand:t,handBtnTitle:a,disabled:d,isHand:u,onMoving:p})=>{const{refScroll:_,refContainer:m,moving:h}=(0,c.useHorizontalScroll)({onMoving:p}),g=(0,s.useTypedSelector)((e=>{var t;return null==(t=e.reactions)?void 0:t.reactions})),A=(0,o.useMemo)((()=>g?Object.keys((null==g?void 0:g[28])||{}):null),[g]);return(0,n.jsx)("div",{className:(0,l.classNames)("CallReactionsMenu",{"CallReactionsMenu--moving":h}),ref:m,children:(0,n.jsxs)(i.ButtonGroup,{mode:"vertical",gap:"m",children:[!(!g||!A)&&(0,n.jsx)(i.HorizontalScroll,{className:"CallReactionsMenu__h-scroll",showArrows:!1,getRef:_,children:(0,n.jsxs)("div",{className:"CallReactionsMenu__carousel",children:[(0,n.jsx)("div",{className:"CallReactionsMenu__carousel__edge"}),A.map((t=>(0,n.jsx)(i.IconButton,{disabled:d,className:"CallReactionsMenu__button",onClick:()=>(t=>{h||e(t)})(t),children:(0,n.jsx)("img",{className:"CallReactionsMenu__button__img",alt:t,src:g[28][t],srcSet:`${g[56][t]} 1.5x`})},t))),(0,n.jsx)("div",{className:"CallReactionsMenu__carousel__edge"}),(0,n.jsx)("div",{className:(0,l.classNames)("CallReactionsMenu__carousel__scrim","CallReactionsMenu__carousel__scrim--left")}),(0,n.jsx)("div",{className:"CallReactionsMenu__carousel__scrim"})]})}),(0,n.jsx)("div",{className:"CallReactionsMenu__submit__wrap",children:(0,n.jsx)(i.Button,{className:(0,l.classNames)("CallReactionsMenu__submit",{"CallReactionsMenu__submit--hand-up":!!u}),before:(0,n.jsx)(r.Icon20Hand,{}),mode:"secondary",size:"m",stretched:!0,onClick:t,children:a})})]})})}},845634:(e,t,a)=>{"use strict";a.d(t,{useDelayedHide:()=>i});var n=a(667294),o=a(870179);const i=()=>{const e=(0,o.useTimeout)(),[t,a]=(0,n.useState)(),[i,r]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(i)return a(2e3),e.clear(),()=>{e.add((()=>a(void 0)),2e3)}}),[i]),{delay:t,onMoving:r}}},795964:(e,t,a)=>{"use strict";a.d(t,{useHorizontalScroll:()=>i});var n=a(667294),o=a(870179);const i=({onMoving:e})=>{const t=(0,n.useRef)(null),a=(0,n.useRef)(null),i=(0,o.useTimeout)(),r=(0,n.useRef)(!1),[s,l]=(0,n.useState)(r.current);return(0,n.useEffect)((()=>{var n;let o=0;function s(e){var t;o=e.clientX,window.addEventListener("mousemove",c),window.addEventListener("mouseup",d),null==(t=a.current)||t.addEventListener("mouseleave",u)}function c(a){const n=Math.floor(a.clientX-o);0!==n&&(o=a.clientX,t.current&&(t.current.scrollLeft-=n),r.current||(i.clear(),r.current=!0,l(!0),e(!0)))}function d(){u()}function u(){var t;window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d),null==(t=a.current)||t.removeEventListener("mouseleave",u),i.add((()=>{r.current=!1,l(!1),e(!1)}),16)}return null==(n=t.current)||n.addEventListener("mousedown",s),()=>{var e;null==(e=t.current)||e.removeEventListener("mousedown",s),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)}}),[]),{refScroll:t,refContainer:a,moving:s}}},33454:(e,t,a)=>{"use strict";a.d(t,{CallReactionsP2P:()=>u});var n=a(434788),o=a(785893),i=a(667294),r=a(659397),s=a(870179),l=a(982685),c=a(464380);const d=({src:e,onEnd:t})=>{const a=(0,s.useTimeout)(),[n,l]=(0,i.useState)(!1),d=(0,i.useRef)(null);return(0,i.useEffect)((()=>{var e;const n=()=>{var e;null==(e=d.current)||e.removeEventListener("animationend",n),a.add((()=>{var e;null==(e=d.current)||e.addEventListener("animationend",t),l(!0)}),900)};return null==(e=d.current)||e.addEventListener("animationend",n),()=>{var e,o;a.clear(),null==(e=d.current)||e.removeEventListener("animationend",t),null==(o=d.current)||o.removeEventListener("animationend",n)}}),[e,t]),e?(0,o.jsx)("div",{className:(0,r.classNames)("CallsReactionsP2P__reaction","CallsReactionsP2P__reaction--in",{"CallsReactionsP2P__reaction--out":n}),ref:d,children:(0,o.jsx)("div",{className:"CallsReactionsP2P__reaction__img-wrap",children:(0,o.jsx)("img",{className:(0,r.classNames)("CallsReactionsP2P__reaction__img","CallsReactionsP2P__reaction__img--in",{"CallsReactionsP2P__reaction__img--out":n,"CallsReactionsP2P__reaction__img--ff":"Firefox"===c.browser.browserName()}),src:e[0],srcSet:`${e[1]} 1.5x`,alt:"Reaction Smile"})})}):(0,o.jsx)(o.Fragment,{})},u=(0,i.memo)((()=>(0,o.jsx)(d,(0,n._)({},(0,l.useReactionP2P)()))));u.displayName="CallReactionsP2P"},982685:(e,t,a)=>{"use strict";a.d(t,{useReactionP2P:()=>s});var n=a(667294),o=a(490287),i=a(252123),r=a(22412);const s=()=>{const e=(0,o.useTypedSelector)((e=>{var t;return null==(t=e.reactions)?void 0:t.reactions})),t=function(){const[e,t]=(0,n.useState)(),[a,o]=(0,n.useState)(0),i=(0,n.useRef)([]),r=(0,n.useCallback)((e=>{t(e),o(Date.now())}),[]),s=(0,n.useCallback)((()=>{const e=i.current.shift();r(e)}),[]),l=(0,n.useCallback)(((t,a)=>{i.current.push([t,a]),e||s()}),[e]);return{src:e,key:a,add:l,onEnd:s}}(),a=(0,n.useCallback)((a=>{if(!e)return;const n=a=>{const n=e[96][a],o=e[192][a];t.add(n,o)};if(Array.isArray(a))for(const e of a)n(e.key);else n(a.key)}),[t.add,e]);return(0,i.useReactionsStore)({add:a,ignorePersonal:!0}),function(e){const t=(0,o.useTypedSelector)((e=>{var t;return null==(t=e.reactions)?void 0:t.reactions})),a=(0,o.useTypedSelector)((e=>e.localDevice.lastChosenReaction));(0,n.useEffect)((()=>{const n=Date.now()-((null==a?void 0:a.ts)||0);if(!t||!a||n>r.REACTION_FADE_OUT_DELAY/2)return;const o=t[96][a.key],i=t[192][a.key];e(o,i)}),[t,a])}(t.add),t}},291773:(e,t,a)=>{"use strict";a.d(t,{CallScreenShareButton:()=>A});var n=a(434788),o=a(820224),i=a(785893),r=a(937026),s=a(448408),l=a(661554),c=a(896776),d=a(611926),u=a(687054),p=a(869048),_=a(384627),m=a(881310),h=a(86894),g=a(915961);const A=e=>{var{isDropdownOpen:t,toggleDropdown:a,isScreenSharingEnabled:r,onStopScreenShare:c,onStartScreenShare:d,onStartFastScreenShare:u,isFastScreenSharingAvailable:A}=e,v=(0,o._)(e,["isDropdownOpen","toggleDropdown","isScreenSharingEnabled","onStopScreenShare","onStartScreenShare","onStartFastScreenShare","isFastScreenSharingAvailable"]);const{getLang:f}=(0,g.useLang)();return r||!A?(0,i.jsx)(C,(0,n._)({},v,{isScreenSharingEnabled:r,isDropdownOpen:t,onClick:r?c:d})):(0,i.jsx)(p.AppRootProvider,{children:(0,i.jsx)(h.AppearanceProvider,{appearance:"dark",children:(0,i.jsx)(_.DropdownActionSheet,{content:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m.DropdownActionSheetItem,{subtitle:f("calls_screen_share_fast_action_subtitle"),onClick:u,before:(0,i.jsx)(s.Icon24Video,{className:"CallScreenShareButton__dropdownItemIcon"}),multiline:!0,children:f("calls_screen_share_fast_action_title")}),(0,i.jsx)(m.DropdownActionSheetItem,{subtitle:f("calls_screen_share_action_subtitle"),onClick:d,before:(0,i.jsx)(l.Icon24Picture,{className:"CallScreenShareButton__dropdownItemIcon"}),multiline:!0,children:f("calls_screen_share_action_title")})]}),shown:t,onShownChange:a,placement:"top-start",action:"click",width:370,children:(0,i.jsx)(C,(0,n._)({},v,{isScreenSharingEnabled:r,isDropdownOpen:t}))})})})};function C(e){var{tooltips:t,onTooltipChange:a,getRootRef:s,isDropdownOpen:l,isScreenSharingEnabled:p,onClick:_}=e,m=(0,o._)(e,["tooltips","onTooltipChange","getRootRef","isDropdownOpen","isScreenSharingEnabled","onClick"]);const{getLang:A}=(0,g.useLang)(),C=A(p?"calls_stop_screen_share":"calls_start_screen_share");return(0,i.jsx)(r.TooltipNew,{content:C,open:t.screenShare,delay:300,onOpen:()=>a("screenShare",!0),onClose:()=>a("screenShare",!1),forceClose:l,children:(0,i.jsx)("div",{className:"CallScreenShareButton__outer",children:(0,i.jsxs)("div",(0,n._)({},m,{ref:s,className:"CallScreenShareButton__inner",children:[l&&(0,i.jsx)(h.AppearanceProvider,{appearance:"dark",children:(0,i.jsx)("div",{className:"CallScreenShareButton__dropdownOpenIcon",children:(0,i.jsx)(c.Icon12ChevronUp,{})})}),(0,i.jsx)(u.CallIconButton,{"aria-expanded":l,"aria-label":C,icon:(0,i.jsx)(d.Icon24ArrowUpRectangle,{}),onClick:_,isActive:p})]}))})})}},877967:(e,t,a)=>{"use strict";a.d(t,{CallSettings:()=>A});var n=a(11010),o=a(434788),i=a(785893),r=a(667294),s=a(627240),l=a(86424),c=a(346880),d=a(723170),u=a(752654),p=a(22412),_=a(266247),m=a(659397),h=a(464380),g=a(751682);function A({cameras:e,mics:t,noiseCancellationOptions:a,videoResolutionOptions:A,currentCamId:v,currentMicId:f,currentNoiseCancellation:S,currentVideoResolution:E,isCamAvailable:T=!1,isMicAvailable:I=!1,onCameraChange:y,onMicChange:N,onNoiseCancellationChange:b,onVideoResolutionChange:x}){const{getLang:M}=(0,r.useContext)(c.LangContext),O=(0,r.useRef)(null);!function({currentVideoResolution:e,mediaElRef:t,streamRef:a,deviceId:o,isActive:i}){const s=(0,r.useRef)();let l;e&&(l={width:p.VideoWidth[e]||p.VideoWidth.SD,height:p.VideoHeight[e]||p.VideoHeight.SD});(0,r.useEffect)((()=>{i&&function(){var e=(0,n._)((function*(){try{if(o!==s.current){var e;const n=yield h.browser.getUserVideo(o,l);null==(e=a.current)||e.getTracks().forEach((e=>e.stop()));const i=t.current;i&&(a.current=n,i.srcObject=n,i.muted=!0,i.play().catch((e=>{(0,h.debugMessage)(h.DebugMessageType.ERROR,{error:e,stream:n})})))}else a.current&&l&&(yield h.browser.setResolution(a.current,l));s.current=o}catch(e){(0,h.debugMessage)(h.DebugMessageType.ERROR,{err:e,deviceId:o,resolution:l})}}));function i(){return e.apply(this,arguments)}return i}()()}),[o,i,e]),(0,r.useEffect)((()=>()=>{const e=a.current;e&&e.getTracks().forEach((e=>e.stop()));const n=t.current;n&&(n.srcObject=null)}),[])}({currentVideoResolution:E,mediaElRef:O,streamRef:(0,r.useRef)(null),deviceId:v,isActive:T});const{storedVideoOptions:P}=(0,_.useVideoOptions)();return(0,i.jsxs)("div",{className:"CallSettings",children:[(0,i.jsx)("div",{className:"CallSettings__camera",children:T?(0,i.jsx)("video",(0,o._)({ref:O},{controls:!1,crossOrigin:"anonymous",playsInline:!0},{className:(0,m.classNames)({CallSettings__cameraStream:P[_.EVideoOptionType.IS_VIDEO_MIRRORED]},"CallSettings__cameraContent")})):(0,i.jsxs)("div",{className:(0,m.classNames)("CallSettings__cameraStub","CallSettings__cameraContent"),children:[(0,i.jsx)(g.Icon56VideocamSlashOutline,{className:"CallSettings__cameraStubIcon"}),M("calls_no_camera")]})}),(0,i.jsxs)("div",{className:"CallSettings__block",children:[(0,i.jsx)("div",{className:"CallSettings__label",children:M("calls_settings_camera")}),T?(0,i.jsx)(s.default,{options:e.map(C),value:v,onChange:({selected:e})=>y(e.value),appearance:"secondary",className:"CallSettings__field"}):(0,i.jsx)(l.default,{className:"CallSettings__field",children:M("calls_settings_no_camera")})]}),T&&(0,i.jsxs)("div",{className:"CallSettings__block",children:[(0,i.jsx)("div",{className:"CallSettings__label",children:M("calls_settings_video_resolution")}),(0,i.jsx)(s.default,{options:A,value:E,onChange:({selected:e})=>x(e.value),appearance:"secondary",className:"CallSettings__field"})]}),(0,i.jsxs)("div",{className:"CallSettings__block",children:[(0,i.jsx)("div",{className:"CallSettings__label",children:M("calls_settings_mic")}),I?(0,i.jsx)(s.default,{options:t.map(C),value:f,onChange:({selected:e})=>N(e.value),appearance:"secondary",className:"CallSettings__field"}):(0,i.jsx)(l.default,{className:"CallSettings__field",children:M("calls_settings_no_mic")})]}),(0,i.jsxs)("div",{className:"CallSettings__block",children:[(0,i.jsx)("div",{className:"CallSettings__label",children:(0,i.jsx)("span",{dangerouslySetInnerHTML:{__html:M("calls_settings_noise")}})}),I?(0,i.jsx)(s.default,{options:a,value:S,onChange:({selected:e})=>b(e.value),appearance:"secondary",className:"CallSettings__field"}):(0,i.jsx)(l.default,{className:"CallSettings__field",children:M("calls_settings_no_mic")}),(0,i.jsx)(u.default,{className:"CallSettings__tooltip",text:M("calls_settings_noise_description"),position:"t",appearance:"light",maxWidth:320,children:(0,i.jsx)(d.default,{className:"CallSettings__hint","aria-label":M("calls_settings_noise_description")})})]})]})}function C(e){return{value:e.deviceId,label:e.label}}},273142:(e,t,a)=>{"use strict";a.d(t,{CallSettingsButton:()=>c});var n=a(434788),o=a(820224),i=a(785893),r=a(937026),s=a(445310),l=a(687054);const c=e=>{var{tooltips:t,onTooltipChange:a,getRootRef:c,isDropdownOpen:d,tooltipTitle:u}=e,p=(0,o._)(e,["tooltips","onTooltipChange","getRootRef","isDropdownOpen","tooltipTitle"]);return(0,i.jsx)(r.TooltipNew,{content:u,open:t.settings,delay:300,onOpen:()=>a("settings",!0),onClose:()=>a("settings",!1),forceClose:d,children:(0,i.jsx)("div",{className:"CallSettingsButton__outer",children:(0,i.jsx)("div",(0,n._)({},p,{ref:c,className:"CallSettingsButton__inner",children:(0,i.jsx)(l.CallIconButton,{"aria-expanded":d,"aria-label":u,icon:(0,i.jsx)(s.Icon24Settings,{})})}))})})}},227345:(e,t,a)=>{"use strict";a.d(t,{CallSettingsModal:()=>l});var n=a(785893),o=a(667294),i=a(513885),r=a(589897),s=a(346880);function l({onClose:e,onSubmit:t,children:a}){const{getLang:l}=(0,o.useContext)(s.LangContext);return(0,n.jsx)(i.default,{onClose:e,title:l("calls_settings"),appearance:"blue",actionButtons:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.default,{onClick:e,mode:"tertiary",children:l("calls_cancel")}),(0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:t,children:l("calls_save")})]}),className:"CallSettingsModal",children:a})}},78279:(e,t,a)=>{"use strict";a.d(t,{CallTimer:()=>o});var n=a(785893);const o=({duration:e})=>(0,n.jsx)("div",{className:"CallTimer",role:"timer","aria-label":e,"data-duration":e})},11298:(e,t,a)=>{"use strict";a.d(t,{CallVideoWidget:()=>r});var n=a(434788),o=a(785893),i=a(210475);const r=e=>(0,o.jsx)(i.CallBaseWidget,(0,n._)({},e))},593750:(e,t,a)=>{"use strict";a.d(t,{CallWidget:()=>r});var n=a(785893),o=a(230823),i=a(417174);const r=({id:e,photo:t,title:a,status:r,isIncoming:s,onClick:l,children:c})=>(0,n.jsxs)("div",{className:"CallWidget",onClick:l,children:[(0,n.jsx)(o.BlurredBackground,{id:e,className:"CallWidget__background"}),(0,n.jsx)(i.CallPhoto,{id:e,photo:t,waves:s,alt:a||"",className:"CallWidget__photo"}),(0,n.jsx)("h1",{className:"CallWidget__name",children:a}),(0,n.jsx)("div",{className:"CallWidget__status",children:r}),c]})},879849:(e,t,a)=>{"use strict";a.d(t,{default:()=>i});var n=a(785893),o=a(659397);function i({isInverted:e}){const t=(0,o.classNames)("CallingStatus",{"CallingStatus--inverted":!!e}),a=(0,o.classNames)("CallingStatus__part","CallingStatus__part--withAnimation");return(0,n.jsxs)("div",{className:t,children:[(0,n.jsx)("span",{className:a}),(0,n.jsx)("span",{className:a}),(0,n.jsx)("span",{className:a})]})}},836326:(e,t,a)=>{"use strict";a.d(t,{CallsDropdown:()=>u});var n=a(434788),o=a(785893),i=a(667294),r=a(804495),s=a(86894),l=a(105086),c=a(659397);const d=({items:e,className:t,setOpen:a})=>(0,o.jsx)("ul",{className:(0,c.classNames)("CallsDropdown",t),children:e.map(((e,t,n)=>(0,o.jsx)("li",{className:"CallsDropdown__item",children:"separator"in e?(0,o.jsx)(l.Separator,{isListEdge:!t||n.length-1===t}):(0,o.jsx)(l.DropdownItem,{item:e,setOpen:a})},e.key||t)))}),u=({children:e,items:t,open:a=!1,setOpen:l,placement:c,className:u,content:p,appearance:_="light",customModifiers:m})=>(0,o.jsx)(s.AppearanceProvider,{appearance:_,children:(0,o.jsx)(r.Dropdown,{placement:c,onShownChange:l,content:p||t&&(0,o.jsx)(d,{items:t,className:u,setOpen:l}),shown:a,customModifiers:m,forcePortal:!1,children:(0,i.cloneElement)(e,(0,n._)({},e.props,{"data-active":a}))})})},105086:(e,t,a)=>{"use strict";a.d(t,{DropdownItem:()=>l,Separator:()=>c});var n=a(785893),o=a(659397),i=a(86894),r=a(878198),s=a(915961);const l=({item:e,setOpen:t})=>{const{getLang:a}=(0,s.useLang)(),{disabled:l=!1}=e,c=(0,o.classNames)("CallsDropdown__button",{"CallsDropdown__button--disabled":l});if("href"in e)return(0,n.jsx)("a",{href:e.href,rel:"noopener noreferrer",target:"_blank",onClick:l?void 0:a=>{a.stopPropagation(),"onClick"in e&&void 0!==e.onClick&&e.onClick(a),null==t||t(!1)},className:c,children:e.text});if("onClick"in e){const s=(0,o.classNames)("CallsDropdown__row-title",e.titleClassName);return(0,n.jsxs)("button",{"aria-checked":(0,r.vou)((0,r.isBoolean)(e.isEnabled),!!e.isEnabled),role:(0,r.vou)((0,r.isBoolean)(e.isEnabled),"checkbox"),onClick:l?void 0:a=>{a.stopPropagation(),e.onClick(a),(0,r.isBoolean)(e.isEnabled)||null==t||t(!1)},className:c,children:[(0,n.jsx)("div",{className:s,children:e.text}),!(0,o.isUndefined)(e.isEnabled)&&!e.isAlternativeSwitch&&(0,n.jsx)(i.Switch,{className:"CallsDropdown__switch",tabIndex:-1,checked:e.isEnabled,onClick:e=>e.stopPropagation(),readOnly:!0}),!(0,o.isUndefined)(e.isEnabled)&&e.isAlternativeSwitch&&(0,n.jsx)("div",{className:"CallsDropdown__switch--alternative",children:e.isEnabled?a("calls_toggle_on"):a("calls_toggle_off")})]})}return null},c=({isListEdge:e})=>(0,n.jsx)("div",{className:(0,o.classNames)({CallsDropdown__separator:!e})})},456332:(e,t,a)=>{"use strict";a.d(t,{CallsMultiSelect:()=>s});var n=a(785893),o=a(667294),i=a(227377),r=a(346880);const s=({tokens:e,onRemoveToken:t,value:a,onChange:s,onSelect:l,renderSuggest:c,data:d,hideInputWithName:u})=>{const p=(0,o.useRef)((()=>{})),{getLang:_}=(0,o.useContext)(r.LangContext);return(0,n.jsx)(i.default,{className:"CallsMultiSelect",tokens:e,removeTokenPlaceholder:_("calls_remove_token"),onRemoveToken:t,placeholder:_("calls_search_participants_placeholder"),value:a,onChange:s,onSelect:l,useInfiniteScroll:!1,hasMore:!1,virtualized:!1,loadMore:p.current,notFoundText:_("calls_participants_not_found"),autoFocus:!0,isSearching:!1,renderSuggest:c,data:d,hideInputWithName:u})}},802997:(e,t,a)=>{"use strict";a.d(t,{CallsOnboardingBanner:()=>d});var n=a(785893),o=a(513698),i=a(86894),r=a(915961),s=a(592659),l=a(462713),c=a(869048);const d=({featureType:e,onFeatureStart:t,onClose:a})=>{const{getLang:d}=(0,r.useLang)(),{title:u,subTitle:p}=(0,s.useOnboardingTranslations)(e);return(0,n.jsx)(c.AppRootProvider,{children:(0,n.jsxs)("div",{className:"CallsOnboardingBanner",children:[(0,n.jsx)(l.OnboardingIcon,{featureType:e}),(0,n.jsxs)("div",{className:"CallsOnboardingBanner--content",children:[(0,n.jsx)("div",{className:"CallsOnboardingBanner--title",children:u}),(0,n.jsx)("div",{className:"CallsOnboardingBanner--sub-title",children:p}),t&&(0,n.jsx)(i.Button,{className:"CallsOnboardingBanner--button",onClick:t,children:d("calls_try_onboarding_button")})]}),(0,n.jsx)("div",{className:"CallsOnboardingBanner--cancelContainer",onClick:a,children:(0,n.jsx)("div",{className:"CallsOnboardingBanner--cancel",children:(0,n.jsx)(o.Icon12Cancel,{})})})]})})}},462713:(e,t,a)=>{"use strict";a.d(t,{OnboardingIcon:()=>c});var n=a(785893),o=a(659397),i=a(22412),r=a(812095),s=a(292387),l=a(533049);const c=({featureType:e,className:t})=>{const a=(0,o.classNames)("CallsOnboardingBanner--FeatureIcon",t);switch(e){case i.E_ONBOARDING_FEATURES.watchTogether:return(0,n.jsx)(s.Icon28LogoVkVideoOutline,{className:a});case i.E_ONBOARDING_FEATURES.reactions:return(0,n.jsx)(l.Icon28HandHeartOutline,{className:a});case i.E_ONBOARDING_FEATURES.vmoji:return(0,n.jsx)(r.default,{className:a});default:return(0,n.jsx)(n.Fragment,{})}}},592659:(e,t,a)=>{"use strict";a.d(t,{useOnboardingTranslations:()=>i});var n=a(915961),o=a(22412);const i=e=>{const{getLang:t}=(0,n.useLang)();switch(e){case o.E_ONBOARDING_FEATURES.watchTogether:return{title:t("calls_watch_together_onboarding_title"),subTitle:t("calls_watch_together_onboarding_sub_title")};case o.E_ONBOARDING_FEATURES.reactions:return{title:t("calls_reactions_onboarding_title"),subTitle:t("calls_reactions_onboarding_sub_title")};case o.E_ONBOARDING_FEATURES.vmoji:return{title:t("calls_vmoji_onboarding_title"),subTitle:t("calls_vmoji_onboarding_sub_title")}}}},167905:(e,t,a)=>{"use strict";a.d(t,{CallsPageWrapper:()=>i});var n=a(785893),o=a(86894);const i=({children:e})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.Spacing,{size:15}),e]})},347845:(e,t,a)=>{"use strict";a.d(t,{CallsRichCell:()=>i});var n=a(785893),o=a(86894);const i=({caption:e,before:t,href:a,title:i,onClick:r})=>(0,n.jsx)(o.RichCell,{className:"CallsRichCell__Content",before:t,caption:e,href:a,onClick:r,target:"_blank",children:(0,n.jsx)("span",{className:"CallsRichCell__Title",children:i})})},248450:(e,t,a)=>{"use strict";a.d(t,{CallsSearchResult:()=>_});var n=a(785893),o=a(667294),i=a(224050),r=a(512334),s=a(611802),l=a(22412),c=a(245387),d=a(589897),u=a(64195);const p=({data:e,onClick:t,selected:a,disabled:o})=>{if("type"in e)switch(e.type){case l.SearchResultType.HEADER:return(0,n.jsx)(i.ListHeader,{className:"CallsSearchResult CallsSearchResult--header",extra:e.count,children:e.text});case l.SearchResultType.CALL_ALL_IN_CHAT:return(0,n.jsx)("div",{className:"CallsSearchResult CallsSearchResult--select",children:(0,n.jsxs)(d.default,{size:"m",mode:"secondary",stretched:!0,onClick:t,children:[(0,n.jsx)("span",{className:"CallsSearchResult__icon",children:(0,n.jsx)(u.Icon16Phone,{})}),e.text]})});case l.SearchResultType.MEMBERS_MORE:case l.SearchResultType.FRIENDS_MORE:case l.SearchResultType.GROUP_MEMBERS_MORE:return(0,n.jsx)(c.ListMore,{onClick:t,children:e.text})}return(0,n.jsx)(r.default,{className:"CallsSearchResult--list-item","data-id":e.peerId,onClick:t,selectable:!o,children:(0,n.jsx)(s.ParticipantSuggest,{member:e,selected:a,disabled:o})})},_=(0,o.memo)(p)},56976:(e,t,a)=>{"use strict";a.d(t,{ChangeParticipantName:()=>d});var n=a(785893),o=a(86894),i=a(858016),r=a(667294),s=a(915961),l=a(146679),c=a(788822);const d=(0,r.forwardRef)(((e,t)=>{const{langReplace:a,getLang:r}=(0,s.useLang)();let d="";return e.isAnonymous||(d=a(r("calls_real_name_always_visible_in_chat"),{name:(0,l.decode)(e.participantRealName)})),e.error&&(d=r("calls_use_letters_digits_space_and_hyphen")),(0,n.jsx)(o.FormItem,{top:e.top,bottom:d,status:e.error?"error":"default",className:"ChangeParticipantName",children:(0,n.jsx)(o.Input,{maxLength:25,placeholder:(0,c.decodeHTMLEntities)(e.placeholder||""),onChange:e.onNameChange,value:(0,c.decodeHTMLEntities)(e.changedName),disabled:e.disabled,getRef:t,size:32,after:(0,n.jsx)(o.IconButton,{hoverMode:"opacity","aria-label":r("calls_clear_field"),onClick:e.onClearName,children:(0,n.jsx)(i.Icon16Clear,{})})})})}));d.displayName="ChangeParticipantName"},305090:(e,t,a)=>{"use strict";a.d(t,{ChangeParticipantNameModal:()=>g});var n=a(785893),o=a(56976),i=a(22412),r=a(193527),s=a(869048),l=a(400856),c=a(685371),d=a(126116),u=a(119783),p=a(86894),_=a(915961),m=a(146679),h=a(496111);const g=({participant:e,onClose:t,renamedUserType:a,onSaveClick:g,changedName:A,setChangedName:C,error:v,isFetching:f})=>{const{getLang:S,langReplace:E}=(0,_.useLang)(),T=a===i.RenamedUserType.SELF?S("calls_change_name"):S("calls_rename_participant"),I=a===i.RenamedUserType.SELF?S("calls_your_new_name"):E(S("calls_new_name_for_particiopant"),{name:(0,m.decode)(null==e?void 0:e.name)}),y=[(0,n.jsx)(p.Button,{onClick:t,size:"m","data-focus-first":!0,mode:"tertiary",children:S("calls_cancel")},"changeNameCancel"),(0,n.jsx)(p.Button,{onClick:g,size:"m",disabled:v||f,children:S("calls_rename")},"changeNameSave")];return(0,n.jsx)(r.BaseModal,{className:"ChangeParticipantNameModal",onClose:t,disableBackdropClick:!0,children:(0,n.jsx)(u.FocusTrap,{hasFirstFocusableElement:!0,children:(0,n.jsx)(s.AppRootProvider,{children:(0,n.jsxs)("div",{className:"ChangeParticipantNameModal__content",children:[(0,n.jsx)(l.ModalHeader,{onClose:t,closeAriaLabel:S("calls_close"),children:T}),(0,n.jsx)(c.ModalBody,{insetLevel:2,children:(0,n.jsx)(o.ChangeParticipantName,{onClearName:()=>C(""),changedName:A,onNameChange:e=>{C(e.target.value)},placeholder:null==e?void 0:e.name,error:v,top:I,participantRealName:null==e?void 0:e.name,isAnonymous:(0,h.isParticipantAnonym)((null==e?void 0:e.peerId)||0)})}),(0,n.jsx)(d.ModalFooter,{actionButtons:y})]})})})})}},318761:(e,t,a)=>{"use strict";a.d(t,{ChatIconButton:()=>l});var n=a(434788),o=a(820224),i=a(785893),r=a(667294),s=a(659397);const l=(0,r.forwardRef)((function(e,t){var{unreadCount:a=0}=e,r=(0,o._)(e,["unreadCount"]);let l="",c="";switch(!0){case!a:l="none";break;case a<=9:l="single",c=a.toString();break;case a<=99:l="double",c=a.toString();break;case a>99:l="max",c="99+"}const d=(0,s.classNames)("ChatIconButton",`ChatIconButton--${l}`,"ChatIconButton--withAnimation");return(0,i.jsx)("button",(0,n._)({className:d},r,{ref:t,children:c&&(0,i.jsx)("div",{className:"ChatIconButton__count ",children:c})}))}))},238696:(e,t,a)=>{"use strict";a.d(t,{COLLAPSED_CALL_MAIN_CLASS:()=>c,CollapsedCall:()=>d,CollapsedCallDraggable:()=>u});var n=a(785893),o=a(667294),i=a(659397),r=a(536529),s=a(106639),l=a(433110);const c="CollapsedCall",d=(0,o.forwardRef)((({children:e,isCollapsedPip:t},a)=>{const o=(0,i.classNames)(c,{"CollapsedCall--withAnimation":!t,"CollapsedCall--pip":!!t});return(0,n.jsx)("div",{ref:a,className:o,children:e})}));d.displayName=c;const u=({children:e,className:t})=>{const a=(0,s.useIsScroll)("body"),d=(0,o.useMemo)((()=>({bottom:a.h?30:15,left:15,right:a.v?30:15,top:15})),[a]),u=(0,o.useMemo)((()=>l.collapsedCallPositionStorage.getPosition()||[15,-15]),[]),p=(0,o.useMemo)((()=>[".CallVideoWidget__buttons"]),[]),_=(0,o.useCallback)((e=>{l.collapsedCallPositionStorage.setPosition(e)}),[]),m=(0,i.classNames)(c,"CollapsedCall--draggable","CollapsedCall--withAnimation",t);return(0,n.jsx)(r.Touch,{className:m,padding:d,startCoords:u,onUpdateStartCoords:_,ignoredSelectors:p,children:e})}},596525:(e,t,a)=>{"use strict";a.d(t,{CreateCallByLinkModal:()=>m});var n=a(434788),o=a(785893),i=a(937107),r=a(869048),s=a(816511),l=a(400856),c=a(126116),d=a(558791),u=a(86894),p=a(119783),_=a(525906);const m=({onClose:e,onStartCall:t,ownerOptions:a,selectedOwnerId:m,onGroupSelectChange:h,microphoneOptions:g,cameraOptions:A,onMicrophoneSelectChange:C,onCameraSelectChange:v,selectedMicrophoneOption:f,selectedCameraOption:S,isWatchTogetherEnabled:E=!1,waitingHall:T,allowAnon:I,allowWatchTogether:y,allowReactions:N})=>{const{getLang:b}=(0,d.useLangContext)(),x=`CreateCallByLinkModal_${Date.now()}`,M=[(0,o.jsx)(u.Button,{onClick:e,mode:"tertiary",children:b("calls_cancel")},"cancel"),(0,o.jsx)(u.Button,{onClick:t,children:b("calls_create_call_by_link")},"call")];return(0,o.jsx)(i.default,{className:"CreateCallByLinkModal",onClose:e,disableBodyScroll:!0,children:(0,o.jsx)(p.FocusTrap,{hasFirstFocusableElement:!0,children:(0,o.jsx)(r.AppRootProvider,{disablePortal:!0,children:(0,o.jsxs)(s.ModalBox,{"aria-label":b("calls_create_call_by_link_title"),"aria-describedby":x,children:[(0,o.jsx)(l.ModalHeader,{onClose:e,closeAriaLabel:b("calls_close"),children:b("calls_create_call_by_link_title")}),(0,o.jsxs)("div",{className:"CreateCallByLinkModal__content",children:[(0,o.jsx)("div",{id:x,className:"CreateCallByLinkModal__description",children:b("calls_create_call_by_link_description")}),(0,o.jsxs)("div",{className:"CreateCallByLinkModal__SettingsList",children:[(0,o.jsx)(u.SimpleCell,{hasHover:!1,hasActive:!1,role:void 0,tabIndex:void 0,after:(0,o.jsx)(_.SelectLikeDropdown,{selectedId:m,options:a,onChange:h,"data-focus-first":a.length>1,ariaLabel:b("calls_create_call_by_link_by_name")}),children:b("calls_create_call_by_link_by_name")}),(0,o.jsx)(u.Separator,{}),(0,o.jsx)(u.SimpleCell,{hasHover:!1,hasActive:!1,Component:"label",subtitle:b("calls_menu_waiting_hall_description"),after:(0,o.jsx)(u.Switch,(0,n._)({"data-focus-first":a.length<=1},T)),children:b("calls_menu_waiting_hall_title")}),(0,o.jsx)(u.Separator,{}),(0,o.jsx)(u.SimpleCell,{Component:"label",hasHover:!1,hasActive:!1,subtitle:b("calls_create_call_by_link_anon_hint_shedule"),after:(0,o.jsx)(u.Switch,(0,n._)({},I)),children:b("calls_create_call_by_link_anon")}),(0,o.jsx)(u.Separator,{}),(0,o.jsx)(u.SimpleCell,{hasHover:!1,hasActive:!1,role:void 0,tabIndex:void 0,after:(0,o.jsx)(_.SelectLikeDropdown,{selectedId:f,options:g,onChange:C,ariaLabel:b("calls_create_call_by_link_microphones")}),children:b("calls_create_call_by_link_microphones")}),(0,o.jsx)(u.Separator,{}),(0,o.jsx)(u.SimpleCell,{hasHover:!1,hasActive:!1,role:void 0,tabIndex:void 0,after:(0,o.jsx)(_.SelectLikeDropdown,{selectedId:S,options:A,onChange:v,ariaLabel:b("calls_create_call_by_link_cameras")}),children:b("calls_create_call_by_link_cameras")}),(0,o.jsx)(u.Separator,{}),(0,o.jsx)(u.SimpleCell,{hasHover:!1,hasActive:!1,Component:"label",subtitle:b("calls_reactions_description"),after:(0,o.jsx)(u.Switch,(0,n._)({},N)),children:b("calls_reactions")}),E&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.Separator,{}),(0,o.jsx)(u.SimpleCell,{hasHover:!1,hasActive:!1,Component:"label",subtitle:b("calls_create_call_by_link_hint_watch_together"),after:(0,o.jsx)(u.Switch,(0,n._)({},y)),children:b("calls_create_call_by_link_watch_together")})]})]})]}),(0,o.jsx)(c.ModalFooter,{actionButtons:M})]})})})})}},843454:(e,t,a)=>{"use strict";a.d(t,{CurrentCallsList:()=>r});var n=a(785893),o=a(502592),i=a(336076);const r=({currentCalls:e,onJoin:t,listItemBorder:a=!0})=>e.length?(0,n.jsx)(o.default,{border:!1,children:e.map(((e,o)=>(0,n.jsx)(i.CurrentCallsListItem,{listItemBorder:a,call:e,onJoin:t},o)))}):(0,n.jsx)(n.Fragment,{})},336076:(e,t,a)=>{"use strict";a.d(t,{CurrentCallsListItem:()=>C});var n=a(785893),o=a(667294),i=a(22412),r=a(455319),s=a(512334),l=a(952772),c=a(563247),d=a(26660),u=a(694379),p=a(558791),_=a(496111),m=a(86894),h=a(167810),g=a(514995),A=a(347845);const C=({call:e,onJoin:t,listItemBorder:a=!0})=>{const C=(0,d.useHistoryScreenSelector)((e=>e.profiles)),{getLang:v,langNumeric:f}=(0,p.useLangContext)(),{navigateToConvo:S}=(0,h.useNavigationContext)(),{member:E,chat:T}=(0,c.getCurrentCallOwner)(e,C),{isVkme:I}=(0,u.useVkmeContext)(),{id:y,title:N,photo:b,href:x,description:M,avatarItems:O,join_link:P}=(0,o.useMemo)((()=>{let{id:t=0,title:a="",photo:n="",href:o=""}=T?function({title:e="",photo_100:t="",id:a=0}){const n=a?"/im?sel=c"+a:"";return{title:e,photo:t,href:n,id:a}}(T):E?function({name:e="",photo:t="",link:a="",id:n=0}){const o=a||"/im?sel=c"+n;return{title:e,photo:t,href:o,id:n}}(E):{};const{users_count:i,user_ids:s,join_link:l="",caller_id:c,name:d}=e;c&&(0,_.isParticipantGroup)(c)&&(a=d||a);const u=f(i,"calls_history_members_count",v("calls_history_members_count",i)).replace("%n",String(i)),p=s.slice(0,3),m=[];for(let e of p)e in C&&m.push((0,r.getMemberForUserStack)(C[e]));return{id:t,title:a,photo:n||"/images/camera_c.gif",href:o,description:u,join_link:l,avatarItems:m}}),[T,e,E,C]);if(!E&&!T)return(0,n.jsx)(n.Fragment,{});const R=!!(null==E?void 0:E.is_nft);return(0,n.jsx)(s.default,{border:a,className:"CurrentCallsListItem",selectable:!1,canBeHovered:!1,aside:(0,n.jsxs)(n.Fragment,{children:[O.length>0&&(0,n.jsx)("div",{className:"CurrentCallsListItem--avatarStack",children:(0,n.jsx)(l.AvatarsStackNoSvg,{size:l.AvatarsStackNoSvgSizes.SIZE_24,items:O})}),(0,n.jsx)(m.Button,{size:"s",onClick:()=>t(P,y,i.CallStatSource.HISTORY),children:v("calls_history_join_call_button")})]}),children:(0,n.jsx)(A.CallsRichCell,{caption:M,href:x,title:N,onClick:e=>{I&&(e.preventDefault(),e.stopPropagation(),S(y))},before:(0,n.jsx)("div",{className:"CurrentCallsListItem--avatarRich",children:(0,n.jsx)(g.AvatarRich,{isNFT:R,src:b,imgAlt:N,size:R?32:34})})})},y)}},840867:(e,t,a)=>{"use strict";a.d(t,{DeleteCallModal:()=>r});var n=a(785893),o=a(513885),i=a(558791);const r=({onClose:e,actionButtons:t,text:a})=>{const{getLang:r}=(0,i.useLangContext)();return(0,n.jsx)(o.default,{className:"DeleteCallModal",title:r("calls_history_delete_modal_title"),actionButtons:t,onClose:e,appearance:"blue",children:(0,n.jsx)("div",{className:"DeleteCallModal__content",children:a})})}},850986:(e,t,a)=>{"use strict";a.d(t,{DialogConfirm:()=>r});var n=a(785893),o=a(513885),i=a(86894);const r=({title:e,description:t,submitAppearance:a,cancelTitle:r,submitTitle:s,onClose:l,onSubmit:c})=>(0,n.jsx)(o.default,{className:"CallsDialogConfirm",title:e,onClose:l,actionButtons:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.Button,{onClick:l,mode:"tertiary",children:r}),(0,n.jsx)(i.Button,{onClick:c,appearance:a,children:s})]}),children:t})},331447:(e,t,a)=>{"use strict";a.d(t,{DialogSimpleInput:()=>s});var n=a(785893),o=a(667294),i=a(513885),r=a(86894);const s=({title:e,placeholder:t,cancelTitle:a,submitTitle:s,onClose:l,onSubmit:c,onChange:d,disableSubmit:u=!1,inputStatus:p,value:_,maxLength:m,minLength:h})=>{const[g,A]=(0,o.useState)(""),C=_||g;return(0,n.jsx)(i.default,{className:"CallsDialogSimpleInput",title:e,onClose:l,actionButtons:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.Button,{onClick:l,mode:"tertiary",children:a}),(0,n.jsx)(r.Button,{onClick:()=>{c(C)},disabled:u,children:s})]}),children:(0,n.jsx)(r.Input,{autoFocus:!0,value:C,placeholder:t,onChange:e=>{A(e.target.value),null==d||d(e.target.value)},status:p,maxLength:m,minLength:h})})}},655739:(e,t,a)=>{"use strict";a.d(t,{DivWithRootRef:()=>o});var n=a(785893);const o=({children:e,getRootRef:t,className:a})=>(0,n.jsx)("div",{ref:t,className:a,children:e})},590028:(e,t,a)=>{"use strict";a.d(t,{ErrorPopupText:()=>o});var n=a(785893);const o=({children:e})=>(0,n.jsx)("div",{className:"ErrorPopupText",children:e})},419720:(e,t,a)=>{"use strict";a.d(t,{FeatureEndedNotification:()=>c});var n=a(785893),o=a(667294),i=a(982555),r=a(60559),s=a(86894),l=a(870179);const c=({open:e,onClose:t,onExit:a,isShownOpenLink:c,title:d,linkTitle:u})=>{const p=(0,l.useTimeout)(),_=(0,o.useRef)(null),m=(0,o.useRef)(null);return(0,o.useEffect)((()=>{e&&p.add((()=>t(!0)),1e4)}),[e]),(0,o.useEffect)((()=>{var t;if(!e)return null==(t=_.current)||t.addEventListener("transitionend",n),m.current=setTimeout(n,600),o;function n(){o(),a()}function o(){var e;null==(e=_.current)||e.removeEventListener("transitionend",n),m.current&&clearTimeout(m.current)}}),[e]),(0,n.jsxs)("div",{ref:_,onClick:()=>null==t?void 0:t(),className:(0,s.classNames)({FeatureEndedNotification:!0,"FeatureEndedNotification--closing":!e}),children:[(0,n.jsx)(i.Icon20ClockOutline,{className:"FeatureEndedNotification--clock"}),(0,n.jsxs)("div",{className:"FeatureEndedNotification--desc",children:[(0,n.jsx)("div",{className:"FeatureEndedNotification--desc__title",children:d}),Boolean(c&&u)&&(0,n.jsx)("div",{children:u})]}),c&&(0,n.jsx)(r.Icon20ChevronRight,{className:"FeatureEndedNotification--chevron"})]})}},164177:(e,t,a)=>{"use strict";a.d(t,{FeedbackScreen:()=>c});var n=a(785893),o=a(667294),i=a(346880),r=a(531950),s=a(135504),l=a(869048);const c=({title:e,children:t,sendButtonClick:a,skipButtonClick:c,sendButtonDisabled:d=!0})=>{const{getLang:u}=(0,o.useContext)(i.LangContext);return(0,n.jsx)(l.AppRootProvider,{children:(0,n.jsxs)("div",{className:"FeedbackScreen",children:[(0,n.jsx)(r.Icon24CancelOutline,{"aria-label":u("calls_feedback_skip"),className:"FeedbackScreen__close",onClick:c}),(0,n.jsx)("div",{className:"FeedbackScreen__title",children:e}),t,(0,n.jsxs)("div",{className:"FeedbackScreen__actions",children:[(0,n.jsx)(s.OutlinedButton,{"data-focus-first":!0,mode:"secondary",appearance:"overlay",onClick:c,children:u("calls_feedback_skip")}),(0,n.jsx)(s.OutlinedButton,{mode:"primary",appearance:"overlay",onClick:a,disabled:d,children:u("calls_feedback_send")})]})]})})}},272286:(e,t,a)=>{"use strict";a.d(t,{FocusTrapWrapper:()=>i});var n=a(785893),o=a(119783);function i({label:e,children:t}){return(0,n.jsx)("div",{role:"dialog","aria-label":e,"aria-modal":"true",children:(0,n.jsx)(o.FocusTrap,{hasFirstFocusableElement:!0,children:t})})}},88123:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenHistoryCalls:()=>_});var n=a(785893),o=a(667294),i=a(251985),r=a(197264),s=a(224050),l=a(910434),c=a(661307),d=a(218284),u=a(915961),p=a(627240);const _=({historyCalls:e,loading:t,historyBlockReloading:a,selectedOwnerId:_,ownerOptions:m,onGroupSelectChange:h,onHistoryAction:g,onShowMoreHistory:A,showMoreHistory:C,isShowList:v})=>{const{getLang:f}=(0,u.useLang)(),S=(0,o.useMemo)((()=>m.length>1?(0,n.jsx)(p.default,{className:"CallHistoryScreen--listHeaderSelector",options:m,value:_,onChange:h}):(0,n.jsx)(n.Fragment,{})),[m]),E=(0,o.useMemo)((()=>f(0===_?"calls_history_list_stub":"calls_history_list_groups_stub")),[_]),T=!(t||a||v||e.length),I=f("calls_history_list_header");return(0,n.jsxs)(r.default,{title:T?I:void 0,children:[T&&(0,n.jsx)(c.default,{className:"CallHistoryList--stub",children:E}),t&&(0,n.jsx)(i.DivBlockSkeleton,{height:500}),v&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.ListHeader,{className:"CallHistoryScreen--listHeader",right:S,children:I}),a&&(0,n.jsx)(c.default,{children:(0,n.jsx)(l.default,{})}),!a&&(0,n.jsx)(d.CallHistoryList,{selectedOwnerId:_,calls:e,onMenuItemClick:g,stubText:E,hasMore:C,onLoadMore:A})]})]})}},314343:(e,t,a)=>{"use strict";a.d(t,{PRIVATE_CALL_OWNER:()=>n});const n=0},279604:(e,t,a)=>{"use strict";a.d(t,{useHistoryCalls:()=>_});var n=a(667294),o=a(50533),i=a(26660),r=a(974571),s=a(611324),l=a(3264),c=a(645022),d=a(915961),u=a(190653),p=a(314343);const _=()=>{const{getLang:e}=(0,d.useLang)(),t=(0,o.useStore)(),a=(0,i.useHistoryScreenDispatch)(),_=(0,i.useHistoryScreenSelector)((e=>e.historyCalls)),m=(0,i.useHistoryScreenSelector)((e=>e.joinLinks)),h=(0,i.useHistoryScreenSelector)((e=>e.profiles)),{SDK:g,bridge:A}=(0,c.useBaseObjectsContext)(),[C,v]=(0,n.useState)(!1),[f,S]=(0,n.useState)(p.PRIVATE_CALL_OWNER),{onHistoryAction:E}=(0,r.useHistoryScreenContextActions)(),{onShowMoreHistory:T,loading:I,showMoreHistory:y,loadHistory:N}=(0,s.useHistoryScreenLoadActions)("all"),b=(0,n.useMemo)((()=>[{value:p.PRIVATE_CALL_OWNER,label:e("calls_history_list_personal_option")}]),[]),{ownerOptions:x}=(0,u.useOwnerOptions)({initialOptions:b}),M=(0,n.useCallback)((e=>{const n=Number(e.selected.value);v(!0),S(n),N(0,n,[],!0).then((e=>{v(!1),e&&(0,l.checkAuthByGroupId)(g,A,t,n,a,!0)}))}),[h,m,_]),O=!I&&(_.length>0||f<0||0===f&&C);return{loading:I,historyCalls:_,historyBlockReloading:C,selectedOwnerId:f,ownerOptions:x,onGroupSelectChange:M,onHistoryAction:E,onShowMoreHistory:T,showMoreHistory:y,isShowList:O,isDisplayBlock:I||O||C}}},581351:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenScheduledCalls:()=>O});var n=a(434788),o=a(785893),i=a(667294),r=a(251985),s=a(197264),l=a(224050),c=a(939723),d=a(915961),u=a(26660),p=a(659397),_=a(162532),m=a(121883),h=a(151582),g=a(661307),A=a(694982),C=a(910434),v=a(700200),f=a(198179),S=a(832065),E=a(292071),T=a(275765),I=a(360230),y=a(645022),N=a(844366),b=a(633891),x=a(605419),M=a(167810);const O=({calls:e,loading:t,onLinkClick:a,skeletonHeight:O,ownerSelect:P,section:R})=>{var k,w;const{getLang:D}=(0,d.useLang)(),L=(0,u.useHistoryScreenDispatch)(),{showText:j}=(0,I.useNotifier)(),{bridge:B}=(0,y.useBaseObjectsContext)(),{navigateToConvo:U}=(0,M.useNavigationContext)(),[H]=(0,i.useState)((()=>(new Intl.DateTimeFormat).resolvedOptions().timeZone)),F=(0,u.useHistoryScreenSelector)((e=>e.meId)),V=(0,u.useHistoryScreenSelector)((e=>e.profiles[F])),G=(0,T.useCalendarEventDetails)({meParticipant:V}),W=(0,h.useIsMounted)(),$="scheduled"===R,{calls:z,isShowAll:Z,toggleShowAll:K}=(0,b.useCutCalls)({allCalls:e,isScheduledSection:$});(0,i.useEffect)((()=>{V||(0,_.loadChatMembers)(F).then((e=>{(null==e?void 0:e.profiles)&&W()&&(0,m.loadProfiles)(L,e.profiles)}))}),[V,F]);const Q=(0,i.useCallback)((e=>{B.joinCallByLink(e.join_link,void 0,!1,E.CallStatSource.HISTORY)}),[]),Y=(0,i.useCallback)((e=>{e.vk_join_link&&(0,p.copyTextToClipboard)(e.vk_join_link).then((()=>{j(D("calls_create_call_by_link_copied"))}))}),[D,j]),q=(0,i.useCallback)((e=>{var t,a,n,o;const i={call_id:e.call_id,title:e.name||"",start:new Date(1e3*((null==(t=e.schedule)?void 0:t.time)||0)),timezone:H,duration:(null==(a=e.schedule)?void 0:a.duration)||0,join_link:e.vk_join_link||"",repeatRule:(0,x.mapRecurrenceRule)(null==(n=e.schedule)?void 0:n.recurrence_rule)};(null==(o=e.group)?void 0:o.name)&&(i.displayName=e.group.name),(0,p.copyTextToClipboard)(G.getDescription(i)).then((()=>{j(D("calls_create_call_by_link_text_copied"))}))}),[G,D,j]),J=(0,i.useCallback)((e=>{L({type:c.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),L({type:c.HistoryScreenActionTypes.SET_POPUP,data:c.EHistoryScreenPopup.DeleteCalendarEvent})}),[]),X=(0,i.useCallback)((e=>{L({type:c.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL,data:e}),L({type:c.HistoryScreenActionTypes.SET_POPUP,data:c.EHistoryScreenPopup.EditCalendarEvent})}),[]),ee=(0,i.useCallback)((()=>{a&&a(event,"scheduled","calls?section=scheduled")}),[a]),te=(0,i.useCallback)((e=>{var t;(null==(t=e.chat)?void 0:t.peer_id)&&U(e.chat.peer_id)}),[U]),ae=$&&(null==P||null==(ne=P.options)?void 0:ne.length)?(0,o.jsx)(A.default,(0,n._)({className:"CallHistoryScreen--listHeaderSelector",disabled:t},P)):a&&!$?(0,o.jsx)(v.default,{className:"CallHistoryScreen--moreLink",href:"/calls?section=scheduled",onClick:ee,children:D("calls_show_all")}):void 0;var ne;const oe=!!(null==z||null==(k=z.items)?void 0:k.length),ie=t&&!oe,re=!t&&oe,se=!(t||oe||a&&!(null==P?void 0:P.value)),le=oe||se||ie,ce=t&&oe,de=re&&!$&&(null==e?void 0:e.total)&&e.total>b.CALLS_COUNT_IN_PAGE,ue=Z?D("calls_collapse"):D("calls_history_scheduled_calls_show_all").replace("{count}",((null==e?void 0:e.total)||0)-b.CALLS_COUNT_IN_PAGE);return le?(0,o.jsxs)(s.default,{className:(0,p.classNames)("CallHistoryScreen--content",{"CallHistoryScreen--currentCalls":!ie}),children:[!ie&&(0,o.jsx)(l.ListHeader,{className:(0,p.classNames)("CallHistoryScreen--listHeader","HistoryScreenScheduledCalls__header",{"HistoryScreenScheduledCalls__header--standalone":$&&!se}),right:ae,children:D("calls_scheduled")}),ie&&(0,o.jsx)(r.DivBlockSkeleton,{height:O||300}),ce&&(0,o.jsx)(g.default,{children:(0,o.jsx)(C.default,{})}),re&&(null==z||null==(w=z.items)?void 0:w.map(((e,t)=>(0,o.jsxs)("div",{children:[(0,o.jsx)(f.BlockTitle,{children:e.title}),e.calls.map((a=>(0,o.jsx)(S.ScheduledCallRow,{call:a,isToday:e.isToday,isTomorrow:e.isTomorrow,onCallEnter:Q,onCallCopyLink:Y,onCallCopyText:q,onCallDelete:J,onCallEdit:X,onCallMessage:te},a.call_id+"-"+t)))]},e.title)))),de&&(0,o.jsx)(N.PageBlockShowMore,{text:ue,onClick:K}),se&&(0,o.jsx)(g.default,{className:"CallHistoryList--stub",children:D("calls_history_scheduled_calls_list_stub")})]}):(0,o.jsx)(o.Fragment,{})}},633891:(e,t,a)=>{"use strict";a.d(t,{CALLS_COUNT_IN_PAGE:()=>s,useCutCalls:()=>l});var n=a(434788),o=a(820224),i=a(667294),r=a(659397);const s=3,l=({allCalls:e,isScheduledSection:t})=>{const[a,l]=(0,i.useState)(!1),c=(0,i.useCallback)((()=>{l((e=>!e))}),[]),d=(0,i.useMemo)((()=>{if((0,r.isUndefined)(e)||t||a||!e.total||e.total<=s||!Array.isArray(null==e?void 0:e.items))return e;const i=[];let l=0;for(const t of null==e?void 0:e.items){let{calls:e}=t,a=(0,o._)(t,["calls"]);if(l>=s)break;const r=s-l,c=e.length<r?e:e.slice(0,r);i.push((0,n._)({},a,{calls:c})),l+=c.length}return i.length?(0,n._)({},e,{items:i}):null}),[e,a]);return{isShowAll:a,toggleShowAll:c,calls:d}}},564770:(e,t,a)=>{"use strict";a.d(t,{useOwnerSelect:()=>l});var n=a(667294),o=a(190653),i=a(26660),r=a(681208),s=a(915961);const l=()=>{const{getLang:e}=(0,s.useLang)(),t=(0,i.useHistoryScreenSelector)((e=>e.meId)),a=(0,n.useMemo)((()=>[{label:e("calls_all"),value:0},{label:e("calls_history_list_personal_option"),value:t}]),[t]),{ownerOptions:l}=(0,o.useOwnerOptions)({initialOptions:a});return(0,r.useFormSelectValue)({options:l,initialValue:()=>0})}},626334:(e,t,a)=>{"use strict";a.d(t,{EScheduledCallsType:()=>n,useScheduledCalls:()=>m});var n,o=a(667294),i=a(968755),r=a(915961),s=a(768296),l=a(26660),c=a(162532),d=a(939723),u=a(598593),p=a(151582),_=a(121883);!function(e){e[e.Preview=0]="Preview",e[e.Full=1]="Full"}(n||(n={}));const m=({type:e=0,forceUpdate:t,disabled:a,callerId:n})=>{const{getLang:d}=(0,r.useLang)(),{locale:m}=(0,s.useLocale)(),{handleError:A}=(0,u.usePromiseError)(),C=(0,p.useIsMounted)(),v=(0,o.useRef)(),[f,S]=(0,o.useState)(),E=(0,l.useHistoryScreenDispatch)(),T=(0,l.useHistoryScreenSelector)((e=>e.scheduledCalls)),I=(0,l.useHistoryScreenSelector)((e=>e.scheduledCallsPreview)),y=(0,l.useHistoryScreenSelector)((e=>e.profiles));(0,o.useEffect)((()=>{if(!(null==f?void 0:f.size))return;const e=[];f.forEach((t=>{y[t]||e.push(t)})),e.length&&(0,c.loadCallPeersByPeerIds)(e).then((e=>{if(!C())return;const t=[...e.profiles||[],...e.groups||[]];t.length&&(0,_.loadProfiles)(E,t)})).catch(A)}),[f,y]);const N=(0,o.useCallback)((()=>{if(a)return;const t=new Date,o={grouped:1};let r;switch(o.start_time=Math.round(t.valueOf()/1e3),n&&(o.caller_id=n),e){case 1:o.finish_time=o.start_time+31536e3,r=g;break;case 0:o.finish_time=o.start_time+604800,r=h}r(E,{loading:!0}),(0,c.messagesGetScheduledCalls)(o).then((e=>{if(!C())return;const{calls:a,callerIds:n,total:o}=(0,i.mapCalls)({now:t,items:null==e?void 0:e.items,locale:m,getLang:d,groups:null==e?void 0:e.groups});r(E,{items:a,total:o}),S(n)})).catch(A).finally((()=>{C()&&r(E,{loading:!1})})),v.current=()=>{r(E)}}),[e,a,n]);return(0,o.useEffect)((()=>()=>{null==v.current||v.current()}),[]),(0,o.useEffect)((()=>{N()}),[e,t,n]),{scheduledCalls:T,scheduledCallsPreview:I,fetchData:N}};function h(e,t){e({type:d.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW,data:t})}function g(e,t){e({type:d.HistoryScreenActionTypes.SET_SCHEDULED_CALLS,data:t})}},958928:(e,t,a)=>{"use strict";a.d(t,{IncomingCall:()=>_});var n=a(785893),o=a(667294),i=a(230823),r=a(417174),s=a(706705),l=a(687054),c=a(752654),d=a(27733),u=a(346880),p=a(659397);function _({id:e,photo:t,title:a,description:_,onCollapseCall:m,children:h,isNFT:g}){const{getLang:A}=(0,o.useContext)(u.LangContext);return(0,n.jsxs)("section",{className:"IncomingCall",children:[(0,n.jsx)(i.BlurredBackground,{id:e}),(0,n.jsx)(c.default,{position:"b",text:A("calls_collapse"),marginTop:-6,children:(0,n.jsx)(l.CallIconButton,{icon:(0,n.jsx)(d.Icon24PictureInPictureSquareFilled,{}),"aria-label":A("calls_collapse"),className:"IncomingCall__collapse",onClick:m})}),(0,n.jsx)(s.IncomingCallHeader,{title:a,description:_}),(0,n.jsx)(r.CallPhoto,{id:e,waves:!0,photo:t,alt:a||"",className:(0,p.classNames)("IncomingCall__photo",{"IncomingCall__photo--is-nft":g}),isNFT:g}),(0,n.jsx)("footer",{className:"IncomingCall__footer",children:h})]})}},706705:(e,t,a)=>{"use strict";a.d(t,{IncomingCallHeader:()=>i});var n=a(785893),o=a(659397);function i({title:e,description:t,className:a}){return(0,n.jsxs)("header",{className:(0,o.classNames)("IncomingCallHeader",a),children:[(0,n.jsx)("h1",{className:"IncomingCallHeader__title",children:e}),(0,n.jsx)("div",{className:"IncomingCallHeader__description",children:t})]})}},382873:(e,t,a)=>{"use strict";a.d(t,{JoinHeader:()=>i});var n=a(785893),o=a(796067);const i=({children:e})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"JoinHeaderIcon",children:(0,n.jsx)(o.Icon28PhoneAddOutline,{width:34,height:34})}),(0,n.jsx)("h2",{className:"JoinHeader",children:e})]})},824730:(e,t,a)=>{"use strict";a.d(t,{JoinScreen:()=>S});var n=a(785893),o=a(667294),i=a(382873),r=a(43014),s=a(511527),l=a(659397),c=a(718738),d=a(571150),u=a(163749),p=a(402622),_=a(64195),m=a(502592),h=a(512334),g=a(135504),A=a(22412),C=a(788822),v=a(86894),f=a(796317);const S=({isAnonym:e,title:t,label:a,items:S,onChangeName:E,name:T,namePlaceholder:I,joinWithVideoText:y,joinWithAudioText:N,onJoinWithVideo:b,onJoinWithAudio:x,disabled:M,inputDisabled:O,callByNameShow:P,onCallByNameClick:R,onCallViaNativeAppClick:k,callViaNativeAppShow:w,callByNameTitle:D,callViaNativeAppTitle:L,profileName:j,profileType:B})=>{const{enableChangeName:U}=(0,o.useContext)(f.ConfigContext),H=(0,o.useMemo)((()=>U?(0,n.jsxs)(v.Group,{mode:"plain",className:"JoinScreen__options",children:[w&&(0,n.jsx)(v.SimpleCell,{before:(0,n.jsx)(c.Icon28LaptopOutline,{className:"JoinScreen__presentation_icon"}),onClick:k,after:(0,n.jsx)(d.Icon12Chevron,{className:"JoinScreen__presentation_icon"}),children:L}),P&&(0,n.jsx)(v.SimpleCell,{before:(0,n.jsx)(u.Icon28UserOutline,{className:"JoinScreen__presentation_icon"}),onClick:R,after:(0,n.jsx)(d.Icon12Chevron,{className:"JoinScreen__presentation_icon"}),subtitle:B,children:(0,C.decodeHTMLEntities)(j||"")})]}):(0,n.jsxs)(m.default,{border:!1,className:"JoinScreen__options",children:[w&&(0,n.jsx)(h.default,{border:!1,selectable:!0,chevron:!0,onClick:k,icon:(0,n.jsx)(c.Icon28LaptopOutline,{className:"JoinScreen__presentation_icon"}),children:L}),P&&(0,n.jsx)(h.default,{border:!1,selectable:!0,chevron:!0,onClick:R,icon:(0,n.jsx)(u.Icon28UserOutline,{className:"JoinScreen__presentation_icon"}),children:D})]})),[w,P,U,j,B]);return(0,n.jsxs)("div",{className:(0,l.classNames)("JoinScreen",{"JoinScreen--anonym":e}),children:[(0,n.jsx)(i.JoinHeader,{children:(0,C.decodeHTMLEntities)(t)}),(0,n.jsxs)("div",{className:"JoinScreen__members",children:[(0,n.jsx)(r.AvatarsStack,{items:S}),(0,n.jsx)("div",{className:"JoinScreen__membersLabel",children:a})]}),(0,n.jsxs)("footer",{className:"JoinScreen__footer",children:[e&&(0,n.jsx)(s.default,{onChange:E,className:"JoinScreen__input",value:T,placeholder:I,disabled:O,maxLength:25,onKeyDown:e=>{e.key===A.KeyboardCodes.Enter&&b()}}),(0,n.jsxs)(g.OutlinedButton,{mode:"primary",onClick:b,disabled:M,type:"submit",children:[(0,n.jsx)(p.Icon16Videocam,{className:"JoinScreen__icon"}),(0,n.jsx)("span",{children:y})]}),(0,n.jsx)(g.OutlinedButton,{mode:"primary",title:N,"aria-label":N,onClick:x,disabled:M,children:(0,n.jsx)(_.Icon16Phone,{className:"JoinScreen__icon"})})]}),(P||w)&&H]})}},316699:(e,t,a)=>{"use strict";a.d(t,{KickParticipantModal:()=>l});var n=a(785893),o=a(667294),i=a(513885),r=a(346880),s=a(635127);const l=({onClose:e,actionButtons:t,onAllowReconnectChange:a,description:l,allowBan:c,banText:d})=>{const{getLang:u}=(0,o.useContext)(r.LangContext),[p,_]=(0,o.useState)(!0),m=(0,o.useCallback)(((e,t)=>{a&&a(t),_(t)}),[]);return(0,n.jsx)(i.default,{className:"KickParticipantModal",appearance:"blue",title:u("calls_kick_participant_title"),actionButtons:t,onClose:e,children:(0,n.jsxs)("div",{className:"KickParticipantModal__content",children:[l,c&&(0,n.jsx)("div",{children:(0,n.jsx)(s.default,{className:"KickParticipantModal__checkbox",onChange:m,checked:p,children:d})})]})})}},43291:(e,t,a)=>{"use strict";a.d(t,{ListItemWithHint:()=>l});var n=a(434788),o=a(820224),i=a(785893),r=a(512334),s=a(911099);const l=e=>{var{hint:t,className:a,children:l}=e,c=(0,o._)(e,["hint","className","children"]);const d=!!t,u={"ListItem--withHint":d};return(0,i.jsxs)(r.default,(0,n._)({},c,{className:(0,s.classNames)("CallsListItem",u,a),children:[l,d&&(0,i.jsx)("div",{className:"ListItem--hint",children:t})]}))}},194712:(e,t,a)=>{"use strict";a.d(t,{ListMore:()=>s});var n=a(434788),o=a(820224),i=a(785893),r=a(659397);const s=e=>{var{children:t,className:a,noHover:s}=e,l=(0,o._)(e,["children","className","noHover"]);return(0,i.jsx)("button",(0,n._)({className:(0,r.classNames)("CallsListMore",{"CallsListMore--no-hover":!!s},a)},l,{children:t}))}},182846:(e,t,a)=>{"use strict";a.d(t,{MenuActionWithIcon:()=>o});var n=a(785893);const o=({text:e,icon:t})=>(0,n.jsxs)("div",{className:"Calls__MenuActionWithIcon",children:[(0,n.jsx)("span",{children:e}),t]})},355226:(e,t,a)=>{"use strict";a.d(t,{MicIconButton:()=>u});var n=a(785893),o=a(667294),i=a(490287),r=a(136486),s=a(589481),l=a(496111),c=a(986558),d=a(35566);const u=(0,o.forwardRef)((function({isAudioAllowed:e,isAudioEnabled:t,onToggleAudio:a,ariaLabel:o},u){const p=(0,i.useTypedSelector)((e=>!(!e.externalId||!e.speakers[(0,l.externalIdToString)(e.externalId)]))),_=t?p?(0,n.jsx)(s.MicIconWithSpeakingIndicator,{}):(0,n.jsx)(c.Icon24Voice,{}):(0,n.jsx)(d.Icon24MicrophoneSlash,{}),m=e?t?r.CallButtonTypes.ON:r.CallButtonTypes.OFF:r.CallButtonTypes.DISABLED;return(0,n.jsx)(r.CallButton,{"aria-label":o,"aria-pressed":t,type:m,icon:_,onClick:a,className:"Call__footerButton",ref:u})}))},589481:(e,t,a)=>{"use strict";a.d(t,{MicIconWithSpeakingIndicator:()=>i});var n=a(785893),o=a(911099);const i=()=>{const e=(0,o.classNames)({MicIconWithSpeakingIndicator__scale:!0});return(0,n.jsxs)("svg",{height:"20",width:"16",xmlns:"http://www.w3.org/2000/svg",className:"MicIconWithSpeakingIndicator",children:[(0,n.jsx)("mask",{id:"MicIconWithSpeakingIndicatorMask",children:(0,n.jsx)("path",{d:"M8 0a4 4 0 00-4 4v5a4 4 0 008 0V4a4 4 0 00-4-4z"})}),(0,n.jsx)("path",{d:"M1.1 10c-.55 0-.98.49-.84 1.02a8 8 0 006.84 5.93v2.15a.9.9 0 101.8 0v-2.15a8 8 0 006.84-5.93c.14-.53-.29-1.02-.84-1.02-.45 0-.83.33-.95.76a6.2 6.2 0 01-11.9 0c-.12-.43-.5-.76-.95-.76z"}),(0,n.jsx)("g",{mask:"url(#MicIconWithSpeakingIndicatorMask)",children:(0,n.jsxs)("g",{className:e,children:[(0,n.jsx)("path",{d:"M8 0a4 4 0 00-4 4v7h8V4a4 4 0 00-4-4z"}),(0,n.jsx)("path",{d:"M8 7a4 4 0 00-4 4v5a4 4 0 008 0v-5a4 4 0 00-4-4z",className:"MicIconWithSpeakingIndicator__filled"})]})})]})}},199651:(e,t,a)=>{"use strict";a.d(t,{ModalEventPlanned:()=>l});var n=a(785893),o=a(193527),i=a(564349),r=a(915961),s=a(86894);const l=({onClose:e,text:t,onCopyLink:a,onCopyText:l,onSendByMessage:c})=>{const{getLang:d}=(0,r.useLang)();return(0,n.jsx)(o.BaseModal,{className:"CallsModalEventPlanned",onClose:e,enableCrossButton:!0,disableBodyScroll:!0,label:d("calls_event_planned"),children:(0,n.jsxs)("div",{className:"CallsModalEventPlanned__wrap",children:[(0,n.jsx)(i.Icon56NotebookCheckOutline,{className:"CallsModalEventPlanned__icon"}),(0,n.jsx)("h3",{className:"CallsModalEventPlanned__title",children:d("calls_event_planned")}),(0,n.jsx)("textarea",{className:"CallsModalEventPlanned__preview",value:t,readOnly:!0}),(0,n.jsxs)("div",{className:"CallsModalEventPlanned__buttons",children:[(0,n.jsx)(s.Button,{size:"m",mode:"primary",onClick:l,children:d("calls_copy_invite_text")}),(0,n.jsx)(s.Button,{size:"m",mode:"tertiary",onClick:a,children:d("calls_copy_invite_link")}),(0,n.jsx)(s.Button,{size:"m",mode:"tertiary",onClick:c,children:d("calls_send_text_by_im")})]})]})})}},219934:(e,t,a)=>{"use strict";a.d(t,{ModalMobileAppDownload:()=>l});var n=a(785893),o=a(193527),i=a(274706),r=a(558791),s=a(650653);const l=({onClose:e,appMarket:t})=>{const{getLang:a}=(0,r.useLangContext)(),l=t===s.AppMarket.APP_STORE?i.OS.IOS:i.OS.ANDROID,c=()=>{switch(l){case i.OS.IOS:return a("calls_application_for_ios");case i.OS.ANDROID:return a("calls_application_for_android")}};return(0,n.jsx)(o.BaseModal,{className:"CallsModalMobileAppDownloaded",onClose:e,enableCrossButton:!0,disableBodyScroll:!0,label:c(),children:(0,n.jsxs)("div",{className:"CallsModalMobileAppDownloaded__wrap",children:[(0,n.jsx)("div",{className:`CallsModalMobileAppDownloaded__device-img CallsModalMobileAppDownloaded__device-img-${l}`}),(0,n.jsxs)("div",{className:"CallsModalMobileAppDownloaded__qr",children:[(0,n.jsx)("div",{className:`CallsModalMobileAppDownloaded__qrImg CallsModalMobileAppDownloaded__qrImg-${t}`}),(0,n.jsx)("div",{className:"CallsModalMobileAppDownload__title",children:c()}),(0,n.jsx)("div",{className:"CallsModalMobileAppDownload__text",children:a("calls_scan_qr_offer")})]})]})})}},896144:(e,t,a)=>{"use strict";a.d(t,{CustomPureSelect:()=>m});var n=a(434788),o=a(785893),i=a(667294),r=a(227377),s=a(117374),l=a(479720),c=a(659397),d=a(915961),u=a(362156),p=a(363512),_=a(105801);const m=(0,i.forwardRef)((({handleAddToken:e,handleChange:t,handleRemoveToken:a,handleSelect:i,opened:m,tokens:h,value:g,filteredOptions:A,onClickAway:C,loading:v},f)=>{const{getLang:S}=(0,d.useLang)(),{handleClickAway:E}=(0,_.useClickAway)({ref:f,onClickAway:C});return(0,o.jsx)("div",{className:(0,c.classNames)("ModalSendMessage__MultiSelect",{"ModalSendMessage__MultiSelect--hidden":!!v&&!A.length}),children:(0,o.jsx)(r.default,{opened:m,placeholder:S("calls_enter_recipient_or_dialog_name"),removeTokenPlaceholder:"Remove",disableEmptyList:!!v,tokens:h,hasMore:!1,onChange:t,value:g,onSelect:i,onRemoveToken:a,disableOnSelectInputFocus:!0,hideInputWithName:!0,renderInput:()=>(0,o.jsxs)("div",{className:(0,c.classNames)("TokenInput","ModalSendMessage__TokenInput",{"ModalSendMessage__TokenInput--opened":m&&!v}),onClick:e,children:[h.map((e=>(0,o.jsx)(u.Token,(0,n._)({},e,{onClick:a}),e.id))),!(!h.length||m)&&(0,o.jsx)(u.Token,{id:"token-add",text:S("calls_add"),type:"add",onClick:p.noop},"token-add"),(!h.length||m)&&(0,o.jsx)("input",{ref:f,className:"ModalSendMessage__input",type:"text",value:g,onChange:t,onKeyDown:E,placeholder:S("calls_enter_recipient_or_dialog_name")}),(0,o.jsx)(s.Icon16DropdownOutline,{className:"ModalSendMessage__angle-icon"})]}),renderSuggest:e=>(0,o.jsx)(l.default,{"data-id":e.id,photo:e.photo,title:e.text,onClick:()=>i(e.id)},e.id),data:A,notFoundText:S("calls_search_empty_list")})})}));m.displayName="CustomPureSelect"},156515:(e,t,a)=>{"use strict";a.d(t,{ModalSendMessage:()=>_});var n=a(434788),o=a(785893),i=a(667294),r=a(513885),s=a(589897),l=a(688731),c=a(915961),d=a(202301),u=a(896144),p=a(910420);const _=({onClose:e,title:t,onSubmit:a,optionsIM:_,submitDisabled:m,initialText:h,onChangeInputIM:g,loading:A})=>{const{getLang:C}=(0,c.useLang)(),[v,f]=(0,i.useState)(h||""),[S]=(0,i.useState)(d.EMessageDestination.IM),E=(0,p.useCustomPureSelectController)({options:_,onChangeInput:g}),T=(0,i.useCallback)((e=>{const t=e.target.value;f(t)}),[]),I=(0,i.useCallback)((()=>{switch(S){case d.EMessageDestination.IM:{const e=E.tokens.map((e=>e.id));if(!e.length||!v)break;a({text:v,ids:e,destination:S});break}}}),[v,E.tokens,a,S]),y=!v||!E.tokens.length;return(0,o.jsx)(r.default,{className:"ModalSendMessage",onClose:e,title:t,actionButtons:(0,o.jsx)(s.default,{mode:"primary",size:"m",onClick:I,disabled:y||m,children:C("calls_send")}),disableEscapeClose:!0,disableBodyScroll:!0,children:(0,o.jsxs)("div",{className:"ModalSendMessage__Main",children:[(0,o.jsx)("div",{className:"ModalSendMessage__Destination",children:(0,o.jsx)("div",{className:"ModalSendMessage__RadioDestination",children:(0,o.jsx)(u.CustomPureSelect,(0,n._)({loading:A},E))})}),(0,o.jsxs)("div",{className:"ModalSendMessage__Message",children:[(0,o.jsx)("p",{className:"ModalSendMessage__Message__title",children:C("calls_your_message")}),(0,o.jsx)(l.default,{value:v,onChange:T})]})]})})}},362156:(e,t,a)=>{"use strict";a.d(t,{Token:()=>r});var n=a(785893),o=a(513698),i=a(659397);const r=({id:e,onClick:t,text:a,type:r="regular"})=>(0,n.jsxs)("span",{className:(0,i.classNames)("TokenInput__token",{"TokenInput__token--add":"add"===r}),onClick:"add"===r?()=>t():void 0,children:[(0,n.jsx)("span",{className:"TokenInput__label",children:a}),(0,n.jsx)("button",{"data-id":e,className:"TokenInput__remove",onClick:()=>t(e),children:(0,n.jsx)(o.Icon12Cancel,{})})]},e)},415472:(e,t,a)=>{"use strict";a.d(t,{DEFAULT_AVATAR:()=>n,DEFAULT_TITLE:()=>o});const n="https://vk.com/images/icons/im_multichat_50.png",o=""},202301:(e,t,a)=>{"use strict";var n;a.d(t,{EMessageDestination:()=>n}),function(e){e[e.Wall=0]="Wall",e[e.Community=1]="Community",e[e.History=2]="History",e[e.IM=3]="IM"}(n||(n={}))},105801:(e,t,a)=>{"use strict";a.d(t,{useClickAway:()=>i});var n=a(667294),o=a(22412);const i=({ref:e,onClickAway:t})=>({handleClickAway:(0,n.useCallback)((a=>{switch(a.code){case o.KeyboardCodes.Escape:var n;if(e&&"function"!=typeof e)null==(n=e.current)||n.blur();t();break;case o.KeyboardCodes.Tab:t()}}),[e,t])})},910420:(e,t,a)=>{"use strict";a.d(t,{useCustomPureSelectController:()=>r});var n=a(667294),o=a(111034),i=a(363512);const r=({options:e,onChangeInput:t})=>{const[a,r]=(0,n.useState)(""),[s,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)([]),[u,p]=(0,n.useState)((()=>[...e])),_=(0,n.useRef)(null),m=(0,n.useCallback)((()=>{l(!1),r("")}),[]);(0,n.useEffect)((()=>{null==t||t(a)}),[a]),(0,n.useEffect)((()=>{p((0,i.filterOptions)(a,e,c))}),[a,e,c]),(0,o.useDocumentClickClose)({selector:".ModalSendMessage__MultiSelect",onClose:m,opened:s});const h=(0,n.useCallback)((e=>{const t=e.target.value;r(t),l(!0)}),[]),g=(0,n.useCallback)((t=>{const a=e.find((e=>e.id===t));return a&&d((e=>{const t=new Set(e);return t.add({id:a.id,text:a.text,src:a.photo}),[...t]})),l(!1),r(""),Promise.resolve()}),[e]),A=(0,n.useCallback)((e=>{d((t=>t.filter((t=>t.id!==e)))),l(!1)}),[]),C=(0,n.useCallback)((e=>{const t=e.target,a=null==t.closest?void 0:t.closest(".TokenInput__token");a&&!a.classList.contains("TokenInput__token--add")||(l(!0),r(""),requestAnimationFrame((()=>{var e;null==(e=_.current)||e.focus()})))}),[c,e]);return{ref:_,filteredOptions:u,handleAddToken:C,handleChange:h,handleRemoveToken:A,handleSelect:g,onClickAway:m,opened:s,options:e,tokens:c,value:a}}},111034:(e,t,a)=>{"use strict";a.d(t,{useDocumentClickClose:()=>o});var n=a(667294);const o=({selector:e,opened:t,onClose:a})=>{(0,n.useEffect)((()=>{if(!t)return;const n=t=>{const n=t.target;n instanceof HTMLElement&&(n.closest(e)||a(!1))};return document.addEventListener("click",n),()=>{document.removeEventListener("click",n)}}),[t])}},363512:(e,t,a)=>{"use strict";a.d(t,{filterOptions:()=>o,mapConversations:()=>d,mapMessageConversation:()=>p,mapUserProfiles:()=>u,noop:()=>i});var n=a(415472);const o=(e,t,a)=>{const n=a.reduce(((e,t)=>(e[t.id]=!0,e)),{});let o=e.toLowerCase();return t.filter((e=>!n[e.id]&&e.text.toLowerCase().includes(o)))},i=()=>{},r=(e,t)=>{const a=Array.isArray(e)?e.find((e=>e.id===t)):e;return a&&a.photo_50||n.DEFAULT_AVATAR},s=(e,t)=>{switch(e.conversation.peer.type){case"chat":var a,o;return(null==(a=e.conversation.chat_settings)||null==(o=a.photo)?void 0:o.photo_50)||n.DEFAULT_AVATAR;case"user":return r(t,e.conversation.peer.id);default:return n.DEFAULT_AVATAR}},l=(e,t)=>{const a=Array.isArray(e)?e.find((e=>e.id===t)):e;if(!a||!a.first_name)return n.DEFAULT_TITLE;let o=a.first_name;return a.last_name&&(o+=" "+a.last_name),o},c=(e,t)=>{switch(e.conversation.peer.type){case"chat":var a;return(null==(a=e.conversation.chat_settings)?void 0:a.title)||n.DEFAULT_TITLE;case"user":return l(t,e.conversation.peer.id);default:return n.DEFAULT_TITLE}},d=(e,t=[])=>{const a=[];for(const n of e)"chat"===n.conversation.peer.type&&a.push({id:n.conversation.peer.id.toString(),photo:s(n,t),text:c(n,t)});return a},u=(e=[])=>e.map((e=>({id:e.id.toString(),photo:r(e,e.id),text:l(e,e.id)}))),p=e=>e.map((e=>{var t,a,o;return{id:e.peer.id.toString(),photo:(null==(t=e.chat_settings)||null==(a=t.photo)?void 0:a.photo_50)||n.DEFAULT_AVATAR,text:(null==(o=e.chat_settings)?void 0:o.title)||n.DEFAULT_TITLE}}))},689185:(e,t,a)=>{"use strict";a.d(t,{CurrentSharedMovie:()=>c});var n=a(785893),o=a(667294),i=a(589897),r=a(548029),s=a(346880),l=a(410859);const c=({movieInfo:e,handleRemoveMovie:t,isRemoveAvailable:a,onCloseParentModal:c})=>{const{movieId:d,title:u,thumbnails:p}=e,_=(0,l.getMaxPreview)(p),{getLang:m}=(0,o.useContext)(s.LangContext),[h,g]=(0,o.useState)(!1),A=(0,o.useCallback)((()=>g(!1)),[]),C=(0,o.useCallback)((()=>g(!0)),[]),v=(0,o.useCallback)((()=>{t(d).finally(c)}),[t,d]);return(0,n.jsxs)("div",{className:"CallsMovieCurrentSharedMovie",children:[(0,n.jsx)("div",{className:"CallsMovieCurrentSharedMovie__mainTitle",children:m("calls_shared_movie_current")}),(0,n.jsxs)("div",{className:"CallsMovieCurrentSharedMovie__content",children:[(0,n.jsx)("img",{src:_.url,alt:"img",className:"CallsMovieCurrentSharedMovie__preview"}),(0,n.jsx)("div",{className:"CallsMovieCurrentSharedMovie__description",children:(0,n.jsx)("div",{className:"CallsMovieCurrentSharedMovie__videoTitle",children:u})}),a&&(0,n.jsx)(i.default,{mode:"primary",size:"m",className:"CallsMovieCurrentSharedMovie__removeButton",onClick:C,children:m("calls_remove_movie_modal_complete")})]}),h&&a&&(0,n.jsx)(r.RemoveMovieModal,{onClose:A,onRemoveMovie:v})]})}},805899:(e,t,a)=>{"use strict";a.d(t,{MovieTile:()=>g});var n=a(785893),o=a(667294),i=a(410859),r=a(669153),s=a(787196),l=a(700200),c=a(727980),d=a(477246),u=a(558791),p=a(653088),_=a(915703),m=a(121644);const h=({movie:e,group:t,onClick:a,navigateToProfile:o})=>{const{onClose:h}=(0,m.useClosePopup)(),{getLang:g}=(0,u.useLangContext)(),A=(0,i.getMovieBackgroundUrl)({targetSize:s.TARGET_SIZE,image:e.image}),C=(0,r.useMovieDate)(e.date),v=(0,_.useMovieChannelUrl)(t);return(0,n.jsxs)("div",{className:"CallsMovieTile",onClick:()=>{null==a||a(e)},children:[(0,n.jsxs)("div",{className:"CallsMovieTile__thumb",style:{backgroundImage:A?`url(${A})`:void 0},children:[(0,n.jsx)("div",{className:"CallsMovieTile__thumb__play",children:(0,n.jsx)(c.default,{})}),!!e.duration&&(0,n.jsx)("div",{className:"CallsMovieTile__duration",children:(0,p.formatTimeHHMMSS)(e.duration)}),!!e.live_status&&!e.duration&&(0,n.jsx)(d.default,{className:"CallsMovieTile__live"})]}),(0,n.jsx)("div",{className:"CallsMovieTile__title",title:e.title,children:e.title}),(null==t?void 0:t.name)&&v&&(0,n.jsx)("div",{className:"CallsMovieTile__channel",children:(0,n.jsx)(l.default,{onClick:e=>{e.preventDefault(),e.stopPropagation(),v&&o&&(o(e,v),h())},children:t.name})}),(0,n.jsxs)("div",{className:"CallsMovieTile__description",children:[e.views&&(0,n.jsx)("span",{children:g("calls_movie_views_count",e.views)}),C&&(0,n.jsxs)("span",{children:[" · ",C]})]})]})},g=(0,o.memo)(h)},341716:(e,t,a)=>{"use strict";a.d(t,{MoviesNotFound:()=>s});var n=a(785893),o=a(667294),i=a(775701),r=a(346880);const s=({query:e})=>{const{getLang:t}=(0,o.useContext)(r.LangContext);return(0,n.jsxs)("div",{className:"CallsMovieTilesSpinner--maxed",children:[(0,n.jsx)(i.Icon56VideoOutline,{className:"MoviesNotFound__icon"}),!!e&&(0,n.jsxs)("span",{className:"MoviesNotFound__description",children:[t("calls_movie_choose_empty_query_start")," ",(0,n.jsx)("b",{children:e})," ",t("calls_movie_choose_empty_query_end")]}),!e&&(0,n.jsx)("span",{className:"MoviesNotFound__description",children:t("calls_movie_choose_video_not_found")})]})}},124495:(e,t,a)=>{"use strict";a.d(t,{MoviesPageTabs:()=>s});var n=a(785893),o=a(86894),i=a(869048),r=a(555948);const s=({tabs:e,activeTab:t,onTabClick:a,tabsClassnames:s})=>(0,n.jsx)("div",{className:s,children:(0,n.jsx)(i.AppRootProvider,{children:(0,n.jsx)(o.Tabs,{children:e.map((({id:e,label:o,href:i})=>(0,n.jsx)(r.TabsItem,{"aria-controls":e,onClick:()=>a(e,i),selected:e===t,children:o},e)))})})})},369984:(e,t,a)=>{"use strict";a.d(t,{RemoveMovieModal:()=>l});var n=a(785893),o=a(667294),i=a(513885),r=a(589897),s=a(346880);const l=({onClose:e,onConfirm:t})=>{const{getLang:a}=(0,o.useContext)(s.LangContext);return(0,n.jsx)(i.default,{onClose:e,title:a("calls_play_movie_modal_title"),className:"MovieChoose__innerModal",actionButtons:[(0,n.jsx)(r.default,{size:"m",onClick:e,mode:"secondary",children:a("calls_cancel")},"cancel"),(0,n.jsx)(r.default,{mode:"primary",size:"m",onClick:t,children:a("calls_yes_play")},"confirm")],children:(0,n.jsx)("div",{className:"MovieChoose__innerModalContent",children:a("calls_play_movie_modal_content")})})}},410586:(e,t,a)=>{"use strict";a.d(t,{SearchResults:()=>d});var n=a(785893),o=a(805899),i=a(448383),r=a(217219),s=a(141163),l=a(341716),c=a(558791);const d=({moviesData:e,loading:t,getNextPage:a,count:d,query:u,onMovieClick:p})=>{const{getLang:_}=(0,c.useLangContext)(),m=e&&!e.length&&!t,h=!e&&t,g=e&&!!e.length&&t;return(0,n.jsxs)(n.Fragment,{children:[h&&(0,n.jsx)(s.SpinnerMaxed,{}),m&&(0,n.jsx)(l.MoviesNotFound,{query:u}),!!(null==e?void 0:e.length)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"CallsMovieSearchTitle",children:[(0,n.jsx)("span",{children:_("calls_movie_player_search")}),!!d&&(0,n.jsxs)("span",{className:"CallsMovieSearchTitle__count",children:[" ",d]})]}),(0,n.jsxs)("div",{className:"CallsMovieTiles",children:[e.map((({movie:e,group:t},a)=>(0,n.jsx)(o.MovieTile,{movie:e,group:t,onClick:p},`${e.owner_id||a}-${e.id||a}`))),e.length<d&&(0,n.jsx)(i.NextPageTrigger,{onNextPage:a},"tiles-load-trigger")]})]}),g&&(0,n.jsx)(r.Spinner,{})]})}},217219:(e,t,a)=>{"use strict";a.d(t,{Spinner:()=>i});var n=a(785893),o=a(910434);const i=()=>(0,n.jsx)(o.default,{className:"CallsMovieTilesSpinner",size:44,color:"var(--icon_outline_secondary)"})},141163:(e,t,a)=>{"use strict";a.d(t,{SpinnerMaxed:()=>s});var n=a(785893),o=a(667294),i=a(910434),r=a(346880);const s=()=>{const{getLang:e}=(0,o.useContext)(r.LangContext);return(0,n.jsxs)("div",{className:"CallsMovieTilesSpinner--maxed",children:[(0,n.jsx)(i.default,{size:44,color:"var(--steel_gray_300)"}),(0,n.jsx)("div",{className:"CallsMovieTilesSpinner--maxed__description",children:e("calls_movie_choose_loader_title")})]})}},913115:(e,t,a)=>{"use strict";a.d(t,{TabAdded:()=>u});var n=a(785893),o=a(35155),i=a(256412),r=a(805899),s=a(448383),l=a(217219),c=a(141163),d=a(341716);const u=({onMovieClick:e})=>{const{data:t,loading:a,getNextPage:u,isNextPage:p}=(0,o.useOwnerVideos)(i.EMovieChooseTab.Added);return(0,n.jsxs)(n.Fragment,{children:[!t.length&&a&&(0,n.jsx)(c.SpinnerMaxed,{}),!t.length&&!a&&(0,n.jsx)(d.MoviesNotFound,{}),!!t.length&&(0,n.jsxs)("div",{className:"CallsMovieTiles",children:[t.map((({movie:t,group:a},o)=>(0,n.jsx)(r.MovieTile,{movie:t,group:a,onClick:e},`${t.owner_id||o}-${t.id||o}`))),p&&(0,n.jsx)(s.NextPageTrigger,{onNextPage:u},"tiles-load-trigger")]}),!!t.length&&a&&(0,n.jsx)(l.Spinner,{})]})}},37062:(e,t,a)=>{"use strict";a.d(t,{TabRecommended:()=>u});var n=a(785893),o=a(667294),i=a(138159),r=a(805899),s=a(448383),l=a(217219),c=a(141163),d=a(341716);const u=({onMovieClick:e,navigateToProfile:t})=>{const{data:a,loading:u,getNextPage:p,isNextPage:_}=(0,i.useRecommendedVideos)(),m=(0,o.useMemo)((()=>new AbortController),[]),h=(0,o.useCallback)((()=>p(m.signal)),[m]);return(0,o.useEffect)((()=>()=>m.abort()),[m]),(0,n.jsxs)(n.Fragment,{children:[!a.length&&u&&(0,n.jsx)(c.SpinnerMaxed,{}),!a.length&&!u&&(0,n.jsx)(d.MoviesNotFound,{}),!!a.length&&(0,n.jsxs)("div",{className:"CallsMovieTiles",children:[a.map((({movie:a,group:o},i)=>(0,n.jsx)(r.MovieTile,{movie:a,group:o,onClick:e,navigateToProfile:t},`${a.owner_id||i}-${a.id||i}`))),_&&(0,n.jsx)(s.NextPageTrigger,{onNextPage:h},"tiles-load-trigger")]}),!!a.length&&u&&(0,n.jsx)(l.Spinner,{})]})}},639107:(e,t,a)=>{"use strict";a.d(t,{TabUploaded:()=>u});var n=a(785893),o=a(35155),i=a(256412),r=a(805899),s=a(448383),l=a(217219),c=a(141163),d=a(341716);const u=({onMovieClick:e})=>{const{data:t,loading:a,getNextPage:u,isNextPage:p}=(0,o.useOwnerVideos)(i.EMovieChooseTab.Uploaded);return(0,n.jsxs)(n.Fragment,{children:[!t.length&&a&&(0,n.jsx)(c.SpinnerMaxed,{}),!t.length&&!a&&(0,n.jsx)(d.MoviesNotFound,{}),!!t.length&&(0,n.jsxs)("div",{className:"CallsMovieTiles",children:[t.map((({movie:t,group:a},o)=>(0,n.jsx)(r.MovieTile,{movie:t,group:a,onClick:e},`${t.owner_id||o}-${t.id||o}`))),p&&(0,n.jsx)(s.NextPageTrigger,{onNextPage:u},"tiles-load-trigger")]}),!!t.length&&a&&(0,n.jsx)(l.Spinner,{})]})}},787196:(e,t,a)=>{"use strict";a.d(t,{DEFAULT_COUNT:()=>i,FILTERS_MAP:()=>s,SORT_MAP:()=>r,TARGET_SIZE:()=>o});var n=a(541561);const o={w:257,h:146},i=12,r={[n.EMovieSort.Date]:0,[n.EMovieSort.Length]:1,[n.EMovieSort.Relevance]:2},s={[n.EMovieLength.Any]:void 0,[n.EMovieLength.Long]:"long",[n.EMovieLength.Short]:"short"}},915703:(e,t,a)=>{"use strict";a.d(t,{useMovieChannelUrl:()=>n});const n=e=>e?e.screen_name?`/${e.screen_name}`:`/public${e.id}`:null},669153:(e,t,a)=>{"use strict";a.d(t,{useMovieDate:()=>i});var n=a(220734),o=a(558791);const i=e=>{const{getLang:t}=(0,o.useLangContext)();let a="";if(e){const{years:o,months:i,days:r,hours:s,minutes:l,seconds:c}=(0,n.getAgeDiff)(e);switch(!0){case!!o:a=t("calls_movie_date_added_years",o);break;case!!i:a=t("calls_movie_date_added_months",i);break;case!!r:a=t("calls_movie_date_added_days",r);break;case!!s:a=t("calls_movie_date_added_hours",s);break;case!!l:a=t("calls_movie_date_added_minutes",l);break;case!!c:a=t("calls_movie_date_added_seconds",c)}}return a}},35155:(e,t,a)=>{"use strict";a.d(t,{useOwnerVideos:()=>u});var n=a(434788),o=a(667294),i=a(162532),r=a(256412),s=a(410859),l=a(490287),c=a(151582);const d={[r.EMovieChooseTab.Added]:-2,[r.EMovieChooseTab.Uploaded]:-1},u=e=>{const t=(0,c.useIsMounted)(),a=(0,l.useTypedSelector)((e=>e.groupId)),r=(0,o.useRef)(null),[u,p]=(0,o.useState)(!0),[_,m]=(0,o.useState)(null),[h,g]=(0,o.useState)([]),[A,C]=(0,o.useState)(!1),v=(0,o.useCallback)(((a,o)=>{var l;if(o.aborted)return Promise.resolve();p(!0),m(null);const c={album_id:d[e],start_from:null==(l=r.current)?void 0:l.next_from,fields:"screen_name",extended:1};return a&&(c.owner_id=a),(0,i.getWatchTogetherOwnerVideos)(c,{signal:o}).then((e=>{var a;r.current=(0,n._)({},r.current,e,{items:(null==(a=r.current)?void 0:a.items)?[...r.current.items,...e.items]:e.items,next_from:e.next_from}),t()&&(g((t=>[...t,...(0,s.mapData)(e)])),C(Boolean(e.next_from)))})).catch((e=>{o.aborted||m(e)})).finally((()=>{o.aborted||p(!1)}))}),[]);(0,o.useEffect)((()=>{const e=new AbortController;return v(a,e.signal),()=>e.abort()}),[a]);return{data:h,loading:u,error:_,isNextPage:A,getNextPage:(0,o.useCallback)((e=>v(a,e)),[a,v])}}},138159:(e,t,a)=>{"use strict";a.d(t,{useRecommendedVideos:()=>l});var n=a(434788),o=a(667294),i=a(162532),r=a(787196),s=a(410859);const l=()=>{const e=(0,o.useRef)(null),[t,a]=(0,o.useState)([]),[l,c]=(0,o.useState)(!0),[d,u]=(0,o.useState)(null),[p,_]=(0,o.useState)(!1),m=(0,o.useCallback)((t=>{var o;return t.aborted?Promise.resolve():(c(!0),u(null),(0,i.getWatchTogetherRecommended)({count:r.DEFAULT_COUNT,extended:1,fields:"screen_name",start_from:null==e||null==(o=e.current)?void 0:o.next_from},{signal:t}).then((o=>{var i;t.aborted||(e.current=(0,n._)({},e.current,o,{items:(null==(i=e.current)?void 0:i.items)?[...e.current.items,...o.items]:o.items}),a((e=>[...e,...(0,s.mapData)(o)])),_(e.current.count>e.current.items.length))})).catch((e=>{t.aborted||u(e)})).finally((()=>{t.aborted||c(!1)})))}),[]);return(0,o.useEffect)((()=>{const e=new AbortController;return m(e.signal),()=>e.abort()}),[]),{data:t,error:d,loading:l,isNextPage:p,getNextPage:m}}},62863:(e,t,a)=>{"use strict";a.d(t,{useSearchVideos:()=>d});var n=a(434788),o=a(667294),i=a(162532),r=a(787196),s=a(410859);const l={count:0,mappedMovies:null},c={last:-1,next:0},d=({searchSettings:e})=>{const t=(0,o.useRef)(""),a=(0,o.useRef)(""),d=(0,o.useRef)(null),u=(0,o.useRef)(c),[p,_]=(0,o.useState)(l),[m,h]=(0,o.useState)(!1),[g,A]=(0,o.useState)(null),C=(0,o.useCallback)(((o,r)=>{const p=JSON.stringify(e),m=t.current===o&&a.current===p;if(m&&u.current.next===u.current.last)return Promise.resolve();m||(_(l),t.current=o,a.current=p,u.current=(0,n._)({},c)),A(null),h(!0);const g=u.current.next;return(0,i.getSearchVideo)((0,s.mapSearchMovieSettings)({searchSettings:e,searchText:o,offset:g}),{signal:r}).then((e=>{r.aborted||t.current!==o||a.current!==p||(_((t=>({mappedMovies:t.mappedMovies?[...t.mappedMovies,...(0,s.mapData)(e)]:(0,s.mapData)(e),count:e.count}))),d.current=e,u.current.last=g)})).catch((e=>{r.aborted||A(e)})).finally((()=>{r.aborted||h(!1)}))}),[e]),v=(0,o.useCallback)((e=>(u.current={last:u.current.next,next:u.current.next+r.DEFAULT_COUNT},C(t.current,e))),[C]);return{data:p,loading:m,error:g,getSearchMovies:C,getNextPage:v}}},795302:(e,t,a)=>{"use strict";a.d(t,{useTabs:()=>r});var n=a(667294),o=a(256412),i=a(346880);const r=()=>{const[e,t]=(0,n.useState)(o.EMovieChooseTab.Recommended),{getLang:a}=(0,n.useContext)(i.LangContext);return{tab:e,tabs:(0,n.useMemo)((()=>[{href:"",id:o.EMovieChooseTab.Recommended,label:a("calls_movie_choose_recommended")},{href:"",id:o.EMovieChooseTab.Added,label:a("calls_movie_choose_added")},{href:"",id:o.EMovieChooseTab.Uploaded,label:a("calls_movie_choose_loaded")}]),[a]),onTabClick:(0,n.useCallback)((e=>{t(e)}),[])}}},256412:(e,t,a)=>{"use strict";var n;a.d(t,{EMovieChooseTab:()=>n}),function(e){e.Recommended="Recommended",e.Added="Added",e.Uploaded="Uploaded"}(n||(n={}))},410859:(e,t,a)=>{"use strict";a.d(t,{getMaxPreview:()=>c,getMovieBackgroundUrl:()=>i,mapData:()=>r,mapSearchMovieSettings:()=>l});var n=a(787196),o=a(541561);const i=({targetSize:e,image:t})=>{if(!t)return"";let a=null;for(const n of t){if(n.height>=e.h&&n.width>=e.w)return n.url;n.height>((null==a?void 0:a.height)||0)&&n.width>((null==a?void 0:a.width)||0)&&(a=n)}return a?a.url:""},r=e=>{const t=new Map;if(e.groups)for(const a of e.groups)t.set(a.id,a);return e.items.map((e=>({movie:e,group:t.get(Math.abs(e.owner_id||0))})))},s=e=>{const t=86400;switch(e){case o.EMovieDate.Any:case!1:return;case o.EMovieDate.Day:return t;case o.EMovieDate.Week:return 7*t;case o.EMovieDate.Month:return 30*t;case o.EMovieDate.Year:return 365*t}},l=({searchSettings:e,searchText:t,offset:a})=>{const i=e[o.EMovieSettingsType.Sort],r=e[o.EMovieSettingsType.Length],l=e[o.EMovieSettingsType.Checkbox][o.EMovieCheckbox.HighQuality],c=e[o.EMovieSettingsType.Checkbox][o.EMovieCheckbox.DirectTranslations];return{q:t,adult:e[o.EMovieSettingsType.Checkbox][o.EMovieCheckbox.NoRestrictions]?1:0,sort:i?n.SORT_MAP[i]:n.SORT_MAP[o.EMovieSort.Relevance],hd:l?1:0,filters:r?n.FILTERS_MAP[r]:void 0,live:c?1:0,search_own:0,date:s(e[o.EMovieSettingsType.Date]),offset:a,count:n.DEFAULT_COUNT}},c=(e=[])=>{let t={url:"",width:0,height:0};return e.forEach((e=>{t.width<e.width&&(t=e)})),t}},778289:(e,t,a)=>{"use strict";a.d(t,{MovieChooseModal:()=>l});var n=a(785893),o=a(667294),i=a(513885),r=a(121644),s=a(346880);const l=({children:e})=>{const{getLang:t}=(0,o.useContext)(s.LangContext),{onClose:a}=(0,r.useClosePopup)();return(0,n.jsx)(i.default,{className:"MovieChooseModal",onClose:a,title:t("calls_movie_choose_title"),appearance:"blue",hasScroll:!1,children:e})}},130658:(e,t,a)=>{"use strict";a.d(t,{MoviePlayer:()=>f});var n=a(785893),o=a(667294),i=a(241331),r=a(224966),s=a(345395),l=a(888188),c=a(300993),d=a(579431),u=a(944587),p=a(114332),_=a(138906),m=a(659397),h=a(246743),g=a(399894),A=a(954982),C=a(464380);const v=({title:e,current:t,total:a,isEditable:v,onRewind:f,volumeValue:S,onChangeVolume:E,vkMovieId:T,onPause:I,onPlay:y,onRemove:N,streamData:b,isPlayed:x,handleShowCallControls:M,isMovieStreamEnabled:O,mode:P,onMute:R,onUnMute:k,isMuted:w})=>{const D=P===C.MediaType.MOVIE,L=P===C.MediaType.STREAM,{videoRef:j}=(0,g.useMovieStream)(null==b?void 0:b.data),[B,U]=(0,o.useState)(!1),{isShowControls:H,handleMouseLeave:F,handleMouseMove:V,handleMouseOver:G,handleShowControls:W}=(0,h.useContainerControlsVisibility)(),$=(0,A.useIsSharedMovieOwner)(),z=(0,o.useCallback)((()=>{v&&(H||(W(),M()),x?null==I||I(T):null==y||y(T))}),[I,y,x,H,W,M,T,v]),Z=(0,o.useCallback)((()=>{null==N||N(T)}),[N,T]),K=e=>{var t;"body"===(null==e||null==(t=e.target)?void 0:t.localName)&&"Space"===e.code&&v&&z()};(0,o.useEffect)((()=>(window.addEventListener("keydown",K),()=>window.removeEventListener("keydown",K))),[v,y,I,x]),(0,o.useEffect)((()=>{!O&&$&&Z()}),[$,O,Z]);const Q=(0,m.classNames)("CallsMoviePlayer__playPauseMain","CallsMoviePlayer__opacity"),Y=L?100:t,q=L?100:a;return(0,n.jsxs)("div",{className:(0,m.classNames)("CallsMoviePlayer",{"CallsMoviePlayer--rewindNow":B,"CallsMoviePlayer--editable":v,"CallsMoviePlayer__show-controls":H||B}),onMouseOver:G,onMouseLeave:F,onMouseMove:V,children:[(0,n.jsx)("video",{ref:j,className:"CallsMoviePlayer__video",controls:!1,crossOrigin:"anonymous",playsInline:!0,muted:!0,onClick:z}),x&&v&&(0,n.jsx)(u.default,{className:Q,onClick:z}),!x&&v&&(0,n.jsx)(p.default,{className:Q,onClick:z}),(0,n.jsx)("div",{className:(0,m.classNames)("CallsMoviePlayer__title","CallsMoviePlayer__opacity"),children:e}),(0,n.jsxs)("div",{className:(0,m.classNames)("CallsMoviePlayer__controls","CallsMoviePlayer__opacity"),children:[!!x&&!!v&&(0,n.jsx)(l.Icon24Pause,{className:(0,m.classNames)("CallsMoviePlayer__playPause"),onClick:z}),!x&&!!v&&(0,n.jsx)(c.Icon24Play,{className:(0,m.classNames)("CallsMoviePlayer__playPause"),onClick:z}),L&&(0,n.jsx)(_.default,{}),(0,n.jsx)(r.PlayTimeProgress,{current:Y,isEditable:v,onRewind:f,vkMovieId:T,total:q,isLive:L,isRewindButtonPushed:B,setIsRewindButtonPushed:U,isPlayed:Boolean(x)}),D&&(0,n.jsx)(i.PlayTime,{current:Y,total:q}),!!v&&(0,n.jsx)(s.Volume,{onChange:E,value:S,vkMovieId:T,onMute:R,onUnMute:k,isMuted:w})]}),!!v&&(0,n.jsx)(d.Icon20Cancel,{className:(0,m.classNames)("CallsMoviePlayer__closeMovieIcon","CallsMoviePlayer__opacity"),onClick:Z}),(0,n.jsx)("div",{className:(0,m.classNames)({CallsMoviePlayer__overlay:!0,CallsMoviePlayer__opacity:!0})})]})},f=(0,o.memo)(v)},241331:(e,t,a)=>{"use strict";a.d(t,{PlayTime:()=>r});var n=a(785893),o=a(653088),i=a(659397);const r=({current:e,total:t})=>{const a=(0,o.getHours)(e),r=(0,o.getHours)(t),s=(0,o.formatTimeHHMMSS)(e),l=(0,o.formatTimeHHMMSS)(t),c=(0,i.classNames)("CallsMoviePlayerPlayTime__current","CallsMoviePlayerPlayTime__value",{"CallsMoviePlayerPlayTime__value--withHours":!!a}),d=(0,i.classNames)("CallsMoviePlayerPlayTime__total","CallsMoviePlayerPlayTime__value",{"CallsMoviePlayerPlayTime__value--withHours":!!r});return(0,n.jsxs)("div",{className:"CallsMoviePlayerPlayTime",children:[(0,n.jsx)("span",{className:c,children:s})," / ",(0,n.jsx)("span",{className:d,children:l})]})}},224966:(e,t,a)=>{"use strict";a.d(t,{PlayTimeProgress:()=>l});var n=a(785893),o=a(667294),i=a(653088),r=a(736145),s=a(659397);const l=({current:e,total:t,onRewind:a,isEditable:l,className:c,vkMovieId:d,isLive:u,isRewindButtonPushed:p,setIsRewindButtonPushed:_,isPlayed:m})=>{const[h,g]=(0,o.useState)(e),[A,C]=(0,o.useState)(!1),v=(0,o.useRef)(null),[f,S]=(0,o.useState)(0),[E,T]=(0,o.useState)(""),I=(0,o.useCallback)((e=>Math.round(t*e/100)),[t]),y=(0,o.useCallback)(((e,t)=>Promise.resolve(null==a?void 0:a(e,t))),[a,d]),N=(0,o.useCallback)((e=>{const{left:t,width:a}=(0,s.getOffsetRect)(v.current),n=e.clientX-t,o=(0,r.valueToPercent)(n,0,a),l=I(o);T((0,i.formatTimeHHMMSS)(l)),S(o)}),[I]);(0,o.useEffect)((()=>{var e;if(!u)return null==(e=v.current)||e.addEventListener("mousemove",N),()=>{var e;null==(e=v.current)||e.removeEventListener("mousemove",N)}}),[N,u]);const b=(0,o.useCallback)((e=>{if(!l)return;const t=e.clientX,{left:a,width:n}=(0,s.getOffsetRect)(v.current);if(t<a||t>a+n||!p)return;const o=(0,r.valueToPercent)(t-a,0,n),i=I(o);g(i)}),[p,I,l]);(0,o.useEffect)((()=>(window.addEventListener("mousemove",b),()=>{window.removeEventListener("mousemove",b)})),[b]);const x=(0,o.useCallback)((e=>{if(!l)return;e.target.classList.contains("CallsMoviePlayerPlayTimeProgress__button")&&_(!0)}),[_,l]);(0,o.useEffect)((()=>(window.addEventListener("mousedown",x),()=>{window.removeEventListener("mousedown",x)})),[x]);const M=(0,o.useCallback)((()=>{l?p&&y(d,h).finally((()=>{_(!1)})):p&&_(!1)}),[p,d,h,y,l]);(0,o.useEffect)((()=>(window.addEventListener("mouseup",M),()=>{window.removeEventListener("mouseup",M)})),[M]),(0,o.useLayoutEffect)((()=>{g((t=>A||p||!m?t:e))}),[e,p,A,m]),(0,o.useLayoutEffect)((()=>{m||0!==e||g(e)}),[m,e]);const O={width:u?"100%":100*h/t+"%",transition:A||p||h===t||0===h?"none":"width 1s ease-out"},P={left:`${f}%`},R=(0,s.classNames)("CallsMoviePlayerPlayTimeProgress",{"CallsMoviePlayerPlayTimeProgress--live":u},c),k=(0,s.classNames)("CallsMoviePlayerPlayTimeProgress__progress",{"CallsMoviePlayerPlayTimeProgress__progress--live":u}),w=(0,s.classNames)("CallsMoviePlayerPlayTimeProgress__button",{"CallsMoviePlayerPlayTimeProgress__button--visible":p});return(0,n.jsxs)("div",{className:R,ref:v,onClick:()=>{if(!a||!l||u||p)return;const e=I(f);g(e),C(!0),y(d,e).finally((()=>{C(!1)}))},children:[(0,n.jsx)("div",{className:k,style:O,children:(0,n.jsx)("div",{className:w})}),(0,n.jsx)("div",{className:"CallsMoviePlayerPlayTimeProgress__hint",style:P,children:E})]})}},548029:(e,t,a)=>{"use strict";a.d(t,{RemoveMovieModal:()=>l});var n=a(785893),o=a(667294),i=a(513885),r=a(589897),s=a(346880);const l=({onClose:e,onRemoveMovie:t})=>{const{getLang:a}=(0,o.useContext)(s.LangContext);return(0,n.jsx)(i.default,{onClose:e,title:a("calls_remove_movie_modal_title"),className:"CallsMoviePlayer__removeModal",actionButtons:[(0,n.jsx)(r.default,{onClick:e,size:"m",mode:"secondary",children:a("calls_cancel")},"cancel"),(0,n.jsx)(r.default,{onClick:t,mode:"primary",size:"m",children:a("calls_remove_movie_modal_title")},"confirm")],children:(0,n.jsx)("div",{className:"CallsMoviePlayer__removeModalContent",children:a("calls_remove_movie_modal_content")})})}},345395:(e,t,a)=>{"use strict";a.d(t,{Volume:()=>_});var n=a(785893),o=a(667294),i=a(181702),r=a(752654),s=a(151582),l=a(659397),c=a(638646),d=a(837476),u=a(346880),p=a(736145);const _=({onChange:e,value:t=0,className:a,vkMovieId:_,isMuted:m,onMute:h,onUnMute:g})=>{const{getLang:A}=(0,o.useContext)(u.LangContext),C=(0,s.useIsMounted)(),[v,f]=(0,o.useState)((()=>(0,l.isNumber)(t)?t:1)),[S,E]=(0,o.useState)(!1),T=(0,o.useRef)(null),I=(0,o.useRef)(v),y=(0,o.useCallback)((e=>{E(!0),f(e/100)}),[]);(0,o.useEffect)((()=>{(0,l.isNumber)(t)&&(f(t),I.current=t)}),[t]),(0,o.useEffect)((()=>(e&&(T.current=setTimeout((()=>{C()&&v!==I.current&&Promise.resolve(null==e?void 0:e(_,v,m)).finally((()=>{E(!1)}))}),300)),()=>{T.current&&clearTimeout(T.current)})),[v,e,m]);const N=(0,o.useCallback)((()=>{!m&&t?h(_,t):g(_,t||.1)}),[m,h,g,_,t]),b=A(v?"calls_movie_player_sound_off":"calls_movie_player_sound_on"),x=m&&!S?0:100*v;return(0,n.jsxs)("div",{className:(0,l.classNames)("CallsMovieVolumeSlider",a),children:[(0,n.jsx)(r.default,{appearance:"dark",text:b,position:"t",marginTop:-5,children:(0,n.jsx)("div",{className:"CallsMovieVolumeSlider__icon",onClick:N,children:x?(0,n.jsx)(d.Icon24Volume,{}):(0,n.jsx)(c.Icon24Mute,{})})}),(0,n.jsx)(i.default,{min:0,max:100,onChange:y,value:x,formatHint:p.shortPercentFormat,appearance:"white",hintClass:"CallsMovieVolumeSlider__sliderHint"})]})}},808474:(e,t,a)=>{"use strict";a.d(t,{useMovieShareActions:()=>l});var n=a(667294),o=a(464380),i=a(302617),r=a(22412),s=a(205805);const l=({movieAddCallback:e,movieRemoveCallback:t,moviePauseCallback:a,moviePlayCallback:l,movieRewindCallback:c,movieSoundChangeCallback:d}={})=>{const u=(0,s.useCallsSDK)(),{sendStatsData:p}=(0,i.useSendStatsData)(),_=(0,n.useCallback)((e=>u.updateMovie({movieId:e,pause:!0}).then((()=>{null==a||a()})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))),[a]),m=(0,n.useCallback)((t=>{if(t.ov_id){const a={movieId:Number(t.ov_id),metadata:{title:t.title,thumbnails:t.image},gain:.5};return u.addMovie(a).then((()=>{null==e||e(),p(r.CallActionEventType.CALL_WATCH_TOGETHER_STARTED,{vid:t.ov_id})})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))}}),[e,p]),h=(0,n.useCallback)((e=>u.updateMovie({movieId:e,pause:!1}).then((()=>{null==l||l()})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))),[l]),g=(0,n.useCallback)(((e,t)=>u.updateMovie({movieId:e,offset:t}).then((()=>{null==c||c()})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))),[c]),A=(0,n.useCallback)(((e,t,a=!1)=>{const n={movieId:e,gain:t};return a&&(n.mute=!1),u.updateMovie(n).then((()=>{null==d||d()})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))}),[d]),C=(0,n.useCallback)(((e,t)=>u.updateMovie({movieId:e,gain:t,mute:!0}).then((()=>{null==d||d()})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))),[]),v=(0,n.useCallback)(((e,t)=>{const a={movieId:e,mute:!1};return t&&(a.gain=t),u.updateMovie(a).then((()=>{null==d||d()})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))}),[]);return{handleAddMovie:m,handleMoviePause:_,handleMoviePlay:h,handleMovieRewind:g,handleMovieSoundChange:A,handleRemoveMovie:(0,n.useCallback)((e=>u.removeMovie(e).then((()=>{null==t||t(),p(r.CallActionEventType.CALL_WATCH_TOGETHER_STOPPED,{vid:String(e)})})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)}))),[t,p]),handleMovieMute:C,handleMovieUnMute:v}}},399894:(e,t,a)=>{"use strict";a.d(t,{useMovieStream:()=>i});var n=a(667294),o=a(464380);const i=e=>{const t=(0,n.useRef)(null);return(0,n.useEffect)((()=>{t.current&&((()=>{var e;if(!t.current)return;const a=null==(e=t.current)?void 0:e.srcObject;a&&(a.getTracks().forEach((e=>e.stop())),t.current.srcObject=null)})(),t.current.srcObject=e||null,t.current.play().catch((t=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,{error:t,stream:e})})))}),[e]),{videoRef:t}}},653088:(e,t,a)=>{"use strict";a.d(t,{formatTimeHHMMSS:()=>i,getHours:()=>o});const n=new Intl.NumberFormat("ru-RU",{minimumIntegerDigits:2}),o=e=>Math.floor(e/60/60),i=e=>{const t=o(e),a=Math.floor((e-60*t*60)/60),i=e-60*a-60*t*60;return`${t?`${n.format(t)}:`:""}${n.format(a)}:${n.format(i)}`}},733222:(e,t,a)=>{"use strict";a.d(t,{MuteParticipantModal:()=>i});var n=a(785893),o=a(513885);const i=({title:e,description:t,onClose:a,actionButtons:i})=>(0,n.jsx)(o.default,{className:"MuteParticipantModal",appearance:"blue",title:e,actionButtons:i,onClose:a,children:t&&(0,n.jsx)("div",{className:"MuteParticipantModal__content",children:t})})},448383:(e,t,a)=>{"use strict";a.d(t,{NextPageTrigger:()=>i});var n=a(785893),o=a(667294);const i=({onNextPage:e})=>{const t=(0,o.useRef)(null),a=(0,o.useRef)(null),i=(0,o.useRef)(!1),r=(0,o.useRef)();return(0,o.useEffect)((()=>()=>{var e;return null==(e=r.current)?void 0:e.abort()}),[]),a.current||(a.current=new IntersectionObserver((t=>{for(const a of t)a.isIntersecting&&!i.current&&(i.current=!0,(r.current=new AbortController,e(r.current.signal)).finally((()=>{i.current=!1})))}),{threshold:1})),(0,o.useEffect)((()=>(a.current&&t.current&&a.current.observe(t.current),()=>{var e;null==(e=a.current)||e.disconnect()})),[]),(0,n.jsx)("div",{className:"CallsNextPageTrigger",ref:t})}},700110:(e,t,a)=>{"use strict";a.d(t,{NotificationDesktopApp:()=>g});var n=a(785893),o=a(291100),i=a(571150),r=a(480538),s=a(107359),l=a(265477),c=a(915961),d=a(899426),u=a(22412),p=a(274706),_=a(667294),m=a(796317),h=a(86894);const g=({onClose:e,isSferum:t})=>{const{getLang:a}=(0,c.useLang)(),{enableSferumNewLinks:g}=(0,_.useContext)(m.ConfigContext),A=(0,d.getPlatformUrl)(t,g),C=p.Platform.OS===p.OS.MAC?"macOS":p.Platform.OS===p.OS.WINDOWS?"Windows":null,v=C?a("calls_notification_native_app_button_for").replace("{name}",C):a("calls_notification_native_app_button");return(0,n.jsxs)("div",{className:"NotificationDesktopApp",children:[(0,n.jsx)(o.Icon12CancelOutline,{className:"NotificationDesktopApp--close",onClick:e,width:16,height:16}),!!t&&g&&(0,n.jsx)(r.default,{width:56,height:56,className:"NotificationDesktopApp--icon"}),!!t&&!g&&(0,n.jsx)(s.default,{className:"NotificationDesktopApp--icon"}),!t&&(0,n.jsx)(l.default,{className:"NotificationDesktopApp--icon",width:56,height:56}),(0,n.jsx)("span",{className:"NotificationDesktopApp--text",children:a("calls_notification_native_app_text")}),null!==C&&(0,n.jsxs)(h.Link,{onClick:()=>{A&&(0,d.download)(A.url,A.filename),e()},className:"NotificationDesktopApp--button",children:[v," ",(0,n.jsx)(i.Icon12Chevron,{className:"NotificationDesktopApp--angleIcon"})]}),null===C&&(0,n.jsxs)("a",{href:u.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"NotificationDesktopApp--button",children:[v," ",(0,n.jsx)(i.Icon12Chevron,{className:"NotificationDesktopApp--angleIcon"})]})]})}},531878:(e,t,a)=>{"use strict";a.d(t,{NotificationWithButton:()=>i});var n=a(785893),o=a(659397);const i=({children:e,className:t})=>{const a=(0,o.classNames)("NotificationWithButton",t);return(0,n.jsx)("div",{className:a,children:e})}},726412:(e,t,a)=>{"use strict";a.d(t,{OnHangupModal:()=>r});var n=a(785893),o=a(513885),i=a(589897);const r=({onClose:e,title:t,description:a,btnText:r})=>(0,n.jsx)(o.default,{className:"OnHangupModal",onClose:e,title:t,appearance:"blue",actionButtons:(0,n.jsx)(i.default,{mode:"primary",size:"m",onClick:e,children:r}),children:(0,n.jsx)("div",{className:"OnHangupModal__description",children:a})})},319246:(e,t,a)=>{"use strict";a.d(t,{OneToOne:()=>u});var n=a(785893),o=a(659397),i=a(37240),r=a(490287),s=a(915961),l=a(496111),c=a(464380),d=a(227336);const u=()=>{var e,t,a,u,p,_;const{getLang:m}=(0,s.useLang)(),{externalId:h,localDevice:g,meParticipant:A,peerDevice:C,peerParticipant:v,isServerTopology:f}=(0,r.useTypedSelector)((e=>{const{localDevice:t,externalId:a,me:n,peer:o,devices:i,participants:r,callData:s}=e;return{localDevice:t,peerDevice:(0,l.getPeerIdDeviceInfo)(o,i),meParticipant:a&&r[n],peerParticipant:r[o],externalId:a,isServerTopology:(null==s?void 0:s.topology)===c.TransportTopology.SERVER}})),S=(0,l.isParticipantWithVideo)(g)||(0,l.isParticipantWithMovie)(g),E=!(!C||!(0,l.isParticipantWithVideo)(C)&&!(0,l.isParticipantWithMovie)(C));(0,d.useVisibleDeviceScreenShareNotVisibleStat)(C);const T=(0,o.classNames)("OneToOne",{"OneToOne--hasVideo":S,"OneToOne--opponentHasVideo":E});return(0,n.jsxs)("div",{className:T,children:[(0,n.jsx)("aside",{className:"OneToOne__local",children:h&&A&&(0,n.jsx)(i.Participant,{externalId:h,hasVideo:S,hasAudio:!!(null==(e=g.mediaSettings)?void 0:e.isAudioEnabled),isSharingScreen:!!(null==(t=g.mediaSettings)?void 0:t.isScreenSharingEnabled),streamData:(0,l.getStream)(g),isMe:!0,name:m("calls_own_label"),letter:null==A?void 0:A.name.slice(0,1),wasConnected:g.wasConnected,allowContain:!0,networkStatus:g.networkStatus,isNFT:null==A?void 0:A.is_nft,isVmoji:!!(null==(a=g.mediaSettings)?void 0:a.isAnimojiEnabled)})}),(0,n.jsx)("main",{className:"OneToOne__remote",children:v&&C&&(0,n.jsx)(i.Participant,{externalId:C.externalId,hasVideo:E,hasAudio:!!(null==(u=C.mediaSettings)?void 0:u.isAudioEnabled),isSharingScreen:!!(null==(p=C.mediaSettings)?void 0:p.isScreenSharingEnabled),streamData:(0,l.getStream)(C,{animojiBackendRender:f}),photo:v.photo,name:v.name,allowContain:!0,wasConnected:C.wasConnected,networkStatus:C.networkStatus,isNFT:v.is_nft,isVmoji:!!(null==(_=C.mediaSettings)?void 0:_.isAnimojiEnabled)})})]})}},808714:(e,t,a)=>{"use strict";a.d(t,{OratorTitle:()=>_});var n=a(785893),o=a(667294),i=a(937026),r=a(346880),s=a(495820),l=a(742783),c=a(355268),d=a(759930),u=a(788822),p=a(455319);const _=(0,o.memo)((function({orator:e,me:t,isPinned:a,isPinnedByAdmin:_,isPinnedByShareScreen:m,isUnpinAllowed:h,onTooltipChange:g,onUnpin:A,tooltips:C,oratorDevice:v,meGroup:f}){var S,E;const{getLang:T}=(0,o.useContext)(r.LangContext),I=_||m||a,y=(0,o.useCallback)((()=>{g("oratorPin",!1),A()}),[A]),N=(0,o.useCallback)((()=>g("oratorPin",!0)),[]),b=(0,o.useCallback)((()=>g("oratorPin",!1)),[]),x=(v.wasConnected||e.peerId===t)&&!(null==(S=v.mediaSettings)?void 0:S.isAudioEnabled),M=null==(E=v.mediaSettings)?void 0:E.isScreenSharingEnabled,O=f||e||{},P=(0,p.getUserName)(O),R=O.customName||O.shortNameGen||O.name||O.shortName||"",k=(v.networkStatus||1)<.6,w=(0,n.jsxs)(n.Fragment,{children:[_&&(0,n.jsx)(s.Icon16PinDot,{}),!_&&(m||a)&&(0,n.jsx)(l.Icon16Pin,{}),k&&(0,n.jsx)(c.Icon16Connection,{fill:(v.networkStatus||1)<=.3?"#ff5c5c":"#FECE00"}),M&&(0,n.jsx)("span",{children:T("calls_orator_screen_sharing")}),(0,n.jsx)("span",{className:"OratorTitle__name",children:(0,u.decodeHTMLEntities)(M?R:P)}),x&&(0,n.jsx)(d.Icon16MicrophoneSlash,{})]});return I?(0,n.jsx)(i.TooltipNew,{position:"b",align:"center",content:T(_&&h?"calls_hint_admin_pin_for_admin":_?"calls_hint_admin_pin_for_user":"calls_hint_user_pin"),open:C.oratorPin,delay:300,onOpen:N,onClose:b,children:(0,n.jsx)("button",{className:"OratorTitle OratorTitle--button",onClick:y,disabled:!h,children:w})}):(0,n.jsx)("div",{className:"OratorTitle",children:w})}))},135504:(e,t,a)=>{"use strict";a.d(t,{OutlinedButton:()=>l});var n=a(434788),o=a(820224),i=a(785893),r=a(86894),s=a(659397);const l=e=>{var{children:t,className:a,size:l="m"}=e,c=(0,o._)(e,["children","className","size"]);return(0,i.jsx)(r.Button,(0,n._)({className:(0,s.classNames)("OutlinedButton",a),size:l},c,{children:t}))}},844366:(e,t,a)=>{"use strict";a.d(t,{PageBlockShowMore:()=>r});var n=a(785893),o=a(659397),i=a(700200);const r=({text:e,href:t,className:a,onClick:r,rightIcon:s})=>{const l=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"PageBlockShowMore__text",children:e}),s&&(0,n.jsx)("div",{className:"PageBlockShowMore__icon",children:s})]});return t?(0,n.jsx)(i.default,{href:t,className:(0,o.classNames)("PageBlockShowMore",a),onClick:r,children:l}):(0,n.jsx)("div",{className:(0,o.classNames)("PageBlockShowMore",a),onClick:r,children:l})}},37240:(e,t,a)=>{"use strict";a.d(t,{Participant:()=>I,ParticipantWithIndicator:()=>y});var n=a(434788),o=a(785893),i=a(667294),r=a(230823),s=a(543083),l=a(659397),c=a(346880),d=a(796317),u=a(496111),p=a(879849),_=a(464380),m=a(759930),h=a(607990),g=a(355268),A=a(417174),C=a(266247),v=a(490287),f=a(721981),S=a(708792),E=a(687741),T=a(788822);const I=(0,i.memo)((({externalId:e,isVisible:t=!0,isOrator:a=!1,isInfoShown:n,isPinned:v,isPinnedByAdmin:S,isHandRaised:I,photo:y,hasVideo:N,hasAudio:b,isSharingScreen:x,isSpeaking:M=!1,streamData:O,isMe:P=!1,name:R="",letter:k,status:w=_.ParticipantStatus.CONNECTED,wasConnected:D=!0,networkStatus:L=1,onClickParticipant:j,onDblClickParticipant:B,onStopScreenShare:U,allowContain:H,actions:F,availableStreamModes:V,className:G,reaction:W,reactions:$,isNFT:z,isVmoji:Z,isMiniApp:K=!1})=>{const{getLang:Q}=(0,i.useContext)(c.LangContext),{anonymPhoto:Y}=(0,i.useContext)(d.ConfigContext),q=(0,i.useRef)(null),J=(0,u.isParticipantAnonym)(e),{storedVideoOptions:X}=(0,C.useVideoOptions)(),ee=(0,u.externalIdToString)(e),te=!!j||!!B,ae=a&&x&&P,ne=N&&(!ae||(null==O?void 0:O.type)===_.MediaType.CAMERA),oe=O&&O.data&&(ne||(null==O?void 0:O.type)===_.MediaType.MOVIE||(null==O?void 0:O.type)===_.MediaType.STREAM),ie=(0,l.classNames)("Participant","Participant--withAnimation",{"Participant--isInteractive":te,"Participant--isPinned":v,"Participant--isSpeaking":M,"Participant--isOrator":a},G),re=(0,i.useCallback)((t=>{j&&j(t,e)}),[j]),se=(0,i.useCallback)((t=>{B&&B(t,e)}),[B]),le=(0,l.classNames)({Participant__offsetCard:n,Participant__oratorPhoto:a,"Participant__oratorPhoto--nft":z}),ce=(0,l.classNames)("Participant__status",{"Participant__status--miniApp":K,"Participant__status--miniAppNft":K&&z}),de=(0,l.classNames)("Participant__main",{"Participant__main--video":!a}),ue=null==V?void 0:V.filter((e=>e!==_.MediaType.CAMERA)),pe=L<.6;return(0,o.jsxs)("div",{className:"Participant__wrapper",children:[(0,o.jsxs)("article",{ref:q,className:ie,onClick:re,onDoubleClick:se,"participant-id":ee,children:[!t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.BlurredBackground,{id:+e.id,className:"Participant__main",children:(0,o.jsx)(A.CallPhoto,{id:+e.id,photo:!Y&&J?"":y,alt:R||"",letter:k,className:le,isOrator:a,isNFT:z})}),n&&(0,o.jsxs)("footer",{className:"Participant__footer",children:[(0,o.jsx)("span",{className:"Participant__name",children:(0,T.decodeHTMLEntities)(R)}),(D||P)&&!b&&(0,o.jsx)(m.Icon16MicrophoneSlash,{width:16,height:16,className:"Participant__statusIcon--mic"})]})]}),t&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(r.BlurredBackground,{id:+e.id,className:"Participant__main",children:(0,o.jsx)(A.CallPhoto,{id:+e.id,photo:!Y&&J?"":y,alt:R||"",className:le,isOrator:a,isNFT:z,isMiniApp:K})}),ae&&(null==O?void 0:O.type)===_.MediaType.SCREEN&&(0,o.jsxs)("div",{className:"Participant__screenSharer",children:[(0,o.jsx)(h.Icon56ArrowUpRectangleOutline,{}),(0,o.jsx)("div",{className:"Participant__screenSharerText",children:Q("calls_you_are_screen_sharer")}),(0,o.jsx)("button",{className:"Participant__screenSharerButton",onClick:U,children:Q("calls_screen_share_stop")})]}),O&&O.data&&oe&&(0,o.jsx)(s.Video,{className:de,participantId:ee,stream:O.data,isMirrored:P&&!Z&&O.type===_.MediaType.CAMERA&&X[C.EVideoOptionType.IS_VIDEO_MIRRORED],isContained:H||x,isStartWithVisible:P,isLocalSchreenShare:P&&x}),w!==_.ParticipantStatus.CONNECTED&&!P&&(0,o.jsx)("div",{className:ce,children:(0,o.jsx)(p.default,{isInverted:!0})}),Boolean(!a&&n||K)&&(0,o.jsxs)("footer",{className:"Participant__footer",children:[(0,o.jsx)("div",{className:(0,l.classNames)("Participant__indicators","Participant__indicators--footer"),children:null==ue?void 0:ue.map((e=>(0,o.jsx)("div",{className:(0,l.classNames)("Participant__indicator","Participant__indicator--stream-mode"),children:(0,E.getStreamModeIcon)(e)},e)))}),pe&&(0,o.jsx)(g.Icon16Connection,{fill:L<=.3?"#ff5c5c":"#FECE00"}),(0,o.jsx)("span",{className:(0,l.classNames)("Participant__name",{"Participant__name--stream-modes":!!(null==ue?void 0:ue.length),"Participant__name--bad-network":pe}),children:(0,T.decodeHTMLEntities)(R)}),(D||P)&&!b&&(0,o.jsx)(m.Icon16MicrophoneSlash,{className:"Participant__statusIcon--mic"})]})]})]}),(0,o.jsx)(f.ParticipantHeader,{isPinnedByAdmin:S,isPinned:v,isVisible:t,actions:F,isHandRaised:I,reaction:W,reactions:$})]})})),y=(0,i.memo)((function(e){const t=(0,u.externalIdToString)(e.externalId),a=(0,v.useTypedSelector)((0,i.useCallback)((e=>{var a;return null==(a=e.speakers)?void 0:a[t]}),[t])),r=e.hasAudio&&a&&e.isVisible,s=(0,S.useParticipantReaction)(t,e.isMe),l=(0,v.useTypedSelector)((e=>{var t;return null==(t=e.reactions)?void 0:t.reactions})),c=(0,v.useTypedSelector)((t=>{var a;return!!(null==(a=t.participants[e.externalId.id])?void 0:a.is_nft)}));return(0,o.jsx)(I,(0,n._)({},e,{isSpeaking:r,reaction:s,reactions:l,isNFT:c}))}));I.displayName="Participant"},708792:(e,t,a)=>{"use strict";a.d(t,{useParticipantReaction:()=>s});var n=a(667294),o=a(490287),i=a(22412),r=a(878198);function s(e,t){const a=(0,o.useTypedSelector)((a=>{var n;return t?a.localDevice.lastChosenReaction:null==(n=a.devices[e])?void 0:n.reaction})),[s,l]=(0,n.useState)();return(0,n.useEffect)((()=>{const e=Date.now()-((null==a?void 0:a.ts)||0);if(a&&!(e>i.REACTION_FADE_OUT_DELAY))return l(a),(0,r.createTimeout)(l,i.REACTION_FADE_OUT_DELAY-e)}),[a]),s}},721981:(e,t,a)=>{"use strict";a.d(t,{ParticipantHeader:()=>_,default:()=>m});var n=a(785893),o=a(836326),i=a(667294),r=a(346880),s=a(911099),l=a(495820),c=a(742783),d=a(17784),u=a(900798);const p=[{name:"preventOverflow",options:{mainAxis:!0,padding:10}}],_=({isPinned:e,isPinnedByAdmin:t,isVisible:a,actions:_,isHandRaised:m,reaction:h,reactions:g})=>{const{getLang:A}=(0,i.useContext)(r.LangContext),[C,v]=(0,i.useState)(!1),f=(0,s.classNames)("Participant__more","Participant__more--withAnimation"),S=e||t,E=!!(null==_?void 0:_.length);return a?(0,n.jsxs)("header",{className:"Participant__header",children:[(0,n.jsxs)("div",{className:"Participant__indicators",children:[m&&(0,n.jsx)("div",{className:(0,s.classNames)("Participant__indicator","Participant__indicator--hand"),children:(0,n.jsx)(d.Icon24Privacy,{})}),!(!h||!g)&&(0,n.jsx)("div",{className:(0,s.classNames)("Participant__indicator","Participant__indicator--reaction"),children:(0,n.jsx)("img",{className:"Participant__indicator--reaction__pic",src:g[24][h.key],srcSet:`${g[48][h.key]} 1.5x`,alt:h.key})})]}),S&&(t?(0,n.jsx)(l.Icon16PinDot,{className:"Participant__pin"}):(0,n.jsx)(c.Icon16Pin,{className:"Participant__pin"})),E&&(0,n.jsx)(o.CallsDropdown,{className:"Participant__Dropdown",items:_,open:C,setOpen:v,placement:"auto",customModifiers:p,children:(0,n.jsx)("button",{className:f,"aria-label":A("calls_actions"),children:(0,n.jsx)(u.Icon16MoreVertical,{})})})]}):null},m=_},219239:(e,t,a)=>{"use strict";a.d(t,{ParticipantIconButton:()=>c});var n=a(785893),o=a(667294),i=a(687054),r=a(189554),s=a(659397),l=a(327331);const c=(0,o.forwardRef)((function({participantCount:e,onClick:t,ariaLabel:a},o){let c=(0,n.jsx)(l.Icon24Users,{}),d="",u=a;return e&&(d=e>99?"99+":null==e?void 0:e.toString(),d&&(c=(0,n.jsxs)("div",{className:"ParticipantIconButton",children:[(0,n.jsx)("div",{className:(0,s.classNames)({ParticipantIconButton__count:!0,"ParticipantIconButton__count--lt10":e<10}),children:d}),(0,n.jsx)(r.default,{})]}),u=`${u} ${d}`)),(0,n.jsx)(i.CallIconButton,{"aria-label":u,icon:c,onClick:t,ref:o})}))},952815:(e,t,a)=>{"use strict";a.d(t,{ParticipantIndicators:()=>p});var n=a(785893),o=a(667294),i=a(659397),r=a(752654),s=a(879849),l=a(888235),c=a(759930),d=a(574254),u=a(346880);const p=({showSpeaking:e,showAudioDisabled:t,showRaisedHand:a,showConnecting:p,showRaisedHandTooltip:_,onRaisedHandClick:m})=>{const{getLang:h}=(0,o.useContext)(u.LangContext),g=(0,n.jsx)("span",{className:(0,i.classNames)("ParticipantIndicators__item",{"ParticipantIndicators__item--interactive":void 0!==m}),onClick:null!=m?m:void 0,children:(0,n.jsx)(l.Icon16Hand,{className:"ParticipantIndicators__hand"})});return(0,n.jsxs)("span",{className:"ParticipantIndicators",children:[e&&(0,n.jsx)("span",{className:"ParticipantIndicators__item",children:(0,n.jsx)(d.VolumeMeterAnimation,{})}),t&&(0,n.jsx)("span",{className:"ParticipantIndicators__item",children:(0,n.jsx)(c.Icon16MicrophoneSlash,{className:"ParticipantIndicators__muted"})}),a?_?(0,n.jsx)(r.default,{className:"ParticipantIndicators__tooltip",text:h("calls_participant_menu_enable_media_request"),position:"t",align:"center",appearance:"light",children:g}):g:null,p&&(0,n.jsx)("span",{className:"ParticipantIndicators__item",children:(0,n.jsx)(s.default,{})})]})}},16694:(e,t,a)=>{"use strict";a.d(t,{ParticipantLite:()=>_});var n=a(785893),o=a(667294),i=a(230823),r=a(659397),s=a(796317),l=a(496111),c=a(417174),d=a(721981),u=a(17784),p=a(788822);const _=(0,o.memo)((({externalId:e,isInfoShown:t,isPinned:a,isPinnedByAdmin:_,isHandRaised:m=!1,photo:h,hasAudio:g,isMe:A=!1,name:C="",letter:v,wasConnected:f=!0,onClickParticipant:S,onDblClickParticipant:E})=>{const{anonymPhoto:T}=(0,o.useContext)(s.ConfigContext),I=(0,o.useRef)(null),y=(0,l.isParticipantAnonym)(e),N=(0,r.classNames)("Participant","Participant--withAnimation",{"Participant--isPinned":a}),b=(0,l.externalIdToString)(e),x=(0,o.useCallback)((t=>{S&&S(t,e)}),[S,e]),M=(0,o.useCallback)((t=>{E&&E(t,e)}),[E,e]);return(0,n.jsxs)("article",{ref:I,className:N,onClick:x,onDoubleClick:M,"participant-id":b,children:[(0,n.jsx)(i.BlurredBackground,{id:+e.id,className:"Participant__main",children:(0,n.jsx)(c.CallPhoto,{id:+e.id,photo:!T&&y?"":h,alt:C||"",letter:v,className:t?"Participant__offsetCard":""})}),(0,n.jsx)(d.default,{isPinnedByAdmin:_,isPinned:a}),m&&(0,n.jsx)("div",{className:(0,r.classNames)("Participant__indicators","Participant__indicators--lite"),children:(0,n.jsx)("div",{className:(0,r.classNames)("Participant__indicator","Participant__indicator--hand"),children:(0,n.jsx)(u.Icon24Privacy,{})})}),t&&(0,n.jsxs)("footer",{className:"Participant__footer",children:[(0,n.jsx)("span",{className:"Participant__name",children:(0,p.decodeHTMLEntities)(C)}),(f||A)&&!g&&(0,n.jsx)("span",{className:"Participant__statusIcon Participant__statusIcon--mic"})]})]})}));_.displayName="ParticipantLite"},447664:(e,t,a)=>{"use strict";a.d(t,{ParticipantMenu:()=>c});var n=a(434788),o=a(785893),i=a(667294),r=a(901074),s=a(816328),l=a(105086);const c=({position:e,align:t,trigger:a,marginTop:c,marginLeft:d,actions:u})=>{const p=(0,i.useMemo)((()=>u.map((e=>(0,n._)({},e,{text:(0,o.jsx)(l.DropdownItem,{item:e}),onClick:void 0})))),[u]);return u.length>0?(0,o.jsx)(s.default,{position:e,align:t,trigger:a,marginTop:c,marginLeft:d,className:"ParticipantMenu__dropdown",data:p,children:(0,o.jsx)(r.ListActionsControl,{})}):(0,o.jsx)(o.Fragment,{})}},611802:(e,t,a)=>{"use strict";a.d(t,{ParticipantSuggest:()=>d});var n=a(785893),o=a(479720),i=a(659397),r=a(856335),s=a(29157),l=a(417174),c=a(878198);function d({member:e,selected:t=!1,disabled:a=!1}){const d=(0,i.classNames)("ParticipantSuggest",{"ParticipantSuggest--selected":t,"ParticipantSuggest--disabled":a}),u=t?r.Icon20CheckCircleOn:s.Icon20CheckCircleOff,p=!!e.is_nft;return(0,n.jsxs)("div",{className:d,"data-id":e.id,children:[(0,n.jsx)(o.default,{className:(0,i.classNames)("ParticipantSuggest__entity",{"ParticipantSuggest__entity--nft":p}),size:"34",title:e.name,photo:(0,n.jsx)(l.CallPhoto,{id:e.id,className:(0,c.vou)(p,"ParticipantSuggest__entity__photo--nft"),photo:e.photo,alt:e.name,size:p?32:"34",isNFT:p})}),(0,n.jsx)(u,{className:"ParticipantSuggest__checkIcon"})]})}},247053:(e,t,a)=>{"use strict";a.d(t,{RoomChooseModal:()=>c});var n=a(785893),o=a(667294),i=a(513885),r=a(121644),s=a(346880),l=a(86894);const c=({title:e,children:t})=>{const{getLang:a}=(0,o.useContext)(s.LangContext),{onClose:c}=(0,r.useClosePopup)();return(0,n.jsx)(i.default,{className:"RoomChooseModal",onClose:c,title:e,appearance:"blue",hasScroll:!1,actionButtons:(0,n.jsx)(l.Button,{onClick:c,mode:"tertiary",children:a("calls_cancel")}),children:t})}},141119:(e,t,a)=>{"use strict";a.d(t,{RoomControlCreateModal:()=>l});var n=a(785893),o=a(86894),i=a(915961),r=a(513885),s=a(869048);const l=({onClose:e,onSubmit:t,roomCount:a,assignRandomly:l,assignRandomlyByCount:c,onRoomCountChange:d,onAssignRandomlyChange:u})=>{const{getLang:p,langReplace:_}=(0,i.useLang)();return(0,n.jsx)(r.default,{className:"RoomControlCreateModal",appearance:"blue",title:p("calls_room_control_create_title"),actionButtons:(0,n.jsxs)(s.AppRootProvider,{children:[(0,n.jsx)(o.Button,{onClick:e,mode:"tertiary",children:p("calls_room_control_create_cancel")}),(0,n.jsx)(o.Button,{onClick:t,children:p("calls_room_control_create_continue")})]}),onClose:e,children:(0,n.jsx)("div",{className:"RoomControlCreateModal__content",children:(0,n.jsxs)(s.AppRootProvider,{children:[(0,n.jsx)(o.Header,{aside:(0,n.jsx)(o.Input,{type:"number",className:"RoomControlCreateModal__room-count",id:"RoomControlCreateModal__room-count",value:a,onChange:e=>d(+e.target.value)}),children:(0,n.jsx)("label",{htmlFor:"RoomControlCreateModal__room-count",children:p("calls_room_control_create_count_title")})}),(0,n.jsx)(o.Spacing,{className:"RoomControlCreateModal__spacing",children:(0,n.jsx)(o.Separator,{})}),(0,n.jsx)("label",{htmlFor:"RoomControlCreateModal__auto-divide",children:(0,n.jsx)(o.Header,{className:"RoomControlCreateModal__auto-divide-wrapper",aside:(0,n.jsx)(o.Switch,{checked:l,onChange:u,id:"RoomControlCreateModal__auto-divide"}),subtitle:(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:l?_(p("calls_room_control_create_auto_divide_counter",c),{count:(null!=c?c:0).toString()}):p("calls_room_control_create_auto_divide_desc")}}),children:p("calls_room_control_create_auto_divide_title")})})]})})})}},370322:(e,t,a)=>{"use strict";a.d(t,{RoomControlLeftBlock:()=>C});var n=a(785893),o=a(86894),i=a(915961),r=a(376499),s=a(892169),l=a(250237),c=a(305658),d=a(622284),u=a(869048),p=a(22412),_=a(878198),m=a(667294),h=a(908866),g=a(659397);const A=({rooms:e,isRoomsActivated:t,chosenRoomId:a,targetRefs:m,searchQuery:A,onSetPopout:C,actionsMore:v,onRoomRename:f,onRoomClick:S,onChangeSearchQuery:E,onSwitchRoom:T})=>{const{getLang:I}=(0,i.useLang)(),{getCountForRoom:y}=(0,h.useCountParticipantsByRooms)(),N=!!A,b=e=>{const a=[(0,n.jsx)(d.TextTooltip,{text:I("calls_room_control_rooms_tooltip_rename"),placement:"top",forcePortal:!0,offsetDistance:-5,children:(0,n.jsx)(o.IconButton,{hasHover:!1,hasActive:!1,onClick:t=>{t.stopPropagation(),f(e)},stopPropagation:!0,children:(0,n.jsx)(r.Icon20WriteOutline,{className:"RoomControlModal__content__icon"})})},`${e.id}_rename`)];return t?a.push((0,n.jsx)(o.Link,{style:{marginLeft:"14px"},onClick:()=>T(e.id),children:I("calls_room_control_rooms_enter")},`${e.id}_enter`)):a.push((0,n.jsx)(d.TextTooltip,{text:I("calls_room_control_rooms_tooltip_more"),placement:"top",forcePortal:!0,offsetDistance:-5,children:(0,n.jsx)(o.IconButton,{getRootRef:t=>m.current&&(m.current[`room_item_${e.id}`]=t),hasHover:!1,hasActive:!1,onClick:t=>{var a,i,r;t.stopPropagation(),a=`room_item_${e.id}`,i=e.id,(null==m||null==(r=m.current)?void 0:r[a])&&C((0,n.jsx)(o.ActionSheet,{iosCloseItem:(0,n.jsx)(o.ActionSheetDefaultIosCloseItem,{}),onClose:()=>C(null),toggleRef:m.current[a],children:v.map(((e,t)=>(0,n.jsx)(c.ActionSheetItem,{autoClose:!0,before:e.before,onClick:()=>{null==e||null==e.handleClick||e.handleClick(i)},children:e.text},t)))}))},stopPropagation:!0,children:(0,n.jsx)(s.Icon16MoreHorizontal,{className:"RoomControlModal__content__icon"})})},`${e.id}_more`)),(0,n.jsx)(n.Fragment,{children:a})};return(0,n.jsx)(u.AppRootProvider,{children:(0,n.jsxs)("div",{className:"RoomControlModal__leftBlock",children:[(0,n.jsx)("div",{className:"RoomControlModal__search_wrapper",children:(0,n.jsx)(o.Input,{type:"text",mode:"plain",placeholder:I("calls_room_control_input_search_placeholder"),before:(0,n.jsx)(l.Icon16Search,{className:"RoomControlModal__search_icon"}),className:"RoomControlModal__search_input",value:A,onChange:e=>E(e.target.value)})}),(0,n.jsx)("div",{className:"RoomControlModal__rooms_list",children:!N&&(0,n.jsxs)(n.Fragment,{children:[!!y(p.ROOM_MAIN_ID)&&(0,n.jsxs)(o.Cell,{onClick:()=>S(p.ROOM_MAIN_ID),className:"RoomControlModal__room_item",children:[I("calls_room_control_not_divided_counter"),(0,n.jsx)("span",{className:"RoomControlModal__in_room_counter",children:y(p.ROOM_MAIN_ID)})]}),(0,_.objectMap)(e,(e=>(0,n.jsxs)(o.Cell,{onClick:()=>S(e.id),className:(0,g.classNames)("RoomControlModal__room_item",e.id===a&&"RoomControlModal__room_item_active"),after:b(e),children:[e.name,!!y(e.id)&&(0,n.jsx)("span",{className:"RoomControlModal__in_room_counter",children:y(e.id)})]},`room_item_${e.id}`)))]})})]})})},C=(0,m.memo)(A)},555082:(e,t,a)=>{"use strict";a.d(t,{RoomControlModal:()=>A});var n=a(785893),o=a(86894),i=a(915961),r=a(869048),s=a(816511),l=a(400856),c=a(685371),d=a(126116),u=a(193527),p=a(36193),_=a(667294),m=a(370322),h=a(592543),g=a(22412);const A=({rooms:e,devices:t,participants:a,isRoomsActivated:A,chosenRoomId:C,participantsActionsMore:v,roomActionsMore:f,searchQuery:S,onRoomRename:E,onCloseRooms:T,onTryAgain:I,onOpenRooms:y,onRoomCreate:N,onRoomChoose:b,onChangeParticipantRoom:x,onChangeSearchQuery:M,onAutoDivide:O,onSwitchRoom:P,onClose:R})=>{const{getLang:k}=(0,i.useLang)(),w=(0,_.useRef)({}),[D,L]=(0,_.useState)(null),j=Object.keys(e).length>=g.ROOMS_MAX_COUNT,B=k(A?"calls_room_control_activated_title":"calls_room_control_title");return(0,n.jsx)(u.BaseModal,{className:(0,o.classNames)("CallsModal--blue","RoomControlModal"),preventCloseClasses:["vkui__portal-root"],onClose:R,children:(0,n.jsx)(r.AppRootProvider,{disablePortal:!0,children:(0,n.jsx)(s.ModalBox,{"aria-label":B,style:{maxWidth:"unset"},children:(0,n.jsx)(o.SplitLayout,{popout:D,children:(0,n.jsxs)(o.SplitCol,{children:[(0,n.jsx)(l.ModalHeader,{onClose:R,closeAriaLabel:k("calls_close"),children:B}),(0,n.jsxs)(c.ModalBody,{insetLevel:0,className:"RoomControlModal__body",children:[(0,n.jsx)(m.RoomControlLeftBlock,{rooms:e,isRoomsActivated:A,chosenRoomId:C,targetRefs:w,searchQuery:S,actionsMore:f,onSetPopout:L,onRoomClick:b,onRoomRename:E,onChangeSearchQuery:M,onSwitchRoom:P}),(0,n.jsx)(h.RoomControlRightBlock,{rooms:e,devices:t,isRoomsActivated:A,chosenRoomId:C,participants:a,targetRefs:w,searchQuery:S,actionsMore:v,onChangeParticipantRoom:x,onSetPopout:L,onAutoDivide:O})]}),(0,n.jsx)(d.ModalFooter,{className:"RoomControlModal__footer",actionButtons:(0,n.jsxs)(n.Fragment,{children:[!A&&(0,n.jsx)(o.Button,{onClick:I,mode:"secondary",children:k("calls_room_control_try_again")}),A?(0,n.jsx)(o.Button,{onClick:T,appearance:"negative",children:k("calls_room_control_open_rooms")}):(0,n.jsx)(o.Button,{onClick:y,children:k("calls_room_control_close_rooms")})]}),children:!A&&(0,n.jsx)("div",{className:"RoomControlModal__footer_content",children:(0,n.jsx)(o.Button,{disabled:j,mode:"tertiary",onClick:N,before:(0,n.jsx)(p.Icon20Add,{}),children:k("calls_room_control_add_room")})})})]})})})})})}},653283:(e,t,a)=>{"use strict";a.d(t,{RoomControlParticipantList:()=>l});var n=a(785893),o=a(86894),i=a(496111),r=a(915961),s=a(614768);const l=({header:e,devices:t,selectable:a,checked:l,participants:c,targetRefs:d,showIfEmpty:u,showSeparator:p,moreButtonStyle:_,withMeta:m,handleMoreClick:h,handleChange:g})=>{const{getLang:A}=(0,r.useLang)();return(0,n.jsxs)(n.Fragment,{children:[p&&(0,n.jsx)(o.Spacing,{size:10,children:(0,n.jsx)(o.Separator,{className:"RoomControlModal__participants_separator"})}),(0,n.jsx)("div",{className:"RoomControlModal__right_header_wrapper",children:e}),(0,n.jsxs)("div",{className:"RoomControlModal__participants_list",children:[null==t?void 0:t.map((e=>{const t=(0,i.externalIdToString)(e.externalId),o=c[e.externalId.id];return(0,n.jsx)(s.RoomControlParticipantListItem,{participant:o,targetRefs:d,device:e,selectable:a,checked:l,moreButtonStyle:_,withMeta:m,handleMoreClick:h,handleChange:g},t)})),!(null==t?void 0:t.length)&&u&&(0,n.jsx)(o.Spacing,{size:60,className:"RoomControlModal__participants_empty",children:A("calls_room_control_participants_empty")})]})]})}},614768:(e,t,a)=>{"use strict";a.d(t,{RoomControlParticipantListItem:()=>v});var n=a(785893),o=a(659397),i=a(86894),r=a(417174),s=a(496111),l=a(892169),c=a(191091),d=a(382210),u=a(888235),p=a(728075),_=a(759930),m=a(402622),h=a(646301),g=a(915961),A=a(878198),C=a(455319);const v=({selectable:e,checked:t,participant:a,device:v,moreButtonStyle:f="icon",withMeta:S,targetRefs:E,handleMoreClick:T,handleChange:I})=>{var y;const{getLang:N}=(0,g.useLang)(),b=(0,s.externalIdToString)(v.externalId),x=(0,s.participantIsAdmin)(a),M=(0,A.vou)(e&&!x,"selectable");let O=null;const P=[];var R,k,w,D,L;(x?O=(0,n.jsx)("span",{className:"RoomControlModal__participant_item__admin",children:N("calls_room_control_participant_admin")}):"button"===f?O=(0,n.jsx)(i.Button,{mode:"secondary",size:"s",getRootRef:e=>E.current&&(E.current[b]=e),onClick:()=>null==T?void 0:T(b,v),stopPropagation:!0,children:N("calls_room_control_move_button")}):"icon"===f&&(O=(0,n.jsx)(i.IconButton,{getRootRef:e=>E.current&&(E.current[b]=e),hasHover:!1,hasActive:!1,onClick:()=>null==T?void 0:T(b,v),stopPropagation:!0,children:(0,n.jsx)(l.Icon16MoreHorizontal,{className:"RoomControlModal__content__icon"})})),S)&&((null==(R=v.statusData)||null==(k=R.drat)?void 0:k.state)&&P.push((0,n.jsx)(c.Icon24Question,{width:16,height:16,className:"RoomControlModal__participant_item__meta_icon RoomControlModal__participant_item__meta_icon_active"},`${b}-help-request`)),v.mediaSettings.isScreenSharingEnabled&&P.push((0,n.jsx)(d.Icon16ArrowUpRectangle,{className:"RoomControlModal__participant_item__meta_icon"},`${b}-screen`)),(null==(w=v.statusData)||null==(D=w.hand)?void 0:D.state)&&P.push((0,n.jsx)(u.Icon16Hand,{className:"RoomControlModal__participant_item__meta_icon"},`${b}-hand`)),v.mediaSettings.isAudioEnabled?P.push((0,n.jsx)(p.Icon16Microphone,{className:"RoomControlModal__participant_item__meta_icon"},`${b}-mic`)):P.push((0,n.jsx)(_.Icon16MicrophoneSlash,{className:"RoomControlModal__participant_item__meta_icon"},`${b}-mic`)),v.mediaSettings.isVideoEnabled?P.push((0,n.jsx)(m.Icon16Videocam,{className:"RoomControlModal__participant_item__meta_icon"},`${b}-video`)):P.push((0,n.jsx)(h.Icon16CamSlash,{className:"RoomControlModal__participant_item__meta_icon"},`${b}-video`)));return(0,n.jsx)(i.Cell,{mode:M,checked:t,disabled:x,onChange:()=>null==I?void 0:I(v.externalId),className:(0,o.classNames)("RoomControlModal__participant_item",{RoomControlModal__participant_item_with_opacity:x}),before:(0,n.jsx)("div",{className:(0,o.classNames)("RoomControlModal__participant_item_avatar",(0,A.vou)(e&&x,"RoomControlModal__participant_item_avatar_admin")),children:(0,n.jsx)(r.CallPhoto,{size:(null==a?void 0:a.is_nft)?40:"xxxs",id:null==a?void 0:a.peerId,photo:null==a?void 0:a.photo,alt:(null==a?void 0:a.name)||"",showCreatorBadge:(0,s.isCreator)(a),showAdminBadge:(0,s.isAdmin)(a),isNFT:null==a?void 0:a.is_nft,letter:null!=(L=null==a||null==(y=a.name)?void 0:y[0])?L:"",className:(0,A.vou)(null==a?void 0:a.is_nft,"CallPhoto--nft")})}),after:(0,n.jsxs)(n.Fragment,{children:[P,O]}),children:(0,C.getUserName)(a)})}},592543:(e,t,a)=>{"use strict";a.d(t,{RoomControlRightBlock:()=>A});var n=a(785893),o=a(86894),i=a(305658),r=a(915961),s=a(22412),l=a(667294),c=a(438655),d=a(908866),u=a(878198),p=a(496111),_=a(212169),m=a(653283),h=a(971);const g=({rooms:e,devices:t,isRoomsActivated:a,participants:l,chosenRoomId:g,actionsMore:A,targetRefs:C,searchQuery:v,onSetPopout:f,onChangeParticipantRoom:S,onAutoDivide:E})=>{const{getLang:T}=(0,r.useLang)(),{getCountForRoom:I}=(0,d.useCountParticipantsByRooms)(),y=(0,u.objectMap)(t,(e=>e.externalId)),N=(0,_.useIndexer)(y,(e=>{var t;var a;return null!=(a=null==(t=h.GlobalStore.getCallsState().participants[e.id])?void 0:t.name)?a:""}),(e=>(0,p.externalIdToString)(e))),b=((0,u.isEmpty)(v)?y:N.search(v)).reduce(((n,o)=>{const i=t[(0,p.externalIdToString)(o)];if(!i)return n;const r=(0,c.findRelatedRoom)(i.externalId,e);var d;const u=null!=(d=a?null==i?void 0:i.roomId:null==r?void 0:r.id)?d:s.ROOM_MAIN_ID,_=(0,c.roomIdToString)(u),m=l[i.externalId.id];return!(0,p.participantIsAdmin)(m)||a&&_!==(0,c.roomIdToString)(s.ROOM_MAIN_ID)?(n[_]||(n[_]=[]),n[_].push(i),n):n}),{[(0,c.roomIdToString)(s.ROOM_MAIN_ID)]:[]}),x=(e,t)=>{var a;(null==C||null==(a=C.current)?void 0:a[e])&&f((0,n.jsx)(o.ActionSheet,{iosCloseItem:(0,n.jsx)(o.ActionSheetDefaultIosCloseItem,{}),onClose:()=>f(null),toggleRef:C.current[e],children:A.map(((e,a)=>(0,n.jsx)(i.ActionSheetItem,{autoClose:!0,before:e.before,disabled:e.disabled,onClick:()=>null==e||null==e.handleClick?void 0:e.handleClick(t.externalId),children:e.text},`device_on_more_action_${a}`)))}))},M=[];if((0,u.isEmpty)(v))if(g){var O;M.push((0,n.jsx)(m.RoomControlParticipantList,{header:(0,n.jsxs)("div",{children:[null==(O=e[g])?void 0:O.name,(0,n.jsx)("span",{className:"RoomControlModal__in_room_counter",children:I(g)})]}),devices:b[(0,c.roomIdToString)(g)],selectable:!a,checked:!a,participants:l,targetRefs:C,showIfEmpty:!a,withMeta:a,handleMoreClick:x,handleChange:e=>S(e,s.ROOM_MAIN_ID)},`participants_list_${g}`)),a||(0,u.isEmpty)(b[(0,c.roomIdToString)(s.ROOM_MAIN_ID)])||M.push((0,n.jsx)(m.RoomControlParticipantList,{header:(0,n.jsxs)("div",{children:[T("calls_room_control_not_divided_counter"),(0,n.jsx)("span",{className:"RoomControlModal__in_room_counter",children:I(s.ROOM_MAIN_ID)})]}),devices:b[(0,c.roomIdToString)(s.ROOM_MAIN_ID)],selectable:!0,checked:!1,participants:l,targetRefs:C,showSeparator:!0,handleMoreClick:x,handleChange:e=>S(e,g)},"participants_list_main"))}else{const e=I(s.ROOM_MAIN_ID);M.push((0,n.jsx)(m.RoomControlParticipantList,{header:e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[T("calls_room_control_not_divided_counter"),(0,n.jsx)("span",{className:"RoomControlModal__in_room_counter",children:e})]}),(0,n.jsx)(o.Button,{mode:"tertiary",onClick:E,children:T("calls_room_control_button_auto_divide")})]}):(0,n.jsx)(n.Fragment,{}),devices:b[(0,c.roomIdToString)(s.ROOM_MAIN_ID)],participants:l,moreButtonStyle:a?"button":"icon",targetRefs:C,handleMoreClick:x},"participants_list_main"))}else{let t=!1;(0,u.objectForEach)(b,((a,o)=>{if((0,u.isEmpty)(a))return;const i=o===(0,c.roomIdToString)(s.ROOM_MAIN_ID)?T("calls_room_control_not_divided_counter"):e[+o].name;M.push((0,n.jsx)(m.RoomControlParticipantList,{header:(0,n.jsx)("div",{children:i}),devices:b[o],participants:l,targetRefs:C,showSeparator:t,handleMoreClick:x},`participants_list_${o}`)),t=!0}))}return(0,n.jsx)("div",{className:"RoomControlModal__rightBlock",children:M})},A=(0,l.memo)(g)},82297:(e,t,a)=>{"use strict";a.d(t,{RoomLeaveRemoveWatchTogetherModal:()=>_});var n=a(785893),o=a(193527),i=a(869048),r=a(816511),s=a(400856),l=a(685371),c=a(126116),d=a(86894),u=a(119783),p=a(915961);const _=({onClose:e,onSwitchRoom:t,bodyText:a,acceptText:_})=>{const{getLang:m}=(0,p.useLang)();return(0,n.jsx)(o.BaseModal,{className:"CallsRoomLeaveRemoveWatchTogetherModal",onClose:e,disableBodyScroll:!0,children:(0,n.jsx)(u.FocusTrap,{autoFocus:!0,children:(0,n.jsx)(i.AppRootProvider,{disablePortal:!0,children:(0,n.jsxs)(r.ModalBox,{children:[(0,n.jsx)(s.ModalHeader,{onClose:e,closeAriaLabel:"Закрыть",children:m("calls_room_leave_remove_watch_together_modal_header")}),(0,n.jsx)(l.ModalBody,{insetLevel:2,children:a}),(0,n.jsx)(c.ModalFooter,{actionButtons:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Button,{mode:"tertiary",size:"m",onClick:e,children:m("calls_room_leave_remove_watch_together_modal_cancel")}),(0,n.jsx)(d.Button,{size:"m",onClick:t,children:_})]})})]})})})})}},877982:(e,t,a)=>{"use strict";a.d(t,{RoomRequestHelpModal:()=>c});var n=a(785893),o=a(193527),i=a(121644),r=a(86894),s=a(212380),l=a(915961);const c=({onClick:e})=>{const{getLang:t}=(0,l.useLang)(),{onClose:a}=(0,i.useClosePopup)();return(0,n.jsx)(o.BaseModal,{className:"RoomRequestHelpModal",onClose:a,enableCrossButton:!0,disableBodyScroll:!0,children:(0,n.jsxs)("div",{className:"RoomRequestHelpModal__wrap",children:[(0,n.jsx)(s.Icon56HelpOutline,{className:"RoomRequestHelpModal__icon"}),(0,n.jsx)("h3",{className:"RoomRequestHelpModal__title",children:t("calls_rooms_modal_request_help_title")}),(0,n.jsx)("p",{className:"RoomRequestHelpModal_subheader",children:t("calls_rooms_modal_request_help_body")}),(0,n.jsx)(r.Button,{onClick:e,children:t("calls_rooms_modal_request_help_button")})]})})}},631501:(e,t,a)=>{"use strict";a.d(t,{RoomStatus:()=>s});var n=a(785893),o=a(86894),i=a(970449),r=a(915961);function s({onEnterRoom:e,onRoomRequestHelp:t,canChooseRoomAsAdmin:a,room:s,roomIdToEnter:l}){const{getLang:c}=(0,r.useLang)(),d=(0,n.jsxs)("div",{className:"RoomStatus__room__name",children:[(0,n.jsx)(i.Icon20UserSquareOnSquareOutline,{className:"RoomStatus__room__icon"}),s?s.name:c("calls_rooms_main_title")]});return s?(0,n.jsxs)("div",{className:"RoomStatus__room",children:[d,!a&&(0,n.jsx)(o.Link,{onClick:t,className:"RoomStatus__room__link",children:c("calls_rooms_request_help")})]}):l||a&&!s?(0,n.jsxs)("div",{className:"RoomStatus__room",children:[d,(0,n.jsx)(o.Link,{onClick:e,className:"RoomStatus__room__link",children:c("calls_rooms_return_to_room")})]}):null}},387590:(e,t,a)=>{"use strict";a.d(t,{RoomStatusAdmin:()=>d});var n=a(785893),o=a(970449),i=a(144757),r=a(915961),s=a(836326),l=a(667294);const c=[{name:"preventOverflow",options:{mainAxis:!0,padding:10}}];function d({actions:e,room:t}){const{getLang:a}=(0,r.useLang)(),[d,u]=(0,l.useState)(!1),p=(0,n.jsxs)("div",{className:"RoomStatusAdmin__room__name",children:[(0,n.jsx)(o.Icon20UserSquareOnSquareOutline,{className:"RoomStatusAdmin__room__icon"}),t?t.name:a("calls_rooms_main_title")]});return(0,n.jsx)(s.CallsDropdown,{className:"Participant__Dropdown",items:e,open:d,setOpen:u,placement:"bottom-end",customModifiers:c,children:(0,n.jsxs)("div",{className:"RoomStatusAdmin__room",children:[p,(0,n.jsx)(i.Icon16Dropdown,{"aria-label":a("calls_actions")})]})})}},198179:(e,t,a)=>{"use strict";a.d(t,{BlockTitle:()=>i});var n=a(785893),o=a(512334);const i=({children:e})=>(0,n.jsx)(o.default,{className:"CallsScheduledRowBlockTitle",selectable:!1,canBeHovered:!1,children:e})},281053:(e,t,a)=>{"use strict";a.d(t,{SearchBar:()=>h});var n=a(434788),o=a(785893),i=a(667294),r=a(250237),s=a(479049),l=a(315954),c=a(224654),d=a(120287),u=a(700200),p=a(910434),_=a(659397),m=a(558791);const h=({loading:e,dropdownRows:t,tokens:a,onDeleteToken:h,onClearFilters:g,setText:A,text:C})=>{const{getLang:v}=(0,m.useLangContext)(),f=(0,i.useRef)(null),S=(0,i.useCallback)((()=>{var e;A(""),null==(e=f.current)||e.focus()}),[]),E=(0,i.useCallback)((e=>{A(e.target.value)}),[]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"CallsSearchBar",children:[(0,o.jsx)(r.Icon16Search,{className:"CallsSearchBarLoupIcon"}),(0,o.jsx)("input",{ref:f,className:"CallsSearchBar__input",type:"text",value:C,onChange:E,placeholder:v("calls_movie_player_search")}),!!C&&(0,o.jsx)(c.Dropdown,{className:"CallsSearchBarDropdown",dataContainerClassName:"CallsSearchBarDropdownDataContainer",align:"right",position:"b",appearance:"fancy",disableCloseByItemClick:!0,disableCssHover:!0,data:t,children:(0,o.jsx)("div",{className:(0,_.classNames)("CallsSearchBar__input__settings",{"CallsSearchBar__input__settings--invisible":e}),children:(0,o.jsx)(s.Icon24Filter,{className:"CallsSearchBarIcon"})})}),C&&!e&&(0,o.jsx)(l.Icon24Cancel,{className:"CallsSearchBarIcon",onClick:S}),e&&(0,o.jsx)(p.default,{color:"var(--steel_gray_400)",size:18})]}),!!C&&!!a.length&&(0,o.jsxs)("div",{className:"CallsSearchBar__filters",children:[(0,o.jsx)("div",{className:"CallsSearchBar__filters__tokens",children:a.map((e=>(0,o.jsx)(d.Token,(0,n._)({},e,{onDelete:h}),e.id)))}),(0,o.jsx)("div",{className:"CallsSearchBar__filters__clear",children:(0,o.jsx)(u.default,{onClick:g,children:v("calls_movie_player_clear_filters")})})]})]})}},712549:(e,t,a)=>{"use strict";a.d(t,{useSearch:()=>o});var n=a(667294);const o=({onSearchMovies:e})=>{const[t,a]=(0,n.useState)(""),[o,i]=(0,n.useState)(t),r=(0,n.useRef)(null);return(0,n.useEffect)((()=>{let a;return e&&t.length>2&&(r.current=setTimeout((()=>{a=new AbortController,e(t,a.signal),i(t)}),500)),()=>{r.current&&clearTimeout(r.current),null==a||a.abort()}}),[t,e]),{text:t,lastText:o,setText:a}}},386125:(e,t,a)=>{"use strict";a.d(t,{useSearchSettings:()=>p});var n=a(434788),o=a(785893),i=a(667294),r=a(659397),s=a(558791),l=a(541561),c=a(627240),d=a(635127);const u={[l.EMovieSettingsType.Length]:!1,[l.EMovieSettingsType.Date]:!1,[l.EMovieSettingsType.Sort]:!1,[l.EMovieSettingsType.Checkbox]:{[l.EMovieCheckbox.DirectTranslations]:!1,[l.EMovieCheckbox.HighQuality]:!1,[l.EMovieCheckbox.NoRestrictions]:!1}},p=()=>{const{getLang:e}=(0,s.useLangContext)(),t=t=>{switch(t){case l.EMovieLength.Any:return e("calls_movie_player_filter_long_any");case l.EMovieLength.Long:return e("calls_movie_player_filter_long_long");case l.EMovieLength.Short:return e("calls_movie_player_filter_long_short");case l.EMovieDate.Any:return e("calls_movie_player_filter_date_any");case l.EMovieDate.Day:return e("calls_movie_player_filter_date_day");case l.EMovieDate.Week:return e("calls_movie_player_filter_date_week");case l.EMovieDate.Month:return e("calls_movie_player_filter_date_month");case l.EMovieDate.Year:return e("calls_movie_player_filter_date_year");case l.EMovieSort.Relevance:return e("calls_movie_player_sort_relevance");case l.EMovieSort.Date:return e("calls_movie_player_sort_date");case l.EMovieSort.Length:return e("calls_movie_player_sort_length");case l.EMovieCheckbox.DirectTranslations:return e("calls_movie_player_filter_live_translations");case l.EMovieCheckbox.HighQuality:return e("calls_movie_player_filter_high_quality");case l.EMovieCheckbox.NoRestrictions:return e("calls_movie_player_filter_no_limited")}},[a,p]=(0,i.useState)(u),[_,m]=(0,i.useState)([]),h=(0,i.useMemo)((()=>({[l.EMovieSettingsType.Length]:[{value:!1,label:t(l.EMovieLength.Any)},{value:l.EMovieLength.Long,label:t(l.EMovieLength.Long)},{value:l.EMovieLength.Short,label:t(l.EMovieLength.Short)}],[l.EMovieSettingsType.Date]:[{value:!1,label:t(l.EMovieDate.Any)},{value:l.EMovieDate.Day,label:t(l.EMovieDate.Day)},{value:l.EMovieDate.Week,label:t(l.EMovieDate.Week)},{value:l.EMovieDate.Month,label:t(l.EMovieDate.Month)},{value:l.EMovieDate.Year,label:t(l.EMovieDate.Year)}],[l.EMovieSettingsType.Sort]:[{value:!1,label:t(l.EMovieSort.Relevance)},{value:l.EMovieSort.Date,label:t(l.EMovieSort.Date)},{value:l.EMovieSort.Length,label:t(l.EMovieSort.Length)}]})),[e]),g=(0,i.useCallback)((()=>{p((0,n._)({},u)),m([])}),[]),A=(0,i.useCallback)((({id:e,text:t,value:a})=>{m((n=>{if(!a)return n.filter((t=>t.id!==e));const o=[];let i=!1;const r={id:e,text:t,value:a};for(const t of n)t.id!==e?o.push(t):(o.push(r),i=!0);return i||o.push(r),o}))}),[]),C=(0,i.useCallback)((e=>{switch(e.type){case l.EMovieSettingsType.Length:case l.EMovieSettingsType.Date:case l.EMovieSettingsType.Sort:p((t=>(0,n._)({},t,{[e.type]:e.value}))),A({id:e.type,text:e.value?t(e.value):e.value,value:e.value});break;case l.EMovieSettingsType.Checkbox:p((t=>(0,n._)({},t,{[e.type]:(0,n._)({},t[e.type],{[e.value]:e.subValue})}))),A({id:e.value,text:t(e.value),value:e.subValue})}}),[]),v=(0,i.useCallback)(((e,t)=>{switch(e){case l.EMovieSettingsType.Date:case l.EMovieSettingsType.Length:case l.EMovieSettingsType.Sort:C({type:e,value:!1});break;case l.EMovieCheckbox.DirectTranslations:case l.EMovieCheckbox.HighQuality:case l.EMovieCheckbox.NoRestrictions:C({type:l.EMovieSettingsType.Checkbox,value:e,subValue:!t})}}),[C]),f=(0,i.useCallback)((e=>{C({type:e.name,value:e.selected.value})}),[C]),S=(0,i.useCallback)(((e,t)=>{C({type:l.EMovieSettingsType.Checkbox,value:e,subValue:t})}),[C]);return{dropdownRows:(0,i.useMemo)((()=>[{id:"length-title",text:(0,o.jsx)("div",{className:(0,r.classNames)("CallsSearchBarSettingsRow--title","CallsSearchBarSettingsRow"),children:e("calls_movie_player_filter_long")})},{id:"length-select",text:(0,o.jsx)(c.default,{className:"CallsSearchBarSettingsRow",appearance:"secondary",name:l.EMovieSettingsType.Length,value:a[l.EMovieSettingsType.Length],options:h[l.EMovieSettingsType.Length],onChange:f})},{id:"date-title",text:(0,o.jsx)("div",{className:(0,r.classNames)("CallsSearchBarSettingsRow--title","CallsSearchBarSettingsRow"),children:e("calls_movie_player_filter_date")})},{id:"date-select",text:(0,o.jsx)(c.default,{className:"CallsSearchBarSettingsRow CallsSearchBarSettingsRow--date",appearance:"secondary",name:l.EMovieSettingsType.Date,value:a[l.EMovieSettingsType.Date],options:h[l.EMovieSettingsType.Date],onChange:f})},{id:"sort-title",text:(0,o.jsx)("div",{className:(0,r.classNames)("CallsSearchBarSettingsRow--title","CallsSearchBarSettingsRow"),children:e("calls_movie_player_sort")})},{id:"sort-select",text:(0,o.jsx)(c.default,{className:"CallsSearchBarSettingsRow",appearance:"secondary",name:l.EMovieSettingsType.Sort,value:a[l.EMovieSettingsType.Sort],options:h[l.EMovieSettingsType.Sort],onChange:f})},{id:"checkbox-direct-translations",text:(0,o.jsx)(d.default,{className:"CallsSearchBarSettingsRow",name:l.EMovieCheckbox.DirectTranslations,checked:a[l.EMovieSettingsType.Checkbox][l.EMovieCheckbox.DirectTranslations],onChange:S,children:t(l.EMovieCheckbox.DirectTranslations)})},{id:"checkbox-high-quality",text:(0,o.jsx)(d.default,{className:"CallsSearchBarSettingsRow",name:l.EMovieCheckbox.HighQuality,checked:a[l.EMovieSettingsType.Checkbox][l.EMovieCheckbox.HighQuality],onChange:S,children:t(l.EMovieCheckbox.HighQuality)})},{id:"checkbox-no-restrictions",text:(0,o.jsx)(d.default,{className:"CallsSearchBarSettingsRow",name:l.EMovieCheckbox.NoRestrictions,checked:a[l.EMovieSettingsType.Checkbox][l.EMovieCheckbox.NoRestrictions],onChange:S,children:t(l.EMovieCheckbox.NoRestrictions)})}]),[a,f,S]),settings:a,tokens:_,onClearFilters:g,onDeleteToken:v}}},541561:(e,t,a)=>{"use strict";var n,o,i,r,s;a.d(t,{EMovieCheckbox:()=>r,EMovieDate:()=>o,EMovieLength:()=>n,EMovieSettingsType:()=>s,EMovieSort:()=>i}),function(e){e.Any="any",e.Long="long",e.Short="short"}(n||(n={})),function(e){e.Any="any",e.Day="day",e.Week="week",e.Month="month",e.Year="year"}(o||(o={})),function(e){e.Relevance="relevance",e.Date="date",e.Length="length"}(i||(i={})),function(e){e.DirectTranslations="direct-translations",e.HighQuality="high-quality",e.NoRestrictions="no-restrictions"}(r||(r={})),function(e){e.Date="date",e.Length="length",e.Sort="sort",e.Checkbox="checkbox"}(s||(s={}))},525906:(e,t,a)=>{"use strict";a.d(t,{SelectLikeDropdown:()=>d});var n=a(434788),o=a(820224),i=a(785893),r=a(667294),s=a(384627),l=a(881310),c=a(86894);const d=e=>{var{selectedId:t,options:a,onChange:d,ariaLabel:u}=e,p=(0,o._)(e,["selectedId","options","onChange","ariaLabel"]);const[_,m]=(0,r.useState)(!1),h=(0,r.useMemo)((()=>a.find((e=>e.value===t))||a[0]),[t]);return(0,i.jsx)(s.DropdownActionSheet,(0,n._)({shown:a.length>1&&_,onShownChange:m,offsetSkidding:1,action:"click",placement:"bottom-end"},p,{content:(0,i.jsx)(i.Fragment,{children:a.map((e=>(0,i.jsx)(l.DropdownActionSheetItem,{selected:e.value===t,onClick:()=>(e=>{d(e),m(!1)})(e),children:e.label},e.value)))}),children:(0,i.jsx)(c.Link,{Component:"button","aria-expanded":_,"aria-label":u,disabled:a.length<=1,children:h.label})}))}},181702:(e,t,a)=>{"use strict";a.d(t,{default:()=>r});var n=a(785893),o=a(667294),i=a(659397);class r extends o.Component{componentDidMount(){this.slider.current&&this.slider.current.addEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.addEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.addEventListener("mouseleave",this.onMouseLeave)}componentWillUnmount(){this.slider.current&&this.slider.current.removeEventListener("mousedown",this.onMouseDown),this.slider.current&&this.slider.current.removeEventListener("mouseenter",this.onMouseEnter),this.slider.current&&this.slider.current.removeEventListener("mouseleave",this.onMouseLeave)}componentDidUpdate(e){const{value:t}=this.props;if(this.isControlledOutside&&void 0!==t&&t!==e.value){const{min:e,max:a}=this.props;this.setState({percentValue:r.valueToPercent(t,e,a)})}}static valueToPercent(e,t,a){return e<t&&(e=t),e>a&&(e=a),100*(e-t)/(a-t)}static percentToValue(e,t,a){return Math.round(100*(e*(a-t)/100+t))/100}static getFillPosition(e,t){let a,n;return e<t?(a=e,n=t-e):(a=t,n=e-t),{left:a,width:n}}getZeroPosition(){const{min:e,max:t}=this.props;return r.valueToPercent(0,e,t)}getOffset(e){const{min:t,max:a,step:n}=this.props,{left:o,width:r}=(0,i.getOffsetRect)(this.slider.current);let s=e.clientX-o;if(n>0){const e=r/((a-t)/n);s=Math.round(s/e)*e}return{offset:s,left:o,width:r}}render(){const{min:e,max:t,isShowZero:a,isShowHandle:o,appearance:s}=this.props,{percentValue:l,hintPosition:c,isActive:d}=this.state,u=this.getZeroPosition(),{left:p,width:_}=r.getFillPosition(l,u),m=l!==u,h=this.props.formatHint(r.percentToValue(c,e,t)),g=(0,i.classNames)("CallsSlider",`CallsSlider--${s}`,{CallsSlider__active:d}),A=(0,i.classNames)("CallsSlider__handle",{"CallsSlider__handle--active":m,"CallsSlider__handle--show":o});return(0,n.jsxs)("div",{className:g,ref:this.slider,children:[(0,n.jsx)("input",{type:"hidden",value:l}),a&&m&&(0,n.jsx)("div",{className:"CallsSlider__middletick",style:{left:`${u}%`}}),(0,n.jsx)("span",{className:(0,i.classNames)("CallsSlider__hint",this.props.hintClass),style:{left:`${c}%`},children:h}),(0,n.jsx)("div",{className:"CallsSlider__fill",style:{left:`${p}%`,width:`${_}%`}}),(0,n.jsx)("div",{className:A,style:{left:`${l}%`}})]})}constructor(e){let t;super(e),this.onMouseDown=e=>{0===e.button&&(this.update(e),this.setState({isActive:!0}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("mousemove",this.onMouseMove))},this.onMouseMove=e=>{requestAnimationFrame((()=>this.update(e)))},this.onMouseUp=()=>{this.setState({isActive:!1}),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp)},this.onMouseEnter=()=>{window.addEventListener("mousemove",this.updateHint)},this.onMouseLeave=()=>{window.removeEventListener("mousemove",this.updateHint)},this.update=e=>{const{min:t,max:a,gravity:n}=this.props,{offset:o,width:i}=this.getOffset(e),s=this.getZeroPosition();let l=r.valueToPercent(o,0,i);n&&n>0&&l>=s-n&&l<=s+n&&(l=s),this.state.percentValue!==l&&(this.setState({hintPosition:l}),this.props.onChange(r.percentToValue(l,t,a)),this.isControlledOutside||this.setState({percentValue:l}))},this.updateHint=e=>{const{offset:t,width:a}=this.getOffset(e);this.setState({hintPosition:r.valueToPercent(t,0,a)})},t=e.value?r.valueToPercent(e.value,e.min,e.max):e.defaultValue?r.valueToPercent(e.defaultValue,e.min,e.max):this.getZeroPosition(),this.state={percentValue:t,hintPosition:0,isActive:!1},this.isControlledOutside=this.props.hasOwnProperty("value"),this.slider=(0,o.createRef)()}}r.defaultProps={min:0,max:100,step:0,gravity:0,isShowZero:!1,isShowHandle:!1,defaultValue:0,appearance:"blue",name:"value",onChange:()=>{},formatHint:e=>e}},212879:(e,t,a)=>{"use strict";a.d(t,{AppDownload:()=>m});var n=a(785893),o=a(685311),i=a(293079),r=a(64195),s=a(86894),l=a(816511),c=a(207592),d=a(685371),u=a(439536),p=a(915961),_=a(272286);function m({isSkipJoinPage:e,onSkipJoinPage:t,onClose:a,onDownloadApp:m,onJoinCall:h,isStartNewCall:g,isHideCheckbox:A}){const{getLang:C}=(0,p.useLang)(),v=C("calls_try_vk_calls");return(0,n.jsx)(_.FocusTrapWrapper,{label:v,children:(0,n.jsxs)(l.ModalBox,{children:[(0,n.jsx)(s.ModalDismissButton,{onClick:a}),(0,n.jsx)(c.ModalMedia,{children:(0,n.jsx)(o.default,{width:72,height:72})}),(0,n.jsxs)(d.ModalBody,{insetLevel:1,children:[(0,n.jsx)(u.ModalTextLayout,{subheader:C("calls_download_and_install_because_stuff"),children:v}),(0,n.jsxs)("div",{className:"StartCallModalModalBox__button-wrap",children:[(0,n.jsxs)(s.ButtonGroup,{stretched:!0,gap:"s",mode:"vertical",align:"right",children:[(0,n.jsx)(s.Button,{size:"m",mode:"primary",before:(0,n.jsx)(i.Icon16DownloadOutline,{}),stretched:!0,onClick:m,children:C("calls_download_app")}),(0,n.jsx)(s.Button,{size:"m",before:(0,n.jsx)(r.Icon16Phone,{}),mode:"secondary",stretched:!0,onClick:h,children:C(g?"calls_start_call_with_browser":"calls_join_call_in_browser")})]}),(0,n.jsx)(s.Spacing,{size:16}),!A&&(0,n.jsx)(s.Checkbox,{checked:e,onChange:t,children:(0,n.jsx)(s.Subhead,{dangerouslySetInnerHTML:{__html:C("calls_always_open_in_browser_p1")}})})]})]})]})})}},867069:(e,t,a)=>{"use strict";a.d(t,{AppOpen:()=>p});var n=a(785893),o=a(86894),i=a(816511),r=a(207592),s=a(685371),l=a(439536),c=a(685311),d=a(915961),u=a(272286);const p=({isSkipJoinPage:e,onSkipJoinPage:t,onClose:a,onOpenApp:p,onJoinCall:_,isStartNewCall:m,isHideCheckbox:h})=>{const{getLang:g}=(0,d.useLang)();return(0,n.jsx)(u.FocusTrapWrapper,{children:(0,n.jsxs)(i.ModalBox,{children:[(0,n.jsx)(o.ModalDismissButton,{onClick:a}),(0,n.jsx)(r.ModalMedia,{children:(0,n.jsx)(c.default,{width:72,height:72})}),(0,n.jsxs)(s.ModalBody,{insetLevel:1,children:[(0,n.jsx)(l.ModalTextLayout,{subheader:g("calls_if_not_appeared_press_btn_above"),children:(()=>{const[e,t]=(g("calls_press_open_app_in_window_p1")||"").split("{highlighted}"),a=g("calls_press_open_app_in_window_p2");return(0,n.jsxs)(n.Fragment,{children:[!!e&&(0,n.jsxs)("span",{children:[e," "]}),!!a&&(0,n.jsxs)("span",{className:"StartCallModalModalBox__header--highlighted",children:[a," "]}),!!t&&(0,n.jsx)("span",{children:t})]})})()}),(0,n.jsxs)("div",{className:"StartCallModalModalBox__button-wrap",children:[(0,n.jsxs)(o.ButtonGroup,{stretched:!0,gap:"s",mode:"vertical",align:"right",children:[(0,n.jsx)(o.Button,{size:"m",mode:"primary",stretched:!0,onClick:p,children:g("calls_open_app_vk_calls")}),(0,n.jsx)(o.Button,{size:"m",mode:"tertiary",stretched:!0,onClick:_,children:g(m?"calls_start_call_with_browser":"calls_join_call_in_browser")})]}),(0,n.jsx)(o.Spacing,{size:16}),!h&&(0,n.jsx)(o.Checkbox,{checked:e,onChange:t,children:(0,n.jsx)(o.Subhead,{dangerouslySetInnerHTML:{__html:g("calls_always_open_in_browser_p1")}})})]})]})]})})}},86488:(e,t,a)=>{"use strict";var n;a.d(t,{EAppContent:()=>n}),function(e){e[e.Download=0]="Download",e[e.Open=1]="Open",e[e.Loading=2]="Loading"}(n||(n={}))},712924:(e,t,a)=>{"use strict";a.d(t,{StreamModeSwitcher:()=>d});var n=a(785893),o=a(667294),i=a(86894),r=a(464380),s=a(449158),l=a(687741),c=a(558791);const d=({availableModes:e,currentMode:t,setMode:a})=>{const{getLang:d}=(0,c.useLangContext)(),u=e=>{switch(e){case r.MediaType.STREAM:case r.MediaType.MOVIE:return d("calls_stream_mode_movie");case r.MediaType.SCREEN:return d("calls_stream_mode_screen");case r.MediaType.CAMERA:return d("calls_stream_mode_camera");default:return e}},p=(0,o.useMemo)((()=>e.map((e=>({label:(0,n.jsx)(s.StreamModeSwitcherLabel,{icon:(0,l.getStreamModeIcon)(e),label:u(e),modeType:e,currentMode:t}),value:e,"aria-label":u(e)})))),[t,e]);return(0,n.jsx)(i.SegmentedControl,{onChange:a,className:"StreamModeSwitcher",options:p,value:t})}},449158:(e,t,a)=>{"use strict";a.d(t,{StreamModeSwitcherLabel:()=>i});var n=a(785893);const o=({icon:e,label:t,modeType:a,currentMode:o})=>(0,n.jsxs)("div",{className:"StreamModeSwitcher__item",children:[e,a===o&&(0,n.jsx)("span",{className:"StreamModeSwitcher__item-label",children:t})]}),i=(0,a(667294).memo)(o)},714308:(e,t,a)=>{"use strict";a.d(t,{useSetStreamMode:()=>l});var n=a(667294),o=a(496111),i=a(490287),r=a(396901),s=a(1628);const l=e=>{const t=(0,r.useTypedDispatch)(),a=(0,i.useTypedSelector)((e=>e.externalId));return(0,n.useCallback)((n=>{var i;i=n,(0,o.isSameExternalId)(a,e)?t({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{streamMode:i}}):(0,s.throttleAccumulateDispatchParticipant)(t,e,{streamMode:i})}),[e])}},786695:(e,t,a)=>{"use strict";a.d(t,{Stub:()=>s});var n=a(434788),o=a(820224),i=a(785893),r=a(659397);const s=e=>{const{children:t,className:a}=e,s=(0,o._)(e,["children","className"]);return(0,i.jsx)("div",(0,n._)({},s,{className:(0,r.classNames)("CallsStub",a),children:t||"No results."}))}},120287:(e,t,a)=>{"use strict";a.d(t,{Token:()=>i});var n=a(785893),o=a(790932);const i=({id:e,text:t,value:a,onDelete:i})=>(0,n.jsxs)("div",{className:"CallsToken",children:[(0,n.jsx)("span",{className:"CallsToken__text",children:t}),(0,n.jsx)(o.Icon16Cancel,{className:"CallsToken__cross",onClick:()=>{null==i||i(e,a)}})]})},536529:(e,t,a)=>{"use strict";a.d(t,{Touch:()=>p});var n=a(434788),o=a(785893),i=a(667294),r=a(86894),s=a(353459),l=a(355745),c=a(906686);const d={bottom:0,left:0,right:0,top:0},u=[15,-15],p=({children:e,style:t,startCoords:a=u,padding:p=d,className:_,onUpdateStartCoords:m,ignoredSelectors:h})=>{const g=(0,i.useRef)(null),A=(0,i.useRef)(!1),[C,v]=(0,c.useViewport)(),[f,S]=(0,l.useRefRect)(g),[[E,T],I]=(0,i.useState)([0,0]),[[y,N],b]=(0,i.useState)(a),x=(0,i.useCallback)(((e,t)=>{const a=0+p.left,n=0-p.top;return[(0,s.validateCoord)(a,v-f-p.right,e,10),(0,s.validateCoord)(-C+S+p.bottom,n,t,10)]}),[v,C,f,S,p]);(0,i.useEffect)((()=>{b(x(y,N))}),[x]),(0,i.useEffect)((()=>{null==m||m([y,N])}),[y,N,m]);const M=(0,i.useCallback)((e=>{e.originalEvent.preventDefault(),A.current||I([e.shiftX,e.shiftY])}),[y,N]),O=(0,i.useCallback)((e=>{e.originalEvent.preventDefault(),A.current?A.current=!1:(b((([t,a])=>x(t+e.shiftX,a+e.shiftY))),I([0,0]))}),[x]),P=(0,i.useCallback)((e=>{(0,s.checkIgnoredSelectors)(e,h)&&(A.current=!0)}),[]),[R,k]=x(y+E,N+T);return(0,o.jsx)(r.Touch,{className:_,Component:"div",getRootRef:g,style:(0,n._)({},t,{transform:`translate(${R}px, ${k}px)`}),onStart:P,onMove:M,onEnd:O,children:e})}},106639:(e,t,a)=>{"use strict";a.d(t,{useIsScroll:()=>i});var n=a(667294),o=a(464380);const i=e=>{const[t,a]=(0,n.useState)({h:!1,v:!1}),o=(0,n.useRef)();return(0,n.useLayoutEffect)((()=>{a(r(e))}),[e]),(0,n.useEffect)((()=>{const t=()=>{o.current&&clearTimeout(o.current),o.current=setTimeout((()=>{a(r(e))}),300)};return window.addEventListener("resize",t),()=>{window.removeEventListener("resize",t)}}),[e]),t};function r(e){const t={h:!1,v:!1};if(!e)return t;const a=document.querySelector(e);return a?(a.scrollHeight>window.innerHeight&&(t.v=!0),a.scrollWidth>window.innerWidth&&(t.h=!0),t):((0,o.debugMessage)(o.DebugMessageType.ERROR,{hook:"useDragStaticElement",desc:`padding.checkScrollSelector (=${e}) is invalid`}),t)}},355745:(e,t,a)=>{"use strict";a.d(t,{useRefRect:()=>o});var n=a(667294);const o=e=>{const[t,a]=(0,n.useState)([0,0]);return(0,n.useEffect)((()=>{if(e.current){const t=e.current.getBoundingClientRect();a([t.width,t.height])}}),[]),t}},906686:(e,t,a)=>{"use strict";a.d(t,{useViewport:()=>o});var n=a(667294);const o=()=>{const[e,t]=(0,n.useState)((()=>[window.innerHeight,window.innerWidth])),a=(0,n.useRef)();return(0,n.useEffect)((()=>{const e=()=>{a.current&&clearTimeout(a.current),a.current=setTimeout((()=>{t([window.innerHeight,window.innerWidth])}),300)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),e}},353459:(e,t,a)=>{"use strict";a.d(t,{checkIgnoredSelectors:()=>o,validateCoord:()=>n});const n=(e,t,a,n)=>{const o=Math.max(e,Math.min(t,a));return Math.abs(o-e)<n?e:Math.abs(o-t)<n?t:o},o=(e,t)=>!!t&&t.some((t=>null==e.originalEvent.target.closest?void 0:e.originalEvent.target.closest(t)))},803800:(e,t,a)=>{"use strict";a.d(t,{TransferAdminRightsModal:()=>C});var n=a(785893),o=a(502592),i=a(224050),r=a(512334),s=a(479720),l=a(511527),c=a(661307),d=a(915961),u=a(645329),p=a(417174),_=a(878198),m=a(86894),h=a(194712),g=a(135504);const A=({member:e})=>{const t=!!(null==e?void 0:e.is_nft);return(0,n.jsx)(p.CallPhoto,{id:e.peerId,photo:e.photo,alt:e.name||"",size:(0,_.vou)(t,32),isNFT:t})},C=({participants:e,participantsCount:t,selected:a,onSelect:p,onClose:_,onCallForceFinish:C,onRightsTransfer:v,onSearch:f,isCreator:S,loading:E,loadingList:T,getNextPage:I,isNextPage:y})=>{const{getLang:N}=(0,d.useLang)();return(0,n.jsx)(u.CallManagementModal,{title:N("calls_dialog_creator_exit_title"),onCloseModal:_,actionButtons:(0,n.jsxs)(n.Fragment,{children:[S&&(0,n.jsx)(g.OutlinedButton,{mode:"secondary",onClick:C,children:N("calls_force_call_finish")},"force"),(0,n.jsx)(g.OutlinedButton,{"data-focus-first":!0,onClick:v,children:N(null===a?"calls_leave_call":"calls_dialog_creator_exit_action")},"action")]}),children:(0,n.jsxs)("div",{className:"TransferAdminRightsModal__content",children:[T&&(0,n.jsx)("div",{className:"TransferAdminRightsModal__content__spinner",children:(0,n.jsx)(m.Spinner,{size:"large"})}),(0,n.jsx)(l.default,{onChange:e=>f(e.target.value),placeholder:N("calls_search_participants_placeholder"),className:"TransferAdminRightsModal__searchInput"}),(0,n.jsxs)(o.default,{border:!1,"aria-label":N("calls_call_participants"),children:[(0,n.jsx)(i.ListHeader,{extra:t,children:N("calls_call_participants")}),!e.length&&(0,n.jsx)(c.default,{children:N("calls_participants_not_found")}),e.map(((t,o)=>(0,n.jsxs)("button",{role:"checkbox","aria-checked":a===t.peerId,className:"TransferAdminRightsModal__a11y-button","aria-label":t.name,onClick:()=>p(a!==t.peerId?t:null),children:[(0,n.jsx)(r.default,{className:"TransferAdminRightsModal__item",aside:(0,n.jsx)("span",{className:"TransferAdminRightsModal__label","aria-selected":a===t.peerId,children:a===t.peerId?N("calls_dialog_creator_exit_selected"):N("calls_dialog_creator_exit_select")}),children:(0,n.jsx)(s.default,{size:"34",title:t.name,photo:t.is_nft?(0,n.jsx)(A,{member:t}):t.photo})}),(o+1<e.length||y)&&(0,n.jsx)("li",{className:"TransferAdminRightsModal__a11y-button-fake-list-item"})]},t.peerId))),y&&(0,n.jsxs)(r.default,{children:[E&&(0,n.jsx)("div",{className:"TransferAdminRightsModal__item__spinner",children:(0,n.jsx)(m.Spinner,{size:"small"})}),!E&&(0,n.jsxs)(h.ListMore,{noHover:!0,onClick:I,children:[!!e.length&&N("calls_waiting_hall_more_text"),!e.length&&N("calls_waiting_hall_reload_text")]})]},"limit")]})]})})}},606469:(e,t,a)=>{"use strict";a.d(t,{TranslationCreateForm:()=>T});var n,o,i=a(785893),r=a(667294),s=a(511527),l=a(688731),c=a(346880),d=a(893023),u=a(512334),p=a(556294),_=a(502592),m=a(627240),h=a(304954),g=a(871414),A=a(162532),C=a(907964),v=a(431837),f=a(50533),S=a(465768),E=a(788822);function T({onSubmit:e,onClose:t,isRecord:a}){const{getLang:n,langShortDateTime:o}=(0,r.useContext)(c.LangContext),T=(0,f.useSelector)((e=>e)),I=()=>{let e=(new Date).toISOString().split("T")[0];return n("calls_translation_title_default_value").replace("%s",e)},y=(e,t="",a="")=>({id:e,name:t,photo:a,isGroup:e<0}),N=e=>{let t=[{value:"only_me",label:n("calls_translation_privacy_only_me_and_chat")},{value:"friends",label:n("calls_translation_privacy_friends_and_chat")}];return e&&t.push({value:"all",label:n("calls_translation_privacy_all_users")}),t},b=T.participants[T.me],[x,M]=(0,r.useState)(I()),[O,P]=(0,r.useState)(""),[R,k]=(0,r.useState)(T.groupId?"all":"only_me"),[w,D]=(0,r.useState)((()=>N(!b.isClosed||!!T.groupId))),[L,j]=(0,r.useState)((()=>{var e,t;return T.groupId?y(T.groupId,null==(e=T.meGroup)?void 0:e.name,null==(t=T.meGroup)?void 0:t.photo):y(b.peerId,b.name,b.photo)})),[B,U]=(0,r.useState)(0),[H,F]=(0,r.useState)({}),[V,G]=(0,r.useState)((()=>T.groupId&&T.meGroup?[{value:T.meGroup.peerId,label:(0,E.decodeHTMLEntities)(T.meGroup.name)}]:[{value:b.peerId,label:(0,E.decodeHTMLEntities)(b.name)}])),[W,$]=(0,r.useState)([]),[z,Z]=(0,r.useState)(!1),[K,Q]=(0,r.useState)([]),[Y,q]=(0,r.useState)([]),J=(0,r.useCallback)((()=>{let t=x.trim(),a=O.trim(),n={};if(Object.keys(H).length>0){t||(t=H.title),a||(a=H.description);let e=a!=H.title||t!=H.description;e||(e=L.id>0&&H.privacy_view.category!=R),e&&(0,A.sendVideoEdit)(L.id,H.id,t,a,R).catch((e=>console.error(e)));const o={ovId:H.ov_id};H.live_start_time&&(o.startTime=H.live_start_time),n.upcomingStreamParams=o}else{n.streamParams={name:t||I(),description:a,privacy_view:R,call:1};const e=L.id<0?-L.id:0;0!==e&&(n.streamParams.group_id=e)}e(n)}),[x,O,R,L,H]);(0,r.useEffect)((()=>{if(!T.groupId)try{(0,A.getGroupsForStreaming)().then((e=>{const t=[...V];e.length>0&&(e.forEach((e=>{t.push({value:-e.id,label:e.name||""})})),G(t),$(e))})).catch(S.handlePromiseError)}catch(e){console.log(e)}}),[]),(0,r.useEffect)((()=>{F({}),Z(!1),Q([]),(0,A.getUpcomingLives)([L.id]).then((e=>{let t=[];e.count>0&&(t=e.items.filter((e=>""!==e.ov_id)));let a=t.length>0;if(Z(a),Q(t),a){let e=[];t.forEach((t=>{t.owner_id&&t.owner_id>0&&e.push(t.owner_id.toString())})),e&&(0,A.loadUsers)({user_ids:e.join(",")}).then((e=>{const t=[];e.forEach((e=>{t.push({id:e.id,name:e.first_name+" "+e.last_name})})),q(t)})).catch(S.handlePromiseError)}})).catch(S.handlePromiseError)}),[L]);const X=e=>{let t=e.date;return e.live_start_time&&(t=e.live_start_time),o(1e3*t)},ee=e=>{let t=e.date;e.live_start_time&&(t=e.live_start_time);const a=t-Date.now()/1e3;return a>0&&a<v.WEEK?n("calls_translation_date_label_soon"):""},te=e=>{if(!(e>0))return L.name;{const t=Y.filter((t=>t.id==e));if(t.length>0){const e=t[0];if(e)return e.name}}return""};return(0,i.jsxs)(i.Fragment,{children:[0===B&&(0,i.jsxs)(d.TranslationCreateModal,{onClose:t,onSubmit:J,title:n(a?"calls_record_box_title":"calls_translation_box_title"),isRecord:a,children:[(0,i.jsxs)("div",{className:"TranslationCreateForm__link",children:[(0,i.jsxs)(_.default,{children:[!!V.length&&(0,i.jsx)(u.default,{border:!0,canBeHovered:!1,selectable:!1,icon:(0,i.jsx)(p.ListIcon,{icon:(0,i.jsx)("img",{className:"TranslationCreateForm__ownerIcon",src:L.photo,alt:L.name}),color:p.ListIconColors.GRAY}),aside:(0,i.jsx)(m.default,{className:"TranslationCreateFormOptions__longselect",options:V,value:L.id,onChange:e=>{const t=e.selected.value;"number"==typeof t&&t<0?W.forEach((e=>{e.id==-t&&(k("all"),D(N(!0)),j(y(-e.id,e.name,e.photo_100)))})):(D(N(!b.isClosed)),k("only_me"),j(y(b.peerId,b.name,b.photo)))},disabled:V.length<=1}),children:n(a?"calls_record_owner_title":"calls_translation_owner_title")}),z&&!a&&(0,i.jsxs)(u.default,{onClick:()=>{z&&U(1)},chevron:!0,border:!0,icon:(0,i.jsx)(p.ListIcon,{icon:(0,i.jsx)(g.TimeIcon,{}),color:p.ListIconColors.GREEN}),children:[n("calls_translation_postponed_title"),Object.keys(H).length>0&&(0,i.jsx)("div",{className:"TranslationCreateForm__copyControl",children:(0,i.jsx)(C.default,{className:"TranslationCreateForm__copyButton",onClick:e=>{e.preventDefault(),e.stopPropagation(),F({}),M(I()),P("")},children:n("calls_translation_postponed_reset")})})]}),(0,i.jsx)(u.default,{border:!1,canBeHovered:!1,selectable:!1,icon:(0,i.jsx)(p.ListIcon,{icon:(0,i.jsx)(h.PrivacyIcon,{}),color:p.ListIconColors.GRAY}),aside:(0,i.jsx)(m.default,{className:"TranslationCreateForm__privacySelector TranslationCreateFormOptions__longselect",disabled:L.isGroup,options:w,value:R,onChange:e=>{k(e.selected.value)}}),children:n("calls_translation_who_can_see_video_privacy")})]}),(0,i.jsx)("div",{className:"TranslationCreateForm__privacyHint",children:n(a?"calls_record_who_can_see_video_privacy_hint":"calls_translation_who_can_see_video_privacy_hint")})]}),(0,i.jsxs)("form",{className:"TranslationCreateForm__main",onSubmit:J,children:[(0,i.jsxs)("div",{className:"TranslationCreateForm__section",children:[(0,i.jsx)("div",{className:"TranslationCreateForm__block",children:(0,i.jsxs)("label",{className:"TranslationCreateForm__label",children:[n("calls_translation_title"),(0,i.jsx)(s.default,{className:"TranslationCreateForm__field",value:x,onChange:e=>{const t=e.target;M(t.value)},placeholder:n("calls_translation_name_placeholder")})]})}),!a&&(0,i.jsx)("div",{className:"TranslationCreateForm__block",children:(0,i.jsxs)("label",{className:"TranslationCreateForm__label",children:[n("calls_translation_description"),(0,i.jsx)(l.default,{className:"TranslationCreateForm__field",placeholder:n("calls_translation_description_placeholder"),value:O,onChange:e=>{const t=e.target;P(t.value)}})]})})]}),(0,i.jsx)("div",{className:"TranslationCreateForm__tabSection",children:(0,i.jsx)("div",{className:"TranslationCreateForm__warning",children:n(a?"calls_record_notification_warning":"calls_translation_notification_warning")})})]})]}),1===B&&(0,i.jsx)(d.TranslationCreateModal,{title:n("calls_translation_select_upcoming_box_title"),isWithBackButton:!0,onBackClick:()=>U(0),onClose:t,contentClassName:"TranslationCreateForm__modalVideo",children:(0,i.jsx)("div",{children:K.length>0&&(0,i.jsx)(_.default,{className:"TranslationCreateForm__VideoList",children:K.map(((e,t)=>(0,i.jsxs)(u.default,{className:"TranslationCreateForm__videoItem",active:e.id===H,border:!0,canBeHovered:!0,selectable:!0,onClick:()=>{return(t=e).owner_id>0&&(0,A.getVideos)(t.owner_id,[t.owner_id+"_"+t.id],!0).then((e=>{if(e.count>0){let a=e.items.filter((e=>e.id==t.id));a.length>0&&(t.privacy_view=a[0].privacy_view,F(t),t.privacy_view&&k(t.privacy_view.category))}})),F(t),U(0),M(t.title),void P(t.description);var t},aside:(0,i.jsx)("span",{className:"TranslationCreateForm__videoLink",children:n("calls_translation_select_video_link")}),children:[(0,i.jsxs)("div",{className:"TranslationCreateForm__videoImagePreview",children:[(0,i.jsx)("img",{className:"TranslationCreateForm__videoImage",src:e.image&&e.image[0]&&e.image[0].url?e.image[0].url:"",alt:e.title}),ee(e)&&(0,i.jsx)("span",{className:"TranslationCreateForm__videoImageLabel",children:ee(e)})]}),(0,i.jsxs)("div",{className:"TranslationCreateForm__videoDescription",children:[(0,i.jsx)("div",{className:"TranslationCreateForm__videoTitle",children:e.title}),(0,i.jsx)("div",{className:"TranslationCreateForm__videoOwner",children:(0,E.decodeHTMLEntities)(te(e.owner_id))}),(0,i.jsx)("div",{className:"TranslationCreateForm__videoDate",children:X(e)})]})]},t)))})})})]})}!function(e){e.ONLY_ME="only_me",e.FRIENDS="friends",e.ALL="all"}(n||(n={})),function(e){e[e.MAIN=0]="MAIN",e[e.SELECT_POSTPONE=1]="SELECT_POSTPONE"}(o||(o={}))},893023:(e,t,a)=>{"use strict";a.d(t,{TranslationCreateModal:()=>l});var n=a(785893),o=a(667294),i=a(589897),r=a(346880),s=a(513885);function l(e){const{onClose:t,onSubmit:a,title:l,children:c,isWithBackButton:d,onBackClick:u,contentClassName:p="TranslationCreateModal__content",isRecord:_}=e,{getLang:m}=(0,o.useContext)(r.LangContext),h=t&&a&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.default,{size:"m",onClick:t,mode:"tertiary",children:m("calls_cancel")}),(0,n.jsx)(i.default,{mode:"primary",size:"m",onClick:a,children:m(_?"calls_record_start":"calls_translation_start")})]});return(0,n.jsx)(s.default,{className:"TranslationCreateModal",title:l,onClose:t,backText:d?m("calls_back"):void 0,onBack:u,actionButtons:h,children:(0,n.jsx)("div",{className:p,children:o.Children.toArray(c).map(((e,t)=>(0,n.jsx)("div",{className:"CallManagementModal__section",children:e},t)))})})}},930809:(e,t,a)=>{"use strict";a.d(t,{TranslationLink:()=>d});var n=a(785893),o=a(667294),i=a(511527),r=a(589897),s=a(3046),l=a(180625),c=a(346880);const d=({link:e})=>{const{getLang:t}=(0,o.useContext)(c.LangContext),[a,d]=(0,o.useState)(!1),u=(0,o.useCallback)((()=>d(!0)),[]),p=(0,o.useCallback)((()=>d(!1)),[]);return(0,n.jsxs)("div",{className:"TranslationLink",children:[(0,n.jsx)("p",{className:"TranslationLink__info",children:t("calls_translation_link_info")}),(0,n.jsx)(i.default,{readOnly:"readonly",className:"TranslationLink__input",value:e}),e&&(0,n.jsx)(l.CopyText,{text:e,onCopyDone:u,children:(0,n.jsx)(r.default,{mode:"primary",size:"m",children:t("calls_translation_link_copy")})}),(0,n.jsx)(s.default,{className:"TranslationLink__copied",shown:a,callback:p,children:t("calls_translation_link_copied")})]})}},329130:(e,t,a)=>{"use strict";a.d(t,{TranslationStartCountdownModal:()=>l});var n=a(785893),o=a(667294),i=a(937107),r=a(346880),s=a(589897);const l=({onCloseModal:e,counter:t,onStopTranslation:a,isRecord:l})=>{const{getLang:c}=(0,o.useContext)(r.LangContext),d=c(l?"calls_record_cancel_button":"calls_translation_cancel_button");return(0,n.jsx)(i.default,{disableBackdropClick:!0,disableEscapeClose:!0,className:"TranslationStartCountdownModal",onClose:e,children:(0,n.jsxs)("div",{className:"TranslationStartCountdownModal__content",children:[(0,n.jsx)("div",{className:"TranslationStartCountdownModal__counter",children:t}),(0,n.jsx)(s.default,{size:"m",className:"TranslationStartCountdownModal__stop",onClick:a,mode:"overlay_secondary",children:d})]})})}},824436:(e,t,a)=>{"use strict";a.d(t,{TranslationStatus:()=>m,TranslationStatusRecord:()=>h});var n=a(785893),o=a(659397),i=a(937026),r=a(819669),s=a(141343),l=a(838891),c=a(480365),d=a(915961),u=a(881310),p=a(384627),_=a(869048);const m=({translationTimer:e,viewersCount:t=0,isLiveIndicatorOff:a=!1,actions:l=[],tooltipText:d=""})=>{const m=(0,o.classNames)({TranslationStatus__translationIndicator:!0,"TranslationStatus__translationIndicator--disabled":a}),h=(null==l?void 0:l.length)>0,g=(0,o.classNames)({TranslationStatus__translationTimer:!0,"TranslationStatus__translationTimer--hasIndicator":!a});let A=(0,n.jsxs)("div",{className:"TranslationStatus__translation",children:[(0,n.jsx)(c.default,{className:m}),(0,n.jsxs)(n.Fragment,{children:[!!e&&(0,n.jsx)("div",{className:g,children:e}),!a&&(0,n.jsxs)("div",{className:"TranslationStatus__translationViewersCount",children:[(0,n.jsx)(r.Icon16View,{}),(0,n.jsx)("div",{className:"TranslationStatus__translationViewersCountNumber",children:t})]}),h&&(0,n.jsx)("div",{className:"TranslationStatus__translationDropdown",children:(0,n.jsx)(s.Icon12Dropdown,{})})]})]},"translation");if(h){const e=(0,n.jsx)(n.Fragment,{children:null==l?void 0:l.map((e=>(0,n.jsx)(u.DropdownActionSheetItem,{before:e.before,onClick:e.handleClick,children:e.text},e.text)))});A=(0,n.jsx)(p.DropdownActionSheet,{action:"hover",content:e,children:A})}else d&&(A=(0,n.jsx)(i.TooltipNew,{content:(0,n.jsx)(n.Fragment,{children:d}),children:A}));return(0,n.jsx)(_.AppRootProvider,{children:(0,n.jsx)("div",{className:"TranslationStatus",children:A})})},h=({translationTimer:e,isMeAuthor:t,recordStartTimeMs:a,recordAuthorDisplayName:i,onStopRecord:r,isCanStopRecord:s})=>{const{getLang:c}=(0,d.useLang)(),u=Date.now()-(a||0)>5e3,p=!!e&&u,_=!!e&&!u,m=!e&&!t&&!!i,h=!(!t&&!s);return(0,n.jsx)("div",{className:(0,o.classNames)("TranslationStatus","TranslationStatus--is-record"),children:(0,n.jsxs)("div",{className:(0,o.classNames)({TranslationStatus__translation:!0,"TranslationStatus__translation--is-not-author":!h}),children:[(0,n.jsx)(l.Icon20RecordingCircleFill,{fill:"#FF3347",width:16,height:16}),(0,n.jsxs)("div",{className:"TranslationStatus__translationTimer",children:[p&&e,_&&c("calls_recording_in_progress"),m&&c("calls_name_is_recording").replace("{name}",i)]}),h&&(0,n.jsx)("span",{className:"TranslationStatus__endRecord",onClick:r,children:c("calls_end_recording")})]},"translation")})}},124675:(e,t,a)=>{"use strict";a.d(t,{TranslationStopModal:()=>r});var n=a(785893),o=a(513885),i=a(915961);const r=({onClose:e,actionButtons:t,isRecord:a})=>{const{getLang:r}=(0,i.useLang)(),s=r(a?"calls_record_stop_confirmation":"calls_translation_stop_confirmation"),l=r(a?"calls_record_stop_sure":"calls_translation_stop_sure");return(0,n.jsx)(o.default,{onClose:e,title:s,appearance:"blue",actionButtons:t,className:"TranslationStopModal",children:(0,n.jsx)("div",{className:"TranslationStopModal__text",children:l})})}},984482:(e,t,a)=>{"use strict";a.d(t,{UiSearchNew:()=>l});var n=a(785893),o=a(667294),i=a(195192),r=a(315954),s=a(659397);const l=({onChange:e,placeholder:t,className:a})=>{const[l,c]=(0,o.useState)("");return(0,n.jsx)("div",{className:(0,s.classNames)("ui_search_new","ui_search",a),children:(0,n.jsxs)("div",{className:"ui_search_input_block",children:[(0,n.jsx)("button",{className:"ui_search_button_search",children:(0,n.jsx)(i.Icon16SearchOutline,{})}),(0,n.jsxs)("div",{className:"ui_search_input_inner",children:[(0,n.jsx)("div",{className:"ui_search_controls",children:!!l&&(0,n.jsx)("button",{className:"ui_search_reset_button ui_search_button_control",onClick:()=>{c(""),null==e||e("")},children:(0,n.jsx)(r.Icon24Cancel,{})})}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault()},children:(0,n.jsx)("input",{type:"text",className:"ui_search_field",placeholder:t,value:l,onChange:t=>{t.preventDefault();const a=t.target.value;c(a),null==e||e(a)}})})]})]})})}},197966:(e,t,a)=>{"use strict";a.d(t,{UnbanMembersModal:()=>l});var n=a(785893),o=a(667294),i=a(513885),r=a(346880),s=a(43014);const l=({onClose:e,actionButtons:t,description:a,subDescription:l,avatarsItems:c})=>{const{getLang:d}=(0,o.useContext)(r.LangContext);return(0,n.jsx)(i.default,{className:"UnbanMembersModal",appearance:"blue",title:d("calls_unban_participant_title"),actionButtons:t,onClose:e,children:(0,n.jsxs)("div",{className:"UnbanMembersModal__content",children:[(0,n.jsx)(s.AvatarsStack,{items:c}),(0,n.jsx)("div",{className:"UnbanMembersModal__description",children:a}),(0,n.jsx)("div",{className:"UnbanMembersModal__subDescription",children:l})]})})}},564048:(e,t,a)=>{"use strict";a.d(t,{UnmuteRequestModal:()=>i});var n=a(785893),o=a(513885);const i=({onClose:e,actionButtons:t,title:a,description:i})=>(0,n.jsx)(o.default,{className:"UnmuteRequestModal",appearance:"blue",title:a,actionButtons:t,onClose:e,children:(0,n.jsx)("div",{className:"UnmuteRequestModal__content",children:i})})},764779:(e,t,a)=>{"use strict";a.d(t,{UploadBackgroundErrorModal:()=>l});var n=a(785893),o=a(667294),i=a(513885),r=a(589897),s=a(346880);const l=({children:e,onClose:t,onSubmit:a})=>{const{getLang:l}=(0,o.useContext)(s.LangContext);return(0,n.jsx)(i.default,{onClose:t,title:l("calls_warning"),appearance:"blue",className:"UploadBackgroundErrorModal",actionButtons:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.default,{onClick:t,mode:"tertiary",size:"m",children:l("calls_cancel")}),(0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:a,children:l("calls_retry_action")})]}),children:(0,n.jsx)("div",{className:"UploadBackgroundErrorModal__content",children:e})})}},328218:(e,t,a)=>{"use strict";a.d(t,{UploadBackgroundPhoto:()=>l});var n=a(785893),o=a(667294),i=a(346880),r=a(589897),s=a(109338);const l=({onSubmit:e,loading:t})=>{const{getLang:a}=(0,o.useContext)(i.LangContext),l=(0,o.useRef)(null),{onClick:c,error:d}=(0,s.useFileReader)({$inputEl:l,onSubmit:e}),u=(0,o.useMemo)((()=>`${a("profile_oph_err_size")}`.replace("{sorry}",`<b>${a("global_sorry_error")}</b>`).replace("{min}","200").replace("{max}","7000")),[]);return(0,n.jsxs)("div",{className:"UploadBackgroundPhoto",children:[(0,n.jsx)("input",{ref:l,type:"file",className:"UploadBackgroundPhoto__upload"}),d&&(0,n.jsxs)("div",{className:"UploadBackgroundPhoto__error",children:[(0,n.jsx)("div",{className:"UploadBackgroundPhoto__error__left"}),(0,n.jsx)("div",{className:"UploadBackgroundPhoto__error__right",dangerouslySetInnerHTML:{__html:u}})]}),(0,n.jsx)("div",{className:"UploadBackgroundPhoto__description",dangerouslySetInnerHTML:{__html:a("calls_you_can_upload_description")}}),!t&&(0,n.jsx)("div",{className:"UploadBackgroundPhoto__button",children:(0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:c,children:a("calls_choose_file")})}),t&&(0,n.jsx)("div",{className:"UploadBackgroundPhoto__progress"})]})}},109338:(e,t,a)=>{"use strict";a.d(t,{useFileReader:()=>i});var n=a(667294),o=a(394319);const i=({$inputEl:e,onSubmit:t})=>{const[a,i]=(0,n.useState)({}),[r,s]=(0,n.useState)(!1);return{error:r,fileData:a,onClick:(0,n.useCallback)((()=>{e.current&&(e.current.onchange=e=>{var a;s(!1);const n=null==(a=e.target.files)?void 0:a[0];if(!n)return;const r=new FileReader;r.onload=()=>{const e=new Image;e.onload=()=>{(0,o.checkImageDimensions)(e)?(i({file:n,image:e}),t&&t(n)):s(!0)},e.onerror=()=>s(!0),e.src=r.result},r.onerror=()=>s(!0),r.readAsDataURL(n)},e.current.click())}),[])}}},394319:(e,t,a)=>{"use strict";a.d(t,{checkImageDimensions:()=>n});const n=e=>(e.width>=510||e.width>7e3)&&(e.height>=200||e.height>7e3)},953303:(e,t,a)=>{"use strict";a.d(t,{UploadBackgroundPhotoModal:()=>s});var n=a(785893),o=a(667294),i=a(513885),r=a(346880);const s=({children:e,onClose:t})=>{const{getLang:a}=(0,o.useContext)(r.LangContext);return(0,n.jsx)(i.default,{onClose:t,title:a("calls_upload_image_for_background"),appearance:"blue",className:"UploadBackgroundPhotoModal",footerHint:a("calls_if_you_have_problems_with_upload"),children:e})}},543083:(e,t,a)=>{"use strict";a.d(t,{Video:()=>c});var n=a(785893),o=a(667294),i=a(659397),r=a(290020),s=a(464380);const l=new WeakMap,c=(0,o.memo)((function({stream:e,participantId:t,isMirrored:a=!1,isContained:c=!1,isStartWithVisible:d=!1,isLocalSchreenShare:u=!1,className:p}){const _=(0,o.useRef)(null),m=(0,o.useRef)(null),h=(0,o.useRef)(e);return(0,o.useEffect)((()=>{var n;if((null==(n=_.current)?void 0:n.lastElementChild)&&h.current===e)return;let o=d;var p,g;e&&(l.has(e)?null===(null==(p=l.get(e))?void 0:p.closest("body"))?(m.current=null!=(g=l.get(e))?g:null,o=!0):(m.current=(0,r.createVideoTag)(e),m.current.dataset.participantId=t):(m.current=(0,r.createVideoTag)(e),m.current.dataset.participantId=t,l.set(e,m.current)));if(m.current&&m.current.dataset.participantId!==t){const a=m.current;a.dataset.participantId=t,a.srcObject=null,a.srcObject=e;const n=()=>{a.classList.add("Video--visible"),a.removeEventListener("loadeddata",n)};a.addEventListener("loadeddata",n),o=!1,a.classList.remove("Video--visible")}if(m.current&&_.current&&_.current.lastElementChild!==m.current){var A;const t=(0,i.classNames)("Video",{"Video--contain":c,"Video--mirrored":a,"Video--visible":o||(null==(A=m.current)?void 0:A.classList.contains("Video--visible"))});_.current.lastElementChild&&(_.current.innerHTML=""),m.current.className=t,_.current.appendChild(m.current),m.current.play().catch((t=>{(0,s.debugMessage)(s.DebugMessageType.ERROR,{error:t,stream:e})}))}const C=function(){if(!u)return()=>null;const t=e.getVideoTracks()[0],a=()=>{m.current&&(m.current.srcObject=m.current.srcObject)};return null==t||t.addEventListener("mute",a),()=>null==t?void 0:t.removeEventListener("mute",a)}();return()=>{C(),m.current&&m.current!==l.get(e)&&(m.current.srcObject=null,m.current.src="",m.current.pause(),m.current.removeAttribute("src"),m.current.load()),_.current&&(_.current.innerHTML="")}}),[e,_.current,t]),(0,o.useEffect)((()=>{m.current&&m.current.classList.toggle("Video--mirrored",a)}),[a]),(0,n.jsx)("div",{ref:_,className:p})}))},120554:(e,t,a)=>{"use strict";a.d(t,{BorderCornerIcon:()=>o});var n=a(785893);const o=({className:e})=>(0,n.jsx)("svg",{className:e,width:"4",height:"4",viewBox:"0 0 4 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4 4V0H0C2.20898 0 4 1.79077 4 4Z",fill:"white"})})},795784:(e,t,a)=>{"use strict";a.d(t,{CarouselItem:()=>i});var n=a(785893);const o=({onClick:e,id:t,content:a})=>(0,n.jsx)("div",{className:"VirtualBackgroundSettingsCarousel__Item",onClick:()=>null==e?void 0:e(t),children:a}),i=(0,a(667294).memo)(o)},209941:(e,t,a)=>{"use strict";a.d(t,{ClearCanvas:()=>n});class n{draw(){const{gl:e}=this;null==e||e.clearColor(0,0,0,0),null==e||e.clear(e.COLOR_BUFFER_BIT)}constructor(e){this.$c=e,this.gl=this.$c.getContext("webgl")}}},287126:(e,t,a)=>{"use strict";a.d(t,{ErrorBoundary:()=>i});var n=a(667294),o=a(464380);class i extends n.Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){var a,n;(0,o.debugMessage)(o.DebugMessageType.ERROR,{error:e,info:t}),null==(n=(a=this.props).onError)||n.call(a),this.setState({hasError:!1})}render(){return this.state.hasError?null:this.props.children}constructor(e){super(e),this.state={hasError:!1}}}},719735:(e,t,a)=>{"use strict";a.d(t,{ItemAddImage:()=>l});var n=a(785893),o=a(667294),i=a(407729),r=a(659397);const s=({})=>(0,n.jsx)("div",{className:(0,r.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--add-image"),children:(0,n.jsx)(i.Icon24Add,{})}),l=(0,o.memo)(s)},406547:(e,t,a)=>{"use strict";a.d(t,{DeleteBackgroundIcon:()=>l});var n=a(434788),o=a(512796),i=a(785893),r=a(667294),s=a(513698);const l=(0,r.forwardRef)((function(e,t){var a=(0,n._)({},(0,o._)(e));return(0,i.jsx)("div",(0,n._)({},a,{ref:t,style:{width:18,height:18},children:(0,i.jsx)(s.Icon12Cancel,{})}))}))},922341:(e,t,a)=>{"use strict";a.d(t,{ItemBackground:()=>m});var n=a(434788),o=a(820224),i=a(785893),r=a(667294),s=a(659397),l=a(892187),c=a(937026),d=a(346880),u=a(251985),p=a(406547);const _=e=>{var{backgroundUrl:t,checked:a,onDelete:_,photoId:m,isPredefinedBackground:h,isStarBackground:g}=e,A=(0,o._)(e,["backgroundUrl","checked","onDelete","photoId","isPredefinedBackground","isStarBackground"]);const{getLang:C}=(0,r.useContext)(d.LangContext),v=(0,r.useRef)(null),[f,S]=(0,r.useState)(!0),E=(0,r.useMemo)((()=>(0,i.jsx)("div",{dangerouslySetInnerHTML:{__html:C(a?"calls_cant_remove_background":"calls_delete_background")}})),[a]),T=(0,r.useCallback)((e=>{e.stopPropagation(),a||_(m)}),[a,m]);return(0,r.useEffect)((()=>{let e,a;return v.current&&(e=new IntersectionObserver((n=>{for(const o of n)o.isIntersecting&&(e.disconnect(),a=new Image,a.src=t,a.onload=()=>{S(!1),a.remove()})}),{threshold:0,root:null}),e.observe(v.current)),()=>{a&&(a.onload=null,a.remove()),null==e||e.disconnect()}}),[]),(0,i.jsxs)(l.WithRadioButton,(0,n._)({},A,{checked:a,className:(0,s.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--background",{"VirtualBackgroundSettings__item--background-star":!f&&!!g}),passedRef:v,style:{backgroundImage:f?void 0:`url(${t})`},children:[f&&(0,i.jsx)(u.DivBlockSkeleton,{classNames:"VirtualBackgroundSettings__item--background__skeleton",height:80}),!h&&!f&&(0,i.jsx)("div",{className:(0,s.classNames)("VirtualBackgroundSettings__item--background__deletebtn",{"VirtualBackgroundSettings__item--background__deletebtn--disabled":a}),onClick:T,children:(0,i.jsx)(c.TooltipNew,{content:E,className:"VirtualBackgroundSettings__item__popper",position:"t",align:"center",children:(0,i.jsx)(p.DeleteBackgroundIcon,{})})})]}))},m=(0,r.memo)(_)},703633:(e,t,a)=>{"use strict";a.d(t,{ItemBlur:()=>c});var n=a(434788),o=a(785893),i=a(667294),r=a(659397),s=a(892187);const l=e=>(0,o.jsx)(s.WithRadioButton,(0,n._)({},e,{className:(0,r.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--blur")})),c=(0,i.memo)(l)},764615:(e,t,a)=>{"use strict";a.d(t,{ItemNoBackground:()=>d});var n=a(434788),o=a(785893),i=a(667294),r=a(659397),s=a(346880),l=a(892187);const c=e=>{const{getLang:t}=(0,i.useContext)(s.LangContext);return(0,o.jsx)(l.WithRadioButton,(0,n._)({},e,{className:(0,r.classNames)("VirtualBackgroundSettings__item","VirtualBackgroundSettings__item--with-border"),children:t("calls_virtual_background_settings_no_background")}))},d=(0,i.memo)(c)},508197:(e,t,a)=>{"use strict";a.d(t,{PredefinedBackground:()=>n});class n{getMappedParams(){return{id:this.params.id,originalUrl:this.params.original,previewUrl:this.params.preview,isPredefined:!0,tags:this.params.tags}}constructor(e){this.params=e}}},503089:(e,t,a)=>{"use strict";a.d(t,{VirtualBackgroundSettings:()=>m});var n=a(785893),o=a(659397),i=a(148797),r=a(840750),s=a(320649),l=a(342908),c=a(589897),d=a(120554),u=a(915961),p=a(266247),_=a(795784);const m=({backgroundList:e,onDeleteBackground:t,onChooseBackground:a,chosen:m,videoOptions:h,isSferum:g,SDK:A})=>{const{getLang:C}=(0,u.useLang)(),{userStream:v,error:f,updateUserMediaStream:S}=(0,l.useUserMediaStream)(A.browser.getUserVideo),{$video:E}=(0,i.useCurrentUserVideoElement)({userStream:v}),{$canvas:T,onUpdateVideoEffectsSettings:I,isPlaying:y}=(0,s.useVideoEffects)({backgroundList:e,$srcElement:E,userStream:v}),{carouselItems:N}=(0,r.useCarouselItems)({backgroundList:e,onDeleteBackground:t,onUpdateVideoEffectsSettings:I,onChooseBackground:a,chosen:m,isSferum:g});return(0,n.jsxs)("div",{className:"VirtualBackgroundSettings",children:[(0,n.jsxs)("div",{className:"VirtualBackgroundSettings__userStream",children:[v&&(0,n.jsx)("video",{className:(0,o.classNames)("Video",{"Video--visible":!y},"Video--contain",{"Video--mirrored":h[p.EVideoOptionType.IS_VIDEO_MIRRORED]}),ref:E,controls:!1,crossOrigin:"anonymous",playsInline:!0,muted:!0,autoPlay:!0,children:"Video tag is not supported"}),(0,n.jsx)("canvas",{ref:T,className:(0,o.classNames)("VirtualBackgroundSettings__userCanvas",{"VirtualBackgroundSettings__userCanvas--mirrored":h[p.EVideoOptionType.IS_VIDEO_MIRRORED]},{"VirtualBackgroundSettings__userCanvas--playing":y})}),f&&(0,n.jsxs)("div",{className:"VirtualBackgroundSettings__error",children:[(0,n.jsx)("div",{children:C("profile_no_camera_access")}),(0,n.jsx)("div",{children:(0,n.jsx)(c.default,{mode:"primary",className:"VirtualBackgroundSettings__error__btn",size:"m",onClick:S,children:C("calls_button_allow_access")})})]})]}),(0,n.jsxs)("div",{className:(0,o.classNames)({VirtualBackgroundSettings__carousel__modalFix:!0,"VirtualBackgroundSettings__carousel__modalFix--sferum":g}),children:[(0,n.jsx)("div",{className:"VirtualBackgroundSettings__carousel",children:N.map((e=>(0,n.jsx)(_.CarouselItem,{id:e.id,onClick:e.onClick,content:e.content},e.id)))}),(0,n.jsx)(d.BorderCornerIcon,{className:"VirtualBackgroundSettings__carousel__cornerIcon"})]})]})}},892187:(e,t,a)=>{"use strict";a.d(t,{WithRadioButton:()=>c});var n=a(434788),o=a(820224),i=a(785893),r=a(667294),s=a(847309),l=a(659397);const c=e=>{var{children:t,className:a,style:c,passedRef:d}=e,u=(0,o._)(e,["children","className","style","passedRef"]);const p=(0,r.useCallback)((()=>{}),[]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:(0,l.classNames)(a),style:c,ref:d,children:t}),(0,i.jsx)("div",{className:"VirtualBackgroundSettings__item--radio",children:(0,i.jsx)(s.default,(0,n._)({},u,{onChange:p}))})]})}},623601:(e,t,a)=>{"use strict";a.d(t,{HEIGHT:()=>i,WIDTH:()=>o,predefinedBackgrounds:()=>d});var n=a(508197);const o=436,i=250,r="https://st.mycdn.me/static/misc",s=r+"/0-0-3",l=r+"/0-0-5",c=[{id:3012,preview:s+"/3012-preview.png",original:s+"/3012-original.jpg",description:"elephant in the white room",tags:["default"]},{id:3013,preview:s+"/3013-preview.png",original:s+"/3013-original.jpg",description:"old native stove in russian historic house",tags:["default"]},{id:3014,preview:s+"/3014-preview.png",original:s+"/3014-original.jpg",description:"flying baloons surrounded by mountains",tags:["default"]},{id:3015,preview:s+"/3015-preview.png",original:s+"/3015-original.jpg",description:"two pilots driving a plate",tags:["default"]},{id:3016,preview:s+"/3016-preview.png",original:s+"/3016-original.jpg",description:"sauna",tags:["default"]},{id:3017,preview:s+"/3017-preview.png",original:s+"/3017-original.jpg",description:"red chairs in movie theater",tags:["default"]},{id:3018,preview:s+"/3018-preview.png",original:s+"/3018-original.jpg",description:"sleeping person in train cart",tags:["default"]},{id:3019,preview:s+"/3019-preview.jpg",original:s+"/3019-original.jpg",description:"Little Big icons on pink background",tags:["star"]},{id:3020,preview:s+"/3020-preview.jpg",original:s+"/3020-original.jpg",description:"Violet wild mint (2 colors split background)",tags:["star"]},{id:3021,preview:s+"/3021-preview.jpg",original:s+"/3021-original.jpg",description:"Klava Koka left the chat and in love with MDK",tags:["star"]},{id:3022,preview:s+"/3022-preview.jpg",original:s+"/3022-original.jpg",description:"Some half-naked dude with rifle",tags:["star"]},{id:3023,preview:s+"/3023-preview.jpg",original:s+"/3023-original.jpg",description:'"Cirle" photo collage',tags:["star"]},{id:3024,preview:s+"/3024-preview.jpg",original:s+"/3024-original.jpg",description:"Gazgolder & red carpet on the wall",tags:["star"]},{id:3025,preview:s+"/3025-preview.jpg",original:s+"/3025-original.jpg",description:"Gazgolder & VK Clips collab pink-yellow-blue collage",tags:["star"]},{id:3026,preview:s+"/3026-preview.jpg",original:s+"/3026-original.jpg",description:"Crem Soda people collage",tags:["star"]},{id:3027,preview:s+"/3027-preview.jpg",original:s+"/3027-original.jpg",description:"Dmitry Glukhovsky collage",tags:["star"]},{id:3028,preview:s+"/3028-preview.jpeg",original:s+"/3028-original.jpeg",description:"Dogs in space",tags:["cosmonautics-day-2022"]},{id:3029,preview:s+"/3029-preview.jpg",original:s+"/3029-original.jpg",description:"Blackboard with e=mc2 formulas",tags:["teachers-day-2022"]},{id:3030,preview:s+"/3030-preview.jpg",original:s+"/3030-original.jpg",description:"vk 2022 birthday",tags:["vk-2022-birthday"]},{id:3031,preview:s+"/3031-preview.png",original:s+"/3031-original.png",description:"vk 2022 mothers day",tags:["vk-2022-mothers-day"]},{id:3032,preview:s+"/3032-preview.png",original:s+"/3032-original.png",description:"vk 2022 new year",tags:["default"]},{id:3033,preview:s+"/3033-preview.png",original:s+"/3033-original.png",description:"vk 2023 lovers day",tags:["vk-2023-lovers-day"]},{id:3034,preview:s+"/3034-preview.png",original:s+"/3034-original.png",description:"vk 2023 nft",tags:["default"]},{id:3035,preview:l+"/3035-preview.png",original:l+"/3035-original.png",description:"vk fest 2023",tags:["default"]}],d=(()=>{const e=[3034,3033,3032,3031,3030,3029,3028,3019,3026,3027,3023,3024,3025,3020,3021,3022,3015,3013,3016,3012,3014,3017,3018];Date.now()>new Date(2023,5,15).valueOf()&&e.unshift(3035);const t=new Map;e.forEach((e=>t.set(e,null)));for(const e of c)t.has(e.id)&&t.set(e.id,new n.PredefinedBackground(e));return[...t.values()].filter(Boolean)})()},989351:(e,t,a)=>{"use strict";a.d(t,{useBackgroundEffects:()=>r});var n=a(667294),o=a(465127),i=a(22412);const r=({SDK:e})=>{const t=(0,n.useMemo)((()=>({background:new o.EffectBackground,blur:new o.EffectBlur,effect:new o.VideoEffects({debug:!0})})),[]);(0,n.useEffect)((()=>(e.setVideoEffects(t.effect),()=>{t.effect.destroy()})),[]);return{onSettingsChange:(0,n.useCallback)((a=>{switch(a.type){case i.EVideoEffectType.BACKGROUND:t.background.setBackgroundImage(a.value).then((()=>{e.changeVideoEffect(t.background)}));break;case i.EVideoEffectType.BLUR:e.changeVideoEffect(t.blur);break;case i.EVideoEffectType.NONE:e.changeVideoEffect(null);case i.EVideoEffectType.ADD:}}),[])}}},147986:(e,t,a)=>{"use strict";a.d(t,{useBackgroundsList:()=>s});var n=a(667294),o=a(508197),i=a(623601),r=a(591330);const s=({photos:e})=>({backgroundList:(0,n.useMemo)((()=>[...e,...i.predefinedBackgrounds].map((e=>e instanceof o.PredefinedBackground?e.getMappedParams():{id:e.id,originalUrl:(0,r.getMaxPhotoSizeUrl)(e),previewUrl:(0,r.getPreviewPhotoSizeUrl)(e),isPredefined:!1}))),[e])})},840750:(e,t,a)=>{"use strict";a.d(t,{useCarouselItems:()=>u});var n=a(785893),o=a(667294),i=a(764615),r=a(703633),s=a(719735),l=a(922341),c=a(22412),d=a(582422);const u=({onDeleteBackground:e,backgroundList:t,chosen:a,onUpdateVideoEffectsSettings:u,onChooseBackground:p,isSferum:_})=>{const{isAnonymous:m}=(0,d.useIsAnonymous)();(0,o.useEffect)((()=>{a!==c.EVideoEffectType.NONE&&u(a)}),[]);const h=(0,o.useCallback)((e=>{p(e),u(e)}),[p,u]),g=(0,o.useMemo)((()=>t.map((t=>{var o;return{id:t.id,onClick:h,content:(0,n.jsx)(l.ItemBackground,{checked:a===t.id,backgroundUrl:t.previewUrl,onDelete:e,photoId:t.id,isPredefinedBackground:t.isPredefined,isStarBackground:null==(o=t.tags)?void 0:o.includes("star")})}}))),[a,t,h]);return{carouselItems:(0,o.useMemo)((()=>{const e=[{id:c.EVideoEffectType.NONE,onClick:h,content:(0,n.jsx)(i.ItemNoBackground,{checked:a===c.EVideoEffectType.NONE})},{id:c.EVideoEffectType.BLUR,onClick:h,content:(0,n.jsx)(r.ItemBlur,{checked:a===c.EVideoEffectType.BLUR})}];return _||(m||e.push({id:c.EVideoEffectType.ADD,onClick:h,content:(0,n.jsx)(s.ItemAddImage,{})}),e.push(...g)),e}),[a,g,h])}}},148797:(e,t,a)=>{"use strict";a.d(t,{useCurrentUserVideoElement:()=>i});var n=a(667294),o=a(591330);const i=({userStream:e})=>{const t=(0,n.useRef)(null);return(0,n.useEffect)((()=>{if(e&&t.current){const{height:a,width:n}=(0,o.getMediaStreamDimensions)(e);t.current.height=a,t.current.width=n,t.current.srcObject=e}}),[e]),{$video:t}}},495048:(e,t,a)=>{"use strict";a.d(t,{useInitialBackgroundEffect:()=>c});var n=a(667294),o=a(591330),i=a(22412),r=a(97547),s=a(964275),l=a(465768);const c=({userStream:e,onSettingsChange:t,backgroundList:a,isVideoEnabled:c})=>{const{sendVirtualBackgroundSelected:d,sendVirtualBackgroundDisabled:u}=(0,s.useSendStatsDataVirtualBackground)();(0,n.useEffect)((()=>{if(!e)return;const n=r.effectStorage.getEffect();c?"number"==typeof n?(0,o.getPhotoById)(n,a).then((e=>{e&&(t({type:i.EVideoEffectType.BACKGROUND,value:e.url}),d(e.id,n))})).catch(l.handlePromiseError):n===i.EVideoEffectType.BLUR&&(t({type:i.EVideoEffectType.BLUR}),d(i.VIRTUAL_BACKGROUND_BLUR_ID,n)):(t({type:i.EVideoEffectType.NONE}),u(n))}),[e,c])}},748245:(e,t,a)=>{"use strict";a.d(t,{useSavedSettings:()=>c});var n=a(667294),o=a(22412),i=a(97547),r=a(591330),s=a(964275),l=a(465768);const c=({chosen:e,settingsOpened:t,onSettingsChange:a,setChosen:c,backgroundList:d,isVideoEnabled:u})=>{const{sendVirtualBackgroundSelected:p,sendVirtualBackgroundDisabled:_}=(0,s.useSendStatsDataVirtualBackground)(),m=(0,n.useRef)(null);(0,n.useEffect)((()=>{t&&(m.current=e)}),[t]);return{onApplySettings:(0,n.useCallback)((()=>{if(m.current===e)return;const t=i.effectStorage.getEffect();i.effectStorage.saveEffect(e),"number"==typeof e?(0,r.getPhotoById)(e,d).then((e=>{e&&(a({type:o.EVideoEffectType.BACKGROUND,value:e.url}),u&&p(e.id,t))})).catch(l.handlePromiseError):e===o.EVideoEffectType.BLUR?(a({type:o.EVideoEffectType.BLUR}),u&&p(o.VIRTUAL_BACKGROUND_BLUR_ID,t)):e===o.EVideoEffectType.NONE&&(a({type:o.EVideoEffectType.NONE}),u&&_(t))}),[a,d,e,p,_,u]),onRestoreSettings:(0,n.useCallback)((()=>{m.current&&c(m.current)}),[c])}}},436854:(e,t,a)=>{"use strict";a.d(t,{useSettingsItems:()=>s});var n=a(667294),o=a(396901),i=a(22412),r=a(97547);const s=({backgroundList:e})=>{const t=(0,o.useTypedDispatch)(),[a,s]=(0,n.useState)(r.effectStorage.getEffect),l=(0,n.useCallback)((a=>{switch(a){case i.EVideoEffectType.BLUR:s(a);break;case i.EVideoEffectType.ADD:t({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_UPLOAD_BACKGROUND_PHOTO});break;case i.EVideoEffectType.NONE:s(a);break;default:e.some((({id:e})=>e===a))&&s(a)}}),[e]),c=(0,n.useRef)(null),d=(0,n.useCallback)((e=>c.current=e),[]);return(0,n.useEffect)((()=>{c.current&&(l(c.current.id),c.current=null)}),[l]),{chosen:a,setChosen:s,onClick:l,onSuccessPhotoUpload:d}}},320649:(e,t,a)=>{"use strict";a.d(t,{useVideoEffects:()=>c});var n=a(667294),o=a(465127),i=a(623601),r=a(591330),s=a(22412),l=a(209941);const c=({backgroundList:e,$srcElement:t,userStream:a})=>{const c=(0,n.useRef)(null),d=(0,n.useRef)(null),u=(0,n.useRef)(null),p=(0,n.useRef)(null);null===p.current&&(p.current=new o.ImageEdit);const _=(0,n.useRef)(null),m=(0,n.useRef)(s.EVideoEffectType.NONE),h=(0,n.useRef)(s.EVideoEffectType.NONE),g=(0,n.useRef)(void 0),A=(0,n.useRef)(null),C=(0,n.useRef)(null),v=(0,n.useRef)(),f=(0,n.useRef)(!1),S=(0,n.useRef)(!1),[E,T]=(0,n.useState)(!1),I=(0,n.useCallback)((e=>{S.current="play"===e,T("play"===e)}),[]),y=(0,n.useCallback)(((e,t=!1)=>{h.current=e,t||(m.current=e)}),[]),N=(0,n.useCallback)((()=>{if(A.current&&clearTimeout(A.current),S.current)if(t.current&&d.current)try{f.current=!0,d.current.requestSegmentation(t.current)}catch(e){console.error("[useVideoEffects][onRequestSegmentation][error]",e)}else A.current=setTimeout((()=>{N()}),300)}),[]),b=(0,n.useCallback)((t=>{var a;if(null==(a=c.current)?void 0:a.isReady)switch(t){case s.EVideoEffectType.ADD:break;case s.EVideoEffectType.BLUR:y(t),g.current&&(g.current=void 0),S.current||(I("play"),N());break;case s.EVideoEffectType.NONE:var n;y(t),g.current&&(g.current=void 0),null==(n=_.current)||n.draw(),I("stop");break;default:const a=e.find((({id:e})=>e===t));a&&(y(t,!0),(0,r.loadImage)(a.originalUrl).then((e=>{if(!c.current)throw new Error("output canvas is not initialized");if(!p.current)throw new Error("ImageEdit class is not initialized");if(h.current!==t)throw new Error("Settings changed during load");const{width:a,height:n}=c.current;return p.current.resize(e,a,n)})).then((e=>{if(h.current!==t)throw new Error("Settings changed during load");y(t),g.current=e,S.current||(I("play"),N())})).catch(console.warn))}else C.current=()=>{b(t)}}),[e]),x=(0,n.useCallback)((e=>{switch(f.current=!1,m.current){case s.EVideoEffectType.ADD:case s.EVideoEffectType.NONE:break;case s.EVideoEffectType.BLUR:requestAnimationFrame((()=>{var t;null==(t=u.current)||t.draw(e),S.current&&N()}));break;default:requestAnimationFrame((()=>{var t;const a=Object.assign({background:g.current},e);null==(t=u.current)||t.draw(a),S.current&&N()}))}}),[]);function M(e=!1){var t,a;null==(t=d.current)||t.destroy(),d.current=null,null==(a=u.current)||a.close(),u.current=null,_.current=null,c.current&&(c.current.isReady=!1),e&&A.current&&clearTimeout(A.current)}return(0,n.useEffect)((()=>{if(!a)return;if(!c.current)return void console.error("[useVideoEffects][on-userStream-update] canvas is not initialized");M(),f.current&&N();const{width:e,height:t}=a.getVideoTracks()[0].getSettings();c.current.width=e||i.WIDTH,c.current.height=t||i.HEIGHT,c.current.isReady=!0,null==C.current||C.current(),u.current=new o.BlurFastWithMask(c.current),_.current=new l.ClearCanvas(c.current);const n=Date.now();v.current=n,new Promise(((e,t)=>{new o.Segmentation({onReady:e,onError:(...e)=>{console.warn(...e),t()},onFrame:x}).createModel(!0)})).then((e=>{n===v.current?d.current=e:e.destroy()})).catch((()=>{d.current=null}))}),[a]),(0,n.useEffect)((()=>()=>M(!0)),[]),{$canvas:c,onRequestSegmentation:N,onUpdateVideoEffectsSettings:b,isPlaying:E}}},591330:(e,t,a)=>{"use strict";a.d(t,{getMaxPhotoSizeUrl:()=>s,getMediaStreamDimensions:()=>d,getPhotoById:()=>c,getPreviewPhotoSizeUrl:()=>l,loadImage:()=>u});var n=a(11010),o=a(162532),i=a(623601);const r=e=>{var t;return null==(t=e.sizes)?void 0:t.reduce(((e,t)=>(e[t.type]=t.url,e)),{})},s=e=>{const t=r(e);return(null==t?void 0:t.x)||(null==t?void 0:t.m)||(null==t?void 0:t.s)||""},l=e=>{const t=r(e);return(null==t?void 0:t.o)||(null==t?void 0:t.p)||(null==t?void 0:t.q)||(null==t?void 0:t.x)||(null==t?void 0:t.s)||""},c=(e,t)=>{if(t){const a=t.find((({id:t})=>t===e));if(a)return Promise.resolve({id:a.id,url:a.originalUrl})}return(0,o.photosGetAllImages)({photo_ids:`${e}`}).then((e=>{try{const t=e.items[0];return t?{id:t.id,url:s(t)}:null}catch(e){return null}}))},d=e=>{const t=e.getVideoTracks()[0],{width:a=i.WIDTH,height:n=i.HEIGHT}=t.getSettings();return{width:a,height:n}},u=(0,n._)((function*(e){return new Promise(((t,a)=>{const n=document.createElement("img");n.crossOrigin="anonymous",n.onerror=e=>{a(`Failed image loading: ${e}`)},n.onload=()=>t(n),n.src=e}))}))},461061:(e,t,a)=>{"use strict";a.d(t,{VirtualBackgroundSettingsModal:()=>d});var n=a(785893),o=a(667294),i=a(513885),r=a(589897),s=a(635127),l=a(346880),c=a(266247);const d=({onClose:e,onSubmit:t,children:a,onChangeVideoOption:d,videoOptions:u})=>{const{getLang:p}=(0,o.useContext)(l.LangContext);return(0,n.jsx)(i.default,{onClose:e,title:p("calls_virtual_background"),appearance:"blue",disableEscapeClose:!0,actionButtons:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"VirtualBackgroundSettings__options",children:(0,n.jsx)(s.default,{checked:!!u[c.EVideoOptionType.IS_VIDEO_MIRRORED],name:c.EVideoOptionType.IS_VIDEO_MIRRORED,onChange:d,children:p("calls_mirror_display_view")})}),(0,n.jsx)(r.default,{size:"m",onClick:e,mode:"tertiary",children:p("calls_cancel")}),(0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:t,children:p("calls_save")})]}),className:"VirtualBackgroundSettingsModal",children:a})}},175708:(e,t,a)=>{"use strict";a.d(t,{VmojiSettings:()=>u});var n=a(785893),o=a(667294),i=a(346880),r=a(86894),s=a(334909),l=a(977615),c=a(444972),d=a(215200);const u=({isVmojiCreated:e,isVmojiCapture:t,vmojiPreviewSrc:a,loadingStatus:u,onToggle:p,onEdit:_,onCreate:m})=>{const{getLang:h}=(0,o.useContext)(i.LangContext);let g,A;e?(g=p,A=h(t?"calls_vmoji_settings_disable":"calls_vmoji_settings_enable")):(g=m,A=h("calls_vmoji_settings_create_character"));const C=u===l.VmojiCharacterIdLoadingStatus.LOADING,v=u===l.VmojiCharacterIdLoadingStatus.FAILED,f=e?(0,n.jsx)(c.Skeleton,{width:180,height:180,borderRadius:18}):(0,n.jsx)("img",{src:(0,s.getCDNLink)("calls-vmoji-intro-1x.png",2),srcSet:`${(0,s.getCDNLink)("calls-vmoji-intro-2x.png",2)} 2x`,width:"282",height:"168",alt:""});return(0,n.jsxs)("div",{className:"VmojiSettings",children:[a?(0,n.jsx)(d.Image,{src:a,size:180,borderRadius:"l"}):f,(0,n.jsx)("div",{className:"VmojiSettings__title",children:h("calls_vmoji_settings_title")}),(0,n.jsx)("div",{className:"VmojiSettings__subtitle",children:h("calls_vmoji_settings_subtitle")}),(0,n.jsx)("div",{className:"VmojiSettings__btn-main",children:(0,n.jsx)(r.Button,{size:"s",onClick:g,children:A})}),e&&(0,n.jsx)("div",{className:"VmojiSettings__btn-edit",children:(0,n.jsx)(r.Button,{loading:C,disabled:v,mode:"tertiary",size:"s",onClick:_,children:h("calls_vmoji_settings_edit")})})]})}},702093:(e,t,a)=>{"use strict";a.d(t,{VmojiSettingsModal:()=>s});var n=a(785893),o=a(667294),i=a(513885),r=a(346880);const s=({onClose:e,children:t})=>{const{getLang:a}=(0,o.useContext)(r.LangContext);return(0,n.jsx)(i.default,{onClose:e,title:a("calls_vmoji"),appearance:"blue",disableEscapeClose:!0,className:"VmojiSettingsModal",children:t})}},574254:(e,t,a)=>{"use strict";a.d(t,{VolumeMeterAnimation:()=>i});var n=a(785893),o=a(911099);const i=()=>{const e=(0,o.classNames)("VolumeMeterAnimation","VolumeMeterAnimation--withAnimation");return(0,n.jsx)("div",{className:e})}},790743:(e,t,a)=>{"use strict";a.d(t,{WaitingHall:()=>i});var n=a(785893),o=a(37240);const i=({name:e,letter:t,hasAudio:a,hasVideo:i,streamData:r,wasConnected:s,externalId:l,isVmoji:c})=>(0,n.jsx)("div",{className:"WaitingHall",children:(0,n.jsx)("main",{className:"WaitingHall__main",children:(0,n.jsx)(o.Participant,{externalId:l,hasVideo:i,hasAudio:a,isSharingScreen:!1,streamData:r,isMe:!0,name:e,letter:t,allowContain:!0,wasConnected:s,networkStatus:1,isVmoji:c,className:"WaitingHall__participant"})})})},99055:(e,t,a)=>{"use strict";a.d(t,{WaitingHallInfo:()=>o});var n=a(785893);const o=({text:e})=>(0,n.jsx)("div",{className:"WaitingHallInfo",children:(0,n.jsx)("div",{className:"WaitingHallInfo__text",children:e})})},709389:(e,t,a)=>{"use strict";a.d(t,{WaitingHallList:()=>m});var n=a(785893),o=a(667294),i=a(224050),r=a(346880),s=a(479720),l=a(417174),c=a(512334),d=a(502592),u=a(878198),p=a(135504),_=a(167810);const m=({members:e=[],totalCount:t=0,onPromote:a,onForbid:m})=>{const{getLang:h}=(0,o.useContext)(r.LangContext),{navigateToProfile:g}=(0,_.useNavigationContext)();return 0===e.length?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.ListHeader,{extra:t||"",children:h("calls_waiting_hall_list_header")}),(0,n.jsx)(d.default,{border:!1,className:"CallParticipantList__list CallParticipantList__list--waitingList",children:e.map((e=>{const t=!!e.is_nft;return(0,n.jsx)(c.default,{className:(0,u.vou)(t,"CallParticipantList__list__item--nft"),selectable:!1,border:!1,aside:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p.OutlinedButton,{onClick:()=>m(e.peerId),mode:"secondary",children:h("calls_waiting_hall_forbid")}),(0,n.jsx)(p.OutlinedButton,{onClick:()=>a(e.peerId),children:h("calls_waiting_hall_join")})]}),children:(0,n.jsx)(s.default,{onLinkClick:(t,a)=>{g(t,a,e.peerId)},photo:(0,n.jsx)(l.CallPhoto,{id:e.peerId,photo:e.photo,alt:e.name||"",size:(0,u.vou)(t,38),isNFT:t}),title:e.name,href:e.link,target:"_blank"})},e.peerId)}))})]})}},816398:(e,t,a)=>{"use strict";a.d(t,{WarningDesktopApp:()=>h});var n=a(785893),o=a(667294),i=a(647605),r=a(571150),s=a(291100),l=a(589897),c=a(346880),d=a(899426),u=a(22412),p=a(274706),_=a(659397),m=a(796317);const h=({onClose:e,onClickJoin:t,isSferum:a})=>{const{getLang:h}=(0,o.useContext)(c.LangContext),{enableSferumNewLinks:g}=(0,o.useContext)(m.ConfigContext),A=(0,d.getPlatformUrl)(a,g),C=p.Platform.OS===p.OS.LINUX?"Linux":p.Platform.OS===p.OS.MAC?"macOS":p.Platform.OS===p.OS.WINDOWS?"Windows":null,[v,f]=(0,o.useState)(null!==_.localStorage.getItem(u.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED)),S=C?h("calls_warning_native_app_button_for").replace("{name}",C):h("calls_warning_native_app_button"),E=null===C||p.Platform.BROWSER===p.BROWSER.FIREFOX,T=h(a?"calls_browser_warning_text":"calls_warning_native_app_text");return(0,n.jsxs)("div",{className:"WarningDesktopApp",children:[(0,n.jsx)(i.Icon24ErrorCircleOutline,{fill:"#FF5C5C"}),(0,n.jsx)("span",{className:"WarningDesktopApp--title",children:h("calls_warning_native_app_title")}),(0,n.jsx)("span",{className:"WarningDesktopApp--text",children:T}),!a&&(0,n.jsxs)(n.Fragment,{children:[!v&&!E&&(0,n.jsx)(l.default,{size:"m",onClick:()=>{A&&((0,d.download)(A.url,A.filename),(0,d.setDownloadedFlag)(),f(!0))},mode:"overlay_primary",children:S}),!v&&E&&(0,n.jsxs)("a",{href:u.DESKTOP_CALLS_DOWNLOAD_PAGE,rel:"noopener noreferrer",target:"_blank",className:"WarningDesktopApp--link",onClick:()=>{(0,d.setDownloadedFlag)(),f(!0)},children:[S," ",(0,n.jsx)(r.Icon12Chevron,{className:"NotificationDesktopApp--angleIcon"})]}),v&&(0,n.jsx)(l.default,{size:"m",onClick:t,mode:"overlay_primary",children:h("calls_warning_native_app_join_button")})]}),(0,n.jsx)(s.Icon12CancelOutline,{className:"WarningDesktopApp--close",onClick:e,width:16,height:16})]})}},405231:(e,t,a)=>{"use strict";a.d(t,{AdminPinUnmuteRequestContainer:()=>h});var n=a(785893),o=a(667294),i=a(396901),r=a(50533),s=a(589897),l=a(22412),c=a(346880),d=a(916188),u=a(737666),p=a(464380),_=a(205805),m=a(465768);const h=()=>{const e=(0,_.useCallsSDK)(),t=(0,i.useTypedDispatch)(),{getLang:a}=(0,o.useContext)(c.LangContext),h=(0,r.useSelector)((e=>e)),g=h.localDevice.mediaSettings,A=()=>{t({type:l.E_ACTION.TOGGLE_POPUP})};return(0,n.jsx)(u.AdminPinUnmuteRequestModal,{onClose:A,title:a("calls_admin_pin_dialog_title"),description:a("calls_admin_pin_dialog_description"),actionButtons:[(0,n.jsx)(s.default,{size:"m",onClick:A,mode:"secondary",children:a("calls_admin_pin_dialog_cancel")},"cancel"),(0,n.jsx)(s.default,{size:"m",mode:"primary",onClick:()=>{(g.isAudioEnabled?Promise.resolve():(0,d.checkPermissions)(e,[p.MediaOption.AUDIO])).then((()=>{var a;(null==(a=h.notification)?void 0:a.type)===l.NotificationType.SPEAKING_ON_MUTE&&t({type:l.E_ACTION.CALL_NOTIFICATION,notification:null}),e.toggleLocalAudio(!0).catch(m.handlePromiseError)})).then((()=>A()))},children:a("calls_admin_pin_dialog_action")},"mic")]})}},307696:(e,t,a)=>{"use strict";a.d(t,{App:()=>me});var n=a(434788),o=a(785893),i=a(667294),r=a(50533),s=a(396901),l=a(22412),c=a(85269),d=a(941596),u=a(287282),p=a(700286),_=a(752333),m=a(738603),h=a(550942),g=a(7780),A=a(966606),C=a(352993),v=a(249622),f=a(212169),S=a(553369),E=a(970196),T=a(868714),I=a(534447),y=a(816352),N=a(617502),b=a(998507),x=a(678512),M=a(763080),O=a(728097),P=a(405231),R=a(879965),k=a(317545),w=a(882191),D=a(948937),L=a(977708),j=a(935005),B=a(534748),U=a(254313),H=a(285336),F=a(201702),V=a(977615),G=a(464380),W=a(495457),$=a(878198),z=a(102093),Z=a(465127),K=a(504580),Q=a(81335),Y=a(119011),q=a(284540),J=a(578643),X=a(435629),ee=a(258068),te=a(581519),ae=a(940241),ne=a(725446),oe=a(376855),ie=a(405288),re=a(879303),se=a(205805),le=a(731905),ce=a(678025),de=a(913350),ue=a(496111),pe=a(675231),_e=a(227336);const me=({SDK:e,bridge:t,onBeforeCallStart:a,onAfterCallFinish:me,tabIsMaster:he,callSounds:ge,onHandCountChanged:Ae,onSuccessFeedback:Ce,okPublicKey:ve,config:fe,streamUrlExtractor:Se})=>{var Ee,Te,Ie,ye,Ne,be,xe;const{incomingCall:Me,showFeedbackScreen:Oe,enableVmoji:Pe,sferum:Re}=fe,ke=(0,r.useSelector)((e=>e)),we=(0,s.useTypedDispatch)();(0,de.useCallLongpollQueue)(),(0,pe.useCallLongpollAnonymQueue)();const De=(0,i.useCallback)((()=>{we({type:l.E_ACTION.CHANGE_MODE,mode:l.Mode.READY})}),[]),[Le,je]=(0,i.useState)(null),Be=(0,i.useCallback)((e=>{we({type:l.E_ACTION.ERROR,text:e})}),[]),Ue=(0,i.useCallback)((()=>we({type:l.E_ACTION.CHANGE_MODE,mode:l.Mode.READY})),[]);(0,i.useEffect)((()=>ke.mode===l.Mode.CALL?((0,W.increaseCallsCount)(),(0,b.wakeLockRequest)(),()=>{(0,b.wakeLockRelease)()}):()=>{}),[ke.mode]),(0,f.useFullScreen)(ke.uiMode===l.UIMode.FULLSCREEN&&ke.mode===l.Mode.CALL,(()=>{var e;window.FastChat&&(je(window.FastChat.getFullScreenState()),window.FastChat.toggleFullScreenState(!0)),(null==window||null==(e=window.reforgedME)?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!0,"call")}),(()=>{var e;ke.uiMode===l.UIMode.FULLSCREEN&&we({type:l.E_ACTION.CHANGE_UI_MODE,mode:l.UIMode.DEFAULT}),window.FastChat&&(window.FastChat.toggleFullScreenState(Le),je(null)),(null==window||null==(e=window.reforgedME)?void 0:e.setCollapsed)&&window.reforgedME.setCollapsed(!1,"call")}),[ke.uiMode,ke.mode]),(0,S.usePriorities)(e,ke),(0,i.useEffect)((()=>{if(ke.mode===l.Mode.CALL&&((0,W.increaseCallsCount)(),ke.callsCount%3==0)){const e=setTimeout((()=>we({type:l.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!0})),1e3);return()=>clearTimeout(e)}}),[ke.mode]);const He=(0,i.useMemo)((()=>{const e=ke.localDevice;return(0,ue.participantIsAdmin)(e)}),[ke.localDevice]),Fe=(0,i.useMemo)((()=>(0,Z.isSupported)()),[]),Ve=(0,K.isBrowserSupported)()&&Boolean(Pe)&&!Re&&!(0,ue.isParticipantAnonym)(ke.me);return(0,le.useSetEffectsLsAppType)(),(0,ce.useCallReactions)(),(0,_e.useScreenShareNotVisibleStat)(ke.mode===l.Mode.CALL),(0,o.jsx)(h.CallsErrorBoundary,{SDK:e,mode:ke.mode,onReset:Ue,children:(0,o.jsxs)(se.CallsSdkProvider,{SDK:e,children:[(Me||he())&&(0,o.jsx)(p.AudioContainer,{onBeforeCallStart:a,onAfterCallFinish:me,callSounds:ge}),ke.localDevice.status!==G.ParticipantStatus.WAITING_HALL&&ke.mode===l.Mode.CALL&&ke.uiMode!==l.UIMode.COLLAPSED&&(0,o.jsx)(d.CallContainer,{isVirtualBackgroundSupported:Fe,isVmojiSupported:Ve,onHandCountChanged:Ae}),ke.localDevice.status===G.ParticipantStatus.WAITING_HALL&&ke.mode===l.Mode.CALL&&ke.uiMode!==l.UIMode.COLLAPSED&&(0,o.jsx)(H.WaitingHallContainer,{}),ke.mode===l.Mode.INCOMING&&ke.uiMode!==l.UIMode.COLLAPSED&&(0,o.jsx)(c.IncomingCallContainer,{bridge:t}),ke.localDevice.status!==G.ParticipantStatus.WAITING_HALL&&ke.mode!==l.Mode.READY&&ke.uiMode===l.UIMode.COLLAPSED&&(0,o.jsx)(u.CollapsedCallContainer,{}),ke.localDevice.status===G.ParticipantStatus.WAITING_HALL&&ke.mode!==l.Mode.READY&&ke.uiMode===l.UIMode.COLLAPSED&&(0,o.jsx)(U.CollapsedWaitingHallContainer,{}),ke.mode===l.Mode.START&&ke.uiMode!==l.UIMode.COLLAPSED&&(0,o.jsx)(j.StartCallContainer,{}),Oe&&ke.mode===l.Mode.FEEDBACK&&(0,o.jsx)(D.FeedbackContainer,{onSuccessFeedback:Ce}),ke.mode===l.Mode.CALL_BY&&(0,o.jsx)(B.CallByNameContainer,{bridge:t}),ke.mode===l.Mode.JOIN&&(0,o.jsx)(A.JoinScreenContainer,(0,n._)({},ke.join,{bridge:t,withPopup:!0,onClose:De,onError:Be,okPublicKey:ve})),ke.mode===l.Mode.CREATE_CALL&&(0,o.jsx)(z.CreateCallByLinkContainer,{bridge:t}),ke.errorShown&&(0,o.jsx)(C.ErrorContainer,{title:null==(Ee=ke.error)?void 0:Ee.title,text:null==(Te=ke.error)?void 0:Te.text,handleType:null==(Ie=ke.error)?void 0:Ie.handleType,callId:null==(ye=ke.error)?void 0:ye.callId,bridge:t,onCloseFatal:De}),ke.cautionShown&&(0,o.jsx)(E.CautionContainer,{isIncoming:ke.isIncoming}),ke.groupCallSetup&&(0,o.jsx)(_.GroupCallSetupContainer,{}),ke.isManagementOpen&&(0,o.jsx)(g.CallManagementContainer,{bridge:t}),ke.popup===l.POPUP_SETTINGS&&(0,o.jsx)(m.SettingsContainer,{}),ke.popup===l.POPUP_TRANSLATION&&(0,o.jsx)(x.TranslationContainer,{},l.POPUP_TRANSLATION),ke.popup===l.POPUP_RECORD&&(0,o.jsx)(x.TranslationContainer,{isRecord:!0},l.POPUP_RECORD),ke.popup===l.POPUP_TRANSLATION_START_COUNTDOWN&&(0,o.jsx)(k.TranslationStartCountdownContainer,{}),ke.popup===l.POPUP_TRANSLATION_STOP&&(0,o.jsx)(M.TranslationStopContainer,{}),ke.popup===l.POPUP_TRANSLATION_SHARE&&(0,o.jsx)(O.TranslationShareContainer,{link:ke.translation.link,linkExtractor:Se}),ke.popup===l.POPUP_EXIT&&(0,o.jsx)(v.CallExitContainer,{bridge:t}),ke.popup===l.POPUP_TRANSFER_ADMIN_RIGHTS&&(0,o.jsx)(R.TransferAdminRightsContainer,{}),(0,$.hasIn)(ke.popup,l.POPUP_UNMUTE_REQUEST,l.POPUP_UNMUTE_AUDIO_REQUEST,l.POPUP_UNMUTE_VIDEO_REQUEST)&&(0,o.jsx)(I.UnmuteRequestContainer,{popup:ke.popup}),ke.popup===l.POPUP_ADMIN_PIN_UNMUTE_REQUEST&&(0,o.jsx)(P.AdminPinUnmuteRequestContainer,{}),(0,$.hasIn)(ke.popup,l.POPUP_ON_CALL_HANGUP_BUSY,l.POPUP_ON_CALL_HANGUP_KILLED,l.POPUP_ON_CALL_HANGUP_BANNED,l.POPUP_ON_CALL_HANGUP_REMOVED,l.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE)&&(0,o.jsx)(Q.OnHangupContainer,{}),(null==(Ne=ke.misc)?void 0:Ne.popupCalendarPlanning)===l.POPUP_ON_CALL_SEND_LINK&&(0,o.jsx)(Y.SendLinkContainer,{}),(null==(be=ke.misc)?void 0:be.popupCalendarPlanning)===l.POPUP_SHARE_PLANNED_CALL&&(0,o.jsx)(q.ModalAddToCalendarContainer,{}),(null==(xe=ke.misc)?void 0:xe.popupCalendarPlanning)===l.POPUP_PLAN_CALENDAR_EVENT&&(0,o.jsx)(J.ModalPlanCalendarEventContainer,{}),ke.popup===l.POPUP_MOVIE_CHOOSE&&(0,o.jsx)(X.MovieChooseContainer,{}),ke.popup===l.POPUP_ROOM_REQUEST_HELP&&(0,o.jsx)(te.RoomRequestHelpContainer,{}),He&&ke.popup===l.POPUP_ROOM_CHOOSE&&(0,o.jsx)(ee.RoomChooseContainer,{}),He&&ke.popup===l.POPUP_ROOM_CONTROL_CREATE&&(0,o.jsx)(ae.RoomControlCreateContainer,{}),He&&ke.popup===l.POPUP_ROOM_CONTROL&&(0,o.jsx)(ne.RoomControlContainer,{}),He&&ke.popup===l.POPUP_ROOM_HELP_REQUESTED&&(0,o.jsx)(oe.RoomHelpRequestedContainer,{}),ke.popup===l.POPUP_ASR&&(0,o.jsx)(ie.ModalAsrContainer,{}),Fe&&(0,o.jsx)(F.VirtualBackgroundSettingsContainer,{}),Ve&&(0,o.jsx)(V.VmojiSettingsContainer,{bridge:t}),ke.popup===l.POPUP_ROOM_LEAVE_REMOVE_WATCH_TOGETHER&&(0,o.jsx)(re.RoomLeaveRemoveWatchTogetherModalContainer,{}),ke.participantKick&&(0,o.jsx)(w.KickParticipantContainer,{}),ke.membersUnban&&(0,o.jsx)(L.UnbanParticipantContainer,{}),ke.participantsManagement&&(0,o.jsx)(T.MuteParticipantContainer,{}),ke.adminAssignment&&(0,o.jsx)(y.AssignAdminContainer,{}),ke.isLoaderVisible&&(0,o.jsx)(N.default,{})]})})}},533108:(e,t,a)=>{"use strict";a.d(t,{AsrStatusContainer:()=>A});var n=a(785893),o=a(47988),i=a(881310),r=a(571181),s=a(915961),l=a(791640),c=a(490287),d=a(974),u=a(430065),p=a(174583),_=a(668778),m=a(659397),h=a(334909),g=a(496111);const A=()=>{const e=(0,c.useTypedSelector)(d.getMyExternalId),t=(0,c.useTypedSelector)(u.getIsAsrFeatureEnabled),a=(0,c.useTypedSelector)(u.getIsAsrListFeatureEnabled),A=(0,c.useTypedSelector)(p.getAsrState),C=(0,_.useAsrOwner)(),{getLang:v}=(0,s.useLang)(),f=(0,r.useAsrPopup)(),S=(0,l.useIsMeCanManageAsr)();if(!A||!t)return null;const E=(0,n.jsxs)(n.Fragment,{children:[a&&(0,n.jsx)(i.DropdownActionSheetItem,{onClick:h.openAsrList,children:v("calls_asr_status_go_to_asr_list_action")}),(0,n.jsx)(i.DropdownActionSheetItem,{onClick:f,children:v("calls_asr_status_stop_action")})]}),T=(0,m.decodeHTMLEntities)((null==C?void 0:C.customName)||(null==C?void 0:C.shortName)||(null==C?void 0:C.name)||"");return(0,n.jsx)(o.AsrStatus,{actions:E,isCanManage:S,ownerName:T,isMeOwner:(0,g.isSameExternalId)(e,A.externalId)})}},816352:(e,t,a)=>{"use strict";a.d(t,{AssignAdminContainer:()=>A});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(589897),l=a(22412),c=a(496111),d=a(346880),u=a(162532),p=a(692837),_=a(732297),m=a(495457),h=a(464380),g=a(205805);const A=()=>{const e=(0,g.useCallsSDK)(),t=(0,i.useSelector)((e=>e.adminAssignment?e.participants[e.adminAssignment.participant.peerId]:void 0)),a=(0,i.useSelector)((e=>e)),A=(0,r.useTypedDispatch)(),[C,v]=(0,o.useState)(!0),[f,S]=(0,o.useState)(""),{getLang:E}=(0,o.useContext)(d.LangContext);(0,o.useEffect)((()=>{A({type:l.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise(((e,a)=>{t&&t.peerId<0?(0,u.getGroupById)(-t.peerId).then((({groups:t})=>{var a;e(t&&t.length>0&&(null==(a=t[0])?void 0:a.name)||"")})).catch((e=>a(e))):(0,u.loadUsers)({user_ids:t&&String(t.peerId),name_case:"Dat"}).then((([t])=>{e(`${null==t?void 0:t.first_name} ${null==t?void 0:t.last_name}`)})).catch((e=>a(e)))})).then((e=>{S(e),v(!1),A({type:l.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)}),[t]);const T=(0,o.useCallback)((()=>{A({type:l.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT})}),[]),I=(0,o.useCallback)((()=>{const n=(0,c.getParticipantExternalId)(t);n?(e.grantRoles(n,[h.UserRole.ADMIN],!1).then((()=>{t&&A({type:l.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:t.peerId,data:t.roles?[...t.roles,h.UserRole.ADMIN]:[h.UserRole.ADMIN]})})).catch(console.log),_.callStats.logEvent({call_event_type:l.CallActionEventType.ASSIGN_ADMIN,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,m.isGroupCallByPeer)(a.peer)}),T()):T()}),[]);return C?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(p.AssignAdminModal,{onClose:T,title:E("calls_dialog_assign_admin_role_title"),description:E("calls_dialog_assign_admin_role_description").replace("{name}",f),actionButtons:[(0,n.jsx)(s.default,{size:"m",onClick:T,mode:"secondary",children:E("calls_dialog_assign_admin_role_action_later")},"cancel"),(0,n.jsx)(s.default,{size:"m",mode:"primary",onClick:I,children:E("calls_dialog_assign_admin_role_action_primary")},"primary")]})}},700286:(e,t,a)=>{"use strict";a.d(t,{AudioContainer:()=>C});var n=a(434788),o=a(785893),i=a(667294),r=a(50533),s=a(22412),l=a(765789),c=a(495457),d=a(464380),u=a(496111),p=a(878198);const _="incoming",m="outgoing",h="connecting",g="connected",A="end";function C(e){const{onBeforeCallStart:t,onAfterCallFinish:a,callSounds:C}=e,v=(0,r.useSelector)((e=>e)),f=(0,i.useRef)(),S={[_]:(0,i.useRef)(null),[m]:(0,i.useRef)(null),[h]:(0,i.useRef)(null),[g]:(0,i.useRef)(null),[A]:(0,i.useRef)(null)},E={controls:!1,preload:"auto"},T=(0,i.useCallback)((e=>{const t=S[e].current;t&&t.paused&&t.play().catch((()=>{}))}),[]),I=(0,i.useCallback)((e=>{const t=S[e].current;t&&!t.paused&&(t.pause(),t.currentTime=0)}),[]),y=(0,i.useCallback)((()=>{Object.keys(S).forEach(I)}),[]),N=(0,i.useCallback)((e=>{const t=S[e].current;if(t){const e=t.volume;t.volume=0,t.play().catch((()=>{})),t.pause(),t.currentTime=0,t.volume=e}}),[]),b=(0,i.useCallback)((()=>{t&&t()}),[t]),x=(0,i.useCallback)((()=>{a&&a()}),[a]);return(0,i.useEffect)((()=>(l.browser.safari&&document.body.addEventListener("mousedown",(function e(){Object.keys(S).forEach(N),document.body.removeEventListener("mousedown",e)})),()=>{y(),x()})),[]),(0,i.useEffect)((()=>{const e=f.current||v,t=v;e.mode!==t.mode&&(e.mode!==s.Mode.READY||t.mode!==s.Mode.INCOMING&&t.mode!==s.Mode.CALL||b(),e.mode===s.Mode.INCOMING&&I(_),t.mode===s.Mode.INCOMING&&T(_),t.mode!==s.Mode.READY||e.mode!==s.Mode.INCOMING&&e.mode!==s.Mode.CALL||(y(),T(A),x()));const a=t.me,n=e.participants,o=t.participants,i=e.localDevice.status,r=t.localDevice.status,l=e.devices,C=t.devices;i!==r&&(i===d.ParticipantStatus.CONNECTING&&I(h),r===d.ParticipantStatus.CONNECTING&&T(h));const S=(0,p.objectSome)(o,(({peerId:e})=>!!n[e]&&(0,u.someDeviceByParticipant)(n[e],(({status:e})=>e===d.ParticipantStatus.CONNECTED)))),E=(0,p.objectSome)(o,(({peerId:e})=>{const t=l[e],a=C[e];return t&&a&&t.status!==a.status&&a.status===d.ParticipantStatus.CONNECTED}));!S&&E&&T(g),t.mode===s.Mode.CALL&&(!function(e,t,a,n){let o=!1;for(const i of Object.values(e)){if(i.peerId===t)continue;if((0,u.someDeviceByParticipant)(i,(e=>e.status===d.ParticipantStatus.CONNECTED)))return!1;(0,u.someDeviceByParticipant)(i,(e=>e.status===d.ParticipantStatus.WAITING))&&(!n||a.has(i.peerId))&&(o=!0)}return o}(o,a,t.participantsAddedByMe,(0,c.isGroupCallByPeer)(v.peer))?I(m):T(m)),f.current=v}),[v]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("audio",(0,n._)({src:C.incoming,ref:S[_],loop:!0},E)),(0,o.jsx)("audio",(0,n._)({src:C.outgoing,ref:S[m],loop:!0},E)),(0,o.jsx)("audio",(0,n._)({src:C.connected,ref:S[g],loop:!1},E)),(0,o.jsx)("audio",(0,n._)({src:C.connecting,ref:S[h],loop:!0},E)),(0,o.jsx)("audio",(0,n._)({src:C.end,ref:S[A],loop:!1},E))]})}},534748:(e,t,a)=>{"use strict";a.d(t,{CallByNameContainer:()=>E});var n=a(11010),o=a(434788),i=a(785893),r=a(667294),s=a(396901),l=a(504900),c=a(292065),d=a(346880),u=a(22412),p=a(162532),_=a(617502),m=a(212169),h=a(465768),g=a(226028),A=a(86894),C=a(146679),v=a(659397),f=a(953063),S=a(490287);const E=({bridge:e})=>{var t;const{nameOptions:a,changeNameOptions:E}=(0,g.useChangeNameOptions)(),T=(0,S.useTypedSelector)((({me:e,participants:t,config:a,callByName:n})=>({me:e,participants:t,config:a,callByName:n}))),I=(0,s.useTypedDispatch)(),[y,N]=(0,r.useState)([]),[b,x]=(0,r.useState)(!(0,v.isUndefined)(a.id)&&Number.isInteger(a.id)?a.id:T.me),{getLang:M}=(0,r.useContext)(d.LangContext),[O,P]=(0,r.useState)(""),R=(0,r.useCallback)((e=>e.name),[]),k=(0,r.useCallback)((e=>e.id),[]),w=(0,m.useIndexer)([],R,k),D=(0,f.useFetchData)({cb:p.callsCheckParticipantName}),L=T.participants[T.me],j=T.config.enableChangeName,B=!(null==(t=T.callByName)?void 0:t.callId),[U,H]=(0,r.useState)((0,C.decode)((null==a?void 0:a.name)||L.name)),[F,V]=(0,r.useState)(!1),G=O?w.search(O):y,W=y.find((e=>e.id===b)),$=(0,r.useCallback)((e=>{P(e.target.value)}),[]),z=(e,t)=>{const a="id"in e?e.id:e.peerId,n=("id"in e?"/"+e.screen_name:e.link)||"",o=("id"in e?e.photo_100:e.photo)||"";return{id:t===u.CallByNameProfileType.GROUP?-a:a,name:(0,C.decode)(e.name),link:n,photo:o,isNFT:"is_nft"in e&&e.is_nft,type:t}};(0,r.useEffect)((()=>{let e=[z(L,u.CallByNameProfileType.PROFILE)];(0,p.getGroupsForCall)().then((t=>{t.count>0&&t.items.forEach((t=>{e.push(z(t,u.CallByNameProfileType.GROUP))}))})).catch(h.handlePromiseError).finally((()=>{N(e),e.forEach((e=>w.add(e)))}))}),[]);const Z=(null==W?void 0:W.type)===u.CallByNameProfileType.GROUP,K=!Z,Q=(0,r.useCallback)((t=>{if(!T.callByName)return;const{peerId:a,entryPoint:n,joinLink:o}=T.callByName;o?e.joinCallByLink(o,void 0,t,n,Z?b:0):a?e.call(a,t,void 0,n,Z?b:0):e.startCall(t,n,!0,Z?b:0)}),[W]),Y=e=>{x(e);const t=y.find((t=>t.id===e));(null==t?void 0:t.type)===u.CallByNameProfileType.ANONYM?H(""):H((null==t?void 0:t.name)||""),V(!1)},q=()=>{var e;const t=null==(e=T.callByName)?void 0:e.withPopup;I(t?{type:u.E_ACTION.CHANGE_MODE,mode:u.Mode.JOIN}:{type:u.E_ACTION.CHANGE_MODE,mode:u.Mode.READY})},J=(0,n._)((function*(){const e=(null==W?void 0:W.name)!==U&&!Z;(!e||!(yield D.fetchData({name:U}).then((e=>(e.is_valid||V(!0),e.is_valid))).catch(h.handlePromiseError)))&&e||(E((0,o._)({},W,{name:U})),q())})),X=(0,r.useCallback)((e=>{H(e.target.value),V(!!e.target.value.length&&!u.NAME_REGEX.test(e.target.value))}),[]),ee=(0,r.useCallback)((()=>{H(""),V(!1)}),[]);if(!y.length)return(0,i.jsx)(_.default,{});const te=[(0,i.jsx)(A.Button,{onClick:()=>Q(!1),mode:"secondary",children:M("calls_call_by_name_audio_button")},"callByNameByAudio"),(0,i.jsx)(A.Button,{onClick:()=>Q(!0),children:M("calls_call_by_name_video_button")},"callByNameByVideo")],ae=[(0,i.jsx)(A.Button,{onClick:q,size:"m",mode:"secondary",children:M("calls_cancel")},"changeNameCancel"),(0,i.jsx)(A.Button,{onClick:J,size:"m",disabled:!U.length||F,children:M("calls_save")},"changeNameSave")];return!j||B?(0,i.jsx)(l.CallByNameModal,{items:G,actionButtons:te,selectedId:b,onListItemClick:Y,onClose:q,participantMe:L,onSearchChange:$}):(0,i.jsx)(c.CallChangeNameModal,{items:y,actionButtons:ae,selectedId:b,onListItemClick:Y,onClose:q,participantMe:L,onNameChange:X,onClearName:ee,changedName:U,error:F,disabled:!K})}},941596:(e,t,a)=>{"use strict";a.d(t,{CallContainer:()=>he,handleCollapseCall:()=>ge});var n=a(434788),o=a(785893),i=a(667294),r=a(50533),s=a(490287),l=a(396901),c=a(152789),d=a(22412),u=a(319246),p=a(625460),_=a(331234),m=a(52929),h=a(850144),g=a(807083),A=a(37240),C=a(786695),v=a(417174),f=a(916188),S=a(495457),E=a(496111),T=a(911513),I=a(732297),y=a(647220),N=a(796317),b=a(774351),x=a(464380),M=a(7780),O=a(659397),P=a(1628),R=a(120617),k=a(38275),w=a(16694),D=a(800582),L=a(878198),j=a(787278),B=a(890713),U=a(773816),H=a(246743),F=a(558791),V=a(562090),G=a(737598),W=a(680093),$=a(323214),z=a(33454),Z=a(302617),K=a(844873),Q=a(668122),Y=a(94977),q=a(967979),J=a(198380),X=a(8589),ee=a(663187),te=a(870179),ae=a(438655),ne=a(119783),oe=a(205805),ie=a(326732),re=a(465768),se=a(102241),le=a(993240),ce=a(124798),de=a(743679),ue=a(455319),pe=a(755836),_e=a(167810);const me=5;function he(e){var t,a,b,he,Ae,Ce,ve,fe;const{onHandCountChanged:Se,isVirtualBackgroundSupported:Ee,isVmojiSupported:Te}=e,{navigateToConvo:Ie,navigateToProfile:ye}=(0,_e.useNavigationContext)(),Ne=(0,oe.useCallsSDK)(),{sendStatsData:be}=(0,Z.useSendStatsData)(),xe=(0,s.useTypedSelector)((e=>e)),Me=(0,E.isParticipantAnonym)(xe.me),Oe=xe.rooms,Pe=!xe.config.sferum&&!Me,Re=(0,s.useTypedSelector)(de.getWatchTogetherMovieState),ke=(0,s.useTypedSelector)(de.getWatchTogetherInfo),we=(0,s.useTypedSelector)(de.getWatchTogetherPinnedParticipant),De=(0,l.useTypedDispatch)(),{getLang:Le}=(0,F.useLangContext)(),{enableScreenTrack:je,enableProducerScreenTrack:Be}=(0,i.useContext)(N.ConfigContext),Ue=(0,ee.useOratorExternalId)(),He=(0,i.useRef)(null),Fe=xe.peer,Ve=(0,Y.useIsGroupCall)(),Ge=Ve?xe.callData.conversation:xe.participants[Fe],We=xe.localDevice,$e=We.mediaSettings,ze=U.MuteStatesHandler.isMediaAllowed("audio",xe.localDevice),Ze=U.MuteStatesHandler.isMediaAllowed("video",xe.localDevice),Ke=U.MuteStatesHandler.isMediaAllowed("screenSharing",xe.localDevice),Qe=(0,c.useActiveDevicesListCount)(),Ye=Qe>1,qe=Ye||(0,E.isParticipantWithVideo)(We)||Boolean(We.movieStream&&We.movieStreamInfo),{canTransferAdminRights:Je,showTransferAdminRightsDialog:Xe,showLeaveBox:et,leaveCall:tt,canFinishCall:at}=(0,pe.useLeaveCall)(xe,Qe),nt=(0,i.useMemo)((()=>xe.config.enableRoomControl&&(0,E.participantIsAdmin)(We)),[We.roles,xe.config.enableRoomControl]),ot=(0,i.useCallback)((()=>{De({type:d.E_ACTION.TOGGLE_POPUP,data:(0,L.isEmpty)(Oe.rooms)?d.POPUP_ROOM_CONTROL_CREATE:d.POPUP_ROOM_CONTROL})}),[Oe]),{onOpenWatchTogetherFeature:it}=(0,J.useCallFeaturesActions)(),rt=Ve||Qe>2,st=rt&&qe&&!xe.isOratorMode,lt=rt&&qe&&xe.isOratorMode,ct=null!==xe.adminPinnedParticipant,dt=!ct&&null!==xe.pinnedParticipant,ut=!dt&&null!==xe.screenSharingPinnedParticipant,pt=xe.uiMode===d.UIMode.FULLSCREEN,_t=(null==(t=xe.callData)?void 0:t.topology)===x.TransportTopology.SERVER,mt=(0,i.useMemo)((()=>Ne.browser.isScreenCapturingSupported()),[]),ht=!!xe.translation.deferredId&&!xe.translation.isOn,[gt,At]=(0,i.useState)(!1),[Ct,vt]=(0,i.useState)(!1),[ft,St]=(0,i.useState)(0),Et=(0,B.isUseParticipantListChunk)(xe),Tt=(0,i.useMemo)((()=>Et?(0,B.getActiveDevicesForChunk)(xe):(0,E.getActiveDevices)(xe)),[xe.devices,xe.participantsChunk,xe.adminPinnedParticipant,xe.gridScrollFirstVisible,xe.oratorScrollFirstVisible,xe.isOratorMode,xe.localDevice,xe.oratorScrollNumberOfVisible,xe.externalId,xe.rooms,Et]),[It,yt]=function(e){if(e.participantsChunk){const t=(0,B.getCountNotLoadedDevicesBeforeForList)(e.participantsChunk);return[t,t+e.participantsChunk.ids.length]}const t=e.isOratorMode,a=t?e.oratorScrollNumberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE,n=t?E.PARTICIPANTS_LIST_BUFFER_SIZE.ORATOR:E.PARTICIPANTS_LIST_BUFFER_SIZE.GRID,o=t?e.oratorScrollFirstVisible:e.gridScrollFirstVisible;return[o<n?0:o-n,o+a+n]}(xe),Nt=(0,i.useMemo)((()=>{const e=Tt.activeDevices;return Et?e:e.slice(It,yt)}),[Tt.activeDevices,Et,It,yt]),bt=(null==(a=xe.callData.conversation)?void 0:a.canAddMembers)&&!Me,xt=(0,i.useCallback)((()=>{(0,le.setWatchTogether)(De,{pinnedParticipant:null})}),[Oe.roomId]),Mt=(0,i.useCallback)(((e,t)=>{let a=(0,E.isSameExternalId)(xe.pinnedParticipant,t)?null:t;(0,E.isSameExternalId)(xe.screenSharingPinnedParticipant,t)&&(a=null),we&&xt(),xe.screenSharingPinnedParticipant&&(0,ce.setScreenSharingPinnedParticipant)(De),(0,ce.setPinnedParticipant)(De,a)}),[xe.pinnedParticipant,xe.screenSharingPinnedParticipant,we,xt]),Ot=(0,i.useCallback)(((e,t)=>{xe.isOratorMode||De({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),(0,E.isSameExternalId)(xe.pinnedParticipant,t)||(0,ce.setPinnedParticipant)(De,t)}),[xe.isOratorMode,xe.pinnedParticipant]),{handleMuteWatchTogetherParticipant:Pt}=(0,W.useMuteWatchTogetherHandlers)({SDK:Ne});(0,X.useCallVmoji)({activeParticipantsList:Nt});const Rt=(0,i.useMemo)((()=>Nt.map((e=>{var t,a,n,i,r,s,l;const{isAudioEnabled:c,isScreenSharingEnabled:d}=e.mediaSettings,u=(0,E.isSameExternalId)(e.externalId,xe.externalId),p=xe.participants[e.externalId.id],_=u?Le("calls_own_label"):(0,ue.getUserName)(p),m=(0,E.externalIdToString)(e.externalId);var h,g,C,v;if(!e.visible)return(0,o.jsx)(w.ParticipantLite,{externalId:e.externalId,isInfoShown:!0,isMe:u,isHandRaised:e.wasConnected&&(null==(h=e.statusData)||null==(g=h.hand)?void 0:g.state),hasAudio:!!c,photo:null==p?void 0:p.photo,name:_,letter:null!=(v=null==p||null==(C=p.name)?void 0:C[0])?v:"",wasConnected:e.wasConnected,onClickParticipant:Mt,isPinned:xe.isOratorMode&&(0,E.isSameExternalId)(xe.pinnedParticipant,e.externalId)||(0,E.isSameExternalId)(xe.screenSharingPinnedParticipant,e.externalId),isPinnedByAdmin:xe.isOratorMode&&(0,E.isSameExternalId)(xe.adminPinnedParticipant,e.externalId)},m);const f=(0,E.getAvailableStreamModes)(e),S=!u&&(null==(t=xe.callData)?void 0:t.topology)===x.TransportTopology.SERVER,I=xe.isOratorMode&&(je||Be)&&((null==(a=e.mediaSettings)?void 0:a.isVideoEnabled)||(null==(n=e.mediaSettings)?void 0:n.isAnimojiEnabled)),y=lt?(0,E.getSausageStream)(e,{isOrator:(0,E.isSameExternalId)(Ue,e.externalId),animojiBackendRender:S}):(0,E.getStream)(e,{animojiBackendRender:S}),N=!I&&!!d,b=(0,E.isParticipantWithVideo)(e),M=xe.localDevice.status===x.ParticipantStatus.CONNECTED?e.status:x.ParticipantStatus.CONNECTED,O=p&&(0,T.getParticipantActions)({state:xe,SDK:Ne,dispatch:De,participant:p,getLang:Le,navigateToConvo:Ie,navigateToProfile:ye,device:e,onWatchTogetherMute:Pt}),P=xe.isOratorMode&&(0,E.isSameExternalId)(xe.pinnedParticipant,e.externalId)||(0,E.isSameExternalId)(xe.screenSharingPinnedParticipant,e.externalId)||(0,E.isSameExternalId)(we,e.externalId);var R;return(0,o.jsx)(A.ParticipantWithIndicator,{externalId:e.externalId,isVisible:e.visible,isInfoShown:!0,isMe:u,isHandRaised:null==(i=e.statusData)||null==(r=i.hand)?void 0:r.state,hasVideo:!!b,hasAudio:!!c,isSharingScreen:!!N,streamData:y,photo:null==p?void 0:p.photo,name:_,letter:null!=(R=null==p||null==(s=p.name)?void 0:s[0])?R:"",status:M,allowContain:!1,wasConnected:e.wasConnected,networkStatus:e.networkStatus,onClickParticipant:xe.isOratorMode?Mt:void 0,onDblClickParticipant:xe.isOratorMode?void 0:Ot,actions:O,isPinned:P,isPinnedByAdmin:xe.isOratorMode&&(0,E.isSameExternalId)(xe.adminPinnedParticipant,e.externalId),availableStreamModes:f,isVmoji:!!(null==(l=e.mediaSettings)?void 0:l.isAnimojiEnabled)},m)}))),[Nt,xe.rooms.roomId,xe.externalId,xe.participants,xe.isOratorMode,xe.pinnedParticipant,xe.screenSharingPinnedParticipant,we,xe.adminPinnedParticipant,xe.groupId,xe.me,xe.peer,xe.config,xe.localDevice,xe.callData,xe.permissions,xe.onlyAdminCanShareMovie,Pe,Pt,Ue,lt]),kt=(0,G.useIsMeCanManageWatchTogether)(),wt=e=>{De({type:d.E_ACTION.CHANGE_UI_MODE,mode:e})},Dt=(0,i.useCallback)((()=>{ge({uiMode:xe.uiMode,changeUIMode:wt})}),[xe.uiMode]);(0,j.useNavGoListener)(Dt),(0,j.useBoxLayerObserver)(Dt);const Lt=(0,i.useCallback)((()=>{De({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!xe.isOratorMode})}),[xe.isOratorMode]),jt=(0,i.useCallback)((()=>{De({type:d.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE,isShownParticipantsAside:!xe.isShownParticipantsAside})}),[xe.isShownParticipantsAside]),Bt=(0,i.useCallback)((()=>{De({type:d.E_ACTION.MANAGEMENT,isOpen:!0})}),[]),Ut=(0,i.useCallback)((()=>{De({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:M.ManagementViews.CALL_LINK})}),[]),Ht=(0,i.useCallback)((()=>{if(Ct)return;const e=!$e.isVideoEnabled||!!$e.isScreenSharingEnabled&&!je;(e?(0,f.checkPermissions)(Ne,[x.MediaOption.VIDEO]):Promise.resolve()).then((()=>{vt(!0),je||$e.isScreenSharingEnabled&&Ne.captureScreen(!1),Ne.toggleLocalVideo(e).catch((()=>{})).finally((()=>{vt(!1)}))})),I.callStats.logEvent({call_event_type:e?d.CallActionEventType.VIDEO_ENABLED:d.CallActionEventType.VIDEO_DISABLED,session_id:xe.callData.callId,peer_id:xe.peer,is_group_call:(0,S.isGroupCallByPeer)(xe.peer),reason:e?void 0:"manual"})}),[$e,Ct,xe.callData.callId,xe.peer]),Ft=(0,i.useCallback)((()=>{let e=xe.peer;if(Oe.roomId){const t=(0,ae.roomIdToString)(Oe.roomId),a=Oe.roomChatIds[t];if(void 0===a)return;e=a}Ie(e)===j.ENavigateToConvoDirection.Messenger&&Dt()}),[xe.peer,xe.uiMode,Oe.roomId,Oe.roomChatIds]),Vt=(0,i.useCallback)((()=>{if(gt)return;const e=!$e.isAudioEnabled;(e?(0,f.checkPermissions)(Ne,[x.MediaOption.AUDIO]):Promise.resolve()).then((()=>{var t;At(!0),(null==(t=xe.notification)?void 0:t.type)===d.NotificationType.SPEAKING_ON_MUTE&&De({type:d.E_ACTION.CALL_NOTIFICATION,notification:null}),Ne.toggleLocalAudio(e).catch((()=>{})).finally((()=>{At(!1)}))}))}),[$e,gt]),Gt=(0,i.useCallback)((()=>{var e,t,a,o;const i=!(null==(e=We.statusData)||null==(t=e.hand)?void 0:t.state);Ne.changeParticipantState({hand:i?d.SdkHandType.RAISED:d.SdkHandType.LOWERED}),De({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,n._)({},We.statusData,{hand:{state:!(null==(a=We.statusData)||null==(o=a.hand)?void 0:o.state),ts:Date.now()}})}}),I.callStats.logEvent({call_event_type:i?d.CallActionEventType.HAND_RAISED:d.CallActionEventType.HAND_LOWERED,session_id:xe.callData.callId,peer_id:xe.peer,is_group_call:(0,S.isGroupCallByPeer)(xe.peer)})}),[null==(b=We.statusData)||null==(he=b.hand)?void 0:he.state,xe.callData.callId,xe.peer]),Wt=(0,i.useCallback)((()=>{De({type:d.E_ACTION.CHANGE_UI_MODE,mode:pt?d.UIMode.DEFAULT:d.UIMode.FULLSCREEN}),De({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[xe.uiMode]),$t=(0,i.useCallback)(((e,t)=>{De({type:d.E_ACTION.SET_TOOLTIP,tooltips:{[e]:t}})}),[]),zt=(0,i.useCallback)((()=>{De({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,i.useEffect)((()=>{ht&&$t("streaming",!0)}),[ht]);const Zt=(0,i.useRef)(0);(0,i.useEffect)((()=>{xe.isOratorMode||((e,t=0)=>{var a;const n=(null==(a=document.querySelectorAll('[data-calls-id="grid-item"]')[0])?void 0:a.offsetHeight)||1/0,o=Math.floor(e/n)*me,{activeDevices:i}=Tt;for(let e=0;e<i.length;e++){const a=t+e,n=a>=o&&a<o+30;i[e].visible!==n&&((0,E.isSameExternalId)(xe.externalId,i[e].externalId)?De({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:n}}):(0,P.throttleAccumulateDispatchParticipant)(De,i[e].externalId,{visible:n}))}})(xe.gridScrollPosition,(0,B.getCountNotLoadedDevicesBeforeForList)(xe.participantsChunk))}),[xe.isOratorMode,xe.uiMode,xe.gridScrollPosition,Tt.activeDevices,null==(Ae=xe.participantsChunk)?void 0:Ae.countBefore]);const Kt=(0,te.useTimeout)();(0,i.useEffect)((()=>{if(xe.isOratorMode){const e=()=>{((e,t=0)=>{const a=h.SAUSAGE_PARTICIPANT_HEIGHT+h.SAUSAGE_PARTICIPANT_MARGIN,n=Zt.current,o=Math.max(0,Math.floor(e/a)-1),i=Math.min(xe.config.videoSlotsCount,Math.floor(n/a+3)),{activeDevices:r}=Tt;for(let e=0;e<r.length;e++){const a=t+e,n=a>=o&&a<o+i;r[e].visible!==n&&((0,E.isSameExternalId)(xe.externalId,r[e].externalId)?De({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{visible:n}}):(0,P.throttleAccumulateDispatchParticipant)(De,r[e].externalId,{visible:n}))}})(xe.oratorScrollPosition,(0,B.getCountNotLoadedDevicesBeforeForList)(xe.participantsChunk))};Et?Kt.add(e,P.DEFAULT_THROTTLE_TIMEOUT):e()}}),[xe.externalId,xe.config.videoSlotsCount,xe.isOratorMode,xe.uiMode,xe.oratorScrollPosition,Tt.activeDevices,null==(Ce=xe.participantsChunk)?void 0:Ce.countBefore]);const Qt=(0,i.useCallback)((0,O.debounce)((e=>{var t;const a=(null==(t=document.querySelectorAll('[data-calls-id="grid-item"]')[0])?void 0:t.offsetHeight)||1/0,n=Math.floor(e/a)*me;(0,D.setScrollPosition)(xe,De,{type:d.E_ACTION.SET_GRID_SCROLL_POSITION,position:e,firstVisible:n,numberOfVisible:d.GRID_SCROLL_NUMBER_OF_VISIBLE},Ne)}),200),[]),Yt=(0,i.useRef)(0);Yt.current=Nt.length;const qt=(0,i.useCallback)((0,O.throttle)((e=>{const t=Yt.current?h.SAUSAGE_PARTICIPANT_HEIGHT+h.SAUSAGE_PARTICIPANT_MARGIN:1/0,a=Zt.current,n=Math.floor(e/t)-1,o=Math.min(xe.config.videoSlotsCount,a/t+3);(0,D.setScrollPosition)(xe,De,{type:d.E_ACTION.SET_ORATOR_SCROLL_POSITION,position:e,firstVisible:n,numberOfVisible:Math.floor(o)},Ne)}),100),[xe.config]),Jt=(0,q.useCallMenuActions)({isVirtualBackgroundSupported:Ee,isVmojiSupported:Te}),Xt=(0,ie.useSwitchRoomHandler)(),{toggleScreenShareDropdown:ea,isScreenShareDropdownShown:ta,handleStopScreenShare:aa,handleStartScreenShare:na,handleStartFastScreenShare:oa}=(0,se.useScreenShare)();(0,i.useEffect)((()=>()=>{De({type:d.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);const ia=(0,i.useCallback)((()=>{ct&&(0,E.canPinParticipants)(We)?(Ne.pinParticipant(xe.adminPinnedParticipant,!0,xe.rooms.roomId).then((()=>{De({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(re.handlePromiseError),I.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:xe.callData.callId,peer_id:xe.peer,is_group_call:(0,S.isGroupCallByPeer)(xe.peer)})):(0,r.batch)((()=>{xt(),(0,ce.setScreenSharingPinnedParticipant)(De),(0,ce.setPinnedParticipant)(De)}))}),[xe.adminPinnedParticipant,xe.peer,xe.callData.callId,xt,xe.rooms.roomId]),ra=(0,i.useMemo)((()=>(0,o.jsx)(R.NotificationWithButtonContainer,{})),[xe.waitingHall,xe.shouldShowDesktopAppNotification,xe.shouldShowWarningDesktopAppNotification,xe.join]);(0,i.useEffect)((()=>{if(!xe.callData.localTimeStamp&&!(0,S.isGroupCallByPeer)(xe.peer)&&!(0,k.getHangupStatus)(xe,Le)){const e=(0,E.getPeerIdDeviceInfo)(xe.peer,xe.devices);e&&e.status===x.ParticipantStatus.CONNECTED&&De({type:d.E_ACTION.LOCAL_TIME_START,data:Date.now()})}}),[xe]),(0,i.useEffect)((()=>{Ve&&St(Qe)}),[Qe]);const sa=(0,i.useRef)({}),la=(0,i.useRef)({}),ca=(0,i.useRef)(xe);ca.current=xe,(0,i.useEffect)((()=>{const e=ca.current,t=[],a=t=>{const a=e.devices[t],n=a&&e.participants[a.externalId.id],o=n?n.peerId:t.split(":")[0];var i;return!(+o===e.me)&&(!n||(0,L.isEmpty)(null==a?void 0:a.mediaSettings)||!n.name)&&(null!=(i=sa.current[o])?i:0)<5&&(void 0===la.current[o]||Date.now()-la.current[o]>1e4)},n=Date.now();for(const e of Nt){const i=(0,E.externalIdToString)(e.externalId),r=+e.externalId.id;var o;if(a(i))t.push(r),sa.current[r]=(null!=(o=sa.current[r])?o:0)+1,la.current[r]=n}for(const n of e.speakersInHeader)a(n)&&e.devices[n]&&t.push(+e.devices[n].externalId.id);if(window.Calls&&t.length>0){const a=e.callData.callId||"",n={withConversation:!e.callData.conversation,awaitImages:!1};(0,D.loadCallParticipantsAccumulate)(xe,De,window.Calls,a,t,n)}}),[xe.peer,xe.speakersInHeader,Nt]);const da=(0,E.getOrator)(xe),ua=da.device.streamMode===x.MediaType.MOVIE||da.device.streamMode===x.MediaType.STREAM,pa=xe.config.enableFastScreenSharingVK||xe.config.sferum&&xe.config.enableFastScreenSharingSferum,_a=(0,H.useContainerControlsVisibility)({isHardStop:!(ua&&pt)}),ma=!!Oe.roomId,ha=(0,V.useCallNotifications)("CallOrator__notification"),ga=(0,i.useCallback)((e=>{De({type:d.E_ACTION.SET_LOCAL_DEVICE,data:{lastChosenReaction:{key:e,ts:Date.now()}}}),Ne.feedback(e).then((()=>{be(Z.ECallActionEventType.REACTION_SENT,{reaction_type:e,session_id:xe.callData.callId})}))}),[xe.callData.callId]);return(0,o.jsx)(g.CallModal,{onClose:Je?Xe:at?et:tt,isCautionBoxShown:!Je&&!at,onBackdropClick:Dt,children:(0,o.jsx)(ne.FocusTrap,{hasFirstFocusableElement:!0,autoFocus:!0,children:(0,o.jsx)(p.Call,{ref:He,info:(0,o.jsx)(y.CallHeaderContainer,{isChainControls:bt,onChainClick:Ut,onHandCountChanged:Se}),callMenuActions:Jt,isVideoAllowed:$e.isVideoEnabled||Ze,isAudioAllowed:$e.isAudioEnabled||ze,isVideoEnabled:je?!!$e.isVideoEnabled:!!$e.isVideoEnabled&&!$e.isScreenSharingEnabled,isAudioEnabled:$e.isAudioEnabled,isScreenSharingEnabled:$e.isScreenSharingEnabled,isMovieStreamEnabled:Boolean(ke),isOratorMode:xe.isOratorMode,isFullScreen:pt,onToggleVideo:Ht,onToggleAudio:Vt,onLeaveCall:Je?Xe:at?et:tt,onToggleOratorMode:Lt,onFullScreenToggle:Wt,onTooltipChange:$t,onHidePanel:zt,onChat:Ft,onHandClick:Gt,isLayoutSwitchShown:Ve&&Ye,isHandRaised:null==(ve=We.statusData)||null==(fe=ve.hand)?void 0:fe.state,isHandControlShown:Ve,isChatControlShown:!!Fe&&!xe.groupId,isScreenShareControlShown:Ke&&mt,isStreamingControlShown:ht,isInRoom:ma,onLeaveRoom:()=>{Xt()},onDeferredStreamStart:()=>{if(xe.translation.deferredId){const e={isOn:!1,startStreamParams:{upcomingStreamParams:{ovId:xe.translation.deferredId}}};De({type:d.E_ACTION.SET_TRANSLATION,data:e}),De({type:d.E_ACTION.TOGGLE_POPUP,data:d.POPUP_TRANSLATION_START_COUNTDOWN})}},onParticipantsClick:Bt,chatUnreadCount:xe.chatUnreadCount,tooltips:xe.tooltips,notificationWithButton:ra,participantCount:ft,onOpenWatchTogetherFeature:it,isWatchTogetherEnabled:Pe,isCanManageWatchTogether:kt,isRoomControlShown:nt,onRoomControl:ot,callControlsVisibilityController:_a,handleReactionClick:ga,isFeedbackPanelEnabled:(0,K.isFeedbackPanelEnabled)(xe),iconReaction:(0,Q.useReactionsLastChosenIcon)(),refContentHeight:Zt,onCollapseCall:Dt,toggleScreenShareDropdown:ea,isScreenShareDropdownShown:ta,onStopScreenShare:aa,onStartFastScreenShare:oa,onStartScreenShare:na,isFastScreenSharingAvailable:pa,children:(0,o.jsxs)(o.Fragment,{children:[!lt&&ha,!rt&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(u.OneToOne,{}),(0,K.isFeedbackEnabled)(xe)&&(0,o.jsx)(z.CallReactionsP2P,{})]}),st&&(0,o.jsx)(_.CallGridNew,{onScroll:Qt,scrollPosition:xe.gridScrollPosition,participantsCount:Qe,participantsShiftCount:It,children:Rt}),lt&&(0,o.jsx)(m.CallOrator,{orator:da,onStopScreenShare:aa,handleShowCallControls:_a.handleShowControls,watchTogetherMovieState:Re,localExternalId:xe.externalId,me:xe.me,groupId:xe.groupId,meGroup:xe.meGroup,isPinned:dt,isPinnedByAdmin:ct,isPinnedByShareScreen:ut,isUnpinAllowed:(0,E.canPinParticipants)(We)||!ct,onUnpin:ia,tooltips:xe.tooltips,onTooltipChange:$t,onToggleParticipantsAside:jt,isShownParticipantsAside:xe.isShownParticipantsAside,onScroll:qt,scrollPosition:xe.oratorScrollPosition,participantsAsideCount:Qe,firstRenderedParticipantIndex:It,isFullScreen:pt,onFullScreenToggle:Wt,isServerTopology:_t,children:Rt}),rt&&!qe&&(0,o.jsx)(C.Stub,{children:(0,o.jsx)(v.CallPhoto,{id:Fe,photo:Ge&&Ge.photo||"",waves:!0,alt:Ge&&Ge.tab||"",className:"CallPhoto--orator",isOrator:!0})}),!(!st&&!lt||!(0,K.isFeedbackColumnEnabled)(xe))&&(0,o.jsx)($.CallReactionsColumn,{isGridView:st,isShownParticipantsAside:xe.isShownParticipantsAside,refCall:He})]})})})})}function ge({uiMode:e,changeUIMode:t}){e===d.UIMode.FULLSCREEN?((0,b.pause)(.3,null).then((()=>{t(d.UIMode.COLLAPSED)})),t(d.UIMode.DEFAULT)):t(d.UIMode.COLLAPSED)}},249622:(e,t,a)=>{"use strict";a.d(t,{CallExitContainer:()=>S});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(120107),l=a(22412),c=a(172927),d=a(732297),u=a(495457),p=a(496111),_=a(346880),m=a(135504),h=a(205805),g=a(723689),A=a(816511),C=a(592520),v=a(86894),f=a(935562);const S=({bridge:e})=>{const t=(0,h.useCallsSDK)(),a=(0,i.useSelector)((e=>e)),S=(0,r.useTypedDispatch)(),{getLang:E}=(0,o.useContext)(_.LangContext),{VKComKitModal:T}=e,{localDevice:I,entryPoint:y}=a,N=(0,o.useMemo)((()=>(0,g.isMiniAppSource)(y)),[y]),b=(0,o.useMemo)((()=>(0,p.participantIsAdmin)(I)),[I]),x=a.conversationOptions.find((e=>"RECURRING"===e)),M=()=>{d.callStats.logEvent({call_event_type:l.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,u.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:(0,p.getActiveParticipantsCount)(a)})},O=()=>{S({type:l.E_ACTION.TOGGLE_POPUP}),M(),(0,c.onForceCallFinish)(t,a,S,E)},P=()=>(S({type:l.E_ACTION.TOGGLE_POPUP}),M(),t.hangup()),R=(0,o.useCallback)((()=>{S({type:l.E_ACTION.TOGGLE_POPUP})}),[]),k=E(x?"calls_exit_call_disconnect_all":"calls_force_call_finish_v2"),w=E(x?"calls_exit_call_desc":"calls_sure_leave_call_v2");return N&&T?(0,n.jsx)(T,{onDestroy:R,children:({onClose:e})=>(0,n.jsxs)(A.ModalBox,{children:[(0,n.jsx)(C.ModalCardBase,{icon:(0,n.jsx)(f.Icon56PhoneOutline,{}),header:E("calls_leave_call_title"),actions:(0,n.jsxs)(v.ButtonGroup,{mode:"vertical",stretched:!0,children:[b&&(0,n.jsx)(v.ButtonGroup,{mode:"horizontal",gap:"s",stretched:!0,children:(0,n.jsx)(v.Button,{size:"l",mode:"tertiary",appearance:"accent",onClick:O,stretched:!0,children:k})}),(0,n.jsxs)(v.ButtonGroup,{mode:"horizontal",gap:"s",stretched:!0,children:[(0,n.jsx)(v.Button,{size:"l",mode:"secondary",onClick:e,stretched:!0,children:E("calls_cancel")}),(0,n.jsx)(v.Button,{size:"l",mode:"primary",onClick:P,stretched:!0,children:E("calls_exit")})]})]})}),(0,n.jsx)(v.ModalDismissButton,{onClick:e})]})}):(0,n.jsx)(s.CallExitModal,{onClose:R,actionButtons:[(0,n.jsx)(m.OutlinedButton,{onClick:O,"data-focus-first":!0,mode:"secondary",children:k},"forceCallFinish"),(0,n.jsx)(m.OutlinedButton,{onClick:P,children:E("calls_exit")},"leave")],description:w,title:E("calls_exit_call")})}},647220:(e,t,a)=>{"use strict";a.d(t,{CallHeaderContainer:()=>f});var n=a(785893),o=a(667294),i=a(50533),r=a(184779),s=a(779457),l=a(533108),c=a(495457),d=a(59547),u=a(496111),p=a(878198),_=a(346880),m=a(38275),h=a(403236),g=a(490287),A=a(430065),C=a(455319);const v=2;function f({onHandCountChanged:e,isChainControls:t,onChainClick:a}){const f=(0,i.useSelector)((e=>e)),S=(0,g.useTypedSelector)(A.getIsAsrShown),{isRoomShown:E}=(0,h.useRoomStatus)(),T=(0,c.isGroupCallByPeer)(f.peer),{getLang:I,langNumeric:y}=(0,o.useContext)(_.LangContext),[N,b]=(0,o.useState)(null),[x,M]=(0,o.useState)(0),[O,P]=(0,o.useState)(null);(0,o.useEffect)((()=>{const e=(0,c.isGroupCallByPeer)(f.peer)?f.callData.ts:f.callData.localTimeStamp;P((0,m.getCallTimer)(e));const t=setInterval((()=>P((0,m.getCallTimer)(e))),1e3);return()=>clearInterval(t)}),[f.peer,f.callData.localTimeStamp,f.callData.ts]),(0,o.useEffect)((()=>{const t=(0,u.getRaisedHands)({devices:f.devices,localDevice:f.localDevice,handState:f.handState,rooms:f.rooms});t!==x&&(M(t),e&&e(t))}),[f.devices,f.localDevice,f.handState,f.rooms]),(0,o.useEffect)((()=>{if(T){const e=f.speakersInHeader.reduce(((e,t)=>{const a=f.devices[t],n=a&&f.participants[a.externalId.id];return n&&(n.shortName||n.name)&&e.push(n),e}),[]);if(e.length>0){const t=I("calls_participants_speak",e.length).split(" ");b((0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"CallHeader__speak",children:[t[0]," "]}),(0,p.getParticipantsListLabel)(e,e.slice(0,v),C.getUserShortName,I,y,0,v)]}))}else b(null)}}),[f.participants,f.speakersInHeader,f.devices]);const R=(0,o.useMemo)((()=>{if(f.translation.isOn)return(0,n.jsx)(r.TranslationStatusContainer,{})}),[f.translation.isOn,f.translation.isRecord]);var k;return(0,n.jsx)(d.CallHeader,{asr:S?(0,n.jsx)(l.AsrStatusContainer,{}):null,translation:R,roomStatus:E?(0,n.jsx)(s.RoomStatusContainer,{}):null,isTranslationRecord:!(!f.translation.isOn||!f.translation.isRecord),speakers:T?N:null,hands:x,time:O,network:null!=(k=f.localDevice.networkStatus)?k:1,networkTooltipText:I("calls_status_bad_internet_connection"),isChainControls:t,onChainClick:a})}},7780:(e,t,a)=>{"use strict";a.d(t,{CallManagementContainer:()=>x,ManagementViews:()=>n});var n,o=a(785893),i=a(667294),r=a(50533),s=a(396901),l=a(490287),c=a(22412),d=a(645329),u=a(368754),p=a(77324),_=a(641623),m=a(752333),h=a(800582),g=a(172927),A=a(271831),C=a(346880),v=a(496111),f=a(511008),S=a(180625),E=a(495457),T=a(182330),I=a(879455),y=a(135504),N=a(205805),b=a(386633);!function(e){e[e.MAIN=0]="MAIN",e[e.CALL_LINK=1]="CALL_LINK",e[e.ADD_PARTICIPANTS=2]="ADD_PARTICIPANTS",e[e.WAITING_HALL=3]="WAITING_HALL",e[e.CHANGE_NAME=4]="CHANGE_NAME"}(n||(n={}));const x=({bridge:e})=>{var t,a;const n=(0,N.useCallsSDK)(),x=(0,r.useSelector)((e=>e)),M=(0,s.useTypedDispatch)(),O=(0,l.useTypedSelector)((e=>e.callData.callUrlLink||"")),P=x.managementView||0,[R,k]=(0,i.useState)(P),[w,D]=(0,i.useState)(!1),[L,j]=(0,i.useState)(!1),[B,U]=(0,i.useState)(!1),[H,F]=(0,i.useState)(!1),[V,G]=(0,i.useState)(!1),W=!!(null==(t=x.callData.conversation)?void 0:t.canAddMembers),$=(null==(a=x.callData)?void 0:a.canFinishCall)||0!==x.groupId&&O,{getLang:z}=(0,i.useContext)(C.LangContext),Z=(0,E.isRequireAuthToJoin)(x),K=(0,E.isWaitingHallEnabled)(x),Q=(0,i.useCallback)((()=>{M({type:c.E_ACTION.MANAGEMENT,isOpen:!1})}),[]),Y=(0,i.useCallback)((()=>{k(0)}),[]),q=e=>{const t=x.callData.callId||"";return D(!0),(0,h.loadCallUrlLink)(M,t,e,(0,E.isAuthedByGroupId)(x)?x.groupId:0).catch((e=>{console.error(e),M({type:c.E_ACTION.ERROR,text:z("calls_get_url_link_error_text")})})).finally((()=>{D(!1)}))},J=(0,i.useCallback)((()=>{k(1),O||q(!1).catch((()=>{k(0)}))}),[x.callData.callId,O]),X=(0,i.useCallback)((()=>{M({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});const t=[(0,h.loadFriendsAction)(e,x,M)].concat((0,A.isChatPeer)(x.peer)?[(0,h.loadChatMembersAction)(x,M,x.peer,x.callData.conversation)]:[]).concat(e.authorizedGroupId?[(0,h.loadAllowedToCallGroupMembersAction)(e,x,M)]:[]);return Promise.all(t).then((()=>{M({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),k(2)})).catch((e=>{console.error(e),M({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[x.peer,x.callData,x.friends,x.groupMembers]),ee=(0,i.useCallback)((()=>{M({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!0});const e=[(0,T.loadAdditionalWaitingHall)(x,M)];return Promise.all(e).then((()=>{M({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),k(3)})).catch((e=>{console.error(e),M({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}),[x.waitingHall]),te=(0,i.useCallback)((()=>{M({type:c.E_ACTION.TOGGLE_POPUP}),(0,g.onForceCallFinish)(n,x,M,z)}),[x.callData.callId,x.imHash]);(0,i.useEffect)((()=>{1===P&&J()}),[]),(0,i.useEffect)((()=>{4===P&&k(4)}),[x.managementView]),(0,i.useEffect)((()=>{const e=(0,v.participantIsAdmin)(x.localDevice),t=e;U(e),F(t),G(e)}),[x.localDevice]);const ae=(0,i.useCallback)((e=>{(0,h.setAnonymousJoin)(e)}),[]),ne=(0,i.useCallback)((e=>{(0,h.setWaitingHall)(e)}),[]),oe=(0,i.useCallback)((()=>j(!0)),[]),ie=(0,i.useCallback)((()=>j(!1)),[]),re=(0,i.useCallback)((()=>{q(!0).catch((()=>{k(0)}))}),[x.callData.callId,O]);return(0,o.jsxs)(o.Fragment,{children:[0===R&&(0,o.jsxs)(d.CallManagementModal,{title:z("calls_management_participants"),actionButtons:(0,o.jsxs)(o.Fragment,{children:[$&&(0,o.jsx)(y.OutlinedButton,{onClick:te,mode:"secondary",children:z("calls_force_call_finish")},"forceCallFinish"),(0,o.jsx)(y.OutlinedButton,{"data-focus-first":!0,onClick:n.hangup,children:z("calls_leave_call")},"leave")]}),onCloseModal:Q,children:[(0,o.jsx)(u.CallManagementMenu,{isLinkBlockShown:W,linkBlockTitle:z("calls_menu_link"),onLinkBlockClick:J,callUrlLink:O}),(0,o.jsx)(_.CallParticipantListContainer,{SDK:n,bridge:e,onAddClick:X,onShowMoreWaitingHall:ee})]}),1===R&&(0,o.jsxs)(d.CallManagementModal,{title:z("calls_management_link"),hint:Z?z("calls_management_link_anonymous_disallowed_hint"):"",onCloseModal:Q,isWithBackButton:1!==P,onBackClick:Y,actionButtons:(H?[(0,o.jsx)(y.OutlinedButton,{mode:"tertiary",onClick:re,children:z("calls_link_invalidate")},"invalidate-link")]:[]).concat([(0,o.jsx)(S.CopyText,{text:O,children:(0,o.jsx)(y.OutlinedButton,{"data-focus-first":!0,className:"CallManagementModal__copyTextButton",disabled:w,onClick:oe,children:z("calls_link_copy")})},"copy-link")]),children:[(0,o.jsx)(p.CallLink,{link:O,isLinkLoading:w,isCopied:L,hideCopiedText:ie}),B&&(0,o.jsx)(f.CallLinkSettings,{onRequireAuthToJoinChanged:ae,requireAuthToJoin:Z,isWaitingHallBlockShown:V,onWaitingHallEnabledChanged:ne,isWaitingHallEnabled:K})]}),2===R&&(0,o.jsx)(m.GroupCallSetupContainer,{isWithBackButton:!0,onBackClick:Y}),3===R&&(0,o.jsx)(I.WaitingHallListContainer,{isModal:!0,isWithBackButton:!0,onBackClick:Y}),4===R&&(0,o.jsx)(b.ChangeParticipantNameContainer,{})]})}},756392:(e,t,a)=>{"use strict";a.d(t,{CallNotificationContainer:()=>v});var n=a(785893),o=a(667294),i=a(22412),r=a(646301),s=a(986558),l=a(355268),c=a(607080),d=a(346880),u=a(687889),p=a(589481),_=a(911099),m=a(50533),h=a(495457),g=a(38275),A=a(496111),C=a(723689);const v=({dispatch:e,notification:t,participant:a,className:v=""})=>{const{getLang:f,langSex:S}=(0,o.useContext)(d.LangContext),E=(0,m.useSelector)((e=>e)),{entryPoint:T}=E,I=(0,o.useMemo)((()=>function(e,t,a,o={name:"",sex:"0",shortName:""}){if(!e)return null;switch(e.type){case i.NotificationType.SPEAKING_ON_MUTE:return t("calls_notification_mic_is_mute");case i.NotificationType.SCREEN_SHARING_STARTED:{if(!o||!o.name)return(0,n.jsx)("span",{children:t("calls_notification_screen_sharing_started")});const e=a(o.sex,"calls_notification_user_started_screen_sharing",t("calls_notification_user_started_screen_sharing","raw"));return(0,n.jsx)("span",{children:e.replace("{user}",o.name)})}case i.NotificationType.RAISED_HAND:{if(!o||!o.name)return null;const e=a(o.sex,"calls_notification_raised_hand",t("calls_notification_raised_hand","raw"));return(0,n.jsx)("span",{children:e.replace("{user}",o.name)})}case i.NotificationType.BAD_NETWORK_CONNECTION:return(0,n.jsx)("span",{children:t("calls_notification_bad_network_connection")});case i.NotificationType.BAD_NETWORK_CONNECTION_DISABLE_CAMERA:return[(0,n.jsx)(r.Icon16CamSlash,{},"icon"),(0,n.jsx)("span",{children:t("calls_notification_bad_network_connection_disable_camera")},"text")];case i.NotificationType.ADMIN_ROLE_GRANTED:return(0,n.jsx)("span",{children:t("calls_notification_admin_role_granted")},"text");case i.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE:{if(!o||!o.name&&!o.shortName)return null;const e=t("calls_notification_user_granted_with_admin_role").replace("{name}",o.shortName||o.name);return(0,n.jsx)("span",{children:e},"text")}case i.NotificationType.PINNED_BY_ADMIN:return(0,n.jsx)("span",{children:t("calls_notification_admin_pinned_self")},"text");case i.NotificationType.USER_PINNED_BY_ADMIN:{if(!o||!o.name&&!o.shortName)return null;const e=t("calls_notification_admin_pinned_user").replace("{name}",o.shortName||o.name);return(0,n.jsx)("span",{children:e},"text")}case i.NotificationType.PUSH_TO_TALK:{const a=t("calls_notification_push_to_talk_enabled");return[e.data?(0,n.jsx)(p.MicIconWithSpeakingIndicator,{},"icon"):(0,n.jsx)(s.Icon24Voice,{},"icon"),(0,n.jsx)("div",{className:"CallNotification__pushToTalkText",children:a},"text")]}case i.NotificationType.LINK_COPIED_TO_CLIPBOARD:{const e=t("calls_create_call_by_link_copied");return(0,n.jsx)("span",{children:e},"text")}case i.NotificationType.ADMIN_MUTE:return(0,n.jsx)("span",{children:t("calls_notification_admin_mute")},"text");case i.NotificationType.ADMIN_MUTE_AUDIO:return(0,n.jsx)("span",{children:t("calls_notification_admin_mute_audio")},"text");case i.NotificationType.ADMIN_MUTE_VIDEO:return(0,n.jsx)("span",{children:t("calls_notification_admin_mute_video")},"text");case i.NotificationType.ADMIN_MUTE_PERMANENT:return(0,n.jsx)("span",{children:t("calls_notification_admin_permanent_mute")},"text");case i.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:return(0,n.jsx)("span",{children:t("calls_notification_admin_permanent_mute_audio")},"text");case i.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:return(0,n.jsx)("span",{children:t("calls_notification_admin_permanent_mute_video")},"text");case i.NotificationType.ADMIN_MUTE_PERMANENT_WATCH_TOGETHER:return(0,n.jsx)("span",{children:t("calls_notification_admin_permanent_mute_watch_together")},"text");case i.NotificationType.ADMIN_UNMUTE_PERMANENT:return(0,n.jsx)("span",{children:t("calls_notification_admin_unmute")},"text");case i.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:return(0,n.jsx)("span",{children:t("calls_notification_admin_unmute_audio")},"text");case i.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:return(0,n.jsx)("span",{children:t("calls_notification_admin_unmute_video")},"text");case i.NotificationType.ENTER_TO_ROOM:return(0,n.jsx)("span",{children:t("calls_notification_enter_to_room").replace("{name}",e.data)},"text");case i.NotificationType.EXIT_FROM_ROOM:return(0,n.jsx)("span",{children:t("calls_notification_exit_from_room")},"text");case i.NotificationType.ROOM_HELP_REQUESTED:return(0,n.jsx)("span",{children:t("calls_notification_room_help_requested")},"text");case i.NotificationType.ROOMS_OPENED:return(0,n.jsx)("span",{children:t("calls_notification_room_rooms_opened")},"text");case i.NotificationType.ROOMS_CLOSED:return(0,n.jsx)("span",{children:t("calls_notification_room_rooms_closed")},"text");case i.NotificationType.ADMIN_UNMUTE_PERMANENT_WATCH_TOGETHER:return(0,n.jsx)("span",{children:t("calls_notification_admin_unmute_watch_together")},"text");case i.NotificationType.MOVIE_ALREADY_STARTED:return e.data?(0,n.jsx)("span",{children:t("calls_movie_already_started_modal_content").replace("{userName}",e.data)},"text"):null;case i.NotificationType.NETWORK_PROBLEMS:var d,u;return[(0,n.jsx)("div",{className:`CallNotification__connection--${null!=(u=null==(d=e.data)?void 0:d.status)?u:"bad"}`,children:(0,n.jsx)(l.Icon16Connection,{})},"icon"),(0,n.jsx)("span",{children:t("calls_notification_bad_signal")},"text")];case i.NotificationType.CONNECTING:return[(0,n.jsx)("div",{className:"CallNotification__connecting",children:(0,n.jsx)(c.Icon16Sync,{})},"icon"),(0,n.jsx)("span",{children:t("calls_notification_connecting")},"text")];default:return(0,n.jsx)(n.Fragment,{})}}(t,f,S,a)),[t,a]),y=(0,o.useRef)(0),N=(0,o.useMemo)((()=>(0,C.isMiniAppSource)(T)),[T]);(0,o.useEffect)((()=>(y.current&&window.clearTimeout(y.current),t&&0!==t.timer&&(y.current=window.setTimeout((()=>{e({type:i.E_ACTION.CALL_NOTIFICATION,notification:null}),y.current=0}),t.timer||i.defaultNotificationLifeSpan)),()=>{y.current&&window.clearTimeout(y.current)})),[t]);const b=(0,_.classNames)(v,{CallNotification__pushToTalk:(null==t?void 0:t.type)===i.NotificationType.PUSH_TO_TALK,CallNotification__miniAppNotification:N}),x=E.peer,M=(0,h.isGroupCallByPeer)(x)?E.callData.conversation:(0,A.getPeerIdDeviceInfo)(x,E.devices),[O,P]=(0,o.useState)(),[R,k]=(0,o.useState)("");return(null==M?void 0:M.status)!==O&&(k((0,g.getCallStatus)(E,f)),P(null==M?void 0:M.status)),(0,o.useEffect)((()=>{k((0,g.getCallStatus)(E,f))}),[E]),t||R?(0,n.jsx)(u.CallNotification,{className:b,children:R||I}):(0,n.jsx)(n.Fragment,{})}},641623:(e,t,a)=>{"use strict";a.d(t,{CallParticipantListContainer:()=>R});var n=a(434788),o=a(820224),i=a(785893),r=a(667294),s=a(50533),l=a(104712),c=a(512334),d=a(661307),u=a(910434),p=a(212169),_=a(824375),m=a(496111),h=a(346880),g=a(879455),A=a(464380),C=a(245387),v=a(878198),f=a(490287),S=a(971),E=a(260929),T=a(152789),I=a(890713),y=a(396901),N=a(162532),b=a(455319),x=a(985292),M=a(1628),O=a(465768);const P=100,R=({SDK:e,bridge:t,onAddClick:a,onShowMoreWaitingHall:o})=>{const p=(0,s.useSelector)((e=>e)),{getLang:v}=(0,r.useContext)(h.LangContext),[S,y]=(0,r.useState)(""),[N,b]=(0,r.useState)(P),x=(0,m.canMuteParticipants)(p.localDevice),M=N-P,{participants:R,isLoading:D}=function(e,t,a,o){const i=(0,f.useTypedSelector)((e=>e)),s=(0,I.isUseParticipantListChunk)(i),l=(0,r.useMemo)((()=>i.externalId?(0,n._)({},i.localDevice,{externalId:i.externalId}):null),[i.localDevice,i.externalId]);return(s?k:w)(e,t,a,l,{offset:o})}(S,e,t,M),L=(0,r.useCallback)((e=>{y(e.target.value)}),[]),j=!(0,m.isParticipantAnonym)(p.me)&&!p.rooms.roomId,B=(0,T.useActiveDevicesListCount)(),U=(0,r.useCallback)((t=>{e.muteParticipant({externalId:t.externalId,muteStates:{},requestedMedia:[A.MediaOption.AUDIO,A.MediaOption.VIDEO,A.MediaOption.SCREEN_SHARING]}).catch(O.handlePromiseError)}),[]);return(0,i.jsxs)(l.CallParticipantList,{searchQuery:S,onSearchChange:L,length:B,waitingHallList:p.waitingHall&&(0,i.jsx)(g.WaitingHallListContainer,{isModal:!1,onMore:o}),children:[!S&&j&&(0,i.jsx)(c.default,{selectable:!1,border:!1,children:(0,i.jsx)(_.ListAddControl,{onClick:a,children:v("calls_add_participants")})},"add"),!!R.length&&R.slice(0,N).map((t=>{const a=(0,m.externalIdToString)(t.externalId);return(0,i.jsx)(E.CallParticipantListRow,{deviceId:a,SDK:e,canMute:x,device:t,onUnmuteDevice:U},a)})),D&&(0,i.jsx)(u.default,{}),!S&&!D&&B>N&&(0,i.jsx)(c.default,{children:(0,i.jsx)(C.ListMore,{className:"CallParticipantList__more",onClick:()=>{b((e=>e+P))},children:v("calls_participants_show_more").replace("{n}",String(P))})},"limit"),S&&!R.length&&(0,i.jsx)(d.default,{children:v("calls_participants_not_found")})]})};function k(e,t,a,i,{offset:s=0}={}){const l=P,c=(0,f.useTypedSelector)((e=>e.devices)),d=(0,f.useTypedSelector)((e=>e.participants)),u=(0,f.useTypedSelector)((e=>e.participantsChunk));var p;const _=(0,f.useTypedSelector)((e=>null!=(p=e.callData.callId)?p:"")),h=(0,y.useTypedDispatch)(),[g,C]=(0,r.useState)([]),[v,E]=(0,r.useState)(!1),T=(0,I.calcParticipantListChunkCount)(u),R=0===s&&T<=P?T:null;(0,r.useEffect)((()=>{const i=new AbortController;let r=!1;return i.signal.addEventListener("abort",(()=>{r=!0}),{once:!0}),E(!0),(e?new Promise(((a,n)=>{const o=setTimeout((()=>{a(function(){function a(e,t){return{id:String(e.id),type:t}}(0,N.searchCallParticipants)(_,{search:e},{signal:i.signal}).then((({profiles:e=[],anonyms:t=[],groups:n=[]})=>{const o=[],i=[];return t.forEach((e=>{o.push((0,b.normalizeUser)(e)),i.push(a(e,A.ExternalIdType.ANONYM))})),e.forEach((e=>{o.push((0,b.normalizeUser)(e)),i.push(a(e,A.ExternalIdType.USER))})),n.forEach((e=>{o.push((0,b.normalizeGroup)(e)),i.push(a(e,A.ExternalIdType.GROUP))})),(0,x.preloadImagesFromResponse)([{},o]),h({type:y.E_ACTION.LOAD_PEERS,members:o}),i})).then((e=>t.getParticipants({externalIds:e}))).then((e=>{if(r)return;const t=S.GlobalStore.getCallsState(),a=e.map((({uid:e})=>(0,m.externalIdToString)(e)));(0,M.addParticipantsToStoreThrottled)(t,h,e),C(a)})).catch(O.handlePromiseError)}())}),1e3);i.signal.addEventListener("abort",(()=>{clearTimeout(o),n()}),{once:!0})})):(0,I.getParticipantListChunk)(t,{fromIdx:s,count:l},{signal:i.signal}).then((e=>{const t=S.GlobalStore.getCallsState(),i=e.participants.map((e=>{var{uid:t}=e,a=(0,o._)(e,["uid"]);return(0,n._)({externalId:t},a)})),r=i.map((({externalId:e})=>(0,m.externalIdToString)(e))),l=(0,I.addParticipantsInCacheAndLoadInfo)(t,h,a,i);return C((e=>s>=e.length?e.concat(r):r)),l}))).finally((()=>{E(!1)})),()=>i.abort()}),[_,e,s,R]);return{participants:g.reduce(((e,t)=>{const a=c[t];if(a){const t=a.externalId.id,n=d[t];n&&n.name&&e.push(a)}return e}),e||!i?[]:[i]),isLoading:v}}function w(e){const[t,a]=function(){const e=(0,f.useTypedSelector)((e=>e)),t=(0,r.useMemo)((()=>{if(e.externalId)return(0,n._)({},e.localDevice,{externalId:e.externalId})}),[e.localDevice,e.externalId]);return(0,r.useMemo)((()=>{const a=[[],[]],n=(t,a)=>{if(!(0,m.isSameExternalId)(a.externalId,e.externalId)&&a.roomId!==e.rooms.roomId)return t;const n=e.participants[a.externalId.id];return n&&a.status?(t[0].push(a),n.name&&t[1].push(a),t):t};return t&&n(a,t),(0,v.objectReduce)(e.devices,n,a)}),[e.devices,e.rooms,e.participants,e.localDevice,e.externalId])}(),o=(0,r.useCallback)((e=>{var t;const{participants:a}=S.GlobalStore.getCallsState();return null==(t=a[e.externalId.id])?void 0:t.name}),[]),i=(0,r.useCallback)((e=>(0,m.externalIdToString)(e.externalId)),[]),s=(0,p.useIndexer)(a,o,i);return{participants:e?s.search(e):t,isLoading:!1}}},781382:(e,t,a)=>{"use strict";a.d(t,{CallRecordsContainer:()=>n});const n=()=>null},549413:(e,t,a)=>{"use strict";a.d(t,{CallDecodeItem:()=>h});var n=a(785893),o=a(86894),i=a(215200),r=a(384627),s=a(881310),l=a(659397),c=a(315883),d=a(336572),u=a(277659),p=a(432483),_=a(267697),m=a(915961);function h({title:e,subtitle:t,id:a,fileUrl:h,removeTranscription:g,isDeleted:A}){const{handleDownload:C,handleDelete:v}=(0,_.useDecodeActions)({id:a,url:h,onRemove:g}),{getLang:f}=(0,m.useLang)();return(0,n.jsx)(o.Cell,{before:(0,n.jsx)(i.Image,{children:(0,n.jsx)(c.Icon20ArticlesOutline,{className:(0,l.classNames)("CallsDecodingPage_cellIcon",{"CallsDecodingPage_cellIcon--deleted":A}),width:24,height:24})}),subtitle:t,after:(0,n.jsx)(r.DropdownActionSheet,{content:(0,n.jsxs)(n.Fragment,{children:[h&&(0,n.jsx)(s.DropdownActionSheetItem,{before:(0,n.jsx)(d.Icon20DownloadOutline,{}),onClick:C,children:f("calls_decoded_page_download_action")}),(0,n.jsx)(s.DropdownActionSheetItem,{before:(0,n.jsx)(u.Icon20DeleteOutline,{}),onClick:v,type:"destructive",children:f(h?"calls_decoded_page_delete_action":"calls_decoded_page_delete_from_list_action")})]}),children:(0,n.jsx)(o.IconButton,{children:(0,n.jsx)(p.Icon24MoreHorizontal,{className:"CallsDecodingPage_menuIcon"})})}),disabled:!0,children:(0,n.jsx)("span",{className:(0,l.classNames)("CallsDecodingPage_itemTitle",{"CallsDecodingPage_itemTitle--deleted":A}),children:e})})}},124328:(e,t,a)=>{"use strict";a.d(t,{CallsDecodingContainer:()=>g});var n=a(785893),o=a(558791),i=a(86894),r=a(381804),s=a(549413),l=a(444972),c=a(513724),d=a(399639),u=a(545637),p=a(625533),_=a(167905),m=a(752460),h=a(768296);const g=()=>{const{locale:e}=(0,h.useLocale)(),{getLang:t,langReplace:a}=(0,o.useLangContext)(),{blocks:g,loading:A,getNext:C,hasNext:v,removeTranscription:f}=(0,r.useCallDecodes)(),S=Boolean(g.length);return!S&&A?(0,n.jsx)(_.CallsPageWrapper,{children:(0,n.jsx)(l.Skeleton,{height:300})}):(0,n.jsx)(_.CallsPageWrapper,{children:(0,n.jsxs)(c.Group,{header:(0,n.jsx)(d.Header,{children:t("calls_decoded_page_title")}),children:[(0,n.jsx)(i.Separator,{}),S&&(0,n.jsx)(p.default,{loadMore:C,hasMore:v,useWindowScroll:!0,useIntersectionObserver:!0,children:g.map((({title:o,transcriptions:i})=>(0,n.jsx)(c.Group,{mode:"plain",header:(0,n.jsx)(d.Header,{mode:"tertiary",children:o}),children:i.map((o=>{const{name:i,doc_id:r,doc_url:l}=o,c=(0,m.getSubtitle)({getLang:t,langReplace:a,locale:e,transcription:o});return(0,n.jsx)(s.CallDecodeItem,{title:l?i:t("calls_decoded_page_deleted_item"),subtitle:c,id:r,fileUrl:l,removeTranscription:f,isDeleted:!l},r)}))},o)))}),!S&&!A&&(0,n.jsx)(u.Div,{className:"CallsDecodingPage__empty",children:(0,n.jsx)(i.Text,{children:t("calls_decoded_page_empty_list")})})]})})}},752460:(e,t,a)=>{"use strict";a.d(t,{getBlockTitle:()=>l,getSubtitle:()=>s});var n=a(431837);const o=Math.pow(2,10),i=Math.pow(2,20),r=Math.pow(2,30),s=({getLang:e,langReplace:t,transcription:a,locale:n})=>{var s;const l=a.doc_url?((e,t,a,n)=>{const o=new Date(1e3*a),i=new Intl.DateTimeFormat(n,{hour:"numeric",minute:"numeric"}).format(o);return t(e("global_calls_decoded_page_in_time"),{time:i})})(e,t,a.date,n):"",c=((e,t,a)=>{if(!e)return"";switch(!0){case e>=r:return a(t("calls_decoded_page_doc_size_gb"),{size:String(Number((e/r).toFixed(1)))});case e>=i:return a(t("calls_decoded_page_doc_size_mb"),{size:String(Number((e/i).toFixed(1)))});case e>=o:return a(t("calls_decoded_page_doc_size_kb"),{size:String(Math.round(e/o))});default:return a(t("calls_decoded_page_doc_size_kb"),{size:String(Number((e/o).toFixed(1)))})}})(a.doc_size,e,t);return[l,c,null==(s=a.chat)?void 0:s.title].filter((e=>!!e)).join(" · ")},l=(e,t,a)=>{const o=new Date(1e3*a),i=String(o.getDate()),r=function(e,t){switch(t){case 0:return e("calls_decoded_page_date_january");case 1:return e("calls_decoded_page_date_february");case 2:return e("calls_decoded_page_date_march");case 3:return e("calls_decoded_page_date_april");case 4:return e("calls_decoded_page_date_may");case 5:return e("calls_decoded_page_date_june");case 6:return e("calls_decoded_page_date_july");case 7:return e("calls_decoded_page_date_august");case 8:return e("calls_decoded_page_date_september");case 9:return e("calls_decoded_page_date_october");case 10:return e("calls_decoded_page_date_november");case 11:return e("calls_decoded_page_date_december");default:return""}}(e,o.getMonth()),s=String(o.getFullYear());return(0,n.isToday)(o)?e("calls_decoded_page_date_today"):(0,n.isSameYear)(o,new Date)?t(e("calls_decoded_page_date"),{day:i,month:r}):t(e("calls_decoded_page_date_full"),{day:i,month:r,year:s})}},381804:(e,t,a)=>{"use strict";a.d(t,{useCallDecodes:()=>d});var n=a(667294),o=a(162532),i=a(465768),r=a(953063),s=a(160232),l=a(752460),c=a(915961);const d=()=>{const{getLang:e,langReplace:t}=(0,c.useLang)(),{setLoading:a}=(0,s.useHistoryScreenLoading)(),[d,u]=(0,n.useState)(0),[p,_]=(0,n.useState)([]),{fetchData:m,loading:h}=(0,r.useFetchData)({cb:o.getAsrTranscriptions});(0,n.useEffect)((()=>{a(h)}),[h]),(0,n.useEffect)((()=>{m({count:20,offset:0}).then((e=>{u(e.count),_(e.items)})).catch(i.handlePromiseError)}),[]);const g=(0,n.useCallback)((()=>m({count:10,offset:p.length}).then((e=>{u(e.count),_([...p,...e.items])})).catch(i.handlePromiseError)),[p]),A=(0,n.useMemo)((()=>{const a=new Map;return p.forEach((n=>{const o=(0,l.getBlockTitle)(e,t,n.date);if(a.has(o))a.get(o).add(n);else{const e=new Set;e.add(n),a.set(o,e)}})),[...a.entries()].map((([e,t])=>({title:e,transcriptions:[...t.values()]})))}),[p]),C=(0,n.useCallback)((e=>{_(p.filter((t=>t.doc_id!==e))),u(d-1)}),[p]);return{loading:h,blocks:A,getNext:g,hasNext:p.length<d&&d>10,removeTranscription:C}}},267697:(e,t,a)=>{"use strict";a.d(t,{useDecodeActions:()=>r});var n=a(162532),o=a(465768),i=a(953063);const r=({id:e,url:t,onRemove:a})=>{const{fetchData:r,loading:s}=(0,i.useFetchData)({cb:n.deleteAsrTranscriptions});return{handleDownload:()=>{if(!t)return;const e=document.createElement("a");e.href=t,e.click()},handleDelete:()=>{s||r({doc_ids:e}).then((()=>{a(e)})).catch(o.handlePromiseError)}}}},550942:(e,t,a)=>{"use strict";a.d(t,{CallsErrorBoundary:()=>i});var n=a(667294),o=a(22412);class i extends n.Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e){switch(this.props.mode){case o.Mode.CALL:this.props.SDK.hangup();break;case o.Mode.INCOMING:this.props.SDK.declineCall()}this.props.onReset(),this.setState({hasError:!1}),console.error("Calls crashed:",e,e)}render(){return this.state.hasError?null:this.props.children}constructor(e){super(e),this.state={hasError:!1}}}},970196:(e,t,a)=>{"use strict";a.d(t,{CautionContainer:()=>h});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(22412),l=a(464380),c=a(732297),d=a(495457),u=a(496111),p=a(346880),_=a(482823),m=a(135504);const h=({isIncoming:e=!1})=>{const t=(0,i.useSelector)((e=>e)),a=(0,r.useTypedDispatch)(),{getLang:h}=(0,o.useContext)(p.LangContext),g=h(e?"calls_reject_title":"calls_hangup_title"),A=h(e?"calls_reject_description":"calls_hangup_description"),C=(0,o.useCallback)((()=>{a({type:s.E_ACTION.SHOW_CAUTION_BOX,isOpen:!1})}),[]),v=()=>{C(),e?(0,l.declineCall)().catch((()=>{})):((0,l.hangup)().catch((()=>{})),c.callStats.logEvent({call_event_type:s.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:t.callData.callId,peer_id:t.peer,is_group_call:(0,d.isGroupCallByPeer)(t.peer),reason:"none",group_call_users_count:(0,u.getActiveParticipantsCount)(t)}))},f=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.OutlinedButton,{mode:"secondary",onClick:C,children:h("calls_cancel_reject")}),(0,n.jsx)(m.OutlinedButton,{"data-focus-first":!0,onClick:v,children:h("calls_reject")})]}),S=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m.OutlinedButton,{onClick:C,mode:"secondary",children:h("calls_cancel")}),(0,n.jsx)(m.OutlinedButton,{"data-focus-first":!0,onClick:v,children:h("calls_exit")})]});return(0,n.jsx)(_.CallError,{title:g,onClose:C,actionButtons:e?f:S,text:(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:A}})})}},386633:(e,t,a)=>{"use strict";a.d(t,{ChangeParticipantNameContainer:()=>g});var n=a(11010),o=a(820224),i=a(785893),r=a(305090),s=a(50533),l=a(22412),c=a(396901),d=a(667294),u=a(162532),p=a(465768),_=a(953063),m=a(302617),h=a(496111);const g=()=>{const{sendStatsData:e}=(0,m.useSendStatsData)(),[t,a]=(0,d.useState)(""),[g,A]=(0,d.useState)(!1),{changeNameSettings:{renamedUserPeerId:C,renamedUserType:v},callData:f,groupId:S,participants:E,anonymSecret:T}=(0,s.useSelector)((e=>e)),I=E[C||0],y=(0,c.useTypedDispatch)(),N=(0,_.useFetchData)({cb:u.callsEditParticipantName}),b=(0,_.useFetchData)({cb:u.callsCheckParticipantName}),x=(0,_.useFetchData)({cb:u.callsDeleteParticipantName}),M=()=>{y({type:l.E_ACTION.CHANGE_NAME_MODAL,participantId:void 0,renamedUserType:void 0}),y({type:l.E_ACTION.MANAGEMENT,isOpen:!1})};(0,d.useEffect)((()=>{A(t.length>=l.MIN_NAME_LENGTH&&!l.NAME_REGEX.test(t))}),[t]);const O=(0,n._)((function*(){const a=0===t.length;let n=a;if(a||(n=yield b.fetchData({name:t}).then((e=>e.is_valid?e.is_valid:(A(!0),!1))).catch(p.handlePromiseError)),!n)return;const i={call_id:f.callId||"",name:t};let r=l.CallActionEventType.NAME_CHANGED_BY_USER;if(S&&(i.group_id=S),v!==l.RenamedUserType.SELF&&C&&(i.participant_id=C.toString(),r=S?l.CallActionEventType.NAME_CHANGED_BY_COMMUNITY:l.CallActionEventType.NAME_CHANGED_BY_ADMIN),v===l.RenamedUserType.SELF&&C&&(0,h.isParticipantAnonym)(C)&&(i.anonym_auth_user_id=C,i.secret=T,i.device_id="anyId",r=l.CallActionEventType.NAME_CHANGED_BY_ANONYM),a){const{name:t}=i,a=(0,o._)(i,["name"]);x.fetchData(a).then((t=>{t.secret&&y({type:l.E_ACTION.UPDATE_ANON_SECRET,secret:t.secret}),e(r),M()})).catch(p.handlePromiseError)}else N.fetchData(i).then((t=>{t.secret&&y({type:l.E_ACTION.UPDATE_ANON_SECRET,secret:t.secret}),e(r),M()})).catch(p.handlePromiseError)}));return(0,i.jsx)("div",{children:(0,i.jsx)(r.ChangeParticipantNameModal,{changedName:t,setChangedName:a,participant:I,onClose:M,renamedUserType:v,onSaveClick:O,error:g,isFetching:N.loading||b.loading||x.loading})})}},287282:(e,t,a)=>{"use strict";a.d(t,{CollapsedCallContainer:()=>x});var n=a(434788),o=a(785893),i=a(667294),r=a(396901),s=a(490287),l=a(238696),c=a(593750),d=a(11298),u=a(22412),p=a(878198),_=a(495457),m=a(496111),h=a(915961),g=a(464380),A=a(261757),C=a(773816),v=a(119783),f=a(205805),S=a(8589),E=a(723689),T=a(409157),I=a(455319),y=a(227336),N=a(768379),b=a(896500);const x=()=>{var e,t,a,x,O,P,R,k;const w=(0,f.useCallsSDK)(),D=(0,s.useTypedSelector)((e=>e)),L=(0,r.useTypedDispatch)(),{getLang:j}=(0,h.useLang)(),B=D.peer,U=(0,p.isAnyoneWithVideo)(D),H=(0,_.isGroupCallByPeer)(B)?D.callData.conversation:D.participants[D.peer],F=D.localDevice,V=(0,m.getCallVisibleParticipant)(D,U),G=((0,m.isParticipantWithVideo)(F)||F.movieStream)&&V&&!(0,m.isSameExternalId)(V.externalId,D.externalId),W=(0,s.useTypedSelector)((e=>e.translation.isOn&&!!e.translation.isRecord)),$=(0,E.isMiniAppSource)(D.entryPoint),z=[V];D.externalId&&z.push({externalId:D.externalId}),(0,S.useCallVmoji)({activeParticipantsList:z}),(0,y.useVisibleDeviceScreenShareNotVisibleStat)(V);const Z=(0,i.useCallback)((()=>{L({type:u.E_ACTION.CHANGE_UI_MODE,mode:u.UIMode.DEFAULT}),(0,A.setNeedPushToTalkToggleAudio)(!1)}),[]),K=C.MuteStatesHandler.isMediaAllowed("video",D.localDevice),Q=C.MuteStatesHandler.isMediaAllowed("audio",D.localDevice),Y=(null==F||null==(e=F.mediaSettings)?void 0:e.isAudioEnabled)||Q,q=(null==F||null==(t=F.mediaSettings)?void 0:t.isVideoEnabled)||K,J=(0,i.useCallback)((()=>{var e;(0,g.debugMessage)(g.DebugMessageType.WARN,"[onToggleAudio]"),w.toggleLocalAudio(!(null==(e=F.mediaSettings)?void 0:e.isAudioEnabled))}),[null==(a=F.mediaSettings)?void 0:a.isAudioEnabled]),X=(0,i.useCallback)((()=>{var e;(0,g.debugMessage)(g.DebugMessageType.WARN,"[onToggleVideo]"),w.toggleLocalVideo(!(null==(e=F.mediaSettings)?void 0:e.isVideoEnabled))}),[null==(x=F.mediaSettings)?void 0:x.isVideoEnabled]),ee=(0,N.usePipController)(Z);(0,b.useCollapsedCallsStats)(ee.isPipEnabled);const te=(0,n._)({localVideoStreamData:G?(0,m.getStream)(F):void 0,isLocalAudioEnabled:!!(null==(O=F.mediaSettings)?void 0:O.isAudioEnabled),isLocalAudioAllowed:Y,isLocalScreenSharing:!!(null==(P=F.mediaSettings)?void 0:P.isScreenSharingEnabled),isLocalVmoji:!!(null==(R=F.mediaSettings)?void 0:R.isAnimojiEnabled)},function(e,t,a,n){var o,i,r,s;const l=t&&e.participants[t.externalId.id];return t&&l?{participantId:t.externalId,isMe:+t.externalId.id===e.me,isWithVideo:(0,m.isParticipantWithVideo)(t)||(0,m.isParticipantWithMovie)(t),isWithAudio:!!(null==(o=t.mediaSettings)?void 0:o.isAudioEnabled),isScreenSharing:!!(null==(i=t.mediaSettings)?void 0:i.isScreenSharingEnabled),streamData:(0,m.getStream)(t,{animojiBackendRender:+t.externalId.id!==e.me&&(null==(r=e.callData)?void 0:r.topology)===g.TransportTopology.SERVER}),photo:l.photo,name:n?(0,I.getUserShortName)(l):(0,I.getUserName)(l),status:t.status,networkStatus:t.networkStatus||1,isNFT:null==l?void 0:l.is_nft,isVmoji:!!(null==(s=t.mediaSettings)?void 0:s.isAnimojiEnabled)}:{participantId:(0,m.getDefaultExternalId)(),isMe:!1,isWithVideo:!1,isWithAudio:!1,isScreenSharing:!1,streamData:void 0,photo:(null==a?void 0:a.photo)||"",name:(null==a?void 0:a.tab)||"",status:(null==a?void 0:a.status)||g.ParticipantStatus.CONNECTED,networkStatus:1}}(D,V,H,$),{onRestoreCall:Z,onToggleAudio:J,isRecord:W,localDeviceStatus:D.localDevice.networkStatus,isLocalVideoEnabled:!!(null==(k=F.mediaSettings)?void 0:k.isVideoEnabled),isLocalVideoAllowed:q,onToggleVideo:X,isCollapsedPip:ee.isCollapsedPip});return(0,o.jsxs)(o.Fragment,{children:[D.mode===u.Mode.INCOMING&&(0,o.jsx)(l.CollapsedCall,{children:(0,o.jsx)(v.FocusTrap,{hasFirstFocusableElement:!0,children:(0,o.jsx)(c.CallWidget,{id:B,title:(null==H?void 0:H.tab)||"",photo:(null==H?void 0:H.photo)||"",status:j("calls_incoming_collapsed"),isIncoming:!0,onClick:Z})})}),Boolean(D.mode!==u.Mode.INCOMING&&$)&&(0,o.jsx)(l.CollapsedCallDraggable,{className:"CollapsedCall--miniApp",children:(0,o.jsx)(v.FocusTrap,{hasFirstFocusableElement:!0,children:(0,o.jsx)(T.CallMiniAppWidget,(0,n._)({},te))})}),Boolean(D.mode!==u.Mode.INCOMING&&!$)&&(0,o.jsx)(M,(0,n._)({},ee,{children:(0,o.jsx)(v.FocusTrap,{hasFirstFocusableElement:!0,children:(0,o.jsx)(d.CallVideoWidget,(0,n._)({},te))})}))]})};function M(e){return e.isPipEnabled?(0,o.jsx)(l.CollapsedCall,{ref:e.refCollapsedCall,isCollapsedPip:e.isCollapsedPip,children:e.children}):(0,o.jsx)(l.CollapsedCallDraggable,{children:e.children})}},989206:(e,t,a)=>{"use strict";a.d(t,{SVG_SPRITE_NODE_SELECTOR:()=>n});const n="svg#__SVG_SPRITE_NODE__"},896500:(e,t,a)=>{"use strict";a.d(t,{useCollapsedCallsStats:()=>i});var n=a(667294),o=a(302617);function i(e){const{sendStatsData:t}=(0,o.useSendStatsData)();(0,n.useEffect)((()=>{t(o.ECallActionEventType.CALL_COLLAPSED,{event_param:e?2:1})}),[])}},392221:(e,t,a)=>{"use strict";a.d(t,{useIsPipEnabled:()=>i});var n=a(464380),o=a(490287);function i(){return(0,o.useTypedSelector)((e=>!!e.config.enableCollapsedPipMode))&&"documentPictureInPicture"in window&&"Chrome"===n.browser.browserName()}},768379:(e,t,a)=>{"use strict";a.d(t,{usePipController:()=>d});var n=a(11010),o=a(667294),i=a(464380),r=a(238696),s=a(490287),l=a(392221),c=a(989206);function d(e){const t=(0,l.useIsPipEnabled)(),a=(0,s.useTypedSelector)((e=>Boolean(e.config.isVkMePage))),d=(0,o.useRef)(),u=(0,o.useRef)(null),p=(0,o.useRef)(),[_,m]=(0,o.useState)(!1),h=_&&t,g=(0,o.useMemo)((()=>new MutationObserver((e=>{for(const t of e)"childList"===t.type&&t.addedNodes.forEach((e=>{var t;null==(t=d.current)||t.document.body.append(e.cloneNode(!0))}))}))),[]),A=(0,o.useCallback)((()=>{(0,i.debugMessage)(i.DebugMessageType.WARN,"restoreCall",!!d.current),d.current?null==d.current.close||d.current.close():e()}),[e]);return(0,o.useEffect)((()=>{if(!t||!u.current)return;const e=document.querySelector(c.SVG_SPRITE_NODE_SELECTOR);return e&&g.observe(e,{childList:!0}),()=>{g.disconnect()}}),[t]),(0,o.useEffect)((()=>{t&&(0,n._)((function*(){var t;const n=u.current,o=null==n?void 0:n.parentElement;if(!n||!o)return;let s;try{var l;s=yield null==(l=window.documentPictureInPicture)?void 0:l.requestWindow({width:480,height:270})}catch(e){return void(0,i.debugMessage)(i.DebugMessageType.ERROR,e)}if(!s)return;d.current=s,s.document.body.style.background="radial-gradient(circle, rgb(50, 50, 50) 40%, rgb(10, 10, 10) 100%)",document.querySelectorAll('head link[type="text/css"]').forEach((e=>null==s?void 0:s.document.body.append(e.cloneNode()))),document.querySelectorAll("symbol").forEach((e=>null==s?void 0:s.document.body.append(e.cloneNode(!0))));const c=null==(t=document.querySelector("#svg-resources"))?void 0:t.cloneNode(!0);c&&(null==s||s.document.body.append(c)),a&&(document.querySelectorAll("head style").forEach((e=>null==s?void 0:s.document.head.append(e.cloneNode(!0)))),document.querySelectorAll('body link[type="text/css"]').forEach((e=>null==s?void 0:s.document.head.append(e.cloneNode())))),n.setAttribute("style","visibility: hidden;"),s.document.body.append(n),setTimeout((()=>{n.setAttribute("style","")}),750),p.current=t=>{if((0,i.debugMessage)(i.DebugMessageType.WARN,"[1] onClosePipWindow",!!d.current),!d.current)return;const a=d.current.document.body.querySelector(`.${r.COLLAPSED_CALL_MAIN_CLASS}`);(0,i.debugMessage)(i.DebugMessageType.WARN,"[2] onClosePipWindow",!!a),a&&(o.append(a),t||d.current.close(),d.current=void 0,p.current=void 0,e())},s.addEventListener("unload",(e=>{(0,i.debugMessage)(i.DebugMessageType.WARN,"unload",!!e),null==p.current||p.current(e)})),m(!0)}))()}),[t]),(0,o.useLayoutEffect)((()=>{if(t&&u.current)return()=>{null==p.current||p.current()}}),[t]),{isPipEnabled:t,isCollapsedPip:h,onRestoreCall:A,refCollapsedCall:u,refPipWindow:d}}},254313:(e,t,a)=>{"use strict";a.d(t,{CollapsedWaitingHallContainer:()=>_});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(238696),l=a(11298),c=a(22412),d=a(496111),u=a(205805),p=a(878198);const _=()=>{var e,t,a,_;const m=(0,u.useCallsSDK)(),h=(0,i.useSelector)((e=>e)),g=(0,r.useTypedDispatch)(),A=h.localDevice,C=h.externalId,v=h.participants[h.me],f=(0,o.useCallback)((()=>{g({type:c.E_ACTION.CHANGE_UI_MODE,mode:c.UIMode.DEFAULT})}),[]),S=(0,o.useCallback)((()=>{var e;m.toggleLocalAudio(!(null==(e=h.localDevice.mediaSettings)?void 0:e.isAudioEnabled))}),[h.localDevice.mediaSettings]);return(0,n.jsx)(s.CollapsedCall,{children:C&&(0,n.jsx)(l.CallVideoWidget,{onRestoreCall:f,isMe:!0,isLocalAudioEnabled:!!(null==(e=A.mediaSettings)?void 0:e.isAudioEnabled),isLocalAudioAllowed:!0,isLocalScreenSharing:!1,isLocalVmoji:!1,onToggleAudio:S,photo:v.photo,name:v.name,participantId:C,isWithVideo:(0,d.isParticipantWithVideo)(A),isWithAudio:!!(null==(t=A.mediaSettings)?void 0:t.isAudioEnabled),isScreenSharing:!!(null==(a=A.mediaSettings)?void 0:a.isScreenSharingEnabled),streamData:(0,d.getStream)(A),status:A.status,networkStatus:A.networkStatus,isVmoji:!!(null==(_=A.mediaSettings)?void 0:_.isAnimojiEnabled),isLocalVideoEnabled:!1,isLocalVideoAllowed:!1,onToggleVideo:p.noop,isCollapsedPip:!1})})}},102093:(e,t,a)=>{"use strict";a.d(t,{CreateCallByLinkContainer:()=>A});var n=a(785893),o=a(667294),i=a(396901),r=a(50533),s=a(22412),l=a(596525),c=a(162532),d=a(464380),u=a(558791),p=a(490287),_=a(302617),m=a(314087),h=a(146679),g=a(465768);const A=({bridge:e})=>{const t=(0,r.useSelector)((e=>e)),a=(0,p.useTypedSelector)((e=>!e.config.sferum)),A=(0,i.useTypedDispatch)(),{getLang:C}=(0,u.useLangContext)(),{sendStatsData:v}=(0,_.useSendStatsData)(),f=t.participants[t.me],[S,E]=(0,o.useState)(f.peerId),[T,I]=(0,o.useState)([{value:f.peerId,label:(0,h.decode)(f.name)}]),y=(0,m.useFormCheckboxesValues)({initialValue:!1}),N=(0,m.useFormCheckboxesValues)({initialValue:!0}),b=(0,m.useFormCheckboxesValues)({initialValue:!0}),x=(0,m.useFormCheckboxesValues)({initialValue:!0}),[M,O]=(0,o.useState)(d.MuteState.UNMUTE),[P,R]=(0,o.useState)(d.MuteState.UNMUTE);(0,o.useEffect)((()=>{(0,c.getGroupsForCall)().then((e=>{const t=[...T];e.count>0&&(e.items.forEach((e=>{t.push({value:-e.id,label:e.name||""})})),I(t))})).catch(g.handlePromiseError)}),[]);const k=(0,o.useCallback)((e=>{E(Number(e.value))}),[]),w=(0,o.useCallback)((()=>{A({type:s.E_ACTION.CHANGE_MODE,mode:s.Mode.READY})}),[]),D=(0,o.useCallback)((()=>{const a={[d.ConversationOption.FEEDBACK]:x.checked};N.checked||(a[d.ConversationOption.REQUIRE_AUTH_TO_JOIN]=!0),y.checked&&(a[d.ConversationOption.WAITING_HALL]=!0);const n={};var o;M!==d.MuteState.UNMUTE&&(n[d.MediaOption.AUDIO]=M),P!==d.MuteState.UNMUTE&&(n[d.MediaOption.VIDEO]=P,n[d.MediaOption.SCREEN_SHARING]=P),e.startCall(!1,null!=(o=t.entryPoint)?o:s.CallStatSource.HISTORY_CREATE,!1,S>0?0:S,{conversationOptions:a,createLink:!0,mediaOptions:n},!b.checked).then((e=>{const t=null==e?void 0:e.id;t&&!x.checked&&v(_.ECallActionEventType.REACTION_DISABLED,{session_id:t})}))}),[x.checked,S,y.checked,N.checked,M,P,b.checked]),L=[{value:d.MuteState.UNMUTE,label:C("calls_create_call_by_link_phone_option_allow_always")},{value:d.MuteState.MUTE,label:C("calls_create_call_by_link_phone_option_disallow_entrance")},{value:d.MuteState.MUTE_PERMANENT,label:C("calls_create_call_by_link_phone_option_disallow_always")}],j=e=>{let t=d.MuteState.UNMUTE;return e==d.MuteState.MUTE?t=d.MuteState.MUTE:e==d.MuteState.MUTE_PERMANENT&&(t=d.MuteState.MUTE_PERMANENT),t},B=(0,o.useCallback)((e=>{O(j(String(e.value)))}),[]),U=(0,o.useCallback)((e=>{R(j(String(e.value)))}),[]);return(0,n.jsx)(l.CreateCallByLinkModal,{onClose:w,onStartCall:D,ownerOptions:T,selectedOwnerId:S,waitingHall:y,allowAnon:N,allowWatchTogether:b,allowReactions:x,onGroupSelectChange:k,microphoneOptions:L,cameraOptions:L,onMicrophoneSelectChange:B,onCameraSelectChange:U,selectedMicrophoneOption:M,selectedCameraOption:P,isWatchTogetherEnabled:a})}},494817:(e,t,a)=>{"use strict";a.d(t,{DeleteCallContainer:()=>h});var n=a(785893),o=a(667294),i=a(840867),r=a(563247),s=a(162532),l=a(464380),c=a(26660),d=a(558791),u=a(121883),p=a(878198),_=a(135504),m=a(465768);const h=()=>{const e=(0,c.useHistoryScreenDispatch)(),{getLang:t,langShortDateTime:a}=(0,d.useLangContext)(),h=(0,c.useHistoryScreenSelector)((e=>e.deleteCallId)),g=(0,c.useHistoryScreenSelector)((e=>e.profiles)),A=(0,c.useHistoryScreenSelector)((e=>e.historyCalls)),C=(0,c.useHistoryScreenSelector)((e=>e.currentCalls)),v=h in A?A[h]:null,f=(0,o.useCallback)((()=>{e((0,u.dispatchDeleteCall)(-1))}),[]),S=(0,o.useCallback)((()=>{if((null==v?void 0:v.type)&&"merged"===(null==v?void 0:v.type)&&(null==v?void 0:v.items)){const e=v.items.reduce(((e,t)=>((null==t?void 0:t.id)&&e.push(t.id),e)),[]);e.length>0&&(0,l.removeHistoryRecords)(e)}else(null==v?void 0:v.id)&&(0,l.removeHistoryRecords)([v.id]);A.splice(h,1),e((0,u.dispatchSetHistoryCalls)([...A])),f()}),[v]),E=(0,o.useCallback)((()=>{if(null==v?void 0:v.call_id){(0,s.forceCallFinish)(v.call_id).catch(m.handlePromiseError);const t=C.filter((e=>e.call_id!==v.call_id));e((0,u.dispatchSetCurrentCalls)(t))}S()}),[v]);let T=[];if((null==v?void 0:v.can_finish_call)&&(T=T.concat([(0,n.jsx)(_.OutlinedButton,{onClick:()=>{E()},mode:"secondary",appearance:"accent",children:t("calls_history_delete_and_finish_call_button")},"finishAndDeleteCall")])),T=T.concat([(0,n.jsx)(_.OutlinedButton,{appearance:"accent",onClick:()=>{S()},children:t("calls_history_delete_call_button")},"deleteCall")]),!v)return(0,n.jsx)(n.Fragment,{});const{member:I,chat:y}=(0,r.getHistoryItemOwner)(v,g);if(!I&&!y)return(0,n.jsx)(n.Fragment,{});let N="";if(y)N=t("calls_history_delete_group_call").replace("%name",(0,p.shorten)(y.title,50));else{if(!I)return(0,n.jsx)(n.Fragment,{});{const{is_missed:e,is_inbound:a}=v;N=t(e&&a?"calls_history_delete_missed_call":!e&&a?"calls_history_delete_inbound_call":e&&!a?"calls_history_delete_declined_call":"calls_history_delete_outbound_call"),N=N.replace("%name",String(I.nameGen||I.name))}}const b=(null==v?void 0:v.finished_at)?a(v.finished_at):"";return N=N.replace("%date",b),(0,n.jsx)(i.DeleteCallModal,{onClose:f,actionButtons:T,text:N})}},352993:(e,t,a)=>{"use strict";a.d(t,{ErrorContainer:()=>u});var n=a(785893),o=a(667294),i=a(396901),r=a(22412),s=a(346880),l=a(464380),c=a(482823),d=a(135504);const u=({title:e,text:t,onCloseFatal:a,handleType:u,callId:p,bridge:_})=>{const m=(0,i.useTypedDispatch)(),{getLang:h}=(0,o.useContext)(s.LangContext),g=()=>{switch(m({type:r.E_ACTION.ERROR,isClosed:!0}),u){case r.ErrorHandleType.FATAL:a();break;case r.ErrorHandleType.DECLINE:(0,l.declineCall)().catch((()=>{}));break;case r.ErrorHandleType.PROCESS:(0,l.processPush)(p||"").then((()=>{(0,l.declineCall)().catch((()=>{}))})).catch((e=>{_.debug&&console.error("Delayed by error push process error",e)}))}},A=t||h("calls_error"),C=A.match(/<\s?[a-zA-Z0-9]+\s?\/?>/)?(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:A}}):A;return(0,n.jsx)(c.CallError,{title:e||h("calls_oops"),onClose:g,actionButtons:(0,n.jsx)(d.OutlinedButton,{"data-focus-first":!0,onClick:g,children:h("calls_close")}),text:C})}},126769:(e,t,a)=>{"use strict";a.d(t,{FeatureEndedNotificationContainer:()=>_});var n=a(785893),o=a(22412),i=a(396901),r=a(419720),s=a(915961),l=a(334909),c=a(972205),d=a(490287),u=a(974),p=a(430065);const _=()=>{const e=(0,d.useTypedSelector)((e=>e)),t=(0,d.useTypedSelector)(u.getFeatureEndedNotification),a=(0,d.useTypedSelector)(p.getIsAsrListFeatureEnabled),_=(0,d.useTypedSelector)(p.getIsSferum),m=(0,i.useTypedDispatch)(),{getLang:h}=(0,s.useLang)(),g=()=>{(0,c.setFeatureEndedNotification)(m,null)};switch(t){case o.EFeatureEndedNotification.RecordEndedNotification:return(0,n.jsx)(r.FeatureEndedNotification,{open:!0,onClose:t=>{!_&&!t&&e.translation.ownerId&&window.open&&window.open((0,l.getVideoRecordsLink)(e.translation.ownerId),"_blank"),g()},onExit:g,isShownOpenLink:!_,title:h("calls_record_is_processed"),linkTitle:h("calls_open_record_list")});case o.EFeatureEndedNotification.AsrEndedNotificationOwner:return(0,n.jsx)(r.FeatureEndedNotification,{open:!0,onClose:e=>{!e&&a&&(0,l.openAsrList)(),g()},onExit:g,isShownOpenLink:!!a,title:h("calls_asr_ended_notification"),linkTitle:h("calls_asr_ended_notification_link")});case o.EFeatureEndedNotification.AsrEndedNotificationAdmin:return(0,n.jsx)(r.FeatureEndedNotification,{open:!0,onClose:g,onExit:g,isShownOpenLink:!1,title:h("calls_asr_ended_notification_admin")});default:return(0,n.jsx)(n.Fragment,{})}}},948937:(e,t,a)=>{"use strict";a.d(t,{FeedbackContainer:()=>S});var n,o=a(434788),i=a(785893),r=a(667294),s=a(50533),l=a(396901),c=a(807083),d=a(22412),u=a(164177),p=a(346880),_=a(732297),m=a(495457),h=a(69813),g=a(659397),A=a(49339),C=a(635127),v=a(688731),f=a(119783);!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ADVANCE=1]="ADVANCE"}(n||(n={}));const S=({onSuccessFeedback:e})=>{const t=(0,l.useTypedDispatch)(),a=(0,s.useSelector)((e=>e)),{getLang:n}=(0,r.useContext)(p.LangContext),[S,E]=(0,r.useState)(0),[T,I]=(0,r.useState)(!0),[y,N]=(0,r.useState)(!1),b=new Map([["DID_NOT_HEAR_INTERLOCUTOR",n("calls_feedback_reason_did_not_hear_interlocutor")],["DID_NOT_SEE_INTERLOCUTOR",n("calls_feedback_reason_did_not_see_interlocutor")],["BAD_VIDEO_QUALITY",n("calls_feedback_reason_bad_video_quality")],["VIDEO_FREEZES",n("calls_feedback_reason_video_freezes")],["VERY_QUIET_SOUND",n("calls_feedback_reason_very_quiet_sound")],["BAD_SOUND_QUALITY",n("calls_feedback_reason_bad_sound_quality")],["SOUND_DID_NOT_MATCH_THE_VIDEO",n("calls_feedback_reason_sound_did_not_match_the_video")],["FAILED_TO_TURN_ON_CAMERA_OR_MICROPHONE",n("calls_feedback_reason_failed_to_turn_on_camera_or_microphone")]]),[x,M]=(0,r.useState)({user_response:0,feedback:[],custom_feedback:void 0}),[O]=(0,r.useState)(Array.from(b,(([e])=>({name:e,checked:!1})))),P=()=>{t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY})},R=e=>{const t=e.target.getAttribute("data-response");if(!t)return;const a=parseInt(t,10);a<=3&&E(1),M((0,o._)({},x,{user_response:a})),I(!1)},k=(e,t)=>{O.forEach((a=>{a.name===e&&(a.checked=t)})),M((e=>(0,o._)({},e,{feedback:O.filter((e=>e.checked)).map((e=>e.name))})))},w=(e,t)=>{N(t)},D=e=>{M((0,o._)({},x,{custom_feedback:e.currentTarget.value}))};return(0,i.jsx)(c.CallModal,{onClose:P,onBackdropClick:P,children:(0,i.jsx)("section",{role:"dialog","aria-label":n(0===S?"calls_feedback_default_title":"calls_feedback_advance_title"),"aria-modal":"true",className:"Call",children:(0,i.jsx)(f.FocusTrap,{children:(0,i.jsx)(u.FeedbackScreen,{title:n(0===S?"calls_feedback_default_title":"calls_feedback_advance_title"),sendButtonClick:()=>{const n=(a.lastCallData?a.lastCallData.peerId:0)||0;_.callStats.logEvent({call_event_type:d.CallActionEventType.USER_FEEDBACK_RECEIVED,session_id:a.lastCallData?a.lastCallData.callId:"",peer_id:n,is_group_call:(0,m.isGroupCallByPeer)(n),user_response:x.user_response,feedback:x.feedback,custom_feedback:y&&x.custom_feedback?x.custom_feedback:void 0}),t({type:d.E_ACTION.CHANGE_MODE,mode:d.Mode.READY}),e&&e()},skipButtonClick:P,sendButtonDisabled:T,children:0===S?(0,i.jsx)("div",{className:"FeedbackScreen__stars",onClick:R,children:[1,2,3,4,5].map(((e,t)=>(0,i.jsxs)("div",{className:(0,g.classNames)("FeedbackScreen__star",{"FeedbackScreen__star--active":e<=x.user_response}),"data-response":e,children:[(0,i.jsx)(h.StarOutline,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--outline"}),(0,i.jsx)(A.StarFilled,{className:"FeedbackScreen__starIcon FeedbackScreen__starIcon--filled"})]},t)))}):(0,i.jsxs)("div",{className:"FeedbackScreen__voting",children:[Array.from(b,(([e,t])=>(0,i.jsx)("div",{className:"FeedbackScreen__votingItem",children:(0,i.jsx)(C.default,{name:e,className:"FeedbackScreen__votingItemCheckbox",onChange:k,children:t})},e))),(0,i.jsxs)("div",{className:"FeedbackScreen__votingItem FeedbackScreen__votingItem--custom",children:[(0,i.jsx)(C.default,{name:"CUSTOM_FEEDBACK",className:"FeedbackScreen__votingItemCheckbox",onChange:w}),(0,i.jsx)(v.default,{className:"FeedbackScreen__votingItemTextArea",placeholder:n("calls_feedback_custom_reason_placeholder"),grow:!1,disabled:!y,onChange:D})]})]})})})})})}},752333:(e,t,a)=>{"use strict";a.d(t,{GroupCallSetupContainer:()=>f});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(22412),l=a(645329),c=a(650570),d=a(355922),u=a(230768),p=a(823877),_=a(878198),m=a(732297),h=a(495457),g=a(496111),A=a(152575),C=a(205805),v=a(915961);const f=({isWithBackButton:e,onBackClick:t})=>{const a=(0,C.useCallsSDK)(),f=(0,i.useSelector)((e=>e)),E=(0,i.useSelector)((e=>e.me)),T=(0,i.useSelector)((e=>e.participants)),I=(0,r.useTypedDispatch)(),{getLang:y}=(0,v.useLang)(),[N,b]=(0,o.useState)(f.preselectedIds||[]),x=(0,i.useSelector)((e=>e.chatMembers.length)),M=(0,i.useSelector)((e=>e.friendsCount||0)),O=(0,i.useSelector)((e=>e.groupMembersCount)),P=(0,i.useSelector)((e=>0!==e.groupId)),{creatorPeerId:R,membersCount:k}=(0,o.useMemo)((()=>(0,g.getParticipantsInfo)({me:E,participants:T,excludeAnonymFromCount:!0})),[T,E]),w=(0,g.isParticipantGroup)(R),D=k+N.length,L=(0,o.useMemo)((()=>[!P&&!w&&d.ETabName.Participants,P?d.ETabName.Community:d.ETabName.Friends]),[P]),{onChangeTab:j,tab:B,tabs:U}=(0,d.useTabs)({membersCount:k,friendsCount:M,groupMembersCount:O,displayTabs:L,defaultTab:P?d.ETabName.Community:w?d.ETabName.Friends:x>1?d.ETabName.Participants:d.ETabName.Friends}),H=()=>{I({type:s.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),I({type:s.E_ACTION.MANAGEMENT,isOpen:!1})},F=0===N.length,V=e=>{H(),I({type:s.E_ACTION.MANUAL_ADD_PARTICIPANTS,participants:e});const t=e.map((e=>new Promise((t=>{const n=String(e);a.addParticipant(n).then((e=>{(0,A.updateRoomParticipants)(I,s.ROOM_MAIN_ID,{addedParticipantIds:[(0,g.getDefaultExternalId)(n)]}),t(e)})).catch((a=>{"auth.banned"===a.message?t(e):"vk-participant-is-rejected-error"===a.message?I({type:s.E_ACTION.ERROR,text:y("calls_error_cant_add_because_of_privacy")}):t(null)}))}))));Promise.all(t).then((e=>{if((e=e.filter((e=>void 0!==e))).length){const t=function(e,t){const a=[...e.friends,...e.chatMembers,...e.groupMembers];let n=[];const o=a.filter((e=>{const a=e.id;return!(!t.includes(a)||n.includes(a))&&(n.push(a),!0)}));return o}(f,e);I({type:s.E_ACTION.UNBAN_PARTICIPANTS,data:{members:t}})}}));const[n,o]=(0,_.convertClientData)(function(e,t){const a=e.chatData||e.callData.conversation,n=t.reduce(((t,a)=>(e.participants[a]||t.set(a,!0),t)),new Map);if(0===n.size)return[a,[]];const o=e.chatMembers.length<e.friends.length?e.chatMembers:e.friends,i=e.chatMembers.length<e.friends.length?e.friends:e.chatMembers,{smallerListData:r,smallerListMap:s}=o.reduce(((e,t)=>(n.get(t.id)&&(e.smallerListData.push(t),e.smallerListMap.set(t.id,!0)),e)),{smallerListData:[],smallerListMap:new Map});if(r.length===n.size)return[a,r];const l=i.filter((e=>!s.get(e.id)&&n.get(e.id)));return[a,[...r,...l]]}(f,e));I({type:s.E_ACTION.LOAD_PEERS,conversation:n,members:o}),m.callStats.logEvent({call_event_type:s.CallActionEventType.OUTGOING_CALL_ADD_PARTICIPANTS_SENT,session_id:f.callData.callId,peer_id:f.peer.toString(),is_group_call:(0,h.isGroupCallByPeer)(f.peer),group_call_users_count:N.length})};return(0,n.jsx)(l.CallManagementModal,{title:y("calls_add_participants_to_call"),onCloseModal:H,actionButtons:(0,n.jsx)(u.CallManagementModalActionButtons,{isAddSubmitDisabled:F,onAdd:()=>{V(N)},onAddAll:()=>{const e=(0,p.prepareCallAllData)({state:f});V(e)},tab:B,showCallAll:x>k}),hint:B!==d.ETabName.Participants?S(D,y):void 0,isWithBackButton:e,onBackClick:e?t:()=>{},children:(0,n.jsx)(c.AddParticipants,{onChange:b,tab:B,tabs:U,onChangeTab:j,selected:N})})};function S(e,t){if(e<2)return t("calls_management_add_warning")}},144650:(e,t,a)=>{"use strict";a.d(t,{default:()=>A});var n=a(785893),o=a(494817),i=a(297753),r=a(721493),s=a(520041),l=a(26660),c=a(748771),d=a(558791),u=a(489284),p=a(878198),_=a(939723),m=a(694379),h=a(121883),g=a(817302);const A=()=>{const{getLang:e}=(0,d.useLangContext)(),t=(0,l.useHistoryScreenSelector)((e=>e.error)),a=(0,l.useHistoryScreenSelector)((e=>e.deleteCallId)),A=(0,l.useHistoryScreenSelector)((e=>e.popup));(0,g.useHistoryLongpoll)();const{isVkme:C,vkmeHistoryCallsContainerElement:v}=(0,m.useVkmeContext)();return(0,n.jsxs)(c.HistoryScreenErrorBoundary,{getLang:e,children:[C&&v?(0,n.jsx)(r.HistoryScreenContainerVkme,{title:e("calls_landing_standalone_title"),containerElement:v}):(0,n.jsx)(i.HistoryScreenContainer,{changeQuery:h.changeQuery}),a>=0&&(0,n.jsx)(o.DeleteCallContainer,{}),null!==t&&(0,n.jsx)(s.HistoryScreenErrorContainer,{}),(0,p.hasIn)(A,_.EHistoryScreenPopup.DeleteCalendarEvent,_.EHistoryScreenPopup.EditCalendarEvent,_.EHistoryScreenPopup.RescheduleCalendarEvent)&&(0,n.jsx)(u.ModalEditCalendarEventContainer,{})]})}},297753:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenContainer:()=>I});var n=a(785893),o=a(667294),i=a(434378),r=a(63846),s=a(511649),l=a(160232),c=a(408970),d=a(29920),u=a(486726),p=a(936264),_=a(26660),m=a(558791),h=a(939723),g=a(972980),A=a(472678),C=a(124328),v=a(781382),f=a(771345),S=a(700677),E=a(334909);const T={[h.HistoryScreenSections.ALL]:"calls",[h.HistoryScreenSections.FRIENDS]:(0,E.getHistorySectionUrl)(h.HistoryScreenSections.FRIENDS),[h.HistoryScreenSections.CURRENT]:(0,E.getHistorySectionUrl)(h.HistoryScreenSections.CURRENT),[h.HistoryScreenSections.SCHEDULED]:(0,E.getHistorySectionUrl)(h.HistoryScreenSections.SCHEDULED),[h.HistoryScreenSections.HISTORY]:(0,E.getHistorySectionUrl)(h.HistoryScreenSections.HISTORY),[h.HistoryScreenSections.MISS]:(0,E.getHistorySectionUrl)(h.HistoryScreenSections.MISS),[h.HistoryScreenSections.DECODING]:(0,E.getHistorySectionUrl)(h.HistoryScreenSections.DECODING),[h.HistoryScreenSections.RECORDS]:(0,E.getHistorySectionUrl)(h.HistoryScreenSections.RECORDS)},I=e=>{const{changeQuery:t}=e,{getLang:a}=(0,m.useLangContext)(),E=(0,_.useHistoryScreenSelector)((e=>e.showCreateCall)),I=(0,_.useHistoryScreenSelector)((e=>e.config.enableAsrList)),{section:y,setSection:N}=(0,r.useHistoryScreenLocation)(window.location),{onCreateCallClick:b,onPlanCalendarEvent:x}=(0,s.useHistoryScreenBridgeActions)(),{loading:M,setLoading:O}=(0,l.useHistoryScreenLoading)(),P=(0,o.useMemo)((()=>{const e=[{type:"item",id:h.HistoryScreenSections.ALL,label:a("calls_page_menu_all_calls")},{type:"item",id:h.HistoryScreenSections.FRIENDS,label:a("calls_page_menu_friends_calls")},{type:"separator"},{type:"item",id:h.HistoryScreenSections.CURRENT,label:a("calls_page_menu_current_calls")},{type:"item",id:h.HistoryScreenSections.SCHEDULED,label:a("calls_scheduled")},{type:"separator"},{type:"item",id:h.HistoryScreenSections.HISTORY,label:a("calls_history")},{type:"item",id:h.HistoryScreenSections.MISS,label:a("calls_page_menu_miss_calls")}];return I&&e.push({type:"separator"},{type:"item",id:h.HistoryScreenSections.DECODING,label:a("calls_page_menu_decoding_calls")}),e}),[a]),R=(0,o.useCallback)(((e,a)=>(t(a),N(e),O(!0),window.scrollTo({top:0}),Promise.resolve())),[]),k=(0,o.useCallback)((e=>{const t=e===h.HistoryScreenSections.ALL?"":e;R(t,T[e])}),[]),w=(0,o.useMemo)((()=>y===h.HistoryScreenSections.MISS?(0,n.jsx)(c.HistoryScreenSectionMissedCallsContainer,{}):y===h.HistoryScreenSections.FRIENDS?(0,n.jsx)(d.HistoryScreenSectionFriendsContainer,{}):y===h.HistoryScreenSections.CURRENT?(0,n.jsx)(u.HistoryScreenSectionCurrentCallsContainer,{}):y===h.HistoryScreenSections.HISTORY?(0,n.jsx)(A.HistoryScreenSectionHistoryContainer,{}):y===h.HistoryScreenSections.SCHEDULED?(0,n.jsx)(g.HistoryScreenScheduledCallsContainer,{}):y===h.HistoryScreenSections.DECODING?(0,n.jsx)(C.CallsDecodingContainer,{}):y===h.HistoryScreenSections.RECORDS?(0,n.jsx)(v.CallRecordsContainer,{}):(0,n.jsx)(p.HistoryScreenSectionAllCallsContainer,{onMenuItemClick:R})),[y]);return(0,n.jsx)(i.CallHistoryScreen,{showCreateCall:E,onCreateCallClick:b,activeMenuItem:""===y?h.HistoryScreenSections.ALL:y,menuItems:P,onMenuItemClick:k,loading:M,banner:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.ReactionsBanner,{}),(0,n.jsx)(f.AppDownloadBanner,{onCreateCall:b})]}),onPlanCalendarEvent:x,children:w})}},721493:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenContainerVkme:()=>l});var n=a(785893),o=a(973935),i=a(659397),r=a(513885),s=a(297753);const l=e=>{const{containerElement:t,title:a}=e;return(0,n.jsx)(r.default,{title:a,onClose:()=>{t&&o.unmountComponentAtNode(t)},children:(0,n.jsx)(s.HistoryScreenContainer,{changeQuery:i.noop})})}},748771:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenErrorBoundary:()=>r});var n=a(785893),o=a(667294),i=a(197264);class r extends o.Component{static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(e,t){console.error("Call history crashed:",e,t)}render(){return this.state.hasError?(0,n.jsx)("div",{className:"CallHistoryScreen--error",children:(0,n.jsx)(i.default,{title:this.props.getLang("global_error"),children:(0,n.jsx)("div",{className:"CallHistoryScreen--errorContent",children:this.props.getLang("global_unexpected_error_try_later")})})}):this.props.children}constructor(e){super(e),this.state={hasError:!1}}}},520041:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenErrorContainer:()=>c});var n=a(785893),o=a(482823),i=a(26660),r=a(558791),s=a(121883),l=a(135504);const c=()=>{const e=(0,i.useHistoryScreenDispatch)(),t=(0,i.useHistoryScreenSelector)((e=>e.error)),{getLang:a}=(0,r.useLangContext)(),c=()=>{e((0,s.dispatchSetError)(null))};return(0,n.jsx)(o.CallError,{title:(0,n.jsxs)(n.Fragment,{children:[(null==t?void 0:t.title)||a("calls_oops")," "]}),onClose:c,actionButtons:(0,n.jsx)(l.OutlinedButton,{"data-focus-first":!0,onClick:c,children:a("calls_close")}),text:(0,n.jsx)(n.Fragment,{children:null==t?void 0:t.text})})}},972980:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenScheduledCallsContainer:()=>d});var n=a(785893),o=a(667294),i=a(626334),r=a(160232),s=a(581351),l=a(564770),c=a(107487);const d=()=>{const{setLoading:e}=(0,r.useHistoryScreenLoading)(),t=(0,l.useOwnerSelect)(),{scheduledCalls:a}=(0,i.useScheduledCalls)({type:i.EScheduledCallsType.Full,forceUpdate:(0,c.useHistoryScheduledCallsUpdate)(),callerId:t.value});return(0,o.useEffect)((()=>{e(!!(null==a?void 0:a.loading))}),[null==a?void 0:a.loading]),(0,n.jsx)(s.HistoryScreenScheduledCalls,{calls:a,loading:null==a?void 0:a.loading,skeletonHeight:500,section:"scheduled",ownerSelect:t})}},936264:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenSectionAllCallsContainer:()=>M});var n=a(434788),o=a(785893),i=a(667294),r=a(22412),s=a(251985),l=a(197264),c=a(814850),d=a(511649),u=a(843454),p=a(700200),_=a(162532),m=a(913377),h=a(455319),g=a(22490),A=a(224050),C=a(659397),v=a(26660),f=a(558791),S=a(121883),E=a(626334),T=a(581351),I=a(88123),y=a(279604),N=a(107487),b=a(514995),x=a(465768);const M=({onMenuItemClick:e})=>{const t=(0,v.useHistoryScreenDispatch)(),{getLang:a}=(0,f.useLangContext)(),M=(0,v.useHistoryScreenSelector)((e=>e.profiles)),O=(0,v.useHistoryScreenSelector)((e=>e.historyCalls)),{scheduledCallsPreview:P}=(0,E.useScheduledCalls)({type:E.EScheduledCallsType.Preview,forceUpdate:(0,N.useHistoryScheduledCallsUpdate)()}),{onCreateCallClick:R,onJoin:k}=(0,d.useHistoryScreenBridgeActions)(),{currentCallsBlockLoading:w,currentCalls:D}=(0,m.useHistoryScreenCurrentCallsLoadActions)(),[L,j]=(0,i.useState)(!1),[B,U]=(0,i.useState)([]),[H,F]=(0,i.useState)(!1),V=(0,y.useHistoryCalls)();(0,i.useEffect)((()=>{j(!0),(0,_.getFriends)(7).then((({items:e})=>{const t=e.map(h.normalizeUser);U(t)})).catch(x.handlePromiseError).finally((()=>{j(!1)}))}),[]);const G=(0,i.useCallback)(((t,a,n)=>{t.preventDefault(),e(a,n)}),[]),W=(0,i.useCallback)(((e,t)=>!(!e.ctrlKey&&!e.metaKey)||(e.preventDefault(),k("",t,r.CallStatSource.HISTORY_FRIENDS_LIST),!1)),[]);return(0,i.useEffect)((()=>{if(!V.loading){const e=!(w||D.length||V.loading||O.length||0!==V.selectedOwnerId);F(e),t((0,S.dispatchSetShowCreateButton)(!e))}return()=>{t((0,S.dispatchSetShowCreateButton)(!0))}}),[w,D.length,V.loading,O.length,V.selectedOwnerId]),(0,o.jsxs)("div",{className:"CallHistoryScreen--content",children:[H&&(0,o.jsx)(l.default,{className:(0,C.classNames)({"CallHistoryScreenLanding--pageBlock":!L&&0===B.length}),children:(0,o.jsx)(c.CallHistoryScreenLanding,{onCreateCallClick:R})}),L&&(0,o.jsx)(l.default,{children:(0,o.jsx)(s.DivBlockSkeleton,{height:147})}),!L&&B.length>0&&(0,o.jsxs)(l.default,{children:[(0,o.jsx)(A.ListHeader,{className:"CallHistoryScreen--listHeader",right:(0,o.jsx)(p.default,{href:"/calls?section=friends","aria-label":a("calls_show_all_friends"),onClick:()=>G(event,"friends","calls?section=friends"),className:"CallHistoryScreen--moreLink",children:a("calls_history_show_all_friends_header_link")}),children:a("calls_history_friends_block_header")}),(0,o.jsx)("ul",{className:"CallHistoryScreen--friendsList",children:B.map((e=>(0,o.jsx)("li",{className:"CallHistoryScreen--friendsListItem",children:(0,o.jsx)("button",{"aria-label":a("calls_call_user").replace("{user}",e.name),onClick:()=>W(event,e.peerId),className:"CallHistoryScreen--friendsListItemLink",children:(0,o.jsxs)("div",{className:"CallHistoryScreen--friendsListItemContent",children:[(0,o.jsx)(b.AvatarRich,{wrapperClassName:"CallHistoryScreen--friendsListItemPhoto",src:e.photo,isNFT:!!e.is_nft,imgAlt:e.name,size:48}),(0,o.jsx)("div",{className:"CallHistoryScreen--friendsListItemPhotoHoverIcon",children:(0,o.jsx)(g.Icon28PhoneOutline,{fill:"white"})}),(0,o.jsx)("div",{className:"CallHistoryScreen--friendsListItemName",children:e.firstName})]})})},e.id)))})]}),w&&(0,o.jsx)(l.default,{children:(0,o.jsx)(s.DivBlockSkeleton,{height:300})}),!w&&D.length>0&&(0,o.jsxs)(l.default,{className:"CallHistoryScreen--currentCalls",children:[(0,o.jsx)(A.ListHeader,{className:"CallHistoryScreen--listHeader",extra:D.length,right:D.length?(0,o.jsx)(p.default,{onClick:()=>G(event,"current","calls?section=current"),href:"/calls?section=current",className:"CallHistoryScreen--moreLink",children:a("calls_history_show_all_header_link")}):"",children:a("calls_history_current_list_header")}),(0,o.jsx)(u.CurrentCallsList,{currentCalls:D.slice(0,5),profiles:M,onJoin:k})]}),(0,o.jsx)(T.HistoryScreenScheduledCalls,{calls:P,loading:null==P?void 0:P.loading,onLinkClick:G,skeletonHeight:300}),V.isDisplayBlock&&(0,o.jsx)(I.HistoryScreenHistoryCalls,(0,n._)({},V))]})}},486726:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenSectionCurrentCallsContainer:()=>_});var n=a(785893),o=a(667294),i=a(251985),r=a(197264),s=a(511649),l=a(843454),c=a(661307),d=a(913377),u=a(160232),p=a(558791);const _=()=>{const{getLang:e}=(0,p.useLangContext)(),{onJoin:t}=(0,s.useHistoryScreenBridgeActions)(),{currentCallsBlockLoading:a,currentCalls:_,profiles:m}=(0,d.useHistoryScreenCurrentCallsLoadActions)(),{setLoading:h}=(0,u.useHistoryScreenLoading)(),g=(0,o.useMemo)((()=>a?(0,n.jsx)(r.default,{children:(0,n.jsx)(i.DivBlockSkeleton,{height:300})}):(0,n.jsxs)(r.default,{title:e("calls_history_current_list_header"),className:"CallHistoryScreen--content CallHistoryScreen--currentCalls",children:[(0,n.jsx)(l.CurrentCallsList,{currentCalls:_,profiles:m,onJoin:t}),0===_.length&&(0,n.jsx)(c.default,{className:"CallHistoryList--stub",children:e("calls_history_current_calls_list_stub")})]})),[a,_]);return(0,o.useEffect)((()=>{h(a)}),[a]),(0,n.jsx)(n.Fragment,{children:g})}},29920:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenSectionFriendsContainer:()=>P});var n=a(785893),o=a(667294),i=a(22412),r=a(167810),s=a(251985),l=a(197264),c=a(160232),d=a(162532),u=a(455319),p=a(625533),_=a(502592),m=a(661307),h=a(512334),g=a(59077),A=a(874908),C=a(212169),v=a(694379),f=a(26660),S=a(558791),E=a(645022),T=a(984482),I=a(222574),y=a(514995),N=a(878198),b=a(347845),x=a(129502),M=a(465768);const O=100;const P=()=>{const{getLang:e,langShortDate:t,langNumeric:a,langSex:P}=(0,S.useLangContext)(),R=(0,f.useHistoryScreenSelector)((e=>e.meId)),{setLoading:k,loading:w}=(0,c.useHistoryScreenLoading)(),{bridge:D}=(0,E.useBaseObjectsContext)(),[L,j]=(0,o.useState)([]),[B,U]=(0,o.useState)(!1),[H,F]=(0,o.useState)(0),[V,G]=(0,o.useState)(0),[W,$]=(0,o.useState)(""),[z,Z]=(0,o.useState)(!1),K=(0,o.useRef)(null),{navigateToConvo:Q}=(0,r.useNavigationContext)(),Y=(0,f.useHistoryScreenSelector)((e=>!!e.config.enableNewSearchInput)),{isVkme:q}=(0,v.useVkmeContext)();(0,o.useEffect)((()=>{k(!0);(0,d.getFriends)(100,H).then((({count:e,items:t})=>{G(e);U(100<e),F(100);const a=t.map(u.normalizeUser);j(a)})).catch(M.handlePromiseError).finally((()=>{k(!1)}))}),[]);const J=(0,o.useMemo)((()=>V>O),[V]);(0,o.useEffect)((()=>{const e=W;if(J){if(e.length>=1&&!z)return K.current&&clearTimeout(K.current),K.current=setTimeout((()=>{Z(!0),(0,d.friendsSearch)(R,e,50).then((({count:e,items:t})=>{U(50<e),F(50);const a=t.map(u.normalizeUser);j(a)})).catch(M.handlePromiseError).finally((()=>{Z(!1)}))}),1e3),()=>{clearTimeout(K.current)};0===e.length&&(0,d.getFriends)(O,0).then((({count:e,items:t})=>{U(100<e),F(100);const a=t.map(u.normalizeUser);j(a)})).catch(M.handlePromiseError)}}),[W]);const X=(0,o.useCallback)(((e,t)=>{D.call(e,t,void 0,i.CallStatSource.HISTORY_FRIENDS_LIST)}),[]),ee=(0,o.useCallback)((e=>e.name),[]),te=(0,o.useCallback)((e=>e.peerId),[]),ae=(0,C.useIndexer)(L,ee,te),ne=W&&!J?ae.search(W):L,oe=(0,o.useCallback)((e=>{$(e.target.value)}),[]),ie=(o,i)=>{var r,s;let l="";var c,d,u,p,_,m;(null==(r=o.onlineInfo)?void 0:r.is_online)?l="Online":(null==(c=o.onlineInfo)?void 0:c.last_seen)?l=q?t(1e3*(null==(d=o.onlineInfo)?void 0:d.last_seen),!1):function(e,t,a,n){const o=Math.floor((Date.now()-n)/1e3);let i;return i=o<60?e("global_just_now"):o<3600?t(Math.floor(o/60),"global_mins_ago",e("global_mins_ago","raw")):o<21600?t(Math.floor(o/3600),"global_hours_ago",e("global_hours_ago","raw")):a(n,!1),i}(e,a,t,1e3*(null==(u=o.onlineInfo)?void 0:u.last_seen)):(null==(p=o.onlineInfo)?void 0:p.status)&&(l="recently"===(null==(_=o.onlineInfo)?void 0:_.status)?P(o.sex,"global_online_was_recently",e("global_online_was_recently","raw")):"last_week"===(null==(m=o.onlineInfo)?void 0:m.status)?P(o.sex,"global_online_was_week",e("global_online_was_week","raw")):P(o.sex,"global_online_long_ago",e("global_online_long_ago","raw")));return(0,n.jsx)(h.default,{className:"CallParticipantListItem",selectable:!1,canBeHovered:!1,aside:(0,n.jsxs)("div",{className:"CallHistoryScreen--friendsIcons",children:[(0,n.jsx)(x.SmallIconButton,{"aria-label":`${e("calls_history_dropdown_item_audio")} ${o.name}`,onClick:()=>X(o.peerId,!1),children:(0,n.jsx)(g.Icon24PhoneOutline,{})}),(0,n.jsx)(x.SmallIconButton,{"aria-label":`${e("calls_history_dropdown_item_video")} ${o.name}`,onClick:()=>X(o.peerId,!0),children:(0,n.jsx)(A.Icon24VideocamOutline,{})})]}),children:(0,n.jsx)(b.CallsRichCell,{before:(0,n.jsx)("div",{className:"CallHistoryListItem__Avatar",children:(0,n.jsx)(y.AvatarRich,{isNFT:!!o.is_nft,src:o.photo,imgAlt:o.name,badge:(0,N.vou)(null==(s=o.onlineInfo)?void 0:s.is_online,y.AvatarRichStandardBadgeType.ONLINE),size:32})}),caption:l,href:o.link,title:o.name,onClick:e=>{q&&(e.preventDefault(),e.stopPropagation(),Q(o.peerId))}})},i)};return w?(0,n.jsx)(l.default,{children:(0,n.jsx)(s.DivBlockSkeleton,{height:500})}):(0,n.jsxs)(l.default,{title:e("calls_page_menu_friends_calls"),className:"CallHistoryScreen--content",children:[!Y&&(0,n.jsx)(I.BlockSearchInput,{className:"CallParticipantList__input",value:W,placeholder:e("global_search"),onChange:oe,onInput:oe,onPaste:oe}),Y&&(0,n.jsx)(T.UiSearchNew,{className:"CallParticipantList__input--new",placeholder:e("global_search"),onChange:$}),(0,n.jsx)(p.default,{useIntersectionObserver:q,useWindowScroll:!0,hasMore:B,loadMore:()=>W&&J?(0,d.friendsSearch)(R,W,50,H).then((({count:e,items:t})=>{const a=H+50;U(a<e),F(a);let n=[...L,...t.map(u.normalizeUser)];return j(n),!0})).catch((e=>((0,M.handlePromiseError)(e),!1))):(0,d.getFriends)(O,H).then((({items:e})=>{const t=H+O;U(t<V),F(t);let a=[...L,...e.map(u.normalizeUser)];return j(a),!0})).catch((e=>((0,M.handlePromiseError)(e),!1))),children:(0,n.jsxs)(_.default,{className:"CallHistoryList",border:!1,children:[ne.map(((e,t)=>ie(e,t))),0===ne.length&&(0,n.jsx)(m.default,{className:"CallHistoryList--stub",children:e("calls_page_friends_not_found")})]})})]})}},472678:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenSectionHistoryContainer:()=>s});var n=a(434788),o=a(785893),i=a(88123),r=a(279604);const s=()=>{const e=(0,r.useHistoryCalls)();return(0,o.jsx)(i.HistoryScreenHistoryCalls,(0,n._)({},e))}},408970:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenSectionMissedCallsContainer:()=>u});var n=a(785893),o=a(218284),i=a(251985),r=a(197264),s=a(974571),l=a(611324),c=a(26660),d=a(558791);const u=()=>{const e=(0,c.useHistoryScreenSelector)((e=>e.historyCalls)),{getLang:t}=(0,d.useLangContext)(),{onShowMoreHistory:a,loading:u,showMoreHistory:p}=(0,l.useHistoryScreenLoadActions)("missed"),{onHistoryAction:_}=(0,s.useHistoryScreenContextActions)();return u?(0,n.jsx)(r.default,{children:(0,n.jsx)(i.DivBlockSkeleton,{height:500})}):(0,n.jsx)(r.default,{title:t("calls_history_missed_list_header"),className:"CallHistoryScreen--content",children:(0,n.jsx)(o.CallHistoryList,{calls:e,onMenuItemClick:_,stubText:t("calls_history_missed_list_stub"),hasMore:p,onLoadMore:a})})}},85269:(e,t,a)=>{"use strict";a.d(t,{IncomingCallContainer:()=>v});var n=a(785893),o=a(396901),i=a(490287),r=a(915961),s=a(953063),l=a(136486),c=a(958928),d=a(807083),u=a(495457),p=a(22412),_=a(732297),m=a(742384),h=a(976809),g=a(315954),A=a(788822),C=a(205805);const v=({bridge:e})=>{const t=(0,C.useCallsSDK)(),a=(0,o.useTypedDispatch)(),{getLang:v}=(0,r.useLang)(),f=(0,s.useFetchData)({cb:t.declineCall}),S=(0,s.useFetchData)({cb:e.acceptCall}),E=(0,i.useTypedSelector)((e=>e.peer)),T=(0,i.useTypedSelector)((e=>e.callData)),I=(0,i.useTypedSelector)((e=>e.participants));let y=(0,i.useTypedSelector)((e=>e.caller));y||(y=(0,u.isGroupCallByPeer)(E)?T.conversation:I[E]);const N=T.type===p.CallType.VIDEO,b=v(N?"calls_incoming_videocall":"calls_incoming_audiocall"),x=v(N?"calls_reply_with_audio":"calls_reply"),M=v(N?"calls_reject_call":"calls_reject"),O=()=>{f.fetchData(),_.callStats.logEvent({call_event_type:p.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:T.callId,peer_id:E,is_group_call:(0,u.isGroupCallByPeer)(E),reason:"none"})};return(0,n.jsx)(d.CallModal,{onClose:O,isIncoming:!0,isCautionBoxShown:!0,children:(0,n.jsx)("div",{role:"dialog","aria-label":`${(null==y?void 0:y.tab)||""} ${b}`,"aria-modal":"true",children:(0,n.jsx)(c.IncomingCall,{id:E,title:(0,A.decodeHTMLEntities)((null==y?void 0:y.tab)||""),description:b,photo:(null==y?void 0:y.photo)||"",onCollapseCall:()=>{a({type:p.E_ACTION.CHANGE_UI_MODE,mode:p.UIMode.COLLAPSED})},isNFT:null==y?void 0:y.is_nft,children:(0,n.jsxs)(n.Fragment,{children:[N&&(0,n.jsx)(l.CallButton,{text:v("calls_reply_with_video"),type:l.CallButtonTypes.POSITIVE,icon:(0,n.jsx)(m.Icon24Videocam,{}),onClick:()=>S.fetchData(!0,!0),disabled:S.loading}),(0,n.jsx)(l.CallButton,{text:x,type:N?l.CallButtonTypes.REGULAR:l.CallButtonTypes.POSITIVE,icon:(0,n.jsx)(h.Icon24Phone,{}),onClick:()=>S.fetchData(!1,!0),disabled:S.loading}),(0,n.jsx)(l.CallButton,{text:M,type:l.CallButtonTypes.NEGATIVE,icon:(0,n.jsx)(g.Icon24Cancel,{}),onClick:O,disabled:f.loading})]})})})})}},966606:(e,t,a)=>{"use strict";a.d(t,{JoinScreenContainer:()=>N});var n=a(11010),o=a(785893),i=a(667294),r=a(824730),s=a(937107),l=a(22412),c=a(878198),d=a(162532),u=a(346880),p=a(3264),_=a(496111),m=a(146679),h=a(226028),g=a(119783),A=a(869048),C=a(816511),v=a(400856),f=a(463365),S=a(465768),E=a(302617),T=a(940296),I=a(490287),y=a(796317);const N=({isAnonym:e,joinLink:t,vkJoinLink:a,title:N,members:M,membersCount:O,conversationData:P,withPopup:R,onBeforeCallStart:k,onAfterCallFinish:w,onClose:D,bridge:L,entryPoint:j,tabIsMaster:B,tabIsIdle:U,onError:H,isDev:F,okPublicKey:V,callId:G})=>{const W=(0,i.useContext)(u.LangContext),{sendStatsData:$}=(0,E.useSendStatsData)(),{participants:z,me:Z,callByName:K}=(0,I.useTypedSelector)((({participants:e,me:t,callByName:a})=>({participants:e,me:t,callByName:a}))),Q=z[Z],{getLang:Y,langNumeric:q}=W,[J,X]=(0,i.useState)(""),[ee,te]=(0,i.useState)(null),[ae,ne]=(0,i.useState)(!1);let oe=!1;const{allowCallByName:ie,anonymPhoto:re,enableChangeName:se}=(0,i.useContext)(y.ConfigContext),le=ie||!!se,{nameOptions:ce,changeNameOptions:de}=(0,h.useChangeNameOptions)(Q),ue=M?M.slice(0,3).map((e=>{const t=e.firstName||e.shortName||e.name||"";return(0,_.isParticipantAnonym)(e.peerId)&&!re||!e.photo_100?{id:e.peerId,text:t.slice(0,1)}:{src:e.photo_100,alt:t,key:e.peerId}})):[],pe=(0,i.useCallback)((e=>{X(e.target.value)}),[]),_e=(0,i.useCallback)((0,n._)((function*(n){if(e||ce.type===l.CallByNameProfileType.ANONYM){if(oe)return Promise.resolve();oe=!0;let o={};return!e&&ce.type===l.CallByNameProfileType.ANONYM&&!1&&(o=yield(0,T.getAnonymToken)()),function(e,t,a,n,o,i,r){if(e)return Promise.resolve(e);const s={};i.access_token&&(s.accessToken=i.access_token);return(0,d.messagesGetCallPreview)(a,!0,s).then((({secret:e="",user_id:i=0,preview:c,is_edu:u})=>(0,d.getAnonymCallToken)(a,i,n,e,s).then((({token:e,secret:a=""})=>{var s;const d={is_dev:b(r),key:o,token:e,ok_user:i,secret:a,is_anonym:!0,me:{canAddMembers:!1,firstName:n,peerId:i,id:i,sex:"0",shortName:n,name:n,lastName:"",link:"",photo:"",photo_100:"",shortNameGen:""}},p={callPreview:{tab:null==c?void 0:c.title,photo:null==c||null==(s=c.photo)?void 0:s.photo_200},callsCredentials:d,callsOkStaging:b(r),callsLogging:!1,CallsIncomingCall:!1,callsFeedbackScreenEnabled:!1,callsVideoSlotsEnabled:!0,videoSlotsCount:l.VIDEO_SLOTS_COUNT,browserWarnings:[{browser:"safari"},{browser:"firefox"}],callsAllowCallByName:!1,callsEnableScreenTrack:!0,callsEnableProducerScreenTrack:!0,callsBadNetworkP2P:!1,callsDesktopAppNotification:!1,callsLazyLoading:!1,callsEnableDomainBender:!1,callsEnableMultipleDevices:!1,callsEnableAnonymPhoto:!u,callsEnableAsr:!1,enableNewMuteRules:!1,enableAsrList:!1};return t(p),p}))))}(ee,te,a,e?J:ce.name||"",V,o,F).then((e=>function(e){return x.apply(this,arguments)}({bridge:L,inited:ae,setInited:ne,data:e,onBeforeCallStart:k,onAfterCallFinish:w,tabIsMaster:B,tabIsIdle:U,langUtils:W}))).then((()=>L.joinCallByLink(t,null,n,j,void 0,void 0,a))).catch((e=>{let t="";t="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,c.getTextForApiErrorByCode)(e.error.error_code,!0,Y):(0,p.getCallStartErrorText)(e,!0,Y)||Y("calls_unknown_error"),H&&H(t)})).finally((()=>{oe=!1}))}{const e=ce.type===l.CallByNameProfileType.GROUP;if(D&&D(),!P)throw Error("no peer_id to join");const o={call_id:(null==K?void 0:K.callId)||"",name:ce.name||""};(0,m.decode)(`${Q.firstName} ${Q.lastName}`)===ce.name||e||(yield(0,d.callsEditParticipantName)(o).catch(S.handlePromiseError).then((()=>{$(l.CallActionEventType.NAME_CHANGED_BY_USER),de(null)}))),L.joinCallByLink(t,[P,M],n,j,e?Number(ce.id):void 0,void 0,a).catch((e=>{let t="";t="string"==typeof e?e:e&&e.error&&e.error.error_code?(0,c.getTextForApiErrorByCode)(e.error.error_code,!0,Y):Y("calls_unknown_error"),H&&H(t)}))}return Promise.resolve()})),[t,D,J,ee,ae,V,ce]),me=(0,i.useCallback)((()=>{D&&D()}),[D]),he=(0,i.useCallback)((()=>{L.showCallByNamePopup(null,j,t,{withPopup:R,callId:G})}),[j,t,R,G]),ge=(0,i.useCallback)((()=>{L.showStartCallModal(null,t,void 0,!0)}),[]);let Ae;switch(null==ce?void 0:ce.type){case l.CallByNameProfileType.GROUP:Ae=Y("calls_your_group");break;case l.CallByNameProfileType.PROFILE:Ae=Y("calls_your_profile")}const Ce=(0,o.jsx)(A.AppRootProvider,{disablePortal:!0,children:(0,o.jsx)(r.JoinScreen,{isAnonym:!!e,name:J,onChangeName:pe,namePlaceholder:Y("calls_name_placeholder"),title:(0,m.decode)(N),label:(0,c.getParticipantsListLabel)(M||[],ue,(e=>(0,_.isParticipantGroup)(e.peerId)?e.name:e.customName||e.firstName),Y,q,O),items:ue,joinWithVideoText:Y("calls_join_with_video"),joinWithAudioText:Y("calls_join_with_audio"),onJoinWithVideo:()=>_e(!0),onJoinWithAudio:()=>_e(!1),disabled:!!e&&!l.NAME_REGEX.test(J),inputDisabled:!!ee,callByNameShow:le&&!e,callByNameTitle:Y("calls_call_by_name_join_by"),callByNameDescription:"",onCallByNameClick:he,callViaNativeAppShow:!e,callViaNativeAppTitle:Y("calls_call_via_native_app_join"),onCallViaNativeAppClick:ge,profileName:null==ce?void 0:ce.name,profileType:Ae})});return R?se?(0,o.jsx)(s.default,{onClose:me,children:(0,o.jsx)(g.FocusTrap,{hasFirstFocusableElement:!0,children:(0,o.jsx)(A.AppRootProvider,{disablePortal:!0,children:(0,o.jsxs)(C.ModalBox,{children:[(0,o.jsx)(v.ModalHeader,{onClose:me,closeAriaLabel:Y("calls_close"),children:Y("calls_invite")}),Ce]})})})}):(0,o.jsxs)(s.default,{onClose:me,children:[(0,o.jsx)(f.ModalHeader,{onClose:me,title:Y("calls_invite")}),Ce]}):Ce},b=e=>void 0!==e?e:!(!window.vk||void 0===window.vk.isCallsDevEnv)&&window.vk.isCallsDevEnv;function x(){return(x=(0,n._)((function*({bridge:e,inited:t,setInited:a,data:n,onBeforeCallStart:o,onAfterCallFinish:i,tabIsMaster:r,tabIsIdle:s,langUtils:l}){if(t)return Promise.resolve();const{callPreview:c,callsCredentials:d,callsOkStaging:u,callsLogging:p,CallsIncomingCall:_,callsFeedbackScreenEnabled:m,callsVideoSlotsEnabled:h,videoSlotsCount:g,browserWarnings:A,callsAllowCallByName:C,callsEnableScreenTrack:v,callsEnableProducerScreenTrack:f,callsBadNetworkP2P:S,callsDesktopAppNotification:E,callsLazyLoading:T,callsEnableDomainBender:I,callsEnableMultipleDevices:y,callsCustomScreenSharePacketSize:N,callsEnableCustomScreenSharePacketSize:b,callsEnableAnonymPhoto:x,callsEnableAsr:M,callsEnableChangeName:O,enableNewMuteRules:P,enableAsrList:R}=n;yield e.init({callPreview:c,callsCredentials:d,imHash:"",callsOkStaging:u,onBeforeCallStart:o,onAfterCallFinish:i,tabIsMaster:r,tabIsIdle:s,langUtils:l,toggles:{debugLog:p,anonymPhoto:x,incomingCall:_,showFeedbackScreen:m,enableVideoSlots:h,videoSlotsCount:g,browserWarnings:A,allowCallByName:C,enableScreenTrack:v,enableProducerScreenTrack:f,badNetworkP2P:S,desktopAppNotification:E,lazyLoading:T,enableDomainBender:I,enableMultipleDevices:y,enableCustomScreenSharePacketSize:b,customScreenSharePacketSize:N,enableAsr:M,enableChangeName:O,enableNewMuteRules:P,enableAsrList:R}}),a(!0)}))).apply(this,arguments)}},882191:(e,t,a)=>{"use strict";a.d(t,{KickParticipantContainer:()=>_});var n=a(785893),o=a(667294),i=a(396901),r=a(490287),s=a(589897),l=a(22412),c=a(346880),d=a(316699),u=a(496111),p=a(182330);const _=()=>{const e=(0,i.useTypedDispatch)(),{getLang:t,langSex:a}=(0,o.useContext)(c.LangContext),_=(0,r.useTypedSelector)((e=>e.waitingHall)),m=(0,r.useTypedSelector)((e=>{var t;return null==(t=e.participantKick)?void 0:t.participant})),h=(0,r.useTypedSelector)((e=>{var t;return(null==(t=e.participantKick)?void 0:t.type)===l.KickParticipantType.CALL})),g=(0,r.useTypedSelector)((e=>e.callData.conversation)),[A,C]=(0,o.useState)(!0),v=!!m&&(!(0,u.participantIsAdmin)(m)&&!(0,u.participantIsChatAdmin)(m,g)),f=(0,o.useCallback)((()=>{e({type:l.E_ACTION.TOGGLE_PARTICIPANTS_KICK})}),[]),S=(0,o.useCallback)((()=>{(0,u.kickParticipant)(m,!A).then((()=>{!h&&_&&(null==m?void 0:m.peerId)&&(0,p.removeUserFromWaitingHall)(null==m?void 0:m.peerId,_,e)})),f()}),[m,A,_]),E=(0,o.useCallback)((e=>{C(e)}),[]),T=h?"calls_kick_participant_text":"calls_kick_participant_from_waiting_hall_text",I=t(h?"calls_kick_participant_text":"calls_kick_participant_from_waiting_hall_text","raw");var y;const N=a(null==m?void 0:m.sex,T,I).replace("{user}",null!=(y=null==m?void 0:m.name)?y:""),b=t(h?"calls_kick_participant_kick_button_text":"calls_kick_participant_from_waiting_hall_button_text"),x=t(h?"calls_kick_participant_with_ban_setting":"calls_kick_participant_from_waiting_hall_with_ban_setting");return(0,n.jsx)(d.KickParticipantModal,{onClose:f,onAllowReconnectChange:E,description:N,allowBan:v,banText:x,actionButtons:[(0,n.jsx)(s.default,{size:"m",onClick:f,mode:"secondary",children:t("calls_cancel")},"cancel"),(0,n.jsx)(s.default,{size:"m",mode:"primary",onClick:S,children:b},"stop")]})}},284540:(e,t,a)=>{"use strict";a.d(t,{ModalAddToCalendarContainer:()=>h});var n=a(785893),o=a(199651),i=a(275765),r=a(121644),s=a(490287),l=a(22412),c=a(396901),d=a(659397),u=a(598593),p=a(360230),_=a(465768),m=a(915961);const h=()=>{const{handleError:e}=(0,u.usePromiseError)(),{getLang:t}=(0,m.useLang)(),{showText:a}=(0,p.useNotifier)(),h=(0,c.useTypedDispatch)(),g=(0,s.useTypedSelector)((e=>{var t;return e.participants[(null==(t=e.externalId)?void 0:t.id)||e.me]})),{onClosePopupCalendar:A}=(0,r.useClosePopup)(),C=(0,i.useCalendarEventDetails)({meParticipant:g}),v=(0,s.useTypedSelector)((e=>{var t;return null==(t=e.misc)?void 0:t.plannedCalendarEvent})),f=C.getDescription(v);return v?(0,n.jsx)(o.ModalEventPlanned,{onClose:A,text:f,onCopyLink:()=>{v?(0,d.copyTextToClipboard)(v.join_link).then((()=>{a(t("calls_create_call_by_link_copied"))})).catch(e):(0,_.handlePromiseError)("No event stored is store to copy :(")},onCopyText:()=>{v?(0,d.copyTextToClipboard)(f).then((()=>{a(t("calls_create_call_by_link_text_copied"))})).catch(e):(0,_.handlePromiseError)("No event stored is store to copy :(")},onSendByMessage:()=>{h({type:c.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:l.POPUP_ON_CALL_SEND_LINK})}}):(0,n.jsx)(n.Fragment,{})}},405288:(e,t,a)=>{"use strict";a.d(t,{ModalAsrContainer:()=>C});var n=a(785893),o=a(667294),i=a(330168),r=a(915961),s=a(86894),l=a(833314),c=a(832550),d=a(121644),u=a(571181),p=a(524117),_=a(490287),m=a(174583);const h=/[#%&{}\\\/<>*?$!`"':@+|=.]/,g=/^\s*$/,A=()=>{const{getLang:e,langReplace:t}=(0,r.useLang)(),{onClose:a}=(0,d.useClosePopup)(),A=(0,_.useTypedSelector)(m.getAsrState),{startAsr:C,stopAsr:f}=(0,u.useAsr)(),S=(0,o.useCallback)((t=>h.test(t)||g.test(t)?e("calls_asr_modal_validation_wrong_symbols"):t.length>128&&e("calls_asr_modal_validation_length")),[]),E=t(e("calls_asr_start_modal_content_default_value"),{date:v()}),{onChange:T,value:I,error:y}=(0,p.useFormInputValue)({initialValue:E,validator:S}),N=(0,o.useCallback)((()=>C(I||E)),[I,E]),b=(0,o.useCallback)((()=>{(A?f:N)().finally(a)}),[A,N,f,a]),x=e(A?"calls_asr_stop_modal_title":"calls_asr_start_modal_title"),M=A?(0,n.jsx)("div",{className:"AsrStopContent",children:e("calls_asr_stop_modal_content")}):(0,n.jsx)(l.FormItem,{top:e("calls_asr_start_modal_content_title"),bottom:y||e("calls_asr_start_modal_content_description"),status:y?"error":"default",children:(0,n.jsx)(s.Input,{value:I,onChange:T,placeholder:E})}),O=e(A?"calls_asr_modal_stop_button":"calls_asr_modal_start_button");return(0,n.jsx)(i.AsrModal,{title:x,actionButtons:(0,n.jsxs)(s.ButtonGroup,{children:[(0,n.jsx)(c.Button,{mode:"secondary",onClick:a,children:e("calls_asr_modal_cancel_button")}),(0,n.jsx)(c.Button,{mode:"primary",onClick:b,disabled:!!y,children:O})]}),onClose:a,children:M})},C=(0,o.memo)(A);function v(){const e=new Date;return`${e.getDate()}-${e.getMonth()}-${e.getFullYear()}`}},489284:(e,t,a)=>{"use strict";a.d(t,{ModalEditCalendarEventContainer:()=>I});var n=a(785893),o=a(667294),i=a(731435),r=a(276744),s=a(356438),l=a(26660),c=a(915961),d=a(465768),u=a(939723),p=a(162532),_=a(151582),m=a(953063),h=a(360230),g=a(659397),A=a(275765),C=a(598593),v=a(605419),f=a(418855),S=a(511649),E=a(40982),T=a(490287);const I=()=>{const e=(0,_.useIsMounted)(),t=(0,l.useHistoryScreenDispatch)(),a=(0,T.useTypedSelector)((e=>e.config)),{getLang:I}=(0,c.useLang)(),{handleError:y}=(0,C.usePromiseError)(),{setPlannedCalendarEvent:N}=(0,S.useHistoryScreenBridgeActions)(),{showText:b}=(0,h.useNotifier)(),x=(0,m.useFetchData)({cb:p.messagesEditCall}),M=(0,m.useFetchData)({cb:p.messagesDeleteScheduledCall}),{sendCallScheduled:O}=(0,E.useSendStatsDataCallScheduled)(),P=(0,l.useHistoryScreenSelector)((e=>e.scheduledEditableCall)),R=(0,l.useHistoryScreenSelector)((e=>e.popup)),k=(0,l.useHistoryScreenSelector)((e=>e.profiles[e.meId])),w=(0,l.useHistoryScreenSelector)((e=>P?e.profiles[P.caller_id||""]:void 0)),D=(0,o.useMemo)((()=>(0,v.getUserSelectOptions)(w)),[w]),{getDescription:L}=(0,A.useCalendarEventDetails)({meParticipant:k}),j=(0,o.useCallback)((()=>{t({type:l.HistoryScreenActionTypes.SET_POPUP})}),[]),B=(0,o.useCallback)((()=>{t({type:l.HistoryScreenActionTypes.SET_POPUP,data:u.EHistoryScreenPopup.RescheduleCalendarEvent})}),[]),U=(0,o.useCallback)((t=>{if(P)return x.fetchData((0,v.mapFormData)(t,P)).then((()=>{if(!e())return;const a=new Date(t.start),n={start:a,title:t.name,repeatRule:t.rrule,join_link:P.vk_join_link||"",call_id:P.call_id,duration:t.duration,displayName:t.displayName,timezone:t.timezone,repeatRuleEnd:t.recurrenceUntilTime},o=L(n);switch(n.description=o,(0,g.copyTextToClipboard)(o).then((()=>{b(I("calls_create_call_by_link_text_copied"))})).catch(y),O({creatorId:P.caller_id,sharingChannel:t.calendar,isEdit:!0,session_id:P.call_id}),t.calendar){case f.ECalendar.Other:N(n);break;case f.ECalendar.Google:{const e=(0,v.google)((0,v.mapGoogleIcsUrl)(n,I));(0,v.openLinkInNewTab)(e,a);break}case f.ECalendar.iCloud:case f.ECalendar.Outlook:{const e=(0,v.ics)((0,v.mapGoogleIcsUrl)(n,I));(0,v.openLinkInNewTab)(e,a,!1);break}}j()})).catch(y)}),[P,x.fetchData]),H=(0,o.useCallback)((()=>{P&&M.fetchData({call_id:P.call_id}).then(j).catch(y)}),[P,M.fetchData]);return P?(0,n.jsxs)(n.Fragment,{children:[R===u.EHistoryScreenPopup.EditCalendarEvent&&(0,n.jsx)(s.ModalScheduleCall,{onClose:j,headerTitle:I("calls_edit_call_title"),onSubmit:U,call:P,loading:x.loading,myUserId:null==k?void 0:k.id,userSelectOptions:D,isWatchTogetherEnabled:!a.sferum}),R===u.EHistoryScreenPopup.DeleteCalendarEvent&&(0,n.jsx)(r.ModalDeleteCall,{call:P,onClose:j,onSubmit:H,onReschedule:B,loading:M.loading}),R===u.EHistoryScreenPopup.RescheduleCalendarEvent&&(0,n.jsx)(i.ModalRescheduleCall,{call:P,onClose:j,onSubmit:U,loading:x.loading,myUserId:null==k?void 0:k.id,userSelectOptions:D})]}):((0,d.handlePromiseError)("Пытаемся показать окно редактирования без выбранного звонка"),(0,n.jsx)(n.Fragment,{}))}},578643:(e,t,a)=>{"use strict";a.d(t,{ModalPlanCalendarEventContainer:()=>T});var n=a(434788),o=a(785893),i=a(667294),r=a(356438),s=a(605419),l=a(418855),c=a(275765),d=a(121644),u=a(490287),p=a(915961),_=a(396901),m=a(151582),h=a(162532),g=a(22412),A=a(659397),C=a(598593),v=a(360230),f=a(40982),S=a(94176),E=a(465768);const T=()=>{const{onClosePopupCalendar:e}=(0,d.useClosePopup)(),{getLang:t}=(0,p.useLang)(),{ownerOptions:a,meParticipant:T}=function(){const e=(0,_.useTypedDispatch)(),t=(0,u.useTypedSelector)((e=>{var t;return e.participants[(null==(t=e.externalId)?void 0:t.id)||e.me]})),a=(0,u.useTypedSelector)((e=>{var t;return null==(t=e.misc)?void 0:t.plannedCalendarEventOwnerOptions})),o=(0,i.useMemo)((()=>[{value:t.peerId,label:t.name,profile:(0,n._)({},t,{id:t.peerId})},...a||[]]),[a,t]);return(0,i.useEffect)((()=>{(0,h.getGroupsForCall)().then((t=>{if(t.count>0){const a=(t.items||[]).map((e=>({value:-e.id,label:e.name||"",profile:e})));e({type:_.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS,data:a})}})).catch(E.handlePromiseError)}),[]),{ownerOptions:o,meParticipant:t}}(),{handleOnSubmit:I,loading:y}=function(){const e=(0,_.useTypedDispatch)(),[t,a]=(0,i.useState)(!1),{handleError:n}=(0,C.usePromiseError)(),{showText:o}=(0,v.useNotifier)(),{getLang:r}=(0,p.useLang)(),{sendCallScheduled:E}=(0,f.useSendStatsDataCallScheduled)(),{mailRuCounter:T}=(0,S.useMailRuCounter)(),I=(0,m.useIsMounted)(),{onClosePopupCalendar:y}=(0,d.useClosePopup)(),N=(0,u.useTypedSelector)((e=>{var t;return e.participants[(null==(t=e.externalId)?void 0:t.id)||e.me]})),{getDescription:b}=(0,c.useCalendarEventDetails)({meParticipant:N}),x=(0,i.useCallback)((t=>(a(!0),(0,h.messagesStartCall)((0,s.mapFormData)(t)).then((a=>{if(!I())return;const i=new Date(t.start),c={start:i,title:t.name,repeatRule:t.rrule,join_link:a.join_link,call_id:a.call_id,duration:t.duration,displayName:t.displayName,timezone:t.timezone,repeatRuleEnd:t.recurrenceUntilTime},d=b(c);switch(c.description=d,(0,A.copyTextToClipboard)(d).then((()=>{o(r("calls_create_call_by_link_text_copied"))})).catch(n),E({creatorId:t.groupId,sharingChannel:t.calendar,session_id:a.call_id}),T.push(S.EMailRuGoals.ScheduledCall),t.calendar){case l.ECalendar.Other:return e({type:_.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:c}),void e({type:_.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:g.POPUP_SHARE_PLANNED_CALL});case l.ECalendar.Google:{const e=(0,s.google)((0,s.mapGoogleIcsUrl)(c,r));(0,s.openLinkInNewTab)(e,i);break}case l.ECalendar.iCloud:case l.ECalendar.Outlook:{const e=(0,s.ics)((0,s.mapGoogleIcsUrl)(c,r));(0,s.openLinkInNewTab)(e,i,!1);break}}y()})).catch(n).finally((()=>{I()&&a(!1)})))),[]);return{handleOnSubmit:x,loading:t}}(),N=(0,u.useTypedSelector)((e=>e.config));return(0,o.jsx)(r.ModalScheduleCall,{headerTitle:t("calls_plan_event"),onClose:e,onSubmit:I,userSelectOptions:a,myUserId:T.peerId,loading:y,isWatchTogetherEnabled:!N.sferum})}},435629:(e,t,a)=>{"use strict";a.d(t,{MovieChooseContainer:()=>k});var n=a(434788),o=a(785893),i=a(667294),r=a(778289),s=a(795302),l=a(913115),c=a(37062),d=a(639107),u=a(62863),p=a(410586),_=a(689185),m=a(281053),h=a(386125),g=a(712549),A=a(121644),C=a(256412),v=a(369984),f=a(496111),S=a(464380),E=a(808474),T=a(954982),I=a(490287),y=a(396901),N=a(93481),b=a(22412),x=a(124495),M=a(750845),O=a(743679),P=a(167810);const R=()=>{const e=(0,y.useTypedDispatch)(),{navigateToProfile:t}=(0,P.useNavigationContext)(),[a,R]=(0,i.useState)(!1),k=(0,i.useRef)(null),w=(0,I.useTypedSelector)(O.getWatchTogetherInfo),D=(0,I.useTypedSelector)((e=>e.localDevice)),L=(0,T.useIsSharedMovieOwner)(),j=(0,M.useSharedMovieParticipant)(),B=(0,f.participantIsAdmin)(D),U=(0,N.useIsWatchTogetherAllowed)(),{onClose:H}=(0,A.useClosePopup)(),{onTabClick:F,tab:V,tabs:G}=(0,s.useTabs)(),W=(0,h.useSearchSettings)(),$=(0,u.useSearchVideos)({searchSettings:W.settings}),z=(0,g.useSearch)({onSearchMovies:$.getSearchMovies}),{handleAddMovie:Z,handleRemoveMovie:K}=(0,E.useMovieShareActions)({movieAddCallback:H}),Q=()=>{w&&K(w.movieId).then((()=>{k.current&&Z(k.current)})).catch((e=>{(0,S.debugMessage)(S.DebugMessageType.ERROR,e)})).finally((()=>{R(!1),k.current=null}))},Y=t=>U?(null==w?void 0:w.movieId)!==parseInt(t.ov_id||"")?!w||B||L?void(w?(k.current=t,L?Q():R(!0)):Z(t)):(e({type:b.E_ACTION.CALL_NOTIFICATION,notification:{type:b.NotificationType.MOVIE_ALREADY_STARTED,data:null==j?void 0:j.name}}),void H()):void(0,S.debugMessage)(S.DebugMessageType.WARN,{text:"movie is currently playing",movie:t}):(e({type:b.E_ACTION.CALL_NOTIFICATION,notification:{type:b.NotificationType.ADMIN_MUTE_PERMANENT_WATCH_TOGETHER}}),void H()),q=!!z.text.length;return(0,o.jsxs)(r.MovieChooseModal,{children:[(0,o.jsx)("div",{className:"CallsMovieChooseSearchContent",children:(0,o.jsx)(m.SearchBar,(0,n._)({},W,z,{loading:$.loading}))}),w&&!q&&(0,o.jsx)(_.CurrentSharedMovie,{onCloseParentModal:H,movieInfo:w,handleRemoveMovie:K,isRemoveAvailable:L||B}),!q&&(0,o.jsx)(x.MoviesPageTabs,{tabs:G,activeTab:V,onTabClick:F,tabsClassnames:"CallsMovieChooseTabs"}),(0,o.jsxs)("div",{className:"CallsMovieChooseTilesContent",children:[q&&(0,o.jsx)(p.SearchResults,{loading:$.loading,moviesData:$.data.mappedMovies,count:$.data.count,getNextPage:$.getNextPage,query:z.lastText,onMovieClick:Y}),!q&&V===C.EMovieChooseTab.Recommended&&(0,o.jsx)(c.TabRecommended,{onMovieClick:Y,navigateToProfile:t}),!q&&V===C.EMovieChooseTab.Added&&(0,o.jsx)(l.TabAdded,{onMovieClick:Y}),!q&&V===C.EMovieChooseTab.Uploaded&&(0,o.jsx)(d.TabUploaded,{onMovieClick:Y}),a&&(0,o.jsx)(v.RemoveMovieModal,{onClose:()=>R(!1),onConfirm:Q})]})]})},k=(0,i.memo)(R)},868714:(e,t,a)=>{"use strict";a.d(t,{MuteParticipantContainer:()=>C});var n=a(785893),o=a(667294),i=a(396901),r=a(490287),s=a(915961),l=a(733222),c=a(22412),d=a(496111),u=a(732297),p=a(495457),_=a(162532),m=a(643229),h=a(464380),g=a(773816),A=a(135504);const C=()=>{var e,t,a;const C=(0,r.useTypedSelector)((e=>e)),f=(0,r.useTypedSelector)((e=>e.rooms.roomId)),S=(0,i.useTypedDispatch)(),{getLang:E}=(0,s.useLang)(),T=null==(e=C.participantsManagement)||null==(t=e.device)?void 0:t.externalId,I=(0,d.isSameExternalId)(T,C.externalId),y=function(e,t,a){if(!a)return;if(!t)return e.devices[(0,d.externalIdToString)(a)];return e.localDevice}(C,I,T),N=T&&C.participants[T.id];var b;const x=null!=(b=null==(a=C.participantsManagement)?void 0:a.mode)?b:c.ParticipantsManagementMode.SINGLE,M=I?C.localDevice:N,O=[c.ParticipantsManagementMode.SINGLE_AUDIO,c.ParticipantsManagementMode.ALL_AUDIO].includes(x),P=[c.ParticipantsManagementMode.SINGLE,c.ParticipantsManagementMode.SINGLE_AUDIO,c.ParticipantsManagementMode.SINGLE_VIDEO].includes(x),[R,k]=(0,o.useState)(!0);var w;const[D,L]=(0,o.useState)(null!=(w=null==N?void 0:N.name)?w:""),{isPermanentHide:j,onMuteTitle:B,title:U,isCurrentlyOn:H,isMediaAllowed:F}=(()=>{let e=!1,t=!1,a=!1,n=E("calls_mute_participant_dialog_action_v2"),o="",i=!1;switch(x){case c.ParticipantsManagementMode.SINGLE_AUDIO:{const t=v(M);i=g.MuteStatesHandler.isMediaAllowed("audio",y,!0),e=!i||t,a=!!(null==y?void 0:y.mediaSettings.isAudioEnabled),n=E(i?"calls_mute_participant_dialog_action_v2":"calls_mic_turn_on"),o=E(i?"calls_mute_participant_dialog_title_audio":"calls_unmute_participant_dialog_title_audio_v2").replace("{name}",D);break}case c.ParticipantsManagementMode.SINGLE_VIDEO:{const t=v(M);i=g.MuteStatesHandler.isMediaAllowed("video",y,!0),e=!i||t,a=!(!(null==y?void 0:y.mediaSettings.isVideoEnabled)&&!(null==y?void 0:y.mediaSettings.isScreenSharingEnabled)),n=E(i?"calls_mute_participant_dialog_action_v2":"calls_mute_participant_dialog_action_video_ss"),o=E(i?"calls_mute_participant_dialog_title_video":"calls_unmute_participant_dialog_title_video_v2").replace("{name}",D);break}case c.ParticipantsManagementMode.ALL_AUDIO:t=C.permissions[h.MediaOption.AUDIO]===h.MuteState.MUTE_PERMANENT,t&&(n=E("calls_mute_participant_dialog_action_mics")),e=t,o=E(t?"calls_unmute_all_participants_audio_title":"calls_mute_all_participants_dialog_title_audio");break;case c.ParticipantsManagementMode.ALL_VIDEO:t=C.permissions[h.MediaOption.VIDEO]===h.MuteState.MUTE_PERMANENT,t&&(n=E("calls_mute_participant_dialog_action_video_ss")),e=t,o=E(t?"calls_unmute_all_participants_video_title":"calls_mute_all_participants_dialog_title_video")}return{isPermanentHide:e,onMuteTitle:n,title:o,isCurrentlyOn:a,isMediaAllowed:i}})();(0,o.useEffect)((()=>{P&&!(0,d.isParticipantAnonym)((null==N?void 0:N.peerId)||0)?(S({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),new Promise(((e,t)=>{N&&N.peerId<0?(0,_.getGroupById)(-N.peerId).then((({groups:t})=>{var a;e(t&&t.length>0&&(null==(a=t[0])?void 0:a.name)||"")})).catch(t):(0,_.loadUsers)({user_ids:N&&String(N.peerId),name_case:"Dat"}).then((([t])=>{e((null==t?void 0:t.first_name)||"")})).catch(t)})).then((e=>{L(e),k(!1),S({type:c.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})})).catch(console.log)):k(!1)}),[C.participantsManagement]);const V=function({callEventType:e,sessionId:t,peerId:a,isGroupCall:n}){return o=>u.callStats.logEvent({call_event_type:e,session_id:t,peer_id:a,is_group_call:n,mute_permanent:o})}({callEventType:P?c.CallActionEventType.USER_MICS_AND_VIDEO_DISABLED:c.CallActionEventType.ALL_MICS_AND_VIDEO_DISABLED,sessionId:C.callData.callId,peerId:C.peer,isGroupCall:(0,p.isGroupCallByPeer)(C.peer)}),G=(0,o.useCallback)((()=>{S({type:c.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT})}),[]),W=(0,o.useCallback)(((e,t)=>{(0,m.muteDevice)({isAudio:O,isSingle:P,isPermanent:e,participantExternalId:t,logEvent:V,closeDialog:G,isCurrentlyOn:H,isMediaAllowed:F,roomId:f})}),[O,P,V,G,H,F,f]),$=(0,o.useCallback)((()=>{W(!0,P&&T?T:null)}),[W,T,P]),z=(0,o.useCallback)((()=>{W(!1,P&&T?T:null)}),[W,T,P]);return P&&R?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(l.MuteParticipantModal,{title:U,onClose:G,actionButtons:(0,n.jsxs)(n.Fragment,{children:[!j&&(0,n.jsx)(A.OutlinedButton,{onClick:$,mode:"secondary",children:E("calls_mute_participant_permanent_dialog_action")},"mute_permanent"),(0,n.jsx)(A.OutlinedButton,{onClick:z,children:B},"mute")]})})};function v(e){return(0,d.isCreator)(e)||(0,d.isAdmin)(e)}},120617:(e,t,a)=>{"use strict";a.d(t,{NotificationWithButtonContainer:()=>N});var n=a(785893),o=a(667294),i=a(22412),r=a(396901),s=a(589897),l=a(878198),c=a(182330),d=a(7780),u=a(291100),p=a(531878),_=a(700110),m=a(816398),h=a(998385),g=a(971276),A=a(765789),C=a(495457),v=a(915961),f=a(845301),S=a(802997),E=a(198380),T=a(490287),I=a(430065),y=a(126769);const N=()=>{var e,t,a,N;const b=(0,T.useTypedSelector)((e=>e)),x=(0,T.useTypedSelector)(I.getIsSferum),M=(0,T.useTypedSelector)(I.getIsDesktopAppNotification),O=(0,T.useTypedSelector)(I.getBrowserWarnings),P=(0,r.useTypedDispatch)(),{getLang:R,langNumeric:k}=(0,v.useLang)(),{isOnboardingBannerOpen:w,onboardingFeature:D,closeOnboardingBanner:L}=(0,f.useOnboarding)(),{onOpenWatchTogetherFeature:j,onOpenVmojiFeature:B}=(0,E.useCallFeaturesActions)(),U=(0,o.useMemo)((()=>(0,A.getWarningBrowserInfo)(O)),[O]),H=(0,o.useCallback)((e=>{var t;const a=null==(t=b.waitingHall)?void 0:t.members.get(e);a&&P({type:i.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:i.KickParticipantType.WAITING_HALL,participant:a}})}),[null==(e=b.waitingHall)?void 0:e.members,b.participants]),F=(0,o.useCallback)((()=>{const e=[(0,c.loadAdditionalWaitingHall)(b,P)];return Promise.all(e).then((()=>{P({type:i.E_ACTION.MANAGEMENT,isOpen:!0,managementView:d.ManagementViews.WAITING_HALL})}))}),[b.waitingHall]),V=(0,o.useCallback)((e=>{b.waitingHall&&(0,c.promoteUserAndRemoveFromWaitingHall)(e,b.waitingHall,P)}),[null==(t=b.waitingHall)?void 0:t.members]),G=(0,o.useCallback)((()=>{(0,c.resetWaitingHallNew)(b.waitingHall,P)}),[null==(a=b.waitingHall)?void 0:a.hasNew]);if(b.waitingHall&&0!==b.waitingHall.members.size&&b.waitingHall.hasNew){const e=Array.from(b.waitingHall.members.values()),t=R("calls_notification_users_in_waiting_hall_notification",b.waitingHall.totalCount).replace("{names}",(0,l.getParticipantsListLabel)(e,e.slice(0,3),(e=>e.customName||e.shortName||e.name),R,k,b.waitingHall.totalCount));let a=null;if(1===e.length){const t=e[0];a=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.default,{size:"m",onClick:()=>V(t.peerId),mode:"overlay_primary",children:R("calls_waiting_hall_join")}),(0,n.jsx)(s.default,{size:"m",onClick:()=>H(t.peerId),mode:"overlay_secondary",children:R("calls_waiting_hall_forbid")})]})}else a=(0,n.jsx)(s.default,{size:"m",onClick:()=>F(),mode:"overlay_primary",children:R("calls_waiting_show_participants")});return(0,n.jsx)(p.NotificationWithButton,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)(u.Icon12CancelOutline,{className:"NotificationWithButton--close",onClick:G}),(0,n.jsx)("span",{children:t}),(0,n.jsx)("div",{className:"NotificationWithButton--buttons",children:a})]})})}if(D&&w){let e;switch(D){case i.E_ONBOARDING_FEATURES.watchTogether:e=j;break;case i.E_ONBOARDING_FEATURES.reactions:break;case i.E_ONBOARDING_FEATURES.vmoji:e=B}return(0,n.jsx)(S.CallsOnboardingBanner,{featureType:D,onClose:L,onFeatureStart:e})}if(b.featureEndedNotification)return(0,n.jsx)(y.FeatureEndedNotificationContainer,{});if(U&&b.shouldShowWarningDesktopAppNotification&&(0,C.isGroupCallByPeer)(b.peer)&&(null==(N=b.join)?void 0:N.joinLink)){const e=()=>{var e,t,a,n;if(null==(e=b.join)?void 0:e.joinLink)return(0,h.openDesktopDeepLink)((0,g.generateJoinCallsDeepLink)({joinLink:null==(t=b.join)?void 0:t.joinLink,vkJoinLink:null==(a=b.join)?void 0:a.vkJoinLink,userId:null==(n=window.vk)?void 0:n.id}))},t=()=>{P({type:i.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION,data:!1}),P({type:i.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})};return(0,n.jsx)(m.WarningDesktopApp,{onClose:t,onClickJoin:e,isSferum:x})}if(M&&b.shouldShowDesktopAppNotification){const e=()=>{P({type:i.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION,data:!1})};return(0,n.jsx)(_.NotificationDesktopApp,{onClose:()=>e(),isSferum:!!b.config.sferum})}return(0,n.jsx)(n.Fragment,{})}},81335:(e,t,a)=>{"use strict";a.d(t,{OnHangupContainer:()=>u});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(726412),l=a(121644),c=a(915961),d=a(22412);const u=()=>{const{getLang:e}=(0,c.useLang)(),{onClose:t}=(0,l.useClosePopup)(),a=(0,i.useSelector)((e=>e.popup)),u=(0,i.useSelector)((e=>{var t;return null==(t=e.lastCallData)?void 0:t.opponentName})),p=(0,i.useSelector)((e=>{var t;return null==(t=e.lastCallData)?void 0:t.isMeEndedCallForAll})),_=(0,r.useTypedDispatch)();let m="",h="",g=e("calls_close"),A=!1;switch(a){case d.POPUP_ON_CALL_HANGUP_BUSY:m=e("calls_user_busy"),h=e("calls_user_busy_description").replace("{username}",u||e("calls_opponent"));break;case d.POPUP_ON_CALL_HANGUP_KILLED:if(p){A=!0;break}m=e("calls_join_error_not_found_conversation"),h=e("calls_admin_ended_call_for_everyone");break;case d.POPUP_ON_CALL_HANGUP_KILLED_WITHOUT_DELETE:if(p){A=!0;break}m=e("calls_meeting_ended_title"),h=e("calls_meeting_ended_desc"),g=e("calls_warning_ok");break;case d.POPUP_ON_CALL_HANGUP_BANNED:m=e("calls_call_is_interrupted"),h=e("calls_you_have_been_banned");break;case d.POPUP_ON_CALL_HANGUP_REMOVED:m=e("calls_call_is_interrupted"),h=e("calls_you_have_been_kicked")}return(0,o.useEffect)((()=>()=>{_({type:d.E_ACTION.CLEAN_LAST_CALL_DATA})}),[]),(0,o.useEffect)((()=>{A&&t()}),[A,t]),A?(0,n.jsx)(n.Fragment,{}):(0,n.jsx)(s.OnHangupModal,{onClose:t,title:m,description:h,btnText:g})}},711501:(e,t,a)=>{"use strict";a.d(t,{ParticipantMenuContainer:()=>p});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(911513),l=a(346880),c=a(447664),d=a(680093),u=a(167810);const p=({SDK:e,participant:t,device:a})=>{const p=(0,i.useSelector)((e=>e)),_=(0,r.useTypedDispatch)(),{navigateToConvo:m,navigateToProfile:h}=(0,u.useNavigationContext)(),{getLang:g}=(0,o.useContext)(l.LangContext),{handleMuteWatchTogetherParticipant:A}=(0,d.useMuteWatchTogetherHandlers)({SDK:e}),C=t&&(0,s.getParticipantActions)({state:p,SDK:e,dispatch:_,participant:t,getLang:g,navigateToConvo:m,navigateToProfile:h,device:a,onWatchTogetherMute:A});return(null==C?void 0:C.length)?(0,n.jsx)(c.ParticipantMenu,{position:"b",align:"right",trigger:"hover",marginTop:-8,marginLeft:1,actions:C}):(0,n.jsx)(n.Fragment,{})}},883828:(e,t,a)=>{"use strict";a.d(t,{ParticipantStatusContainer:()=>c});var n=a(785893),o=a(667294),i=a(533262),r=a(346880),s=a(464380),l=a(607080);const c=({status:e,isMiniApp:t=!1})=>{const{getLang:a}=(0,o.useContext)(r.LangContext);switch(e){case s.ParticipantStatus.WAITING:return(0,n.jsx)(i.default,{children:a("calls_status_waiting")});case s.ParticipantStatus.CONNECTING:case s.ParticipantStatus.RECONNECT:return t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"CallNotification__connecting",children:(0,n.jsx)(l.Icon16Sync,{})},"icon"),(0,n.jsx)("span",{children:a("calls_notification_connecting")},"text")]}):(0,n.jsx)(i.default,{children:a("calls_status_connecting")});case s.ParticipantStatus.ERROR:return a("calls_error");case s.ParticipantStatus.HANGUP:return(0,n.jsx)(i.default,{children:a("calls_status_hangup")});case s.ParticipantStatus.PERMISSIONS:return a("calls_status_no_permissions");case s.ParticipantStatus.CONNECTED:default:return null}}},258068:(e,t,a)=>{"use strict";a.d(t,{RoomChooseContainer:()=>p});var n=a(785893),o=a(247053),i=a(86894),r=a(490287),s=a(558791),l=a(121644),c=a(326732),d=a(22412),u=a(692888);const p=()=>{const{getLang:e}=(0,s.useLangContext)(),{onClose:t}=(0,l.useClosePopup)(),a=(0,c.useSwitchRoomHandler)({onClick:t}),p=(0,r.useTypedSelector)((e=>e.rooms.rooms)),_=(0,r.useTypedSelector)((e=>e.rooms.roomParticipantIds)),m=(0,r.useTypedSelector)((e=>e.popupData)),h=(0,u.useRoomIdsWithDrat)();var g;const A=((null==m?void 0:m.popup)===d.POPUP_ROOM_CHOOSE&&(null!=(g=null==m?void 0:m.mode)?g:d.IPopupRoomChooseMode.ALL))===d.IPopupRoomChooseMode.HELP,C=e(A?"calls_rooms_admin_requests_for_help":"calls_rooms_choose_title"),v=[],f=Object.values(p);for(let t=0;t<f.length;t++){var S;const o=f[t];var E;const r=null!=(E=null==(S=_[o.id])?void 0:S.length)?E:0;!o.active||A&&!h.has(o.id)||(v.push((0,n.jsx)(i.SimpleCell,{hasActive:!1,hasHover:!1,subtitle:`${r} ${e("calls_rooms_members",r)}`,after:(0,n.jsx)(i.Button,{onClick:()=>a(o.id),mode:"secondary",children:e("calls_rooms_return_to_room")}),children:o.name},`room_${o.id}`)),t!==f.length-1&&v.push((0,n.jsx)(i.Separator,{},`sep_room_${o.id}`)))}return(0,n.jsx)(o.RoomChooseModal,{title:C,children:v})}},725446:(e,t,a)=>{"use strict";a.d(t,{RoomControlContainer:()=>y});var n=a(11010),o=a(785893),i=a(667294),r=a(121644),s=a(555082),l=a(490287),c=a(22412),d=a(735166),u=a(850450),p=a(277659),_=a(878198),m=a(850986),h=a(331447),g=a(933607),A=a(396901),C=a(438655),v=a(915961),f=a(893473),S=a(496111),E=a(28228),T=a(205805),I=a(326732);const y=()=>{const e=(0,T.useCallsSDK)(),t=(0,A.useTypedDispatch)(),{getLang:a}=(0,v.useLang)(),{onClose:y}=(0,r.useClosePopup)(),N=(0,l.useTypedSelector)((e=>e.rooms.rooms)),b=(0,l.useTypedSelector)((e=>e.devices)),x=(0,l.useTypedSelector)((e=>e.participants)),[M,O]=(0,i.useState)(null),[P,R]=(0,i.useState)(""),k=(0,E.useIsRoomsActivated)(),w=(0,g.useDialogController)(),D=(0,g.useDialogController)(),L=function(e){const t=(0,T.useCallsSDK)(),[a,n]=(0,i.useState)(""),o=(0,g.useDialogController)({handleAfterClose:()=>n("")});(0,i.useEffect)((()=>{e&&o.isOpened&&o.handleCloseDialog()}),[o.isOpened,e]);const r=(0,f.useRoomsNames)().has(a),s=e=>{n(e)},l=e=>{t.updateRooms([{name:e}]),o.handleCloseDialog()};return{roomName:a,disableSubmit:!a.trim()||r,inputStatus:(0,_.vou)(r,"error"),dialog:o,handleSetCreateRoomName:s,handleRoomCreate:l}}(k),j=function(){const e=(0,T.useCallsSDK)(),t=(0,l.useTypedSelector)((e=>e.rooms.rooms)),[a,n]=(0,i.useState)(""),[o,r]=(0,i.useState)(),s=(0,g.useDialogController)(),c=(0,f.useRoomsNames)(null==o?void 0:o.name).has(a),d=e=>{n(e)},u=t=>{o&&(e.updateRooms([{id:o.id,name:t}]),s.handleCloseDialog())};return(0,i.useEffect)((()=>{(null==o?void 0:o.id)&&!t.hasOwnProperty(o.id)&&s.handleCloseDialog()}),[t,null==o?void 0:o.id]),{roomName:a,disableSubmit:!a.trim()||c,inputStatus:(0,_.vou)(c,"error"),dialog:s,handleSetName:d,handleRoomRename:u,handleSetRenamedRoom:e=>{r(e),n(e.name)}}}(),B=(0,i.useCallback)((()=>{const t=(0,_.objectMap)(N,(e=>e.id));e.removeRooms(t),y()}),[N]),U=(0,i.useCallback)((()=>{const a=(0,_.objectMap)(N,(e=>e.id));e.removeRooms(a),D.handleCloseDialog(),t({type:c.E_ACTION.TOGGLE_POPUP,data:c.POPUP_ROOM_CONTROL_CREATE})}),[N]),H=(0,i.useCallback)((e=>{j.handleSetRenamedRoom(e),j.dialog.handleOpenDialog()}),[]),F=(0,i.useCallback)((0,n._)((function*(){if((0,_.isEmpty)(N))return;const a=(0,_.objectMap)(N,(e=>e.id));yield e.activateRooms(a,!1),y(),t({type:c.E_ACTION.CALL_NOTIFICATION,notification:{type:c.NotificationType.ROOMS_OPENED}})})),[N]),V=(0,I.useSwitchRoomHandler)({onClick:y}),G=(0,i.useCallback)((e=>{O(M===e?null:e)}),[]),W=(0,i.useCallback)((()=>{if((0,_.isEmpty)(N))return;const t=(0,_.objectFilter)(b,(e=>{const t=x[e.externalId.id];return!(0,S.participantIsAdmin)(t)})),a=t.length,n=(0,_.shuffle)(t.filter((e=>!(0,C.findRelatedRoom)(e.externalId,N))).map((e=>e.externalId))),o=Object.keys(N).length,i=Math.min(c.ROOMS_MAX_PARTICIPANTS_COUNT,Math.floor(a/o)),r=Object.values(N),s=new Map;r.forEach((e=>{const t=e.participantIds.length;if(t>=i)return;const a=n.splice(0,i-t);s.set(e.id,{id:e.id,addParticipantIds:a})}));let l=0;for(;n.length;){const e=r[l],t=n.pop(),a=s.get(e.id);a?a.addParticipantIds.push(t):s.set(e.id,{id:e.id,addParticipantIds:[t]}),l=(l+1)%r.length}s.size&&e.updateRooms([...s.values()])}),[N,b]),$=(0,i.useCallback)(((t,a)=>{(0,C.changeParticipantRoom)(e,N,a,t,k)}),[N]),z=(0,i.useMemo)((()=>{const t=[];return k&&M&&t.push({text:a("calls_room_control_move_to_main_room"),before:(0,o.jsx)(d.Icon20ArrowLeftOutline,{}),handleClick:t=>(0,C.changeParticipantRoom)(e,N,c.ROOM_MAIN_ID,t,k)}),(0,_.isEmpty)(N)||(!k&&M&&t.push({text:a("calls_room_control_move_to_main_room"),before:(0,o.jsx)(d.Icon20ArrowLeftOutline,{}),handleClick:t=>(0,C.changeParticipantRoom)(e,N,c.ROOM_MAIN_ID,t,k)}),M&&t.push({text:a("calls_room_control_action_move_participant"),before:(0,o.jsx)(u.Icon20ArrowUturnRightOutline,{}),disabled:!0}),(0,_.objectForEach)(N,(a=>{M!==a.id&&t.push({text:a.name,handleClick:t=>(0,C.changeParticipantRoom)(e,N,a.id,t,k)})}))),t}),[N,M,k]),Z=(0,i.useMemo)((()=>[{text:a("calls_room_control_action_remove_room"),before:(0,o.jsx)(p.Icon20DeleteOutline,{className:"RoomControlModal__remove_room_icon"}),handleClick:a=>{a===M&&O(null),e.removeRooms([a]),1===Object.values(N).length&&t({type:c.E_ACTION.TOGGLE_POPUP,data:c.POPUP_ROOM_CONTROL_CREATE})}}]),[M,N]);return(0,o.jsxs)(o.Fragment,{children:[D.isOpened&&(0,o.jsx)(m.DialogConfirm,{title:a("calls_room_control_retry_title"),description:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:a("calls_room_control_retry_desc")}}),cancelTitle:a("calls_room_control_retry_cancel"),submitTitle:a("calls_room_control_retry_submit"),onClose:D.handleCloseDialog,onSubmit:U}),w.isOpened&&(0,o.jsx)(m.DialogConfirm,{title:a("calls_room_control_close_title"),description:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:a("calls_room_control_close_desc")}}),cancelTitle:a("calls_room_control_retry_cancel"),submitTitle:a("calls_room_control_cancel_submit"),submitAppearance:"negative",onClose:w.handleCloseDialog,onSubmit:B}),j.dialog.isOpened&&(0,o.jsx)(h.DialogSimpleInput,{title:a("calls_room_control_rename_title"),placeholder:a("calls_room_control_rename_placeholder"),cancelTitle:a("calls_room_control_rename_cancel"),submitTitle:a("calls_room_control_rename_submit"),maxLength:c.ROOMS_NAME_MAX_LENGTH,minLength:1,onChange:j.handleSetName,disableSubmit:j.disableSubmit,inputStatus:j.inputStatus,value:j.roomName,onClose:j.dialog.handleCloseDialog,onSubmit:j.handleRoomRename}),L.dialog.isOpened&&(0,o.jsx)(h.DialogSimpleInput,{title:a("calls_room_control_create_room_title"),placeholder:a("calls_room_control_create_room_placeholder"),cancelTitle:a("calls_room_control_create_room_cancel"),submitTitle:a("calls_room_control_create_room_submit"),onClose:L.dialog.handleCloseDialog,onSubmit:L.handleRoomCreate,value:L.roomName,maxLength:c.ROOMS_NAME_MAX_LENGTH,minLength:1,onChange:L.handleSetCreateRoomName,disableSubmit:L.disableSubmit,inputStatus:L.inputStatus}),(0,o.jsx)(s.RoomControlModal,{isRoomsActivated:k,searchQuery:P,participantsActionsMore:z,roomActionsMore:Z,chosenRoomId:M,rooms:N,devices:b,participants:x,onClose:y,onRoomChoose:G,onRoomCreate:L.dialog.handleOpenDialog,onCloseRooms:w.handleOpenDialog,onTryAgain:D.handleOpenDialog,onRoomRename:H,onChangeParticipantRoom:$,onSwitchRoom:V,onChangeSearchQuery:e=>R(e),onAutoDivide:W,onOpenRooms:F})]})}},940241:(e,t,a)=>{"use strict";a.d(t,{RoomControlCreateContainer:()=>g});var n=a(11010),o=a(785893),i=a(121644),r=a(396901),s=a(22412),l=a(141119),c=a(667294),d=a(490287),u=a(878198),p=a(496111),_=a(915961),m=a(893473),h=a(205805);const g=()=>{const e=(0,h.useCallsSDK)(),{getLang:t}=(0,_.useLang)(),a=(0,r.useTypedDispatch)(),g=(0,d.useTypedSelector)((e=>e.participants)),A=(0,d.useTypedSelector)((e=>e.devices)),[C,v]=(0,c.useState)(s.ROOMS_COUNT),[f,S]=(0,c.useState)(s.ROOMS_ASSIGN_RANDOMLY),E=(0,m.useRoomsNames)(),T=(0,c.useMemo)((()=>{let e=0;return(0,u.objectForEach)(A,(t=>{const a=g[t.externalId.id];(0,p.participantIsAdmin)(a)||e++})),Math.min(s.ROOMS_MAX_PARTICIPANTS_COUNT,Math.ceil(e/C))}),[A,g,C]),I=(0,c.useCallback)((0,n._)((function*(){const n=[];for(let e=0;e<C;e++){const a=`${t("calls_room_control_create_default_room_name")} ${e+1}`;E.has(a)||n.push({name:a,participantCount:f?T:0})}n.length&&(yield e.updateRooms(n,f)),a({type:s.E_ACTION.TOGGLE_POPUP,data:s.POPUP_ROOM_CONTROL})})),[T,f,C,E]),{onClose:y}=(0,i.useClosePopup)();return(0,o.jsx)(l.RoomControlCreateModal,{onClose:y,onSubmit:I,roomCount:C,assignRandomly:f,assignRandomlyByCount:T,onRoomCountChange:e=>{v(Math.max(1,Math.min(e,s.ROOMS_MAX_COUNT)))},onAssignRandomlyChange:()=>S((e=>!e))})}},376855:(e,t,a)=>{"use strict";a.d(t,{RoomHelpRequestedContainer:()=>p});var n=a(785893),o=a(788822),i=a(121644),r=a(490287),s=a(850986),l=a(438655),c=a(915961),d=a(326732),u=a(22412);const p=()=>{const{getLang:e,langReplace:t}=(0,c.useLang)(),a=(0,r.useTypedSelector)((e=>e.rooms.rooms)),p=(0,r.useTypedSelector)((e=>e.participants)),_=(0,r.useTypedSelector)((e=>e.popupData)),m=(null==_?void 0:_.popup)===u.POPUP_ROOM_HELP_REQUESTED&&_.externalId,h=m&&p[m.id],g=m&&(0,l.findRelatedRoom)(m,a),{onClose:A}=(0,i.useClosePopup)(),C=(0,d.useSwitchRoomHandler)({onClick:A});if(g&&h){const a=()=>{C(g.id)};return(0,n.jsx)(s.DialogConfirm,{title:e("calls_room_request_help_title"),description:(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:t(e("calls_room_request_help_desc"),{name:(0,o.escape)(h.name),roomName:(0,o.escape)(g.name)})}}),cancelTitle:e("calls_room_request_help_cancel"),submitTitle:e("calls_room_request_help_submit"),onClose:A,onSubmit:a})}return(0,n.jsx)(n.Fragment,{})}},879303:(e,t,a)=>{"use strict";a.d(t,{RoomLeaveRemoveWatchTogetherModalContainer:()=>u});var n=a(785893),o=a(50533),i=a(82297),r=a(121644),s=a(670401),l=a(490287),c=a(396901),d=a(915961);const u=()=>{const{getLang:e}=(0,d.useLang)(),t=(0,c.useTypedDispatch)(),{onClose:a}=(0,r.useClosePopup)(),u=(0,s.useSwitchRoom)(),p=(0,l.useTypedSelector)((e=>e.rooms.targetSwitchedRoom)),_=()=>{(0,o.batch)((()=>{t({type:c.E_ACTION.SET_TARGET_SWITCHED_ROOM,data:null}),a()}))};return(0,n.jsx)(i.RoomLeaveRemoveWatchTogetherModal,{onClose:_,onSwitchRoom:()=>{u(p).finally(_)},bodyText:Boolean(p)?e("calls_room_leave_remove_watch_together_modal_to_room_body"):e("calls_room_leave_remove_watch_together_modal_body"),acceptText:Boolean(p)?e("calls_room_leave_remove_watch_together_modal_to_room_confirm"):e("calls_room_leave_remove_watch_together_modal_confirm")})}},581519:(e,t,a)=>{"use strict";a.d(t,{RoomRequestHelpContainer:()=>m});var n=a(434788),o=a(785893),i=a(121644),r=a(152575),s=a(877982),l=a(396901),c=a(22412),d=a(732297),u=a(495457),p=a(490287),_=a(205805);const m=()=>{const e=(0,_.useCallsSDK)(),t=(0,l.useTypedDispatch)(),{onClose:a}=(0,i.useClosePopup)(),m=(0,p.useTypedSelector)((e=>e.callData.callId)),h=(0,p.useTypedSelector)((e=>e.localDevice.statusData)),g=(0,p.useTypedSelector)((e=>e.peer));return(0,o.jsx)(s.RoomRequestHelpModal,{onClick:()=>{e.changeParticipantState({drat:c.SdkDratType.REQUESTED}),t({type:l.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,n._)({},h,{drat:{ts:Date.now(),state:!0}})}}),(0,r.roomHelpRequestedNotification)(t),a(),d.callStats.logEvent({call_event_type:c.CallActionEventType.SESSION_ROOMS_ASK_FOR_HELP,session_id:m,peer_id:g,is_group_call:(0,u.isGroupCallByPeer)(g)})}})}},779457:(e,t,a)=>{"use strict";a.d(t,{RoomStatusContainer:()=>f});var n=a(785893),o=a(667294),i=a(22412),r=a(403236),s=a(631501),l=a(387590),c=a(396901),d=a(326732),u=a(796317),p=a(850986),_=a(915961),m=a(933607),h=a(878198),g=a(490287),A=a(205805),C=a(956752);const v=()=>{const e=(0,A.useCallsSDK)(),{getLang:t}=(0,_.useLang)(),a=(0,c.useTypedDispatch)(),v=(0,g.useTypedSelector)((e=>e.rooms.rooms)),{enableRoomControl:f}=(0,o.useContext)(u.ConfigContext),{room:S,roomIdToReturn:E,canChooseRoomAsAdmin:T}=(0,r.useRoomStatus)(),I=(0,d.useSwitchRoomHandler)(),y=(0,C.useDratCount)(),N=(0,m.useDialogController)(),b=f&&T,x=()=>{a({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_ROOM_CHOOSE,popupData:{popup:i.POPUP_ROOM_CHOOSE,mode:b?i.IPopupRoomChooseMode.HELP:i.IPopupRoomChooseMode.ALL}})},M=(0,o.useCallback)((()=>{const t=(0,h.objectMap)(v,(e=>e.id));e.removeRooms(t),N.handleCloseDialog()}),[v]),O=(0,o.useMemo)((()=>{const e=[];return b?(y&&e.push({text:`${t("calls_rooms_admin_requests_for_help")} (${y})`,onClick:x}),e.push({text:t("calls_rooms_admin_control"),onClick:()=>{a({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_ROOM_CONTROL})}}),e.push({separator:!0}),e.push({text:t("calls_rooms_admin_close_rooms"),onClick:N.handleOpenDialog}),e):e}),[b,y,N.handleOpenDialog,t]);return b?(0,n.jsxs)(n.Fragment,{children:[N.isOpened&&(0,n.jsx)(p.DialogConfirm,{title:t("calls_room_control_close_title"),description:(0,n.jsx)("span",{dangerouslySetInnerHTML:{__html:t("calls_room_control_close_desc")}}),cancelTitle:t("calls_room_control_retry_cancel"),submitTitle:t("calls_room_control_cancel_submit"),submitAppearance:"negative",onClose:N.handleCloseDialog,onSubmit:M}),(0,n.jsx)(l.RoomStatusAdmin,{room:S,actions:O})]}):(0,n.jsx)(s.RoomStatus,{room:S,roomIdToEnter:E,canChooseRoomAsAdmin:T,onRoomRequestHelp:()=>{a({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_ROOM_REQUEST_HELP})},onEnterRoom:()=>{T?x():E&&I(E)}})},f=(0,o.memo)(v)},119011:(e,t,a)=>{"use strict";a.d(t,{SendLinkContainer:()=>A});var n=a(785893),o=a(667294),i=a(156515),r=a(202301),s=a(363512),l=a(162532),c=a(151582),d=a(396901),u=a(22412),p=a(275765),_=a(121644),m=a(915961),h=a(490287),g=a(598593);const A=()=>{const{getLang:e}=(0,m.useLang)(),{handleError:t}=(0,g.usePromiseError)(),a=(0,d.useTypedDispatch)(),[A,v]=(0,o.useState)(!1),f=(0,h.useTypedSelector)((e=>{var t;return null==(t=e.misc)?void 0:t.plannedCalendarEvent})),{conversations:S,fetchSearchFriends:E,loading:T}=function(){const{handleError:e}=(0,g.usePromiseError)(),t=(0,o.useRef)([]),a=(0,o.useRef)([]),[n,i]=(0,o.useState)([]),[r,d]=(0,o.useState)([]),[u,p]=(0,o.useState)(!1),_=(0,c.useIsMounted)(),m=(0,o.useRef)(null),A=(0,h.useTypedSelector)((e=>{var t;return+((null==(t=e.externalId)?void 0:t.id)||e.me)})),v=C(),f=C(),S=(0,o.useCallback)((n=>{m.current&&clearTimeout(m.current);const o=f.getId();if(!n||n.length<=2)return d(t.current),void i(a.current);const r=v.getId();m.current=setTimeout((()=>{p(!0),Promise.allSettled([(0,l.messagesSearch)({q:n}),(0,l.friendsSearch)(A,n,20)]).then((([e,n])=>{if(_()&&o===f.prevId.current){if("fulfilled"===e.status){const t=e.value;t.count&&t.conversations?i((0,s.mapMessageConversation)(t.conversations)):i(a.current)}if("fulfilled"===n.status){const e=n.value;e.count?d((0,s.mapUserProfiles)(e.items)):d(t.current)}}})).catch(e).finally((()=>{_()&&r===v.prevId.current&&p(!1)}))}),300)}),[]);(0,o.useEffect)((()=>{p(!0),(0,l.messagesGetConversations)().then((e=>{if(!_())return;const t=(0,s.mapConversations)(e.items,e.profiles);a.current=t,i(t)})).catch(e).finally((()=>{_()&&p(!1)}))}),[]);const E=(0,o.useMemo)((()=>[...r,...n]),[n,r]);return{conversations:E,loading:u,fetchSearchFriends:S}}(),{getId:I}=C(),{onClosePopupCalendar:y}=(0,_.useClosePopup)(),N=(0,h.useTypedSelector)((e=>{var t;return e.participants[(null==(t=e.externalId)?void 0:t.id)||e.me]})),b=(0,p.useCalendarEventDetails)({meParticipant:N}),x=(0,c.useIsMounted)(),M=(0,o.useCallback)((e=>{if(e)return v(!0),e.destination===r.EMessageDestination.IM?Promise.allSettled(e.ids.map((t=>(0,l.messagesSend)({peer_id:+t,message:e.text,random_id:I()})))).then(y).catch(t).finally((()=>{x()&&v(!1)})):void 0}),[]),O=(0,o.useCallback)((()=>{a({type:d.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:u.POPUP_SHARE_PLANNED_CALL})}),[a]);return(0,n.jsx)(i.ModalSendMessage,{onClose:O,onSubmit:M,optionsIM:S,title:e("calls_send_call_link_title"),submitDisabled:A,initialText:b.getDescription(f),onChangeInputIM:E,loading:T})};function C(){const e=(0,o.useRef)(0);e.current||(e.current=Date.now());return{getId:(0,o.useCallback)((()=>(e.current=Date.now(),e.current)),[]),prevId:e}}},738603:(e,t,a)=>{"use strict";a.d(t,{SettingsContainer:()=>h});var n=a(11010),o=a(785893),i=a(667294),r=a(659397),s=a(396901),l=a(877967),c=a(227345),d=a(22412),u=a(915961),p=a(490287),_=a(464380),m=a(205805);function h(){const e=(0,m.useCallsSDK)(),{getLang:t}=(0,u.useLang)(),a=(0,p.useTypedSelector)((e=>e)),h=(0,s.useTypedDispatch)(),{fullHD:g}=a.config,A=(0,i.useMemo)((()=>[{label:t("calls_noise_neural"),value:d.NoiseCancellationTypes.NEURAL,data:{denoise:!0,denoiseAnn:!0}},{label:t("calls_noise_simple"),value:d.NoiseCancellationTypes.SIMPLE,data:{denoise:!0,denoiseAnn:!1}},{label:t("calls_noise_none"),value:d.NoiseCancellationTypes.NONE,data:{denoise:!1,denoiseAnn:!1}}]),[t]),C=(0,i.useMemo)((()=>{const e=[{label:t("calls_video_resolution_sd"),value:d.VideoResolutionTypes.SD},{label:t("calls_video_resolution_hd"),value:d.VideoResolutionTypes.HD}];return g&&e.push({label:t("calls_video_resolution_fhd"),value:d.VideoResolutionTypes.FHD}),e}),[t,g]),v=e.browser.getCameras(),f=e.browser.getMicrophones(),S=e.browser.hasCamera()&&e.browser.hasCameraPermission(),E=e.browser.hasMicrophone()&&e.browser.hasMicrophonePermission(),T=e.browser.getSavedCamera(),I=e.browser.getSavedMicrophone(),y=S&&(T&&T.deviceId||v[0].deviceId),N=E&&(I&&I.deviceId||f[0].deviceId),[b,x]=(0,i.useState)(!1===y?void 0:y),[M,O]=(0,i.useState)(!1===N?void 0:N),[P,R]=(0,i.useState)(a.noiseCancellation),k=r.localStorage.getItem(d.VIDEO_RESOLUTION_STORAGE_KEY),[w,D]=(0,i.useState)(k===d.VideoResolutionTypes.FHD?d.VideoResolutionTypes.FHD:k===d.VideoResolutionTypes.HD?d.VideoResolutionTypes.HD:d.VideoResolutionTypes.SD),L=()=>h({type:d.E_ACTION.TOGGLE_POPUP}),j=(0,i.useRef)(!1),B=(0,n._)((function*(){if(!j.current){j.current=!0;try{if(!b||T&&T.deviceId===b||((0,_.debugMessage)(_.DebugMessageType.LOG,{message:"changing cam id",from:null==T?void 0:T.deviceId,to:b}),yield e.changeDevice("videoinput",b)),!M||I&&I.deviceId===M||((0,_.debugMessage)(_.DebugMessageType.LOG,{message:"changing mic id",from:null==I?void 0:I.deviceId,to:M}),yield e.changeDevice("audioinput",M)),a.noiseCancellation!==P){var t;const a=(null==(t=A.find((e=>e.value===P)))?void 0:t.data)||{denoise:!0,denoiseAnn:!0};(0,_.debugMessage)(_.DebugMessageType.LOG,{message:"changing mediaModifiers",to:a}),yield e.setMediaModifiers(a),h({type:d.E_ACTION.SET_NOISE_CANCELLATION,data:P})}if(a.localVideoResolution!==w){const t=d.VideoWidth[w],n=d.VideoHeight[w];(0,_.debugMessage)(_.DebugMessageType.LOG,{message:"changing video resolution",from:a.localVideoResolution,to:w,w:t,h:n}),yield e.setLocalResolution({video:{width:t,height:n},effect:{width:t,height:n}}),r.localStorage.setItem(d.VIDEO_RESOLUTION_STORAGE_KEY,w),h({type:d.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION,data:w})}}catch(e){(0,_.debugMessage)(_.DebugMessageType.ERROR,{message:"Saving video settings failed",error:e})}finally{L()}}}));return(0,o.jsx)(c.CallSettingsModal,{onClose:L,onSubmit:B,children:(0,o.jsx)(l.CallSettings,{mics:f,cameras:v,noiseCancellationOptions:A,videoResolutionOptions:C,currentCamId:b,currentMicId:M,currentNoiseCancellation:P,currentVideoResolution:w,isCamAvailable:S,isMicAvailable:E,onCameraChange:x,onMicChange:O,onNoiseCancellationChange:e=>R(e),onVideoResolutionChange:e=>D(e)})})}},935005:(e,t,a)=>{"use strict";a.d(t,{StartCallContainer:()=>T});var n=a(785893),o=a(667294),i=a(659397),r=a(22412),s=a(998385),l=a(971276),c=a(807083),d=a(396901),u=a(899426),p=a(212879),_=a(867069),m=a(86488),h=a(490287),g=a(465768),A=a(274706),C=a(94176),v=a(516186),f=a(796317),S=a(723062),E=a(869048);function T(){var e,t,a;const T=(0,d.useTypedDispatch)(),{enableSkipJoinScreenFeature:I,enableSferumNewLinks:y,sferum:N}=(0,o.useContext)(f.ConfigContext),b=(0,h.useTypedSelector)((e=>({join:e.join,peer:e.peer,entryPoint:e.entryPoint,isHideCheckbox:!!e.callData.isDisableStartCallModalCheckbox,isLoaderVisible:e.isLoaderVisible}))),x=b.isHideCheckbox||!I,M=!(null==(e=b.join)?void 0:e.joinLink),[O,P]=(0,o.useState)((()=>null!==i.localStorage.getItem(r.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED))),R=(0,o.useRef)((0,u.getPlatformUrl)(N,y)),k=e=>{T({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:e})},w=()=>{var e,t,a,n;return(null==(e=b.join)?void 0:e.joinLink)?(0,s.openDesktopDeepLink)((0,l.generateJoinCallsDeepLink)({joinLink:null==(t=b.join)?void 0:t.joinLink,userId:null==(a=window.vk)?void 0:a.id})):(0,s.openDesktopDeepLink)((0,l.generateStartCallsDeepLink)({peerId:b.peer,userId:null==(n=window.vk)?void 0:n.id}))};(0,o.useEffect)((()=>{w().catch(g.handlePromiseError).finally((()=>k(!1)))}),[O]);const D=()=>{T({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.READY})},L=()=>{var e;const t=b.peer;if(!window.Calls)return;if(null==(e=b.join)?void 0:e.joinLink){var a,n;const e=null!=(n=b.entryPoint)?n:r.CallStatSource.CONVO_JOIN_SNIPPET;return void window.Calls.joinCallByLink(null==(a=b.join)?void 0:a.joinLink,void 0,!1,e)}var o;const i=null!=(o=b.entryPoint)?o:r.CallStatSource.CONVO_LIST;if(!t)return void window.Calls.startCall(!1,i);S.Ranges.isChatOrChannelPeer(t)?window.Calls.startGroupCall(t,void 0,null,!1,i):window.Calls.call(t,!1,void 0,i)},j=(0,v.useSkipJoinCallPrompt)(),B=b.isLoaderVisible?m.EAppContent.Loading:O?m.EAppContent.Open:m.EAppContent.Download;return(0,n.jsx)(E.AppRootProvider,{children:(0,n.jsxs)(c.CallModal,{onClose:D,onBackdropClick:D,className:"StartCallModalModalBox",children:[B===m.EAppContent.Download&&(0,n.jsx)(p.AppDownload,{onClose:D,isSkipJoinPage:j.on,onSkipJoinPage:j.toggle,isStartNewCall:M,onJoinCall:L,onDownloadApp:(e=(null==(t=R.current)?void 0:t.url),n=(null==(a=R.current)?void 0:a.filename))=>{(0,i.isUndefined)(e)||(0,i.isUndefined)(n)||(!function(){let e;A.Platform.OS===A.OS.WINDOWS?e=C.EOS.Windows:A.Platform.OS===A.OS.MAC?e=C.EOS.Mac:A.Platform.OS===A.OS.LINUX&&(e=C.EOS.Linux);C.mailRuCounter.push(C.EMailRuGoals.DownloadAppVkCommon,{os:e})}(),(0,u.setDownloadedFlag)(),(0,u.download)(e,n),k(!0),setTimeout((()=>{P(!0),k(!1)}),3e3))},isHideCheckbox:x}),B===m.EAppContent.Open&&(0,n.jsx)(_.AppOpen,{onClose:D,isSkipJoinPage:j.on,onSkipJoinPage:j.toggle,onJoinCall:L,onOpenApp:w,isStartNewCall:M,isHideCheckbox:x})]})})}},879965:(e,t,a)=>{"use strict";a.d(t,{TransferAdminRightsContainer:()=>x});var n=a(785893),o=a(667294),i=a(490287),r=a(915961),s=a(22412),l=a(212169),c=a(803800),d=a(732297),u=a(495457),p=a(496111),_=a(172927),m=a(464380),h=a(396901),g=a(878198),A=a(890713),C=a(162532),v=a(953063),f=a(455319),S=a(752540),E=a(151582),T=a(870179),I=a(465768),y=a(428009),N=a(776047),b=a(205805);const x=()=>{const e=(0,b.useCallsSDK)(),t=(0,h.useTypedDispatch)(),a=(0,i.useTypedSelector)((e=>e)),{getLang:x}=(0,r.useLang)(),M=function(e){const t=(0,v.useFetchData)({cb:C.callsGetParticipants,initialLoading:!0}),a=(0,E.useIsMounted)(),n=(0,A.isUseParticipantListChunk)(e),i=e.callData.callId,r=30,s=(0,o.useRef)(!1),l=(0,S.useRef)((()=>new Map)),c=(0,o.useRef)(l.current.size),d=(0,o.useRef)(!1),u=(0,o.useRef)(0),[_,h]=(0,o.useState)(!0),[T,I]=(0,o.useState)([]),[b,x]=(0,o.useState)(T.length),M=!s.current&&d.current,O=(0,o.useCallback)((()=>{s.current=!1,I([...l.current.values()]),x(c.current)}),[]),P=()=>{s.current||O()},R=(0,o.useCallback)((e=>{e&&(s.current=!0,I(e),x(e.length))}),[]),k=(0,o.useCallback)((()=>{u.current+=r,w(u.current)}),[]);function w(o){i&&n&&t.fetchData({filter:"authorized",call_id:i,count:r,offset:o}).then((({count:t,profiles:n=[],groups:i=[]})=>{if(!a())return;const r=(t,a)=>{for(const n of t){if((0,g.hasIn)(n.id,e.me,-e.groupId))continue;const t=l.current.get(n.id)||a(n);l.current.set(t.peerId,t)}};r(n,f.normalizeUser),r(i,f.normalizeGroup),c.current=Math.max(0,t-1),d.current=t>o+(n.length+i.length),P()})).catch((e=>{(0,m.debugMessage)(m.DebugMessageType.ERROR,e)})).finally((()=>{a()&&h(!1)}))}return(0,o.useEffect)((()=>{w(u.current)}),[]),(0,o.useEffect)((()=>{const t=e=>Number.parseInt(e.id),a=([e])=>{l.current.delete(t(e)),c.current=Math.max(0,c.current-1),d.current=c.current+1>Math.max(0,u.current)+r,l.current.size+1-r<u.current&&(u.current=Math.max(-30,u.current-r)),P()},n=([a,n])=>{if(s.current||n!==m.ParticipantStatus.CONNECTED)return;let o=c.current;for(const n of a)(0,p.isParticipantAnonym)(n)||(0,g.hasIn)(t(n),e.me,-e.groupId)||l.current.has(t(n))||(o+=1);o>c.current&&(c.current=o,d.current=!0,o+1<u.current+r&&(u.current=Math.max(-30,u.current-r)),P())};return y.eventBus.on(N.EEventType.onRemoteRemoved,a),y.eventBus.on(N.EEventType.onRemoteStatus,n),()=>{y.eventBus.off(N.EEventType.onRemoteRemoved,a),y.eventBus.off(N.EEventType.onRemoteStatus,n)}}),[]),{enabled:n,loading:t.loading,loadingList:_,error:t.error,participants:T,setSearchResult:R,resetParticipants:O,isNextPage:M,getNextPage:k,participantsCount:b}}(a),O=function(e){const t=e.callData.callId,[a,n]=(0,o.useState)(!1),i=(0,E.useIsMounted)(),r=(0,o.useRef)(null),s=()=>{i()&&n(!1)},l=(0,o.useCallback)((a=>{if(r.current&&r.current.abort(),!t)return(0,m.debugMessage)(m.DebugMessageType.ERROR,{text:"No callId provided"}),Promise.reject();const o=new AbortController;return r.current=o,n(!0),(0,C.searchCallParticipants)(t,{search:a},{signal:o.signal}).then((t=>{const a=[],n=(t,n)=>{for(const o of t)(0,g.hasIn)(o.id,e.me,-e.groupId)||a.push(n(o))};return n(t.profiles||[],f.normalizeUser),n(t.groups||[],f.normalizeGroup),s(),a})).catch((e=>{var t,a;if("AbortError"!==(null==e||null==(t=e.error)?void 0:t.name)&&20!==(null==e||null==(a=e.error)?void 0:a.code))throw(0,m.debugMessage)(m.DebugMessageType.ERROR,e),s(),e}))}),[t]),c=(0,o.useCallback)((()=>{r.current&&r.current.abort(),s()}),[]);return(0,o.useEffect)((()=>()=>{var e;return null==(e=r.current)?void 0:e.abort()}),[]),{loading:a,fetchParticipants:l,abortCurrentSearch:c}}(a),P=(0,T.useTimeout)(),[R,k]=(0,o.useState)((()=>{if(M.enabled)return[];return(0,g.objectFilter)(a.participants,(e=>e.peerId!==a.me&&(!(0,p.isParticipantAnonym)(e.peerId)&&(0,p.someDeviceByParticipant)(e,(({status:e})=>e===m.ParticipantStatus.CONNECTED)))))})),[w,D]=(0,o.useState)(null),L=(0,o.useCallback)((e=>e.name),[]),j=(0,o.useCallback)((e=>e.peerId),[]),B=(0,l.useIndexer)(R,L,j),U=(0,o.useMemo)((()=>(0,p.getActiveParticipantsCount)(a)),[a.participants]),H=()=>d.callStats.logEvent({call_event_type:s.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:a.callData.callId,peer_id:a.peer,is_group_call:(0,u.isGroupCallByPeer)(a.peer),reason:"none",group_call_users_count:U}),F=(0,o.useMemo)((()=>(0,p.isCreator)(a.localDevice)),[a.localDevice]),V=(0,o.useCallback)((e=>{M.enabled&&e.length>2?P.add((()=>{O.fetchParticipants(e).then(M.setSearchResult).catch(M.resetParticipants)}),200):M.enabled?(P.clear(),O.abortCurrentSearch(),M.resetParticipants()):k(e?B.search(e):B.list),D(null)}),[a]),G=()=>{t({type:s.E_ACTION.TOGGLE_POPUP})},W=()=>{t({type:s.E_ACTION.TOGGLE_POPUP}),H(),e.hangup().catch(I.handlePromiseError)},$=(0,o.useCallback)((e=>{D(null===e?null:e.peerId)}),[]);return(0,o.useEffect)((()=>{const e=M.enabled?M.participants:R;w&&!e.find((e=>e.peerId===w))&&D(null)}),[w,M.enabled,M.participants]),(0,n.jsx)(c.TransferAdminRightsModal,{participants:M.enabled?M.participants:R,participantsCount:M.enabled?M.participantsCount:R.length,onClose:G,onSelect:$,selected:w,onCallForceFinish:()=>{t({type:s.E_ACTION.TOGGLE_POPUP}),H(),e.hangup(),(0,_.onForceCallFinish)(e,a,t,x)},onRightsTransfer:()=>{if(null===w)return void W();let t=(0,p.getParticipantExternalId)(a.participants[w]);M.enabled&&!t&&(t=(0,p.getDefaultExternalId)(w.toString())),t&&(e.grantRoles(t,[m.UserRole.ADMIN],!1).then(W).catch(I.handlePromiseError),G())},onSearch:V,isCreator:F,loading:(0,g.vou)(M.enabled,M.loading),loadingList:(0,g.vou)(M.enabled,M.loadingList||O.loading),isNextPage:(0,g.vou)(M.enabled,M.isNextPage),getNextPage:(0,g.vou)(M.enabled,M.getNextPage)})}},678512:(e,t,a)=>{"use strict";a.d(t,{TranslationContainer:()=>h});var n=a(785893),o=a(667294),i=a(606469),r=a(22412),s=a(396901),l=a(50533),c=a(589897),d=a(645329),u=a(368754),p=a(346880),_=a(800582),m=a(8101);const h=({isRecord:e})=>{var t;const a=(0,l.useSelector)((e=>e)),h=(0,s.useTypedDispatch)(),{getLang:g}=(0,o.useContext)(p.LangContext),A=(0,o.useCallback)((()=>{h({type:r.E_ACTION.TOGGLE_POPUP})}),[]),C=(0,m.canStopTranslation)(a),v=(0,o.useCallback)((()=>{h({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_TRANSLATION_STOP})}),[]),f=(0,o.useCallback)((t=>{var a,n;if(null==t?void 0:t.upcomingStreamParams){const{startTime:a,ovId:n}=t.upcomingStreamParams;if(a&&a>Date.now()/1e3+4)return(0,_.startUpcomingStream)(n,e).finally(A)}const o={isOn:!1,startStreamParams:t,isRecord:e,name:null==(a=t.streamParams)?void 0:a.name};return e&&(null==(n=o.startStreamParams)?void 0:n.streamParams)&&(o.startStreamParams.streamParams.is_call_record=1),h({type:r.E_ACTION.SET_TRANSLATION,data:o}),h({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_TRANSLATION_START_COUNTDOWN}),Promise.resolve()}),[e]),S=(0,o.useCallback)((()=>{h({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_TRANSLATION_SHARE})}),[]);return(null==(t=a.translation)?void 0:t.isOn)?(0,n.jsx)(d.CallManagementModal,{title:g("calls_translation_menu_title"),actionButtons:C?[(0,n.jsx)(c.default,{size:"m",onClick:v,mode:"negative",children:g("calls_translation_menu_stop")},"stop")]:[],onCloseModal:A,children:(0,n.jsx)(u.CallManagementMenu,{isLinkBlockShown:!0,linkBlockTitle:g("calls_translation_menu_link"),onLinkBlockClick:S,callUrlLink:a.translation.link})}):(0,n.jsx)(i.TranslationCreateForm,{onSubmit:f,onClose:A,isRecord:e})}},728097:(e,t,a)=>{"use strict";a.d(t,{TranslationShareContainer:()=>u});var n=a(785893),o=a(667294),i=a(50533),r=a(22412),s=a(396901),l=a(346880),c=a(645329),d=a(930809);const u=({onBack:e,link:t,linkExtractor:a})=>{const u=(0,s.useTypedDispatch)(),{getLang:p}=(0,o.useContext)(l.LangContext),_=(0,i.useSelector)((e=>e.translation)),m=(0,o.useCallback)((()=>{u({type:r.E_ACTION.TOGGLE_POPUP})}),[]);var h;return(0,n.jsx)(c.CallManagementModal,{title:p("calls_translation_link"),onCloseModal:m,isWithBackButton:!!e,onBackClick:e,children:(0,n.jsx)(d.TranslationLink,{link:null!=(h=null==a?void 0:a(_))?h:t})})}},317545:(e,t,a)=>{"use strict";a.d(t,{TranslationStartCountdownContainer:()=>_});var n=a(785893),o=a(667294),i=a(22412),r=a(396901),s=a(490287),l=a(329130),c=a(431837),d=a(800582),u=a(162532),p=a(465768);function _(){const e=(0,r.useTypedDispatch)(),t=(0,s.useTypedSelector)((e=>e)),[a,_]=(0,o.useState)(3),m=(0,s.useTypedSelector)((e=>e.translation.isRecord)),h=(0,o.useCallback)((()=>{e({type:i.E_ACTION.TOGGLE_POPUP})}),[]),g=(0,o.useCallback)((()=>{var e;const a=null==(e=t.translation)?void 0:e.startTime,n=t.rooms.roomId;a&&a>=Date.now()&&(0,u.stopVideoStream)(n).catch(p.handlePromiseError),h()}),[]);return(0,o.useEffect)((()=>{const e=setInterval((()=>_(a-1)),c.SECOND_JS);return()=>clearInterval(e)}),[a]),(0,o.useEffect)((()=>{if(a<=0){var e;const a=null==(e=t.translation)?void 0:e.startStreamParams;(null==a?void 0:a.streamParams)?(0,d.startCallStream)(a.streamParams,t.rooms.roomId):(null==a?void 0:a.upcomingStreamParams)&&(0,d.startUpcomingStream)(a.upcomingStreamParams.ovId),h()}}),[a]),(0,n.jsx)(l.TranslationStartCountdownModal,{onCloseModal:h,counter:a,onStopTranslation:g,isRecord:m})}},184779:(e,t,a)=>{"use strict";a.d(t,{TranslationStatusContainer:()=>v});var n=a(785893),o=a(667294),i=a(22412),r=a(824436),s=a(490287),l=a(396901),c=a(78279),d=a(659397),u=a(811930),p=a(579431),_=a(346880),m=a(431837),h=a(162532),g=a(8101),A=a(496111),C=a(465768);const v=()=>{const{getLang:e,langNumeric:t}=(0,o.useContext)(_.LangContext),a=(0,s.useTypedSelector)((e=>e)),c=(0,l.useTypedDispatch)(),[v,I]=(0,o.useState)(null),[y,N]=(0,o.useState)(""),[b,x]=(0,o.useState)(0),[M,O]=(0,o.useState)((()=>T(a.translation.startTime))),[P,R]=(0,o.useState)(E(M)),[k,w]=(0,o.useState)(""),[D,L]=(0,o.useState)(!1),j=(0,o.useMemo)((()=>(0,A.isAdmin)(a.localDevice)||(0,A.isCreator)(a.localDevice)),[a.localDevice]),B=function(e){const[t,a]=(0,o.useState)(),n=(0,s.useTypedSelector)((t=>e.ownerId?t.participants[e.ownerId]:void 0));(0,o.useEffect)((()=>{if(!e.isRecord||!e.ownerId||!e.videoId||n)return;const t=new AbortController,o=`${e.ownerId}_${e.videoId}`;return(0,h.videoGet)({videos:o},{signal:t.signal}).then(a).catch(C.handlePromiseError),()=>{t.abort()}}),[e.ownerId,e.videoId,e.isRecord,n]);const i=(0,o.useMemo)((()=>{let e="";if(n)e=n.shortName||n.name||e;else{const a=null==t?void 0:t.items[0].owner_id;if(!(0,d.isUndefined)(a)&&(0,A.isParticipantGroup)(a)&&(null==t?void 0:t.groups)){const n=t.groups.find((e=>e.id===-a));e=(null==n?void 0:n.name)||e}}return e}),[t,n]);return{data:t,recordAuthorDisplayName:i}}({isRecord:a.translation.isRecord,ownerId:a.translation.ownerId,videoId:a.translation.videoId}),U=(0,A.isParticipantGroup)(a.groupId)?a.groupId===a.translation.ownerId:a.me===a.translation.ownerId||a.me===Number(null==(H=a.translation.host)?void 0:H.id);var H;const F=(0,o.useCallback)((()=>{c({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_TRANSLATION_STOP})}),[]),V=(0,o.useMemo)((()=>(0,g.canStopTranslation)(a)),[a.translation,a.localDevice]);(0,o.useEffect)((()=>{var e;if(null==(e=a.translation.host)?void 0:e.id){var t;const e=a.participants[null==(t=a.translation.host)?void 0:t.id],n=(null==e?void 0:e.shortName)||(null==e?void 0:e.name);n!==v&&I(n)}else v&&I(null)}),[a.translation,a.participants]);const G=(0,o.useMemo)((()=>{const t=[];return V&&(P&&t.push({text:e("calls_info_translation_will_start_soon")}),t.push({before:(0,n.jsx)(u.Icon20ShareOutline,{className:"TranslationStatus__actionsIcon"}),text:e("calls_info_translation_share_menu_item"),handleClick:()=>c({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_TRANSLATION_SHARE})}),t.push({before:(0,n.jsx)(p.Icon20Cancel,{className:"TranslationStatus__actionsIcon"}),text:e("calls_translation_stop_menu_item"),handleClick:F})),t}),[V,P]);return(0,o.useEffect)((()=>{const e=E(M);e&&M>-4&&V&&!D&&(L(!0),c({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_TRANSLATION_START_COUNTDOWN})),R(e)}),[M]),(0,o.useEffect)((()=>{const e=T(a.translation.startTime);O(e);const t=setInterval((()=>O(T(a.translation.startTime))),m.SECOND_JS);return()=>clearInterval(t)}),[a.translation.startTime]),(0,o.useEffect)((()=>{let a="";if(P){const n=Math.abs(M);if(n>m.DAY){const o=Math.floor(n/m.DAY);a=t(o,"calls_translation_upcoming_time_more_day_short",e("calls_translation_upcoming_time_more_day_short",o)).replace("%s",o)}else a=f("-"+S(n))}else a=f(S(M));N(a)}),[M,P]),(0,o.useEffect)((()=>{const{ownerId:e,videoId:t}=a.translation;let n;if(e&&t&&!P){const a=()=>{const a={owner_id:e,video_id:t};(0,h.videoLiveGetSpectators)(a).then((e=>{var t;x(null==(t=e.spectators)?void 0:t.count)})).catch(C.handlePromiseError)};a(),n=setInterval(a,15*m.SECOND_JS)}return()=>clearInterval(n)}),[P,a.translation.ownerId,a.translation.videoId]),(0,o.useEffect)((()=>{if(!V){let t="";t=P?e("calls_info_translation_will_start_soon"):v?e("calls_translation_host_info").replace("{name}",v):e("calls_translation_host_info_unknown"),w(t)}}),[P,v,V]),a.translation.isRecord?U?(0,n.jsx)(r.TranslationStatusRecord,{onStopRecord:F,recordStartTimeMs:a.translation.startTime,isMeAuthor:U,translationTimer:y}):(0,n.jsx)(r.TranslationStatusRecord,{onStopRecord:F,recordStartTimeMs:a.translation.startTime,isCanStopRecord:j,recordAuthorDisplayName:B.recordAuthorDisplayName}):(0,n.jsx)(r.TranslationStatus,{translationTimer:y,viewersCount:b,isLiveIndicatorOff:P,actions:G,tooltipText:k})};function f(e){return(0,n.jsx)(c.CallTimer,{duration:e})}function S(e){return 0===e?"00:00":e<=599?"0"+(0,d.formatDuration)(e):(0,d.formatDuration)(e)}function E(e){return e<0}function T(e){const t=Date.now();return Math.floor((t-e)/1e3)}},763080:(e,t,a)=>{"use strict";a.d(t,{TranslationStopContainer:()=>_});var n=a(785893),o=a(667294),i=a(490287),r=a(396901),s=a(589897),l=a(22412),c=a(346880),d=a(124675),u=a(162532),p=a(465768);const _=()=>{const{dispatch:e,getLang:t,isRecord:a,onClose:_,roomId:m}=function(){const e=(0,r.useTypedDispatch)(),{getLang:t}=(0,o.useContext)(c.LangContext),a=(0,i.useTypedSelector)((e=>e.translation.isRecord)),n=(0,i.useTypedSelector)((e=>e.rooms.roomId)),s=(0,o.useCallback)((()=>{e({type:l.E_ACTION.TOGGLE_POPUP})}),[]);return{dispatch:e,getLang:t,isRecord:a,onClose:s,roomId:n}}();return(0,n.jsx)(d.TranslationStopModal,{onClose:_,actionButtons:[(0,n.jsx)(s.default,{onClick:_,size:"m",mode:"secondary",children:t("calls_cancel")},"cancel"),(0,n.jsx)(s.default,{size:"m",mode:"primary",onClick:()=>{(0,u.stopVideoStream)(m).then((()=>{e({type:l.E_ACTION.TOGGLE_POPUP})})).catch(p.handlePromiseError)},children:t("calls_translation_stop")},"stop")],isRecord:a})}},977708:(e,t,a)=>{"use strict";a.d(t,{UnbanParticipantContainer:()=>m});var n=a(785893),o=a(667294),i=a(50533),r=a(589897),s=a(22412),l=a(396901),c=a(346880),d=a(496111),u=a(455319),p=a(197966),_=a(205805);const m=()=>{var e;const t=(0,_.useCallsSDK)(),a=(0,l.useTypedDispatch)(),{getLang:m,langNumeric:h,langSex:g}=(0,o.useContext)(c.LangContext),A=(0,i.useSelector)((e=>e)),C=(0,d.participantIsAdmin)(A.localDevice),v=null==(e=A.membersUnban)?void 0:e.members,f=(0,o.useCallback)((()=>{a({type:s.E_ACTION.UNBAN_PARTICIPANTS,data:null})}),[]),S=(0,o.useCallback)((()=>{null==v||v.forEach((e=>{t.addParticipant(String(e.id),{unban:!0})})),f()}),[A.membersUnban]);if(!v||0===v.length)return(0,n.jsx)(n.Fragment,{});const E=null==v?void 0:v.length,T=h(E,"calls_unban_participant_text",m("calls_unban_participant_text","raw"));let I="",y=[];if(1===E){const e=v[0];I=g(e.sex,"calls_unban_participant_description_text_one_person",m("calls_unban_participant_description_text_one_person","raw")).replace("{user}",e.name),y.push((0,u.getMemberForUserStack)(e))}else{let e=[v[0].name,v[1].name];y=v.slice(0,2).map((e=>(0,u.getMemberForUserStack)(e)));const t=", ";if(E<=3)3===E&&(e.push(v[2].name),y.push((0,u.getMemberForUserStack)(v[2]))),I=m("calls_unban_participant_description_text_two_persons").replace("{users}",e.join(t));else{const a=E-2;I=h(a,"calls_unban_participant_description_text_more_persons",m("calls_unban_participant_description_text_more_persons","raw")).replace("{users}",e.join(t)).replace("{users_count}",a),y.push({id:a,text:"+"+a})}}const N=C?[(0,n.jsx)(r.default,{size:"m",onClick:f,mode:"secondary",children:m("calls_unban_participant_cancel_button_text")},"cancel"),(0,n.jsx)(r.default,{onClick:S,mode:"primary",size:"m",children:m("calls_unban_participant_ok_button_text")},"stop")]:[(0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:f,children:m("calls_unban_participant_disallowed_button_text")},"cancel")];return(0,n.jsx)(p.UnbanMembersModal,{onClose:f,description:T,subDescription:I,actionButtons:N,avatarsItems:y})}},534447:(e,t,a)=>{"use strict";a.d(t,{UnmuteRequestContainer:()=>g});var n=a(785893),o=a(667294),i=a(50533),r=a(589897),s=a(346880),l=a(564048),c=a(916188),d=a(464380),u=a(396901),p=a(878198),_=a(22412),m=a(205805),h=a(465768);const g=({popup:e})=>{const t=(0,m.useCallsSDK)(),a=(0,u.useTypedDispatch)(),{getLang:g}=(0,o.useContext)(s.LangContext),A=(0,i.useSelector)((e=>e)),C=A.localDevice,v=C.mediaSettings,f=(0,p.hasIn)(e,_.POPUP_UNMUTE_REQUEST,_.POPUP_UNMUTE_VIDEO_REQUEST),S=(0,p.hasIn)(e,_.POPUP_UNMUTE_REQUEST,_.POPUP_UNMUTE_AUDIO_REQUEST),E=()=>{a({type:_.E_ACTION.TOGGLE_POPUP})},T=()=>{const{mediaSettings:e}=C;if(null==e?void 0:e.isAudioEnabled)return;(v.isAudioEnabled?Promise.resolve():(0,c.checkPermissions)(t,[d.MediaOption.AUDIO])).then((()=>{var e;(null==(e=A.notification)?void 0:e.type)===_.NotificationType.SPEAKING_ON_MUTE&&a({type:_.E_ACTION.CALL_NOTIFICATION,notification:null}),t.toggleLocalAudio(!0).catch(h.handlePromiseError)}))},I=()=>{const{mediaSettings:e}=C;if((null==e?void 0:e.isVideoEnabled)||(null==e?void 0:e.isScreenSharingEnabled))return;(!v.isVideoEnabled||v.isScreenSharingEnabled?(0,c.checkPermissions)(t,[d.MediaOption.VIDEO]):Promise.resolve()).then((()=>{t.toggleLocalVideo(!0).catch(console.log)}))},y=()=>{T(),E()},N=()=>{T(),I(),E()},b=()=>{I(),E()},x=(0,o.useMemo)((()=>{let e="",t="";const a=[];return f&&S?(e=g("calls_dialog_unmute_request_audio_and_video_title"),t=g("calls_dialog_unmute_request_audio_and_video_description"),a.push((0,n.jsx)(r.default,{size:"m",onClick:y,mode:"secondary",children:g("calls_dialog_unmute_request_mic_only_action")},"mic"),(0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:N,children:g("calls_dialog_unmute_request_action")},"all"))):S?(e=g("calls_dialog_unmute_request_audio_title"),t=g("calls_dialog_unmute_request_audio_description"),a.push((0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:y,children:g("calls_dialog_unmute_request_mic_action")},"mic"))):f&&(e=g("calls_dialog_unmute_request_video_title"),t=g("calls_dialog_unmute_request_video_description"),a.push((0,n.jsx)(r.default,{size:"m",mode:"primary",onClick:b,children:g("calls_dialog_unmute_request_camera_only_action")},"video"))),{actions:a,title:e,desc:t}}),[f,S,g]);return(0,n.jsx)(l.UnmuteRequestModal,{onClose:E,title:x.title,description:x.desc,actionButtons:x.actions})}},894286:(e,t,a)=>{"use strict";a.d(t,{UploadBackgroundErrorContainer:()=>c});var n=a(785893),o=a(667294),i=a(396901),r=a(764779),s=a(346880),l=a(22412);const c=()=>{const e=(0,i.useTypedDispatch)(),{getLang:t}=(0,o.useContext)(s.LangContext),a=(0,o.useCallback)((()=>{e({type:l.E_ACTION.TOGGLE_POPUP,data:l.POPUP_VIRUTAL_BACKGROUND})}),[]),c=(0,o.useCallback)((()=>{e({type:l.E_ACTION.TOGGLE_POPUP,data:l.POPUP_UPLOAD_BACKGROUND_PHOTO})}),[]);return(0,n.jsx)(r.UploadBackgroundErrorModal,{onClose:a,onSubmit:c,children:t("calls_error_upload_background_image")})}},559081:(e,t,a)=>{"use strict";a.d(t,{UploadBackgroundPhotoContainer:()=>c});var n=a(785893),o=a(667294),i=a(396901),r=a(953303),s=a(328218),l=a(22412);const c=({onAddBackground:e,loading:t})=>{const a=(0,i.useTypedDispatch)(),c=(0,o.useCallback)((()=>{a({type:l.E_ACTION.TOGGLE_POPUP,data:l.POPUP_VIRUTAL_BACKGROUND})}),[]),d=(0,o.useCallback)((t=>{e(t).then(c).catch((()=>{a({type:l.E_ACTION.TOGGLE_POPUP,data:l.POPUP_UPLOAD_BACKGROUND_ERROR})}))}),[c]);return(0,n.jsx)(r.UploadBackgroundPhotoModal,{onClose:c,children:(0,n.jsx)(s.UploadBackgroundPhoto,{loading:t,onSubmit:d})})}},201702:(e,t,a)=>{"use strict";a.d(t,{VirtualBackgroundSettingsContainer:()=>I});var n=a(785893),o=a(667294),i=a(461061),r=a(503089),s=a(436854),l=a(989351),c=a(495048),d=a(748245),u=a(147986),p=a(287126),_=a(22412),m=a(121644),h=a(488140),g=a(662603),A=a(894286),C=a(559081),v=a(266247),f=a(97547),S=a(490287),E=a(205805);const T=()=>{const e=(0,E.useCallsSDK)(),[t,a]=(0,o.useState)(!1),T=(0,S.useTypedSelector)((e=>e.popup)),I=(0,S.useTypedSelector)((e=>e.virtualBackgroundSettings.photos)),y=(0,S.useTypedSelector)((e=>!!e.config.sferum)),{backgroundList:N}=(0,u.useBackgroundsList)({photos:I}),{onClose:b}=(0,m.useClosePopup)(),{userStream:x,isVideoEnabled:M}=(0,h.useCurrentUserStream)(),{chosen:O,setChosen:P,onClick:R,onSuccessPhotoUpload:k}=(0,s.useSettingsItems)({backgroundList:N}),{onCancelSettings:w,loadingUpload:D,onAddBackground:L,onDeleteBackground:j,onSaveSettings:B}=(0,g.useUserBackgrounds)({photos:I,onSuccessPhotoUpload:k,isSferum:y}),{onSettingsChange:U}=(0,l.useBackgroundEffects)({SDK:e});(0,c.useInitialBackgroundEffect)({onSettingsChange:U,userStream:x,backgroundList:N,isVideoEnabled:M});const{onRestoreSettings:H,onApplySettings:F}=(0,d.useSavedSettings)({chosen:O,onSettingsChange:U,settingsOpened:t,setChosen:P,backgroundList:N,isVideoEnabled:M}),{videoOptions:V,onRestoreSettings:G,onSaveSettings:W,onChangeVideoOption:$}=(0,v.useVideoOptions)();(0,o.useEffect)((()=>{f.effectStorage.clearEffectTs()}),[]),(0,o.useEffect)((()=>{T!==_.POPUP_VIRUTAL_BACKGROUND||t||a(!0)}),[T]);const z=(0,o.useCallback)((()=>{B(),b(),a(!1),F(),W()}),[B,b,F,W]),Z=(0,o.useCallback)((()=>{w(),b(),a(!1),H(),G()}),[w,b,H,G]);return(0,n.jsxs)(p.ErrorBoundary,{onError:Z,children:[T===_.POPUP_VIRUTAL_BACKGROUND&&(0,n.jsx)(i.VirtualBackgroundSettingsModal,{onClose:Z,onSubmit:z,onChangeVideoOption:$,videoOptions:V,children:(0,n.jsx)(r.VirtualBackgroundSettings,{chosen:O,backgroundList:N,onDeleteBackground:j,onChooseBackground:R,videoOptions:V,isSferum:y,SDK:e})}),T===_.POPUP_UPLOAD_BACKGROUND_PHOTO&&(0,n.jsx)(C.UploadBackgroundPhotoContainer,{onAddBackground:L,loading:D}),T===_.POPUP_UPLOAD_BACKGROUND_ERROR&&(0,n.jsx)(A.UploadBackgroundErrorContainer,{})]})},I=(0,o.memo)(T)},977615:(e,t,a)=>{"use strict";a.d(t,{VmojiCharacterIdLoadingStatus:()=>n,VmojiSettingsContainer:()=>C});var n,o=a(785893),i=a(667294),r=a(702093),s=a(175708),l=a(287126),c=a(302617),d=a(22412),u=a(121644),p=a(490287),_=a(396901),m=a(659397),h=a(504580),g=a(205805);!function(e){e.LOADING="loading",e.SUCCESS="success",e.FAILED="failed"}(n||(n={}));const A=({bridge:e})=>{const t=(0,g.useCallsSDK)(),a=(0,p.useTypedSelector)((e=>e.popup)),n=(0,_.useTypedDispatch)(),{onClose:A}=(0,u.useClosePopup)(),{sendStatsData:C}=(0,c.useSendStatsData)(),{isCapture:v,participantIdsToUpdateSvg:f}=(0,p.useTypedSelector)((e=>e.vmojiSettings)),{peerId:S,animated_avatar:E}=(0,p.useTypedSelector)((e=>e.participants[e.me])),[T,I]=(0,i.useState)(null),[y,N]=(0,i.useState)("loading"),[b,x]=(0,i.useState)(0),[M,O]=(0,i.useState)(null),[P,R]=(0,i.useState)(null),[k,w]=(0,i.useState)(!1);(0,i.useEffect)((()=>{!(null==E?void 0:E.url)||k||M&&(!P||f.some((e=>e.split(":d")[0]===String(S)))||E.url===P)||(w(!0),h.AnimojiPreviewGenerator.getPreview().then((({image:e,width:t,height:a})=>{const n=document.createElement("canvas");n.width=t,n.height=a,n.style.pointerEvents="none",n.style.visibility="hidden",document.body.appendChild(n);const o=n.getContext("2d");o&&(o.putImageData(e,0,0),O(n.toDataURL()),R(E.url)),n.remove()})).catch((()=>{})).finally((()=>{w(!1)})))}),[E,f]),(0,i.useEffect)((()=>{a===d.POPUP_VMOJI&&x(b+1)}),[a]),(0,i.useEffect)((()=>{var e;null==(e=window.Emoji)||e.getVmojiAvatar().then((e=>{e&&(I(e.character_id),N("success"))})).catch((()=>{N("failed")}))}),[b]);return(0,o.jsx)(l.ErrorBoundary,{onError:A,children:a===d.POPUP_VMOJI&&(0,o.jsx)(r.VmojiSettingsModal,{onClose:A,children:(0,o.jsx)(s.VmojiSettings,{isVmojiCreated:!!(null==E?void 0:E.url),isVmojiCapture:v,vmojiPreviewSrc:M,loadingStatus:y,onToggle:()=>{v?m.localStorage.removeItem(d.VMOJI_CAPTURE_STORAGE_KEY):m.localStorage.setItem(d.VMOJI_CAPTURE_STORAGE_KEY,"true"),t.captureVmoji(!v),n({type:_.E_ACTION.VMOJI_SET_CAPTURE,data:!v});const e=v?c.ECallActionEventType.CALL_VMOJI_STOPPED:c.ECallActionEventType.CALL_VMOJI_STARTED;C(e)},onEdit:()=>{var t;T&&(null==(t=window.Emoji)||t.showVmojiAvatar(S,T),e.collapseCall(),A())},onCreate:()=>{var t;null==(t=window.Emoji)||t.createVmojiAvatar(),e.collapseCall(),A()}})})})},C=(0,i.memo)(A)},760281:(e,t,a)=>{"use strict";a.d(t,{WaitingContainer:()=>r});var n=a(785893),o=a(50533),i=a(617502);function r(){return(0,o.useSelector)((e=>e)).isLoaderVisible?(0,n.jsx)(i.default,{}):null}},285336:(e,t,a)=>{"use strict";a.d(t,{WaitingHallContainer:()=>S});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(22412),l=a(625460),c=a(807083),d=a(916188),u=a(496111),p=a(346880),_=a(796317),m=a(774351),h=a(790743),g=a(464380),A=a(99055),C=a(562090),v=a(205805),f=a(167810);function S(){var e,t,a;const{navigateToConvo:S}=(0,f.useNavigationContext)(),E=(0,v.useCallsSDK)(),T=(0,i.useSelector)((e=>e)),I=(0,r.useTypedDispatch)(),{getLang:y}=(0,o.useContext)(p.LangContext),{enableScreenTrack:N}=(0,o.useContext)(_.ConfigContext),b=T.peer,x=T.localDevice.mediaSettings,M=T.uiMode===s.UIMode.FULLSCREEN,[O,P]=(0,o.useState)(!1),[R,k]=(0,o.useState)(!1),w=e=>I({type:s.E_ACTION.CHANGE_UI_MODE,mode:e}),D=(0,o.useCallback)((()=>{T.uiMode===s.UIMode.FULLSCREEN?((0,m.pause)(.3,null).then((()=>{w(s.UIMode.COLLAPSED)})),w(s.UIMode.DEFAULT)):w(s.UIMode.COLLAPSED)}),[T.uiMode]),L=(0,o.useCallback)((()=>{if(O)return;const e=!x.isAudioEnabled;(e?(0,d.checkPermissions)(E,[g.MediaOption.AUDIO]):Promise.resolve()).then((()=>{var t;P(!0),(null==(t=T.notification)?void 0:t.type)===s.NotificationType.SPEAKING_ON_MUTE&&I({type:s.E_ACTION.CALL_NOTIFICATION,notification:null}),E.toggleLocalAudio(e).finally((()=>{P(!1)}))}))}),[x,O]),j=(0,o.useCallback)((()=>{if(R)return;const e=!x.isVideoEnabled||!!x.isScreenSharingEnabled&&!N;(e?(0,d.checkPermissions)(E,[g.MediaOption.VIDEO]):Promise.resolve()).then((()=>{k(!0),N||x.isScreenSharingEnabled&&E.captureScreen(!1),E.toggleLocalVideo(e).finally((()=>{k(!1)}))}))}),[x,R]),B=(0,o.useCallback)((()=>{D(),S(T.peer)}),[T.peer,T.uiMode]),U=(0,o.useCallback)((()=>{E.hangup()}),[]),H=(0,o.useCallback)((()=>{I({type:s.E_ACTION.CHANGE_UI_MODE,mode:M?s.UIMode.DEFAULT:s.UIMode.FULLSCREEN}),I({type:s.E_ACTION.SET_TOOLTIP,tooltips:null})}),[T.uiMode]),F=(0,o.useCallback)(((e,t)=>{I({type:s.E_ACTION.SET_TOOLTIP,tooltips:{[e]:t}})}),[]),V=(0,o.useCallback)((()=>{I({type:s.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);(0,o.useEffect)((()=>()=>{I({type:s.E_ACTION.SET_TOOLTIP,tooltips:null})}),[]);const G=(0,C.useCallNotifications)(),W=T.hangupType===s.HANGUP_TYPE_REMOVED?y("calls_waiting_hall_removed"):y("calls_waiting_hall_info");return(0,n.jsx)(c.CallModal,{onClose:U,onBackdropClick:D,children:(0,n.jsx)(l.Call,{info:null,isVideoAllowed:!0,isAudioAllowed:!0,isVideoEnabled:!!x.isVideoEnabled,isAudioEnabled:!!x.isAudioEnabled,isFullScreen:M,onToggleAudio:L,onToggleVideo:j,onLeaveCall:U,onFullScreenToggle:H,onTooltipChange:F,onHidePanel:V,onChat:B,isChatControlShown:!!b&&!T.groupId,chatUnreadCount:T.chatUnreadCount,tooltips:T.tooltips,notificationWithButton:null,isWaitingHall:!0,onCollapseCall:D,children:(0,n.jsxs)(n.Fragment,{children:[!!x.isVideoEnabled&&T.externalId&&(0,n.jsx)(h.WaitingHall,{name:"",letter:null==(e=T.participants[T.me].name)?void 0:e.slice(0,1),hasAudio:!!(null==(t=T.localDevice.mediaSettings)?void 0:t.isAudioEnabled),externalId:T.externalId,streamData:(0,u.getStream)(T.localDevice),hasVideo:(0,u.isParticipantWithVideo)(T.localDevice),wasConnected:!!T.localDevice.wasConnected,isVmoji:!!(null==(a=T.localDevice.mediaSettings)?void 0:a.isAnimojiEnabled)}),(0,n.jsx)(A.WaitingHallInfo,{text:W}),G]})})})}},879455:(e,t,a)=>{"use strict";a.d(t,{WaitingHallListContainer:()=>g});var n=a(785893),o=a(667294),i=a(50533),r=a(396901),s=a(22412),l=a(346880),c=a(709389),d=a(245387),u=a(182330),p=a(645329),_=a(222574),m=a(212169),h=a(661307);const g=({isModal:e,onMore:t,isWithBackButton:a,onBackClick:g})=>{var C,v,f,S,E;const T=a?g:()=>{},I=(0,i.useSelector)((e=>e)),y=(0,r.useTypedDispatch)(),{getLang:N}=(0,o.useContext)(l.LangContext),[b,x]=(0,o.useState)(A(I,e)),[M,O]=(0,o.useState)(""),P=I.waitingHall?Array.from(null==(C=I.waitingHall)?void 0:C.members.values()):[],R=(0,o.useCallback)((e=>e.name),[]),k=(0,o.useCallback)((e=>e.peerId),[]),w=(0,m.useIndexer)(e?P:[],R,k),D=(0,o.useCallback)((e=>{O(e.target.value)}),[]);let L=e?P:P.slice(0,5);M&&(L=w.search(M)),(0,o.useEffect)((()=>{x(A(I,e))}),[null==(v=I.waitingHall)?void 0:v.totalCount]);const j=(0,o.useCallback)((e=>{var t;const a=null==(t=I.waitingHall)?void 0:t.members.get(e);a&&y({type:s.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:s.KickParticipantType.WAITING_HALL,participant:a}})}),[null==(f=I.waitingHall)?void 0:f.members,I.participants]),B=(0,o.useCallback)((e=>{I.waitingHall&&(0,u.promoteUserAndRemoveFromWaitingHall)(e,I.waitingHall,y)}),[null==(S=I.waitingHall)?void 0:S.members]),U=(0,o.useCallback)((()=>{t&&t()}),[I.waitingHall]),H=()=>{y({type:s.E_ACTION.GROUP_CALL_SETUP,open:!1,preselectedIds:null}),y({type:s.E_ACTION.MANAGEMENT,isOpen:!1})},F=(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.WaitingHallList,{members:L,totalCount:null==(E=I.waitingHall)?void 0:E.totalCount,onPromote:B,onForbid:j}),b&&(0,n.jsx)(d.ListMore,{onClick:U,children:N("calls_waiting_hall_more_text")})]});return e?(0,n.jsx)(p.CallManagementModal,{title:N("calls_waiting_hall_title"),onCloseModal:H,isWithBackButton:a,onBackClick:T,children:(0,n.jsxs)("div",{className:"CallParticipantList CallParticipantList--waiting-hall",children:[P.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_.BlockSearchInput,{value:M,placeholder:N("calls_search_participants_placeholder"),onChange:D,onInput:D,onPaste:D,className:"CallParticipantList__input"}),F,M&&0===L.length&&(0,n.jsx)(h.default,{children:N("calls_participants_not_found")})]}),0===P.length&&(0,n.jsx)(h.default,{children:N("calls_waiting_hall_not_users")})]})}):F};function A(e,t){if(t)return!1;const{waitingHall:a}=e;return!!a&&a.totalCount>5}},495195:(e,t,a)=>{"use strict";a.d(t,{DESKTOP_CALLS_DOWNLOAD:()=>o,DESKTOP_CALLS_FILENAME:()=>i,SFERUM_APP_URL:()=>p,SFERUM_DESKTOP_CALLS_FILENAME:()=>_});var n=a(274706);const o={[n.OS.WINDOWS]:"https://vkcalls-native-ac.vk-apps.com/latest/vk-calls.exe",[n.OS.MAC]:"https://vkcalls-native-ac.vk-apps.com/latest/vk-calls.dmg",[n.OS.LINUX]:{deb:{[n.ARCH.X64]:"https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-amd64.deb",[n.ARCH.X86]:"https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-i386.deb"},rpm:{[n.ARCH.X64]:"https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-x86_64.rpm",[n.ARCH.X86]:"https://vkcalls-native-ac.vk-apps.com/latest/vk-calls-i686.rpm"}}},i={[n.OS.WINDOWS]:"vk-calls.exe",[n.OS.MAC]:"vk-calls.dmg",[n.OS.LINUX]:{deb:{[n.ARCH.X64]:"vk-calls-amd64.deb"}}},r="https://st.mycdn.me/static/sferum/latest/sferum.exe",s={[n.OS.WINDOWS]:r,[n.OS.MAC]:"https://st.mycdn.me/static/sferum/latest/sferum.pkg",[n.OS.LINUX]:{deb:{[n.ARCH.X64]:"https://st.mycdn.me/static/sferum/latest/sferum-amd64.deb",[n.ARCH.X86]:"https://st.mycdn.me/static/sferum/latest/sferum-i386.deb"},rpm:{[n.ARCH.X64]:"https://st.mycdn.me/static/sferum/latest/sferum-x86_64.rpm",[n.ARCH.X86]:"https://st.mycdn.me/static/sferum/latest/sferum-i686.rpm"}},[n.OS.UNKNOWN]:r},l={[n.OS.WINDOWS]:"sferum.exe",[n.OS.MAC]:"sferum.pkg",[n.OS.LINUX]:{deb:{[n.ARCH.X64]:"sferum-amd64.deb",[n.ARCH.X86]:"sferum-i386.deb"},rpm:{[n.ARCH.X64]:"sferum-x86_64.rpm",[n.ARCH.X86]:"sferum-i686.rpm"}}},c="https://upload.object2.vk-apps.com/vk-me-desktop-dev-5837a06d-5f28-484a-ac22-045903cb1b1a/latest/vk-messenger-x64.exe",d={[n.OS.WINDOWS]:c,[n.OS.MAC]:"https://upload.object2.vk-apps.com/vk-me-desktop-dev-5837a06d-5f28-484a-ac22-045903cb1b1a/latest/vk-messenger-universal.dmg",[n.OS.LINUX]:{deb:{[n.ARCH.X64]:"https://upload.object2.vk-apps.com/vk-me-desktop-dev-5837a06d-5f28-484a-ac22-045903cb1b1a/latest/vk-messenger-6.0.13-build.24-amd64.deb"}},[n.OS.UNKNOWN]:c},u={[n.OS.WINDOWS]:"vk-messenger-x64.exe",[n.OS.MAC]:"vk-messenger-universal.dmg",[n.OS.LINUX]:{deb:{[n.ARCH.X64]:"vk-messenger-6.0.13-build.24-amd64.deb"}}},p={current:s,latest:d},_={current:l,latest:u}},723689:(e,t,a)=>{"use strict";a.d(t,{isMiniAppSource:()=>o});var n=a(22412);const o=e=>e===n.CallStatSource.MINI_APP},332235:(e,t,a)=>{"use strict";a.d(t,{calcFlags:()=>r,calcFlagsArray:()=>s,createFlags:()=>i,is:()=>o});var n=a(878198);function o(e,t){return(e&t)===t}function i(e){const t={};for(let a=0;a<e.length;++a)t[e[a]]=1<<a;return t}function r(e,t){return(0,n.objectReduce)(t,((t,a,n)=>a?t|e[n]:t),0)}function s(e,t){return t.reduce(((t,a)=>t|e[a]),0)}},765789:(e,t,a)=>{"use strict";a.d(t,{browser:()=>o,getWarningBrowserInfo:()=>i});const n=navigator.userAgent.toLowerCase(),o={version:(n.match(/.+(?:me|ox|on|rv|it|era|opr|ie|edge)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:!/chrome/i.test(n)&&/webkit|safari|khtml/i.test(n),edge:/(edge)\/(\d+)\.(\d+)/.test(n),chrome:/(chrome)\/(\d+)\.(\d+)/.test(n),firefox:/(firefox)\/(\d+)\.(\d+)/.test(n)};function i(e){const t=null==e?void 0:e.find((e=>o[e.browser]&&void 0===e.version)),a=null==e?void 0:e.find((e=>o[e.browser]&&String(o.version).startsWith(String(e.version))));var n;return null!=(n=null!=a?a:t)?n:null}},971276:(e,t,a)=>{"use strict";a.d(t,{generateJoinCallsDeepLink:()=>i,generateStartCallsDeepLink:()=>o});var n=a(22412);const o=({peerId:e,userId:t})=>{const a=`${n.DESKTOP_CALLS_SCHEME}${n.DESKTOP_CALLS_HOST}/join?peerId=${e}&userId=${t}`;return console.log("deeplink: ",a),a},i=({joinLink:e,vkJoinLink:t,userId:a})=>{let o=`${n.DESKTOP_CALLS_SCHEME}${n.DESKTOP_CALLS_HOST}/join?joinLink=${e}&userId=${a}`;return 0!==a&&a||(o=`${n.DESKTOP_CALLS_SCHEME}${n.DESKTOP_CALLS_HOST}/join?callId=${t}&joinLink=${e}`),console.log("deeplink: ",o),o}},659956:(e,t,a)=>{"use strict";a.d(t,{createInvokeErrorWrapper:()=>s,getMediaErrorMessage:()=>i,getMediaErrorTitle:()=>r,getPermissionsErrorMessage:()=>o});var n=a(22412);function o(e,t=!0,a){let n="";return e&&t?n=a("calls_error_no_cam_and_mic"):e?n=a("calls_error_no_cam"):t&&(n=a("calls_error_no_mic")),n}function i(e,t){const a=t("calls_mic_camera_permission_instruction_link").replace("{link}",'<a href="https://vk.com/faq18718" target="_blank">').replace("{/link}","</a>");return{[n.MediaError.CAMERA_PERMISSION]:`<div><div>${t("calls_camera_permission")}</div><br /><div>${a}</div></div>`,[n.MediaError.MIC_PERMISSION]:`<div><div>${t("calls_mic_permission")}</div><br /><div>${a}</div></div>`,[n.MediaError.MIC_CAMERA_PERMISSION]:`<div><div>${t("calls_mic_camera_permission")}</div><br /><div>${a}</div></div>`,[n.MediaError.CAMERA_ACCESS]:t("calls_error_cameralock"),[n.MediaError.MIC_ACCESS]:t("calls_error_miclock"),[n.MediaError.MIC_NOT_FOUND]:t("calls_error_nomic"),[n.MediaError.SCREEN_PERMISSION]:t("calls_error_screenpermission"),[n.MediaError.SCREEN_ACCESS]:t("calls_error_screenlock")}[e]}const r=(e,t)=>e===n.MediaError.CAMERA_PERMISSION||e===n.MediaError.MIC_PERMISSION?t("calls_update_browser_permission"):t("calls_oops");function s(e,t){return a=>{e&&e({msg:a}),(null==t?void 0:t.onError)&&t.onError(new Error(a)),console.error(a)}}},787278:(e,t,a)=>{"use strict";a.d(t,{ENavigateToConvoDirection:()=>s,isFastChatMounted:()=>r,useBoxLayerObserver:()=>c,useNavGoListener:()=>l});var n=a(667294),o=a(453067);const i=()=>{var e;return!(!(null==(e=window.reforgedME)?void 0:e.selectPeer)||!document.querySelector(".FCApp"))},r=()=>!function(){const{host:e,pathname:t}=window.location;return/calls\.vk\.(com|ru)/.test(e)||t.startsWith("/calls-standalone")}()&&i();var s;!function(e){e[e.Messenger=0]="Messenger",e[e.FastChat=1]="FastChat"}(s||(s={}));const l=(e,t)=>{(0,n.useEffect)((()=>{if(t||!i())return;const a=(0,o.createNavGoListener)(e);return a.init(),()=>{a.destroy()}}),[e,t])},c=(e,t)=>{(0,n.useEffect)((()=>{if(t||!i()||!window.hasOwnProperty("MutationObserver")||!window.hasOwnProperty("boxLayer"))return;const a=new MutationObserver((t=>{let a=!1;for(const n of t){if("childList"===n.type)n.addedNodes.length&&(e(),a=!0);if(a)break}}));return a.observe(window.boxLayer,{childList:!0}),()=>{a.disconnect()}}),[e,t])}},844873:(e,t,a)=>{"use strict";a.d(t,{isFeedbackColumnEnabled:()=>l,isFeedbackConfigFetched:()=>o,isFeedbackEnabled:()=>r,isFeedbackOptionEnabled:()=>i,isFeedbackPanelEnabled:()=>s});var n=a(464380);const o=e=>{var t;return!!(null==(t=e.reactions)?void 0:t.reactions)},i=e=>e.includes(n.ConversationOption.FEEDBACK),r=e=>i(e.conversationOptions)&&o(e),s=e=>r(e),l=e=>r(e)},899426:(e,t,a)=>{"use strict";a.d(t,{download:()=>s,getPlatformUrl:()=>c,openDesktopPage:()=>l,setDownloadedFlag:()=>d});var n=a(274706),o=a(22412),i=a(495195),r=a(659397);const s=(e,t,a=!1)=>{const n=document.createElement("a");a&&(n.target="_blank"),n.download=t,n.href=e,document.body.appendChild(n),n.click(),n.remove()},l=(e=o.DESKTOP_CALLS_DOWNLOAD_PAGE)=>{const t=document.createElement("a");t.target="_blank",t.href=e,document.body.appendChild(t),t.click(),t.remove()};function c(e,t){if(e)return function(e){const t=e?i.SFERUM_APP_URL.latest:i.SFERUM_APP_URL.current,a=e?i.SFERUM_DESKTOP_CALLS_FILENAME.latest:i.SFERUM_APP_URL.current;switch(n.Platform.OS){case n.OS.MAC:case n.OS.WINDOWS:return{url:t[n.Platform.OS],filename:a[n.Platform.OS]};case n.OS.LINUX:return{url:t[n.Platform.OS].deb[n.ARCH.X64],filename:a[n.Platform.OS].deb[n.ARCH.X64]};default:return null}}(t);let a=null;return n.Platform.OS===n.OS.MAC?a={url:i.DESKTOP_CALLS_DOWNLOAD[n.OS.MAC],filename:i.DESKTOP_CALLS_FILENAME[n.OS.MAC]}:n.Platform.OS===n.OS.WINDOWS?a={url:i.DESKTOP_CALLS_DOWNLOAD[n.OS.WINDOWS],filename:i.DESKTOP_CALLS_FILENAME[n.OS.WINDOWS]}:n.Platform.OS===n.OS.LINUX&&(a={url:i.DESKTOP_CALLS_DOWNLOAD[n.OS.LINUX].deb[n.ARCH.X64],filename:i.DESKTOP_CALLS_FILENAME[n.OS.LINUX].deb[n.ARCH.X64]}),a}function d(){r.localStorage.setItem(o.LOCALSTORAGE_IS_CALLS_APP_DOWNLOADED,"true")}},643229:(e,t,a)=>{"use strict";a.d(t,{muteDevice:()=>r});var n=a(464380),o=a(292071),i=a(332235);function r({isAudio:e,isSingle:t,isPermanent:a,participantExternalId:r,logEvent:s,closeDialog:l,isCurrentlyOn:c,isMediaAllowed:d,roomId:u=null}){const p=function(e){const t=(0,i.createFlags)(["isPermanent","isCurrentlyOn","isMediaAllowed"]),a=(0,i.calcFlags)(t,e);if((0,i.is)(a,t.isPermanent))return n.MuteState.MUTE_PERMANENT;if(a===t.isCurrentlyOn)return n.MuteState.UNMUTE;return n.MuteState.MUTE}({isPermanent:a,isCurrentlyOn:c,isMediaAllowed:d}),_=e?{[n.MediaOption.AUDIO]:p}:{[n.MediaOption.VIDEO]:p,[n.MediaOption.SCREEN_SHARING]:p};(0,n.muteParticipant)({externalId:t?r:null,muteStates:_,roomId:u}).catch(console.log).finally(l),s(a?o.CallStatMuteType.ONCE:o.CallStatMuteType.PERMANENT)}},453067:(e,t,a)=>{"use strict";a.d(t,{createNavGoListener:()=>n});const n=e=>{function t(t,a,n,o){return e(t,a,n,o),!0}function a(){var e;return null==(e=window.nav)||null==e.subscribeOnModuleEvaluated||e.subscribeOnModuleEvaluated(n),!0}function n(){var e,n,o,i;null==(e=window.cur)||null==(n=e.nav)||null==n.push||n.push(t),null==(o=window.cur)||null==(i=o.destroy)||null==i.push||i.push(a)}return{init:n,destroy:function(){var e,o,i,r,s;null==(e=window.nav)||null==e.unsubscribeOnModuleEvaluated||e.unsubscribeOnModuleEvaluated(n),(null==(o=window.cur)?void 0:o.nav)&&Array.isArray(null==(i=window.cur)?void 0:i.nav)&&(window.cur.nav=window.cur.nav.filter((e=>e!==t))),(null==(r=window.cur)?void 0:r.destroy)&&Array.isArray(null==(s=window.cur)?void 0:s.destroy)&&(window.cur.destroy=window.cur.destroy.filter((e=>e!==a)))}}}},736145:(e,t,a)=>{"use strict";a.d(t,{shortPercentFormat:()=>n,valueToPercent:()=>o});const n=e=>`${Math.round(e)}%`;function o(e,t,a){return e<t&&(e=t),e>a&&(e=a),100*(e-t)/(a-t)}},911513:(e,t,a)=>{"use strict";a.d(t,{getParticipantActions:()=>C});var n=a(785893),o=a(464380),i=a(571150),r=a(878198),s=a(496111),l=a(732297),c=a(495457),d=a(22412),u=a(773816),p=a(787278),_=a(971),m=a(182846),h=a(465768),g=a(7780);const A={},C=({state:e,SDK:t,dispatch:a,participant:_,getLang:C,navigateToConvo:f,navigateToProfile:S,device:E,onWatchTogetherMute:T})=>{const I=E?(0,s.externalIdToString)(E.externalId):_.peerId,y=e.groupId?_.peerId===e.groupId:_.peerId===e.me,N=E?(0,s.isSameExternalId)(E.externalId,e.externalId):y,b=(null==E?void 0:E.status)===o.ParticipantStatus.WAITING,x=(0,c.isGroupCallByPeer)(e.peer),M=!!e.groupId;let O=[];const P=e.config.enableChangeName,R=e.config.sferum,k=(0,s.isParticipantGroup)(_.peerId),w=(0,s.isParticipantAnonym)(_.peerId),D=(0,s.isCreator)(_),L=(0,s.isAdmin)(_),j=L||D,B=function(e,t){return"externalId"in t?(0,s.isSameExternalId)(e,t.externalId):!(null===e||!t.peerId)&&e.id===t.peerId.toString()}(e.adminPinnedParticipant,E||_),U=(0,s.isParticipantAnonym)(e.me),H=(0,s.canMuteParticipants)(e.localDevice),F=(0,s.isCreator)(e.localDevice),V=(0,s.isAdmin)(e.localDevice)||F,G=!(N||w||U||void 0===f||M),W={text:C(k?"calls_go_to_chat_with_community":"calls_go_to_chat_with_participant"),onClick:()=>{const e=function(e,t){if(e.peerId)return e.peerId;if(!(null==t?void 0:t.externalId.id))return null;return+(null==t?void 0:t.externalId.id)}(_,E);if(!e)return void(0,o.debugMessage)(o.DebugMessageType.ERROR,{text:"[getPeerId] returned id: 0",peerId:e});f(e)!==p.ENavigateToConvoDirection.FastChat&&(a({type:d.E_ACTION.CHANGE_UI_MODE,mode:d.UIMode.COLLAPSED}),a({type:d.E_ACTION.MANAGEMENT,isOpen:!1}))}};if(x){const p=!N&&!w&&void 0!==S,A=(0,s.canPinParticipants)(e.localDevice)&&!U&&!b,f=function(e){if(!e.roles)return!1;return(0,s.isCreator)(e)||(0,s.isAdmin)(e)}(e.localDevice)&&!U&&!b,I=!N&&H&&!function(e){return(0,s.someDeviceByParticipant)(e,(e=>{if((0,r.isEmpty)(e.mediaSettings))return!1;const{isAudioEnabled:t,isVideoEnabled:a,isScreenSharingEnabled:n}=e.mediaSettings;return!(!t||!a&&!n)}))}(_)&&!U&&!b,x=!N&&H&&E&&!U&&!b,M=!y&&V&&!D&&!U,F=P&&(V||y)&&!k&&!R||y&&U&&!R,$=p,z=A||G||f,Z=I||x,K=M||F;if(p&&O.push({text:(0,n.jsx)(m.MenuActionWithIcon,{text:k?C("calls_go_to_community"):_.name,icon:(0,n.jsx)(i.Icon12Chevron,{className:"CallsActionsGoToProfileIcon"})}),onClick:e=>{S(e,_.link,_.peerId)},titleClassName:"CallsActionsGoToProfileTitle",deps:[k,_.name]}),$&&z&&O.push({separator:!0}),A){const n=n=>{t.pinParticipant(n.externalId,!1,e.rooms.roomId).then((()=>{a({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:n.externalId}),a({type:d.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0})})).catch(h.handlePromiseError),l.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_PIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,c.isGroupCallByPeer)(e.peer)})},o=n=>{t.pinParticipant(n.externalId,!0,e.rooms.roomId).then((()=>{a({type:d.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT,data:null})})).catch(h.handlePromiseError),l.callStats.logEvent({call_event_type:d.CallActionEventType.ADMIN_UNPIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,c.isGroupCallByPeer)(e.peer)})},i=C(B?"calls_participant_menu_pin_cancel":"calls_participant_menu_pin"),r=()=>{B?E?o(E):v(_,o):E?n(E):v(_,n)};O.push({text:i,onClick:r,deps:[e.rooms.roomId,B]})}if(G&&O.push(W),f&&(N||w||j||!(0,s.someDeviceByParticipant)(_,(e=>e.status===o.ParticipantStatus.CONNECTED))||O.push({text:C("calls_participant_menu_assign_admin_role"),onClick:()=>{a({type:d.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT,data:{participant:_}})}}),!y&&L&&O.push({text:C("calls_participant_menu_revoke_admin_role"),onClick:()=>{const n=(0,s.getParticipantExternalId)(_);n&&(t.grantRoles(n,[o.UserRole.ADMIN],!0).then((()=>{a({type:d.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:_.peerId,data:(_.roles||[]).filter((e=>e!==o.UserRole.ADMIN))})})).catch(console.log),l.callStats.logEvent({call_event_type:d.CallActionEventType.RETRIEVE_ADMIN,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,c.isGroupCallByPeer)(e.peer)}))}})),($||z)&&Z&&O.push({separator:!0}),I&&O.push({text:C("calls_participant_menu_enable_media_request"),onClick:()=>{const a=a=>{t.muteParticipant({externalId:a.externalId,muteStates:{},requestedMedia:[o.MediaOption.AUDIO,o.MediaOption.VIDEO,o.MediaOption.SCREEN_SHARING],roomId:a.roomId}).catch(h.handlePromiseError),l.callStats.logEvent({call_event_type:d.CallActionEventType.ASK_USER_TO_UNMUTE,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,c.isGroupCallByPeer)(e.peer)})};E?a(E):v(_,a)}}),x){const t=u.MuteStatesHandler.isMediaAllowed("audio",E,!0);O.push({text:C("calls_participant_menu_mute_audio"),onClick:()=>{a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.SINGLE_AUDIO,device:E}})},isEnabled:t,deps:[t]});const n=u.MuteStatesHandler.isMediaAllowed("video",E,!0);if(O.push({text:C("calls_participant_menu_mute_video"),onClick:()=>{a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:d.ParticipantsManagementMode.SINGLE_VIDEO,device:E}})},isEnabled:n,deps:[n]}),!(e.onlyAdminCanShareMovie||R||j||w)){const t=!e.onlyAdminCanShareMovie&&u.MuteStatesHandler.isMediaAllowed("movieSharing",E);O.push({text:C("calls_participant_menu_mute_watch_together"),onClick:()=>{E&&T(E)},isEnabled:t,deps:[t]})}}($||z||Z)&&K&&O.push({separator:!0}),F&&(y?O.push({text:C("calls_change_name"),onClick:()=>{a({type:d.E_ACTION.CHANGE_NAME_MODAL,participantId:_.peerId,renamedUserType:d.RenamedUserType.SELF}),a({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:g.ManagementViews.CHANGE_NAME})}}):O.push({text:C("calls_rename"),onClick:()=>{a({type:d.E_ACTION.CHANGE_NAME_MODAL,participantId:_.peerId,renamedUserType:_.peerId>0?d.RenamedUserType.USER:d.RenamedUserType.ANONYM}),a({type:d.E_ACTION.MANAGEMENT,isOpen:!0,managementView:g.ManagementViews.CHANGE_NAME})}})),M&&O.push({negative:!0,text:C("calls_participant_menu_kick"),onClick:()=>{a({type:d.E_ACTION.TOGGLE_PARTICIPANTS_KICK,data:{type:d.KickParticipantType.CALL,participant:_}})}})}if(x||(G&&O.push(W),N||U||!H||b||O.push({text:C("calls_participant_menu_mute"),onClick:()=>{const e=e=>{t.muteParticipant({externalId:e.externalId,muteStates:{[o.MediaOption.AUDIO]:o.MuteState.MUTE}}).catch(h.handlePromiseError)};E?e(E):v(_,e)}})),A[I]){let e=O.length===A[I].length;if(e)for(let t=0;t<O.length;t++)if(!(0,r.isArraysEqual)(O[t].deps,A[I][t].deps)){e=!1;break}e?O=A[I]:A[I]=O}else A[I]=O;return O};function v(e,t){const{maps:{vkIdToDevices:a},devices:n}=_.GlobalStore.getCallsState(),o=a.get(e.peerId);if(o)for(const e of o){const a=n[e];a&&t(a)}}},871463:(e,t,a)=>{"use strict";a.d(t,{ECallViewMode:()=>o,getCallViewMode:()=>p,getParticipantLayout:()=>_,getParticipantsLayoutDiff:()=>h});var n,o,i=a(434788),r=a(22412),s=a(878198),l=a(464380),c=a(496111),d=a(495457);!function(e){e.CONTAIN="cn",e.COVER="cv"}(n||(n={})),function(e){e[e.P2P=0]="P2P",e[e.Collapsed=1]="Collapsed",e[e.Orator=2]="Orator",e[e.Grid=3]="Grid"}(o||(o={}));const u={collapsed:{width:265,height:200},regular:{width:900,height:504},orator:{width:140,height:140}};function p(e){return(0,d.isGroupCallByPeer)(e.peer)?e.uiMode===r.UIMode.COLLAPSED?1:e.isOratorMode?2:3:0}function _(e,t,a){const n=function(e,t){switch(p(e)){case 0:return function(e,t,a){const n=new Map,{enableScreenTrack:o,enableProducerScreenTrack:s}=e.config,d=e.uiMode===r.UIMode.FULLSCREEN,u=e.uiMode===r.UIMode.COLLAPSED,p=(0,c.getPeerIdDeviceInfo)(e.peer,e.devices),_=o=>{const{movieStreamInfo:i,movieStreamStoppedInfo:r,externalId:s}=o,u=(0,c.externalIdToString)(s);i&&e.callData.topology===l.TransportTopology.SERVER&&n.set(I(u,i.source,i.movieId),f(o,d,!1,t,a,i.source,String(i.movieId))),r&&n.set(I(u,r.source,r.movieId),A(o,r.source,String(r.movieId)))};if(_((0,i._)({},e.localDevice,{externalId:e.externalId||(0,c.getDefaultExternalId)()})),!p)return n;const{externalId:m,mediaSettings:h}=p;if((0,c.isSameExternalId)(m,e.externalId))return n;const g=(0,c.externalIdToString)(m);if(o||s){const{screen:o,camera:i,animoji:r}=E(h,e.callData.topology);if(_(p),o&&(i||r)){const e=i?l.MediaType.CAMERA:l.MediaType.ANIMOJI,o=i?l.MediaType.ANIMOJI:l.MediaType.CAMERA;n.set(I(g,l.MediaType.SCREEN),f(p,d,u,t,a,l.MediaType.SCREEN)),n.set(I(g,e),S(p,e)),n.set(I(g,o),A(p,o))}if(o!==(i||r)){const e=o&&l.MediaType.SCREEN||i&&l.MediaType.CAMERA||l.MediaType.ANIMOJI;n.set(I(g,e),f(p,d,u,t,a,e)),[l.MediaType.SCREEN,l.MediaType.CAMERA,l.MediaType.ANIMOJI].forEach((t=>{t!==e&&n.set(I(g,t),A(p,t))}))}return o||i||r||(n.set(I(g,l.MediaType.SCREEN),A(p,l.MediaType.SCREEN)),n.set(I(g,l.MediaType.CAMERA),A(p,l.MediaType.CAMERA)),n.set(I(g,l.MediaType.ANIMOJI),A(p,l.MediaType.ANIMOJI))),n}return n.set(g,T(h)?f(p,d,u,t,a):A(p)),n}(e,t.ww,t.wh);case 1:return function(e){const t=(0,s.isAnyoneWithVideo)(e),a=(0,c.getCallVisibleParticipant)(e,t),{activeDevices:n}=(0,c.getActiveDevices)(e),{enableScreenTrack:o,enableProducerScreenTrack:i}=e.config;return n.reduce(((t,n)=>{const r=a=>{const{movieStreamInfo:n,movieStreamStoppedInfo:o,externalId:i}=a,r=(0,c.externalIdToString)(i);n&&e.callData.topology===l.TransportTopology.SERVER&&t.set(I(r,n.source,n.movieId),C(a,n.source,String(n.movieId))),o&&t.set(I(r,o.source,o.movieId),A(a,o.source,String(o.movieId)))},{externalId:s,mediaSettings:d}=n;if((0,c.isSameExternalId)(s,e.externalId))return(0,c.isSameExternalId)(s,null==a?void 0:a.externalId)&&r(a),t;const u=(0,c.externalIdToString)(s);if(o||i){const{screen:o,camera:i,animoji:p}=E(d,e.callData.topology),_=(0,c.isSameExternalId)(s,null==a?void 0:a.externalId);r(a);const h=[l.MediaType.SCREEN,l.MediaType.CAMERA,l.MediaType.ANIMOJI];m(t,u,h,[o,i,p],_,(e=>C(a,e)),(e=>A(n,e)))}else(0,c.isSameExternalId)(null==a?void 0:a.externalId,s)&&T(d)?t.set(u,C(a)):t.set(u,A(n));return t}),new Map)}(e);case 2:return function(e,t,a){const n=(0,c.getSelectedDevice)(e),o=n.externalId,i=(0,c.externalIdToString)(o),{activeDevices:s}=(0,c.getActiveDevices)(e);let d=0;const{enableScreenTrack:u,enableProducerScreenTrack:p}=e.config;if((u||p)&&i){const u=new Map,{screen:p,camera:_,animoji:h}=E(null==n?void 0:n.mediaSettings,e.callData.topology),g=null==n?void 0:n.streamMode,C=e.uiMode===r.UIMode.FULLSCREEN,v=!(0,c.isSameExternalId)(o,e.externalId),{movieStreamInfo:T,movieStreamStoppedInfo:y}=n;if(T&&e.callData.topology===l.TransportTopology.SERVER&&(d++,u.set(I(i,T.source,T.movieId),f(n,C,!1,t,a,T.source,String(T.movieId)))),y&&u.set(I(i,y.source,y.movieId),A(n,y.source,String(y.movieId))),p&&v&&(d++,u.set(I(i,l.MediaType.SCREEN),f(n,C,!1,t,a,l.MediaType.SCREEN))),p&&(_||h)&&v){const e=_?l.MediaType.CAMERA:l.MediaType.ANIMOJI,o=_?l.MediaType.ANIMOJI:l.MediaType.CAMERA;d++,u.set(I(i,e),g===e?f(n,C,!1,t,a,e):S(n,e)),u.set(I(i,o),A(n,o))}if(p&&!_&&!h&&v&&(u.set(I(i,l.MediaType.CAMERA),A(n,l.MediaType.CAMERA)),u.set(I(i,l.MediaType.ANIMOJI),A(n,l.MediaType.ANIMOJI))),!p&&(_||h)&&v){const e=_?l.MediaType.CAMERA:l.MediaType.ANIMOJI,o=_?l.MediaType.ANIMOJI:l.MediaType.CAMERA;d++,u.set(I(i,e),f(n,C,!1,t,a,e)),u.set(I(i,o),A(n,o)),u.set(I(i,l.MediaType.SCREEN),A(n,l.MediaType.SCREEN))}return p||_||h||!v||(u.set(I(i,l.MediaType.CAMERA),A(n,l.MediaType.CAMERA)),u.set(I(i,l.MediaType.ANIMOJI),A(n,l.MediaType.ANIMOJI)),u.set(I(i,l.MediaType.SCREEN),A(n,l.MediaType.SCREEN))),s.reduce(((t,a)=>{const{externalId:n,mediaSettings:i,movieStreamInfo:r,movieStreamStoppedInfo:s}=a;if((0,c.isSameExternalId)(n,o))return t;const u=(0,c.externalIdToString)(n),{screen:p,camera:_,animoji:h}=E(i,e.callData.topology,!!r),g=!!a.visible&&d<e.config.videoSlotsCount;if(s&&t.set(I(u,s.source,s.movieId),A(a,s.source,String(s.movieId))),g&&r&&(d++,t.set(I(u,r.source,r.movieId),S(a,r.source,String(r.movieId)))),(0,c.isSameExternalId)(n,e.externalId))return t;return m(t,u,[l.MediaType.SCREEN,l.MediaType.CAMERA,l.MediaType.ANIMOJI],[p,_,h],g,(e=>S(a,e)),(e=>A(a,e)))&&d++,t}),u),u}const _=s.reduce(((n,i)=>{const{externalId:s,mediaSettings:l}=i;if((0,c.isSameExternalId)(s,e.externalId))return n;const u=(0,c.externalIdToString)(s);if((0,c.isSameExternalId)(o,s)&&T(l)){const o=f(i,e.uiMode===r.UIMode.FULLSCREEN,!1,t,a);n.set(u,o)}else T(l)&&i.visible&&d<e.config.videoSlotsCount?(d++,n.set(u,S(i))):n.set(u,A(i));return n}),new Map);return _}(e,t.ww,t.wh);default:return function(e,t){const a=e.uiMode===r.UIMode.FULLSCREEN,n=a?t.ww:t.gw,o=a?t.wh:t.gh;if(!n||!o)return new Map;const{activeDevices:i}=(0,c.getActiveDevices)(e),d=function(e,t,a){let n;switch(!0){case 1===a:n=1;break;case 2===a:n=2;break;case(0,s.minmax)(a,3,4):{const e=Math.round(t/2-4);return[Math.round(1.77*e),e]}case(0,s.minmax)(a,5,6):n=3;break;case(0,s.minmax)(a,7,12):n=4;break;default:n=5}const o=Math.round(e/n-4),i=Math.round(o/1.77);return[o,i]}(n,o,i.length),u=d[1]<200?1:2;let p=0;const{enableScreenTrack:_,enableProducerScreenTrack:h}=e.config;function g(t,a){const n=(0,c.externalIdToString)(t.externalId),{movieStreamInfo:o,movieStreamStoppedInfo:i}=t;o&&e.callData.topology===l.TransportTopology.SERVER&&(p++,a.set(I(n,o.source,o.movieId),v(t,d,u,o.source,String(o.movieId)))),i&&a.set(I(n,i.source,String(i.movieId)),A(t,i.source,String(i.movieId)))}const C=i.reduce(((t,a)=>{if((0,c.isSameExternalId)(a.externalId,e.externalId))return g(a,t),t;const{externalId:n,mediaSettings:o}=a,i=(0,c.externalIdToString)(n);if(g(a,t),_||h){const{screen:n,camera:r,animoji:s}=E(o,e.callData.topology),c=!!a.visible&&p<e.config.videoSlotsCount;return m(t,i,[l.MediaType.SCREEN,l.MediaType.CAMERA,l.MediaType.ANIMOJI],[n,r,s],c,(e=>v(a,d,u,e)),(e=>A(a,e)))&&p++,t}return T(o)&&a.visible&&p<e.config.videoSlotsCount?(t.set(i,v(a,d,u)),p++):t.set(i,A(a)),t}),new Map);return C}(e,t)}}(e,t);return n.forEach(((e,t)=>{const o=a.get(t);!e.stopStream||o&&!o.stopStream||n.delete(t)})),a.forEach(((e,t)=>{if(!n.has(t)&&!e.stopStream){const a=A({externalId:e.uid},e.mediaType,e.streamName);n.set(t,a)}})),n}function m(e,t,a,n,o,i,r){const s=n.findIndex((e=>e)),l=-1!==s?a[s]:null;return o&&l&&e.set(I(t,l),i(l)),a.filter((e=>!o||e!==l)).forEach((a=>{e.set(I(t,a),r(a))})),o&&!!l}function h(e,t){const a=[];return t.forEach(((t,n)=>{const o=e.get(n);(g(o)||g(t))&&(o&&function(e,t){const a=e,n=t;if(a.stopStream&&n.stopStream)return!0;if(a.stopStream||n.stopStream)return!1;const o=e,i=t;return o.fit===i.fit&&o.width===i.width&&o.height===i.height&&o.priority===i.priority&&e.streamName===t.streamName}(o,t)||a.push(t))})),a}function g(e){return e&&!e.stopStream}function A(e,t=null,a){const n={stopStream:!0,uid:e.externalId,mediaType:t};return a&&(n.streamName=a),n}function C(e,t=null,a){const n={fit:"cn",width:u.collapsed.width,height:u.collapsed.height,priority:2,uid:e.externalId,mediaType:t};return a&&(n.streamName=a),n}function v(e,t,a,n=null,o){const i={fit:"cv",width:t[0],height:t[1],priority:a,uid:e.externalId,mediaType:n};return o&&(i.streamName=o),i}function f(e,t,a,n,o,i=null,r){const s=a?u.collapsed.width:u.regular.width,l=a?u.collapsed.height:u.collapsed.width,c={fit:"cn",width:t?n:s,height:t?o:l,priority:3,uid:e.externalId,mediaType:i};return r&&(c.streamName=r),c}function S(e,t=null,a){const{mediaSettings:n}=e,o={fit:(null==n?void 0:n.isScreenSharingEnabled)?"cn":"cv",width:u.orator.width,height:u.orator.height,priority:1,uid:e.externalId,mediaType:t};return a&&(o.streamName=a),o}function E(e,t,a){const n={screen:!1,camera:!1,animoji:!1};return e?(n.screen=!!e.isScreenSharingEnabled&&!a,n.camera=(!!e.isVideoEnabled||!!e.isAnimojiEnabled&&t===l.TransportTopology.SERVER)&&!a,n.animoji=!!e.isAnimojiEnabled&&t!==l.TransportTopology.SERVER&&!a,n):n}function T(e){var t;return null!=(t=!!(null==e?void 0:e.isVideoEnabled)||!!(null==e?void 0:e.isScreenSharingEnabled)||!!(null==e?void 0:e.isAnimojiEnabled))&&t}function I(e,t=null,a){return`${e}${t?`:${t}`:""}${a?`:${a}`:""}`}},890713:(e,t,a)=>{"use strict";a.d(t,{addParticipantsInCacheAndLoadInfo:()=>Z,calcParticipantListChunkCount:()=>Y,getActiveDevicesForChunk:()=>G,getCountNotLoadedDevicesBeforeForList:()=>Q,getParticipantLayoutForChunk:()=>W,getParticipantListChunk:()=>$,getParticipantListChunkInitCount:()=>I,getParticipantListChunkOnScroll:()=>w,isUseParticipantListChunk:()=>N,onConversationParticipantListChunk:()=>L,onParticipantJoinedForChunk:()=>j,onPinnedParticipantForChunk:()=>R,onRemoteAnimojiStreamForChunk:()=>M,onRemoteLiveForChunk:()=>O,onRemoteMediaSettingsForChunk:()=>B,onRemoteParticipantStateForChunk:()=>F,onRemoteRemovedForChunk:()=>P,onRemoteScreenStreamForChunk:()=>x,onRemoteStatusForChunk:()=>U,onRemoteStreamForChunk:()=>b,refreshCurrentParticipantListChunk:()=>Le});var n=a(11010),o=a(434788),i=a(820224),r=a(50533),s=a(971),l=a(1628),c=a(22412),d=a(878198),u=a(496111),p=a(800582),_=a(464380),m=a(871463),h=a(773816),g=a(743679),A=a(227336);const C="GRID",v=1,f=.2,S=140,E=128,T=8;function I(){const e=window.innerHeight;return y(Math.max(Math.ceil(e/S),T))}function y(e){const t=e*v;return Math.min(t+e+t,E)}function N(e){var t;return Boolean(null==(t=e.config)?void 0:t.enableParticipantListChunk)}function b(e,t,{externalId:a,stream:n,streamMode:o}){ve(e,t,a,{stream:n,streamMode:o})}function x(e,t,{externalId:a,stream:n,streamMode:o}){ve(e,t,a,{screenSharingStream:n,streamMode:o})}function M(e,t,{externalId:a,stream:n,streamMode:o}){ve(e,t,a,{animojiStream:n,streamMode:o})}function O(e,t,a){ve(e,t,a.externalId,a)}function P(e,t,a,{externalId:n,markers:i}){var r;const s=e.participantsChunk;if(!s)return;const l=(0,u.externalIdToString)(n),c=ce(e,l),d=X(te(i),e),p=d>-1,_=-1===d;if((null==(r=e.handState)?void 0:r[l])&&se(t,n,!1),p){const n=Ae(d,s),i=(0,o._)({},s,{ids:n});Ce(t,i),function(e,t,a,n){if(0===n.countAfter&&0===n.countBefore||Pe(n,e))return Promise.resolve();ke(e,t,a)}(e,t,a,i)}else _?(Ce(t,{countBefore:Math.max(0,s.countBefore-1)}),we(e,t,a)):Ce(t,{countAfter:Math.max(0,s.countAfter-1)});c&&Ne(e,t,[n])}function R(e,t,a,n,o){return k.apply(this,arguments)}function k(){return k=(0,n._)((function*(e,t,a,n,{externalId:i,pin:r,markers:s}){const l=te(s);if(!N(e)||!l)return;const c=ce(e,(0,u.externalIdToString)(i)),d=_e(e,i)>-1,p=me(e,s),_=he(e.participantsChunk,p);oe(e,t,a,n,{externalId:i,markers:s}),_&&function(e,t,a){J(e,[(0,o._)({externalId:t},a)])}(t,i,{markers:s}),r&&c||(r&&!c||_&&!d?yield function(e,t,a,n,o,i){return ge.apply(this,arguments)}(e,t,a,n,i,l):!c||_||r||Ne(e,t,[i]))})),k.apply(this,arguments)}function w(e,t,a){return D.apply(this,arguments)}function D(){return(D=(0,n._)((function*(e,t,{numberOfVisible:a,firstVisible:n}){const o=s.GlobalStore.getCallsState();if(function(e,t,a){const n=e.participantsChunk;if(!n)return!0;const o=n.countBefore,i=n.countAfter,r=o,s=r+n.ids.length,l=t+a,c=Math.ceil(a*v*f);if((0===o||t-r>=c)&&(0===i||s-l>=c))return!1;return!0}(o,n=Ee(Math.max(0,n)),a=Math.ceil(a)))return ke(o,t,e,{firstVisible:n,numberOfVisible:a})}))).apply(this,arguments)}function L(e,t,a,n){const o=[];n.participants.forEach((e=>{o.push(e.uid);const a=e.participantState;if(a){const n=(0,u.convertParticipantStateFromSDK)(a);ie(t,e.uid,n),re(t,e.uid,n)}})),ue(e,t,a,o),ee(e,t,n)}function j(e,t,a,n,{externalId:o,markers:i}){if(!N(e))return;const r=te(i),s=e.participantsChunk;if(!s||!r)return;const l=Se(e),c=s.ids||[],d=De(r,e),u=0===l&&0===s.countBefore;if(d<0)return;if(0===d&&!u)return Ce(t,{countBefore:s.countBefore+1}),void we(e,t,a);const p=Pe(s,e);d>=c.length&&p?Ce(t,{countAfter:s.countAfter+1}):Oe(e,t,n,{externalId:o,markers:i})}function B(e,t,a,n,{externalId:i,markers:r,mediaSettings:s,permissionsOnce:l}){const c=e.participantsChunk,d=he(c,me(e,r)),p=(0,u.externalIdToString)(i),_=(0,o._)({},(0,u.getMediaSettingsWithStreamMode)(s,de(e,p)),{permissionsOnce:l,markers:r});s.isScreenSharingEnabled||s.isVideoEnabled||d?K(e,t,n,i,_):be(e,t,i,_);const m=0===(null==c?void 0:c.countBefore);(0,u.getOrator)(e).device!==e.localDevice||m||function(e,t,a){ae.apply(this,arguments)}(a,e,t),oe(e,t,a,n,{externalId:i,markers:r})}function U(e,t,a,n){for(const o of a)e.devices[(0,u.externalIdToString)(o)]&&(0,l.throttleAccumulateDispatchParticipant)(t,o,{status:n})}function H(){return(H=(0,n._)((function*(e,t,a,n){if(!n)return;const o=(yield $(e,{fromMarker:n,count:1,includeMarker:!0})).participants.at(0);if(!o)return void(0,_.debugMessage)(_.DebugMessageType.ERROR,{text:"failed to fetch participant device with marker provided",marker:n});if(!(0,u.isSameExternalId)(a,o.uid))return void(0,_.debugMessage)(_.DebugMessageType.ERROR,{text:"fetched incorrect participant device with id",request:a,response:o.uid});if(!(s.GlobalStore.isSet()&&ce(s.GlobalStore.getCallsState(),(0,u.externalIdToString)(o.uid))))return;const i={externalId:o.uid,mediaSettings:o.mediaSettings,permissions:h.MuteStatesHandler.mapParticipantPermissions(o.muteStates)};(0,l.throttleAccumulateDispatchParticipant)(t,o.uid,i)}))).apply(this,arguments)}function F(e,t,a,n,{externalId:o,markers:i,participantState:s}){(0,r.batch)((()=>{ie(t,o,s),re(t,o,s);const r=me(e,i),l=he(e.participantsChunk,r);-1===_e(e,o)&&function(e,t,a,n){H.apply(this,arguments)}(a,t,o,te(i));const c={markers:i,statusData:s};l?K(e,t,n,o,c):be(e,t,o,c),oe(e,t,a,n,{externalId:o,markers:i})}))}let V=[];function G(e){var t,a,n;const i=null!=(n=null==(t=e.participantsChunk)?void 0:t.ids.reduce(((t,a)=>{const n=(0,u.externalIdToString)(a),o=de(e,n);return o&&(t.push(o),o.screenSharingStream&&A.screenShareNotVisibleStat.measure(o.externalId)),t}),[]))?n:V;0===(null==(a=e.participantsChunk)?void 0:a.countBefore)&&e.externalId&&i.unshift((0,o._)({},e.localDevice,{externalId:e.externalId}));const r=(0,d.shallowEqual)(V,i);return V=r?V:i,{activeDevices:V}}function W(e,t,a){return(0,m.getParticipantLayout)(e,t,a)}function $(e,t){return z.apply(this,arguments)}function z(){return(z=(0,n._)((function*(e,t,a={}){var{count:n,fromIdx:r=0,fromMarker:s,roomId:l}=t,c=(0,i._)(t,["count","fromIdx","fromMarker","roomId"]),{signal:d=null}=a;let u=!1;const p=()=>u=!0;return null==d||d.addEventListener("abort",p,{once:!0}),e.getParticipantListChunk((0,o._)({count:n,fromIdx:s?void 0:r,fromMarker:s,listType:C,roomId:l},c)).then((e=>u?Promise.reject(new Error("aborted")):e)).finally((()=>{null==d||d.removeEventListener("abort",p)}))}))).apply(this,arguments)}function Z(e,t,a,n){const o=ue(e,t,a,n.map((({externalId:e})=>e)));return J(t,n),o}function K(e,t,a,n,i){Z(e,t,a,[(0,o._)({externalId:n},i)])}function Q(e){if(e){var t;const a=null!=(t=e.countBefore)?t:0;return a?Te(a,1):a}return 0}function Y(e){return e?e.countBefore+e.ids.length+e.countAfter:0}function q(e,t){const a=Se(e),n=ye(e),o=a+n,i=t.countBefore;return t.ids.reduce(((e,t,n)=>{const r=i+n,s=r>=a&&r<o;return e.push({externalId:t,visible:s}),e}),[])}function J(e,t){const a=t.reduce(((e,t)=>(e[(0,u.externalIdToString)(t.externalId)]=t,e)),{});e({type:c.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:a})}function X(e,t){const a=t.participantsChunk,n=(null==a?void 0:a.ids)||[];return(0,d.binarySearch)(n,(a=>{const n=(0,u.externalIdToString)(a),o=de(t,n);if(!o)return 1;const i=te(o.markers);return _.utils.participantMarkerCompare(e,i)}))}function ee(e,t,a){var n;const o=null!=(n=null==a?void 0:a.participants)?n:[],i={countBefore:a.countBefore,ids:o.map((e=>e.uid)),countAfter:a.countAfter};(0,r.batch)((()=>{!function(e,t,a){var n,o;const i=null!=(o=null==(n=e.participantsChunk)?void 0:n.ids)?o:[];if(!i.length)return;const r=a.participants.reduce(((e,t)=>(e[(0,u.externalIdToString)(t.uid)]=!0,e)),{});Ne(e,t,i.filter((e=>{const t=(0,u.externalIdToString)(e);return!r[t]})))}(e,t,a),Ce(t,i),J(t,o.map(l.mapExternalParticipantToDevice))})),q(e,i).forEach((e=>{(0,l.throttleAccumulateDispatchParticipant)(t,e.externalId,e)}))}function te(e){return null==e?void 0:e[C]}function ae(){return(ae=(0,n._)((function*(e,t,a){const{participants:[n]}=yield $(e,{count:1,fromIdx:0});n&&(0,u.toggleScreenSharing)(t,a,n.mediaSettings.isScreenSharingEnabled,n.uid)}))).apply(this,arguments)}function ne(e,t,a,{externalId:n,markers:o}){const i=e.participantsChunk;if(!i)return;const r=_e(e,n),s=me(e,o),l=r>-1,c=he(i,s);if(c&&!l){const r=0===i.countBefore&&i.countAfter?i.countAfter-1:i.countAfter;return void Oe(e,t,a,{externalId:n,markers:o,countBefore:0===i.countAfter&&i.countBefore?i.countBefore-1:i.countBefore,countAfter:r})}if(l&&!c)return void function(e,t,a,n){if(!n)return;const o=Ae(t,n),i=0===a;function r(e,t){return e?t+1:t}Ce(e,{countBefore:r(i,n.countBefore),ids:o,countAfter:r(!i,n.countAfter)})}(t,r,s,i);l&&c&&r!==s&&function(e,t,a,n,o){const i=Array.from(o);i.splice(a,0,n);const r=t+(a<=t?1:0);i.splice(r,1),Ce(e,{ids:i})}(t,r,s,n,i.ids)}function oe(e,t,a,n,{externalId:o,markers:i}){ne(e,t,n,{externalId:o,markers:i}),we(e,t,a)}function ie(e,t,a){(null==a?void 0:a.hand)&&se(e,t,a.hand.state)}function re(e,t,a){(null==a?void 0:a.drat)&&function(e,t,a){e({type:c.E_ACTION.SET_PARTICIPANT_DRAT_STATE,key:(0,u.externalIdToString)(t),value:a})}(e,t,a.drat.state)}function se(e,t,a){e({type:c.E_ACTION.SET_PARTICIPANT_HAND_STATE,key:(0,u.externalIdToString)(t),value:a})}function le(e,t,a){const n=(Array.isArray(a)?a:[a]).filter((t=>ce(e,t)));n.length&&t({type:c.E_ACTION.REMOVE_DEVICE_FROM_CACHE,id:n})}function ce(e,t){return Boolean(de(e,t))}function de(e,t){return e.devices[t]}function ue(e,t,a,n){return pe.apply(this,arguments)}function pe(){return(pe=(0,n._)((function*(e,t,a,n){const o=n.reduce(((t,a)=>{const n=Number(a.id);return e.participants[n]||t.push(n),t}),[]);if(!o.length)return Promise.resolve();const i=e.callData.callId||"",r={withConversation:!e.callData.conversation,awaitImages:!1};return(0,p.loadCallParticipantsAccumulate)(e,t,a,i,o,r)}))).apply(this,arguments)}function _e(e,t){const a=(0,u.externalIdToString)(t),n=e.participantsChunk;return((null==n?void 0:n.ids)||[]).findIndex((e=>(0,u.externalIdToString)(e)===a))}function me(e,t){const a=X(te(t),e);return a>-1?a:-(a+1)}function he(e,t){if(!e)return!1;const a=e.ids;return 0===t&&0===e.countBefore||t===a.length&&0===e.countAfter||t>0&&t<a.length}function ge(){return(ge=(0,n._)((function*(e,t,a,n,o,i){const r=(0,u.externalIdToString)(o);return $(a,{count:1,fromMarker:i}).then((a=>{const o=a.participants[0];(0,u.externalIdToString)(o.uid)===r&&K(e,t,n,o.uid,{mediaSettings:o.mediaSettings,permissions:h.MuteStatesHandler.mapParticipantPermissions(o.muteStates)})}))}))).apply(this,arguments)}function Ae(e,t){if(!t)return[];const a=t.ids,n=Array.from(a);return n.splice(e,1),n}function Ce(e,t){e({type:c.E_ACTION.SET_PARTICIPANTS_CHUNK,data:t})}function ve(e,t,a,n){const o=(0,u.externalIdToString)(a);n.stream||n.screenSharingStream||n.animojiStream||n.movieStream?(0,l.throttleAccumulateDispatchParticipant)(t,a,n):ce(e,o)&&(-1===_e(e,a)?be(e,t,a,n):(0,l.throttleAccumulateDispatchParticipant)(t,a,n))}function fe(e,t){const a=v*t;return Math.max(0,e-a)}function Se(e){return Ee(Ie(e))}function Ee(e){return Te(e,-1)}function Te(e,t){return Math.max(e+t,0)}function Ie(e){var t;return null!=(t=e.isOratorMode?e.oratorScrollFirstVisible:e.gridScrollFirstVisible)?t:0}function ye(e){return e.isOratorMode?Math.ceil(e.oratorScrollNumberOfVisible):c.GRID_SCROLL_NUMBER_OF_VISIBLE}function Ne(e,t,a){const n=xe(e),o=a.map(u.externalIdToString).filter((t=>!Me(e.devices[t])&&!n[t]));le(e,t,o)}function be(e,t,a,n){const o=xe(e),i=(0,u.externalIdToString)(a),r=e.devices[i];!Me(Object.assign({},r,n))&&!o[i]?le(e,t,i):(0,l.throttleAccumulateDispatchParticipant)(t,a,n)}function xe(e){return[e.adminPinnedParticipant,e.screenSharingPinnedParticipant,e.pinnedParticipant,(0,g.getWatchTogetherPinnedParticipant)(e),(0,g.getWatchTogetherOwner)(e)].filter(Boolean).map(u.externalIdToString).reduce(((e,t)=>(e[t]=!0,e)),{})}function Me(e){return!!e&&!(!e.stream&&!e.screenSharingStream)}function Oe(e,t,a,{externalId:n,markers:o,countBefore:i,countAfter:r}){const s=e.participantsChunk;if(!s)return;i=null!=i?i:s.countBefore,r=null!=r?r:s.countAfter;const l=De(te(o),e),c=Re(e),d=fe(Se(e),ye(e)),u=Math.max(d-i,0),p=s.ids,m=Array.from(p);m.splice(l,0,n);const h=m.splice(0,u),g=m.splice(c),A={countBefore:i+h.length,ids:m,countAfter:r+g.length};K(e,t,a,n,{markers:o,status:_.ParticipantStatus.CONNECTED}),Ce(t,A),function(e,t,a){a&&J(t,q(e,a))}(e,t,A),Ne(e,t,[...h,...g])}function Pe(e,t){const a=Re(t);return e.ids.length>=a}function Re(e){return y(ye(e))}function ke(e,t,a,{firstVisible:n=Se(e),numberOfVisible:o=ye(e),roomId:i=null}={}){const r=y(o),l=function(e,t,a){return e.participantsChunk?fe(t,a):0}(e,n,o);return $(a,{count:r,fromIdx:l,roomId:i}).then((a=>{ee(s.GlobalStore.isSet()?s.GlobalStore.getCallsState():e,t,a)}))}function we(e,t,a){return w(a,t,{firstVisible:Ie(e),numberOfVisible:ye(e)})}function De(e,t){return-(X(e,t)+1)}function Le(e,t,a,n){const o=e.participantsChunk;return ke(e,t,a,{firstVisible:null==o?void 0:o.countBefore,numberOfVisible:null==o?void 0:o.ids.length,roomId:n})}},141647:(e,t,a)=>{"use strict";a.d(t,{SDKParticipants:()=>s});var n=a(971),o=a(878198),i=a(1628),r=a(773816);class s{static getParticipantsMuteStates(e){s.abortGetParticipants();const t=new AbortController;s._lastController=t;const a=n.GlobalStore.getCallsStore(),l=a.getState(),c=a.dispatch,d=(0,o.objectMap)(l.devices,(e=>e.externalId));d.length&&e.getParticipants({externalIds:d}).then((e=>{if(!t.signal.aborted)for(const t of e)t.muteStates&&(0,i.throttleAccumulateDispatchParticipant)(c,t.uid,{permissions:r.MuteStatesHandler.mapParticipantPermissions(t.muteStates)})}))}static abortGetParticipants(){s._lastController&&(s._lastController.abort(),s._lastController=null)}}s._lastController=null},433110:(e,t,a)=>{"use strict";a.d(t,{collapsedCallPositionStorage:()=>o});var n=a(659397);const o={key:"calls_collapsed_call_position",getPosition:()=>{const e=sessionStorage.getItem(o.key);return(0,n.isString)(e)?JSON.parse(e):void 0},setPosition:e=>{sessionStorage.setItem(o.key,JSON.stringify(e))}}},419125:(e,t,a)=>{"use strict";a.d(t,{mapPrevVirtualBackgroundData:()=>l,sendVirtualBackgroundDisabled:()=>c});var n=a(22412),o=a(495457),i=a(97547),r=a(292071),s=a(732297);const l=(e,t,a)=>{let o=null,i=e;e===n.EVideoEffectType.BLUR?(o=r.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED,i=n.VIRTUAL_BACKGROUND_BLUR_ID):"number"==typeof e&&(o=e>4e3?r.CallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DISABLED:r.CallActionEventType.VIRTUAL_BACKGROUND_DISABLED);return{prevSendValue:i,disabledActionType:o,effectDuration:Math.round((t-a)/1e3)}},c=e=>{const t=i.effectStorage.getEffectTs();if(!t)return;i.effectStorage.clearEffectTs();const a=i.effectStorage.getEffect(),n=Date.now(),r=e.callData.callId,c=e.peer,d=(0,o.isGroupCallByPeer)(c),{disabledActionType:u,effectDuration:p,prevSendValue:_}=l(a,n,t);null!==u&&s.callStats.logEvent({call_event_type:u,is_group_call:d,peer_id:c,session_id:r,background_duration:p,background_id:_})}},1628:(e,t,a)=>{"use strict";a.d(t,{DEFAULT_THROTTLE_TIMEOUT:()=>u,addParticipantsToStoreThrottled:()=>g,applyDevicesBatch:()=>m,mapExternalParticipantToDevice:()=>h,queryThrottledAccumulatedState:()=>A,throttleAccumulateDispatchParticipant:()=>_});var n=a(434788),o=a(22412),i=a(464380),r=a(496111),s=a(878198),l=a(773816),c=a(993240),d=a(438655);const u=100,p={acc:{},timer:0,tasks:0};function _(e,t,a,i){!function(e,t,a,i=u,s){var l;const c=(0,r.externalIdToString)(e),d=(0,n._)({},t,{externalId:e});d.roomId===o.ROOM_UNDEFINED_ID&&void 0!==(null==(l=s.acc[c])?void 0:l.roomId)&&delete d.roomId;s.acc[c]=s.acc[c]&&"object"==typeof s.acc[c]?(0,n._)({},s.acc[c],d):d,s.tasks++,s.timer&&clearTimeout(s.timer);s.timer=window.setTimeout((()=>{s.tasks>0&&(a(s.acc),s.acc={},s.tasks=0),s.timer=0}),i)}(t,a,(t=>{e({type:o.E_ACTION.UPDATE_PARTICIPANTS_BATCH,data:t})}),i,p)}function m(e,t){const a=(0,n._)({},e,{devices:(0,n._)({},e.devices)}),{vkIdToDevices:l}=e.maps;return(0,s.objectForEach)(t,(s=>{const c=(0,r.externalIdToString)(s.externalId),d=e.devices[c]||{};if(void 0===(null==d?void 0:d.status)&&s.status===i.ParticipantStatus.HANGUP)delete a.devices[c];else{let r=l.get(+s.externalId.id);r||(r=new Set,l.set(+s.externalId.id,r)),r.add(c);const p=s.statusData?(0,n._)({},d.statusData,s.statusData):d.statusData,_=d.wasConnected||s.status===i.ParticipantStatus.CONNECTED,m=Object.assign({},d.mediaSettings,s.mediaSettings);var u;let h=null!=(u=void 0!==s.roomId?s.roomId:d.roomId)?u:o.ROOM_MAIN_ID;a.devices[c]=(0,n._)({},e.devices[c],t[c],{statusData:p,wasConnected:_,mediaSettings:m,roomId:h})}})),a}function h(e){return{externalId:e.uid,mediaSettings:e.mediaSettings,markers:e.markers,status:e.status||i.ParticipantStatus.CONNECTING,statusData:e.participantState?(0,r.convertParticipantStateFromSDK)(e.participantState):void 0,wasConnected:!1,permissions:l.MuteStatesHandler.mapParticipantPermissions(e.muteStates)}}function g(e,t,a,n=o.ROOM_MAIN_ID,i){if(a)for(const p of a){var s,l;if((0,r.isSameExternalId)(p.uid,e.externalId))continue;const a=p.movieShareInfos,m=h(p);(null==a?void 0:a.length)&&(e.screenSharingOldPinnedParticipant&&t({type:o.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:null}),(0,d.equalsToMyRoom)(e,n)&&(0,c.setWatchTogether)(t,{movieInfo:a[0],owner:p.uid,pinnedParticipant:p.uid}),m.movieStreamInfo=a[0],m.movieStreamStoppedInfo=null),void 0!==n&&(m.roomId=n),_(t,p.uid,m);const g=e.devices[(0,r.externalIdToString)(p.uid)],A=(null==g||null==(s=g.mediaSettings)?void 0:s.isScreenSharingEnabled)||!1;var u;if(i||(null==p||null==(l=p.mediaSettings)?void 0:l.isScreenSharingEnabled)!==A)(0,r.toggleScreenSharing)(e,t,null==p||null==(u=p.mediaSettings)?void 0:u.isScreenSharingEnabled,p.uid,!0)}}function A(e){const t=(0,r.externalIdToString)(e),a=p.acc[t];if(a)return a}},220734:(e,t,a)=>{"use strict";a.d(t,{getAgeDiff:()=>o});const n=(e,t)=>(e%t+t)%t,o=e=>{const t={years:0,months:0,days:0,hours:0,minutes:0,seconds:0},a=1e3*e,o=Date.now()-a;if(o<0)return t;t.hours=Math.floor(n(o/1e3,86400)/3600),t.minutes=Math.floor(n(o/1e3,3600)/60),t.seconds=Math.floor(n(o/1e3,60));let i=new Date(a);const r=new Date;return i.getHours()>r.getHours()&&(i=new Date(a+60*(24-i.getHours())*60*1e3)),t.years=r.getFullYear()-i.getFullYear(),t.months=r.getMonth()+1-(i.getMonth()+1),t.days=r.getDate()-i.getDate(),t.days<0&&t.months--,t.days=Math.floor(o/1e3/86400),t.months<0&&(t.years--,t.months+=12),(t.years||t.months)&&(t.days=0),t}},8101:(e,t,a)=>{"use strict";a.d(t,{canStopTranslation:()=>o,isMeRecordCreator:()=>i});var n=a(496111);function o(e){var t,a,o,i;return!(!(0,n.isAdmin)(e.localDevice)&&!(0,n.isCreator)(e.localDevice))||!!(null==(t=e.translation)||null==(a=t.host)?void 0:a.id)&&+(null==(o=e.translation)||null==(i=o.host)?void 0:i.id)===(0,n.getMeId)(e)}function i(e){return(0,n.isParticipantGroup)(e.groupId)?e.groupId===e.translation.ownerId:e.me===e.translation.ownerId}},290020:(e,t,a)=>{"use strict";function n(e,t){return`/video${e}_${t}`}function o(e){const t=document.createElement("video"),a=()=>{t.classList.add("Video--visible"),t.removeEventListener("loadeddata",a)};return t.addEventListener("loadeddata",a),t.autoplay=!0,t.controls=!1,t.crossOrigin="anonymous",t.playsInline=!0,t.preload="metadata",t.srcObject=e,t.volume=0,t}a.d(t,{createVideoTag:()=>o,getShortVideoUrl:()=>n})},26660:(e,t,a)=>{"use strict";a.d(t,{HistoryScreenActionTypes:()=>o.HistoryScreenActionTypes,useHistoryScreenDispatch:()=>r,useHistoryScreenSelector:()=>i});var n=a(50533),o=a(939723);const i=n.useSelector,r=()=>(0,n.useDispatch)()},152789:(e,t,a)=>{"use strict";a.d(t,{useActiveDevicesListCount:()=>r});var n=a(667294),o=a(490287),i=a(496111);function r(){const e=(0,o.useTypedSelector)((e=>e.devices)),t=(0,o.useTypedSelector)((e=>e.rooms)),a=(0,o.useTypedSelector)((e=>e.participantsChunk));return(0,n.useMemo)((()=>(0,i.getActiveDevicesCount)(e,t,a)),[e,t,a])}},571181:(e,t,a)=>{"use strict";a.d(t,{useAsr:()=>m,useAsrPopup:()=>h});var n=a(667294),o=a(465768),i=a(396901),r=a(22412),s=a(490287),l=a(205805),c=a(366854),d=a(974),u=a(174583),p=a(496111),_=a(972205);function m(){const e=(0,l.useCallsSDK)(),t=(0,i.useTypedDispatch)(),a=(0,s.useTypedSelector)(c.getRoomId),m=(0,s.useTypedSelector)(d.getMyExternalId),g=(0,s.useTypedSelector)(u.getAsrOwnerExternalId);return{startAsr:(0,n.useCallback)((t=>{const n={fileName:t};return a&&(n.roomId=a),e.startAsr(n).catch(o.handlePromiseError)}),[a]),stopAsr:(0,n.useCallback)((()=>{const n={};return a&&(n.roomId=a),e.stopAsr(n).then((()=>{(0,p.isSameExternalId)(m,g)||(0,_.setFeatureEndedNotification)(t,r.EFeatureEndedNotification.AsrEndedNotificationAdmin)})).catch(o.handlePromiseError)}),[a]),toggleAsrPopup:h()}}function h(){const e=(0,i.useTypedDispatch)();return(0,n.useCallback)((()=>{e({type:i.E_ACTION.TOGGLE_POPUP,data:r.POPUP_ASR})}),[])}},668778:(e,t,a)=>{"use strict";a.d(t,{useAsrOwner:()=>r});var n=a(490287),o=a(174583),i=a(974);const r=()=>{const e=(0,n.useTypedSelector)(o.getAsrState),t=(0,n.useTypedSelector)(i.getParticipants);return(null==e?void 0:e.externalId)&&t[e.externalId.id]||null}},645022:(e,t,a)=>{"use strict";a.d(t,{BaseObjectsContext:()=>o,useBaseObjectsContext:()=>i});var n=a(667294);const o=(0,n.createContext)({bridge:{},SDK:{}}),i=()=>(0,n.useContext)(o)},198380:(e,t,a)=>{"use strict";a.d(t,{useCallFeaturesActions:()=>d});var n=a(667294),o=a(302617),i=a(396901),r=a(22412),s=a(737598),l=a(845301),c=a(97547);const d=()=>{const{onboardingFeature:e,closeOnboardingBanner:t,isOnboardingBannerOpen:a}=(0,l.useOnboarding)(),{sendStatsData:d}=(0,o.useSendStatsData)(),u=(0,i.useTypedDispatch)(),p=(0,s.useIsMeCanManageWatchTogether)();return{onOpenWatchTogetherFeature:(0,n.useCallback)((()=>{p&&(c.onboardingStorage.getUsedFeature(r.E_ONBOARDING_FEATURES.watchTogether)||c.onboardingStorage.setUsedFeature(r.E_ONBOARDING_FEATURES.watchTogether),a&&e===r.E_ONBOARDING_FEATURES.watchTogether&&t(),d(r.CallActionEventType.CALL_WATCH_TOGETHER_CLICK),u({type:i.E_ACTION.TOGGLE_POPUP,data:r.POPUP_MOVIE_CHOOSE}))}),[p,d,a,e,t]),onOpenVmojiFeature:(0,n.useCallback)((()=>{c.onboardingStorage.getUsedFeature(r.E_ONBOARDING_FEATURES.vmoji)||c.onboardingStorage.setUsedFeature(r.E_ONBOARDING_FEATURES.vmoji),a&&e===r.E_ONBOARDING_FEATURES.vmoji&&t(),d(r.CallActionEventType.CALL_VMOJI_CLICK),u({type:i.E_ACTION.TOGGLE_POPUP,data:r.POPUP_VMOJI})}),[d,a,e,t])}}},675231:(e,t,a)=>{"use strict";a.d(t,{useCallLongpollAnonymQueue:()=>c});var n=a(667294),o=a(223338),i=a(396901),r=a(971),s=a(490287),l=a(171686);const c=()=>{const{anonymSecret:e}=(0,s.useTypedSelector)((e=>({anonymSecret:!!e.anonymSecret})));(0,n.useEffect)((()=>{if(!e)return;const t=r.GlobalStore.getCallsStore(),a=t.dispatch,n=(0,l.createCallsQueueEventHandler)(t),s=new o.CallsLongpollAnonym({state:()=>t.getState(),onResponse:e=>{a({type:i.E_ACTION.SET_CALLS_QUEUE_RESPONSE,data:e}),e.events.forEach(n)},onUpdateSecret:e=>{a({type:i.E_ACTION.UPDATE_ANON_SECRET,secret:e})}});return s.wait(),()=>{s.destroy()}}),[])}},913350:(e,t,a)=>{"use strict";a.d(t,{useCallLongpollQueue:()=>c});var n=a(667294),o=a(911426),i=a(396901),r=a(971),s=a(490287),l=a(171686);const c=()=>{const{anonymSecret:e}=(0,s.useTypedSelector)((e=>({anonymSecret:!!e.anonymSecret})));(0,n.useEffect)((()=>{if(e)return;const t=r.GlobalStore.getCallsStore(),a=t.dispatch,n=(0,l.createCallsQueueEventHandler)(t),s=new o.CallsLongpoll(t.getState().me,(e=>{a({type:i.E_ACTION.SET_CALLS_QUEUE_RESPONSE,data:e}),e.events.forEach(n)}));return s.wait(),()=>{s.destroy()}}),[e])}},967979:(e,t,a)=>{"use strict";a.d(t,{useCallMenuActions:()=>N});var n=a(785893),o=a(667294),i=a(396901),r=a(22412),s=a(916188),l=a(496111),c=a(796317),d=a(464380),u=a(490287),p=a(680093),_=a(844873),m=a(94977),h=a(915961),g=a(88988),A=a(833803),C=a(465768),v=a(302617),f=a(571181),S=a(791640),E=a(97547),T=a(174583),I=a(205805),y=a(516186);const N=({isVirtualBackgroundSupported:e,isVmojiSupported:t})=>{const a=(0,I.useCallsSDK)(),{getLang:N}=(0,h.useLang)(),b=(0,i.useTypedDispatch)(),{debugLog:x,enableSkipJoinScreenFeature:M}=(0,o.useContext)(c.ConfigContext),{sendStatsData:O}=(0,v.useSendStatsData)(),P=(0,m.useIsGroupCall)(),R=(0,g.useCanStopTranslation)(),k=(0,A.useIsMeRecordCreator)(),{handleMuteWatchTogetherParticipants:w}=(0,p.useMuteWatchTogetherHandlers)({SDK:a}),D=(0,l.isCallHaveOtherParticipants)(),L=(0,u.useTypedSelector)((e=>!e.config.sferum)),j=(0,u.useTypedSelector)((e=>e.config.streaming)),B=(0,u.useTypedSelector)((e=>e.me)),U=(0,u.useTypedSelector)((e=>e.conversationOptions)),H=(0,u.useTypedSelector)((e=>e.permissions)),F=(0,u.useTypedSelector)((e=>e.callData.callId)),V=(0,u.useTypedSelector)((e=>e.localDevice)),G=(0,u.useTypedSelector)((e=>e.onlyAdminCanShareMovie)),W=(0,u.useTypedSelector)((e=>{var t;return null==(t=e.translation)?void 0:t.isOn})),$=(0,u.useTypedSelector)((e=>{var t;return null==(t=e.translation)?void 0:t.isRecord})),z=(0,u.useTypedSelector)((e=>{var t;return null==(t=e.onboarding)?void 0:t.isOnboardingBannerOpen})),Z=(0,y.useSkipJoinCallPrompt)(),K=function(){const{getLang:e}=(0,h.useLang)(),t=(0,u.useTypedSelector)(T.getAsrState),a=(0,S.useIsMeCanManageAsr)(),{toggleAsrPopup:n}=(0,f.useAsr)(),o={text:e("calls_start_asr_action"),key:"startAsr",onClick:n},i={text:e("calls_stop_asr_action"),key:"stopAsr",onClick:n};return{enabled:a,action:t?i:o}}(),Q=(0,l.participantIsAdmin)(V)||k,Y=()=>{(0,s.checkPermissions)(a,[d.MediaOption.AUDIO,d.MediaOption.VIDEO]).then((()=>{b({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_SETTINGS})}))},q=e=>{b(e?{type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_RECORD}:{type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_TRANSLATION})},J=(0,o.useCallback)((()=>{a.muteParticipant({muteStates:{},requestedMedia:[d.MediaOption.AUDIO,d.MediaOption.VIDEO,d.MediaOption.SCREEN_SHARING]}).catch(C.handlePromiseError),O(v.ECallActionEventType.ASK_ALL_TO_UNMUTE)}),[O]),X=()=>{b({type:r.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:r.ParticipantsManagementMode.ALL_AUDIO}})},ee=()=>{b({type:r.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT,data:{mode:r.ParticipantsManagementMode.ALL_VIDEO}})},te=(0,o.useCallback)((()=>{const e=!(0,_.isFeedbackOptionEnabled)(U);a.changeConversationOptions({FEEDBACK:e}).then((()=>{const t=e?v.ECallActionEventType.REACTION_ENABLED:v.ECallActionEventType.REACTION_DISABLED;O(t)}))}),[O,U]),ae=()=>{b({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_VIRUTAL_BACKGROUND})},ne=(0,o.useCallback)((()=>{E.onboardingStorage.setUsedFeature(r.E_ONBOARDING_FEATURES.vmoji),z&&b({type:r.E_ACTION.SET_ONBOARDING_BANNER_IS_OPEN,data:!1}),b({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_VMOJI}),O(v.ECallActionEventType.CALL_VMOJI_CLICK)}),[O,z]);return(0,o.useMemo)((()=>{const a=[{text:N("calls_call_menu_settings"),key:"settings",onClick:Y,disabled:!1}],o=(0,l.canMuteParticipants)(V);if(j&&!(0,l.isParticipantAnonym)(B)){a.push({text:N("calls_call_menu_translation"),key:"translation",onClick:()=>q(!1),disabled:!!W&&(!!$||R)});const e=!(!W||!$),t=e?!Q:!!W,n=W?()=>{b({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_TRANSLATION_STOP})}:()=>q(!0);a.push({text:N(e&&Q?"calls_record_stop_confirmation":"calls_call_menu_recording"),key:"recording",onClick:n,disabled:t})}return K.enabled&&a.push(K.action),o&&P&&(a.push({separator:!0}),D&&a.push({text:N("calls_call_menu_enable_media_request"),key:"unmuteRequest",onClick:J}),a.push({text:N("calls_call_menu_mute_audio_all_v2"),key:"muteAllAudio",onClick:X,isEnabled:H.AUDIO!==d.MuteState.MUTE_PERMANENT}),a.push({text:N("calls_call_menu_mute_video_all_v2"),key:"muteAllVideo",onClick:ee,isEnabled:H.VIDEO!==d.MuteState.MUTE_PERMANENT}),a.push({key:"feedback",text:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"CallsDropdown__row-title__title",children:N("calls_reactions")}),(0,n.jsx)("div",{className:"CallsDropdown__row-title__subtitle",children:N("calls_reactions_desc")})]}),onClick:te,isEnabled:(0,_.isFeedbackOptionEnabled)(U)}),L&&a.push({text:(0,n.jsxs)("div",{className:"CallsDropdown__row-title",children:[(0,n.jsx)("div",{children:N("calls_call_menu_mute_watch_together")}),(0,n.jsx)("div",{className:"CallsDropdown__row-title__subtitle",children:N("calls_call_menu_mute_watch_together_sub")})]}),key:"muteAllWatchTogether",onClick:w,isEnabled:!G})),e&&(a.push({separator:!0}),a.push({text:N("calls_virtual_background"),key:r.POPUP_VIRUTAL_BACKGROUND,onClick:ae})),t&&(e||a.push({separator:!0}),a.push({text:N("calls_vmoji"),key:r.POPUP_VMOJI,onClick:ne})),M&&(a.push({separator:!0}),a.push({text:N("calls_always_open_in_browser"),key:"skipJoinCallPrompt",onClick:Z.toggle,isEnabled:Z.on,isAlternativeSwitch:!0})),x&&(a.push({separator:!0}),a.push({text:N("calls_call_menu_debug"),key:"debugLog",onClick:()=>{window.__VKCallsSDKLogs__()},disabled:!1})),a}),[j,B,W,$,U,H,F,V,P,D,G,L,w,e,t,R,J,te,ne,K,Z.on])}},562090:(e,t,a)=>{"use strict";a.d(t,{useCallNotifications:()=>l});var n=a(785893),o=a(667294),i=a(756392),r=a(396901),s=a(490287);function l(e=""){const t=(0,r.useTypedDispatch)(),a=(0,s.useTypedSelector)((e=>e.notification)),l=(0,s.useTypedSelector)((e=>e.participants));return(0,o.useMemo)((()=>(0,n.jsx)(i.CallNotificationContainer,{dispatch:t,notification:a,participant:l[null==a?void 0:a.data],className:e})),[a,l[null==a?void 0:a.data]])}},678025:(e,t,a)=>{"use strict";a.d(t,{useCallReactions:()=>c});var n=a(667294),o=a(464380),i=a(162532),r=a(490287),s=a(396901),l=a(844873);const c=()=>{const e=(0,s.useTypedDispatch)(),t=(0,r.useTypedSelector)(l.isFeedbackConfigFetched);(0,n.useEffect)((()=>{if(t)return;const a=new AbortController;return(0,i.callsGetReactions)(void 0,{signal:a.signal}).then((t=>{const a=function(e){const t=function(){const e={24:{},28:{},32:{},48:{},56:{},72:{},96:{},192:{}};return e}();if(e)for(const a of e){const e=a.key;for(let n=a.images.length-1;n>=0;--n){const{width:o,url:i}=a.images[n];o>=24&&(t[24][e]=i),o>=28&&(t[28][e]=i),o>=32&&(t[32][e]=i),o>=48&&(t[48][e]=i),o>=56&&(t[56][e]=i),o>=72&&(t[72][e]=i),o>=96&&(t[96][e]=i),o>=192&&(t[192][e]=i)}}return t}(t.items);e({type:s.E_ACTION.SET_REACTIONS,data:{reactions:a}})})).catch((e=>{(0,o.debugMessage)(o.DebugMessageType.ERROR,e)})),()=>{a.abort()}}),[])}},8589:(e,t,a)=>{"use strict";a.d(t,{useCallVmoji:()=>p});var n=a(667294),o=a(464380),i=a(490287),r=a(396901),s=a(22412),l=a(302617),c=a(496111),d=a(205805),u=a(504580);const p=({activeParticipantsList:e})=>{const t=(0,d.useCallsSDK)(),{sendStatsData:a}=(0,l.useSendStatsData)(),p=(0,r.useTypedDispatch)(),_=(0,i.useTypedSelector)((e=>e.externalId)),m=(0,i.useTypedSelector)((e=>e.participants)),{callId:h}=(0,i.useTypedSelector)((e=>e.callData)),g=(0,i.useTypedSelector)((e=>e.vmojiSettings.participantIdsToUpdateSvg)),A=(0,n.useRef)({});(0,n.useEffect)((()=>{const a=[];Promise.all(e.map((({externalId:e})=>{var n;const o=m[e.id],i=null==o||null==(n=o.animated_avatar)?void 0:n.url,r=(0,c.externalIdToString)(e);if(i&&(!(r in A.current)||i!==A.current[r])){const n=(0,c.isSameExternalId)(e,_);return A.current[r]=i,fetch(i).then((e=>e.arrayBuffer())).then((o=>{t.setVmojiSvg(o,n?null:e),a.push(r)})).catch((()=>delete A.current[r]))}}))).then((()=>{a.length>0&&p({type:s.E_ACTION.VMOJI_SET_PARTICIPANT_IDS_TO_UPDATE_SVG,data:g.filter((e=>!a.includes(e)))})}))}),[e,_,m]),(0,n.useEffect)((()=>{u.AnimojiPreviewGenerator.onTimeToRender=e=>{const t=Math.round(e)||1;(0,o.debugMessage)(o.DebugMessageType.LOG,{message:"Sending vmoji benchmarking result stat",timeToRender:t}),a(l.ECallActionEventType.CALL_VMOJI_BENCHMARK,{event_param:t,session_id:h})}}),[])}},88988:(e,t,a)=>{"use strict";a.d(t,{useCanStopTranslation:()=>i});var n=a(490287),o=a(496111);const i=()=>{var e,t;const a=(0,n.useTypedSelector)((e=>e.localDevice)),i=(0,n.useTypedSelector)((e=>e.translation)),r=(0,n.useTypedSelector)((e=>e.groupId)),s=(0,n.useTypedSelector)((e=>e.me)),l=r||s;return!!(0,o.participantIsAdmin)(a)||!!(null==i||null==(e=i.host)?void 0:e.id)&&+(null==i||null==(t=i.host)?void 0:t.id)===l}},226028:(e,t,a)=>{"use strict";a.d(t,{useChangeNameOptions:()=>c});var n=a(667294),o=a(97547),i=a(22412),r=a(428009),s=a(659397),l=a(146679);const c=e=>{let t={};e&&(t={id:e.peerId,name:(0,l.decode)(`${e.firstName} ${e.lastName}`),type:i.CallByNameProfileType.PROFILE});const[a,c]=(0,n.useState)(o.CallChangeNameStorage.getOptions()||t),d=(0,n.useCallback)((e=>{(0,s.isEqual)(e,a)||(o.CallChangeNameStorage.saveOptions(e||t),r.eventBus.emit("changeNameStorage"))}),[a,e]),u=()=>{c(o.CallChangeNameStorage.getOptions()||{})};return(0,n.useEffect)((()=>(r.eventBus.on("changeNameStorage",u),()=>r.eventBus.off("changeNameStorage",u))),[]),{nameOptions:a,changeNameOptions:d}}},121644:(e,t,a)=>{"use strict";a.d(t,{useClosePopup:()=>r});var n=a(667294),o=a(396901),i=a(22412);const r=()=>{const e=(0,o.useTypedDispatch)();return{onClose:(0,n.useCallback)((()=>{e({type:i.E_ACTION.TOGGLE_POPUP,data:null})}),[]),onClosePopupCalendar:(0,n.useCallback)((()=>{e({type:i.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING})}),[])}}},246743:(e,t,a)=>{"use strict";a.d(t,{useContainerControlsVisibility:()=>r});var n=a(667294),o=a(659397);const i=3e3,r=e=>{const{hideTime:t=i,onAsyncHide:a,onMouseMove:r,onMouseLeave:s,onMouseOver:l,isHardStop:c=!1}=e||{},[d,u]=(0,n.useState)(!1),[p,_]=(0,n.useState)(!1),m=(0,n.useRef)(null),h=(0,n.useCallback)((()=>{_(!1)}),[]),g=(0,n.useCallback)((()=>{_(!0)}),[]),A=()=>{m.current&&(clearTimeout(m.current),m.current=null)},C=(0,n.useCallback)((()=>{A(),m.current=setTimeout((()=>{h(),null==a||a(),m.current=null}),t)}),[t,a]);(0,n.useEffect)((()=>{if(c)return A(),void g();d||C()}),[p,d,c,C]);const v=(0,n.useCallback)((()=>{c||(d||(u(!0),g()),null==l||l(d))}),[d,c,l]),f=(0,n.useCallback)((()=>{c||(A(),u(!1),h(),null==s||s())}),[c,s]),S=(0,n.useCallback)((0,o.throttle)((()=>{c||(d&&(p?C():g()),null==r||r(d))}),1e3),[d,p,c,r]);return{isShowControls:p,isFocusInElement:d,handleMouseLeave:f,handleMouseMove:S,handleMouseOver:v,handleShowControls:g,handleHideControls:h}}},908866:(e,t,a)=>{"use strict";a.d(t,{useCountParticipantsByRooms:()=>d});var n=a(667294),o=a(22412),i=a(878198),r=a(496111),s=a(438655),l=a(490287),c=a(28228);const d=()=>{const e=(0,l.useTypedSelector)((e=>e.rooms.rooms)),t=(0,l.useTypedSelector)((e=>e.devices)),a=(0,l.useTypedSelector)((e=>e.participants)),d=(0,c.useIsRoomsActivated)(),u=(0,n.useMemo)((()=>{const n=d?function(e,t,a){return(0,i.objectReduce)(t,((e,t)=>{const n=void 0!==(null==t?void 0:t.roomId)?t.roomId:o.ROOM_MAIN_ID,i=a[t.externalId.id];if((0,r.participantIsAdmin)(i)&&n===o.ROOM_MAIN_ID)return e;const l=(0,s.roomIdToString)(n);var c;return e[l]=(null!=(c=e[l])?c:0)+1,e}),{})}(0,t,a):function(e,t,a){let n=Object.values(t).filter((e=>{const t=a[e.externalId.id];return!(0,r.participantIsAdmin)(t)})).length;const l=(0,i.objectReduce)(e,((e,a)=>{const o=(0,s.roomIdToString)(a.id),i=a.participantIds.filter((e=>t.hasOwnProperty((0,r.externalIdToString)(e)))).length;return e[o]=i,n-=i,e}),{});return l[(0,s.roomIdToString)(o.ROOM_MAIN_ID)]=n,l}(e,t,a);return e=>{const t="string"==typeof e?e:(0,s.roomIdToString)(e);var a;return null!=(a=n[t])?a:0}}),[e,t,d,a]);return{getCountForRoom:u}}},488140:(e,t,a)=>{"use strict";a.d(t,{useCurrentUserStream:()=>o});var n=a(50533);const o=()=>{const e=(0,n.useSelector)((e=>e.localDevice.stream)),t=(0,n.useSelector)((e=>e.localDevice.mediaSettings));return{userStream:e,isVideoEnabled:!!(null==t?void 0:t.isVideoEnabled)}}},234967:(e,t,a)=>{"use strict";a.d(t,{useDOMElementsSize:()=>c});var n=a(434788),o=a(667294),i=a(659397),r=a(278102),s=a(871463),l=a(22412);const c=e=>{const t=(0,o.useRef)({gridNew:[0,0],window:[0,0]}),[a,c]=(0,o.useState)(t.current),d=(0,o.useCallback)((0,i.debounce)((()=>c((0,n._)({},t.current))),200),[]),u=(0,o.useCallback)((e=>{t.current=(0,n._)({},t.current,e),d()}),[]);return(0,o.useEffect)((()=>{const e=()=>{u({window:[window.innerWidth,window.innerHeight]})};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),d.cancel()}}),[]),(0,o.useEffect)((()=>{if((0,s.getCallViewMode)(e)!==s.ECallViewMode.Grid)return;const t=document.getElementById(l.ID_CALLS_PARTICIPANTS_BOX);if(!t)return;const a=(0,r.createResizeObserver)((e=>{const{width:t,height:a}=e.contentRect;t&&a&&u({gridNew:[Math.round(t)-48,Math.round(a)]})}));return a.observe(t),()=>{a.disconnect()}}),[e.peer,e.uiMode,e.isOratorMode]),{ww:a.window[0],wh:a.window[1],gw:a.gridNew[0],gh:a.gridNew[1]}}},933607:(e,t,a)=>{"use strict";a.d(t,{useDialogController:()=>o});var n=a(667294);const o=e=>{const[t,a]=(0,n.useState)(!1);return{isOpened:t,handleCloseDialog:(0,n.useCallback)((()=>{a(!1),null==e||null==e.handleAfterClose||e.handleAfterClose()}),[]),handleOpenDialog:(0,n.useCallback)((()=>{a(!0)}),[])}}},956752:(e,t,a)=>{"use strict";a.d(t,{useDratCount:()=>r});var n=a(667294),o=a(878198),i=a(490287);const r=()=>{const e=(0,i.useTypedSelector)((e=>e.devices));return(0,n.useMemo)((()=>(0,o.objectReduce)(e,((e,t)=>{var a,n;return(null==(a=t.statusData)||null==(n=a.drat)?void 0:n.state)&&e++,e}),0)),[e])}},817302:(e,t,a)=>{"use strict";a.d(t,{useHistoryLongpoll:()=>r});var n=a(667294),o=a(911426),i=a(26660);const r=()=>{const e=(0,i.useHistoryScreenDispatch)(),t=(0,i.useHistoryScreenSelector)((e=>e.meId));(0,n.useEffect)((()=>{const a=new o.CallsLongpoll(t,(t=>{e({type:i.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE,data:t})}));return a.wait(),()=>{a.destroy()}}),[t])}},107487:(e,t,a)=>{"use strict";a.d(t,{useHistoryScheduledCallsUpdate:()=>i});var n=a(667294),o=a(26660);const i=()=>{const e=(0,n.useRef)(),t=(0,o.useHistoryScreenSelector)((e=>e.callsQueueResponse));return(0,n.useMemo)((()=>{var a;return(null==t||null==(a=t.events)?void 0:a.some((e=>{var t;return"scheduled_calls_update"===(null==e||null==(t=e.data)?void 0:t.type)})))&&(e.current=Date.now()),e.current}),[t])}},511649:(e,t,a)=>{"use strict";a.d(t,{useHistoryScreenBridgeActions:()=>r});var n=a(667294),o=a(645022),i=a(516186);const r=()=>{const{bridge:e}=(0,o.useBaseObjectsContext)();return{onCreateCallClick:(0,n.useCallback)((t=>{e.showCreateCallByLinkPopup(t)}),[e]),onJoin:(0,n.useCallback)(((t,a=0,n)=>{if((0,i.getLSSkipJoinCallPrompt)()){if(t)e.joinCallByLink(t,void 0,!1,n);else if(a){a>2e9?e.startGroupCall(a,void 0,null,!1,n):e.call(a,!1,void 0,n)}}else e.showStartCallModal(a,t,n)}),[e]),onPlanCalendarEvent:(0,n.useCallback)((()=>{e.showPlanCalendarEventPopup()}),[e]),setPlannedCalendarEvent:(0,n.useCallback)((t=>{null==e.setPlannedCalendarEvent||e.setPlannedCalendarEvent(t)}),[e])}}},974571:(e,t,a)=>{"use strict";a.d(t,{useHistoryScreenContextActions:()=>h});var n=a(667294),o=a(22412),i=a(444953),r=a(563247),s=a(495457),l=a(26660),c=a(167810),d=a(645022),u=a(121883),p=a(162532),_=a(899426),m=a(464380);const h=()=>{const e=(0,l.useHistoryScreenSelector)((e=>e.profiles)),t=(0,l.useHistoryScreenSelector)((e=>e.joinLinks)),a=(0,l.useHistoryScreenDispatch)(),{navigateToConvo:h}=(0,c.useNavigationContext)(),{bridge:g}=(0,d.useBaseObjectsContext)();return{onHistoryAction:(0,n.useCallback)(((n,l,c,d=0)=>{const A=(0,r.getHistoryCallPeerId)(n);if(l===i.HistoryCallMenuActionsEnum.AUDIO||l===i.HistoryCallMenuActionsEnum.VIDEO){if(g.isInActiveCall)return;const a=l===i.HistoryCallMenuActionsEnum.VIDEO;if((0,s.isGroupCallByPeer)(A))if(A in t)g.joinCallByLink(t[A],void 0,a,o.CallStatSource.HISTORY,d);else{var C;const{chat:t}=(0,r.getHistoryItemOwner)(n,e);(null==t?void 0:t.call_in_progress)&&(null==t||null==(C=t.call_in_progress)?void 0:C.join_link)?g.joinCallByLink(t.call_in_progress.join_link,void 0,a,o.CallStatSource.HISTORY,d):g.call(A,a,void 0,o.CallStatSource.HISTORY,d)}else g.call(A,a,void 0,o.CallStatSource.HISTORY,d)}else l===i.HistoryCallMenuActionsEnum.MESSAGE?h(A):l===i.HistoryCallMenuActionsEnum.PARTICIPANTS?n.call_id&&(0,p.callsGetJoinHistory)({call_id:n.call_id}).then((e=>{const t=new Blob([new Uint8Array([239,187,191]),e],{type:"text/csv;"}),a=URL.createObjectURL(t);(0,_.download)(a,`call_${A}_participants.csv`,!0)})).catch((e=>{(0,m.debugMessage)(m.DebugMessageType.ERROR,e)})):a((0,u.dispatchDeleteCall)(c))}),[t,e,g])}}},913377:(e,t,a)=>{"use strict";a.d(t,{useHistoryScreenCurrentCallsLoadActions:()=>s});var n=a(667294),o=a(26660),i=a(121883),r=a(465768);const s=()=>{const e=(0,o.useHistoryScreenDispatch)(),t=(0,o.useHistoryScreenSelector)((e=>e.profiles)),a=(0,o.useHistoryScreenSelector)((e=>e.currentCalls)),s=(0,o.useHistoryScreenSelector)((e=>e.callsQueueResponse)),[l,c]=(0,n.useState)(!0),d=()=>{c(!0),(0,i.loadCurrentCalls)(e).then((t=>{(0,i.updateProfilesAndUrls)(e,[t])})).catch(r.handlePromiseError).finally((()=>{c(!1)}))};return(0,n.useEffect)((()=>{d()}),[]),(0,n.useEffect)((()=>{var e;!!(null==s||null==(e=s.events)?void 0:e.some((e=>{var t;return"current_calls_update"===(null==e||null==(t=e.data)?void 0:t.type)})))&&d()}),[s]),{currentCallsBlockLoading:l,currentCalls:a,profiles:t}}},611324:(e,t,a)=>{"use strict";a.d(t,{useHistoryScreenLoadActions:()=>d});var n=a(667294),o=a(121883),i=a(160232),r=a(50533),s=a(26660),l=a(151582),c=a(465768);const d=(e="all")=>{const t=(0,l.useIsMounted)(),a=(0,s.useHistoryScreenSelector)((e=>e.historyCalls)),d=(0,r.useDispatch)(),{setLoading:u,loading:p}=(0,i.useHistoryScreenLoading)(),[_,m]=(0,n.useState)(!1),[h,g]=(0,n.useState)(0),[A,C]=(0,n.useState)(!1);(0,n.useEffect)((()=>{u(!0),(0,o.loadHistoryCalls)(d,25,h,0,e).then((e=>{var a,n;if(t())return m(null!=(a=e.has_more)&&a),g(null!=(n=e.next_from)?n:0),e})).then((e=>{e&&(0,o.updateProfilesAndUrls)(d,[e]).then((e=>{C(!e)}))})).catch(c.handlePromiseError).finally((()=>{t()&&u(!1)}))}),[]);const v=(a,n,i=[],r=!1)=>(0,o.loadHistoryCalls)(d,25,a,n,e,i,r).then((e=>{return!!t()&&(m(null!=(a=e.has_more)&&a),g(null!=(n=e.next_from)?n:0),e);var a,n})).then((e=>!!e&&(0,o.updateProfilesAndUrls)(d,[e])));return{onShowMoreHistory:()=>v(h,0,a),loadHistory:v,loading:p,showMoreHistory:_,showLanding:A,setLoading:u}}},160232:(e,t,a)=>{"use strict";a.d(t,{useHistoryScreenLoading:()=>r});var n=a(667294),o=a(26660),i=a(121883);const r=()=>{const e=(0,o.useHistoryScreenSelector)((e=>e.loading)),t=(0,o.useHistoryScreenDispatch)(),a=(0,n.useCallback)((e=>{t((0,i.dispatchSetLoading)(e))}),[]);return{loading:e,setLoading:a}}},63846:(e,t,a)=>{"use strict";a.d(t,{useHistoryScreenLocation:()=>o});var n=a(667294);const o=e=>{const{urlSection:t}=(0,n.useMemo)((()=>({urlSection:new URLSearchParams(e.search).get("section")||""})),[e]),[a,o]=(0,n.useState)(t);return{section:a,setSection:o}}},582422:(e,t,a)=>{"use strict";a.d(t,{useIsAnonymous:()=>i});var n=a(50533),o=a(496111);const i=()=>{const e=(0,n.useSelector)((e=>e.me));return{isAnonymous:(0,o.isParticipantAnonym)(e)}}},94977:(e,t,a)=>{"use strict";a.d(t,{useIsGroupCall:()=>s});var n=a(667294),o=a(490287),i=a(496111),r=a(495457);const s=()=>{const e=(0,o.useTypedSelector)((e=>e.peer)),t=(0,o.useTypedSelector)((e=>e.localDevice)),a=(0,o.useTypedSelector)((e=>e.devices));return(0,n.useMemo)((()=>((e,t,a)=>{var n,o;const s=(0,i.getPeerIdDeviceInfo)(e,a);return(0,r.isGroupCallByPeer)(e)||!!(null==(n=t.mediaSettings)?void 0:n.isScreenSharingEnabled)||!!(null==s||null==(o=s.mediaSettings)?void 0:o.isScreenSharingEnabled)||!(!t.movieStream||!t.movieStreamInfo)||!(!(null==s?void 0:s.movieStream)||!(null==s?void 0:s.movieStreamInfo))})(e,t,a)),[e,t,a])}},791640:(e,t,a)=>{"use strict";a.d(t,{useIsMeCanManageAsr:()=>l});var n=a(490287),o=a(496111),i=a(174583),r=a(974),s=a(430065);const l=()=>{const e=(0,n.useTypedSelector)(i.getAsrState),t=(0,n.useTypedSelector)(r.getMyDevice),a=(0,n.useTypedSelector)(r.getMyExternalId),l=(0,o.participantIsAdmin)(t),c=(0,n.useTypedSelector)(s.getIsAsrFeatureEnabled),d=(0,n.useTypedSelector)(s.getIsSferum),u=(0,o.isSameExternalId)(a,null==e?void 0:e.externalId);return!!c&&(d?l:l||!e||u)}},737598:(e,t,a)=>{"use strict";a.d(t,{useIsMeCanManageWatchTogether:()=>l});var n=a(93481),o=a(954982),i=a(490287),r=a(496111),s=a(743679);const l=()=>{const e=(0,i.useTypedSelector)(s.getWatchTogetherInfo),t=(0,n.useIsWatchTogetherAllowed)(),a=(0,i.useTypedSelector)((e=>e.localDevice)),l=(0,o.useIsSharedMovieOwner)();return(0,r.participantIsAdmin)(a)||t&&(!e||l)}},833803:(e,t,a)=>{"use strict";a.d(t,{useIsMeRecordCreator:()=>i});var n=a(490287),o=a(496111);const i=()=>{const e=(0,n.useTypedSelector)((e=>e.groupId)),t=(0,n.useTypedSelector)((e=>e.translation)),a=(0,n.useTypedSelector)((e=>e.me));return(0,o.isParticipantGroup)(e)?e===t.ownerId:a===t.ownerId}},28228:(e,t,a)=>{"use strict";a.d(t,{useIsRoomsActivated:()=>r});var n=a(667294),o=a(878198),i=a(490287);const r=()=>{const e=(0,i.useTypedSelector)((e=>e.rooms.rooms));return(0,n.useMemo)((()=>(0,o.objectSome)(e,(e=>e.active))),[e])}},954982:(e,t,a)=>{"use strict";a.d(t,{useIsSharedMovieOwner:()=>r});var n=a(490287),o=a(496111),i=a(743679);const r=()=>{const e=(0,n.useTypedSelector)(i.getWatchTogetherOwner),t=(0,n.useTypedSelector)((e=>e.externalId));return(0,o.isSameExternalId)(e,t)}},93481:(e,t,a)=>{"use strict";a.d(t,{useIsWatchTogetherAllowed:()=>r});var n=a(490287),o=a(773816),i=a(496111);const r=()=>{const e=(0,n.useTypedSelector)((e=>e.localDevice)),t=(0,n.useTypedSelector)((e=>e.onlyAdminCanShareMovie));return!!(0,i.participantIsAdmin)(e)||!t&&o.MuteStatesHandler.isMediaAllowed("movieSharing",e)}},755836:(e,t,a)=>{"use strict";a.d(t,{useLeaveCall:()=>u});var n=a(667294),o=a(496111),i=a(94977),r=a(22412),s=a(396901),l=a(732297),c=a(495457),d=a(205805);const u=(e,t)=>{const a=(0,s.useTypedDispatch)(),u=(0,d.useCallsSDK)(),p=(0,i.useIsGroupCall)(),{localDevice:_,externalId:m,participants:h,devices:g,me:A,callData:C,peer:v}=e,f=(0,n.useMemo)((()=>{if(!p||!(0,o.participantIsAdmin)(_))return!1;if(m){var t;if(!!(null==(t=e.maps.vkIdToDevices.get(+m.id))?void 0:t.size))return!1}const{admins:a,users:n}=(0,o.getNonAnonymousConnectParticipantsCount)();return!!n&&!a}),[p,_.roles,m,h,g,A]),S=(0,n.useMemo)((()=>(null==C?void 0:C.canFinishCall)||p&&0===v&&(0,o.isCreator)(_)),[C,p,v,_]);return{canTransferAdminRights:f,showTransferAdminRightsDialog:(0,n.useCallback)((()=>{a({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_TRANSFER_ADMIN_RIGHTS})}),[]),canFinishCall:S,showLeaveBox:(0,n.useCallback)((()=>{a({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_EXIT})}),[]),leaveCall:(0,n.useCallback)((()=>{u.hangup(),l.callStats.logEvent({call_event_type:r.CallActionEventType.CALL_DECLINED_OR_HANGED_LOCALLY,session_id:C.callId,peer_id:v,is_group_call:(0,c.isGroupCallByPeer)(v),reason:"none",group_call_users_count:t})}),[C.callId,v,t])}}},680093:(e,t,a)=>{"use strict";a.d(t,{useMuteWatchTogetherHandlers:()=>p});var n=a(667294),o=a(464380),i=a(773816),r=a(490287),s=a(808474),l=a(496111),c=a(750845),d=a(465768),u=a(743679);function p({SDK:e}){const{handleMoviePause:t,handleRemoveMovie:a}=(0,s.useMovieShareActions)(),p=(0,r.useTypedSelector)((e=>e.onlyAdminCanShareMovie)),_=(0,r.useTypedSelector)(u.getWatchTogetherInfo),m=(0,c.useSharedMovieParticipant)(),h=(0,n.useCallback)((()=>{(null==_?void 0:_.movieId)&&a(_.movieId)}),[null==_?void 0:_.movieId,a]),g=(0,n.useCallback)((e=>{(null==_?void 0:_.movieId)&&!e&&m&&!(0,l.participantIsAdmin)(m)&&t(_.movieId)}),[null==_?void 0:_.movieId,t,m]),A=(0,n.useCallback)((()=>{const t=p?[]:[o.UserRole.ADMIN,o.UserRole.CREATOR];e.enableFeatureForRoles(o.ConversationFeature.MOVIE_SHARE,t).then((()=>g(p))).catch(d.handlePromiseError)}),[p,g]);return{handleMuteWatchTogetherParticipant:(0,n.useCallback)((e=>{const t=i.MuteStatesHandler.isMediaAllowed("movieSharing",e);(0,o.muteParticipant)({externalId:e.externalId,muteStates:{[o.MediaOption.MOVIE_SHARING]:t?o.MuteState.MUTE_PERMANENT:o.MuteState.UNMUTE}}).catch(d.handlePromiseError)}),[h]),handleMuteWatchTogetherParticipants:A}}},167810:(e,t,a)=>{"use strict";a.d(t,{NavigationContext:()=>o,useNavigationContext:()=>i});var n=a(667294);const o=(0,n.createContext)({navigateToConvo:e=>{},navigateToProfile:(e,t,a)=>{}}),i=()=>(0,n.useContext)(o)},845301:(e,t,a)=>{"use strict";a.d(t,{useOnboarding:()=>c});var n=a(667294),o=a(22412),i=a(396901),r=a(490287),s=a(573743),l=a(97547);const c=()=>{const e=(0,i.useTypedDispatch)(),t=(0,s.useOnboardingFeature)(),{featureType:a,isOnboardingBannerOpen:c}=(0,r.useTypedSelector)((e=>e.onboarding)),d=(0,n.useCallback)((t=>{e({type:o.E_ACTION.SET_ONBOARDING_FEATURE,data:t})}),[]),u=(0,n.useCallback)((()=>{e({type:o.E_ACTION.SET_ONBOARDING_BANNER_IS_OPEN,data:!0})}),[]),p=(0,n.useCallback)((()=>{l.onboardingStorage.setUsedFeature(a),e({type:o.E_ACTION.SET_ONBOARDING_BANNER_IS_OPEN,data:!1})}),[a]);return(0,n.useEffect)((()=>(t&&(d(t),u()),()=>{l.onboardingStorage.setPreviousBanner(t)})),[]),{isOnboardingBannerOpen:c,onboardingFeature:a,openOnboardingBanner:u,closeOnboardingBanner:p,setOnboardingFeature:d}}},573743:(e,t,a)=>{"use strict";a.d(t,{useOnboardingFeature:()=>c});var n=a(22412),o=a(490287),i=a(737598),r=a(97547),s=a(496111),l=a(504580);const c=()=>{const e=(0,o.useTypedSelector)((e=>e.me)),{sferum:t,enableVmoji:a}=(0,o.useTypedSelector)((e=>e.config)),c=(0,o.useTypedSelector)((e=>e.vmojiSettings.isCapture)),d=!t,u=(0,l.isBrowserSupported)()&&Boolean(a)&&!t&&!(0,s.isParticipantAnonym)(e),p=r.onboardingStorage.getUsedFeature(n.E_ONBOARDING_FEATURES.watchTogether),_=r.onboardingStorage.getUsedFeature(n.E_ONBOARDING_FEATURES.reactions),m=r.onboardingStorage.getUsedFeature(n.E_ONBOARDING_FEATURES.vmoji)||c,h=(0,i.useIsMeCanManageWatchTogether)(),g=[n.E_ONBOARDING_FEATURES.watchTogether,n.E_ONBOARDING_FEATURES.reactions,n.E_ONBOARDING_FEATURES.vmoji],A={[n.E_ONBOARDING_FEATURES.watchTogether]:!p&&d&&h&&!(0,s.isParticipantAnonym)(e),[n.E_ONBOARDING_FEATURES.reactions]:!_&&!1,[n.E_ONBOARDING_FEATURES.vmoji]:!m&&u},C=r.onboardingStorage.getPreviousBanner(),v=C&&g.findIndex((e=>e===C));let f=null,S=null;const E=g.map(((e,t)=>{const a=A[e];return{featureType:e,isAvailable:a,isPrev:e===C,isCanBeNext:"number"==typeof v&&v>-1?a&&v<t:a}}));for(const e of E)!f&&e.isCanBeNext&&(f=e.featureType),!S&&e.isAvailable&&(S=e.featureType);return f||S}},663187:(e,t,a)=>{"use strict";a.d(t,{useOratorExternalId:()=>r});var n=a(490287),o=a(496111),i=a(743679);const r=()=>{const e=(0,n.useTypedSelector)((e=>e.adminPinnedParticipant)),t=(0,n.useTypedSelector)(i.getWatchTogetherPinnedParticipant),a=(0,n.useTypedSelector)((e=>e.screenSharingPinnedParticipant)),r=(0,n.useTypedSelector)((e=>e.pinnedParticipant)),s=(0,n.useTypedSelector)((e=>e.orator)),l=(0,n.useTypedSelector)((e=>e.externalId));return(0,o.getFirstMatchedId)(e,t,a,r,s,l)}},190653:(e,t,a)=>{"use strict";a.d(t,{useOwnerOptions:()=>r});var n=a(667294),o=a(162532),i=a(465768);const r=(e={})=>{const{initialOptions:t}=e,[a,r]=(0,n.useState)([]);return(0,n.useEffect)((()=>{a.length||(0,o.getGroupsForCall)().then((({count:e,items:a})=>{const n=t||[];e>0&&(a.forEach((({id:e,name:t=""})=>{n.push({value:-e,label:t})})),r(n))})).catch(i.handlePromiseError)}),[]),{ownerOptions:a}}},553369:(e,t,a)=>{"use strict";a.d(t,{usePriorities:()=>c});var n=a(667294),o=a(871463),i=a(22412),r=a(890713),s=a(234967),l=a(227336);const c=(e,t)=>{const a=(0,s.useDOMElementsSize)(t),c=(0,n.useRef)(new Map),d=(0,r.isUseParticipantListChunk)(t);(0,n.useEffect)((()=>{if(t.mode===i.Mode.CALL){const n=d?(0,r.getParticipantLayoutForChunk)(t,a,c.current):(0,o.getParticipantLayout)(t,a,c.current),i=(0,o.getParticipantsLayoutDiff)(c.current,n);i.length>0&&(c.current=n,e.updateDisplayLayout(i),l.screenShareNotVisibleStat.checkLayoutDiff(i))}else c.current=new Map}),[a.ww,a.wh,a.gw,a.gh,t.peer,t.participants,t.devices,t.localDevice,t.mode,t.uiMode,t.isOratorMode,t.orator,t.pinnedParticipant,t.adminPinnedParticipant,t.screenSharingPinnedParticipant,t.translation,d,t.callData.topology,t.rooms])}},278102:(e,t,a)=>{"use strict";a.d(t,{createResizeObserver:()=>o});var n=a(464380);a(667294);function o(e,t){return new ResizeObserver((a=>{for(const o of a)t&&(0,n.debugMessage)(n.DebugMessageType.LOG,{text:"[useResizeObserver]",entry:o}),null==e||e(o)}))}},692888:(e,t,a)=>{"use strict";a.d(t,{useRoomIdsWithDrat:()=>s});var n=a(667294),o=a(878198),i=a(490287),r=a(438655);const s=()=>{const e=(0,i.useTypedSelector)((e=>e.devices)),t=(0,i.useTypedSelector)((e=>e.rooms.rooms));return(0,n.useMemo)((()=>(0,o.objectReduce)(e,((e,a)=>{var n,o;if(null==(n=a.statusData)||null==(o=n.drat)?void 0:o.state){const n=(0,r.findRelatedRoom)(a.externalId,t);n&&e.add(n.id)}return e}),new Set)),[e,t])}},403236:(e,t,a)=>{"use strict";a.d(t,{useRoomStatus:()=>l});var n=a(667294),o=a(490287),i=a(496111),r=a(878198),s=a(438655);const l=()=>{const e=(0,o.useTypedSelector)((e=>e.externalId)),t=(0,o.useTypedSelector)((e=>e.localDevice)),a=(0,o.useTypedSelector)((e=>e.rooms.rooms)),l=(0,o.useTypedSelector)((e=>e.rooms.roomId)),c=l?a[l]:void 0,d=(0,n.useMemo)((()=>(0,i.participantIsAdmin)(t)&&(0,r.objectSome)(a,(e=>e.active))),[t.roles,a]),u=(0,n.useMemo)((()=>{if(void 0===e||d||l)return null;const t=(0,s.findRelatedRoom)(e,a);return t&&t.active?t.id:null}),[a,l,e,d]);return{room:c,roomIdToReturn:u,canChooseRoomAsAdmin:d,isRoomShown:Boolean(c||u||d)}}},893473:(e,t,a)=>{"use strict";a.d(t,{useRoomsNames:()=>r});var n=a(667294),o=a(878198),i=a(490287);const r=e=>{const t=(0,i.useTypedSelector)((e=>e.rooms));return(0,n.useMemo)((()=>{let a=(0,o.objectMap)(t.rooms,(({name:e})=>e));return e&&(a=a.filter((t=>t!==e))),new Set(a)}),[t,e])}},102241:(e,t,a)=>{"use strict";a.d(t,{useScreenShare:()=>l});var n=a(667294),o=a(22412),i=a(396901),r=a(915961),s=a(205805);const l=()=>{const e=(0,s.useCallsSDK)(),{getLang:t}=(0,r.useLang)(),a=(0,i.useTypedDispatch)(),[l,c]=(0,n.useState)(!1),d=()=>{"MacOS"===e.browser.os()&&"Chrome"===e.browser.browserName()?a({type:o.E_ACTION.ERROR,text:t("calls_error_disabled_screen_sharing_macos_chrome")}):a({type:o.E_ACTION.ERROR,text:t("calls_error_disabled_screen_sharing")})},u=(0,n.useCallback)((()=>e.captureScreen({captureScreen:!1,captureAudio:!1,fastScreenSharing:!1}).catch(d)),[]),p=(0,n.useCallback)(((t=!1)=>e.captureScreen({captureScreen:!0,captureAudio:!0,fastScreenSharing:t}).catch(d)),[]),_=(0,n.useCallback)((()=>{p(!0)}),[p]),m=(0,n.useCallback)((()=>{p()}),[p]),h=(0,n.useCallback)((()=>{c((e=>!e))}),[]);return{handleStartScreenShare:m,handleStartFastScreenShare:_,handleStopScreenShare:u,toggleScreenShareDropdown:h,isScreenShareDropdownShown:l}}},964275:(e,t,a)=>{"use strict";a.d(t,{useSendStatsDataVirtualBackground:()=>s});var n=a(667294),o=a(302617),i=a(419125),r=a(97547);const s=()=>{const{sendStatsData:e}=(0,o.useSendStatsData)(),t=(0,n.useCallback)(((t,a,n)=>{const{disabledActionType:o,prevSendValue:r,effectDuration:s}=(0,i.mapPrevVirtualBackgroundData)(t,a,n);null!==o&&e(o,{background_id:r,background_duration:s})}),[e]),a=(0,n.useCallback)(((a,n)=>{const i=Date.now(),s=r.effectStorage.getEffectTs();let l;s&&t(n,i,s),l=a>4e3?o.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_SELECTED:o.ECallActionEventType.VIRTUAL_BACKGROUND_SELECTED,e(l,{background_id:a}),r.effectStorage.saveEffectTs(i)}),[e,t]),s=(0,n.useCallback)((e=>{const a=r.effectStorage.getEffectTs();if(!a)return;const n=Date.now();t(e,n,a),r.effectStorage.clearEffectTs()}),[t]),l=(0,n.useCallback)((t=>{e(o.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_ADDED,{background_id:t})}),[e]);return{sendVirtualBackgroundSelected:a,sendVirtualBackgroundDisabled:s,sendVirtualBackgroundDeleted:(0,n.useCallback)((t=>{e(o.ECallActionEventType.CUSTOM_VIRTUAL_BACKGROUND_DELETED,{background_id:t})}),[e]),sendVirtualBackgroundAdded:l}}},731905:(e,t,a)=>{"use strict";a.d(t,{useSetEffectsLsAppType:()=>r});var n=a(667294),o=a(490287),i=a(97547);const r=()=>{const e=(0,o.useTypedSelector)((e=>!!e.config.sferum));(0,n.useMemo)((()=>{const t=e?i.EEffectAppType.Sferum:i.EEffectAppType.VkCalls;i.EffectAppType.setAppType(t)}),[e])}},750845:(e,t,a)=>{"use strict";a.d(t,{useSharedMovieParticipant:()=>i});var n=a(490287),o=a(743679);const i=()=>{const e=(0,n.useTypedSelector)(o.getWatchTogetherOwner),t=(0,n.useTypedSelector)((e=>e.participants));return e?t[e.id]:null}},516186:(e,t,a)=>{"use strict";a.d(t,{getLSSkipJoinCallPrompt:()=>c,useSkipJoinCallPrompt:()=>l});var n=a(667294),o=a(22412),i=a(97547),r=a(162532),s=a(465768);const l=()=>{const[e,t]=(0,n.useState)(c),a=(0,n.useCallback)((()=>{i.videoOptionsStorage.saveOption(o.EVideoOptionType.IS_SKIP_JOIN_CALL_PROMPT,!e),t(!e),(0,r.callsSetUserSettings)({skip_join_screen:e?0:1}).catch(s.handlePromiseError)}),[e]);return{on:e,toggle:a}};function c(){return!!i.videoOptionsStorage.queryOption(o.EVideoOptionType.IS_SKIP_JOIN_CALL_PROMPT)}},670401:(e,t,a)=>{"use strict";a.d(t,{useSwitchRoom:()=>i});var n=a(205805),o=a(667294);const i=()=>{const e=(0,n.useCallsSDK)();return(0,o.useCallback)((t=>e.switchRoom(t)),[])}},326732:(e,t,a)=>{"use strict";a.d(t,{useSwitchRoomHandler:()=>c});var n=a(667294),o=a(50533),i=a(22412),r=a(954982),s=a(396901),l=a(670401);const c=({onClick:e}={})=>{const t=(0,l.useSwitchRoom)(),a=(0,r.useIsSharedMovieOwner)(),c=(0,s.useTypedDispatch)();return(0,n.useCallback)(((n=null)=>{null==e||e(),a?(0,o.batch)((()=>{c({type:i.E_ACTION.TOGGLE_POPUP,data:i.POPUP_ROOM_LEAVE_REMOVE_WATCH_TOGETHER}),c({type:i.E_ACTION.SET_TARGET_SWITCHED_ROOM,data:n})})):t(n)}),[e,t,a])}},870179:(e,t,a)=>{"use strict";a.d(t,{useTimeout:()=>o});var n=a(667294);function o(){const e=(0,n.useRef)(null),t=(0,n.useCallback)((()=>{e.current&&(clearTimeout(e.current),e.current=null)}),[]),a=(0,n.useCallback)(((a,n)=>{t(),e.current=setTimeout((()=>{a(),t()}),n)}),[t]),o=(0,n.useCallback)((()=>!!e.current),[]);return(0,n.useEffect)((()=>t),[]),{add:a,clear:t,timeout:e,isTimeout:o}}},396901:(e,t,a)=>{"use strict";a.d(t,{E_ACTION:()=>o.E_ACTION,useTypedDispatch:()=>i});var n=a(50533),o=a(22412);const i=()=>(0,n.useDispatch)()},490287:(e,t,a)=>{"use strict";a.d(t,{useTypedSelector:()=>n});const n=a(50533).useSelector},662603:(e,t,a)=>{"use strict";a.d(t,{useUserBackgrounds:()=>d});var n=a(667294),o=a(396901),i=a(162532),r=a(22412),s=a(964275),l=a(582422),c=a(465768);const d=({photos:e,onSuccessPhotoUpload:t,isSferum:a})=>{const d=(0,o.useTypedDispatch)(),{sendVirtualBackgroundAdded:p,sendVirtualBackgroundDeleted:_}=(0,s.useSendStatsDataVirtualBackground)(),{isAnonymous:m}=(0,l.useIsAnonymous)(),h=(0,n.useRef)([]),[g,A]=(0,n.useState)(!1);(0,n.useEffect)((()=>{e.length||m||a||(0,i.photosGetAllImages)().then((e=>{d({type:r.E_ACTION.VB_SET_USER_PHOTOS,photos:u(e.items||[])})})).catch(c.handlePromiseError)}),[]);const C=(0,n.useCallback)((t=>{const a=e.find((e=>e.id===t));a&&(h.current.push(a),d({type:r.E_ACTION.VB_REMOVE_USER_PHOTO,photoId:t}))}),[e]),v=(0,n.useCallback)((()=>{const e=h.current;return h.current=[],function(e,t){const a=e.map((e=>(0,i.photosDelete)({photo_id:e.id})));return Promise.allSettled(a).then((a=>{a.forEach(((a,n)=>{"fulfilled"===a.status&&t(e[n].id)}))})).catch(c.handlePromiseError)}(e,_)}),[_]),f=(0,n.useCallback)((()=>{const t=h.current;h.current=[];const a=e.concat(t);d({type:r.E_ACTION.VB_SET_USER_PHOTOS,photos:u(a)})}),[e]),S=(0,n.useCallback)((e=>(A(!0),(0,i.photosSaveBackgroundPhoto)(e).then((e=>{const a=e[0];if(!a)throw new Error("Something wrong with uploaded photo");return d({type:r.E_ACTION.VB_ADD_USER_PHOTO,photo:a}),t(a),p(a.id),a})).finally((()=>{A(!1)})))),[t,p]);return{photos:e,onAddBackground:S,onDeleteBackground:C,onSaveSettings:v,onCancelSettings:f,loadingUpload:g}};function u(e){return e.sort(((e,t)=>e.date<t.date?1:-1))}},342908:(e,t,a)=>{"use strict";a.d(t,{useUserMediaStream:()=>l});var n=a(667294),o=a(151582),i=a(428009),r=a(776047);const s=e=>{e.getTracks().forEach((e=>e.stop()))},l=e=>{const[t,a]=(0,n.useState)(null),[l,c]=(0,n.useState)(!1),d=(0,n.useRef)(!1),u=(0,o.useIsMounted)(),p=(0,n.useCallback)((()=>{if(!d.current)return c(!1),d.current=!0,e().then((e=>{u()?a(e):s(e)})).catch((e=>{a(null),c(e)})).finally((()=>{d.current=!1}))}),[e]);return(0,n.useEffect)((()=>(p(),i.eventBus.on(r.EEventType.onDeviceChange,p),()=>{i.eventBus.off(r.EEventType.onDeviceChange,p)})),[p]),(0,n.useEffect)((()=>()=>{t&&s(t)}),[t]),{userStream:t,error:l,updateUserMediaStream:p}}},266247:(e,t,a)=>{"use strict";a.d(t,{EVideoOptionType:()=>s.EVideoOptionType,useVideoOptions:()=>d});var n=a(434788),o=a(667294),i=a(50533),r=a(396901),s=a(22412),l=a(97547),c=a(659397);const d=()=>{const e=(0,i.useSelector)((e=>e.virtualBackgroundSettings.videoOptions)),t=(0,r.useTypedDispatch)(),[a,d]=(0,o.useState)(l.videoOptionsStorage.getOptions),u=(0,o.useCallback)((()=>{d(l.videoOptionsStorage.getOptions())}),[]),p=(0,o.useCallback)((()=>{l.videoOptionsStorage.saveOptions(a),t({type:s.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[a]),_=(0,o.useCallback)(((e,t)=>{d((a=>(0,n._)({},a,{[e]:t})))}),[]);return(0,o.useEffect)((()=>{(0,c.isEqual)(e,a)||t({type:s.E_ACTION.VB_SET_VIDEO_OPTIONS,videoOptions:a})}),[]),{videoOptions:a,storedVideoOptions:e,setVideoOptions:d,onRestoreSettings:u,onSaveSettings:p,onChangeVideoOption:_}}},49339:(e,t,a)=>{"use strict";a.d(t,{StarFilled:()=>r});var n=a(434788),o=a(512796),i=a(785893);const r=e=>{var t=(0,n._)({},(0,o._)(e));return(0,i.jsx)("svg",(0,n._)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t,{children:(0,i.jsx)("path",{d:"M14 21.5l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4L14 21.5z"})}))}},69813:(e,t,a)=>{"use strict";a.d(t,{StarOutline:()=>r});var n=a(434788),o=a(512796),i=a(785893);const r=e=>{var t=(0,n._)({},(0,o._)(e));return(0,i.jsx)("svg",(0,n._)({height:"28",width:"28",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor"},t,{children:(0,i.jsx)("path",{d:"M14 19.2l5.7 3.5a.2.2 0 00.3-.3L18.4 16l5.1-4.3a.2.2 0 00-.1-.4l-6.7-.5-2.5-6.1a.2.2 0 00-.4 0l-2.5 6.1-6.7.5a.2.2 0 00-.1.4l5 4.3L8 22.4a.2.2 0 00.3.3zm0 2.3l-4.6 2.9A2.2 2.2 0 016 22l1.2-5.3L3.2 13a2.2 2.2 0 011.2-3.8l5.5-.5 2-5a2.2 2.2 0 014.1 0l2.1 5 5.5.5a2.2 2.2 0 011.2 3.8l-4.1 3.6 1.2 5.3a2.2 2.2 0 01-3.3 2.4z"})}))}},621666:(e,t,a)=>{"use strict";a.d(t,{init:()=>B});var n=a(434788),o=a(785893),i=a(973935),r=a(659397),s=a(869048),l=a(307696),c=a(966606),d=a(888385),u=a(151635),p=a(3264),_=a(464380),m=a(346880),h=a(796317),g=a(301869),A=a(732297),C=a(760281),v=a(14890),f=a(759083),S=a(9609),E=a(50533),T=a(22412),I=a(455319),y=a(659956),N=a(367423),b=a(144650),x=a(167810),M=a(645022),O=a(694379),P=a(971),R=a(941596),k=a(97547),w=a(783492),D=a(465768),L=a(495457),j=a(516186);a(162532);function B({actionStatCollector:e,saveStatlogEvents:t,langUtils:a,navigateToConvo:B,navigateToProfile:H,apiWrapperWithAuth:F,apiWrapper:V,callSounds:G,config:W={debugLog:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,incomingCall:!1,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:T.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableParticipantListChunk:!1,screenShareCongestionControl:!1,enableAudioShare:!1,enableRoomControl:!1,enableChangeName:!1},eventHandlers:$,streamUrlExtractor:z,removeLeftMenuItemBadge:Z=r.noop,notifierGetter:K,isVkme:Q=!1,VKComKitModal:Y}){(0,d.setApiWrappers)(F,V);const q={navigateToConvo:B,navigateToProfile:H};return{initialized:!1,initializing:!1,eventHandlers:null!=$?$:{},VKComKitModal:Y,notifierGetter:K,init({callPreview:s,callsCredentials:c,imHash:d,callsOkStaging:y,tabIsMaster:N,onBeforeCallStart:b,onAfterCallFinish:M,onError:L,toggles:B={},friends:H,isFriend:F,getFriends:V,pushToTalkEnabled:Z}){var K;if(this.initialized)return this.initializing;if(!(null==c?void 0:c.me))return console.log("Calls were not initialized as there are no callsCredentials.me"),!1;this.initialized=!0,this.isFriend=F,this.getFriends=V;const Y=(0,n._)({},W,B,{customExternalDomain:k.customExternalDomainStorage.getValue()});if(!_.browser.isBrowserSupported()){const e=()=>{const e=a.getLang("calls_unsupported_browser_error");return L&&L({msg:e}),(null==$?void 0:$.onError)&&$.onError(new Error(e)),console.error(e),Promise.resolve(void 0)};return this.call=e,this.startGroupCall=e,this.startCall=e,this.acceptCall=e,this.joinCallByLink=e,this.showJoinPopup=e,this.showCallByNamePopup=e,this.showCreateCallByLinkPopup=e,void(this.showPlanCalendarEventPopup=e)}this.id=window.vk&&window.vk.id||c.me.peerId;const J=N||(()=>!0);var X;const ee=null!=(X=r.localStorage.getItem(T.VIDEO_RESOLUTION_STORAGE_KEY))?X:T.VideoResolutionTypes.SD,te=(null==(K=c.me.animated_avatar)?void 0:K.url)&&null!==r.localStorage.getItem(T.VMOJI_CAPTURE_STORAGE_KEY);P.GlobalStore.setCallsStore((0,v.createStore)(S.callsReducer,(0,f.getInitialState)(c.me,d,s,{isDev:!!c.is_dev,token:c.secret,config:Y,localVideoResolution:Y.fullHD?ee:ee===T.VideoResolutionTypes.HD?T.VideoResolutionTypes.HD:T.VideoResolutionTypes.SD,friends:H||[],friendsCache:(0,I.createFriendsCache)(H||[]),ipSettingEnabled:c.ip_setting_enabled,privacySettings:c.privacySettings,pushToTalkEnabled:Z,isVmojiCapture:te}),null==window.__REDUX_DEVTOOLS_EXTENSION__?void 0:window.__REDUX_DEVTOOLS_EXTENSION__()));const ae=P.GlobalStore.getCallsStore();this.collapseCall=()=>{_.debugMessage(_.DebugMessageType.WARN,{message:"[external] bridge.collapseCall called"}),(0,R.handleCollapseCall)({uiMode:ae.getState().uiMode,changeUIMode:e=>{ae.dispatch({type:T.E_ACTION.CHANGE_UI_MODE,mode:e})}}),ae.dispatch({type:T.E_ACTION.MANAGEMENT,isOpen:!1})},this.restoreCall=()=>{ae.dispatch({type:T.E_ACTION.CHANGE_UI_MODE,mode:T.UIMode.DEFAULT})},this.showStartCallModal=(e,t,a,n)=>{this.isInActiveCall||ae.dispatch({type:T.E_ACTION.CHANGE_MODE,mode:T.Mode.START,peerId:e,joinLink:t,entryPoint:a,isDisableStartCallModalCheckbox:n})},this.joinOrStartCallModal=(e,t,a)=>{Y.enableSkipJoinScreenFeature&&(0,j.getLSSkipJoinCallPrompt)()?this.joinCallByLink(t,void 0,!1,a):this.showStartCallModal(e,t)},this.setPlannedCalendarEvent=e=>{ae.dispatch({type:T.E_ACTION.SET_PLANNED_CALENDAR_EVENT,data:e}),ae.dispatch({type:T.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:T.POPUP_SHARE_PLANNED_CALL})},t&&(0,g.setStatlogEventsHandler)(t),e&&A.callStats.setActionStatCollector(e),i.render((0,o.jsx)(E.Provider,{store:ae,children:(0,o.jsx)(x.NavigationContext.Provider,{value:q,children:(0,o.jsx)(m.LangContext.Provider,{value:a,children:(0,o.jsx)(h.ConfigContext.Provider,{value:Y,children:(0,o.jsx)(C.WaitingContainer,{})})})})}),U("calls"));const ne=(0,w.fetchUserSettings)();return this.initializing=(0,p.sdkService)(this,_,c,ae,a.getLang,y).catch(D.handlePromiseError).then((()=>ne)).then((()=>{(0,u.longpollService)(this,_,a.getLang,ae);const e=U("calls");i.unmountComponentAtNode(e),i.render((0,o.jsx)(E.Provider,{store:ae,children:(0,o.jsx)(x.NavigationContext.Provider,{value:q,children:(0,o.jsx)(m.LangContext.Provider,{value:a,children:(0,o.jsx)(h.ConfigContext.Provider,{value:Y,children:(0,o.jsx)(O.VkmeContext.Provider,{value:{isVkme:Q,vkmeHistoryCallsContainerElement:null},children:(0,o.jsx)(l.App,{bridge:this,SDK:_,tabIsMaster:J,onBeforeCallStart:b,onAfterCallFinish:M,callSounds:G,onHandCountChanged:null==$?void 0:$.onHandCountChanged,onSuccessFeedback:null==$?void 0:$.onSuccessFeedback,okPublicKey:c.key,config:Y,streamUrlExtractor:z})})})})})}),e)})),this.initializing.catch((e=>{if(null==$?void 0:$.onError){const t=e?e.message||e.msg:"sdk did not send the reasons for the error",a=e?e.error:"";[401].includes(a)||$.onError(new Error(`Could not init calls. ${t}: ${a}`))}console.error("Could not init calls",e.error,e)}))},showJoinScreen(r,s,l,d,u,p,C=!1,f=!1){const S=(0,y.createInvokeErrorWrapper)(d,$);if(!_.browser.isBrowserSupported())return S(a.getLang("calls_unsupported_browser_error"));(0,g.setStatlogEventsHandler)(t),A.callStats.setActionStatCollector(e);const{callsAllowCallByName:I,callsEnableAnonymPhoto:N,callEnableChangeName:b,callParticipantMe:M}=r,O=document.querySelector(s),P=(0,n._)({},W,{allowCallByName:I,anonymPhoto:N,enableChangeName:b}),R=(null==M?void 0:M.id)||0,k=(0,v.createStore)((()=>({me:null==M?void 0:M.id,participants:{[R]:{firstName:M.first_name,lastName:M.last_name,peerId:M.id}},callByName:{callId:r.callId}})),{},null==window.__REDUX_DEVTOOLS_EXTENSION__?void 0:window.__REDUX_DEVTOOLS_EXTENSION__());f&&A.callStats.logEvent({call_event_type:T.CallActionEventType.SKIP_DESKTOP_JOIN_SCREEN,session_id:r.callId,peer_id:R,is_group_call:(0,L.isGroupCallByPeer)(R)}),i.render((0,o.jsx)(E.Provider,{store:k,children:(0,o.jsx)(x.NavigationContext.Provider,{value:q,children:(0,o.jsx)(m.LangContext.Provider,{value:a,children:(0,o.jsx)(h.ConfigContext.Provider,{value:P,children:(0,o.jsx)(c.JoinScreenContainer,(0,n._)({},r,{withPopup:C,bridge:this,entryPoint:l,onError:S,okPublicKey:u,onClose:p}))})})})}),O)},showHistoryScreen(e,n={},r=!0){var l,c;const d=(0,y.createInvokeErrorWrapper)(void 0,$);if(!_.browser.isBrowserSupported())return d(a.getLang("calls_unsupported_browser_error"));(0,g.setStatlogEventsHandler)(t);const u=(0,v.createStore)(N.historyScreenReducer,(0,f.getHistoryScreenInitialState)(n,W),null==window.__REDUX_DEVTOOLS_EXTENSION__?void 0:window.__REDUX_DEVTOOLS_EXTENSION__()),p=document.querySelector(e),A={bridge:this,SDK:_};i.render((0,o.jsx)(s.AppRootProvider,{children:(0,o.jsx)(E.Provider,{store:u,children:(0,o.jsx)(M.BaseObjectsContext.Provider,{value:A,children:(0,o.jsx)(x.NavigationContext.Provider,{value:q,children:(0,o.jsx)(m.LangContext.Provider,{value:a,children:(0,o.jsx)(h.ConfigContext.Provider,{value:W,children:(0,o.jsx)(O.VkmeContext.Provider,{value:{isVkme:Q,vkmeHistoryCallsContainerElement:p},children:(0,o.jsx)(b.default,{})})})})})})})}),p),r&&Z(),null==(l=window.cur)||null==(c=l.destroy)||c.push((()=>{p&&i.unmountComponentAtNode(p)}))},debug:!1,setDebug(e){this.debug=e,_.debug(e)}}}function U(e){const t=document.getElementById(e);if(t)return t;const a=document.createElement("section");return a.setAttribute("id",e),document.body.appendChild(a),a}},916188:(e,t,a)=>{"use strict";a.d(t,{checkPermissions:()=>r});var n=a(11010),o=a(464380);function i(){return(i=(0,n._)((function*(e,t,a){return e.browser.getUserMedia(t,a).then((e=>{e.getTracks().forEach((e=>e.stop()))}))}))).apply(this,arguments)}function r(e,t){const a=e.browser.hasMicrophonePermission(),n=e.browser.hasCameraPermission(),r=t.includes(o.MediaOption.AUDIO)&&!a,s=t.includes(o.MediaOption.VIDEO)&&!n;return r||s?function(e,t,a){return i.apply(this,arguments)}(e,s,r):Promise.resolve()}},686436:(e,t,a)=>{"use strict";a.d(t,{useCallsSDK:()=>i});var n=a(667294),o=a(768978);function i(){const e=(0,n.useContext)(o.CallsSdkContext);if(null===e)throw Error("Calls sdk context has not been Provided!");return e}},205805:(e,t,a)=>{"use strict";a.d(t,{CallsSdkProvider:()=>n.CallsSdkProvider,useCallsSDK:()=>o.useCallsSDK});var n=a(931819),o=a(686436)},768978:(e,t,a)=>{"use strict";a.d(t,{CallsSdkContext:()=>n});const n=(0,a(667294).createContext)(null)},931819:(e,t,a)=>{"use strict";a.d(t,{CallsSdkProvider:()=>i});var n=a(785893),o=a(768978);function i({SDK:e,children:t}){return(0,n.jsx)(o.CallsSdkContext.Provider,{value:e,children:t})}},367423:(e,t,a)=>{"use strict";a.d(t,{historyScreenReducer:()=>i});var n=a(434788),o=a(939723);function i(e,t){switch(t.type){case o.HistoryScreenActionTypes.DELETE_CALL:return(0,n._)({},e,{deleteCallId:t.data});case o.HistoryScreenActionTypes.SET_CURRENT_CALLS:return(0,n._)({},e,{currentCalls:t.data});case o.HistoryScreenActionTypes.SET_HISTORY_CALLS:return(0,n._)({},e,{historyCalls:t.data});case o.HistoryScreenActionTypes.SET_PROFILES:return(0,n._)({},e,{profiles:(0,n._)({},e.profiles,t.data)});case o.HistoryScreenActionTypes.SET_URLS:return(0,n._)({},e,{joinLinks:(0,n._)({},e.joinLinks,t.data)});case o.HistoryScreenActionTypes.ERROR:return(0,n._)({},e,{error:t.data});case o.HistoryScreenActionTypes.SET_LOADING:return(0,n._)({},e,{loading:t.data});case o.HistoryScreenActionTypes.SET_SHOW_CREATE_BUTTON:return(0,n._)({},e,{showCreateCall:t.data});case o.HistoryScreenActionTypes.SET_SCHEDULED_CALLS:return(0,n._)({},e,{scheduledCalls:t.data?(0,n._)({},e.scheduledCalls||{},t.data):void 0});case o.HistoryScreenActionTypes.SET_SCHEDULED_CALLS_PREVIEW:return(0,n._)({},e,{scheduledCallsPreview:t.data?(0,n._)({},e.scheduledCallsPreview||{},t.data):void 0});case o.HistoryScreenActionTypes.SET_POPUP:return(0,n._)({},e,{popup:t.data});case o.HistoryScreenActionTypes.SET_SCHEDULED_EDITABLE_CALL:return(0,n._)({},e,{scheduledEditableCall:t.data});case o.HistoryScreenActionTypes.SET_CALLS_QUEUE_RESPONSE:return(0,n._)({},e,{callsQueueResponse:t.data});default:return e}}},759083:(e,t,a)=>{"use strict";a.d(t,{getHistoryScreenInitialState:()=>l,getInitialState:()=>s});var n=a(434788),o=a(22412),i=a(464380),r=a(495457);const s=(e,t,a,s)=>{const{isDev:l=!1,token:c,config:d={debugLog:!1,incomingCall:!1,streaming:!0,streamingPrivacy:!0,fullHD:!1,anonymPhoto:!0,showFeedbackScreen:!1,enableVideoSlots:!1,videoSlotsCount:o.VIDEO_SLOTS_COUNT,browserWarnings:null,allowCallByName:!1,enableScreenTrack:!1,enableProducerScreenTrack:!1,badNetworkP2P:!1,desktopAppNotification:!1,sferum:!1,lazyLoading:!1,enableDomainBender:!1,enableMultipleDevices:!1,enableParticipantListChunk:!1,enableAudioShare:!1,enableRoomControl:!1,enableChangeName:!1},localVideoResolution:u=o.VideoResolutionTypes.SD,friends:p=[],friendsCache:_,privacySettings:m,ipSettingEnabled:h,pushToTalkEnabled:g=!1,friendsCount:A,isVmojiCapture:C=!1}=s,v=window.vk&&window.vk.id||e.peerId;return{anonymSecret:c,me:v,groupId:0,mode:o.Mode.READY,peer:0,participants:{[v]:(0,n._)({},e)},devices:{},localDevice:{mediaSettings:{isAudioEnabled:!0,isVideoEnabled:!1,isScreenSharingEnabled:!1,isAnimojiEnabled:!1,videoStreams:[]},statusData:{hand:{state:!1,ts:Date.now()},drat:{state:!1,ts:Date.now()}},networkStatus:1,roles:[],permissions:{audio:i.MuteState.UNMUTE,video:i.MuteState.UNMUTE,screenSharing:i.MuteState.UNMUTE},status:i.ParticipantStatus.WAITING},callData:{type:null,ts:null,localTimeStamp:null,conversation:a},imHash:t,isDev:l,popup:null,uiMode:o.UIMode.DEFAULT,orator:null,adminPinnedParticipant:null,screenSharingPinnedParticipant:null,screenSharingNeedDisableOratorModeAfterStop:!0,screenSharingOldPinnedParticipant:null,pinnedParticipant:null,screenSharers:{},isShownParticipantsAside:!0,isOratorMode:!0,chatMembers:[],groupMembers:[],groupMembersCount:0,preselectedIds:null,friends:p,friendsCount:A,speakers:{},speakersInHeader:[],chatUnreadCount:0,chatUpToMsgId:null,tooltips:{chat:!1,hand:!1,screenShare:!1,layout:!1,collapse:!1,fullscreen:!1},participantsAddedByMe:new Set,groupCallSetup:!1,isManagementOpen:!1,notification:null,errorShown:!1,cautionShown:!1,isLoaderVisible:!1,translation:{deferredId:null,isOn:!1},participantsManagement:null,adminAssignment:null,participantKick:null,membersUnban:null,noiseCancellation:o.NoiseCancellationTypes.NEURAL,config:d,localVideoResolution:u,conversationOptions:[],privacySettings:{callsIp:(null==m?void 0:m.callsIp)||"friends"},friendsCache:_||{},groupMembersCache:{},unableToCallGroupMembersIds:[],ipSettingEnabled:h||!1,isIncoming:!1,pushToTalkEnabled:g,gridScrollPosition:0,gridScrollFirstVisible:0,oratorScrollPosition:0,oratorScrollFirstVisible:0,oratorScrollNumberOfVisible:5,callsCount:(0,r.getCallsCount)(),shouldShowDesktopAppNotification:!1,shouldShowWarningDesktopAppNotification:!0,virtualBackgroundSettings:{photos:[],videoOptions:{}},permissions:{},maps:{vkIdToDevices:new Map},rooms:{roomId:o.ROOM_MAIN_ID,roomChatIds:{},rooms:{},roomParticipantIds:{}},onlyAdminCanShareMovie:!1,onboarding:{featureType:null,isOnboardingBannerOpen:!1},vmojiSettings:{isCapture:C,participantIdsToUpdateSvg:[]},asr:null,watchTogether:null,featureEndedNotification:null}},l=(e,t)=>{var a,o;return{meId:null!=(a=e.meId)?a:0,currentCalls:[],historyCalls:[],deleteCallId:-1,profiles:{},joinLinks:{},isDev:null!=(o=e.isDev)&&o,error:null,loading:!0,showCreateCall:!0,config:(0,n._)({},t,e.config||{})}}},9609:(e,t,a)=>{"use strict";a.d(t,{callsReducer:()=>_});var n=a(434788),o=a(22412),i=a(759083),r=a(1628),s=a(455319),l=a(464380),c=a(496111),d=a(659397),u=a(438655),p=a(878198);function _(e,t){switch(t.type){case o.E_ACTION.LOAD_PEERS:{const a=t.conversation||e.callData.conversation,o={};for(const a of t.members)a&&a.peerId&&(o[a.peerId]=(0,n._)({},e.participants[a.peerId]||{},a));return(0,n._)({},e,{participants:(0,n._)({},e.participants,o),callData:(0,n._)({},e.callData,{conversation:a}),peer:"peerId"in t&&void 0!==t.peerId?t.peerId:e.peer,caller:"caller"in t?t.caller:e.caller})}case o.E_ACTION.CHANGE_MODE:{var a;const r=t.mode!==o.Mode.READY&&t.data&&t.data.type?t.data.type:null;if(t.mode===o.Mode.READY||t.mode===o.Mode.FEEDBACK){var _;const a=e.callData&&e.callData.conversation,r=(0,i.getInitialState)(e.participants[e.me],e.imHash,a,{token:e.anonymSecret,config:e.config,localVideoResolution:e.localVideoResolution,friends:e.friends,friendsCache:e.friendsCache,friendsCount:e.friendsCount,privacySettings:e.privacySettings,ipSettingEnabled:e.ipSettingEnabled,isDev:e.isDev});var A,C,v,f;if(t.mode===o.Mode.FEEDBACK)r.mode=o.Mode.FEEDBACK,r.lastCallData={callId:null!=(C=null==(A=e.callData)?void 0:A.callId)?C:"",peerId:null!=(v=e.peer)?v:0};if(r.virtualBackgroundSettings=e.virtualBackgroundSettings,r.vmojiSettings=e.vmojiSettings,r.misc=e.misc,(null==(_=e.reactions)?void 0:_.reactions)&&(r.reactions={reactions:e.reactions.reactions}),e.hangupType===l.HangupType.BUSY)r.lastCallData=(0,n._)({},r.lastCallData||{},{opponentName:null==(f=e.participants[e.peer])?void 0:f.name});else if(e.hangupType===l.HangupType.KILLED||e.hangupType===l.HangupType.KILLED_WITHOUT_DELETE){var S;r.lastCallData=(0,n._)({},r.lastCallData||{},{isMeEndedCallForAll:null==(S=e.lastCallData)?void 0:S.isMeEndedCallForAll})}return r}e.maps.vkIdToDevices.clear();const s=(0,n._)({},e,{mode:t.mode,peer:"peerId"in t&&void 0!==t.peerId?t.peerId:e.peer,callData:(0,n._)({},e.callData,{type:r,ts:t.ts||e.callData.ts||null,isDisableStartCallModalCheckbox:t.isDisableStartCallModalCheckbox}),hangupType:e.hangupType,entryPoint:t.entryPoint||e.entryPoint,join:(0,n._)({},e.join||{})});return(null==(a=s.reactions)?void 0:a.feedback)&&delete s.reactions.feedback,t.joinLink&&s.join&&(s.join.joinLink=t.joinLink),t.vkJoinLink&&s.join&&(s.join.vkJoinLink=t.vkJoinLink),s}case o.E_ACTION.HANGUP:return(0,n._)({},e,{hangupType:t.data});case o.E_ACTION.TIME_START:return(0,n._)({},e,{callData:(0,n._)({},e.callData,{ts:t.data})});case o.E_ACTION.LOCAL_TIME_START:return(0,n._)({},e,{callData:(0,n._)({},e.callData,{localTimeStamp:t.data})});case o.E_ACTION.REMOVE_USER:{var E;const a=(0,c.externalIdToString)(t.participantId),o=e.devices[a]?function(e,t){const a=e.devices[t],o={status:void 0,statusData:void 0,wasConnected:void 0,mediaSettings:{}};a.movieStreamInfo&&(o.movieStreamStoppedInfo=a.movieStreamInfo,o.movieStreamInfo=null);return(0,n._)({},e,{devices:(0,n._)({},e.devices,{[t]:(0,n._)({},a,o)})})}(e,a):(0,n._)({},e);if(null==(E=e.maps.vkIdToDevices.get(+t.participantId.id))||E.delete(a),e.screenSharers[a]&&delete o.screenSharers[a],(0,c.isSameExternalId)(e.orator,t.participantId)&&(o.orator=null),(0,c.isSameExternalId)(e.pinnedParticipant,t.participantId)&&(o.pinnedParticipant=null),(0,c.isSameExternalId)(e.adminPinnedParticipant,t.participantId)&&(o.adminPinnedParticipant=null),(0,c.isSameExternalId)(e.screenSharingPinnedParticipant,t.participantId)&&(o.screenSharingPinnedParticipant=null),e.participantsAddedByMe.has(+t.participantId.id)){const a=new Set(e.participantsAddedByMe);a.delete(+t.participantId.id),o.participantsAddedByMe=a}return o}case o.E_ACTION.SET_CHAT_INFO:return(0,n._)({},e,{chatMembers:t.data,chatData:t.conversation});case o.E_ACTION.GROUP_CALL_SETUP:return(0,n._)({},e,{groupCallSetup:t.open,peer:t.peerId||e.peer||0,preselectedIds:t.preselectedIds});case o.E_ACTION.TOGGLE_POPUP:return(0,n._)({},e,{popup:t.data||null,popupData:null==t?void 0:t.popupData});case o.E_ACTION.UPDATE_HASH:return(0,n._)({},e,{imHash:t.hash});case o.E_ACTION.CHANGE_UI_MODE:return(0,n._)({},e,{uiMode:t.mode||o.UIMode.DEFAULT});case o.E_ACTION.TOGGLE_ORATOR_MODE:return(0,n._)({},e,{isOratorMode:t.isOratorMode});case o.E_ACTION.TOGGLE_PARTICIPANTS_ASIDE:return(0,n._)({},e,{isShownParticipantsAside:t.isShownParticipantsAside});case o.E_ACTION.SET_ORATOR:return(0,n._)({},e,{orator:t.orator||null});case o.E_ACTION.SET_PINNED_PARTICIPANT:return(0,n._)({},e,{pinnedParticipant:t.pinnedParticipant});case o.E_ACTION.SET_ADMIN_PINNED_PARTICIPANT:return(0,n._)({},e,{adminPinnedParticipant:t.data});case o.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT:return(0,n._)({},e,{screenSharingPinnedParticipant:t.screenSharingPinnedParticipant,screenSharingNeedDisableOratorModeAfterStop:!!t.screenSharingNeedDisableOratorModeAfterStop,screenSharingOldPinnedParticipant:t.screenSharingOldPinnedParticipant||null});case o.E_ACTION.MANAGEMENT:return(0,n._)({},e,{isManagementOpen:t.isOpen,managementView:t.managementView});case o.E_ACTION.CALL_STATE:{const a=(0,n._)({},e,{callData:(0,n._)({},e.callData,t.callData),join:(0,n._)({},e.join||{}),externalId:t.externalId||e.externalId});return t.joinLink&&a.join&&(a.join.joinLink=t.joinLink),t.vkJoinLink&&a.join&&(a.join.vkJoinLink=t.vkJoinLink),a}case o.E_ACTION.CALL_NOTIFICATION:return(0,n._)({},e,{notification:t.notification});case o.E_ACTION.JOIN:return(0,n._)({},e,{mode:o.Mode.JOIN,join:t.data});case o.E_ACTION.CALL_BY_NAME:return(0,n._)({},e,{mode:o.Mode.CALL_BY,callByName:t.data});case o.E_ACTION.ERROR:return(0,n._)({},e,{mode:t.handleType===o.ErrorHandleType.FATAL?o.Mode.ERROR:e.mode,errorShown:!t.isClosed,error:{title:t.title,text:t.text,handleType:t.handleType,callId:t.callId}});case o.E_ACTION.CHANGE_PARTICIPANT_ROLES:{const a=t.participantId;return(0,n._)({},e,{participants:(0,n._)({},e.participants,{[a]:(0,n._)({},e.participants[a]||{},{roles:t.data})})})}case o.E_ACTION.SET_SCREEN_SHARER:return(0,n._)({},e,{screenSharers:(0,n._)({},e.screenSharers,{[(0,c.externalIdToString)(t.participantId)]:t.isScreenSharingEnabled})});case o.E_ACTION.OFF_SCREEN_SHARERS:{const t=(0,p.deepClone)(e.screenSharers);return(0,p.objectForEach)(t,((e,a)=>{t[a]=!1})),(0,n._)({},e,{screenSharers:t})}case o.E_ACTION.SET_FRIENDS:return(0,n._)({},e,{friends:t.data,friendsCache:(0,s.createFriendsCache)(t.data),friendsCount:t.friendsCount});case o.E_ACTION.SET_GROUP_MEMBERS:return(0,n._)({},e,{groupMembersCount:t.groupMembersCount,groupMembers:t.groupMembers,unableToCallGroupMembersIds:t.unableToCallGroupMembersIds,groupMembersCache:(0,s.createFriendsCache)(t.groupMembers)});case o.E_ACTION.SET_SPEAKERS:{const{speakers:a,speakersInHeader:o}=t.data;return e=(0,n._)({},e,{speakers:a||e.speakers,speakersInHeader:o||e.speakersInHeader})}case o.E_ACTION.UPDATE_PARTICIPANTS_BATCH:return(0,r.applyDevicesBatch)(e,t.data);case o.E_ACTION.REMOVE_DEVICE_FROM_CACHE:{const a=(0,n._)({},e.devices);if(Array.isArray(t.id))for(const e of t.id)delete a[e];else{delete a[t.id]}return(0,n._)({},e,{devices:a})}case o.E_ACTION.SET_UNREAD_COUNT:return(0,n._)({},e,{chatUnreadCount:t.chatUnreadCount,chatUpToMsgId:"chatUpToMsgId"in t?t.chatUpToMsgId:e.chatUpToMsgId});case o.E_ACTION.SHOW_CAUTION_BOX:return(0,n._)({},e,{cautionShown:t.isOpen,isIncoming:t.isIncoming||e.isIncoming});case o.E_ACTION.SHOW_LOADER:return(0,n._)({},e,{isLoaderVisible:t.isLoaderVisible});case o.E_ACTION.SET_ENTRYPOINT:return(0,n._)({},e,{entryPoint:t.entryPoint});case o.E_ACTION.SET_TOOLTIP:{const a=t.tooltips?t.tooltips:Object.keys(e.tooltips).reduce(((e,t)=>(e[t]=!1,e)),{});return(0,n._)({},e,{tooltips:(0,n._)({},e.tooltips,a)})}case o.E_ACTION.MANUAL_ADD_PARTICIPANTS:return(0,n._)({},e,{participantsAddedByMe:(t.participants||[]).reduce(((e,t)=>(e.add(t),e)),new Set(e.participantsAddedByMe))});case o.E_ACTION.SET_TRANSLATION:return(0,n._)({},e,{translation:(0,n._)({},e.translation,t.data)});case o.E_ACTION.UPDATE_ANON_SECRET:return(0,n._)({},e,{anonymSecret:t.secret});case o.E_ACTION.TOGGLE_PARTICIPANTS_KICK:return(0,n._)({},e,{participantKick:t.data?{participant:t.data.participant,type:t.data.type}:null});case o.E_ACTION.UNBAN_PARTICIPANTS:return(0,n._)({},e,{membersUnban:t.data?{members:t.data.members}:null});case o.E_ACTION.TOGGLE_PARTICIPANTS_MANAGEMENT:return(0,n._)({},e,{participantsManagement:t.data?{mode:t.data.mode,device:t.data.device}:null});case o.E_ACTION.TOGGLE_ADMIN_ASSIGNMENT:return(0,n._)({},e,{adminAssignment:t.data?{participant:t.data.participant}:null});case o.E_ACTION.SET_NOISE_CANCELLATION:return(0,n._)({},e,{noiseCancellation:t.data});case o.E_ACTION.CHANGE_LOCAL_VIDEO_RESOLUTION:return(0,n._)({},e,{localVideoResolution:t.data});case o.E_ACTION.SET_CONVERSATION_OPTIONS:return(0,n._)({},e,{conversationOptions:t.data});case o.E_ACTION.SET_PRIVACY_SETTINGS:return(0,n._)({},e,{privacySettings:t.data});case o.E_ACTION.SET_GROUP:return(0,n._)({},e,{groupId:t.groupId,meGroup:t.meGroup});case o.E_ACTION.SET_WAITING_HALL:return(0,n._)({},e,{waitingHall:t.data});case o.E_ACTION.SET_PUSH_TO_TALK_ENABLE:return(0,n._)({},e,{pushToTalkEnabled:t.data});case o.E_ACTION.SET_GRID_SCROLL_POSITION:return(0,n._)({},e,{gridScrollPosition:t.position,gridScrollFirstVisible:t.firstVisible});case o.E_ACTION.SET_ORATOR_SCROLL_POSITION:return(0,n._)({},e,{oratorScrollPosition:t.position,oratorScrollFirstVisible:t.firstVisible,oratorScrollNumberOfVisible:t.numberOfVisible});case o.E_ACTION.SET_SHOW_DESKTOP_NOTIFICATION:return(0,n._)({},e,{shouldShowDesktopAppNotification:t.data});case o.E_ACTION.SET_SHOW_WARNING_DESKTOP_NOTIFICATION:return(0,n._)({},e,{shouldShowWarningDesktopAppNotification:t.data});case o.E_ACTION.SET_START_OPTIONS:return(0,n._)({},e,{startOptions:t.data});case o.E_ACTION.VB_SET_USER_PHOTOS:return m(e,{photos:[...t.photos]});case o.E_ACTION.VB_ADD_USER_PHOTO:return m(e,{photos:[t.photo,...e.virtualBackgroundSettings.photos]});case o.E_ACTION.VB_REMOVE_USER_PHOTO:return m(e,{photos:e.virtualBackgroundSettings.photos.filter((({id:e})=>e!==t.photoId))});case o.E_ACTION.VB_SET_VIDEO_OPTIONS:return m(e,{videoOptions:t.videoOptions});case o.E_ACTION.SET_CALL_PERMISSIONS:return(0,d.isEqual)(t.data,e.permissions)?e:(0,n._)({},e,{permissions:t.data});case o.E_ACTION.SET_PARTICIPANTS_CHUNK:var T,I,y,N,b,x;return(0,n._)({},e,{participantsChunk:(0,n._)({countBefore:null!=(N=null==(T=e.participantsChunk)?void 0:T.countBefore)?N:0,ids:null!=(b=null==(I=e.participantsChunk)?void 0:I.ids)?b:[],countAfter:null!=(x=null==(y=e.participantsChunk)?void 0:y.countAfter)?x:0},t.data)});case o.E_ACTION.SET_PARTICIPANT_HAND_STATE:{const a=t.key,o=t.value,i=e.handState;var M;if((null!=(M=null==i?void 0:i[a])&&M)===o)return e;const r=(0,n._)({},i);return r[a]=o,o||delete r[a],(0,n._)({},e,{handState:r})}case o.E_ACTION.SET_PARTICIPANT_DRAT_STATE:{const a=t.key,o=t.value,i=e.dratState;var O;if((null!=(O=null==i?void 0:i[a])&&O)===o)return e;const r=(0,n._)({},i);return r[a]=o,o||delete r[a],(0,n._)({},e,{dratState:r})}case o.E_ACTION.CLEAN_LAST_CALL_DATA:return h(e,{opponentName:void 0,isMeEndedCallForAll:void 0});case o.E_ACTION.SET_LAST_CALL_DATA:return h(e,t.data);case o.E_ACTION.SET_LOCAL_DEVICE:return(0,n._)({},e,{localDevice:(0,n._)({},e.localDevice,t.data)});case o.E_ACTION.SET_PLANNED_CALENDAR_EVENT:return g(e,{plannedCalendarEvent:t.data});case o.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING:return g(e,{popupCalendarPlanning:t.data});case o.E_ACTION.SET_PLANNED_CALENDAR_EVENT_OWNER_OPTIONS:return g(e,{plannedCalendarEventOwnerOptions:t.data});case o.E_ACTION.SET_ROOM_ID:return(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{roomId:t.data})});case o.E_ACTION.SET_ROOM_ACTIVE:{const a=(0,p.deepClone)(e.rooms.rooms[t.data.id]);return a.active=t.data.active,(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{rooms:(0,n._)({},e.rooms.rooms,{[t.data.id]:a})})})}case o.E_ACTION.UPDATE_ROOMS:{const a=(0,p.deepClone)(e.rooms.rooms);return(0,p.objectForEach)(t.data,((e,t)=>{a[t]=(0,n._)({},a[t],e)})),(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{rooms:a})})}case o.E_ACTION.REMOVE_ROOM:{const a=(0,p.deepClone)(e.rooms.rooms),o=(0,p.deepClone)(e.rooms.roomParticipantIds);return delete a[t.data],delete o[t.data],(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{rooms:a,roomParticipantIds:o})})}case o.E_ACTION.CLEAR_ROOMS:return(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{rooms:[]})});case o.E_ACTION.SET_ROOM_CHAT_ID:{const a=(0,u.roomIdToString)(t.roomId);return(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{roomChatIds:(0,n._)({},e.rooms.roomChatIds,{[a]:t.chatId})})})}case o.E_ACTION.UPDATE_ROOM_PARTICIPANTS:{const a=(0,u.roomIdToString)(t.roomId);let o=new Map;if(t.participantIds)t.participantIds.forEach((t=>{(0,c.isSameExternalId)(t,e.externalId)||o.set((0,c.externalIdToString)(t),t)}));else if(t.addedParticipantIds||t.removedParticipantIds){var P;(null!=(P=e.rooms.roomParticipantIds[a])?P:[]).forEach((e=>{o.set((0,c.externalIdToString)(e),e)})),t.addedParticipantIds&&t.addedParticipantIds.forEach((t=>{const a=(0,c.externalIdToString)(t);if((0,c.isSameExternalId)(t,e.externalId))return!1;o.has(a)||o.set(a,t)})),t.removedParticipantIds&&t.removedParticipantIds.forEach((e=>{const t=(0,c.externalIdToString)(e);o.has(t)&&o.delete(t)}))}return(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{roomParticipantIds:(0,n._)({},e.rooms.roomParticipantIds,{[a]:[...o.values()].map((e=>(0,n._)({},e,{idString:(0,c.externalIdToString)(e)})))})})})}case o.E_ACTION.CLEAR_ROOM_PARTICIPANTS:{const a=(0,u.roomIdToString)(t.roomId),o=Object.assign({},e.rooms.roomParticipantIds);return delete o[a],(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{roomParticipantIds:o})})}case o.E_ACTION.SET_REACTIONS:return(0,n._)({},e,{reactions:(0,n._)({},e.reactions,t.data)});case o.E_ACTION.VMOJI_SET_CAPTURE:return(0,n._)({},e,{vmojiSettings:(0,n._)({},e.vmojiSettings,{isCapture:t.data})});case o.E_ACTION.VMOJI_SET_PARTICIPANT_IDS_TO_UPDATE_SVG:return(0,n._)({},e,{vmojiSettings:(0,n._)({},e.vmojiSettings,{participantIdsToUpdateSvg:t.data})});case o.E_ACTION.SET_GLOBAL_MOVIE_SHARE_PERMISSION:return(0,n._)({},e,{onlyAdminCanShareMovie:t.data});case o.E_ACTION.SET_ONBOARDING_FEATURE:return(0,n._)({},e,{onboarding:(0,n._)({},e.onboarding,{featureType:t.data})});case o.E_ACTION.SET_ONBOARDING_BANNER_IS_OPEN:return(0,n._)({},e,{onboarding:(0,n._)({},e.onboarding,{isOnboardingBannerOpen:t.data})});case o.E_ACTION.SET_ASR:return(0,n._)({},e,{asr:t.data});case o.E_ACTION.SET_TARGET_SWITCHED_ROOM:return(0,n._)({},e,{rooms:(0,n._)({},e.rooms,{targetSwitchedRoom:t.data})});case o.E_ACTION.SET_CALLS_QUEUE_RESPONSE:return(0,n._)({},e,{callsQueueResponse:t.data});case o.E_ACTION.SET_WATCH_TOGETHER:return(0,n._)({},e,{watchTogether:t.data?(0,n._)({},e.watchTogether,t.data):null});case o.E_ACTION.CHANGE_NAME_MODAL:return(0,n._)({},e,{changeNameSettings:(0,n._)({},e.changeNameSettings,{renamedUserPeerId:t.participantId,renamedUserType:t.renamedUserType})});case o.E_ACTION.SET_FEATURE_ENDED_NOTIFICATION:return(0,n._)({},e,{featureEndedNotification:t.data});default:return e}}function m(e,t){return(0,n._)({},e,{virtualBackgroundSettings:(0,n._)({},e.virtualBackgroundSettings,t)})}function h(e,t){return(0,n._)({},e,{lastCallData:(0,n._)({},e.lastCallData||{},t)})}function g(e,t){return(0,n._)({},e,{misc:(0,n._)({},e.misc||{},t)})}},174583:(e,t,a)=>{"use strict";a.d(t,{getAsrOwnerExternalId:()=>o,getAsrState:()=>n});const n=e=>e.asr,o=e=>{var t;return null==(t=e.asr)?void 0:t.externalId}},974:(e,t,a)=>{"use strict";a.d(t,{getFeatureEndedNotification:()=>r,getMyDevice:()=>o,getMyExternalId:()=>n,getParticipants:()=>i});const n=e=>e.externalId,o=e=>e.localDevice,i=e=>e.participants,r=e=>e.featureEndedNotification},430065:(e,t,a)=>{"use strict";a.d(t,{getBrowserWarnings:()=>l,getIsAsrFeatureEnabled:()=>n,getIsAsrListFeatureEnabled:()=>o,getIsAsrShown:()=>i,getIsDesktopAppNotification:()=>s,getIsSferum:()=>r});const n=e=>e.config.enableAsr,o=e=>e.config.enableAsrList,i=e=>Boolean(e.asr)&&Boolean(n(e)),r=e=>e.config.sferum,s=e=>e.config.desktopAppNotification,l=e=>e.config.browserWarnings},650653:(e,t,a)=>{"use strict";var n;a.d(t,{AppMarket:()=>n}),function(e){e.APP_STORE="appStore",e.GOOGLE_PLAY="googlePlay",e.RU_STORE="ruStore"}(n||(n={}))},998385:(e,t,a)=>{"use strict";a.d(t,{openDesktopDeepLink:()=>l});var n=a(274706);const o="hidden_page",i="timed_out",r="is_mobile",s=3e3;function l(e){return new Promise(((t,a)=>{if(n.Platform.isMobile)return void a(r);if(document.body.focus(),"hidden"===document.visibilityState||document.hidden)return void a(o);let l;const c=()=>{l&&clearTimeout(l),window.removeEventListener("blur",c),t(!0)};if(window.addEventListener("blur",c),l=setTimeout((()=>{window.removeEventListener("blur",c),a(i)}),s),n.Platform.BROWSER===n.BROWSER.SAFARI||n.Platform.BROWSER===n.BROWSER.FIREFOX){const t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t);const a=t.contentWindow;a?(a.location.href=e,setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),100)):window.location.href=e}else window.location.href=e}))}},985292:(e,t,a)=>{"use strict";function n(e){return new Promise(((t,a)=>{const n=new Image;n.src=e,n.onload=t,n.onerror=a}))}function o(e){return Promise.resolve(e)}a.d(t,{preloadImage:()=>n,preloadImagesFromResponse:()=>o})},776047:(e,t,a)=>{"use strict";var n;a.d(t,{EEventType:()=>n}),function(e){e.onRemoteRemoved="onRemoteRemoved",e.onRemoteStatus="onRemoteStatus",e.onDeviceChange="onDeviceChange"}(n||(n={}))},428009:(e,t,a)=>{"use strict";a.d(t,{eventBus:()=>i});var n=a(434788),o=a(464380);const i=new class{on(e,t,a){var o;this._events.has(e)||this._events.set(e,[]),null==(o=this._events.get(e))||o.push((0,n._)({listener:t},a))}off(e,t){const a=this._events.get(e);if(!a)return void(0,o.debugMessage)(o.DebugMessageType.WARN,`'${e}' is not registered event`);const n=a.filter((({listener:e})=>e!==t));n.length?this._events.set(e,n):this._events.delete(e)}allOff(e){this._events.delete(e)}has(e){return this._events.has(e)}emit(e,t){var a;let n;null==(a=this._events.get(e))||a.forEach((({listener:e,once:a})=>{e(t),a&&(n?n.push(e):n=[e])})),null==n||n.forEach((t=>this.off(e,t)))}constructor(){this._events=new Map}}},212169:(e,t,a)=>{"use strict";a.d(t,{useFullScreen:()=>s,useIndexer:()=>i,usePseudoLayer:()=>r});var n=a(667294),o=a(337057);const i=(e,t,a)=>{const i=(0,n.useRef)(null);i.current=i.current?i.current:new o.VkIndexer(e,t);const r=i.current,s=(0,n.useCallback)((e=>e.reduce(((e,t)=>(e[a(t)]=!0,e)),{})),[]),[l,c]=(0,n.useState)(e),[d,u]=(0,n.useState)(s(e));return(0,n.useEffect)((()=>{const t=s(e),n=e.filter((e=>!d[a(e)])),o=l.filter((e=>!t[a(e)]));(n.length||o.length)&&(n.forEach((e=>{r.add(e)})),o.forEach((e=>{r.remove(e)})),c(e),u(t))}),[e]),r};function r(){(0,n.useEffect)((()=>(document.body.classList.add("layers_shown"),()=>{document.body.classList.remove("layers_shown")})),[])}const s=(e,t,a,o=[])=>{const i=window.document,r=i.documentElement,s=r.requestFullscreen||r.webkitRequestFullscreen,l=(0,n.useRef)();l.current=t;const c=(0,n.useRef)();if(c.current=a,!s)return;const d=!r.requestFullscreen,u=d?i.webkitExitFullscreen:i.exitFullscreen,p=d?"webkitfullscreenchange":"fullscreenchange",_=d?"webkitFullscreenElement":"fullscreenElement";(0,n.useEffect)((()=>{const e=()=>{i.fullscreenElement?null==l.current||l.current():null==c.current||c.current()};return i.addEventListener(p,e),()=>i.removeEventListener(p,e)}),[]),(0,n.useEffect)((()=>{e&&!i[_]?s.call(i.documentElement):!e&&i[_]&&u.call(i)}),o)}},940296:(e,t,a)=>{"use strict";a.d(t,{getAnonymToken:()=>i});var n=a(434788),o=a(568963);const i=()=>(0,o.login)("get_anonym_token",{client_secret:"QbYic1K3lEV5kTGiqlq2",client_id:6287487,scopes:"audio_anonymous,video_anonymous,photos_anonymous,profile_anonymous"}).then((e=>e)).catch((e=>(0,n._)({access_token:"",error:!0},e)))},151635:(e,t,a)=>{"use strict";a.d(t,{longpollService:()=>A});var n=a(434788),o=a(22412),i=a(878198),r=a(788822),s=a(985292),l=a(581251),c=a(732297),d=a(271831),u=a(495457),p=a(800582),_=a(162532),m=a(464380),h=a(465768);function g(e){return e.rooms.roomId?e.rooms.roomChatIds[e.rooms.roomId]:e.peer}function A(e,t,a,A){const v=A.dispatch,f=(...f)=>{f.forEach((e=>{e.type===o.INCOMING_CALL&&(0,_.logCallReceived)(e.payload.call_id).catch(h.handlePromiseError)}));const S=A.getState();(function(e,t,a,l,c){const d=l.reduce(((l,d)=>{switch(d.type){case o.INCOMING_CALL:{if(!C(e,d)){l.push(Promise.resolve());break}const _=(0,i.isGroupCallEvent)(d);let h=_;const g=(0,i.convertCallerFromLongpoll)(d.payload);if(!_&&g.peerId<0){JSON.parse((0,r.decodeHTMLEntities)(d.payload.payload)).with_join_link&&(h=!0)}if(h){const n=_?(0,i.convertChatFromLongpoll)(d.payload):(0,u.getDefaultConversation)(c);if(t({type:o.E_ACTION.LOAD_PEERS,conversation:n,members:[g],peerId:n.peerId,caller:_?n:g}),n.photo&&l.push((0,s.preloadImage)(n.photo).catch((e=>(0,m.debugMessage)(m.DebugMessageType.WARN,e)))),_){const o=d.payload.call_id,i=(0,p.loadCallPeersWithoutWaitingImagesAction)(e,t,a,n.peerId,o);l.push(i)}}else t({type:o.E_ACTION.LOAD_PEERS,conversation:g,members:[g],peerId:g.peerId});g.photo&&l.push((0,s.preloadImage)(g.photo).catch((e=>{t({type:o.E_ACTION.LOAD_PEERS,members:[(0,n._)({},g,{photo:""})]}),(0,m.debugMessage)(m.DebugMessageType.WARN,e)})));break}}return l}),[]);return Promise.all(d)})(S,v,e,f,a).then((()=>{f.forEach((a=>{switch(a.type){case o.INCOMING_CALL:if(C(S,a))A.getState().ipSettingEnabled&&t.forceRelayPolicy(!a.payload.p2p_allowed),t.processPush(a.payload.call_id).then((()=>{const e=JSON.parse((0,r.decodeHTMLEntities)(a.payload.payload)),t=e.is_video?o.CallType.VIDEO:o.CallType.AUDIO,s=(0,i.getPeerIdFromLongpoll)(a.payload);let d=(0,i.isGroupCallEvent)(a);s<0&&(d=e.with_join_link),v({type:o.E_ACTION.CHANGE_MODE,mode:o.Mode.INCOMING,peerId:s<0&&d?0:s,data:(0,n._)({},a.payload,{type:t,payload:e})}),l.callStatDataStorage.set({timeStart:Date.now(),startType:t}),c.callStats.logEvent({call_event_type:o.CallActionEventType.INCOMING_CALL_RECEIVED,session_id:a.payload.call_id,peer_id:s,is_group_call:d,reason:e.is_video?o.CallType.VIDEO:o.CallType.AUDIO})})).catch((t=>{if(e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug)if("object"==typeof t){const{hangup:e,message:a}=t;console.error("Push process error",e,a)}else console.error("Push process error",t)}));else if(a.type===o.INCOMING_CALL){const t=t=>{e.eventHandlers.onError&&t&&e.eventHandlers.onError(new Error(t)),e.debug&&console.warn("Incoming push skipped:",t,a)};switch(!0){case!a.payload.call_id:t("old lib call");break;case S.mode===o.Mode.CALL||S.mode===o.Mode.INCOMING:t("already in a call");break;default:t("reason of decline is unknown")}}break;case o.ADD_MESSAGE:{const e=A.getState(),t=g(e),n=(0,d.isChatPeer)(t),i=e.callData.callId;if(t!==a.peerId||a.flags&o.FLAG_OUTBOUND||e.me===a.userId||v({type:o.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:e.chatUnreadCount?e.chatUnreadCount+1:1}),n||!(0,u.isActiveGroupCallMessage)(a))return;const{peerId:r,kludges:s}=a;if(i===s.attach1_call_id)return(0,p.loadCallPeersWithWaitingImagesAction)(A.getState(),v,r);break}case o.READ_INBOUND:{const e=g(A.getState());null!==a.chatUnreadCount&&e===a.peerId&&v({type:o.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:a.unread,chatUpToMsgId:a.upToId});break}case o.SET_FLAGS:{const e=A.getState();g(e)===a.peerId&&null!==e.chatUpToMsgId&&a.messageId>e.chatUpToMsgId&&!(a.flags&o.FLAG_OUTBOUND)&&(a.flags&o.FLAG_DELETED||a.flags&o.FLAG_SPAM)&&v({type:o.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:e.chatUnreadCount?e.chatUnreadCount-1:0});break}case o.DELETE_DIALOG:g(A.getState())===a.peerId&&v({type:o.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:0,chatUpToMsgId:null});break;case o.EDIT_MESSAGE:case o.REPLACE_MESSAGE:{const e=A.getState();g(e)===a.peerId&&null!==e.chatUpToMsgId&&a.messageId>e.chatUpToMsgId&&a.kludges.is_expired&&v({type:o.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:e.chatUnreadCount?e.chatUnreadCount-1:0});break}case o.CONVERSATION_UPDATED:{const{peerId:e,updateType:t}=a;if(g(A.getState())!==e)return;if(t!==o.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED)return;void 0!==A.getState().callData.canFinishCall&&A.getState().callData.hasUrlLink||(0,p.loadActiveCallDataAction)(A.getState(),v,e);break}}}))})).catch((t=>{e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),e.debug&&console.error("Resource loading error",t),f.forEach((e=>{if(e.type===o.INCOMING_CALL){if(!C(S,e))return;v({type:o.E_ACTION.ERROR,text:a("calls_incoming_process_error"),handleType:o.ErrorHandleType.PROCESS,callId:e.payload.call_id})}}))}))};e.handleEvent=f,void 0!==window.Notifier&&lpInstance&&lpInstance.onData(f)}function C(e,t){return function(e){return!!e.payload.call_id}(t)&&e.mode!==o.Mode.INCOMING&&e.mode!==o.Mode.CALL}},223338:(e,t,a)=>{"use strict";a.d(t,{CallsLongpollAnonym:()=>l});var n=a(11010),o=a(434788),i=a(162532),r=a(774351),s=a(464380);class l{init(){var e=this;return(0,n._)((function*(){try{const t=yield e.apiQueueSubscribe(e.userId,e.state().anonymSecret||"","anyId");e.urlData=t,t.secret&&e.onUpdateSecret&&e.onUpdateSecret(t.secret)}catch(e){(0,s.debugMessage)(s.DebugMessageType.ERROR,{type:"request",method:"calls.subscribeToQueue",error:e,text:"could not subscribe to Calls event queue"})}}))()}wait(){var e=this;return(0,n._)((function*(){if(!e.closed)try{if(e.urlData||(yield e.init()),!e.urlData)throw new Error("no urlData!");const t=(0,i.makeCallsAnonymQueueUrl)(e.urlData,e.userId),a=yield e.fetchCallsLongpoll(t);e.closed||e.onResponse(a),e.urlData=(0,o._)({},e.urlData,{queue_subscription_info:(0,o._)({},e.urlData.queue_subscription_info,{queues:[(0,o._)({},e.urlData.queue_subscription_info.queues[0],{timestamp:Number(a.ts)})]})})}catch(t){const a=e.retryCount;if(a>100)return;yield(0,r.pause)(a*a,null),e.retryCount+=1,e.urlData=null}finally{e.wait()}}))()}fetchCallsLongpoll(e){var t=this;return(0,n._)((function*(){return(0,i.fetchUrl)(e).then((a=>{var n,o,i;if((null==a?void 0:a.error)||(null==a?void 0:a.failed))throw(0,s.debugMessage)(s.DebugMessageType.ERROR,{type:"response.(error|failed)",method:e,data:{error:null==a?void 0:a.error,failed:null==a?void 0:a.failed}}),new Error("re-init subscription");if(Number(null==a?void 0:a.ts)===(null==(n=null==(o=t.urlData)||null==(i=o.queue_subscription_info)?void 0:i.queues[0])?void 0:n.timestamp))throw(0,s.debugMessage)(s.DebugMessageType.ERROR,{type:"response.ts",method:e,data:a}),new Error("re-init subscription");return a}))}))()}destroy(){this.closed=!0}constructor(e){this.state=e.state,this.userId=this.state().me,this.onResponse=e.onResponse,this.onUpdateSecret=e.onUpdateSecret,this.retryCount=0,this.urlData=null,this.apiQueueSubscribe=e.apiQueueSubscribe||i.fetchCallsAnonymQueue}}},442426:(e,t,a)=>{"use strict";var n,o;a.d(t,{ECallLongpollType:()=>o}),function(e){e.Calls="calls"}(n||(n={})),function(e){e.ScheduledCallsUpdate="scheduled_calls_update",e.CurrentCallsUpdate="current_calls_update",e.ChatInfoUpdated="chat_info_updated",e.CallAccepted="call_accepted",e.IncomingCall="incoming_call",e.CallFinished="call_finished",e.ParticipantNameChanged="participant_name_changed"}(o||(o={}))},171686:(e,t,a)=>{"use strict";a.d(t,{createCallsQueueEventHandler:()=>c});var n=a(162532),o=a(152575),i=a(22412),r=a(878198),s=a(465768),l=a(442426);function c(e){const t=e.dispatch,a=()=>e.getState();return e=>{switch(e.data.type){case l.ECallLongpollType.ChatInfoUpdated:{const{roomId:r}=a().rooms,{hall_id:l,call_id:c}=e.data.value;(0,n.getConversationsByCall)([c],{hall_id:l}).then((e=>{for(const s of e.items){var a,n;if((0,o.setRoomChatId)(t,l,s.peer.id),!r&&!l||r===l)t({type:i.E_ACTION.SET_UNREAD_COUNT,chatUnreadCount:null!=(a=s.unread_count)?a:0,chatUpToMsgId:null!=(n=s.last_conversation_message_id)?n:null})}})).catch(s.handlePromiseError);break}case l.ECallLongpollType.ParticipantNameChanged:a().callData.callId===e.data.value.call_id&&t({type:i.E_ACTION.LOAD_PEERS,members:[{peerId:e.data.value.participant_id,customName:e.data.value.new_custom_name_for_call}]});break;case l.ECallLongpollType.CallFinished:case l.ECallLongpollType.CallAccepted:e.data.value===a().callData.callId&&(0,r.hasIn)(a().mode,i.Mode.INCOMING)&&t({type:i.E_ACTION.CHANGE_MODE,mode:i.Mode.READY})}}}},773816:(e,t,a)=>{"use strict";a.d(t,{MuteStatesHandler:()=>A});var n,o,i=a(434788),r=a(464380),s=a(22412),l=a(971),c=a(496111),d=a(878198),u=a(332235),p=a(659397),_=a(890713),m=a(141647),h=a(1628);!function(e){e[e.None=0]="None",e[e.Muted=1]="Muted",e[e.MutedPermanent=2]="MutedPermanent",e[e.UnmutedWithoutAttraction=3]="UnmutedWithoutAttraction",e[e.CanTurnOnOnce=4]="CanTurnOnOnce",e[e.CanTurnOnOnceWithoutAttraction=5]="CanTurnOnOnceWithoutAttraction",e[e.UnmutedWithAttraction=6]="UnmutedWithAttraction"}(n||(n={})),function(e){e[e.Increase=0]="Increase",e[e.Clear=1]="Clear",e[e.Reset=2]="Reset"}(o||(o={}));const g={[r.MediaOption.AUDIO]:"audio",[r.MediaOption.VIDEO]:"video",[r.MediaOption.SCREEN_SHARING]:"screenSharing",[r.MediaOption.MOVIE_SHARING]:"movieSharing",[r.MediaOption.ANIMOJI]:"animoji",[r.MediaOption.AUDIO_SHARING]:"audioSharing"};class A{updateCallMuteState(e){const t=this._params,a=this._dispatch,n=this._store.getState();if((0,d.isBoolean)(t.stateUpdated)&&!t.stateUpdated)return;if(!t.muteAll)return;if(a({type:s.E_ACTION.SET_CALL_PERMISSIONS,data:t.muteStates}),!(0,c.isAdmin)(n.localDevice)&&!(0,c.isCreator)(n.localDevice))return;t.mediaOptions.some((e=>{const a=n.permissions[e],o=t.muteStates[e];return a===r.MuteState.MUTE_PERMANENT&&o===r.MuteState.MUTE||a===r.MuteState.MUTE&&o===r.MuteState.MUTE_PERMANENT}))&&((0,_.isUseParticipantListChunk)(n)?(0,_.refreshCurrentParticipantListChunk)(n,a,e):m.SDKParticipants.getParticipantsMuteStates(e))}updatePersonalMuteState(){const e=this._params,t=this._store.getState(),a=this._dispatch;if(!e.userId||!(0,c.isSameExternalId)(e.userId,t.externalId))return;if(e.adminId&&(0,c.isSameExternalId)(e.adminId,t.externalId))return;if(!e.stateUpdated)return;if(!e.muteAll&&e.requestedMedia)return;let n=0,o=0,l=0;const d=(0,i._)({},t.localDevice.permissions);if(e.mediaOptions.includes(r.MediaOption.AUDIO)){const t=d.audio,a=e.muteStates[r.MediaOption.AUDIO]||r.MuteState.UNMUTE;t!==r.MuteState.MUTE_PERMANENT&&a===r.MuteState.MUTE_PERMANENT?n=2:t===r.MuteState.MUTE_PERMANENT&&a!==r.MuteState.MUTE_PERMANENT?n=3:a===r.MuteState.MUTE&&(n=1),d.audio=a}if(e.mediaOptions.includes(r.MediaOption.VIDEO)){const t=d.video,a=e.muteStates[r.MediaOption.VIDEO]||r.MuteState.UNMUTE;t!==r.MuteState.MUTE_PERMANENT&&a===r.MuteState.MUTE_PERMANENT?o=2:t===r.MuteState.MUTE_PERMANENT&&a!==r.MuteState.MUTE_PERMANENT?o=3:a===r.MuteState.MUTE&&(o=1),d.video=a,d.screenSharing=a}if(e.mediaOptions.includes(r.MediaOption.MOVIE_SHARING)){const t=d.movieSharing,a=e.muteStates[r.MediaOption.MOVIE_SHARING]||r.MuteState.UNMUTE;t!==r.MuteState.MUTE_PERMANENT&&a===r.MuteState.MUTE_PERMANENT?l=2:t===r.MuteState.MUTE_PERMANENT&&a!==r.MuteState.MUTE_PERMANENT&&(l=3),d.movieSharing=a}const u=[];let _=0;e.mediaOptions.length&&(0!==n&&0!==o?(u.push(r.MediaOption.AUDIO,r.MediaOption.VIDEO,r.MediaOption.SCREEN_SHARING),_=n,n!==o&&(0,r.debugMessage)(r.DebugMessageType.ERROR,{error:`unexpected mute feedbacks pair audio=${n} video=${o}`})):0!==o?(u.push(r.MediaOption.VIDEO,r.MediaOption.SCREEN_SHARING),_=o):0!==n?(u.push(r.MediaOption.AUDIO),_=n):0!==l&&(u.push(r.MediaOption.MOVIE_SHARING),_=l)),0!==_&&u.length&&this._handleFeedbackEvent({didReceiveEvent:_,forMedia:u}),(0,p.isEqual)(d,t.localDevice.permissions)||a({type:s.E_ACTION.SET_LOCAL_DEVICE,data:{permissions:d}})}updateExternalMuteState(){var e;const t=this._params,a=this._store.getState(),n=this._dispatch;if(!t.userId||(0,c.isSameExternalId)(t.userId,a.externalId))return;if(!t.stateUpdated)return;const o=(0,c.externalIdToString)(t.userId);if((0,_.isUseParticipantListChunk)(a)&&!a.devices[o])return;const s={externalId:t.userId},l=null==(e=a.devices[o])?void 0:e.permissions;var u,p,m;s.permissions=(u=t.muteStates,p=t.mediaOptions,m=l,(0,d.objectReduce)(u,((e,t,a)=>(p.includes(a)&&t&&(e[g[a]]=t),e)),m?(0,i._)({},m):A.getUnmutedPermissions())),t.unmuteOptions.length?s.permissionsOnce=new Set(t.unmuteOptions):(0,d.objectSome)(t.muteStates,(e=>e===r.MuteState.MUTE_PERMANENT))&&(s.permissionsOnce=void 0),(0,h.throttleAccumulateDispatchParticipant)(n,t.userId,s)}updatePersonalPermissionsOnce(){var e;const t=this._params,a=this._store.getState(),n=!(0,d.isBoolean)(t.stateUpdated)||t.stateUpdated;t.userId&&!(0,c.isSameExternalId)(t.userId,a.externalId)||t.adminId&&(0,c.isSameExternalId)(t.adminId,a.externalId)||(null==(e=t.requestedMedia)?void 0:e.length)||n&&t.unmuteOptions.length&&this._handleFeedbackEvent({didReceiveEvent:5,forMedia:[...t.unmuteOptions]})}attractAttentionIfNeeded(){const e=this._params,t=this._store.getState();if(e.userId&&!(0,c.isSameExternalId)(e.userId,t.externalId))return;if(e.adminId&&(0,c.isSameExternalId)(e.adminId,t.externalId))return;if(!e.requestedMedia||!e.requestedMedia.length)return;let a=0,n=0;if(e.requestedMedia.includes(r.MediaOption.AUDIO)&&(e.muteAll&&t.localDevice.permissions.audio===r.MuteState.MUTE_PERMANENT||t.localDevice.mediaSettings.isAudioEnabled||(a=t.permissions[r.MediaOption.AUDIO]===r.MuteState.MUTE_PERMANENT||t.localDevice.permissions.audio===r.MuteState.MUTE_PERMANENT?4:6)),e.requestedMedia.includes(r.MediaOption.VIDEO)&&(e.muteAll&&t.localDevice.permissions.video===r.MuteState.MUTE_PERMANENT||t.localDevice.mediaSettings.isVideoEnabled||(n=t.permissions[r.MediaOption.VIDEO]===r.MuteState.MUTE_PERMANENT||t.localDevice.permissions.video===r.MuteState.MUTE_PERMANENT?4:6)),0!==a&&0!==n){let e=0;e=a!=n?4:a,this._handleFeedbackEvent({didReceiveEvent:e,forMedia:[r.MediaOption.AUDIO,r.MediaOption.VIDEO,r.MediaOption.SCREEN_SHARING]})}else 0!==a?this._handleFeedbackEvent({didReceiveEvent:a,forMedia:[r.MediaOption.AUDIO]}):0!==n&&this._handleFeedbackEvent({didReceiveEvent:n,forMedia:[r.MediaOption.VIDEO,r.MediaOption.SCREEN_SHARING]})}_handleFeedbackEvent({didReceiveEvent:e,forMedia:t}){switch(e){case 4:this._lowerHandIfRaised(),this._updatePermissionsOnce(t,0),this._openUnmuteRequestPopup(t);break;case 5:this._updatePermissionsOnce(t,2);break;case 6:this._lowerHandIfRaised(),this._openUnmuteRequestPopup(t);break;case 1:this._notificationMuted(t);break;case 2:this._closeUnmuteRequestPopupIfOpened(),this._updatePermissionsOnce(t,1),this._notificationMutedPermanent(t);break;case 3:this._lowerHandIfRaised(),this._notificationUnmuted(t)}}_notificationUnmuted(e){let t=null;(0,d.anyMatchInArray)(e,[r.MediaOption.AUDIO,r.MediaOption.VIDEO,r.MediaOption.SCREEN_SHARING])?t=s.NotificationType.ADMIN_UNMUTE_PERMANENT:e.includes(r.MediaOption.AUDIO)?t=s.NotificationType.ADMIN_UNMUTE_PERMANENT_AUDIO:e.includes(r.MediaOption.VIDEO)?t=s.NotificationType.ADMIN_UNMUTE_PERMANENT_VIDEO:e.includes(r.MediaOption.MOVIE_SHARING)&&(t=s.NotificationType.ADMIN_UNMUTE_PERMANENT_WATCH_TOGETHER),this._showNotification(t)}_notificationMuted(e){let t=null;(0,d.anyMatchInArray)(e,[r.MediaOption.AUDIO,r.MediaOption.VIDEO,r.MediaOption.SCREEN_SHARING])?t=s.NotificationType.ADMIN_MUTE:e.includes(r.MediaOption.AUDIO)?t=s.NotificationType.ADMIN_MUTE_AUDIO:e.includes(r.MediaOption.VIDEO)&&(t=s.NotificationType.ADMIN_MUTE_VIDEO),this._showNotification(t)}_notificationMutedPermanent(e){let t=null;(0,d.anyMatchInArray)(e,[r.MediaOption.AUDIO,r.MediaOption.VIDEO,r.MediaOption.SCREEN_SHARING])?t=s.NotificationType.ADMIN_MUTE_PERMANENT:e.includes(r.MediaOption.AUDIO)?t=s.NotificationType.ADMIN_MUTE_PERMANENT_AUDIO:e.includes(r.MediaOption.VIDEO)?t=s.NotificationType.ADMIN_MUTE_PERMANENT_VIDEO:e.includes(r.MediaOption.MOVIE_SHARING)&&(t=s.NotificationType.ADMIN_MUTE_PERMANENT_WATCH_TOGETHER),this._showNotification(t)}_showNotification(e){var t;if(!e)return;const a=null==(t=this._store.getState().notification)?void 0:t.ts;if(!(0,p.isUndefined)(a)&&Date.now()-a<1e3)return;(0,this._dispatch)({type:s.E_ACTION.CALL_NOTIFICATION,notification:{type:e}})}_lowerHandIfRaised(){var e,t;const a=this._store.getState(),n=this._dispatch;(null==(e=a.localDevice.statusData)||null==(t=e.hand)?void 0:t.state)&&(0,r.changeParticipantState)({hand:s.SdkHandType.LOWERED}).then((()=>{n({type:s.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,i._)({},a.localDevice.statusData,{hand:{ts:Date.now(),state:!1}})}})})).catch((e=>{(0,r.debugMessage)(r.DebugMessageType.ERROR,e)}))}_openUnmuteRequestPopup(e){const t=this._dispatch,a=(0,u.createFlags)(Object.values(r.MediaOption)),n=(0,u.calcFlagsArray)(a,e);let o="";(0,u.is)(n,a.AUDIO|a.VIDEO|a.SCREEN_SHARING)?o=s.POPUP_UNMUTE_REQUEST:(0,u.is)(n,a.VIDEO|a.SCREEN_SHARING)?o=s.POPUP_UNMUTE_VIDEO_REQUEST:(0,u.is)(n,a.AUDIO)&&(o=s.POPUP_UNMUTE_AUDIO_REQUEST),o&&t({type:s.E_ACTION.TOGGLE_POPUP,data:o})}_closeUnmuteRequestPopupIfOpened(){const e=this._store.getState(),t=this._dispatch;(0,d.hasIn)(e.popup,s.POPUP_UNMUTE_REQUEST,s.POPUP_UNMUTE_AUDIO_REQUEST)&&t({type:s.E_ACTION.TOGGLE_POPUP})}_updatePermissionsOnce(e,t){const a=this._dispatch,n=this._store.getState(),o=new Set(n.localDevice.permissionsOnce);switch(t){case 0:e.forEach((e=>o.add(e)));break;case 1:e.forEach((e=>o.delete(e)));break;case 2:o.clear(),e.forEach((e=>o.add(e)))}a({type:s.E_ACTION.SET_LOCAL_DEVICE,data:{permissionsOnce:o}})}static getDecreasedPermissionsOnce(e,t,a){if(!(null==a?void 0:a.size))return;const n=new Set(a);return e.isAudioEnabled&&!t.isAudioEnabled&&n.delete(r.MediaOption.AUDIO),e.isVideoEnabled&&!t.isVideoEnabled&&n.delete(r.MediaOption.VIDEO),e.isScreenSharingEnabled&&!t.isScreenSharingEnabled&&n.delete(r.MediaOption.SCREEN_SHARING),n}static getUnmutedPermissions(){return{audio:r.MuteState.UNMUTE,video:r.MuteState.UNMUTE,screenSharing:r.MuteState.UNMUTE,movieSharing:r.MuteState.UNMUTE,audioSharing:r.MuteState.UNMUTE,animoji:r.MuteState.UNMUTE}}static isMediaAllowed(e,t,a){if(!t)return!1;const n=l.GlobalStore.getCallsState(),o=n.permissions,i=!("externalId"in t)?t:n.participants[t.externalId.id];if((0,c.isAdmin)(i)||(0,c.isCreator)(i))return!0;const s=t.permissions,d=t.permissionsOnce;let u;switch(e){case"audio":u=r.MediaOption.AUDIO;break;case"video":u=r.MediaOption.VIDEO;break;case"screenSharing":u=r.MediaOption.SCREEN_SHARING;break;case"movieSharing":u=r.MediaOption.MOVIE_SHARING;break;case"audioSharing":u=r.MediaOption.AUDIO_SHARING;break;case"animoji":u=r.MediaOption.ANIMOJI}return u===r.MediaOption.MOVIE_SHARING?(null==s?void 0:s.movieSharing)!==r.MuteState.MUTE_PERMANENT:(null==s?void 0:s[e])===r.MuteState.MUTE||(o[u]!==r.MuteState.MUTE_PERMANENT&&(null==s?void 0:s[e])!==r.MuteState.MUTE_PERMANENT||!a&&!!(null==d?void 0:d.has(u)))}static mapParticipantPermissions(e){if(!e)return;const t=A.getUnmutedPermissions();for(const[a,n]of Object.entries(e))switch(a){case r.MediaOption.AUDIO:t.audio=n;break;case r.MediaOption.SCREEN_SHARING:t.screenSharing=n;break;case r.MediaOption.VIDEO:t.video=n;break;case r.MediaOption.MOVIE_SHARING:t.movieSharing=n}return t}static decreasePermissionsOnce(e,t,a){const{localDevice:n}=e,o=n.mediaSettings,r=A.getDecreasedPermissionsOnce(o,a,n.permissionsOnce),l=n.streamMode&&(0,c.isStreamModeAvailable)(n.streamMode,n,a)?n.streamMode:(0,c.getPreviousAvailableStreamMode)((0,i._)({},n,{mediaSettings:a}));t({type:s.E_ACTION.SET_LOCAL_DEVICE,data:{mediaSettings:a,permissionsOnce:r,streamMode:l}})}static mapArgs(...e){return{muteStates:e[0],unmuteOptions:e[1],mediaOptions:e[2],muteAll:e[3],unmute:e[4],userId:e[5],adminId:e[6],stateUpdated:e[7],requestedMedia:e[8],roomId:e[9]}}constructor(...e){this._params=A.mapArgs.apply(null,e),this._store=l.GlobalStore.getCallsStore(),this._dispatch=this._store.dispatch}}},274706:(e,t,a)=>{"use strict";a.d(t,{ARCH:()=>o,BROWSER:()=>i,OS:()=>n,Platform:()=>u,getBrowserInfo:()=>p});var n,o,i,r=a(489588);!function(e){e.WINDOWS="windows",e.MAC="mac",e.ANDROID="android",e.IOS="ios",e.LINUX="linux",e.UNKNOWN="unknown"}(n||(n={})),function(e){e.X86="x86",e.X64="x64",e.ARM="arm"}(o||(o={})),function(e){e.CHROME="chrome",e.FIREFOX="firefox",e.SAFARI="safari",e.OPERA="opera",e.YANDEX="yandex",e.IE="ie",e.EDGE="edge"}(i||(i={}));const s={android:/Android/i,ios:/(iPhone|iPad|iPod)/i,windows:/Win/i,ios:/(iPhone|iPad|iPod)/i,android:/Android/i,mac:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/i,linux:/(Linux|X11(?!.*CrOS))/i},l=/(x86_64|x86-64|win64|x64;|amd64|wow64|x64_64)/i,c=/Mobile|mini|Fennec|Android|iP(ad|od|hone)|opera (mini|mobi)/i,d=new Map,u={get OS(){if(d.has("os"))return d.get("os");const{userAgent:e}=window.navigator;for(let[t,a]of Object.entries(s))if(a&&a.test(e))return d.set("os",t),t;return d.set("os","unknown"),"unknown"},get ARCH(){if(d.has("arch"))return d.get("arch");const{userAgent:e,platform:t}=window.navigator;return l.test(e)||"MacIntel"===t||"Linux x86_64"===t?(d.set("arch","x64"),"x64"):/arm/i.test(e)?(d.set("arch","arm"),"arm"):(d.set("arch","x86"),"x86")},get BROWSER(){return p().name.toLowerCase()},get isChromeBased(){return p().chromeBased},get isMobile(){if(d.has("isMobile"))return d.get("isMobile");const{appVersion:e}=window.navigator,t=c.test(e);return d.set("isMobile",t),t},get isIPad(){return r.isIPad||r.isIPadOS}};function p(){if(d.has("browserInfo"))return d.get("browserInfo");const e=(()=>{let e,t=!1,a=0;const{userAgent:n,appName:o,appVersion:i}=window.navigator,r=n.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)([\d.]+)/i)||[];if(/trident/i.test(r[1]))return e=/\brv[ :]+(\d+)([\d.]+)/g.exec(n),{name:"ie",version:e&&e[1]||"Unknown",fullVersion:e&&e[1]?`${e[1]}${e[2]||""}`:"Unknown",chromeBased:t,chromeVersion:a};if("Safari"===r[1]){if(e=n.match(/\bEdge\/(\d+)([\d.])+/),e)return{name:"edge",version:e[1]||"Unknown",fullVersion:e[1]?`${e[1]}${e[2]||""}`:"Unknown",chromeBased:t,chromeVersion:a};if(e=n.match(/\bCriOS\/(\d+)([\d.]+)/),e)return{name:"chrome",version:e[1],fullVersion:`${e[1]}${e[2]}`,chromeBased:!0,chromeVersion:e[1]};if(e=n.match(/\bFxiOS\/(\d+)([\d.]+)/),e)return{name:"firefox",version:e[1],fullVersion:`${e[1]}${e[2]}`,chromeBased:t,chromeVersion:a};if(e=n.match(/\bYaBrowser\/(\d+)([\d.]+)/),e)return{name:"yandex",version:e[1],fullVersion:`${e[1]}${e[2]}`,chromeBased:t,chromeVersion:a};if(e=n.match(/\bOPT\/(\d+)([\d.]+)/),e)return{name:"opera",version:e[1],fullVersion:`${e[1]}${e[2]}`,chromeBased:t,chromeVersion:a}}if("Chrome"===r[1]){if(a=Number(r[2]),t=!0,e=n.match(/\bOPR\/(\d+)([\d.]+)/),e)return{name:"chrome",version:e[1]||"Unknown",fullVersion:e[1]?`${e[1]}${e[2]||""}`:"Unknown",chromeBased:t,chromeVersion:a};if(e=n.match(/\bYaBrowser\/(\d+)([\d.]+)/),e)return{name:"yandex",version:e[1]||"Unknown",fullVersion:e[1]?`${e[1]}${e[2]||""}`:"Unknown",chromeBased:t,chromeVersion:a};if(e=n.match(/\bEdge?\/(\d+)([\d.]+)/),e)return{name:"edge",version:e[1]||"Unknown",fullVersion:e[1]?`${e[1]}${e[2]||""}`:"Unknown",chromeBased:t,chromeVersion:a};if(void 0!==window.opr&&/^(.+\.)?ok.ru$/.test(window.location.host))return{name:"opera",version:"Hidden",fullVersion:"Hidden",chromeBased:t,chromeVersion:a}}return e=n.match(/version\/(\d+)([\d.]+)/i),{name:r[2]?r[1]:o,version:e&&e[1]||r[2]||i,fullVersion:e&&e[1]?`${e[1]}${e[2]||""}`:r[2]?`${r[2]}${r[3]||""}`:i,chromeBased:t,chromeVersion:a}})();return d.set("browserInfo",e),e}},261757:(e,t,a)=>{"use strict";a.d(t,{setNeedPushToTalkToggleAudio:()=>o});a(495457),a(22412),a(464380);let n=!0;function o(e){n=e}},3264:(e,t,a)=>{"use strict";a.d(t,{checkAuthByGroupId:()=>ne,getCallStartErrorText:()=>le,sdkService:()=>q});var n=a(11010),o=a(434788),i=a(50533),r=a(22412),s=a(162532),l=a(878198),c=a(465768),d=a(985292),u=a(66388),p=a(916188),_=a(204651),m=a(271831),h=a(495457),g=a(301869),A=a(581251),C=a(732297),v=a(800582),f=a(659956),S=a(496111),E=a(1628),T=a(464380),I=a(504580),y=a(290020),N=a(334909),b=a(455319),x=a(182330),M=a(274706),O=a(419125),P=a(765789),R=a(971),k=a(94176),w=a(890713),D=a(659397),L=a(773816),j=a(141647),B=a(97547),U=a(428009),H=a(776047),F=a(438655),V=a(152575),G=a(993240),W=a(743679),$=a(124798),z=a(394406),Z=a(292071),K=a(972205),Q=a(8101);const Y=(e,t,a={})=>{var n;let i=(0,o._)({call_event_type:t,session_id:null==(n=e.callData)?void 0:n.callId,peer_id:e.peer,is_group_call:(0,h.isGroupCallByPeer)(e.peer)},a);C.callStats.logEvent(i)};function q(e,t,a,n,o,i){return J.apply(this,arguments)}function J(){return(J=(0,n._)((function*(e,t,a,b,q,J){const te=b.dispatch,oe=b.getState(),le=oe.me,de=(0,l.compose)(ie,l.tokenValidateRetryWrapper.bind(null,ee.bind(null,t,e,b))),he=(0,l.compose)(t.joinCallByLink,l.tokenValidateRetryWrapper.bind(null,ee.bind(null,t,e,b))),ge=oe.localVideoResolution===r.VideoResolutionTypes.SD?r.VideoHeight.SD:r.VideoHeight.HD,Ae=oe.localVideoResolution===r.VideoResolutionTypes.SD?r.VideoWidth.SD:r.VideoWidth.HD,Ce=(()=>{switch(!0){case oe.config.enableDomainBender:return"bender";case J:return"vk_corp";default:return}})(),ve=(()=>{if(oe.config.enableCustomScreenSharePacketSize&&(0,D.isNumber)(oe.config.customScreenSharePacketSize))return oe.config.customScreenSharePacketSize})(),fe=(()=>{if(oe.config.enableCustomExternalDomain&&oe.config.customExternalDomain)return oe.config.customExternalDomain})(),Se=!!oe.config.screenShareCongestionControl,Ee=(()=>{const e=oe.config.customScreenShareCongestionControlThreshold;if(Se&&(0,D.isNumber)(e))return e})(),Te={apiKey:a.key,apiEnv:a.is_dev?"VIDEOTEST":"PROD",anonymToken:a.is_anonym?a.token:"",audioShare:oe.config.enableAudioShare,serverAudioRed:!0,p2pAudioRed:!0,useParticipantListChunk:(0,w.isUseParticipantListChunk)(oe),useRooms:!0,fastScreenShare:oe.config.enableFastScreenSharingVK||oe.config.enableFastScreenSharingSferum,participantListChunkInitCount:(0,w.getParticipantListChunkInitCount)(),screenShareCongestionControl:Se,screenShareCongestionControlThreshold:Ee,voiceParams:{speakerLevelMultiplier:1.3,smoothing:.5},domain:Ce,videoTracksCount:oe.config.enableVideoSlots?oe.config.videoSlotsCount:void 0,producerNotificationDataChannel:!0,videoMaxHeight:ge,videoMaxWidth:Ae,videoEffectMaxHeight:ge,videoEffectMaxWidth:Ae,debugLog:oe.config.debugLog,consumerScreenTrack:oe.config.enableScreenTrack,producerScreenTrack:oe.config.enableProducerScreenTrack,callStatReportEnabled:!0,joinFromMultipleDevices:oe.config.enableMultipleDevices,h264spsPpsIdrInKeyframe:!!oe.config.enableSpsPpsIdrInKeyframe,movieShare:!0,newMuteRules:oe.config.enableNewMuteRules,clientType:"VK",consumerScreenDataChannelPacketSize:ve,externalDomain:fe,onLocalStream:(t,a)=>{e.debug&&console.warn("onLocalStream",t,a),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{stream:t,mediaSettings:a,streamMode:(0,S.getNewStreamModeByDevice)(T.MediaType.CAMERA,b.getState().localDevice,!!t)}}),A.callStatDataStorage.set({hadVideoEnabled:a.isVideoEnabled})},onLocalStreamUpdate:(t,a)=>{e.debug&&console.warn("onLocalStreamUpdate",t,a);const n=b.getState(),o=n.localDevice.mediaSettings;L.MuteStatesHandler.decreasePermissionsOnce(n,te,t),t.isScreenSharingEnabled!==(null==o?void 0:o.isScreenSharingEnabled)&&n.externalId&&((0,S.toggleScreenSharing)(n,te,t.isScreenSharingEnabled,n.externalId),t.isScreenSharingEnabled?e.eventHandlers.onScreenSharingEnabled&&e.eventHandlers.onScreenSharingEnabled():e.eventHandlers.onScreenSharingDisabled&&e.eventHandlers.onScreenSharingDisabled()),A.callStatDataStorage.set({hadVideoEnabled:t.isVideoEnabled})},onRemoteStream:(t,a)=>{e.debug&&console.warn("onRemoteStream",t.id,a);const n=(0,S.getNewStreamModeByDevice)(T.MediaType.CAMERA,(0,S.getDeviceFromStoreById)(b,t),!!a);(0,w.isUseParticipantListChunk)(oe)?(0,w.onRemoteStreamForChunk)(b.getState(),te,{externalId:t,stream:a,streamMode:n}):(0,E.throttleAccumulateDispatchParticipant)(te,t,{stream:a,streamMode:n})},onRemoteLive:(t,{streamName:a,stream:n,mediaType:o})=>{e.debug&&console.warn("onRemoteLive",{externalId:t,streamName:a,stream:n,mediaType:o});const i=(0,S.getDeviceFromStoreById)(b,t),r={externalId:t};var s;n?(r.movieStream=n,r.streamMode=(0,S.getNewStreamModeByDevice)(o,i,!!n)):((null==(s=i.movieStreamInfo)?void 0:s.movieId)===Number(a)&&(r.movieStreamInfo=null,r.movieStream=null),r.movieStreamStoppedInfo=null);(0,w.isUseParticipantListChunk)(oe)?(0,w.onRemoteLiveForChunk)(b.getState(),te,r):(0,E.throttleAccumulateDispatchParticipant)(te,t,r)},onRemoteLiveUpdate:(t,a)=>{e.debug&&console.warn("onRemoteLiveUpdate",t.id,a),(0,G.setWatchTogether)(te,{movieState:a})},onRemoteSharedMovieInfo:(t,a,n)=>{const o=b.getState();e.debug&&console.warn("onRemoteSharedMovieInfo",{externalId:t,sharedMovieInfo:a,roomId:n}),(0,F.equalsToMyRoom)(o,n)&&(0,G.setWatchTogether)(te,{movieInfo:a,owner:t,pinnedParticipant:t}),o.screenSharingOldPinnedParticipant&&(0,$.setScreenSharingPinnedParticipant)(te),(0,E.throttleAccumulateDispatchParticipant)(te,t,{movieStreamInfo:a,movieStreamStoppedInfo:null}),o.onboarding.isOnboardingBannerOpen&&(B.onboardingStorage.setUsedFeature(r.E_ONBOARDING_FEATURES.watchTogether),te({type:r.E_ACTION.SET_ONBOARDING_BANNER_IS_OPEN,data:!1}))},onRemoteSharedMovieStoppedInfo:(t,a,n)=>{const o=b.getState();e.debug&&console.warn("onRemoteSharedMovieStoppedInfo",{externalId:t,sharedMovieStoppedInfo:a,roomId:n}),(0,F.equalsToMyRoom)(o,n)&&(0,G.removeWatchTogether)(te),(0,E.throttleAccumulateDispatchParticipant)(te,t,{movieStreamStoppedInfo:a,movieStream:null,movieStreamInfo:null,streamMode:(0,S.getNewStreamModeByDevice)(a.source,(0,S.getDeviceFromStoreById)(b,t),!1)})},onLocalLive:(t,{streamName:a,stream:n,mediaType:o})=>{e.debug&&console.warn("onLocalLive",t,a,n,o);const i=b.getState().localDevice;if(!n){var s;const e={movieStreamStoppedInfo:null};return(null==(s=i.movieStreamInfo)?void 0:s.movieId)===Number(a)&&(e.movieStreamInfo=null,e.movieStream=null),void te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:e})}te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{movieStream:n,streamMode:(0,S.getNewStreamModeByDevice)(o,i,!!n),movieStreamStoppedInfo:null}})},onLocalLiveUpdate:(t,a)=>{e.debug&&console.warn("onLocalLiveUpdate",t,a),(0,G.setWatchTogether)(te,{movieState:a})},onLocalSharedMovieInfo:(t,a)=>{e.debug&&console.warn("onLocalSharedMovieInfo",t,a);const{screenSharingPinnedParticipant:n}=b.getState();n&&(0,$.setScreenSharingPinnedParticipant)(te),(0,G.setWatchTogether)(te,{movieInfo:a,owner:t,pinnedParticipant:t}),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{movieStreamInfo:a,movieStreamStoppedInfo:null}})},onLocalSharedMovieStoppedInfo:(t,a)=>{e.debug&&console.warn("onLocalSharedMovieStoppedInfo",t,a),(0,G.removeWatchTogether)(te),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{movieStreamStoppedInfo:a,movieStream:null,movieStreamInfo:null,streamMode:(0,S.getNewStreamModeByDevice)(a.source,b.getState().localDevice,!1)}})},onScreenStream:(t,a)=>{e.debug&&console.warn("onScreenStream",t,a);const n=b.getState();if(L.MuteStatesHandler.decreasePermissionsOnce(n,te,a),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{screenSharingStream:t,mediaSettings:a,streamMode:(0,S.getNewStreamModeByDevice)(T.MediaType.SCREEN,b.getState().localDevice,!!t)}}),t){let e;switch(!0){case Boolean(a.isFastScreenSharingEnabled&&a.isAudioSharingEnabled):e=Z.EScreenSharingReason.FastAudioScreenSharing;break;case Boolean(a.isAudioSharingEnabled):e=Z.EScreenSharingReason.AudioScreenSharing;break;case Boolean(a.isFastScreenSharingEnabled):e=Z.EScreenSharingReason.FastScreenSharing;break;default:e=Z.EScreenSharingReason.HDScreenSharing}Y(n,r.CallActionEventType.SCREEN_SHARING_STARTED,{reason:e})}else Y(n,r.CallActionEventType.SCREEN_SHARING_STOPPED)},onRemoteScreenStream:(t,a)=>{e.debug&&console.warn("onRemoteScreenStream",t.id,a);const n=(0,S.getNewStreamModeByDevice)(T.MediaType.SCREEN,(0,S.getDeviceFromStoreById)(b,t),!!a);(0,w.isUseParticipantListChunk)(oe)?(0,w.onRemoteScreenStreamForChunk)(b.getState(),te,{externalId:t,stream:a,streamMode:n}):(0,E.throttleAccumulateDispatchParticipant)(te,t,{screenSharingStream:a,streamMode:n})},onVmojiStream:(t,a)=>{e.debug&&console.warn("onVmojiStream",t,a);const n=b.getState();L.MuteStatesHandler.decreasePermissionsOnce(n,te,a),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{animojiStream:t,mediaSettings:a,streamMode:(0,S.getNewStreamModeByDevice)(T.MediaType.CAMERA,b.getState().localDevice,!!t)}})},onRemoteVmojiStream:(t,a)=>{var n,o;e.debug&&console.warn("onRemoteVmojiStream",t.id,a);const i=(0,S.getDeviceFromStoreById)(b,t),r=(0,S.getNewStreamModeByDevice)(T.MediaType.CAMERA,i,!!a||Boolean(null==i||null==(n=i.mediaSettings)?void 0:n.isAnimojiEnabled)||Boolean((null==i||null==(o=i.mediaSettings)?void 0:o.isVideoEnabled)&&(null==i?void 0:i.stream)));(0,w.isUseParticipantListChunk)(oe)?(0,w.onRemoteAnimojiStreamForChunk)(b.getState(),te,{externalId:t,stream:a,streamMode:r}):(0,E.throttleAccumulateDispatchParticipant)(te,t,{animojiStream:a,streamMode:r})},onParticipantVmojiUpdate:t=>{e.debug&&console.warn("onParticipantVmojiUpdate",t);const a=b.getState(),n=a.vmojiSettings.participantIdsToUpdateSvg,o=(0,S.externalIdToString)(t),i=[+t.id];if(e){const t=a.callData.callId||"",n={withConversation:!1,withChatMembers:!1,awaitImages:!1};(0,v.loadCallParticipantsAccumulate)(a,te,e,t,i,n)}te({type:r.E_ACTION.VMOJI_SET_PARTICIPANT_IDS_TO_UPDATE_SVG,data:[...n,o]})},onConversation:(a,n,o,i,s)=>{e.debug&&((0,T.debugMessage)(T.DebugMessageType.LOG,{type:"start call info",os:M.Platform.OS,arch:M.Platform.ARCH,isMobile:M.Platform.isMobile,browser:(0,M.getBrowserInfo)(),config:b.getState().config,cameras:t.browser.getCameras(),microphones:t.browser.getMicrophones(),hasMicrophonePermission:t.browser.hasMicrophonePermission(),hasCameraPermission:t.browser.hasCameraPermission(),screenHeight:window.screen.availHeight,screenWidth:window.screen.availWidth,windowHeight:window.screen.height,windowWidth:window.screen.width}),console.warn("onConversation",{userId:a,mediaModifiers:n,muteStates:o,participants:i,rooms:s}));const l=b.getState();if(!l.callData.ts){const e=Date.now();te({type:r.E_ACTION.TIME_START,data:e})}const c=b.getState().peer;if(0!==c&&(0,v.loadActiveCallDataAction)(l,te,c),i&&(0,V.updateRoomParticipants)(te,r.ROOM_MAIN_ID,{addedParticipantIds:i.map((e=>e.uid))}),s){if(s.rooms.length){for(const e of s.rooms){var d;(null==e||null==(d=e.participants)?void 0:d.participants)&&((0,V.updateRoomParticipants)(te,e.id,{addedParticipantIds:e.participants.participants.map((e=>e.uid))}),(0,E.addParticipantsToStoreThrottled)(l,te,e.participants.participants,e.id))}s.rooms&&(0,V.updateRooms)(l,te,s.rooms)}s.roomId&&(0,V.setRoomId)(te,s.roomId)}(0,E.addParticipantsToStoreThrottled)(l,te,i,null)},onConversationParticipantListChunk(t){e.debug&&console.warn("onConversationParticipantListChunk",t),(0,w.onConversationParticipantListChunk)(b.getState(),te,e,t)},onParticipantJoined(a,n){e.debug&&console.warn("onParticipantJoined",{externalId:a,markers:n}),(0,V.updateRoomParticipants)(te,r.ROOM_MAIN_ID,{addedParticipantIds:[a]}),(0,E.throttleAccumulateDispatchParticipant)(te,a,{roomId:r.ROOM_MAIN_ID}),(0,w.onParticipantJoinedForChunk)(b.getState(),te,t,e,{externalId:a,markers:n})},onParticipantAdded(t){e.debug&&console.warn("onParticipantAdded",{externalId:t}),(0,V.updateRoomParticipants)(te,r.ROOM_MAIN_ID,{addedParticipantIds:[t]})},onRemoteMediaSettings:(a,n,i)=>{e.debug&&console.warn("onRemoteMediaSettings",{externalId:a,mediaSettings:n,markers:i});const r=b.getState(),s=(0,S.externalIdToString)(a),l=r.devices[s],c=(0,E.queryThrottledAccumulatedState)(a),d=(0,o._)({},null==l?void 0:l.mediaSettings,null==c?void 0:c.mediaSettings),u=(null==c?void 0:c.permissionsOnce)||(null==l?void 0:l.permissionsOnce);if((null==d?void 0:d.isVideoEnabled)===n.isVideoEnabled&&(null==d?void 0:d.isAudioEnabled)===n.isAudioEnabled&&(null==d?void 0:d.isAnimojiEnabled)===n.isAnimojiEnabled&&(null==d?void 0:d.isScreenSharingEnabled)===n.isScreenSharingEnabled)return;!!d.isScreenSharingEnabled!==n.isScreenSharingEnabled&&(0,S.toggleScreenSharing)(r,te,n.isScreenSharingEnabled,a,!0);const p=L.MuteStatesHandler.getDecreasedPermissionsOnce(d,n,u),_=(0,S.getMediaSettingsWithStreamMode)(n,(0,o._)({},l,c));_.permissionsOnce=p,(null==c?void 0:c.streamMode)&&!_.streamMode&&(_.streamMode=c.streamMode),(0,w.isUseParticipantListChunk)(r)&&!pe(a,r)?(0,w.onRemoteMediaSettingsForChunk)(r,te,t,e,{externalId:a,markers:i,mediaSettings:n,permissionsOnce:p}):(0,E.throttleAccumulateDispatchParticipant)(te,a,_),A.callStatDataStorage.set({hadVideoEnabled:n.isVideoEnabled})},onRemoteStatus:(t,a,n)=>{e.debug&&console.warn("onRemoteStatus",t,a,n);const o=b.getState();if(U.eventBus.has(H.EEventType.onRemoteStatus)&&U.eventBus.emit(H.EEventType.onRemoteStatus,[t,a,n]),(0,w.isUseParticipantListChunk)(o))(0,w.onRemoteStatusForChunk)(o,te,t,a);else{const i=[];for(let e of t){if((0,S.isSameExternalId)(e,o.externalId))continue;const t=+e.id,r=o.participants[t];r&&r.shortName||i.push(t);const s={status:a};n&&(s.statusData=n),(0,E.throttleAccumulateDispatchParticipant)(te,e,s)}if(e&&i.length>0){const t=o.callData.callId||"",a={withConversation:!o.callData.conversation,awaitImages:!1};(0,v.loadCallParticipantsAccumulate)(o,te,e,t,i,a)}}A.callStatDataStorage.set({connectionStep:a});const i=+(null==t?void 0:t[0].id);if(i===o.peer){const e=(0,S.getPeerIdDeviceInfo)(i,R.GlobalStore.getCallsState().devices),t=(e,t)=>{let a={call_event_type:e,session_id:o.callData.callId,peer_id:o.peer,is_group_call:!1};t&&(a.reason=t),C.callStats.logEvent(a)};if(a===T.ParticipantStatus.CONNECTED){if(t(r.CallActionEventType.CALL_CONNECTED),k.mailRuCounter.push(k.EMailRuGoals.JoinCall),!(null==e?void 0:e.wasConnected)&&(0,S.isCreator)(o.localDevice)){const{startType:e}=A.callStatDataStorage.get();t(r.CallActionEventType.OUTGOING_CALL_ACCEPTED_REMOTELY,null==e?void 0:e.toString())}}else a===T.ParticipantStatus.WAITING&&t(r.CallActionEventType.OUTGOING_CALL_REMOTE_RINGING)}},onPermissionsError:a=>{if(e.debug&&console.warn("onPermissionsError",a),b.getState().mode===r.Mode.CALL){switch(a){case r.MediaError.CAMERA_PERMISSION:case r.MediaError.CAMERA_ACCESS:t.toggleLocalVideo(!1);break;case r.MediaError.MIC_ACCESS:case r.MediaError.MIC_NOT_FOUND:t.toggleLocalAudio(!1);break;case r.MediaError.SCREEN_PERMISSION:case r.MediaError.SCREEN_ACCESS:t.captureScreen(!1);break;case r.MediaError.MIC_CAMERA_PERMISSION:t.toggleLocalAudio(!1),t.toggleLocalVideo(!1)}te({type:r.E_ACTION.ERROR,text:(0,f.getMediaErrorMessage)(a,q),title:(0,f.getMediaErrorTitle)(a,q)})}},onPermissionsRequested:()=>{e.debug&&console.warn("onPermissionsRequested")},onRemoteRemoved:(a,n)=>{e.debug&&console.warn("onRemoteRemoved",a,n),U.eventBus.has(H.EEventType.onRemoteRemoved)&&U.eventBus.emit(H.EEventType.onRemoteRemoved,[a,n]);const o=b.getState();(0,w.isUseParticipantListChunk)(o)&&(0,w.onRemoteRemovedForChunk)(o,te,t,{externalId:a,markers:n}),te({type:r.E_ACTION.REMOVE_USER,participantId:a}),te({type:r.E_ACTION.LOAD_PEERS,members:[{peerId:Number(a.id),customName:void 0}]}),(0,S.isSameExternalId)((0,W.getWatchTogetherPinnedParticipant)(o),a)&&(0,G.removeWatchTogether)(te)},onCallState:(t,a,n)=>{var o,i,s;e.debug&&console.warn("onCallState",t,a,n);const{id:c,direction:d,joinLink:u,externalId:p,options:_,topology:m,featuresPerRole:g}=n;if(c&&b.getState().callData.callId)return void te({type:r.E_ACTION.CALL_STATE,callData:{topology:m}});_e(te,{featuresPerRole:g,isNeedNotification:!1}),te({type:r.E_ACTION.CALL_STATE,callData:{callId:c,topology:m},joinLink:u,externalId:p}),te({type:r.E_ACTION.SET_CONVERSATION_OPTIONS,data:_});const{peer:A,participants:f,entryPoint:S}=b.getState();if(!A){const t=[];(0,l.objectForEach)(f,(e=>{t.push(e.peerId)})),t.length&&(0,v.loadCallParticipantsAccumulate)(oe,te,e,c,t,{withConversation:!0,withChatMembers:!0,withCallParticipants:!0,awaitImages:!1})}const E=b.getState().peer||0;(0,h.isGroupCallByPeer)(E)&&[T.CallDirection.JOINING,T.CallDirection.OUTGOING].includes(d)&&(C.callStats.logEvent({call_event_type:r.CallActionEventType.CALL_CONNECTED,session_id:c,peer_id:E,is_group_call:!0,source:S}),k.mailRuCounter.push(k.EMailRuGoals.JoinCall)),(null==(o=b.getState())?void 0:o.startOptions)&&(null==(i=b.getState())||null==(s=i.startOptions)?void 0:s.createLink)&&(0,v.loadAndCopyJoinLink)(te,c,b.getState().groupId)},onFeaturesPerRoleChanged:e=>{const{localDevice:t}=b.getState();_e(te,{featuresPerRole:e,isNeedNotification:!(0,S.participantIsAdmin)(b.getState().localDevice)&&L.MuteStatesHandler.isMediaAllowed("movieSharing",t)})},onRateNeeded:()=>{e.debug&&console.warn("onRateNeeded")},onSpeakerChanged:t=>{e.debug&&console.warn("onSpeakerChanged",t),(0,$.setOrator)(te,t)},onJoinStatus:(t,a)=>{e.debug&&console.warn("onJoinStatus",t,a)},onHangup:(a,n)=>{const{hangup:o}=a;e.debug&&console.warn("onHangup",o,n),e.eventHandlers.onHangup&&e.eventHandlers.onHangup(a);const i=o&&![r.HANGUP_TYPE_CANCELED,r.HANGUP_TYPE_MISSED,r.HANGUP_TYPE_HUNGUP].includes(o),s=b.getState(),c=o&&o===r.HANGUP_TYPE_HUNGUP;let d=(0,h.isGroupCallByPeer)(s.peer);if(s.mode===r.Mode.CALL&&i||s.localDevice.status===T.ParticipantStatus.WAITING_HALL&&o===r.HANGUP_TYPE_REMOVED){var u;const e=r.CALL_HANGUP_MODAP_MAP[o],t=!!(null==(u=s.lastCallData)?void 0:u.isMeEndedCallForAll)&&(o===T.HangupType.KILLED||o===T.HangupType.KILLED_WITHOUT_DELETE);te({type:r.E_ACTION.HANGUP,data:o}),(0,l.conditionalPausedPromise)(t||r.HANGUP_DELAY).finally((()=>{te({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.READY}),e&&te({type:r.E_ACTION.TOGGLE_POPUP,data:e})}))}else if(oe.config.showFeedbackScreen&&c){const{ts:e}=s.callData,t=(e?Math.floor((Date.now()-e)/1e3):0)>10&&0===Math.floor(3*Math.random()),a=0===Math.floor(5*Math.random());d&&t||a?(te({type:r.E_ACTION.MANAGEMENT,isOpen:!1}),te({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.FEEDBACK})):s.mode!==r.Mode.ERROR&&te({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.READY}),s.rooms.roomId&&C.callStats.logEvent({call_event_type:r.CallActionEventType.SESSION_ROOMS_USER_LEFT,session_id:oe.callData.callId,peer_id:oe.peer,is_group_call:(0,h.isGroupCallByPeer)(oe.peer)})}else s.mode!==r.Mode.ERROR&&te({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.READY});e.isInActiveCall=!1;const p=(0,l.isInReconnect)(s);if(n=n||"",(0,g.addCallStatEvent)(o,n,p,e.debug),!p&&!d){let e="none";o===T.HangupType.MISSED?e="timeout":o===T.HangupType.BUSY&&(e="busy");const{conversation:t}=s.callData;let a={call_event_type:r.CallActionEventType.CALL_DECLINED_OR_HANGED_REMOTELY,session_id:n,peer_id:(null==t?void 0:t.peerId)||0,is_group_call:!1,reason:e};C.callStats.logEvent(a)}e.authorizedGroupId&&function(e,t,a,n){ne(e,t,a,0,n)}(t,e,b,te),A.callStatDataStorage.reset(),s.externalId&&te({type:r.E_ACTION.LOAD_PEERS,members:[{peerId:Number(s.externalId.id),customName:void 0}]}),(0,O.sendVirtualBackgroundDisabled)(s)},onCallAccepted:()=>{e.debug&&console.warn("onCallAccepted"),(0,h.isGroupCallByPeer)(b.getState().peer)&&(C.callStats.logEvent({call_event_type:r.CallActionEventType.CALL_CONNECTED,session_id:b.getState().callData.callId,peer_id:b.getState().peer,is_group_call:(0,h.isGroupCallByPeer)(b.getState().peer)}),k.mailRuCounter.push(k.EMailRuGoals.JoinCall))},onTokenExpired:()=>{e.debug&&console.warn("onTokenExpired"),(e.tokenAttempts||0)<3&&(ee(t,e,b),e.tokenAttempts=(e.tokenAttempts||0)+1)},onDeviceChange:()=>{e.debug&&console.warn("onDeviceChange"),U.eventBus.has(H.EEventType.onDeviceChange)&&U.eventBus.emit(H.EEventType.onDeviceChange)},onMultipartyChatCreated:()=>{e.debug&&console.warn("onMultipartyChatCreated")},onFingerprintChange:t=>{e.debug&&console.warn("onFingerprintChange",t)},onVolumesDetected:(0,u.volumesDetectorGenerator)({onUpdate(e){te({type:r.E_ACTION.SET_SPEAKERS,data:{speakers:e.speakers,speakersInHeader:e.speakersInHeader}})},volumeLevelDetection:r.VOLUME_LEVEL_DETECTION,debugCallback:()=>{e.debug}}),onLocalVolume:(0,u.localVolumeDetectorGenerator)({onVolumeLevelReached:()=>{const e=b.getState();te({type:r.E_ACTION.CALL_NOTIFICATION,notification:{type:r.NotificationType.SPEAKING_ON_MUTE}}),C.callStats.logEvent({call_event_type:r.CallActionEventType.MIC_OFF_WHILE_TALKING_ALERT,session_id:e.callData.callId,peer_id:e.peer,is_group_call:(0,h.isGroupCallByPeer)(e.peer)})},onVolumeLevelUpdated(e){var t;const a=null==(t=b.getState().localDevice.mediaSettings)?void 0:t.isAudioEnabled,n=b.getState().speakers,i=(0,o._)({},n),s=b.getState().externalId,l=s?(0,S.externalIdToString)(s):le;e&&a&&s?i[l]=!0:!e&&s&&delete i[l],i[l]!==n[l]&&te({type:r.E_ACTION.SET_SPEAKERS,data:{speakers:i}})},needCheckMicEnabled:!0,volumeLevelDetection:r.VOLUME_LEVEL_DETECTION,vectorLength:5,callbackFactorStep:0,sensitivityCoefficient:.45,debugCallback:()=>{e.debug}}),onChatMessage:(t,a,n)=>{e.debug&&console.warn("onChatMessage",t,a,n)},onCustomData:(t,a)=>{e.debug&&console.warn("onCustomData",t,a)},onNetworkStatusChanged:t=>{if(e.debug&&console.warn("onNetworkStatusChanged",t),(0,h.isGroupCallByPeer)(oe.peer)||oe.config.badNetworkP2P)for(const e of t)(0,E.throttleAccumulateDispatchParticipant)(te,e.uid,{networkStatus:e.rating})},onLocalNetworkStatusChanged:t=>{e.debug&&console.warn("onLocalNetworkStatusChanged",t),((0,h.isGroupCallByPeer)(oe.peer)||oe.config.badNetworkP2P)&&te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{networkStatus:t}})},onDebugMessage:(t,...a)=>{e.debug&&console.warn("onDebugMessage",t,...a)},onRemoteParticipantState:(a,n,o)=>{var i,s,l,c,d,u,p,_,m;e.debug&&console.warn("onRemoteParticipantState",{externalId:a,participantState:n,markers:o});const h=b.getState();n=(0,S.convertParticipantStateFromSDK)(n);const g=(0,S.externalIdToString)(a),A=+a.id;var C;const v=null!=(C=null==(i=h.devices[g])||null==(s=i.statusData)||null==(l=s.hand)?void 0:l.state)?C:null==(c=h.handState)?void 0:c[g],f=null==(d=h.devices[g])||null==(u=d.statusData)||null==(p=u.drat)?void 0:p.state,T=!!v,I=!!f,y=!!(null==n||null==(_=n.hand)?void 0:_.state),N=!!(null==n||null==(m=n.drat)?void 0:m.state);if(T===y&&I===N||((0,w.isUseParticipantListChunk)(h)&&!pe(a,h)?(0,w.onRemoteParticipantStateForChunk)(h,te,t,e,{externalId:a,markers:o,participantState:n}):(0,E.throttleAccumulateDispatchParticipant)(te,a,{statusData:n})),(0,F.isInMyRoom)(a)&&T!==y){var x,M;const e=!!(null==(x=b.getState().participants[+a.id])?void 0:x.name);(null==n||null==(M=n.hand)?void 0:M.state)&&!T&&e&&A!==h.me&&te({type:r.E_ACTION.CALL_NOTIFICATION,notification:{type:r.NotificationType.RAISED_HAND,data:A}})}(0,S.participantIsAdmin)(h.localDevice)&&f!==N&&(N?(0,F.isInMyRoom)(a)||te({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_ROOM_HELP_REQUESTED,popupData:{popup:r.POPUP_ROOM_HELP_REQUESTED,externalId:a}}):h.popup===r.POPUP_ROOM_HELP_REQUESTED&&te({type:r.E_ACTION.TOGGLE_POPUP}))},onRolesChanged:(t,a)=>{e.debug&&console.warn("onRolesChanged",t,a);const n=b.getState(),o=n.participants[t.id];a.includes(T.UserRole.ADMIN)&&o&&o.peerId!==n.me&&te({type:r.E_ACTION.CALL_NOTIFICATION,notification:{type:r.NotificationType.USER_GRANTED_WITH_ADMIN_ROLE,data:t.id}}),te({type:r.E_ACTION.CHANGE_PARTICIPANT_ROLES,participantId:+t.id,data:a})},onLocalRolesChanged:a=>{if(e.debug&&console.warn("onLocalRolesChanged",a),a.includes(T.UserRole.ADMIN)){te({type:r.E_ACTION.CALL_NOTIFICATION,notification:{type:r.NotificationType.ADMIN_ROLE_GRANTED,ts:Date.now()}});const e=b.getState();e.config.enableParticipantListChunk?(0,w.refreshCurrentParticipantListChunk)(e,te,t):j.SDKParticipants.getParticipantsMuteStates(t)}a.includes(T.UserRole.ADMIN)||a.includes(T.UserRole.CREATOR)?(0,h.isWaitingHallEnabled)(b.getState())&&(0,x.loadWaitingHallFromScratch)(b.getState(),te):(j.SDKParticipants.abortGetParticipants(),b.getState().waitingHall&&(0,x.clearWaitingList)(te),(0,V.clearRooms)(te)),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{roles:a}})},onDeviceSwitched:(t,a)=>{e.debug&&console.warn("onDeviceSwitched",t,a)},onMuteStates:(...a)=>{const n=b.getState(),o=L.MuteStatesHandler.mapArgs.apply(null,a);if(e.debug&&console.warn("onMuteStates",o),!(0,F.equalsToMyRoom)(n,o.roomId))return;const i=new L.MuteStatesHandler(...a);i.updateCallMuteState(t),i.updatePersonalMuteState(),i.updatePersonalPermissionsOnce(),i.updateExternalMuteState(),i.attractAttentionIfNeeded()},onRecordStarted:(t,a,n,o,i,s,l=null)=>{e.debug&&console.warn("onRecordStarted",{initiator:t,movieId:a,startTime:n,type:o,externalMovieId:i,externalOwnerId:s,roomId:l});const c=b.getState();if(!(0,F.equalsToMyRoom)(c,l))return;const d={isOn:!0,videoId:i?+i:void 0,ownerId:s?+s:void 0,host:t,startTime:n,link:s&&i?`https://${(0,N.getHostName)()}${(0,y.getShortVideoUrl)(s,i)}`:void 0,startStreamParams:void 0,isRecord:"RECORD"===o};te({type:r.E_ACTION.SET_TRANSLATION,data:d})},onRecordStopped:t=>{e.debug&&console.warn("onRecordStopped",{roomId:t});const a=b.getState();(0,F.equalsToMyRoom)(a,t)&&(te({type:r.E_ACTION.SET_TRANSLATION,data:{isOn:!1,hasPermission:!1}}),a.translation.isOn&&(0,Q.isMeRecordCreator)(a)&&(0,K.setFeatureEndedNotification)(te,r.EFeatureEndedNotification.RecordEndedNotification))},onLocalPin(t){var a;e.debug&&console.warn("onLocalPin",{unpin:t});const n=b.getState(),o=n.localDevice;t||te({type:r.E_ACTION.CALL_NOTIFICATION,notification:{type:r.NotificationType.PINNED_BY_ADMIN}}),t||(null==(a=o.mediaSettings)?void 0:a.isAudioEnabled)||te({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_ADMIN_PIN_UNMUTE_REQUEST}),t||n.isOratorMode||te({type:r.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),n.externalId&&(0,$.setAdminPinnedParticipant)(te,t?null:n.externalId)},onPinnedParticipant(a,n,o,i){e.debug&&console.warn("onPinnedParticipant",{externalId:a,unpin:n,roomId:i});const s=b.getState(),l=s.participants[a.id];s.rooms.roomId===i&&(!n&&l&&((null==l?void 0:l.shortName)||(null==l?void 0:l.name))&&te({type:r.E_ACTION.CALL_NOTIFICATION,notification:{type:r.NotificationType.USER_PINNED_BY_ADMIN,data:a.id}}),s.isOratorMode||te({type:r.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:!0}),pe(a,s)||(0,w.onPinnedParticipantForChunk)(s,te,t,e,{externalId:a,pin:!n,markers:o}),(0,$.setAdminPinnedParticipant)(te,n?null:a))},onOptionsChanged:t=>{e.debug&&console.warn("onOptionsChanged",t),te({type:r.E_ACTION.SET_CONVERSATION_OPTIONS,data:t})},onLocalStatus:a=>{e.debug&&console.warn("onLocalStatus",a);const n=b.getState(),{callData:o,me:i,localDevice:l}=n,d=l.status===T.ParticipantStatus.WAITING_HALL&&a===T.ParticipantStatus.WAITING,u=a===T.ParticipantStatus.CONNECTED&&!n.peer;a===T.ParticipantStatus.CONNECTED&&n.vmojiSettings.isCapture&&(t.captureVmoji(!0),C.callStats.logEvent({call_event_type:r.CallActionEventType.CALL_VMOJI_STARTED,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,h.isGroupCallByPeer)(n.peer)})),o.callId&&!(0,S.isParticipantAnonym)(i)&&(u||d)&&(0,s.getConversationsByCall)([o.callId]).then((({items:e})=>{const[t]=e,a=t.peer.id;return re(b,a,void 0)})).catch((e=>{var t;if(951===(null==e||null==(t=e.error)?void 0:t.error_code))return 0;throw e})).catch(c.handlePromiseError),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{status:a,wasConnected:!0}})},onChatRoomUpdated:(t,a,n)=>{e.debug&&console.warn("onChatRoomUpdated",t,a,n),t===T.ChatRoomEventType.ATTENDEE&&(0,x.loadWaitingHall)(a,n,b.getState(),te)},onJoinLinkChanged(t){e.debug&&console.warn("onJoinLinkChanged",t);const a=b.getState(),n=a.callData.callId||"",o=(0,h.isAuthedByGroupId)(a)?a.groupId:0;(0,v.loadCallUrlLink)(b.dispatch,n,!1,o)},onFeedback(t,a){e.debug&&console.warn("onFeedback",{feedback:t,roomId:a});if(b.getState().rooms.roomId!==a)return;const n=b.getState().externalId,o=b.dispatch;o({type:r.E_ACTION.SET_REACTIONS,data:{feedback:t}});for(const e of t)for(const t of e.items){const a={key:e.key,ts:t.times[t.times.length-1]};(0,S.isSameExternalId)(t.participantId,n)?o({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{reaction:a}}):(0,E.throttleAccumulateDispatchParticipant)(o,t.participantId,{reaction:a})}},onRoomStart:t=>{e.debug&&console.warn("onRoomsStart",{roomId:t}),(0,V.setRoomId)(te,t)},onRoomsUpdated:(0,n._)((function*(t){e.debug&&console.warn("onRoomsUpdated",{updates:t});const a=b.getState();let n=Object.values(a.rooms.rooms).length;(0,l.objectForEach)(t,((e,t)=>{if(e)switch(t){case T.RoomsEventType.UPDATE:var o,i,r;n+=null!=(i=null==e||null==(o=e.rooms)?void 0:o.length)?i:0,(0,V.updateRooms)(a,te,null!=(r=e.rooms)?r:[]);break;case T.RoomsEventType.ACTIVATE:var s;for(const t of null!=(s=e.roomIds)?s:[])(0,V.setRoomActivate)(te,t,!e.deactivated);break;case T.RoomsEventType.REMOVE:var l,c,d;n-=null!=(c=null==e||null==(l=e.roomIds)?void 0:l.length)?c:0;for(const t of null!=(d=e.roomIds)?d:[])(0,V.deleteRoom)(te,t),(0,V.clearRoomParticipants)(te,t)}})),a.popup===r.POPUP_ROOM_CONTROL_CREATE&&n>0?te({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_ROOM_CONTROL}):a.popup!==r.POPUP_ROOM_CONTROL||n||te({type:r.E_ACTION.TOGGLE_POPUP,data:r.POPUP_ROOM_CONTROL_CREATE})})),onRoomUpdated:(0,n._)((function*(t,a,n,o){e.debug&&console.warn("onRoomUpdated",{eventTypes:t,roomId:a,room:n});const i=b.getState();for(const e of t)switch(e){case T.RoomsEventType.UPDATE:n&&(0,V.updateRooms)(i,te,[n]);break;case T.RoomsEventType.ACTIVATE:const e=!o;(0,V.setRoomActivate)(te,a,e);break;case T.RoomsEventType.REMOVE:(0,V.deleteRoom)(te,a),(0,V.setRoomId)(te,r.ROOM_MAIN_ID),(0,V.setRoomChatId)(te,a,0)}})),onRoomSwitched:(0,n._)((function*(a){e.debug&&console.warn("onRoomSwitched",{roomId:a});const n=b.getState();n.watchTogether&&(0,G.removeWatchTogether)(te);const c=n.rooms.roomId;(0,V.setRoomId)(te,a),yield((e,t)=>{if((0,l.isSameFeatureEndedNotification)(r.EFeatureEndedNotification.RecordEndedNotification,e.featureEndedNotification)&&(0,K.setFeatureEndedNotification)(te,null),e.translation.isOn&&e.me===e.translation.ownerId)return(0,s.stopVideoStream)(t)})(n,c),(e=>{var a,n;const i=e.localDevice;(null==(a=i.statusData)||null==(n=a.hand)?void 0:n.state)&&(t.changeParticipantState({hand:r.SdkHandType.LOWERED,drat:r.SdkDratType.UNSET}),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,o._)({},i.statusData,{hand:{state:!1,ts:Date.now()},drat:{state:!1,ts:Date.now()}})}}))})(n),(0,i.batch)((()=>{(0,$.setAdminPinnedParticipant)(te),(0,$.setScreenSharingPinnedParticipant)(te),(0,$.setPinnedParticipant)(te),(0,$.setOrator)(te)})),(e=>{e.popup===r.POPUP_ROOM_REQUEST_HELP&&te({type:r.E_ACTION.TOGGLE_POPUP,data:null})})(n),a?n.rooms.rooms[a]&&((0,V.enterToRoomNotification)(te,n.rooms.rooms[a].name),C.callStats.logEvent({call_event_type:r.CallActionEventType.SESSION_ROOMS_USER_MOVED,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,h.isGroupCallByPeer)(n.peer),hall_id:a})):((0,V.exitFromRoomNotification)(te),C.callStats.logEvent({call_event_type:r.CallActionEventType.SESSION_ROOMS_USER_LEFT,session_id:n.callData.callId,peer_id:n.peer,is_group_call:(0,h.isGroupCallByPeer)(n.peer)})),me(e,t,b,a)})),onRoomParticipantsUpdated:a=>{e.debug&&console.warn("onRoomParticipantsUpdated",{update:a});const n=b.getState();if(a.addedParticipantIds||a.removedParticipantIds||a.addedParticipants||a.removedParticipantMarkers){if((0,V.updateRoomParticipants)(te,a.roomId,{addedParticipantIds:a.addedParticipantIds,removedParticipantIds:a.removedParticipantIds}),a.removedParticipantIds&&!(0,l.isEmpty)(a.removedParticipantIds))for(const e of a.removedParticipantIds)(0,S.isSameExternalId)(e,n.externalId)||((0,E.throttleAccumulateDispatchParticipant)(te,e,{roomId:r.ROOM_UNDEFINED_ID}),(0,i.batch)((()=>{(0,S.isSameExternalId)(n.orator,e)&&(0,$.setOrator)(te),(0,S.isSameExternalId)(n.adminPinnedParticipant,e)&&(0,$.setAdminPinnedParticipant)(te),(0,S.isSameExternalId)(n.screenSharingPinnedParticipant,e)&&(0,$.setScreenSharingPinnedParticipant)(te),(0,S.isSameExternalId)(n.pinnedParticipant,e)&&(0,$.setPinnedParticipant)(te)})));var s,c,d;if(a.addedParticipants&&!(0,l.isEmpty)(a.addedParticipants))(0,E.addParticipantsToStoreThrottled)(n,te,a.addedParticipants.filter((e=>!(0,S.isSameExternalId)(e.uid,n.externalId))),a.roomId),(null==(s=n.localDevice.statusData)||null==(c=s.drat)?void 0:c.state)&&a.roomId===n.rooms.roomId&&(null==(d=a.addedParticipantIds)?void 0:d.some((e=>(0,S.participantIsAdmin)(n.participants[e.id]))))&&(t.changeParticipantState({drat:r.SdkDratType.UNSET}),te({type:r.E_ACTION.SET_LOCAL_DEVICE,data:{statusData:(0,o._)({},n.localDevice.statusData,{drat:{ts:Date.now(),state:!1}})}}))}else me(e,t,b,a.roomId)},onAsrSet(t,a){e.debug&&console.warn("onSetAsr",t,a),b.getState().rooms.roomId===a&&(0,z.setAsr)(te,t)},onAsrStarted(t,a,n){e.debug&&console.warn("onAsrStarted",t,a,n);const o=b.getState();(0,S.isSameExternalId)(t,o.externalId)&&Y(o,r.CallActionEventType.TRANSCRIPTION_STARTED),b.getState().rooms.roomId===n&&(0,z.setAsr)(te,{externalId:t,movieId:a})},onAsrStopped(t){e.debug&&console.warn("onAsrStopped",t);const{externalId:a,asr:n,rooms:o}=b.getState(),i=(0,S.isSameExternalId)(null==n?void 0:n.externalId,a);i&&Y(oe,r.CallActionEventType.TRANSCRIPTION_STOPPED),o.roomId===t&&(i&&(0,K.setFeatureEndedNotification)(te,r.EFeatureEndedNotification.AsrEndedNotificationOwner),(0,z.clearAsr)(te))}};e.authorized=!1,e.authorizedGroupId=0,e.debugMessage=T.debugMessage,e.call=function(e,t,a,o,i){const s=o.dispatch;return(0,n._)((function*(n,l,d,u,_=0,m,g={}){try{const a=(0,h.getMediaOptions)({video:l,animoji:!l&&o.getState().vmojiSettings.isCapture,audio:!0});if(e.isInActiveCall)return Promise.reject(r.CallErrorType.ALREADY_IN_CALL).catch(X);e.isInActiveCall=!0,s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),yield ae(e),yield ne(t,e,o,_,s),yield(0,p.checkPermissions)(t,a),yield re(o,n,d);const m=yield i(e,t,o,a,n);ue(t,o,g),s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),s({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.CALL,peerId:n}),A.callStatDataStorage.set({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:u,startType:l?r.CallType.VIDEO:r.CallType.AUDIO}),C.callStats.logEvent({call_event_type:l?r.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:r.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:null==m?void 0:m.id,peer_id:n,is_group_call:!1,source:u,group_call_users_count:2}),k.mailRuCounter.push(k.EMailRuGoals.StartP2PCall),se(o,n,d).catch(c.handlePromiseError)}catch(o){e.isInActiveCall=!1,s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ce(o,t,e,(0,h.isGroupCallByPeer)(n),a,s)}}))}(e,t,q,b,de),e.startGroupCall=function(e,t,a,o,i){const s=o.dispatch;return(0,n._)((function*(n,l,d,u,_,g=!0,f=null,S={}){try{const a=(0,h.getMediaOptions)({video:u,animoji:!u&&o.getState().vmojiSettings.isCapture,audio:!0}),E=d?d.filter(m.isUserPeer):[];if(e.debug&&d&&d.length!==E.length&&console.warn("Some ids cannot get into the call.",d.filter((e=>!(0,m.isUserPeer)(e)))),e.isInActiveCall)return Promise.reject(r.CallErrorType.ALREADY_IN_CALL).catch(X);e.isInActiveCall=!0,s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),yield ae(e),yield ne(t,e,o,0,s),yield(0,p.checkPermissions)(t,a);const[T]=yield re(o,n,l);yield(0,v.loadChatMembersAction)(o.getState(),s,n,T);const I=yield i(e,t,o,a,n);ue(t,o,S),s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),s({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.CALL,peerId:n}),g&&(E&&E.length?s({type:r.E_ACTION.GROUP_CALL_SETUP,open:!0,peerId:n,preselectedIds:E}):s({type:r.E_ACTION.MANAGEMENT,isOpen:!0})),f&&s({type:r.E_ACTION.SET_TRANSLATION,data:{deferredId:f}}),se(o,n,l).catch(c.handlePromiseError),A.callStatDataStorage.set({timeStart:Date.now(),isOutgoingCall:!0,startType:u?r.CallType.VIDEO:r.CallType.AUDIO,entryPoint:_,isGroupCall:!0}),C.callStats.logEvent({call_event_type:u?r.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:r.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:null==I?void 0:I.id,peer_id:n,is_group_call:!0,source:_,group_call_users_count:1}),k.mailRuCounter.push(k.EMailRuGoals.StartGroupCall)}catch(o){e.isInActiveCall=!1,s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ce(o,t,e,(0,h.isGroupCallByPeer)(n),a,s)}}))}(e,t,q,b,de),e.startCall=function(e,t,a,o,i){const s=o.dispatch;return(0,n._)((function*(n,l,c=!0,d=0,u={},_=!1){try{const m=(0,h.getMediaOptions)({video:n,animoji:!n&&o.getState().vmojiSettings.isCapture,audio:!0});if(e.isInActiveCall)return void X(r.CallErrorType.ALREADY_IN_CALL);e.isInActiveCall=!0;const g=(0,h.getDefaultConversation)(a);s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),yield ae(e),yield ne(t,e,o,d,s),yield(0,p.checkPermissions)(t,m);const f=yield i(e,t,o,m,void 0,void 0,_),S=null==f?void 0:f.id;return ue(t,o,u),s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),s({type:r.E_ACTION.LOAD_PEERS,conversation:g,members:[],peerId:0}),s({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.CALL}),c&&s({type:r.E_ACTION.MANAGEMENT,isOpen:!0}),(null==u?void 0:u.createLink)&&(S?(0,v.loadAndCopyJoinLink)(s,S,d):s({type:r.E_ACTION.SET_START_OPTIONS,data:u})),A.callStatDataStorage.set({timeStart:Date.now(),isOutgoingCall:!0,entryPoint:l,startType:n?r.CallType.VIDEO:r.CallType.AUDIO,isGroupCall:!0}),C.callStats.logEvent({call_event_type:n?r.CallActionEventType.OUTGOING_CALL_STARTED_VIDEO:r.CallActionEventType.OUTGOING_CALL_STARTED_AUDIO,session_id:S,peer_id:0,is_group_call:!0,source:l,group_call_users_count:1}),k.mailRuCounter.push(k.EMailRuGoals.StartGroupCall),f}catch(n){e.isInActiveCall=!1,s({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ce(n,t,e,!0,a,s)}}))}(e,t,q,b,de),e.joinCallByLink=function(e,t,a,o,i){const u=o.dispatch;return(_,m,g=!1,A,v=0,f=void 0,E)=>{const I=o.getState(),y=!!I.config.enableJoinCallDelayedMedia,N=(0,h.getMediaOptions)({video:g,animoji:!g&&I.vmojiSettings.isCapture,audio:!0});return e.isInActiveCall?Promise.reject(r.CallErrorType.ALREADY_IN_CALL).catch(X):(e.isInActiveCall=!0,u({type:r.E_ACTION.SET_ENTRYPOINT,entryPoint:A}),(0,S.isParticipantAnonym)(I.me)?Promise.resolve().then((()=>{u({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((()=>ae(e))).then((()=>(0,p.checkPermissions)(t,N))).then((()=>i(_,N).then((()=>{u({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),u({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.CALL,joinLink:_,vkJoinLink:E})})))).catch((n=>{e.isInActiveCall=!1,u({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ce(n,t,e,!0,a,u)})):Promise.resolve().then((()=>{u({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((()=>ae(e))).then((()=>ne(t,e,o,v,u))).then((()=>(0,p.checkPermissions)(t,N))).then((()=>{const t=e.authorizedGroupId?e.id:0,a=t?JSON.stringify({community_user_id:t}):void 0;return i(_,y?[]:N,void 0,void 0,a)})).then((({id:e})=>(0,s.getConversationsByCall)([e]))).then((({items:e})=>{if(!(null==e?void 0:e.length))return 0;const[t]=e,a=t.peer.id;return re(o,a,m).then((e=>(0,d.preloadImagesFromResponse)(e))),a})).catch((e=>{var t,a;if(8===(null==e||null==(t=e.error)?void 0:t.error_code))return 0;if((0,l.hasIn)(null==e||null==(a=e.error)?void 0:a.error_code,951,1007))return 0;throw e})).then((0,n._)((function*(e){y&&(N.includes(T.MediaOption.AUDIO)&&(yield t.toggleLocalAudio(!0).catch(D.noop)),N.includes(T.MediaOption.VIDEO)&&(yield t.toggleLocalVideo(!0).catch(D.noop))),u({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),u({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.CALL,peerId:e,joinLink:_}),f&&u({type:r.E_ACTION.SET_TRANSLATION,data:{deferredId:f}}),e&&se(o,e,m).catch(c.handlePromiseError),C.callStats.logEvent({call_event_type:r.CallActionEventType.GROUP_CALL_JOINED,session_id:o.getState().callData.callId,peer_id:null!=e?e:0,is_group_call:!0,source:A,group_call_users_count:(0,S.getActiveParticipantsCount)(o.getState())})}))).catch((n=>{e.isInActiveCall=!1,u({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),ce(n,t,e,!0,a,u)})))}}(e,t,q,b,he),e.showJoinPopup=function(e,t,a){const n=a.dispatch;return(i,c)=>{const{mode:d}=a.getState();return d===r.Mode.CALL||d===r.Mode.INCOMING?Promise.reject(r.CallErrorType.ALREADY_IN_CALL).catch((()=>{n({type:r.E_ACTION.ERROR,text:t("calls_already_in_call_error")})})):(n({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!0}),(0,s.messagesGetCallPreview)(i).then((e=>(0,l.normalizePreviewData)(t,e))).then((e=>{n({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),n({type:r.E_ACTION.JOIN,data:(0,o._)({},e,{entryPoint:c})})})).catch((a=>{var o;e.eventHandlers.onError&&a&&e.eventHandlers.onError(a),e.debug&&console.warn("messagesGetCallPreview",a);const i=(0,l.getTextForApiErrorByCode)(null==a||null==(o=a.error)?void 0:o.error_code,!0,t);console.error(i),n({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),n({type:r.E_ACTION.ERROR,text:i,handleType:r.ErrorHandleType.FATAL})})))}}(e,q,b),e.acceptCall=function(e,t,a,n){const o=n.dispatch;return(i,s)=>{const l=n.getState(),c=l.peer,d=l.callData,u=(0,h.getMediaOptions)({video:i,animoji:!i&&n.getState().vmojiSettings.isCapture,audio:s});return(0,p.checkPermissions)(t,u).then((()=>t.acceptCall(u))).then((({acceptTime:t})=>{o({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.CALL,ts:t}),e.isInActiveCall=!0,C.callStats.logEvent({call_event_type:r.CallActionEventType.INCOMING_CALL_ACCEPTED,session_id:d.callId,peer_id:c,is_group_call:(0,h.isGroupCallByPeer)(c),reason:i?r.CallType.VIDEO:r.CallType.AUDIO}),k.mailRuCounter.push(k.EMailRuGoals.AcceptCall)})).catch((t=>{o({type:r.E_ACTION.ERROR,text:(0,f.getPermissionsErrorMessage)(i,!0,a),handleType:r.ErrorHandleType.DECLINE}),e.eventHandlers.onError&&t&&e.eventHandlers.onError(t),(0,T.debugMessage)(T.DebugMessageType.ERROR,t),console.error(t)}))}}(e,t,q,b),e.showCallByNamePopup=function(e,t,a,n){const i=n.dispatch;return(e,t,s,l)=>{const{mode:c}=n.getState();return c===r.Mode.CALL||c===r.Mode.INCOMING?Promise.reject(r.CallErrorType.ALREADY_IN_CALL).catch((()=>{i({type:r.E_ACTION.ERROR,text:a("calls_already_in_call_error")})})):Promise.resolve().then((()=>{i({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!0})})).then((()=>{i({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1}),i({type:r.E_ACTION.CALL_BY_NAME,data:(0,o._)({},l,{peerId:e,joinLink:s,entryPoint:t})})})).catch((()=>{i({type:r.E_ACTION.SHOW_LOADER,isLoaderVisible:!1})}))}}(0,0,q,b),e.showCreateCallByLinkPopup=function(e,t,a,n){const o=n.dispatch;return e=>{const{mode:t}=n.getState();return t===r.Mode.CALL||t===r.Mode.INCOMING?Promise.reject(r.CallErrorType.ALREADY_IN_CALL).catch(X):Promise.resolve().then((()=>{o({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.CREATE_CALL,entryPoint:e})}))}}(0,0,0,b),e.showPlanCalendarEventPopup=function(e){const t=e.dispatch;return()=>{const{mode:a}=e.getState();return a===r.Mode.INCOMING?Promise.reject(r.CallErrorType.ALREADY_IN_CALL).catch(X):Promise.resolve().then((()=>{t({type:r.E_ACTION.TOGGLE_POPUP_CALENDAR_PLANNING,data:r.POPUP_PLAN_CALENDAR_EVENT})}))}}(b),e.store=b;const Ie=(0,P.getWarningBrowserInfo)(oe.config.browserWarnings);if(null==Ie?void 0:Ie.block){const t=()=>b.dispatch({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.START}),a=e=>b.dispatch({type:r.E_ACTION.CHANGE_MODE,mode:r.Mode.START,joinLink:e});e.call=t,e.startGroupCall=t,e.startCall=t,e.acceptCall=t,e.joinCallByLink=a,e.showJoinPopup=t,e.showCallByNamePopup=t,e.showCreateCallByLinkPopup=t,e.showPlanCalendarEventPopup=t}const ye=(0,n._)((function*(){if((0,S.isParticipantAnonym)(b.getState().me)||e.authorized)return;let n=a.token;(0,S.isParticipantAnonym)(b.getState().me)||n||(n=yield _.fetchToken(b.getState().isDev),_.saveLocalToken(n,b.getState().me)),yield t.authorize(n),e.authorized=!0})),Ne=(0,l.tokenValidateRetryWrapper)(ee.bind(null,t,e,b),ye);yield t.init(Te),oe.config.debugLog&&e.setDebug(!0),function(e,t){t.enableVmoji&&!t.sferum&&I.isBrowserSupported()&&e.setVmoji(I,e,{useFullClientRendering:!1,useImageBitmapIfAvailable:!1,useInitialFPSLimiting:!0,useMainThreadRendering:!0,useFPSControl:!1,useTaskThrottling:!1,decoderOptions:{useFrameBatching:!1,useLowResolution:!1}})}(t,oe.config),yield Ne()}))).apply(this,arguments)}function X(e){if(e===r.CallErrorType.ALREADY_IN_CALL)console.log("Already in call");else console.log(e)}function ee(e,t,a){return function(e,t,a){return te.apply(this,arguments)}(e,t,a).catch((e=>{t.eventHandlers.onError&&e&&t.eventHandlers.onError(e),console.error("Could not authorize with token request",e)}))}function te(){return(te=(0,n._)((function*(e,t,a){const n=yield _.fetchToken(a.getState().isDev);yield e.authorize(n),t.authorized=!0,_.saveLocalToken(n,a.getState().me)}))).apply(this,arguments)}function ae(e){return new Promise((t=>{e.initializing.finally((()=>{t()}))}))}function ne(e,t,a,n,o){return oe.apply(this,arguments)}function oe(){return(oe=(0,n._)((function*(e,t,a,n,o,i=!1){const l=!n&&!t.authorizedGroupId,c=n&&t.authorizedGroupId===n;if(l||c)return;i||(C.callStats.setEventCommonData(),o({type:r.E_ACTION.SET_GROUP_MEMBERS,groupMembersCount:0,groupMembers:[],unableToCallGroupMembersIds:[]}));const{token:d}=yield(0,s.getCallAuthToken)(a.getState().isDev,n);if(yield e.authorize(d),t.authorizedGroupId=n,i||!n)return;const{groups:u}=yield(0,s.getGroupById)(-n);if(u){const[e]=u;o({type:r.E_ACTION.SET_GROUP,groupId:n,meGroup:(0,b.normalizeGroup)(e)}),C.callStats.setEventCommonData({group_id:n})}}))).apply(this,arguments)}function ie(e,t,a,n,o=0,i=[],r=!1){const s=a.getState(),c=e.authorizedGroupId?e.id:0,d=(0,l.createPayload)(o,n,c);if(!o)return t.callTo(void 0,n,d,!0,void 0,r);if(!(0,h.isGroupCallByPeer)(o))return de(e,a,o).then((e=>(t.forceRelayPolicy(e),t.callTo(o.toString(),n,d,void 0,void 0,r))));const u=i.filter((e=>(e=Number(e),(0,m.isUserPeer)(e)&&e!==a.getState().me)));return Object.keys(s.friendsCache).length?t.callTo(u,n,d,!0,void 0,r):(0,v.loadFriendsAction)(e,s,a.dispatch).then((()=>t.callTo(u,n,d,!0,void 0,r)))}function re(e,t,a){const n=e.dispatch;if(!!!a&&!t)return Promise.reject("Cannot load data");return(a?Promise.resolve((0,l.convertClientData)(a)):(0,s.retryLoadCallPeers)(t).then(l.convertServerData)).then((e=>{const[a,o,i]=e;return(0,v.setActiveCallData)(n,i||a),n({type:r.E_ACTION.LOAD_PEERS,conversation:a,members:o,peerId:t}),e}))}function se(e,t,a){const n=e.dispatch;return!!a&&t?(0,s.retryLoadCallPeers)(t).then((e=>{const[t,a]=(0,l.convertServerData)(e);return(0,v.setActiveCallData)(n,e.items[0]),(0,d.preloadImagesFromResponse)([t,a])})).then((([e,t])=>{n({type:r.E_ACTION.LOAD_PEERS,conversation:e,members:t})})):Promise.resolve()}function le(e,t,a){switch(!0){case(e=>{const{hangup:t,message:a}=e||{};return!(!t||!a)})(e):case(e=>{const{hangup:t,message:a}=e||{};return a&&void 0===t})(e):return(0,l.getTextForServerError)(e.message,t,a);case(e=>{var t;return["TypeError","SyntaxError","RangeError","EvalError","URIError"].includes(null==e||null==(t=e.__proto__)?void 0:t.name)})(e):return a("calls_error");case(e=>{const{error_msg:t}=e;return!!t})(e):return(0,l.getTextForServerError)(e.error_msg,t,a);case(e=>"number"==typeof e)(e):return(0,l.getTextForClientError)(e,t,a);case(e=>!!e)(e):default:return a("calls_sorry_error")}}function ce(e,t,a,n,o,i){try{var s;const c=le(e,n,o);var l;if(t.hangup(),a.eventHandlers.onError&&e&&a.eventHandlers.onError(e),(0,T.debugMessage)(T.DebugMessageType.ERROR,e),console.error(e),i({type:r.E_ACTION.ERROR,text:c,handleType:r.ErrorHandleType.FATAL}),null==(s=a.eventHandlers)?void 0:s.onErrorStartCall)null==(l=a.eventHandlers)||l.onErrorStartCall()}catch(a){throw(0,T.debugMessage)(T.DebugMessageType.ERROR,a),console.error(a),t.hangup(),e}}function de(e,t,a){const n=t.getState();return n.ipSettingEnabled&&"all"!==n.privacySettings.callsIp?(0,m.isChatPeer)(a)?Promise.resolve(!0):e.isFriend?Promise.resolve(!e.isFriend(a)):Object.keys(n.friendsCache).length>0?Promise.resolve(!n.friendsCache[a]):(0,l.exponentialRetry)(v.loadFriendsAction)(e,n,t.dispatch).then((()=>de(e,t,a))):Promise.resolve(!1)}function ue(e,t,a={}){const n=function(e,t){if(!(t.conversationOptions||{}).hasOwnProperty(T.ConversationOption.FEEDBACK))return(0,o._)({},t,{conversationOptions:(0,o._)({},t.conversationOptions,{FEEDBACK:!0})});return t}(0,a);n.conversationOptions&&Object.keys(n.conversationOptions).length>0&&e.changeConversationOptions(n.conversationOptions),n.mediaOptions&&Object.keys(n.mediaOptions).length>0&&e.muteParticipant({muteStates:n.mediaOptions}).catch(c.handlePromiseError)}function pe(e,t){return(0,S.isSameExternalId)(e,t.externalId)}function _e(e,{isNeedNotification:t=!0,featuresPerRole:a}){const n=(0,l.anyMatchInArray)(null==a?void 0:a[T.ConversationFeature.MOVIE_SHARE],[T.UserRole.ADMIN,T.UserRole.CREATOR]);t&&e({type:r.E_ACTION.CALL_NOTIFICATION,notification:{type:n?r.NotificationType.ADMIN_MUTE_PERMANENT_WATCH_TOGETHER:r.NotificationType.ADMIN_UNMUTE_PERMANENT_WATCH_TOGETHER}}),e({type:r.E_ACTION.SET_GLOBAL_MOVIE_SHARE_PERMISSION,data:n})}function me(e,t,a,n){return he.apply(this,arguments)}function he(){return(he=(0,n._)((function*(e,t,a,n){const o=a.dispatch,i=a.getState(),r=yield(0,w.getParticipantListChunk)(t,{count:0,roomId:n});e.debug&&console.warn("refetchParticipants",{participantsChunk:r});const s=r.participants;(0,V.updateRoomParticipants)(o,n,{participantIds:s.map((e=>e.uid))}),(0,E.addParticipantsToStoreThrottled)(i,o,s,n,!0)}))).apply(this,arguments)}},38275:(e,t,a)=>{"use strict";a.d(t,{getCallStatus:()=>h,getCallTimer:()=>_,getHangupStatus:()=>m});var n=a(785893),o=a(22412),i=a(78279),r=a(878198),s=a(464380),l=a(883828),c=a(533262),d=a(495457),u=a(496111),p=a(723689);function _(e){return e?(0,n.jsx)(i.CallTimer,{duration:(0,r.calculateCallDuration)(e)}):null}function m(e,t){if(e.hangupType)switch(e.hangupType){case o.HANGUP_TYPE_BUSY:return t("calls_busy");case o.HANGUP_TYPE_CALLEE_IS_OFFLINE:return t("calls_callee_is_offline");case o.HANGUP_TYPE_REJECTED:return t("calls_rejected_status");case o.HANGUP_TYPE_CANCELED:case o.HANGUP_TYPE_MISSED:case o.HANGUP_TYPE_HUNGUP:case o.HANGUP_TYPE_REMOVED:return null;case o.HANGUP_TYPE_CALLER_IS_BLOCKED:case o.HANGUP_TYPE_EXTERNAL_API_ERROR:case o.HANGUP_TYPE_FAILED:case o.HANGUP_TYPE_NOT_FRIENDS:case o.HANGUP_TYPE_OLD_VERSION:case o.HANGUP_TYPE_SERVICE_DISABLED:case o.HANGUP_TYPE_NOT_FOUND:case o.HANGUP_TYPE_UNKNOWN_ERROR:case o.HANGUP_TYPE_UNSUPPORTED:return t("calls_error")}return null}const h=(e,t)=>e?m(e,t)||((e,t)=>{let a=null;a=t===e.me?e.localDevice:(0,u.getPeerIdDeviceInfo)(t,e.devices);const o=(0,p.isMiniAppSource)(e.entryPoint);var i;return a&&a.status===s.ParticipantStatus.CONNECTED||a&&a.status===s.ParticipantStatus.WAITING_HALL||(0,u.getActiveParticipantsCount)(e)<2?null:(0,n.jsx)(l.ParticipantStatusContainer,{status:null!=(i=null==a?void 0:a.status)?i:s.ParticipantStatus.WAITING,isMiniApp:o})})(e,(0,d.isGroupCallByPeer)(e.peer)?e.me:e.peer)||((e,t)=>void 0===((0,d.isGroupCallByPeer)(e.peer)?e.callData.ts:e.callData.localTimeStamp)?(0,n.jsx)(c.default,{children:t("calls_status_waiting")}):null)(e,t):""},783492:(e,t,a)=>{"use strict";a.d(t,{fetchUserSettings:()=>l});var n=a(162532),o=a(465768),i=a(97547),r=a(22412),s=a(659397);function l(){return(0,s.isUndefined)(i.videoOptionsStorage.getOptions().skip_join_call_prompt)?(0,n.callsGetUserSettings)().then((e=>{i.videoOptionsStorage.saveOption(r.EVideoOptionType.IS_SKIP_JOIN_CALL_PROMPT,e.skip_join_screen)})).catch(o.handlePromiseError):Promise.resolve()}},66388:(e,t,a)=>{"use strict";a.d(t,{localVolumeDetectorGenerator:()=>o,volumesDetectorGenerator:()=>i});var n=a(496111);function o(e){const{onVolumeLevelReached:t,needCheckMicEnabled:a,vectorLength:n,volumeLevelDetection:o,callbackFactorStep:i,sensitivityCoefficient:r,onVolumeLevelUpdated:s,debugCallback:l}=e,c=function(e){const t=[];let a=0;return n=>{if(t.push(n),a+=n,t.length>e){const e=t.shift();a-=e||0}return a/t.length}}(n);let d=0,u=!1;return(...e)=>{l&&l(e);const[n,p]=e,_=n>o;u!==_&&s&&s(_),u=_,0!==d&&p&&(d=0);const m=c(n);a&&p||n/m>(1+d)/r&&n>o&&(d+=i,t())}}function i(e){const{onUpdate:t,volumeLevelDetection:a,debugCallback:o}=e;let i={},r=[],s={},l=[];return(...e)=>{o&&o(e);const[c]=e;s=Object.keys(s).reduce(((e,t)=>(s[t]-1>0&&(e[t]=s[t]-1),e)),{});const d=c.reduce(((e,{uid:t,volume:o})=>{const i=(0,n.externalIdToString)(t);return o>a&&(e[i]=!0,s[i]=3),e}),{});l=Object.keys(s);let u=!1;const p={speakers:i,speakersInHeader:r};(function(e,t){const a=Object.keys(e),n=Object.keys(t);if(a.length!==n.length)return!1;return a.every((e=>t[e]))})(i,d)||(p.speakers=d,i=d,u=!0),function(e,t){if(e.length!==t.length)return!1;return e.every(((e,a)=>e===t[a]))}(r,l)||(p.speakersInHeader=l,r=l,u=!0),u&&t(p)}}},998507:(e,t,a)=>{"use strict";a.d(t,{wakeLockRelease:()=>u,wakeLockRequest:()=>d});const n="wakeLock"in navigator&&!0;let o,i=null,r=!1;const s=()=>{null!==i&&"visible"===document.visibilityState&&d()},l=()=>{o||(o=document.createElement("video"),o.setAttribute("title","Wake lock"),o.setAttribute("playsinline",""),((e,t,a)=>{const n=document.createElement("source");n.src=a,n.type=`video/${t}`,e.appendChild(n)})(o,"mp4","data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="),o.addEventListener("loadedmetadata",(()=>{o&&o.addEventListener("timeupdate",(()=>{o&&o.currentTime>.5&&(o.currentTime=Math.random())}))}))),o.play().catch((()=>{}))},c=()=>{o&&o.pause()};function d(){if(!n)return l();r||(r=!0,document.addEventListener("visibilitychange",s));try{navigator.wakeLock.request("screen").then((e=>{i=e,i.addEventListener("release",(()=>{}))}))}catch(e){console.error(`${e.name}, ${e.message}`)}}function u(){if(!n)return c();i&&i.release().then((()=>{i=null}))}},581251:(e,t,a)=>{"use strict";a.d(t,{callStatDataStorage:()=>s});var n=a(434788),o=a(464380);let i={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null};function r(e){switch(e){case o.ParticipantStatus.WAITING:return 1;case o.ParticipantStatus.CONNECTING:return 2;case o.ParticipantStatus.CONNECTED:return 3;default:return 0}}const s={get:()=>i,set(e){var t,a;i=(0,n._)({},i,e,{connectionStep:(t=e.connectionStep,a=i.connectionStep,t&&r(t)&&r(t)>r(a)?t:a)})},reset(){i={timeStart:null,entryPoint:null,startType:null,isGroupCall:!1,hadVideoEnabled:!1,isOutgoingCall:!1,connectionStep:null}}}},301869:(e,t,a)=>{"use strict";a.d(t,{addCallStatEvent:()=>l,setStatlogEventsHandler:()=>s});var n=a(22412),o=a(581251),i=a(464380);let r;function s(e){r=e}function l(e,t,a,i){const{startType:s,entryPoint:l,timeStart:d,isGroupCall:u,hadVideoEnabled:p,isOutgoingCall:_}=o.callStatDataStorage.get(),m=!e||e===n.HANGUP_TYPE_HUNGUP&&!a,h=s&&function(e,t,a){let o;o=e===n.CallType.VIDEO?t?n.CallStatReachedType.GROUP_VIDEO:n.CallStatReachedType.VIDEO:a?t?n.CallStatReachedType.GROUP_AUDIO_TO_VIDEO:n.CallStatReachedType.AUDIO_TO_VIDEO:t?n.CallStatReachedType.GROUP_AUDIO:n.CallStatReachedType.AUDIO;return o}(s,u,p),g={type:h,result:m?n.CallStatResult.SUCCESS:n.CallStatResult.FAIL,failReason:m?null:c(e,a),callSource:l,totalDuration:d?Date.now()-d:0};_&&(i&&console.log(g),function(e,t){const a=[t.type||"",t.result,t.failReason||"",t.callSource||"",t.totalDuration];r&&r({name:"call_stats",value:e,keys:a})}(t,g))}function c(e,t){const a=o.callStatDataStorage.get().isOutgoingCall,r=o.callStatDataStorage.get().connectionStep;switch(!0){case t:return n.CallStatFailReason.CONNECTION_LOST;case e===n.HANGUP_TYPE_CANCELED:return n.CallStatFailReason.LOCAL_DECLINE;case e===n.HANGUP_TYPE_REJECTED:return n.CallStatFailReason.REMOTE_DECLINE;case e===n.HANGUP_TYPE_BUSY:return n.CallStatFailReason.REMOTE_BUSY;case e===n.HANGUP_TYPE_MISSED:return a?n.CallStatFailReason.REMOTE_TIMEOUT:null;case r===i.ParticipantStatus.CONNECTING:return n.CallStatFailReason.REMOTE_FAILED_ACCEPT;case!r:return n.CallStatFailReason.REMOTE_NO_CONNECT;default:return null}}},204651:(e,t,a)=>{"use strict";a.d(t,{fetchToken:()=>l,saveLocalToken:()=>s});var n=a(11010),o=a(659397),i=a(162532);const r=e=>"calls_token"+(e?`_${e}`:"");function s(e,t){o.localStorage.setItem(r(t),e)}function l(e){return c.apply(this,arguments)}function c(){return(c=(0,n._)((function*(e){const{token:t}=yield(0,i.getCallAuthToken)(e);return t}))).apply(this,arguments)}},687741:(e,t,a)=>{"use strict";a.d(t,{getStreamModeIcon:()=>l});var n=a(785893),o=a(682389),i=a(382210),r=a(402622),s=a(464380);const l=e=>{switch(e){case s.MediaType.STREAM:case s.MediaType.MOVIE:return(0,n.jsx)(o.Icon16LogoVkVideo,{});case s.MediaType.SCREEN:return(0,n.jsx)(i.Icon16ArrowUpRectangle,{});case s.MediaType.CAMERA:default:return(0,n.jsx)(r.Icon16Videocam,{})}}},146679:(e,t,a)=>{"use strict";a.d(t,{decode:()=>o});var n=a(788822);const o=e=>(0,n.escape)((0,n.decodeHTMLEntities)(e||""))},455877:(e,t,a)=>{var n=a(423570),o=a(171171),i=o;i.v1=n,i.v4=o,e.exports=i}}]);try{stManager.done("dist/6123249bcee4d238bc24bb8788c6c54f.81d3e5a7e33bb267555b.js")}catch(e){}