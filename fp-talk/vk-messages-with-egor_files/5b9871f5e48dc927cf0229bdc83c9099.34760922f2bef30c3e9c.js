"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[35699],{377976:(e,t,s)=>{s.d(t,{API:()=>v});var r,i,o=s(434788),n=s(393356),a=s(401623),c=s(283085),d=s(618430),u=s(647827),l=s(183746),h=s(722223);const p="undefined"!=typeof window&&(null==(r=window.vk)||null==(i=r.apiConfigDomains)?void 0:i.apiDomain)||"api.vk.com";class v extends a.CallbackService{setOptions(e){this.options=(0,o._)({},this.options,e)}execute(e){return this.call("execute",e)}procedure(e,t){return this.call(`execute.${e}`,t)}call(e,t){return this.callWithRequest(new a.APIRequest({method:e,params:t,api:this}))}callWithRequest(e){return this.worker.enqueue(e),e.promise}getWorker(){switch(this.options.mode){case h.APIMode.PARALLEL:return new c.ParallelWorker(this);case h.APIMode.SEQUENTIAL:return new d.SequentialWorker(this)}}constructor(e,t={}){super(),this.globalParams=new Map,this.options=(0,o._)({token:"",mode:h.APIMode.SEQUENTIAL,requestMode:h.APIRequestMode.SEQUENTIAL,requestMethod:h.APIRequestMethod.FETCH,wait:3e3,limit:3,bridge:!1,version:n.API_VERSION,baseUrl:`https://${p}`,retryLimit:3,timeout:6e4,executeCount:25,language:"ru",executeUnsupportedMethods:["photos.save","photos.saveWallPhoto","photos.saveOwnerPhoto","photos.saveMessagesPhoto","messages.setChatPhoto","photos.saveMarketPhoto","photos.saveMarketAlbumPhoto","audio.save","docs.save","photos.saveOwnerCoverPhoto","stories.save","polls.savePhoto"]},e);for(const e of u.methodGroups)this[e]=new Proxy(Object.create(null),{get:(t,s)=>(t,r)=>this.callWithRequest(new a.APIRequest({api:this,method:`${e}.${s}`,params:t,options:r}))});this.worker=this.getWorker(),this.updates=new l.Updates(this,t)}}},513222:(e,t,s)=>{s.d(t,{CaptchaType:()=>o,MINIMUM_TIME_INTERVAL_API:()=>i,POLLING_VERSION:()=>r});const r=10,i=1133;var o;!function(e){e.API="API",e.DIRECT_AUTH="DIRECT_AUTH",e.IMPLICIT_FLOW_AUTH="IMPLICIT_FLOW_AUTH",e.ACCOUNT_VERIFICATION="ACCOUNT_VERIFICATION"}(o||(o={}))},432043:(e,t,s)=>{s.d(t,{APIError:()=>o});var r=s(602033),i=s(5874);class o extends i.VKError{constructor(e){const t=Number(e.error_code);switch(super({code:t,message:`Code №${t} - ${e.error_msg}`}),this.params=e.request_params,t===r.API_ERROR_CAPTCHA&&(this.captchaSid=Number(e.captcha_sid),this.captchaImg=e.captcha_img),t){case r.API_ERROR_CAPTCHA:this.captchaSid=Number(e.captcha_sid),this.captchaImg=e.captcha_img;break;case r.API_ERROR_AUTH_VALIDATION:this.redirectUri=e.redirect_uri;break;case r.API_ERROR_NEED_CONFIRMATION:this.confirmationText=e.confirmation_text}}}},752448:(e,t,s)=>{s.d(t,{ExecuteError:()=>i});var r=s(432043);class i extends r.APIError{constructor(e){super({error_code:e.error_code,error_msg:e.error_msg,request_params:[]}),this.method=e.method}}},695007:(e,t,s)=>{s.d(t,{OAuthError:()=>i});var r=s(5874);class i extends r.VKError{constructor({error:e,error_description:t}){super({code:e,message:t})}}},869489:(e,t,s)=>{s.d(t,{UpdatesError:()=>i});var r=s(5874);class i extends r.VKError{}},5874:(e,t,s)=>{var r;s.d(t,{SharedErrorCode:()=>r,VKError:()=>i}),function(e){e.UNSUPPORTED_MODE="UNSUPPORTED_MODE",e.MISSING_CAPTCHA_HANDLER="MISSING_CAPTCHA_HANDLER",e.MISSING_TOKEN_REGENERATE_HANDLER="MISSING_TOKEN_REGENERATE_HANDLER"}(r||(r={}));class i extends Error{constructor({code:e,message:t}){super(t),this.code=e,this.name=this.constructor.name}}},526511:(e,t,s)=>{s.d(t,{CallbackService:()=>i});var r=s(5874);class i{get hasCaptchaHandler(){return void 0!==this.captchaHandler}onCaptcha(e){return this.captchaHandler=e,this}processingCaptcha(e){const{captchaHandler:t}=this;return t?new Promise(((s,r)=>{t(e,(e=>new Promise(((t,i)=>{if(e instanceof Error)return i(e),void r(e);s({key:e,validate:{resolve:t,reject:i}})}))))})):Promise.reject(new r.VKError({code:r.SharedErrorCode.MISSING_CAPTCHA_HANDLER,message:"Missing captcha handler"}))}get hasTokenRegenerateHandler(){return void 0!==this.tokenRegenerateHandler}onTokenRegenerate(e){return this.tokenRegenerateHandler=e,this}processingTokenRegenerate(){const{tokenRegenerateHandler:e}=this;return void 0===e?Promise.reject(new r.VKError({code:r.SharedErrorCode.MISSING_TOKEN_REGENERATE_HANDLER,message:"Missing token regenerate handler"})):new Promise(((t,s)=>{e((e=>new Promise(((r,i)=>{if(e instanceof Error)return i(e),void s(e);t({token:e,validate:{resolve:r,reject:i}})}))))}))}}},565579:(e,t,s)=>{s.d(t,{EventDispatcher:()=>r});class r{hasEventListener(e,t){return this.listeners.some((s=>s.type===e&&s.listener===t))}addEventListener(e,t,s={}){return this.hasEventListener(e,t)||this.listeners.push({type:e,listener:t,options:s}),this}removeEventListener(e,t){const s=this.listeners.findIndex((s=>s.type===e&&s.listener===t));return-1!==s&&this.listeners.splice(s,1),this}removeEventListeners(){return this.listeners=[],this}dispatchEvent(e){return this.listeners.filter((t=>t.type===e.type)).forEach((t=>{const{type:s,listener:r,options:{once:i}}=t;r.call(this,e),i&&this.removeEventListener(s,r)})),this}constructor(){this.listeners=[]}}},401623:(e,t,s)=>{s.d(t,{APIRequest:()=>r.APIRequest,CallbackService:()=>i.CallbackService});var r=s(17318),i=s(526511)},17318:(e,t,s)=>{s.d(t,{APIRequest:()=>d});var r=s(11010),i=s(434788),o=s(363476),n=s.n(o),a=s(372322),c=s(48989);class d{toString(){return(0,c.getExecuteMethod)(this.method,this.params)}get filteredParams(){const{options:{token:e,version:t,language:s}}=this.api;return Object.fromEntries([...Object.entries((0,i._)({},!this.isCustomMethod&&{v:t,access_token:e},{lang:s},this.params)),...this.api.globalParams.entries()].filter((([,e])=>void 0!==e)))}get isCustomMethod(){const{requestMethod:e}=this.api.options;return"function"==typeof e}make(){var e=this;return(0,r._)((function*(){const{options:{timeout:t,requestMethod:s}}=e.api;e.timeout=setTimeout((()=>{var t;return null==(t=e.options.abortController)?void 0:t.abort()}),t);try{return e.isCustomMethod?yield e.custom():yield e[s]()}finally{clearTimeout(e.timeout)}}))()}fetch(){const{abortController:e}=this.options,{options:{baseUrl:t}}=this.api;return fetch(new URL(`/method/${this.method}`,t),{method:"POST",signal:null==e?void 0:e.signal,headers:{connection:"keep-alive"},body:new URLSearchParams(this.filteredParams)}).then((e=>e.json()))}bridge(){const{abortController:e}=this.options;return new Promise(((t,s)=>{(null==e?void 0:e.signal.aborted)&&s(e.signal.reason),null==e||e.signal.addEventListener("abort",(()=>{s(e.signal.reason)})),n().send("VKWebAppCallAPIMethod",{method:this.method,params:this.filteredParams}).then(t).catch((e=>{const{error_data:s}=e;t({error:(null==s?void 0:s.error_reason)||s||e})}))}))}script(){const{abortController:e}=this.options,{options:{baseUrl:t}}=this.api;return new Promise(((s,r)=>{(null==e?void 0:e.signal.aborted)&&r(e.signal.reason);const i=(0,a.generateId)(20),o=new URLSearchParams(this.filteredParams);o.set("callback",i);const n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=new URL(`/method/${this.method}?${o}`,t).toString(),window[i]=e=>{n.remove(),delete window[i],s(e)},null==e||e.signal.addEventListener("abort",(()=>{n.remove(),delete window[i],r(e.signal.reason)})),document.head.appendChild(n)}))}custom(){const{abortController:e}=this.options,{requestMethod:t}=this.api.options;if("function"==typeof t)return new Promise(((s,r)=>{(null==e?void 0:e.signal.aborted)&&r(e.signal.reason),null==e||e.signal.addEventListener("abort",(()=>{r(e.signal.reason)})),t(this.method,this.filteredParams).then(s).catch(r)}))}constructor({api:e,method:t,params:s={},options:r={}}){var o;this.retries=0,this.api=e,this.method=t,this.params=(0,i._)({},s),this.options=(0,i._)({},r),null!=(o=this.options).abortController||(o.abortController=new AbortController),this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}},506945:(e,t,s)=>{s(667294)},964548:(e,t,s)=>{s.d(t,{API:()=>r.API,StickersQueueEventType:()=>a.StickersQueueEventType,UpdatesSource:()=>o.UpdatesSource,VKError:()=>i.VKError,VmojiQueueEventType:()=>n.VmojiQueueEventType,getRandomId:()=>c.getRandomId});var r=s(377976),i=(s(722223),s(695007),s(869489),s(752448),s(5874)),o=(s(432043),s(183746)),n=s(563772),a=s(513080),c=(s(85158),s(456079),s(187684),s(969042),s(506945),s(167718));s(153473),s(517283)},647827:(e,t,s)=>{s.d(t,{methodGroups:()=>r});const r=["account","accountVerification","actionLinks","address","adex","admins","ads","adsint","adsweb","aliexpress","antispam","appWidgets","apps","articles","asr","audio","audioSearch","auth","authorsMarketplace","autotests","badges","bestFriends","biz","blogforce","board","bot","botsConf","bugtracker","calls","captcha","cashout","catalog","channels","classifieds","combo","coupons","crowd","database","deliveryClub","docs","documentation","donut","downloadedGames","education","educationCloud","educationForeign","educationParents","educationPolls","educationReport","educationUser","email","esia","exchange","exchangeRates","execute","experts","explore","externalAudioMatching","externalUsers","fave","finance","findMe","forbiddenRegistry","fortuneSquare","fortuneWheel","friends","gamesPromo","gifts","golunch","goodsOrders","groups","healthApp","healthCommon","healthLoyalty","id","identity","instManager","interests","internal","leadForms","leads","lifeEvents","likes","lovina","loyalty","loyaltyTeen","market","marusia","masks","matching","memories","messages","microlandings","mobile","money","multiaccount","musicManager","narratives","newsfeed","nft","nospam","notes","notifications","odnoklassniki","onboarding","orders","pages","phones","photos","places","platform","platformConsole","podcasts","podcastsOffice","polls","prettyCards","promoCodes","questions","queue","reports","restore","rewardedAds","rightholders","search","secure","serverCalls","serverEffects","settings","shortVideo","signals","situationalSuggests","sms","social","specials","statEvents","stats","statsDashboard","status","stickers","storage","store","stories","streaming","studentsVerification","studio","superApp","support","survey","tags","textlives","tickets","tinkoff","translations","uma","users","utils","uxpolls","verification","video","videoPostcards","vkCharity","vkMusic","vkRun","vkStart","vkTaxi","vkUp","vkdrive","vkstore","vmoji","voicerooms","wall","weather","widgets","widgetsIOS","widgetsKit","wishlists"]},722223:(e,t,s)=>{var r,i,o;s.d(t,{APIMode:()=>r,APIRequestMethod:()=>o,APIRequestMode:()=>i}),function(e){e.PARALLEL="parallel",e.SEQUENTIAL="sequential"}(r||(r={})),function(e){e.SEQUENTIAL="sequential",e.BURST="burst"}(i||(i={})),function(e){e.FETCH="fetch",e.SCRIPT="script",e.BRIDGE="bridge"}(o||(o={}))},513080:(e,t,s)=>{var r;s.d(t,{StickersQueueEvent:()=>i,StickersQueueEventType:()=>r}),function(e){e.UGC_USER_UPDATE="ugc_user_update",e.UGC_PACK_UPDATE="ugc_pack_update",e.UGC_OWNER_UPDATE="ugc_owner_update",e.UGC_STICKER_UPDATE="ugc_sticker_update"}(r||(r={}));class i extends CustomEvent{constructor(e,t){super(e,{detail:t})}}},718557:(e,t,s)=>{s.d(t,{handlerStickersQueueEvent:()=>c});var r=s(513080),i=s(85158),o=s(456079),n=s(187684),a=s(969042);function c(e,{data:t}){const{type:s}=t;switch(s){case r.StickersQueueEventType.UGC_PACK_UPDATE:e.dispatchEvent(new i.StickersUGCPackUpdate(t));break;case r.StickersQueueEventType.UGC_USER_UPDATE:e.dispatchEvent(new o.StickersUGCUserUpdate(t));break;case r.StickersQueueEventType.UGC_OWNER_UPDATE:e.dispatchEvent(new n.StickersUGCOwnerUpdate(t));break;case r.StickersQueueEventType.UGC_STICKER_UPDATE:e.dispatchEvent(new a.StickersUGCStickerUpdate(t))}}},187684:(e,t,s)=>{s.d(t,{StickersUGCOwnerUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_OWNER_UPDATE,e)}}},85158:(e,t,s)=>{s.d(t,{StickersUGCPackUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_USER_UPDATE,e)}}},969042:(e,t,s)=>{s.d(t,{StickersUGCStickerUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_STICKER_UPDATE,e)}}},456079:(e,t,s)=>{s.d(t,{StickersUGCUserUpdate:()=>i});var r=s(513080);class i extends r.StickersQueueEvent{constructor(e){super(r.StickersQueueEventType.UGC_USER_UPDATE,e)}}},563772:(e,t,s)=>{var r;s.d(t,{VmojiQueueEvent:()=>i,VmojiQueueEventType:()=>r}),function(e){e.AVATAR="avatar",e.STICKERS="stickers",e.CHARACTER="character",e.STICKERS_PRINT_REQUEST="stickers_print_request"}(r||(r={}));class i extends CustomEvent{constructor(e,t){super(e,{detail:t})}}},208911:(e,t,s)=>{s.d(t,{handleVmojiQueueEvent:()=>i});var r=s(563772);function i(e,{data:t}){const{type:s,query_id:i}=t;i&&e.dispatchEvent(new r.VmojiQueueEvent(i,t)),e.dispatchEvent(new r.VmojiQueueEvent(s,t))}},183746:(e,t,s)=>{s.d(t,{Updates:()=>m,UpdatesSource:()=>r});var r,i,o,n=s(11010),a=s(434788),c=s(820224),d=s(869489),u=s(565579),l=s(208911),h=s(718557),p=s(131942),v=s(513222);!function(e){e.USER="user",e.GROUP="group",e.VMOJI="vmoji",e.STICKERS="stickers"}(r||(r={})),function(e){e.CHECK="a_check",e.RELEASE="a_release"}(i||(i={})),function(e){e.NEED_RESTART="NEED_RESTART",e.POLLING_REQUEST_FAILED="POLLING_REQUEST_FAILED"}(o||(o={}));class m extends u.EventDispatcher{start(){var e=this;return(0,n._)((function*(){if(!e.started){e.started=!0;try{const{server:t,key:s,ts:o}=yield e.getLongPollServer();switch(0===e.ts&&(e.ts=o),e.url=new URL(t),e.url.searchParams.set("key",s),e.url.searchParams.set("act",i.CHECK),e.url.searchParams.set("wait","25"),e.url.searchParams.set("mode",String(e.mode)),e.url.searchParams.set("version",String(v.POLLING_VERSION)),e.source){case r.VMOJI:case r.STICKERS:e.url.searchParams.set("id",String(e.userId))}e.startFetchLoop()}catch(t){throw e.started=!1,t}}}))()}getLongPollServer(){var e=this;return(0,n._)((function*(){let t;switch(e.source){case r.GROUP:t=yield e.api.groups.getLongPollServer({group_id:e.groupId});break;case r.VMOJI:case r.STICKERS:var s;s=yield e.api[e.source].subscribeToQueue().then((e=>{var{base_url:t}=e,s=(0,c._)(e,["base_url"]);return(0,a._)({server:t},s)})),t=s;break;case r.USER:default:t=yield e.api.messages.getLongPollServer({lp_version:v.POLLING_VERSION})}const{server:i}=t;return t.server=`${i.startsWith("https")?"":"https://"}${i}`,t}))()}stop(){var e=this;return(0,n._)((function*(){e.started=!1,e.restarted=0}))()}startFetchLoop(){var e=this;return(0,n._)((function*(){try{for(;e.started;)yield e.fetchUpdates()}catch(t){if(t.code!==o.NEED_RESTART&&e.restarted!==e.retryLimit)return e.restarted+=1,yield(0,p.wait)(3e3),void e.startFetchLoop();for(;e.started;)try{yield e.stop(),yield e.start();break}catch(t){console.log(t),e.started=!0,yield(0,p.wait)(e.wait)}}}))()}fetchUpdates(){var e=this;return(0,n._)((function*(){e.url.searchParams.set("ts",String(e.ts));const t=new AbortController,s=setTimeout((()=>t.abort()),3e4);let r;try{const s=yield fetch(e.url,{method:"GET",signal:t.signal,headers:{connection:"keep-alive"}});if(!s.ok)throw new d.UpdatesError({code:o.POLLING_REQUEST_FAILED,message:"Polling request failed"});r=yield s.json()}finally{clearTimeout(s)}if(void 0!==r.failed){if(1===r.failed)return void(e.ts=r.ts);throw e.ts=0,new d.UpdatesError({code:o.NEED_RESTART,message:"The server has been failed"})}e.restarted=0,e.ts=r.ts,r.pts&&(e.pts=Number(r.pts)),r.updates=r.updates||r.events||[];for(const t of r.updates)e.handleUpdate(t)}))()}handleUpdate(e){switch(this.source){case r.VMOJI:(0,l.handleVmojiQueueEvent)(this,e);break;case r.STICKERS:(0,h.handlerStickersQueueEvent)(this,e)}}constructor(e,t={}){super(),this.mode=202,this.started=!1,this.ts=0,this.pts=0,this.restarted=0,this.api=e;const{source:s,userId:r,groupId:i,wait:o,retryLimit:n}=t;this.source=s,this.userId=r,this.groupId=i,this.wait=o||3e3,this.retryLimit=n||3}}},372322:(e,t,s)=>{function r(e){const t="abcdefghijklmnopqrstuvwxyz";let s="";for(let r=0;r<e;r++)s+=t.charAt(Math.floor(26*Math.random()));return s}s.d(t,{generateId:()=>r})},517283:(e,t,s)=>{var r;s(363476);!function(e){e.WALL="wall",e.DOCS="docs",e.STATS="stats",e.VIDEO="video",e.PAGES="pages",e.NOTES="notes",e.MANAGE="manage",e.MARKET="market",e.PHOTOS="photos",e.STATUS="status",e.GROUPS="groups",e.OFFLINE="offline",e.STORIES="stories",e.FRIENDS="friends",e.MESSAGES="messages",e.APP_WIDGET="app_widget"}(r||(r={}))},868728:(e,t,s)=>{function r(e){return`return [${e.join(",")}];`}s.d(t,{getChainReturn:()=>r})},48989:(e,t,s)=>{s.d(t,{getExecuteMethod:()=>i});var r=s(206467);function i(e,t={}){return`API.${e}(${(0,r.getExecuteParams)(t)})`}},206467:(e,t,s)=>{function r(e){return JSON.stringify(e,((t,s)=>"object"==typeof s&&s!==e?String(s):s))}s.d(t,{getExecuteParams:()=>r})},153473:(e,t,s)=>{s(11010),s(432043),s(695007),s(131942)},167718:(e,t,s)=>{function r(){return Math.floor(1e4*Math.random())*Date.now()}s.d(t,{getRandomId:()=>r})},708672:(e,t,s)=>{function r(e,t){let s=0;t.response.forEach(((r,i)=>{const o=e[i];!1===r?(o.reject(t.errors[s]),s++):o.resolve(r)}))}s.d(t,{resolveExecuteTask:()=>r})},131942:(e,t,s)=>{function r(e){return new Promise((t=>{setTimeout(t,e)}))}s.d(t,{wait:()=>r})},283085:(e,t,s)=>{s.d(t,{ParallelWorker:()=>c});var r=s(11010),i=s(401623),o=s(618430),n=s(868728),a=s(708672);class c extends o.SequentialWorker{execute(){var e=this,t=()=>super.execute;return(0,r._)((function*(){const{queue:s}=e;if(e.isAllowedMethod(s[0].method))return void t().call(e);const{executeCount:r}=e.api.options,o=[];for(let t=0;t<e.queue.length&&(e.isAllowedMethod(s[t].method)||(o.push(s.splice(t,1)[0]),t-=1,!(o.length>=r)));t+=1);if(0===o.length)return;const c=new i.APIRequest({api:e.api,method:"execute",params:{code:(0,n.getChainReturn)(o.map(String))}});t().call(e,c);try{(0,a.resolveExecuteTask)(o,yield c.promise)}catch(e){for(const t of o)t.reject(e)}}))()}isAllowedMethod(e){return e.startsWith("execute")||this.api.options.executeUnsupportedMethods.includes(e)}}},618430:(e,t,s)=>{s.d(t,{SequentialWorker:()=>u});var r=s(11010),i=s(602033),o=s(614531),n=s(432043),a=s(752448),c=s(131942),d=s(513222);class u extends o.APIWorker{execute(e){var t=this;return(0,r._)((function*(){var s;if(e||(e=t.queue.shift()),!e)return;const{method:r}=e;let i;try{i=yield e.make()}catch(s){const{options:r}=t.api;var o;return e.retries===r.limit?(null==(o=e.captchaValidate)||o.reject(s),void e.reject(s)):(e.retries+=1,yield(0,c.wait)(r.wait),void t.requeue(e))}var d;void 0===i.error?(null==(s=e.captchaValidate)||s.resolve(),r.startsWith("execute")?e.resolve({response:i.response,errors:(i.execute_errors||[]).map((e=>new a.ExecuteError(e)))}):e.resolve(null!=(d=i.response)?d:i)):t.handleError(e,new n.APIError(i.error))}))()}handleError(e,t){var s=this;return(0,r._)((function*(){var r,o;const{code:n}=t;if(n===i.API_ERROR_TOO_MANY)return s.paused?void s.requeue(e):(s.pause(),yield(0,c.wait)(d.MINIMUM_TIME_INTERVAL_API),s.requeue(e),void s.resume());if(null==(r=e.captchaValidate)||r.reject(t),null==(o=e.tokenRegenerateValidate)||o.reject(t),n===i.API_ERROR_CAPTCHA&&s.api.hasCaptchaHandler)try{const{captchaSid:r}=t,{key:i,validate:o}=yield s.api.processingCaptcha({type:d.CaptchaType.API,src:t.captchaImg,sid:r,request:e});e.captchaValidate=o,e.params.captcha_sid=r,e.params.captcha_key=i,s.requeue(e)}catch(t){e.reject(t)}else if(n===i.API_ERROR_AUTH&&s.api.hasTokenRegenerateHandler)try{const{token:t,validate:r}=yield s.api.processingTokenRegenerate();s.api.options.token=t,e.tokenRegenerateValidate=r,s.requeue(e)}catch(t){e.reject(t)}else e.reject(t)}))()}}},614531:(e,t,s)=>{s.d(t,{APIWorker:()=>i});var r=s(513222);class i{enqueue(e){this.queue.push(e),this.immediateHeat()}requeue(e){this.queue.unshift(e),this.immediateHeat()}pause(){this.paused=!0}resume(){this.paused=!1,this.immediateHeat()}heat(){if(this.paused||this.busy||!this.queue.length)return;this.busy=!0;const{requestMode:e}=this.api.options;this[e]()}sequential(){this.execute(),setTimeout((()=>{this.busy=!1,this.immediateHeat()}),this.intervalPerRequests)}burst(){const e=Math.min(this.api.options.limit,this.queue.length);for(let t=0;t<e&&0!==this.queue.length;t+=1)this.execute();const t=Math.ceil(r.MINIMUM_TIME_INTERVAL_API-e*this.intervalPerRequests);setTimeout((()=>{this.busy=!1,this.immediateHeat()}),t<=0?r.MINIMUM_TIME_INTERVAL_API:t)}immediateHeat(){setTimeout((()=>this.heat()))}constructor(e){this.busy=!1,this.paused=!1,this.queue=[],this.api=e,this.intervalPerRequests=Math.ceil(r.MINIMUM_TIME_INTERVAL_API/this.api.options.limit)}}},822158:(e,t,s)=>{s.d(t,{AsyncAtom:()=>n});var r=s(11010),i=s(891047),o=s(873004);class n extends o.Atom{get(){const e=this.getKey();return(0,i.get)(e,this.base.store).then((e=>e||this.cache||null)).catch((t=>(console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null)))}set(e,t){var s=this,o=()=>super.set;return(0,r._)((function*(){const r=s.getKey();s.cache=e,yield(0,i.set)(r,e,s.base.store).catch((e=>{console.log(`${r}: Не удалось записать данные в хранилище`),console.log(e)})),o().call(s,e,t)}))()}delete(){const e=this.getKey();return delete this.cache,(0,i.del)(e,this.base.store).then((()=>{this.base.notify(this.key)})).catch((t=>{console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}))}constructor(e){super(e);const{base:t}=e;this.base=t}}},559205:(e,t,s)=>{s.d(t,{createAsyncStore:()=>a});var r=s(891047),i=s(131966),o=s(822158);class n extends i.Store{createAtom(e){return new o.AsyncAtom({key:e,base:this})}clear(){return(0,r.clear)(this.store).then((()=>{this.notify()}))}constructor(e){super(e);const{dbName:t,version:s}=e;this.store=(0,r.createStore)(`${t}-v${s}`,t)}}function a(e){return new n(e)}},873004:(e,t,s)=>{s.d(t,{Atom:()=>r});class r{set(e,{notify:t=!0}={}){t&&this.base.notify(this.key)}getKey(){return`${this.base.options.storeName}-${this.key}`}constructor({key:e,base:t}){this.key=e,this.base=t}}},131966:(e,t,s)=>{s.d(t,{Store:()=>r});class r{subscribe(e,t){const s=this.getListeners(t);return s.add(e),()=>{s.delete(e)}}notify(e,t){this.getListeners(t).forEach((t=>{t(e)}))}refresh(){try{localStorage.setItem(this.key,""),localStorage.removeItem(this.key)}catch(e){}}destroy(){this.listeners.clear(),this.syncListeners.clear(),r.instances.delete(this.key)}get key(){const{dbName:e,storeName:t,version:s}=this.options;return`${e}-v${s}-${t}`}getListeners(e){return e?this.syncListeners:this.listeners}constructor(e){this.listeners=new Set,this.syncListeners=new Set,this.options=e,r.instances.set(this.key,this)}}r.instances=new Map,window.addEventListener("storage",(({key:e,newValue:t})=>{if(!e||null===t)return;const s=r.instances.get(e);null==s||s.notify()}))},426775:(e,t,s)=>{s.d(t,{SyncAtom:()=>o,SyncAtomType:()=>r});var r,i=s(873004);!function(e){e.OBJECT="object",e.STRING="string",e.NUMBER="number",e.BOOLEAN="boolean",e.STRING_NUMBER="string_number"}(r||(r={}));class o extends i.Atom{get(){const e=this.getKey();try{let t=localStorage.getItem(e);if(!t)return null;switch(this.type){case r.OBJECT:try{t=JSON.parse(t)}catch(e){return null}break;case r.NUMBER:t=Number(t)||0;break;case r.STRING_NUMBER:t=Number(t)||t;break;case r.BOOLEAN:t=Boolean(Number(t))}return t}catch(t){return console.log(`${e}: Ошибка чтения данных из хранилища`),console.log(t),this.cache||null}}set(e,t){const s=this.getKey();let i;switch(this.type){case r.OBJECT:i=JSON.stringify(e);break;case r.BOOLEAN:i=String(Number(e));break;default:i=String(e)}try{localStorage.setItem(s,i)}catch(t){console.log(`${s}: Не удалось записать данные в хранилище`),console.log(t),this.cache=e}super.set(e,t)}delete(){const e=this.getKey();try{delete this.cache,localStorage.removeItem(e)}catch(t){console.log(`${e}: Ошибка удаления ключа из хранилища`),console.log(t)}}getKey(){return`${this.base.key}-${this.key}`}constructor(e){super(e);const{base:t,type:s}=e;this.base=t,this.type=s}}},380312:(e,t,s)=>{s.d(t,{createSyncStore:()=>n});var r=s(131966),i=s(426775);class o extends r.Store{createAtom(e,t){return new i.SyncAtom({key:e,type:t,base:this})}constructor(e){super(e)}}function n(e){return new o(e)}},503967:(e,t,s)=>{s.d(t,{PackContext:()=>u});var r=s(570912),i=s(615816),o=s(820224),n=(0,i._)("_options"),a=(0,i._)("_pack"),c=(0,i._)("_product"),d=(0,i._)("_stockItem");class u{get rawData(){return(0,r._)(this,a)[a]||(0,r._)(this,d)[d]||(0,r._)(this,c)[c]}get isPack(){return Boolean((0,r._)(this,a)[a])}get isProduct(){return Boolean((0,r._)(this,c)[c])}get isStockItem(){return Boolean((0,r._)(this,d)[d])}get isStoreItem(){return this.isProduct||this.isStockItem}get stockItem(){return(0,r._)(this,d)[d]}get id(){var e,t,s,i;const o=null==(e=(0,r._)(this,n)[n])||null==(t=e.redefine)?void 0:t.id;if(void 0!==o)return o;const d=null==(s=(0,r._)(this,c)[c])?void 0:s.id;return void 0!==d?d:null==(i=(0,r._)(this,a)[a])?void 0:i.id}setHint(e){return(0,r._)(this,n)[n]?((0,r._)(this,n)[n].hint=e,this):this}get hintId(){var e,t;return null==(e=(0,r._)(this,n)[n])||null==(t=e.hint)?void 0:t.id}get hintWidth(){var e,t;return null==(e=(0,r._)(this,n)[n])||null==(t=e.hint)?void 0:t.width}get index(){var e;return null==(e=(0,r._)(this,n)[n])?void 0:e.index}get referrer(){var e;return null==(e=(0,r._)(this,n)[n])?void 0:e.referrer}get tooltip(){var e;return null==(e=(0,r._)(this,n)[n])?void 0:e.tooltip}get title(){var e,t,s;return(null==(e=(0,r._)(this,n)[n])||null==(t=e.redefine)?void 0:t.title)||(null==(s=(0,r._)(this,c)[c])?void 0:s.title)||""}get stickers(){var e,t,s,i;return(null==(e=(0,r._)(this,n)[n])||null==(t=e.redefine)?void 0:t.stickers)||(null==(s=(0,r._)(this,a)[a])?void 0:s.stickers)||(null==(i=(0,r._)(this,c)[c])?void 0:i.stickers)}get baseId(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.base_id}get isStyle(){return void 0!==this.baseId}get hasStyles(){var e;return Boolean(null==(e=this.styleIds)?void 0:e.length)}get styleIds(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.style_ids}get canGift(){var e;return Boolean(null==(e=(0,r._)(this,d)[d])?void 0:e.can_gift)}get vmojiAvatar(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.vmoji_avatar}get isVmoji(){var e;return Boolean(this.vmojiAvatar||(null==(e=(0,r._)(this,c)[c])?void 0:e.is_vmoji))}get isNew(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.is_new}get previews(){var e;return null==(e=(0,r._)(this,c)[c])?void 0:e.previews}constructor(e){var{pack:t}=e,s=(0,o._)(e,["pack"]);Object.defineProperty(this,n,{writable:!0,value:void 0}),Object.defineProperty(this,a,{writable:!0,value:void 0}),Object.defineProperty(this,c,{writable:!0,value:void 0}),Object.defineProperty(this,d,{writable:!0,value:void 0}),(0,r._)(this,n)[n]=s,t&&("product"in t?((0,r._)(this,d)[d]=t,(0,r._)(this,c)[c]=t.product):"id"in t&&"type"in t?(0,r._)(this,c)[c]=t:(0,r._)(this,a)[a]=t)}}},879706:(e,t,s)=>{s.d(t,{$api:()=>c,APIGate:()=>d,changeAPIOptions:()=>a});var r=s(210929),i=s(842571),o=s(348354),n=s(478748);const a=o.stickersEmojiKeyboard.createEvent(),c=o.stickersEmojiKeyboard.createStore(new n.API({})).on(a,((e,{api:t})=>t)),d=(0,i.createGate)();(0,r.forward)({from:d.state,to:a})},326157:(e,t,s)=>{s.d(t,{$favoriteStickers:()=>o,setFavoriteStickers:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},237341:(e,t,s)=>{s.d(t,{$hasAvatar:()=>o,setHasAvatar:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},829596:(e,t,s)=>{s.d(t,{$packs:()=>p,ServicePackKey:()=>r});var r,i,o=s(210929),n=s(944952),a=s(734264),c=s(237341),d=s(703104),u=s(730368),l=s(326157),h=s(503967);!function(e){e[e.FAVORITE=-1]="FAVORITE",e[e.RECENT=-2]="RECENT",e[e.VMOJI=-3]="VMOJI",e[e.UGC=-4]="UGC"}(r||(r={})),function(e){e.RECENT="recent",e.FAVORITE="favourite",e.KEYBOARD="keyboard"}(i||(i={}));const p=(0,o.combine)(n.$ugcInfo,a.$ugcPacks,d.$stockItems,u.$recentStickers,l.$favoriteStickers,c.$hasAvatar,((e,t,s,o,n,a)=>{var c;const d=new Map;let u=[];const l=new Map;let p=0;if(!s||!o||!n)return{};n.length&&(d.set(r.FAVORITE,new h.PackContext({index:p,referrer:i.FAVORITE,redefine:{id:r.FAVORITE,title:"stickers_picker_favorite",stickers:n}})),u.push(r.FAVORITE),p++),o.length&&(d.set(r.RECENT,new h.PackContext({index:p,referrer:i.RECENT,redefine:{id:r.RECENT,title:"stickers_picker_recently_used",stickers:o}})),u.push(r.RECENT),p++);-1!==(null==s?void 0:s.findIndex((({product:{vmoji_avatar:e}})=>void 0!==e)))||a||(d.set(r.VMOJI,new h.PackContext({index:p,referrer:i.KEYBOARD,redefine:{id:r.VMOJI,title:"stickers_picker_vmoji"}})),u.push(r.VMOJI),p++);const v=null==t?void 0:t[0],m=null==e?void 0:e.can_edit,g=null==v||null==(c=v.stickers)?void 0:c.length,k=(null==e?void 0:e.show_keyboard_onboarding)&&m;if(!(null==e?void 0:e.is_keyboard_hidden)&&(g||k)){const e=new h.PackContext({pack:v,index:p,referrer:i.KEYBOARD,tooltip:{header:"stickers_picker_ugc_tooltip_title",text:"stickers_picker_ugc_tooltip_description"},redefine:{id:r.UGC,title:"stickers_picker_ugc"}});m&&e.setHint({id:"stickers:ugc_keyboard_onboarding_tooltip",width:176}),d.set(r.UGC,e),u.push(r.UGC),p++}return s.forEach((e=>{const{product:{id:t,vmoji_avatar:s}}=e;if(d.set(t,new h.PackContext({index:p,referrer:i.KEYBOARD,pack:e})),s){let e=l.get(s.id);e||(e=u.push([])-1,l.set(s.id,e));const r=u[e];Array.isArray(r)&&r.push(t)}else u.push(t);p++})),{packs:d,packsGroups:u}}))},703104:(e,t,s)=>{s.d(t,{$stockItems:()=>o,setStockItems:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},730368:(e,t,s)=>{s.d(t,{$recentStickers:()=>o,setRecentStickers:()=>i});var r=s(348354);const i=r.stickersEmojiKeyboard.createEvent(),o=r.stickersEmojiKeyboard.createStore(null).on(i,((e,t)=>t))},944952:(e,t,s)=>{s.d(t,{$ugcInfo:()=>l,reloadUGCInfo:()=>d,setUGCInfo:()=>c});var r=s(11010),i=s(210929),o=s(879706),n=s(348354),a=s(910850);const c=n.stickersEmojiKeyboard.createEvent(),d=n.stickersEmojiKeyboard.createEvent(),u=n.stickersEmojiKeyboard.createEffect((0,r._)((function*(e){return e.cache.ugcInfo.get().catch((()=>null))}))),l=n.stickersEmojiKeyboard.createStore(null).on(c,((e,t)=>t)).on(u.doneData,((e,t)=>t)).on(a.submitUGCReportFx.doneData,(()=>null));(0,i.sample)({clock:d,source:o.$api,target:u})},734264:(e,t,s)=>{s.d(t,{$ugcPacks:()=>n,setUGCPacks:()=>o});var r=s(348354),i=s(910850);const o=r.stickersEmojiKeyboard.createEvent(),n=r.stickersEmojiKeyboard.createStore(null).on(o,((e,t)=>t)).on(i.submitUGCReportFx.doneData,(()=>null))},910850:(e,t,s)=>{s.d(t,{submitUGCReport:()=>n,submitUGCReportFx:()=>a});var r=s(210929),i=s(879706),o=s(348354);const n=o.stickersEmojiKeyboard.createEvent(),a=o.stickersEmojiKeyboard.createEffect((e=>{e.cache.clearUGC()}));(0,r.sample)({clock:n,source:i.$api,target:a})},478748:(e,t,s)=>{s.d(t,{API:()=>d});var r=s(434788),i=s(820224),o=s(964548),n=s(164702),a=s(960294),c=s(254734);class d extends o.API{constructor(e){var{onAPIRequest:t}=e,s=(0,i._)(e,["onAPIRequest"]);const{userId:d}=s;super({requestMethod:t},{userId:d,source:"stickers"}),this.cache=new n.Cache((0,r._)({api:this},s)),this.updates.addEventListener(o.StickersQueueEventType.UGC_OWNER_UPDATE,a.stickersUGCOwnerUpdateHandler.bind(this)),this.updates.addEventListener(o.StickersQueueEventType.UGC_STICKER_UPDATE,c.stickersUGCStickerUpdateHandler.bind(this))}}},960294:(e,t,s)=>{function r({detail:{owner_global_id:e}}){this.cache.reloadUGC(e)}s.d(t,{stickersUGCOwnerUpdateHandler:()=>r})},254734:(e,t,s)=>{s.d(t,{stickersUGCStickerUpdateHandler:()=>n});var r=s(11010);const i=new Map,o=new Set;function n(e){return a.apply(this,arguments)}function a(){return(a=(0,r._)((function*({detail:{stickers:e}}){const{peerId:t}=this.cache.options;e.forEach((e=>{if(e.owner_id!==t)return;let s=i.get(t);s||(s=[],i.set(t,s));const r=s.findIndex((t=>t.id===e.id&&t.pack_id===e.pack_id&&t.owner_id===e.owner_id));-1!==r?s[r]=e:s.push(e)})),c.call(this)}))).apply(this,arguments)}function c(){return d.apply(this,arguments)}function d(){return(d=(0,r._)((function*(){const{peerId:e}=this.cache.options;if(!e||o.has(e))return;const t=i.get(e);if(!(null==t?void 0:t.length))return;o.add(e),i.delete(e);const s=yield this.cache.ugcPacks.get();if(!(null==s?void 0:s.length))return;const r=new Map(s.map((e=>[e.id,e])));t.forEach((e=>{const{id:t,pack_id:s}=e;if(void 0===s)return;const i=r.get(s);if(!i)return;const o=i.stickers.findIndex((e=>e.id===t));-1!==o&&(i.stickers[o]=e)})),yield this.cache.ugcPacks.set(s).catch((()=>{})),o.delete(e),c.call(this)}))).apply(this,arguments)}},153526:(e,t,s)=>{s.d(t,{reloadFavoriteStickers:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.options.api.store.getFavoriteStickers().then((({items:e})=>e)).catch((()=>null));return!!e&&(yield this.favoriteStickers.set(e),!0)}))).apply(this,arguments)}},859668:(e,t,s)=>{s.d(t,{reloadGlobal:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){var e;if(this.reloading)return!0;this.setReloading(!0);const t=yield this.global.get();let[s,r]=yield Promise.all([this.options.api.store.hasNewItems({type:"stickers",version_hash:String(null==t?void 0:t.stickers_version_hash)}).catch((()=>null)),this.stockItems.get()]);if(!s)return this.setReloading(!1),!1;(e=s).sticker_packs_version_hashes||(e.sticker_packs_version_hashes=null==t?void 0:t.sticker_packs_version_hashes);const{stickers_version_hash:i,sticker_packs_version_hashes:o,favorite_stickers_version_hash:n,image_configs_version_hash:a,sticker_packs_chunk_size_limit:c}=s;i!==(null==t?void 0:t.stickers_version_hash)&&(r=null,this.stickersListAsync.clear());const d=[this.reloadStockItems({cachedStockItems:r,actualPacksHashes:o,chunkSize:c}),this.reloadUGC(),this.reloadVmoji(),this.reloadRecentStickers()];return n!==(null==t?void 0:t.favorite_stickers_version_hash)&&d.push(this.reloadFavoriteStickers()),a!==(null==t?void 0:t.image_configs_version_hash)&&d.push(this.reloadImageConfigs()),Promise.all(d).then((e=>{this.setReloading(!1);const t=-1===e.findIndex((e=>!e));return t&&s&&(this.global.set(s),this.stickersSync.notify(void 0,!0)),t}))}))).apply(this,arguments)}},441695:(e,t,s)=>{s.d(t,{reloadImageConfigs:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.options.api.store.getStickersImageConfigs().catch((()=>null));return!!e&&(this.imageConfigs.set(e),!0)}))).apply(this,arguments)}},957627:(e,t,s)=>{s.d(t,{reloadRecentStickers:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.options.api.messages.getRecentStickers().then((({items:e})=>e)).catch((()=>null));return e&&this.recentStickers.set(e),!0}))).apply(this,arguments)}},844411:(e,t,s)=>{s.d(t,{getStickers:()=>i});var r=s(11010);function i(e){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(e){const t=yield Promise.all(e.map((e=>this.stickersListAsync.createAtom(String(e)).get())));if(!t.includes(null))return t;const s=new Map,r=t.reduce(((t,r,i)=>{if(!r){const r=e[i];t.push(r),s.set(r,i)}return t}),[]);return(yield this.options.api.store.getStickers({sticker_ids:String(r)})).forEach((e=>{const{sticker_id:r}=e;if(!r)return;this.stickersListAsync.createAtom(String(r)).set(e);const i=s.get(r);i&&(t[i]=e)})),t}))).apply(this,arguments)}},161260:(e,t,s)=>{function r({active:e}){return this.stockItems.get().then((t=>(t&&(t=t.sort((({product:{vmoji_avatar:e}},{product:{vmoji_avatar:t}})=>Number(Boolean(t))-Number(Boolean(e)))),e&&(t=t.filter((({product:{active:e}})=>e)))),t)))}s.d(t,{getStockItems:()=>r})},801115:(e,t,s)=>{s.d(t,{loadStockItems:()=>i});var r=s(11010);function i(e){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*({productId:e,stickerId:t}){const s=yield this.stockItems.get();let r;return s&&(e&&(r=s.find((({product:{id:t}})=>t===e))),t&&!r&&(r=s.find((({product:{stickers:e}})=>e&&-1!==e.findIndex((({sticker_id:e})=>e===t)))))),r||(e&&(r=yield this.options.api.store.getStockItemByProductId({type:"stickers",product_id:String(e)}).catch((()=>{}))),r?(this.updateStockItems([r]),r):(t&&(r=yield this.options.api.store.getStockItemByStickerId({sticker_id:t}).catch((()=>{}))),r&&this.updateStockItems([r]),r))}))).apply(this,arguments)}},744035:(e,t,s)=>{s.d(t,{reloadStockItems:()=>n});var r=s(11010),i=s(659397);const o=new Map;function n(e){return a.apply(this,arguments)}function a(){return(a=(0,r._)((function*({chunkSize:e=25,cachedStockItems:t,actualPacksHashes:s}){let r=o.get(this.stickersSync.key);r||(r=new Map,o.set(this.stickersSync.key,r));let n=null==t?void 0:t.reduce(((e,{product:{id:t},version_hash:r})=>{const i=null==s?void 0:s.find((({pack_id:e})=>e===t));if(!i)return e;return i.hash!==r&&e.push(t),e}),[]);const a=!n;if(a&&(n=yield this.options.api.store.getProducts({type:"stickers",filters:"active"}).then((({items:e})=>e.map((({id:e})=>e)))).catch((()=>{}))),!(null==n?void 0:n.length))return!0;this.stickersListAsync.clear();let c=yield Promise.all((0,i.chunkArray)(n,e).map((e=>{const t=String(e);return(null==r?void 0:r.get(t))||this.options.api.store.getStockItems({type:"stickers",product_ids:t}).then((e=>(null==r||r.set(t,e),e)))}))).then((e=>e.reduce(((e,{items:t})=>(e.push(...t),e)),[]).filter((e=>!Array.isArray(e))))).catch((()=>null));if(!c)return!1;if(null==t?void 0:t.length){const e=new Map(c.map((e=>[e.product.id,e])));c=t=t.map((t=>e.get(t.product.id)||t))}return c&&n&&a&&(c=c.sort((({product:{id:e}},{product:{id:t}})=>Number(null==n?void 0:n.indexOf(e))-Number(null==n?void 0:n.indexOf(t))))),yield this.stockItems.set(c),o.delete(this.stickersSync.key),!0}))).apply(this,arguments)}},895883:(e,t,s)=>{s.d(t,{updateStockItems:()=>i});var r=s(11010);function i(e,t){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(e,t){let s=yield this.stockItems.get();if(s){const t=new Map(s.map((e=>{const{product:{id:t}}=e;return[t,e]})));e.forEach((e=>{const{product:{id:s}}=e;t.set(s,e)})),s=[...t.values()]}return this.stockItems.set(s||e,t)}))).apply(this,arguments)}},352319:(e,t,s)=>{function r(){this.ugcInfo.delete(),this.ugcPacks.delete()}s.d(t,{clearUGC:()=>r})},767374:(e,t,s)=>{s.d(t,{hideUGCOnboarding:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.ugcInfo.get();if(!(null==e?void 0:e.show_keyboard_onboarding))return!1;const{owner_id:t}=e;return e.show_keyboard_onboarding=!1,this.ugcInfo.set(e),this.options.api.stickers.hideUGCKeyboardOnboarding({owner_id:t}).then(Boolean).catch((()=>!1))}))).apply(this,arguments)}},725055:(e,t,s)=>{s.d(t,{reloadUGC:()=>n});var r=s(11010),i=s(723062),o=s(744165);function n(e){return a.apply(this,arguments)}function a(){return(a=(0,r._)((function*(e){if(!(0,o.isUgcStickersEnabled)())return this.clearUGC(),!0;const{peerId:t}=this.options;if(!t||!i.Ranges.isChatOrChannelPeer(t))return!0;const s=yield this.ugcPacks.get(),r=yield this.options.api.stickers.getUGCPackLists({owner_ids:String(t),owner_global_ids:e}).then((({lists:e})=>e[0])).catch((()=>{}));if(!r)return this.ugcInfo.delete(),this.ugcPacks.delete(),!0;this.ugcInfo.set(r);const{items:n}=r;if(!n.length)return this.ugcPacks.delete(),!0;const a=s?new Map(s.map((({id:e,hash:t})=>[e,t]))):void 0,c=n.reduce(((e,{pack_id:t,hash:s})=>((null==a?void 0:a.get(t))!==s&&e.push(t),e)),[]);if(!c.length)return!0;const d=yield this.options.api.stickers.getUGCPacks({owner_id:t,pack_ids:String(c)}).then((({packs:e})=>e)).catch((()=>{}));return!d||(this.ugcPacks.set(d),!0)}))).apply(this,arguments)}},295266:(e,t,s)=>{s.d(t,{clearVmojiPromotionDot:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){const e=yield this.global.get();(null==e?void 0:e.vmoji_promotion)&&(e.vmoji_promotion.dot_color=void 0,this.global.set(e,{notify:!1}))}))).apply(this,arguments)}},20830:(e,t,s)=>{s.d(t,{reloadVmoji:()=>i});var r=s(11010);function i(){return o.apply(this,arguments)}function o(){return(o=(0,r._)((function*(){return this.hasAvatar.get()||(yield this.options.api.vmoji.getAvatar().then((({characters:e})=>{this.hasAvatar.set(Boolean(null==e?void 0:e.length))})).catch((()=>{}))),!0}))).apply(this,arguments)}},164702:(e,t,s)=>{s.d(t,{Cache:()=>f});var r=s(380312),i=s(559205),o=s(426775),n=s(725055),a=s(20830),c=s(844411),d=s(859668),u=s(161260),l=s(801115),h=s(744035),p=s(895883),v=s(767374),m=s(441695),g=s(957627),k=s(295266),_=s(153526),E=s(352319);class f{subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}get reloading(){return this.isReloading}setReloading(e){this.isReloading=e}destroy(){this.stickersSync.destroy(),this.stickersAsync.destroy(),this.stickersListAsync.destroy()}constructor(e){this.isReloading=!1,this.listeners=new Set,this.reload=d.reloadGlobal.bind(this),this.reloadVmoji=a.reloadVmoji.bind(this),this.clearVmojiPromotionDot=k.clearVmojiPromotionDot.bind(this),this.getStockItem=l.loadStockItems.bind(this),this.getStockItems=u.getStockItems.bind(this),this.updateStockItems=p.updateStockItems.bind(this),this.reloadStockItems=h.reloadStockItems.bind(this),this.reloadUGC=n.reloadUGC.bind(this),this.clearUGC=E.clearUGC.bind(this),this.hideUGCOnboarding=v.hideUGCOnboarding.bind(this),this.reloadRecentStickers=g.reloadRecentStickers.bind(this),this.reloadFavoriteStickers=_.reloadFavoriteStickers.bind(this),this.reloadImageConfigs=m.reloadImageConfigs.bind(this),this.getStickers=c.getStickers.bind(this);const{userId:t,peerId:s}=e;this.options=e;const f=(0,r.createSyncStore)({dbName:"stickers",storeName:String(t),version:1}),y=(0,i.createAsyncStore)({dbName:"stickers",storeName:String(t),version:1}),S=(0,i.createAsyncStore)({dbName:"stickers-list",storeName:String(t),version:1});this.stickersSync=f,this.stickersAsync=y,this.stickersListAsync=S,this.global=y.createAtom("global"),this.stockItems=y.createAtom("stockItems"),this.imageConfigs=y.createAtom("imageConfigs"),this.recentStickers=y.createAtom("recentStickers"),this.favoriteStickers=y.createAtom("favoriteStickers"),this.hasAvatar=f.createAtom("hasAvatar",o.SyncAtomType.BOOLEAN),this.recentEmoji=f.createAtom("recentEmoji",o.SyncAtomType.OBJECT),this.tabbarActiveTab=f.createAtom("tabbarActiveTab",o.SyncAtomType.STRING),this.stickersActiveTab=f.createAtom("stickersActiveTab",o.SyncAtomType.NUMBER);const I=(0,i.createAsyncStore)({dbName:"stickers-ugc",storeName:`${t}-${s}`,version:1});this.ugcAsync=I,this.ugcInfo=I.createAtom("ugcInfo"),this.ugcPacks=I.createAtom("ugcPacks"),this.getStickersImageConfigs=this.imageConfigs.get.bind(this.imageConfigs)}}},744165:(e,t,s)=>{s.d(t,{isUgcStickersEnabled:()=>i});var r=s(616912);const i=()=>{return e="stickers.ugc",Boolean(r.$userEnv.getState()[e]);var e}}}]);try{stManager.done("dist/5b9871f5e48dc927cf0229bdc83c9099.34760922f2bef30c3e9c.js")}catch(e){}