(self.webpackChunkvk=self.webpackChunkvk||[]).push([[90613],{428817:t=>{t.exports={reactions_preview_item:'<div class="ReactionsPreviewItem ReactionsPreviewItem--stackOverlay %class%" style="background-image: url(\'%image_url%\');" aria-label="%title%"></div>'}},828109:(t,e,n)=>{"use strict";n.d(e,{preservePositionBetween:()=>a});var i=n(75272),o=n(659397);function a(t,{scrollByImpl:e=window.scrollBy}={}){let n=t;return{start:(0,o.once)((function(t){t&&(n=t);const a=(0,i.getElementOffset)(n);return(0,o.once)((function(t){if(t&&(n=t),n.isConnected){const t=(0,i.getElementOffset)(n);e(0,t.top-a.top)}}))}))}}},143790:(t,e,n)=>{"use strict";n.d(e,{animationModuleLoaderAsync:()=>s,destroyAnimationItem:()=>r,getAnimationAsync:()=>o,onAnimationReady:()=>a});var i=n(434788);const o=({animationDataGet:t,animationDataSet:e,animationModuleLoader:n})=>(...i)=>n().then((({loadAnimation:n})=>(({animationDataGet:t,animationDataSet:e,loadAnimation:n})=>(i,o,a)=>{const r=i,s=t?t({animationId:r}):void 0,c=n({animationData:s,animationURL:i,container:o,loadAnimationParams:null==a?void 0:a.loadAnimationParams});return!s&&e&&function(t,e){t.addEventListener("data_ready",(()=>{e(t.animationData)}))}(c,(t=>{e({animationId:r,loadedAnimationData:t})})),c})({animationDataGet:t,animationDataSet:e,loadAnimation:n})(...i)));function a(t,e){t.isLoaded?e():t.addEventListener("DOMLoaded",(()=>{e()}))}function r(t){const e=function(t){return!t._cbs}(t);e||t.destroy()}const s=()=>Promise.all([n.e(38288),n.e(55489)]).then(n.bind(n,682832)).then((t=>{return{loadAnimation:(e=t.lottie,({animationData:t,animationURL:n,container:o,loadAnimationParams:a={}})=>{const r=t?{animationData:t}:{path:n};var s,c;const l={renderer:"svg",autoplay:null!=(s=null==a?void 0:a.autoplay)&&s,loop:null==(c=null==a?void 0:a.loop)||c,rendererSettings:{progressiveLoad:!0}},u=(0,i._)({},r,l,{container:o});return e.loadAnimation(u)})};var e}))},59985:(t,e,n)=>{"use strict";n.d(e,{HIDE_TOOLTIP_TIMEOUT:()=>i,OPENED_REACTED_USERS_DEFAULT_REACTION_ID:()=>u,REACTION_ID_DEFAULT:()=>a,REACTION_ID_MAX:()=>r,REACTION_ID_MIN:()=>s,REACTION_ID_UNSET:()=>c,REACTION_SET_ITEMS_MIN_COUNT:()=>l,SHOW_TOOLTIP_TIMEOUT:()=>o});const i=600,o=140,a=0,r=7,s=0,c=void 0,l=2,u=a},457972:(t,e,n)=>{"use strict";n.d(e,{isDebugEnabled:()=>a});var i=n(531730);let o;const a=()=>(void 0!==o||(o=!!i.ls.get("reactions.debug_enabled")),o)},192441:(t,e,n)=>{"use strict";n.d(e,{reactionCountsBrandUnwrap:()=>o,reactionCountsBrandWrap:()=>a});var i=n(640971);const o=t=>(0,i.unwrap)(t),a=t=>(0,i.wrap)(t)},698216:(t,e,n)=>{"use strict";n.d(e,{reactionLogError:()=>a});var i=n(970978);const o="reactions";function a({error:t,reportError:e=!1}){e&&(0,i.logError)(t,{environment:o}),console.error(t)}},822715:(t,e,n)=>{"use strict";n.d(e,{areCountersEqual:()=>A,calcCounters:()=>R,calcCountersSum:()=>S,calcCountersWeightedSum:()=>f,counterForReactionId:()=>P,getDefaultReaction:()=>l,getDefaultReactionTitle:()=>u,getReaction:()=>c,hasReactionsForCounts:()=>E,isReactionIdSet:()=>m,isReactionIdUnset:()=>g,isUnknownObject:()=>s,isValidReactionId:()=>p,parseReactionId:()=>_,parseReactionIdOrUnset:()=>w,parseReactionMenuConfig:()=>I,prepareReactionMenuSet:()=>v,validateReactionSetPayloaditems:()=>b});var i=n(59985),o=n(192441),a=n(659397);const r=Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&Math.floor(t)===t),s=t=>null!==t&&"object"==typeof t,c=(t,e)=>t.itemsById[e],l=t=>c(t,i.REACTION_ID_DEFAULT),u=t=>{var e;return null==(e=l(t))?void 0:e.title},d=(t,e)=>0===t.length?"":((t,e,n=!0)=>t.reduce(((t,i)=>{const o=e(i),a=e(t);return a===o?n?t:i:a<o?t:i})))(t,(t=>Math.pow(e.width-t.width,2)+Math.pow(e.height-t.height,2)),!1).url,v=(t,e,n)=>{const i=e.map((({asset:t,color_sets:e,id:i,score:o,title:a})=>({animationURL:t.animation_url||void 0,backgroundColor:null==e?void 0:e.background,id:i,imageMenuURL:d(t.images,n.imageMenuSize),imagePreviewURL:"imagePreviewSize"in n?d(t.images,n.imagePreviewSize):void 0,imageStoryPanelURL:"imageStoryPanelSize"in n?d(t.images,n.imageStoryPanelSize):void 0,imageStoryPreviewURL:"imageStoryPreviewSize"in n?d(t.images,n.imageStoryPreviewSize):void 0,score:o,title:a,titleColor:null==e?void 0:e.foreground}))),o={};return i.forEach((t=>{o[t.id]=t})),{id:t,items:i,itemsById:o}},m=t=>t!==i.REACTION_ID_UNSET,g=t=>t===i.REACTION_ID_UNSET,p=t=>r(t)&&t>=i.REACTION_ID_MIN&&t<=i.REACTION_ID_MAX,_=t=>{const e=parseInt(t,10);return p(e)?{isValid:!0,value:e}:{isValid:!1}},w=t=>{const e=_(t);return e.isValid?e.value:i.REACTION_ID_UNSET},b=(t,e)=>{if(t.length<i.REACTION_SET_ITEMS_MIN_COUNT)return{error:new Error(`Invalid reactions items count in set '${e}': ${t.length}`)}},I=t=>{if(!s(t))return;const e={},{animationShowStaticAfterEnd:n,menuShowDelay:o,openedDefaultReactionId:a,reportJsErrors:r}=t;return"number"!=typeof o&&void 0!==o||(e.menuShowDelay=o),"boolean"==typeof n&&(e.animationShowStaticAfterEnd=n),"boolean"==typeof r&&(e.reportJsErrors=r),"number"==typeof a||null===a?null===a?e.openedDefaultReactionId=void 0:p(a)&&(e.openedDefaultReactionId=a):e.openedDefaultReactionId=i.OPENED_REACTED_USERS_DEFAULT_REACTION_ID,e},R=(t,e)=>{const n=(0,o.reactionCountsBrandWrap)({});return Object.entries((0,o.reactionCountsBrandUnwrap)(t)).forEach((([t,i])=>{var o,a;const r=t;var s;const c=null!=(s=null==e||null==(o=e.itemsById)||null==(a=o[r])?void 0:a.score)?s:1;n[r]=c*(i||0)})),n},S=t=>Object.values((0,o.reactionCountsBrandUnwrap)(t)).reduce(((t,e)=>t+(e||0)),0),f=t=>S((0,o.reactionCountsBrandWrap)(t)),E=t=>S(t)>0;var y;const P=(t,e)=>null!=(y=t[e])?y:void 0,A=(t,e)=>t&&e?(0,a.isEqual)(t,e):t===e},640971:(t,e,n)=>{"use strict";n.d(e,{unwrap:()=>i,wrap:()=>o});const i=t=>t,o=t=>t},508087:(t,e,n)=>{"use strict";n.d(e,{stripPercentVars:()=>i});const i=t=>t.replace(/%[-\w]+%/g,"")},693982:(t,e,n)=>{"use strict";function i(t){const e=t.match(/^([a-z_]+)([0-9\-_]+)$/);if(!e)return null;const[,n,i]=e;return{objectType:n,objectId:i}}n.d(e,{getElementLikeButtonCount:()=>s,getElementLikeButtonIcon:()=>l,getElementLikeButtonLabel:()=>d,likePostObjectId:()=>o,likeReplyObjectId:()=>a,parseLikeObjectId:()=>i});const o=t=>`wall${t}`,a=t=>`wall_reply${t}`;var r;const s=t=>null!=(r=null==t?void 0:t.querySelector(".like_button_count, ._like_button_count"))?r:void 0;var c;const l=t=>null!=(c=null==t?void 0:t.querySelector(".like_button_icon, ._like_button_icon"))?c:void 0;var u;const d=t=>null!=(u=t.querySelector(".like_button_label, ._like_button_label"))?u:void 0},135683:(t,e,n)=>{"use strict";n.d(e,{ATTR_USER_REACTION_ID:()=>i});const i="data-reaction-user-reaction-id"},299156:(t,e,n)=>{"use strict";n.d(e,{getLastOwnReactionChangeTime:()=>A,setDataCurrentId:()=>L,updateReactionButtonContainerForCounts:()=>E,updateReactionButtonCounts:()=>P,updateReactionButtonForCurrentReaction:()=>y});var i=n(11010),o=n(434788),a=n(664988),r=(n(75272),n(29271)),s=n(143790),c=n(457972),l=n(822715),u=n(795558),d=n(893106),v=n(135683),m=n(666734),g=n(775060),p=n(577698),_=n(908088);const w="data-reaction-last-own-change-time",b="PostButtonReactions__icon--animationActive";const I=t=>{var e;const n=null==(e=t.__reactionIconAnimation)?void 0:e.animationItem;if(n){!n._cbs||n.destroy(),delete t.__reactionIconAnimation}},R=(0,i._)((function*(t,e,n,i){var o;if(!(t!==(null==(o=n.__reactionIconAnimation)?void 0:o.animationURL))&&t||(I(n),e.innerHTML="",n.classList.remove(b)),!i||!t)return;const a=yield(0,m.getAnimationAsync)(t,e,{loadAnimationParams:{autoplay:!0,loop:!1}});(0,s.onAnimationReady)(a,(()=>{n.classList.add(b)}));a.addEventListener("complete",(()=>{(function(){const t=(0,_.getReactionConfig)();return!0===(null==t?void 0:t.animationShowStaticAfterEnd)})()&&(n.classList.remove(b),I(n))})),n.__reactionIconAnimation={animationItem:a,animationURL:t}})),S=(t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-icon"]');if(!n)return;const{currentOption:i,isUserAction:o}=e;if(i.isReactionSet){const t=i.current,e=null==t?void 0:t.imageMenuURL;n.style.backgroundImage=`url('${e}')`,n.setAttribute("aria-label",null==t?void 0:t.title)}else{const t=i.default;n.style.backgroundImage="",(null==t?void 0:t.title)&&n.setAttribute("aria-label",null==t?void 0:t.title)}n.classList.toggle("PostButtonReactions__icon--custom",i.isReactionSet);{const t=i.isReactionSet?i.current.animationURL:void 0,e=(t=>{let e=t.querySelector(".PostButtonReactions__iconAnimation");return e||(e=(0,u.se)('<div class="PostButtonReactions__iconAnimation" data-section-ref="reactions-button-icon-animation"></div>'),t.appendChild(e),e)})(n);R(t,e,n,o)}},f=(t,e,n)=>{t.classList.toggle("PostButtonReactions--icon-active",e),t.classList.toggle("PostButtonReactions--active",e)},E=(t,e)=>{const n=!e||!(0,l.hasReactionsForCounts)(e);t.classList.toggle("PostBottomAction--empty",n)},y=(t,e,n,i)=>{const a=!(0,l.isReactionIdUnset)(e),s=((t,e)=>{let n,i=(0,l.getDefaultReaction)(t);if((0,l.isReactionIdUnset)(e)){if(i)return{isReactionSet:!1,default:i}}else{if(n=t.itemsById[e],n)return{isReactionSet:!0,current:n};console.error(new Error(`Missing reaction meta for ${e} in set '${t.id}'`))}return{_error:!0}})(n,e);"_error"in s||(S(t,{currentOption:s,isUserAction:i}),((t,e)=>{const{currentOption:n}=e,i=n.isReactionSet?n.current.titleColor:void 0,a=n.isReactionSet?n.current.backgroundColor:void 0,r=i?{"--reaction-button-title-color-light":i.light,"--reaction-button-title-color-dark":i.dark}:{"--reaction-button-title-color-light":null,"--reaction-button-title-color-dark":null},s=a?{"--reaction-button-background-color-light":a.light,"--reaction-button-background-color-dark":a.dark}:{"--reaction-button-background-color-light":null,"--reaction-button-background-color-dark":null},c=(0,o._)({},r,s);Object.entries(c).forEach((([e,n])=>{t.style.setProperty(e,n)}))})(t,{currentOption:s}),((t,e)=>{const{currentOption:n}=e;let i="";i=n.isReactionSet?(0,r.langReplace)(r.getLang("reactions_button_unset_reaction_title")||"",{reaction_name:n.current.title||""}):(0,r.langReplace)(r.getLang("reactions_button_set_reaction_with_name")||"",{reaction_name:n.default.title||""})||r.getLang("reactions_button_title")||"",t.setAttribute("aria-label",i||"")})(t,{currentOption:s}),(0,g.isCounterEnabledForBtn)(t)||((t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{currentOption:i}=e,o=i.isReactionSet?i.current.title:i.default.title;o?n.innerText=o:(0,c.isDebugEnabled)()&&console.log("reactions: setReactionNameTitle: missing title",i)})(t,{currentOption:s})),f(t,a),i&&function(t,e){t.setAttribute(w,String(e))}(t,Date.now())},P=(t,e,n,i,o)=>{const a=(0,g.getCounterForTitle)(t,e,i,o);if((0,g.isCounterEnabled)(a)&&(((t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{counterForTitle:i}=e;if((0,g.isCounterAvailable)(i)){const t=i.buttonText;(0,d.animateCount)(n,t,{allowZero:i.allowZeroAnimation,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})}else(0,c.isDebugEnabled)()&&console.log("reactions: setReactionTitle: missing title",i)})(t,{counterForTitle:a}),i)){((t,e)=>{var n;const i=null==(n=(0,p.getClosestLikeBtnContainerElem)(t))?void 0:n.querySelector('[data-section-ref="reactions-button-screen-reader-counter"]');if(!i)return;const o=(0,r.langNumeric)(e,r.getLang("reactions_n_reacted","raw")||"%s",!0);i.innerText=o})(t,(0,l.calcCountersSum)(i))}},A=t=>{const e=t.getAttribute(w);if(e&&(0,a.isNumeric)(e))try{return new Date(Number.parseInt(e)).getTime()||void 0}catch(t){return void console.error(t)}};const L=(t,e)=>{t.setAttribute(v.ATTR_USER_REACTION_ID,(0,l.isReactionIdUnset)(e)?"":String(e))}},282795:(t,e,n)=>{"use strict";n.d(e,{ReactionMenuTitleVariants:()=>a,TITLE_VARIANT_DEFAULT:()=>o,TitleVariantWithLikedUsers:()=>i});const i="WithLikedUsers",o=i,a=[i,"TitleOnly"]},225960:(t,e,n)=>{"use strict";n.d(e,{ButtonStyleVariant:()=>i});const i={Post:"post",Reply:"reply"}},398948:(t,e,n)=>{"use strict";n.d(e,{renderPreviewItems:()=>u});var i=n(822715),o=n(682615),a=n(795558),r=n(428817),s=n.n(r),c=n(225960),l=n(908088);const u=(t,e,n,r,u)=>{const d=((t,e,n=!1)=>{let o=[];for(const e of Object.keys(t)){const n=(0,i.parseReactionId)(e);n.isValid&&t[n.value]>0&&o.push(n.value)}return o=o.sort(((e,n)=>(t[n]||0)-(t[e]||0))).slice(0,e),n&&o.reverse(),o})(e,3),v=t.querySelector(".ReactionsPreview__items"),m=(0,l.getReactionSet)(n),g=0===(0,i.calcCountersSum)(e),p=s().reactions_preview_item;v&&m&&"string"==typeof p?(v.innerHTML=d.map((t=>{const e=m.itemsById[t];if(!e)return"";const n=(0,o.classNames)({"ReactionsPreviewItem--lite ReactionsPreviewItem--stackOverlayLite":u===c.ButtonStyleVariant.Reply,"ReactionsPreviewItem--post ReactionsPreviewItem--stackOverlayPost":u===c.ButtonStyleVariant.Post});return(0,a.rs)(p,{image_url:e.imagePreviewURL,title:e.title,class:n})})).join(""),t.classList.toggle("ReactionsPreview--empty",g),t.classList.toggle("ReactionsPreview--active",void 0!==r)):console.warn("Unable to render reaction previews",{itemsContainer:v,previewItemTemplate:p,reactionSet:m})}},898298:(t,e,n)=>{"use strict";n.d(e,{isIntentPreviewHidden:()=>c,isIntentPreviewInActionStatusBar:()=>s,isIntentPreviewUseCurrent:()=>l,isVariantHidden:()=>a,isVariantInActionStatusBar:()=>o,parsePreviewVariant:()=>d,previewVisibilityIntentForVariant:()=>u,previewVisibilityUseCurrent:()=>r});var i=n(580151);const o=t=>t===i.PreviewVariantActionStatusBar,a=t=>t===i.PreviewVariantHidden,r={kind:"useCurrent"},s=t=>t.kind===i.PreviewVariantActionStatusBar,c=t=>t.kind===i.PreviewVariantHidden,l=t=>"useCurrent"===t.kind,u=t=>t?{kind:t}:r,d=t=>i.PreviewVariants.includes(t)?t:void 0},580151:(t,e,n)=>{"use strict";n.d(e,{PreviewVariantActionStatusBar:()=>i,PreviewVariantHidden:()=>o,PreviewVariants:()=>a});const i="action_status_bar",o="hidden",a=[i,o]},682951:(t,e,n)=>{"use strict";n.d(e,{REACTIONS_COUNTS_RESPONSE_FIELD:()=>c,SIZE_128:()=>s,SIZE_32:()=>o,SIZE_40:()=>a,SIZE_96:()=>r,SUPPORTED_OBJECT_TYPES:()=>i,WK_SECTION_PREFIX_REACTIONS:()=>l});const i={wall:"wall",wall_reply:"wall_reply"},o={width:32,height:32},a={width:40,height:40},r={width:96,height:96},s={width:128,height:128},c="reactions_counts",l="reactions"},666734:(t,e,n)=>{"use strict";n.d(e,{animationItemHasData:()=>r,getAnimationAsync:()=>s});var i=n(143790);const o=(0,n(212368).makeSharedState)("reactions-animations-storage",(()=>({animationItemsData:new Map})),{version:0}),a=()=>o().animationItemsData,r=t=>a().has(t),s=(0,i.getAnimationAsync)({animationDataGet:({animationId:t})=>a().get(t),animationDataSet:({animationId:t,loadedAnimationData:e})=>{a().set(t,e)},animationModuleLoader:i.animationModuleLoaderAsync})},512637:(t,e,n)=>{"use strict";n.d(e,{ENABLED_IN_POST_REPLY:()=>o,isDebugEnabled:()=>i.isDebugEnabled});var i=n(457972);const o=!1},775060:(t,e,n)=>{"use strict";n.d(e,{getCounterForTitle:()=>r,isCounterAvailable:()=>c,isCounterEnabled:()=>s,isCounterEnabledForBtn:()=>a});var i=n(822715),o=n(29271);const a=t=>!!t.getAttribute("data-reaction-button-text-is-counter");function r(t,e,n,r){if(!a(t))return{kind:"disabled"};if(!n)return{kind:"error"};const s=0!==(r?(0,i.calcCountersSum)(r):0);if(!(0,i.hasReactionsForCounts)(n))return{kind:"enabled",allowZeroAnimation:s,buttonText:""};const c=(0,i.calcCounters)(n,e),l=(0,i.calcCountersWeightedSum)(c);return{kind:"enabled",allowZeroAnimation:s,buttonText:(0,o.langNumeric)(l,"%s",!0)}}function s(t){return!!t&&"disabled"!==t.kind}function c(t){return"enabled"===t.kind}},655154:(t,e,n)=>{"use strict";n.d(e,{addDataUpdateListener:()=>r,addReactionChooseListener:()=>c,emitDataUpdate:()=>s,emitReactionChoose:()=>l});var i=n(980602);const o=(0,n(212368).makeSharedState)("reactions-menu-events",(()=>({emitter:new i.default})),{version:0}),a=()=>o().emitter,r=(t,e)=>{const n=a(),i={[`${t}:data_update`]:e};return n.addListeners(i),()=>{n.removeListeners(i)}},s=(t,e)=>{a().emit(`${t}:data_update`,e)},c=(t,e)=>{const n=a(),i={[`${t}:reaction_choose`]:e};return n.addListeners(i),()=>{n.removeListeners(i)}},l=t=>{a().emit(`${t}:reaction_choose`)}},32375:(t,e,n)=>{"use strict";n.d(e,{getPreviewVariantForLikeBtn:()=>g,reactionsElemPayload:()=>p,shouldReactionsPreviewBeVisible:()=>b,updateReactionsButtonForCounts:()=>S,updateReactionsPreview:()=>R});var i=n(265865),o=n(822715),a=n(893106),r=n(29271),s=n(908088),c=n(577698),l=n(249823),u=n(898298),d=n(398948),v=n(135683);const m=t=>{const e=t.getAttribute("data-reaction-counts");if(null===e)return{};const n=e?(0,i.parseJSON)(e):void 0;return"object"==typeof n&&null!==n?n:void 0},g=t=>{const e=t.getAttribute("data-reaction-preview-variant");if(e)return(0,u.parsePreviewVariant)(e)},p=t=>{const e=t.getAttribute("data-reaction-target-object"),n=t.getAttribute("data-reaction-hash"),i=t.getAttribute("data-reaction-set-id");if(null===i)return;const a=t.getAttribute(v.ATTR_USER_REACTION_ID),r=a?(0,o.parseReactionIdOrUnset)(a):void 0,s=t.getAttribute("data-reaction-style-variant"),c=s&&(0,l.isValidButtonStyleVariant)(s)?s:void 0,u=t.getAttribute("data-reaction-menu-title-variant"),d=u&&(0,l.isValidButtonTitleVariant)(u)?u:void 0,p=g(t);return{counts:m(t),csrfHash:n,objectRaw:e,reactionSetId:i,styleVariant:c,titleVariant:d,userReactionId:r,previewVariant:p}};var _;const w=(t,e,n,i)=>{const o=(0,r.langNumeric)(n,r.getLang("reactions_n_reacted","raw")||"%s",!0);t.setAttribute("aria-label",o);const s=null!=(_=t.querySelector('[data-section-ref="like-button-count"]'))?_:void 0;if(!s)return;if(t.tt&&"object"==typeof t.tt){var c;if(!(t.tt.shown||t.tt.showing))null==(c=t.tt)||null==c.destroy||c.destroy()}const l=(0,r.langNumeric)(e,"%s",!0);(0,a.animateCount)(s,l,{allowZero:0!==i,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})},b=t=>(0,o.hasReactionsForCounts)(t),I=(t,e,n)=>{const i=p(t);i&&i.objectRaw&&((t,{counts:e,countsPrevious:n,objectRaw:i,reactionId:a,reactionSetId:r,styleVariant:l})=>{const u=(0,s.getReactionSet)(r),v=(0,o.calcCounters)(e,u),m=(0,o.calcCountersWeightedSum)(v),g=(0,o.calcCountersSum)(e),p=n?(0,o.calcCountersSum)(n):0,_=(0,c.getPreviewElem)(i);_&&((0,d.renderPreviewItems)(_,e,r,a,l),w(_,m,g,p))})(0,{counts:e,countsPrevious:n,objectRaw:i.objectRaw,reactionId:i.userReactionId,reactionSetId:i.reactionSetId,styleVariant:i.styleVariant})},R=(t,e)=>{const n=(0,c.getLikeBtnElem)(t),i=e.counts;n&&i?I(n,i,e.countsPrevious):console.warn("Unable to update object reactions",{objectRaw:t,options:e})},S=(t,{counts:e})=>{const n=(0,c.getLikeBtnElem)(t);n&&((t,e)=>{t.setAttribute("data-reaction-counts",JSON.stringify(e))})(n,e)}},403702:(t,e,n)=>{"use strict";n.d(e,{reactionLogError:()=>a});var i=n(698216),o=n(908088);const a=({error:t})=>{const e=(0,o.getReactionConfig)();var n;const a=null!=(n=null==e?void 0:e.reportJsErrors)&&n;(0,i.reactionLogError)({error:t,reportError:a})}},577698:(t,e,n)=>{"use strict";var i;n.d(e,{getClosestLikeBtnContainerElem:()=>r,getLikeBtnElem:()=>o,getLikeWrap:()=>c,getMenuMount:()=>u,getPreviewElem:()=>d});const o=t=>null!=(i=document.querySelector(`[data-section-ref="reactions-button"][data-reaction-target-object="${t}"]`))?i:void 0;var a;const r=t=>null!=(a=t.closest('[data-section-ref="reactions-button-container"]'))?a:void 0;var s;const c=t=>{const e=o(t);if(e)return null!=(s=e.closest(".like_wrap"))?s:void 0};var l;const u=t=>{var e;return null!=(l=null==(e=t.closest('[data-section-ref="reactions-button-container"]'))?void 0:e.querySelector('[data-section-ref="reactions-menu-mount"]'))?l:null},d=t=>document.querySelector(`[data-section-ref="reactions-preview-items"][data-reaction-target-object="${t}"]`)},908088:(t,e,n)=>{"use strict";n.d(e,{getReactionConfig:()=>p,getReactionSet:()=>m,storageAddSets:()=>v,storageSetConfig:()=>g});var i=n(434788),o=n(659397),a=n(822715),r=n(212368),s=n(403702),c=n(682951),l=n(512637);const u=(0,r.makeSharedState)("reactions-storage",(()=>new Map),{version:0}),d=(0,r.makeSharedState)("reactions-config",(()=>({config:void 0})),{version:0}),v=t=>{(0,l.isDebugEnabled)()&&console.log(t),Object.entries(t).forEach((([t,e])=>{const n=(0,a.validateReactionSetPayloaditems)(e,t);if(n)return void(0,s.reactionLogError)({error:n.error});const r=e.map((t=>(0,i._)({},t,{title:(0,o.decodeHTMLEntities)(t.title)})));u().set(t,(0,a.prepareReactionMenuSet)(t,r,{imageMenuSize:c.SIZE_96,imagePreviewSize:c.SIZE_32,imageStoryPanelSize:c.SIZE_128,imageStoryPreviewSize:c.SIZE_40}))}))},m=t=>{const e=u().get(t);if(e)return e;{const e=new Error(`Reaction set not found: ${t}`);(0,s.reactionLogError)({error:e})}},g=t=>{(0,l.isDebugEnabled)()&&console.log(t);const e=(0,a.parseReactionMenuConfig)(t);e?d().config=e:console.warn("Reactions: invalid menu config passed",t)},p=()=>{var t;return null==(t=d())?void 0:t.config}},249823:(t,e,n)=>{"use strict";n.d(e,{isValidButtonStyleVariant:()=>v,isValidButtonTitleVariant:()=>d,isValidEnvironment:()=>r,preloadImage:()=>s,usePrevious:()=>c,usePreviousRef:()=>l});var i=n(667294),o=n(282795),a=n(225960);const r=()=>{var t,e;return"function"==typeof(null==(t=window.cur)?void 0:t.viewAsBox)?(window.cur.viewAsBox(),!1):!(window.vk.widget&&!window.vk.id)||(null==(e=window.Widgets)||null==e.oauth||e.oauth(),!1)},s=t=>new Promise(((e,n)=>{const i=new Image;i.src=t,i.onload=()=>e(),i.onerror=()=>n()})),c=t=>{const e=(0,i.useRef)(t);return(0,i.useEffect)((()=>{e.current=t})),e.current},l=t=>{const e=(0,i.useRef)(t);return(0,i.useEffect)((()=>{e.current=t})),e},u=Object.values(a.ButtonStyleVariant),d=t=>o.ReactionMenuTitleVariants.includes(t),v=t=>u.includes(t)},109454:(t,e,n)=>{"use strict";n.d(e,{isReactionsFullUpdatePayload:()=>r,reactionsCountsOnlyUpdatePayload:()=>s,reactionsCountsUpdatePayload:()=>a});var i=n(434788),o=n(900641);const a=(t,e)=>(0,i._)({kind:o.PayloadKindFull},t,{reactionIdState:{reactionId:e.id}}),r=t=>t.kind===o.PayloadKindFull,s=t=>(0,i._)({kind:o.PayloadKindCountsOnly},t)},900641:(t,e,n)=>{"use strict";n.d(e,{PayloadKindCountsOnly:()=>i,PayloadKindFull:()=>o});const i="counts_only",o="counts_with_current_reaction"},530517:(t,e,n)=>{"use strict";n.d(e,{postRenderReactionsInit:()=>C});var i,o=n(299156),a=n(659397),r=n(828109),s=n(795558),c=n(508087),l=n(693982),u=n(512637),d=n(32375),v=n(898298),m=n(577698),g=n(109454),p=n(358496),_=n(170864),w=n(72569),b=n(655154),I=n(580151),R=n(908088);const S=(t,e,n=(null==(i=window.cur)?void 0:i.wallTpl))=>{const o=null==n?void 0:n[t];if(o)return(0,c.stripPercentVars)((0,s.rs)(o,e));console.warn(`renderTemplate: missing template '${t}'`,n)},f=({isUserAction:t=!1},...e)=>{t?console.error(...e):(0,u.isDebugEnabled)()&&console.warn(...e)};const E=(t,e,{isActionStatusBarVisible:n,isReactionsPreviewVisible:i,positionTrackingEnd:o})=>{const r=((t,e)=>{var n,i;const o=(0,m.getLikeWrap)(t);if(!o)return;const a=(0,_.getPostElem)(e,o),r=null==a?void 0:a.querySelector('[data-section-ref="post-action-status-bar"]');if(r)return{actionStatusBar:r};const c=(0,w.isWkLayerWallPostOpen)()?null==(n=window.wkcur)?void 0:n.wallTpl:null==(i=window.cur)?void 0:i.wallTpl,l=(0,s.se)(S("post_action_status_bar",{class:"PostActionStatusBar--hidden"},c));return l?((0,s.domInsertBefore)(l,o),{actionStatusBar:l}):void 0})(t,e.postFullId);if(!r)return void f({},"Unable to init ActionStatusBar in post",e);const{actionStatusBar:c}=r;if(c.classList.toggle("PostActionStatusBar--hidden",!n),n&&!(0,m.getPreviewElem)(t)){const e=function(t,e,n={}){var i,o;const r=(0,w.isWkLayerWallPostOpen)()?null==(i=window.wkcur)?void 0:i.wallTpl:null==(o=window.cur)?void 0:o.wallTpl,s=(0,a.classNames)({"ReactionsPreview--empty":!t,"ReactionsPreview--isInActionStatusBar":!!n.isInActionStatusBar});return S("post_reactions_preview",{class:s,object_raw:e},r)}(i,t,{isInActionStatusBar:!0});c.prepend((0,s.se)(e))}if(o){const e=(0,m.getLikeBtnElem)(t);null==o||o(e)}},y=t=>{if(!(t=>void 0!==t.counts)(t))return void f(t,"Counts is invalid or missing");const e=(0,l.likePostObjectId)(t.postFullId),n=(0,_.getPostElem)(t.postFullId,(0,m.getLikeWrap)(e));n||f(t,"Missing post element for reactions preview update",{payload:t,likeWrap:(0,m.getLikeWrap)(e)});const i=(0,m.getLikeBtnElem)(e);if(!i)return void f(t,"Unable to find reactions button",{likeObjectId:e});const o=(0,d.reactionsElemPayload)(i),a=null==o?void 0:o.counts;P({elemPayload:o,likeBtnElem:i,likeObjectId:e,payload:t}),A({countsPrevious:a,likeBtnElem:i,likeObjectId:e,payload:t,postEl:n})},P=({elemPayload:t,likeBtnElem:e,likeObjectId:n,payload:i})=>{const{counts:a}=i;if(!!i.isQueueUpdate&&(t=>{const e=(0,o.getLastOwnReactionChangeTime)(t);if(!e)return!1;const n=e+1e4;return Date.now()<n})(e))(0,u.isDebugEnabled)()&&console.log("Ignoring reactions update from queue",i);else{if(t){const{counts:n,reactionSetId:r}=t,s=(0,R.getReactionSet)(r);if((0,g.isReactionsFullUpdatePayload)(i)){const t=i.reactionIdState.reactionId;s&&(0,o.updateReactionButtonForCurrentReaction)(e,t,s,i.isUserAction)}s&&((0,o.updateReactionButtonCounts)(e,s,i.isUserAction,a,n),(0,o.updateReactionButtonContainerForCounts)(e,a))}if((0,g.isReactionsFullUpdatePayload)(i)){const n=i.reactionIdState.reactionId;(0,o.setDataCurrentId)(e,n),i.isUserAction&&(null==t?void 0:t.objectRaw)&&(0,b.emitDataUpdate)(t.objectRaw,{currentReactionId:n})}(0,d.updateReactionsButtonForCounts)(n,{counts:a})}},A=({countsPrevious:t,likeBtnElem:e,likeObjectId:n,payload:i,postEl:o})=>{const{counts:a,previewVisibility:s=v.previewVisibilityUseCurrent}=i,c=((t,e)=>{if((0,v.isIntentPreviewInActionStatusBar)(t))return{previewVariant:I.PreviewVariantActionStatusBar};if((0,v.isIntentPreviewHidden)(t))return{previewVariant:I.PreviewVariantHidden};if((0,v.isIntentPreviewUseCurrent)(t)){const t=(0,d.getPreviewVariantForLikeBtn)(e);if(t)return{previewVariant:t}}})(s,e);if(!c)return;const{previewVariant:l}=c,u=(0,v.isVariantInActionStatusBar)(l),m=(0,d.shouldReactionsPreviewBeVisible)(a),g=(0,v.isVariantHidden)(l)||u&&!m;if(u){let t;i.isPrimaryLikeButtonClick&&!i.isFromWkLayer&&(t=(0,r.preservePositionBetween)(e).start());const a=m;null==o||o.classList.toggle("post--withActionStatusBar",a),E(n,i,{isActionStatusBarVisible:a,isReactionsPreviewVisible:m,positionTrackingEnd:t})}g||(0,d.updateReactionsPreview)(n,{counts:a,countsPrevious:t})},L=t=>{if(!u.ENABLED_IN_POST_REPLY)return!1;const{counts:e}=t;if(!e)return;const n=(0,l.likeReplyObjectId)(t.replyFullId);(0,d.updateReactionsPreview)(n,{counts:e,countsPrevious:void 0}),(0,d.updateReactionsButtonForCounts)(n,{counts:e})},C=()=>{let t=[(0,p.registerUniqueListener)("wall-post-action-status-bar",p.WallDataEvents.post_reactions_counts_update,y),(0,p.registerUniqueListener)("wall-reply-reactions-counts",p.WallDataEvents.reply_reactions_counts_update,L)];return{onDestroy:()=>{t.forEach((t=>{t()})),t=[]}}}},505426:(t,e,n)=>{"use strict";n.d(e,{WallDataEvents:()=>r,emitEvent:()=>d,registerNonGlobalNonUniqueListener:()=>u,registerUniqueListener:()=>l});var i=n(434788),o=n(980602),a=n(212368);const r={post_reactions_counts_update:"wall/post_reactions_counts_update",reply_reactions_counts_update:"wall/reply_reactions_counts_update",post_subscribe_update:"wall/post_subscribe_update"},s=(0,a.makeSharedState)("wall-data",(()=>({emitter:new o.default,keyedListeners:Object.create(null)})),{version:0}),c=(t,e,n)=>{var o,a;const r=s(),c=null==(o=r.keyedListeners)||null==(a=o[t])?void 0:a[e];return c&&r.emitter.removeListener(t,c),((t,e,n)=>{const o=s();return o.emitter.addListener(t,n),o.keyedListeners[t]=(0,i._)({},o.keyedListeners[t],{[e]:n}),()=>{var i,a;o.emitter.removeListener(t,n),(null==(i=o.keyedListeners[t])?void 0:i[e])===n&&(null==(a=o.keyedListeners[t])||delete a[e])}})(t,e,n)},l=(t,e,n)=>c(e,t,n),u=(t,e)=>((t,e)=>{const n=s();return n.emitter.addListener(t,e),()=>{n.emitter.removeListener(t,e)}})(t,e),d=(t,e)=>{s().emitter.emit(t,e)}},358496:(t,e,n)=>{"use strict";n.d(e,{WallDataEvents:()=>i.WallDataEvents,registerUniqueListener:()=>i.registerUniqueListener});var i=n(505426)},170864:(t,e,n)=>{"use strict";n.d(e,{getPostElem:()=>a,replyUserImageImg:()=>l,replyUserImageLinkClosest:()=>s});var i,o;const a=(t,e)=>null!=(o=null!=(i=(t=>{var e;if("string"==typeof t)return null!=(e=document.querySelector(`#post${t}`))?e:void 0})(t))?i:null==e?void 0:e.closest("._post, .wl_post"))?o:void 0;var r;const s=t=>null!=(r=t.closest(".reply_image, ._reply_image"))?r:void 0;var c;const l=t=>null!=(c=t.querySelector("img.reply_img"))?c:void 0}}]);try{stManager.done("dist/155012f0e2f6a2354001adc2a93ffcaf.890d35bc5aedc86f698a.js")}catch(t){}