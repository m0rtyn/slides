"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[40051],{142201:(e,t,n)=>{n.d(t,{default:()=>a});const a=(0,n(825028).makeIcon)("Icon56IllustrationAntennaLight","illustration_antenna_light_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 56 56" id="illustration_antenna_light_56"><path fill="#07F" d="m18.834 33.983-.123-.097a3.054 3.054 0 0 0-4.288.516l-6.06 7.717a3.054 3.054 0 0 0 .516 4.289l.123.096a3.054 3.054 0 0 0 4.288-.515l6.06-7.718a3.054 3.054 0 0 0-.516-4.288Z" /><path fill="#00EAFF" d="M44.493 37.686c-7.576 8.417-20.262 7.696-29.437-.505S3.812 16.354 11.388 7.888a68.327 68.327 0 0 1 19.168 12.025 66.294 66.294 0 0 1 13.937 17.773Z" /><path fill="#fff" d="M44.396 37.794c-3.234 3.608-13.227-.108-22.462-8.309-9.235-8.2-13.985-17.773-10.75-21.392.144-.157 1.034-1.203 1.202-1.347 3.607-2.838 12.494 1.816 21.248 9.62 8.273 7.443 13.696 15.488 12.145 19.709a9.272 9.272 0 0 1-1.383 1.72Z" /><path fill="#07F" d="M45.526 36.532c2.785-3.114-2.39-12.285-11.557-20.484-9.167-8.2-18.857-12.323-21.641-9.21-2.785 3.114 2.389 12.285 11.556 20.485 9.168 8.2 18.857 12.323 21.642 9.209Z" /><mask id="illustration_antenna_light_56_a" width="36" height="33" x="11" y="5" maskUnits="userSpaceOnUse" style="mask-type:alpha"><path fill="#07F" d="M45.526 36.532c2.785-3.114-2.39-12.285-11.557-20.484-9.167-8.2-18.857-12.323-21.641-9.21-2.785 3.114 2.389 12.285 11.556 20.485 9.168 8.2 18.857 12.323 21.642 9.209Z" /></mask><g mask="url(#illustration_antenna_light_56_a)"><path fill="#2929B2" d="M39.5 42.822c2.784-3.114-2.39-12.285-11.557-20.484-9.168-8.2-18.857-12.323-21.642-9.21-2.785 3.114 2.39 12.285 11.557 20.485s18.857 12.323 21.641 9.21Z" /></g><path fill="#00EAFF" d="m30.808 19.637.205.192L25 28.247a37.414 37.414 0 0 1-2.188-1.96l7.996-6.65Z" /><path fill="#00EAFF" d="M31 21.549a2.2 2.2 0 1 0 0-4.401 2.2 2.2 0 0 0 0 4.4Z" /><path fill="#2929B2" d="M40.705 19.072a.901.901 0 0 1-.89-.794 7.84 7.84 0 0 0-3.92-5.94 7.636 7.636 0 0 0-4.065-1.023.926.926 0 0 1-.926-.877.902.902 0 0 1 .878-.926 9.716 9.716 0 0 1 5.015 1.202 9.62 9.62 0 0 1 4.81 7.287.901.901 0 0 1-.782 1.01l-.12.06Z" /><path fill="#07F" d="M45.767 18.146a.914.914 0 0 1-.902-.794 12.025 12.025 0 0 0-6.012-9.151 11.784 11.784 0 0 0-6.277-1.575.902.902 0 1 1 0-1.804 13.648 13.648 0 0 1 7.215 1.804 13.865 13.865 0 0 1 6.926 10.51.889.889 0 0 1-.781.998l-.169.012Z" /><path fill="#00EAFF" d="M50.457 17.424a.914.914 0 0 1-.902-.842A15.705 15.705 0 0 0 33.213 1.816a.914.914 0 0 1-.926-.854A.926.926 0 0 1 33.13 0a17.46 17.46 0 0 1 9.392 2.26 17.64 17.64 0 0 1 8.838 14.19.914.914 0 0 1-.842.962l-.06.012Z" /><path fill="#2929B2" d="M14.575 44.444a3.52 3.52 0 0 0-3.518-3.523 3.52 3.52 0 0 0-3.517 3.523v5.435a3.52 3.52 0 0 0 3.517 3.524 3.52 3.52 0 0 0 3.518-3.524v-5.435Z" /><path fill="#00EAFF" d="M24.603 54.4H6.338a.913.913 0 0 1-.926-.925v-3.608a.914.914 0 0 1 .926-.926h10.064c.68 0 1.347.179 1.936.517l6.566 3.836a.601.601 0 0 1-.3 1.107Z" /><path fill="#fff" d="M11.063 45.839a1.527 1.527 0 1 0 0-3.054 1.527 1.527 0 0 0 0 3.054Z" /><path fill="#07F" d="M24.964 52.813H5.244a.613.613 0 0 0-.614.614v1.96c0 .338.275.613.613.613h19.721a.613.613 0 0 0 .613-.613v-1.96a.613.613 0 0 0-.613-.614Z" /></symbol>',56,56,!1,void 0)},810874:()=>{},200930:()=>{},215334:()=>{},167509:()=>{},554410:()=>{},518418:()=>{},420526:()=>{},589648:()=>{},894459:()=>{},891695:()=>{},150637:()=>{},928910:()=>{},522283:()=>{},950652:()=>{},181362:()=>{},726566:()=>{},929894:()=>{},471376:()=>{},252495:()=>{},321248:()=>{},661342:()=>{},619688:(e,t,n)=>{n.d(t,{default:()=>p});var a,o=n(667294),s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:{};let l;l="undefined"!=typeof window?window:"undefined"!=typeof self?self:s;let i=null,r=null;const c=l.clearTimeout,m=l.setTimeout,u=l.cancelAnimationFrame||l.mozCancelAnimationFrame||l.webkitCancelAnimationFrame,d=l.requestAnimationFrame||l.mozRequestAnimationFrame||l.webkitRequestAnimationFrame;function _(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}null==u||null==d?(i=c,r=function(e){return m(e,20)}):(i=function([e,t]){u(e),c(t)},r=function(e){const t=d((function(){c(n),e()})),n=m((function(){u(t),e()}),20);return[t,n]}),a={createDetectElementResize:function(e){let t,n,a,o,s,c,m;const u="undefined"!=typeof document&&document.attachEvent;if(!u){c=function(e){const t=e.__resizeTriggers__,n=t.firstElementChild,a=t.lastElementChild,o=n.firstElementChild;a.scrollLeft=a.scrollWidth,a.scrollTop=a.scrollHeight,o.style.width=n.offsetWidth+1+"px",o.style.height=n.offsetHeight+1+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight},s=function(e){return e.offsetWidth!==e.__resizeLast__.width||e.offsetHeight!==e.__resizeLast__.height},m=function(e){if(e.target.className&&"function"==typeof e.target.className.indexOf&&e.target.className.indexOf("contract-trigger")<0&&e.target.className.indexOf("expand-trigger")<0)return;const t=this;c(this),this.__resizeRAF__&&i(this.__resizeRAF__),this.__resizeRAF__=r((function(){s(t)&&(t.__resizeLast__.width=t.offsetWidth,t.__resizeLast__.height=t.offsetHeight,t.__resizeListeners__.forEach((function(n){n.call(t,e)})))}))};let e=!1,l="";a="animationstart";const u="Webkit Moz O ms".split(" ");let d="webkitAnimationStart animationstart oAnimationStart MSAnimationStart".split(" "),_="";{const t=document.createElement("fakeelement");if(void 0!==t.style.animationName&&(e=!0),!1===e)for(let n=0;n<u.length;n++)if(void 0!==t.style[u[n]+"AnimationName"]){_=u[n],l="-"+_.toLowerCase()+"-",a=d[n],e=!0;break}}n="resizeanim",t="@"+l+"keyframes "+n+" { from { opacity: 0; } to { opacity: 0; } } ",o=l+"animation: 1ms "+n+"; "}return{addResizeListener:function(s,i){if(u)s.attachEvent("onresize",i);else{if(!s.__resizeTriggers__){const i=s.ownerDocument,r=l.getComputedStyle(s);r&&"static"===r.position&&(s.style.position="relative"),function(n){if(!n.getElementById("detectElementResize")){const a=(t||"")+".resize-triggers { "+(o||"")+'visibility: hidden; opacity: 0; } .resize-triggers, .resize-triggers > div, .contract-trigger:before { content: " "; display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; z-index: -1; } .resize-triggers > div { background: #eee; overflow: auto; } .contract-trigger:before { width: 200%; height: 200%; }',s=n.head||n.getElementsByTagName("head")[0],l=n.createElement("style");l.id="detectElementResize",l.type="text/css",null!=e&&l.setAttribute("nonce",e),l.styleSheet?l.styleSheet.cssText=a:l.appendChild(n.createTextNode(a)),s.appendChild(l)}}(i),s.__resizeLast__={},s.__resizeListeners__=[],(s.__resizeTriggers__=i.createElement("div")).className="resize-triggers";const u=i.createElement("div");u.className="expand-trigger",u.appendChild(i.createElement("div"));const d=i.createElement("div");d.className="contract-trigger",s.__resizeTriggers__.appendChild(u),s.__resizeTriggers__.appendChild(d),s.appendChild(s.__resizeTriggers__),c(s),s.addEventListener("scroll",m,!0),a&&(s.__resizeTriggers__.__animationListener__=function(e){e.animationName===n&&c(s)},s.__resizeTriggers__.addEventListener(a,s.__resizeTriggers__.__animationListener__))}s.__resizeListeners__.push(i)}},removeResizeListener:function(e,t){if(u)e.detachEvent("onresize",t);else if(e.__resizeListeners__.splice(e.__resizeListeners__.indexOf(t),1),!e.__resizeListeners__.length){e.removeEventListener("scroll",m,!0),e.__resizeTriggers__.__animationListener__&&(e.__resizeTriggers__.removeEventListener(a,e.__resizeTriggers__.__animationListener__),e.__resizeTriggers__.__animationListener__=null);try{e.__resizeTriggers__=!e.removeChild(e.__resizeTriggers__)}catch(e){}}}}}};class h extends o.Component{constructor(...e){super(...e),_(this,"state",{height:this.props.defaultHeight||0,scaledHeight:this.props.defaultHeight||0,scaledWidth:this.props.defaultWidth||0,width:this.props.defaultWidth||0}),_(this,"_autoSizer",null),_(this,"_detectElementResize",null),_(this,"_parentNode",null),_(this,"_resizeObserver",null),_(this,"_onResize",(()=>{const{disableHeight:e,disableWidth:t,onResize:n}=this.props;if(this._parentNode){var a,o,s,l;const i=window.getComputedStyle(this._parentNode)||{},r=parseInt(null!==(a=i.paddingLeft)&&void 0!==a?a:"0",10),c=parseInt(null!==(o=i.paddingRight)&&void 0!==o?o:"0",10),m=parseInt(null!==(s=i.paddingTop)&&void 0!==s?s:"0",10),u=parseInt(null!==(l=i.paddingBottom)&&void 0!==l?l:"0",10),d=this._parentNode.getBoundingClientRect(),_=d.height-m-u,h=d.width-r-c,p=this._parentNode.offsetHeight-m-u,g=this._parentNode.offsetWidth-r-c;(e||this.state.height===p&&this.state.scaledHeight===_)&&(t||this.state.width===g&&this.state.scaledWidth===h)||(this.setState({height:p,width:g,scaledHeight:_,scaledWidth:h}),"function"==typeof n&&n({height:p,scaledHeight:_,scaledWidth:h,width:g}))}})),_(this,"_setRef",(e=>{this._autoSizer=e}))}componentDidMount(){const{nonce:e}=this.props;this._autoSizer&&this._autoSizer.parentNode&&this._autoSizer.parentNode.ownerDocument&&this._autoSizer.parentNode.ownerDocument.defaultView&&this._autoSizer.parentNode instanceof this._autoSizer.parentNode.ownerDocument.defaultView.HTMLElement&&(this._parentNode=this._autoSizer.parentNode,null!=this._parentNode&&("undefined"!=typeof ResizeObserver?(this._resizeObserver=new ResizeObserver((()=>{setTimeout(this._onResize,0)})),this._resizeObserver.observe(this._parentNode)):(this._detectElementResize=(0,a.createDetectElementResize)(e),this._detectElementResize.addResizeListener(this._parentNode,this._onResize)),this._onResize()))}componentWillUnmount(){this._parentNode&&(this._detectElementResize&&this._detectElementResize.removeResizeListener(this._parentNode,this._onResize),this._resizeObserver&&(this._resizeObserver.observe(this._parentNode),this._resizeObserver.disconnect()))}render(){const{children:e,defaultHeight:t,defaultWidth:n,disableHeight:a,disableWidth:s,nonce:l,onResize:i,style:r,tagName:c="div",...m}=this.props,{height:u,scaledHeight:d,scaledWidth:_,width:h}=this.state,p={overflow:"visible"},g={};let f=!1;return a||(0===u&&(f=!0),p.height=0,g.height=u,g.scaledHeight=d),s||(0===h&&(f=!0),p.width=0,g.width=h,g.scaledWidth=_),(0,o.createElement)(c,{ref:this._setRef,style:{...p,...r},...m},!f&&e(g))}}_(h,"defaultProps",{onResize:()=>{},disableHeight:!1,disableWidth:!1,style:{}});var p=h},895043:(e,t,n)=>{n.d(t,{useStatsOnMount:()=>s});var a=n(696023),o=n(667294);function s(e){const{stats:t}=(0,a.useBrowserEnv)();(0,o.useEffect)((()=>{t.logEvent(e)}),[])}},402423:(e,t,n)=>{n.d(t,{AvatarSelector:()=>L});var a=n(11010),o=n(667294),s=n(294184),l=n.n(s),i=n(197934),r=n(96190),c=n(790351),m=n(696023),u=(n(810874),n(402516)),d=n(249600),_=n(376499),h=n(277659),p=n(538839),g=n(413066),f=n(126528),v=n(599660),E=n(163332),C=n(364705),y=n(7817),k=n(966933),b=n(410519),I=n(266864),S=n(86894);const w=o.createElement(u.Icon28CameraAddOutline,{"data-testid":"avatar-selector-default-image"}),N=200,F=7e3,M=.25,A=3,L=({size:e=72,peerId:t,isLoading:n,onSelection:s,onUpload:N,onRemove:F,isDisabled:M=!1,isEditing:A=!1,noImage:L})=>{const[B,z]=(0,o.useState)(!1),x=(0,o.useRef)(null),{lang:O,uploader:P}=(0,m.useBrowserEnv)(),D=(0,b.useSubModal)(),{viewer:V}=(0,m.useViewer)(),{navigate:T}=(0,C.useRouter)(),{isTouchOnly:U}=(0,k.useDeviceData)(),G=!U||A,H=(0,m.usePeers)(),W=(0,o.useMemo)((()=>t?r.safeGet(H,t):null),[H,t]),[K,$]=(0,o.useState)(null),[Z,q]=(0,o.useState)(null),j=(0,m.usePrevious)(K),Y=(0,m.usePrevious)(Z),J=!(!K||Z),Q=n||J,X=(0,o.useMemo)((()=>Z?null:W?"User"!==W.kind?null:W.photoId?W.photoId:null:null),[Z,W]),ee=(0,o.useMemo)((()=>{if(Z)return!0;if(!W)return!1;switch(W.kind){case"Chat":return r.hasPhoto(W)&&!W.hasDefaultPhoto;case"User":return r.hasPhoto(W)&&!W.hasDefaultPhoto&&W.photoId;default:return r.hasPhoto(W)}}),[Z,W]),te=(0,a._)((function*(e){const t=e.target.files;if(!t)return;const n=t.item(0);if(!n)return;const a=yield function(e){return R.apply(this,arguments)}(n);if(!a)return D.open(),void(x.current&&(x.current.value=""));$(n)})),ne=(0,o.useCallback)((e=>{try{P.uploadFiles([e],{},{viewerId:V.id,targetPeerId:V.id},{onUploadFinish:e=>{const{photos:t}=c.Uploader.buildAttachments(Array.from(e.values()));if(!t)throw new Error("Неожиданный ответ системы загрузки файлов, загруженные аттачи не вернулись");q(t[0])}})}catch(e){$(null)}}),[P,V.id]),ae=()=>{var e;z(!1),null==(e=x.current)||e.click()};(0,o.useEffect)((()=>{q(null),K&&ne(K)}),[K,ne]),(0,o.useEffect)((()=>{null!==K&&K!==j&&s(K)}),[K,j,s]),(0,o.useEffect)((()=>{null!==Z&&Z!==Y&&(null==N||N(Z))}),[Z,Y,N]);return o.createElement(o.Fragment,null,o.createElement(E.Dropdown,{hideOnClick:!0,open:B,onOpen:()=>z(!0),onClose:()=>z(!1),content:o.createElement(v.ActionsMenu,null,!Q&&X&&o.createElement(v.ActionsMenuAction,{leftIcon:o.createElement(d.Icon20PictureOutline,null),type:"primary",title:O.use("me_open_photo"),onClick:()=>{null!==X&&T({kind:"PhotoModalRoute",ownerId:V.id,id:X})},disabled:M}),o.createElement(v.ActionsMenuAction,{leftIcon:o.createElement(_.Icon20WriteOutline,null),type:"primary",disabled:J||M,title:O.use(ee?"me_update_photo":"me_upload_photo"),onClick:ae}),!Q&&ee&&o.createElement(v.ActionsMenuAction,{leftIcon:o.createElement(h.Icon20DeleteOutline,null),type:"danger",disabled:Q||M,title:O.use("me_remove_photo"),"data-testid":"avatar-selector-remove",onClick:()=>{$(null),q(null),null==F||F()}})),forceUpdateContent:!0,align:"left",position:"bottom"},o.createElement("div",{className:l()("AvatarSelector",`AvatarSelector--size-${e}`,{AvatarSelector__loading:Q}),"data-testid":"avatar-selector"},o.createElement(f.OptimizedSpinner,{className:"AvatarSelector__loader",size:"small"}),o.createElement("div",{className:"AvatarSelector__image"},(()=>{if(!Z&&!K)return L||(null!==W?o.createElement(y.AvatarSimple,{peer:W,size:e,className:"AvatarSelector__defaultImage"}):w);let t=null;if(Z){const n=i.preview(Z,(0,g.getExpectedPhotoWidth)(!1,!1),e,!0);n&&(t=n.url)}else K&&(t=(0,p.blobToImageUrl)({blob:K}));return t?o.createElement("img",{alt:"",src:t,className:"AvatarSelector__preview","data-testid":"avatar-selector-preview"}):L||w})()),G&&o.createElement("button",{key:`${Q}`,className:l()("AvatarSelector__button",{AvatarSelector__buttonEditing:A}),onClick:ae,disabled:Q},o.createElement(u.Icon28CameraAddOutline,null)),o.createElement("input",{ref:x,"data-testid":"avatar-selector-input",type:"file",className:"AvatarSelector__input",onChange:te,accept:c.IMAGE_TYPES.join()}))),D.isActive&&o.createElement(I.ModalInterface,{onClose:D.close,closeLabel:O.use("me_close"),onBack:D.close,contextClass:"MEConfig",title:O.use("me_avatar_selector_error_title"),buttons:o.createElement(S.Button,{onClick:D.close},O.use("me_close"))},o.createElement("div",{className:"AvatarSelector__errorText"},O.use("me_avatar_selector_error_text"))))};function R(){return(R=(0,a._)((function*(e){try{return function({width:e,height:t}){const n=e/t,a=e<=F&&t<=F,o=M<n&&n<A;return e>=N&&t>=N&&a&&o}(yield(0,c.preloadImage)(e))}catch(e){return console.error(e),!1}}))).apply(this,arguments)}},826226:(e,t,n)=>{n.d(t,{ContactList:()=>E});n(200930);var a=n(667294),o=n(936890),s=n(331870),l=n(696023),i=n(126528),r=n(96190),c=n(821551),m=n(619688),u=n(274061),d=n(444831),_=n(24087),h=n(282384),p=n(67091),g=n(266295),f=n(686260),v=n(709646);const E=({items:e,contacts:t,hasMore:n,onSelect:o})=>{const r=(0,l.useDispatch)(),{lang:h}=(0,l.useBrowserEnv)(),p=(0,a.useRef)(null),E=(0,a.useRef)(null),[y,k]=(0,a.useState)(!1),[b,I]=(0,a.useState)("loading"),[S,w]=(0,a.useState)([]),{query:N,onChange:F,onKeyDown:M,onFocus:A,onBlur:L,reset:R,isFocused:B}=(0,f.useSearchHandlers)(),{viewer:{isVerified:z},profileType:x}=(0,l.useViewer)(),O=v.isEdu(x),P=(0,a.useCallback)((()=>k(!0)),[]),D=(0,a.useCallback)((()=>k(!1)),[]),V=(0,a.useCallback)((({index:e,style:t})=>a.createElement("li",{key:e,style:t,className:"ContactList__itemWrapper"},a.createElement("button",{className:"ContactList__importButton",onClick:P},a.createElement("span",{className:"ContactList__importButtonIcon"},a.createElement(s.Icon20UserAddOutline,null)),h.use("me_contacts_import")))),[h,P]),T=(0,a.useMemo)((()=>O&&!z?[]:[V]),[V,O,z]),U=(0,a.useMemo)((()=>c.add(c.create(),[...e.values(),...t.values()],(e=>({id:"Contact"===e.kind&&e.userId?e.userId:e.id,strings:c.peerWords(e)})))),[t,e]);(0,a.useEffect)((()=>{n?r({type:"LoadContactList",offset:0}):(w([...e.keys(),...t.keys()]),I(0===e.size?"empty":"results"))}),[n,r,e,t]),(0,a.useEffect)((()=>{var e;null==(e=E.current)||e.focus()}),[]),(0,a.useEffect)((()=>{if("loading"!==b){if(N){const e=[...c.search(U,N).values()];return w(e),void I(e.length?"results":"empty")}w([...e.keys(),...t.keys()]),I(0===e.size?"empty":"results")}}),[t,N,e,U,b]);const G=(0,a.useCallback)((e=>{var t;return(null==(t=T[e.index])?void 0:t.call(T,e))||null}),[T]);return a.createElement("div",{className:"ContactList"},"loading"!==b&&t.size>0&&a.createElement("div",{className:"ContactList__search"},a.createElement(g.SearchInput,{active:B&&!!N,placeholder:h.use("me_convo_list_search_placeholder"),"aria-label":h.use("me_convo_list_search_placeholder"),htmlInputRef:E,query:N,onChange:F,onKeyDown:M,onFocus:A,onBlur:L,onReset:R})),"empty"!==b&&a.createElement("div",{className:"ContactList__contacts"},"loading"===b?a.createElement(i.OptimizedSpinner,{className:"ContactList__loader"}):a.createElement(m.default,null,(e=>a.createElement(_.default,{style:e},(({scrollableNodeRef:n,contentNodeRef:s})=>a.createElement(u.FixedSizeList,{ref:p,className:"ContactList__virtual",height:e.height||0,width:e.width||0,overscanCount:10,itemCount:T.length+S.length,itemSize:56,innerElementType:"ul",outerRef:n,innerRef:s,itemData:{onSelect:o,renderActionButton:G,actionButtons:T,contacts:t,results:S}},C)))))),"empty"===b&&a.createElement("div",{className:"ContactList__contacts"},a.createElement("ul",null,G({index:0,style:{},data:{}})),a.createElement("div",{className:"ContactList__noResults"},h.use(N?"me_search_empty_contacts":"me_contacts_empty"))),y&&a.createElement(d.ImportContactModal,{onClose:D}))},C=a.memo((({index:e,style:t,data:{contacts:n,results:s,onSelect:i,actionButtons:c,renderActionButton:m}})=>{const u=(0,l.usePeers)();if(e<c.length)return m({index:e,style:t,data:{}});const d=s[e-c.length];if(!d)return null;const _=u.get(d)||n.get(d);return!_||"User"!==_.kind&&"Contact"!==_.kind?null:a.createElement("li",{className:"ContactList__itemWrapper",key:_.id,style:t},a.createElement("div",{className:"ContactList__item",onClick:()=>i(_.id),role:"link"},a.createElement("div",{className:"ContactList__avatar"},a.createElement(o.Avatar,{peer:_,size:40,withBirthday:!0})),a.createElement("div",null,a.createElement("div",{className:"ContactList__name"},r.name(_)),_.lastSeen?a.createElement(h.OnlineStatus,{user:_,className:"ContactList__info"}):a.createElement(p.FormattedPhoneNumber,{phone:_.phone,className:"ContactList__info"}))))}))},143573:(e,t,n)=>{n.d(t,{CopyText:()=>o});n(215334);var a=n(667294);const o=({text:e,onCopyDone:t,children:n})=>{const o=(0,a.useRef)(null),s=(0,a.useCallback)((n=>{function a(){o.current&&(o.current.focus(),o.current.select(),document.execCommand("copy"),t&&t())}n.preventDefault(),n.stopPropagation(),navigator.clipboard.writeText?navigator.clipboard.writeText(e).then((()=>{t&&t()})).catch(a):a()}),[t,e]);return a.createElement("div",{className:"CopyText",onClick:s},a.createElement("input",{type:"text",readOnly:!0,value:e||"",ref:o,className:"CopyText__input"}),n)}},920582:(e,t,n)=>{n.d(t,{FieldGroup:()=>o,FieldGroupContentOverlap:()=>s,FieldGroupItem:()=>l});n(167509);var a=n(667294);const o=({title:e,children:t})=>a.createElement("div",{className:"FieldGroup"},e?a.createElement("div",{className:"FieldGroup__title"},e):null,a.createElement("div",{className:"FieldGroup__content"},t)),s=({children:e})=>a.createElement("div",{className:"FieldGroup__content-overlap"},e),l=({after:e,content:t,hint:n})=>a.createElement("div",{className:"FieldGroup__item"},a.createElement("div",{className:"FieldGroup__item-content"},t,n?a.createElement("div",{className:"FieldGroup__item-hint"},n):null),e?a.createElement("div",{className:"FieldGroup__item-after"},e):null)},936902:(e,t,n)=>{n.d(t,{FolderAddButton:()=>s});var a=n(36193),o=n(667294);n(554410);const s=({children:e,icon:t=o.createElement(a.Icon20Add,null),onClick:n})=>o.createElement("button",{type:"button",className:"FolderAddButton",onClick:n},t&&o.createElement("span",{className:"FolderAddButton__icon","aria-hidden":"true"},t),o.createElement("span",{className:"FolderAddButton__content"},e))},228053:(e,t,n)=>{n.d(t,{FolderAvatar:()=>m});var a=n(667294),o=n(661620),s=n(270608),l=n.n(s),i=n(294184),r=n.n(i),c=(n(518418),n(910682));const m=({name:e,size:t=40,variant:n="light",counter:s,defaultIcon:i=a.createElement(o.Icon20FolderOutline,null),style:m})=>{var u;return a.createElement("span",{className:r()("FolderAvatar",`FolderAvatar--size-${t}`,`FolderAvatar--variant-${n}`),style:m},s&&a.createElement("span",{className:"FolderAvatar__counter"},s),a.createElement("span",{className:"FolderAvatar__icon"},null!=(u=function(e){const t=function(e){const t=l()().exec(e);if(t&&t.length)return t[0];return}(e);return t?a.createElement(c.Emoji,{emoji:t}):null}(e))?u:i))}},679638:(e,t,n)=>{n.d(t,{FolderConvoListRow:()=>d});var a=n(667294),o=n(185327),s=n(96190),l=n(550946),i=n(696023),r=n(661059),c=n(282384),m=n(377291),u=n(936890);const d=({convo:e,showCheckbox:t,checkbox:n,before:d,after:_,onClick:h})=>{const p=(0,i.usePeers)(),g=(0,i.useOwner)(),{lang:f}=(0,i.useBrowserEnv)(),v=s.safeGet(p,e.peerId),E=s.isFavorites(v.id,g.id),C="ChatConvo"===e.kind&&e.activeCall?e.activeCall.participants.count>0?"filled":"empty":void 0;return a.createElement(l.FolderListRow,{showCheckbox:t,checkbox:n,before:d,after:_,onClick:h,title:a.createElement(r.ConvoTitle,{peer:v,isMuted:o.isMuted(e),isCasper:o.isCasper(e)}),subtitle:a.createElement(a.Fragment,null,("User"===v.kind||"Contact"===v.kind)&&!E&&a.createElement(c.OnlineStatus,{className:"ConvoHeader__online",user:v}),"ChatConvo"===e.kind&&"in"===e.state&&f.use("me_group_members_count",{num:e.membersCount,formatted:"short"})),avatar:E?a.createElement(m.AvatarFavorites,{size:40}):a.createElement(u.Avatar,{peer:v,size:40,withOnline:!0,activeCall:C,withBirthday:!0})})}},15475:(e,t,n)=>{n.d(t,{FolderForm:()=>y});var a=n(434788),o=n(820224),s=n(667294),l=n(999504),i=n(185327),r=(n(420526),n(679638)),c=n(270608),m=n.n(c),u=n(696023),d=n(936902),_=n(126528),h=n(86894),p=n(315954),g=n(943997),f=n(294184),v=n.n(f),E=n(24087),C=n(966933);const y=({name:e,folderId:t,peerIds:n,folders:a,convosCache:o,autoNameFocus:c=!0,onNameChange:f,onAddClick:y,onValidChange:b,onDeleteItem:I})=>{const S=(0,u.useDispatch)(),{lang:w}=(0,u.useBrowserEnv)(),N=(0,C.useLayoutData)(),F=a.find((e=>e.id===t)),M=(0,s.useRef)(null),[A,L]=(0,s.useState)(!1),R=(0,s.useCallback)((e=>{const t=e.replace(m()()," ").length;f(e),L(t>l.FOLDER_NAME_LIMIT)}),[f]),B=(0,s.useCallback)((e=>{const t=e.target.value;R(t)}),[R]),z=(0,s.useMemo)((()=>n.map((e=>i.safeGet(o,e)))),[o,n]),x=e.trim().length>0&&!A&&z.length>0;return(0,s.useEffect)((()=>{null==b||b(x)}),[x,b]),(0,s.useEffect)((()=>{R(e),M.current&&c&&M.current.focus()}),[]),s.createElement("div",{className:"FolderForm"},s.createElement(h.FormLayout,null,s.createElement(h.FormItem,{top:s.createElement("div",{className:"FolderForm__nameTitle"},w.use("me_folders_form_name_label")),className:"FolderForm__row",status:A?"error":"default",bottom:A?w.use("me_folders_form_name_error_limit"):w.use("me_folders_form_name_limit")},s.createElement(k,{type:"text",ref:M,placeholder:w.use("me_folders_form_name_placeholder"),value:e,onChange:B})),s.createElement(h.FormItem,{top:w.use("me_folders_form_convos_label"),className:"FolderForm__row"},s.createElement(E.default,{className:v()("FolderForm__convos-wrapper",{"FolderForm__convos-wrapper--two-column":"two-column"===N.mode})},s.createElement("ul",{className:"FolderForm__convos-list"},s.createElement("li",null,s.createElement(d.FolderAddButton,{onClick:y},w.use("me_folders_form_convos_action_change"))),z.map((e=>s.createElement("li",{key:e.peerId},s.createElement(r.FolderConvoListRow,{convo:e,after:I&&s.createElement(g.Tooltip,{content:w.use("me_folders_form_convo_remove_tooltip")},s.createElement("button",{type:"button","aria-label":w.use("me_folders_form_convo_remove_tooltip"),className:"FolderForm__delete-btn",onClick:()=>I(e.peerId)},s.createElement(p.Icon24Cancel,null)))})))),F&&F.all.hasMore&&s.createElement("li",{className:"FolderForm__loader"},s.createElement(_.OptimizedSpinner,{onIntersection:()=>S({type:"MoreConvosNeeded",organiser:{kind:"folders",id:F.id,filter:"all"}})})))))))},k=(0,s.forwardRef)(((e,t)=>{var{before:n,after:l,status:i="default",onFocus:r,onBlur:c}=e,m=(0,o._)(e,["before","after","status","onFocus","onBlur"]);const[u,d]=(0,s.useState)(!1),_=(0,s.useCallback)((e=>{null==r||r(e),d(!0)}),[r]),h=(0,s.useCallback)((e=>{null==c||c(e),d(!1)}),[c]);return s.createElement("label",{className:v()("FolderForm__input",`FolderForm__input--${i}`,{"FolderForm__input--focus":u})},n&&s.createElement("span",{className:"FolderForm__input-before"},n),s.createElement("input",(0,a._)({ref:t,onFocus:_,onBlur:h},m,{className:"FolderForm__input-control"})),l&&s.createElement("span",{className:"FolderForm__input-after"},l))}))},550946:(e,t,n)=>{n.d(t,{FolderListRow:()=>r});var a=n(667294),o=n(294184),s=n.n(o),l=(n(589648),n(690839)),i=n(299715);const r=({title:e,subtitle:t,avatar:n,onClick:o,before:r,after:c,showCheckbox:m,checkbox:u=!1})=>{const d=o?"button":"div";return a.createElement(d,{className:s()("FolderListRow",{"FolderListRow--clickable":Boolean(o)}),onClick:o},r&&a.createElement("span",{className:"FolderListRow__before"},r),m&&a.createElement("span",{className:s()("FolderListRow__checkbox",{"FolderListRow__checkbox--active":u})},u?a.createElement(l.Icon24CheckCircleOn,null):a.createElement(i.Icon24CheckCircleOff,null)),n&&a.createElement("span",{className:"FolderListRow__avatar"},n),a.createElement("span",{className:"FolderListRow__content"},a.createElement("span",{className:"FolderListRow__title"},e),t&&a.createElement("span",{className:"FolderListRow__sub-title"},t)),c&&a.createElement("span",{className:"FolderListRow__after"},c))}},320672:(e,t,n)=>{n.d(t,{FoldersModal:()=>S});var a=n(434788),o=n(233699),s=n(483704),l=n(86894),i=n(999504),r=n(185327),c=n(667294),m=n(266864),u=(n(894459),n(410519)),d=n(696023),_=n(228053),h=n(337400),p=n(15475),g=n(740779),f=n(294184),v=n.n(f),E=n(936902),C=n(689494),y=n(519478),k=n(248758),b=n(920582),I=n(966933);const S=({folders:e,locks:t,convos:n,onClose:a,withModal:o=!1,foldersView:s})=>{const{lang:i}=(0,d.useBrowserEnv)(),r=(0,I.useLayoutData)(),_=(0,u.useModalGroup)(),h=(0,u.useModal)(_.id),g=(0,u.useModal)(_.id),f=(0,u.useModal)(_.id),v=(0,u.useModal)(_.id),E=(0,u.useModal)(_.id),C=(0,d.useDispatch)(),y=t.newFolder,S=(0,d.usePrevious)(y),[F,A]=(0,c.useState)(new Set),[L,R]=(0,c.useState)(new Set),[B,z]=(0,c.useState)(""),[x,O]=(0,c.useState)(!1),[P,D]=(0,c.useState)(null),V=(0,c.useCallback)((e=>{D(e),A(new Set),R(new Set),z(""),O(!1)}),[]),T=(0,c.useMemo)((()=>e.find((e=>e.id===P))),[e,P]);(0,c.useEffect)((()=>{h.open()}),[]);const U=(0,c.useCallback)((()=>{C({type:"UserCreatedFolder",name:B,peerIds:Array.from(F)})}),[F,C,B]),G=(0,c.useCallback)((()=>{(null==T?void 0:T.id)&&C({type:"UserUpdatedFolder",folderId:T.id,name:B,addPeerIds:F,removePeerIds:L}),f.close(),V(null)}),[F,f,C,B,L,null==T?void 0:T.id,V]);(0,c.useEffect)((()=>{!y&&S&&(g.close(),V(null))}),[y,g,S,V]),(0,c.useLayoutEffect)((()=>{var e;z(null!=(e=null==T?void 0:T.name)?e:"")}),[T]);const H=(0,c.useCallback)((e=>{V(e),f.open()}),[f,V]),W=(0,c.useCallback)((()=>{null!==P&&(C({type:"UserDeletedFolder",folderId:P}),E.close(),f.close(),V(null))}),[C,V,P,E,f]),K=(0,c.useCallback)((e=>{F.delete(e)?A(new Set([...F])):R(new Set([...L,e]))}),[F,L]),$=(0,c.useCallback)((()=>{g.close(),V(null)}),[g.close,V]),Z=(0,c.useCallback)((()=>{f.close(),V(null)}),[f.close,V]),q=(0,c.useCallback)((e=>{const t=e.filter((e=>!(null==T?void 0:T.all.peerIds.has(e))));var n;const a=Array.from(null!=(n=null==T?void 0:T.all.peerIds)?n:[]).filter((t=>!e.includes(t)));F.forEach((t=>{e.includes(t)||F.delete(t)})),L.forEach((t=>{e.includes(t)&&L.delete(t)})),A(new Set([...F,...t])),R(new Set([...L,...a])),v.close()}),[F,v.close,L,null==T?void 0:T.all.peerIds]),j=(0,c.useMemo)((()=>{var e;return[...null!=(e=null==T?void 0:T.all.peerIds)?e:new Set,...F].filter((e=>!L.has(e)))}),[F,L,null==T?void 0:T.all.peerIds]);return c.createElement(c.Fragment,null,o?c.createElement(m.ModalInterface,{title:i.use("me_folders_title"),closeLabel:i.use("me_close"),onClose:a,withCustomLayout:!0,isHidden:!h.isActive,contextClass:"MEConfig"},c.createElement("div",{className:"FoldersModal"},e.length?c.createElement(N,{folders:e,isReorderEnabled:!t.reorderFolders,onFolderClick:H,onAddClick:g.open}):c.createElement(w,{onAddClick:g.open}),"one-column"!==r.mode&&"auto"===s&&c.createElement(k.FoldersViewSettings,null))):c.createElement(c.Fragment,null,c.createElement(b.FieldGroup,{title:i.use("me_folders_title")},e.length?c.createElement(N,{isCompact:!0,folders:e,isReorderEnabled:!t.reorderFolders,onFolderClick:H,onAddClick:g.open}):c.createElement(w,{onAddClick:g.open})),"one-column"!==r.mode&&"auto"===s&&c.createElement(b.FieldGroup,{title:i.use("me_folders_view_settings_title")},c.createElement(k.FoldersViewSettingsVariants,null))),g.isActive&&c.createElement(m.ModalInterface,{title:i.use("me_folder_create"),onClose:o?a:$,closeLabel:i.use("me_close"),onBack:o?$:void 0,backLabel:i.use("me_back"),contextClass:"MEConfig",withCustomLayout:!0,buttons:c.createElement(l.Button,{mode:"primary",onClick:U,disabled:x,loading:y},i.use("me_complete"))},c.createElement("div",{className:"FoldersModal__form"},c.createElement(p.FolderForm,{name:B,peerIds:j,onNameChange:z,onAddClick:v.open,convosCache:n,folders:e,autoNameFocus:"two-column"===r.mode,onDeleteItem:K,onValidChange:e=>O(!e)}))),f.isActive&&T&&c.createElement(m.ModalInterface,{title:i.use("me_folder_update"),onClose:o?a:Z,closeLabel:i.use("me_close"),onBack:o?Z:void 0,backLabel:i.use("me_back"),contextClass:"MEConfig",withCustomLayout:!0,buttons:[c.createElement(l.Button,{key:"delete",mode:"tertiary",hasHover:!1,onClick:E.open,className:"FoldersModal__delete-btn"},i.use("me_folder_delete_action")),c.createElement(l.Button,{key:"save",mode:"primary",onClick:G,disabled:x,loading:t.updateFolder.has(T.id)},i.use("me_complete"))]},c.createElement("div",{className:"FoldersModal__form"},c.createElement(p.FolderForm,{folderId:T.id,name:B,peerIds:j,onNameChange:z,onAddClick:v.open,convosCache:n,folders:e,autoNameFocus:"two-column"===r.mode,onDeleteItem:K,onValidChange:e=>O(!e)}))),v.isActive&&c.createElement(M,{initialPeerIds:j,showChips:null===P,onClose:o?a:v.close,onBack:v.close,onSubmit:q}),E.isActive&&T&&c.createElement(m.ModalInterface,{title:i.use("me_folder_delete_confirmation_modal_title"),onClose:o?a:E.close,onBack:o?E.close:void 0,closeLabel:i.use("me_close"),contextClass:"MEConfig",buttons:[c.createElement(l.Button,{key:"cancel",onClick:E.close,mode:"tertiary"},i.use("me_cancel")),c.createElement(l.Button,{key:"delete",onClick:W,mode:"primary"},i.use("me_folder_action_delete"))]},c.createElement("div",{className:"FoldersModal__delete"},i.use("me_folder_delete_confirmation_modal_text",{values:{name:T.name}}))))},w=({onAddClick:e})=>{const{lang:t}=(0,d.useBrowserEnv)();return c.createElement("div",{className:"FoldersModal__empty"},c.createElement(o.Icon56FolderPlusBadgeOutline,{className:"FoldersModal__empty-icon","aria-label":t.use("me_folder_list_modal_empty_icon_tooltip")}),c.createElement("p",{className:"FoldersModal__empty-text"},t.use("me_folder_list_modal_empty")),c.createElement("div",{className:"FoldersModal__empty-actions"},c.createElement(l.Button,{mode:"primary",onClick:e},t.use("me_folder_list_modal_empty_action_add"))))},N=({folders:e,isReorderEnabled:t,isCompact:n,onFolderClick:a,onAddClick:o})=>{const{lang:s}=(0,d.useBrowserEnv)(),l=(0,d.useDispatch)(),r=(0,c.useMemo)((()=>e.map((e=>e.id))),[e]);return c.createElement("div",{className:v()("FoldersModal__list",{"FoldersModal__list--compact":n})},c.createElement(E.FolderAddButton,{onClick:o},s.use("me_folder_list_modal_action_add")),c.createElement(g.SortableList,{items:r,onChange:e=>{l({type:"UserReorderedFolders",order:e.map((e=>i.resolveId(e)))})},disabled:!t},e.map((e=>c.createElement(F,{key:e.id,folder:e,onClick:a})))))},F=({folder:e,onClick:t})=>{const{active:n,disabled:o,isDragging:i,attrs:r,styles:m,setNodeRef:u,onMove:d,onStart:h,onEnd:p}=(0,g.useSortable)({id:e.id,lockAxis:"y"}),f=(0,I.useLayoutData)(),E=(0,c.useCallback)((()=>{t(e.id)}),[e.id,t]);return c.createElement("div",(0,a._)({ref:u,className:v()("FoldersModal__item",{"FoldersModal__item--dragging":n,"FoldersModal__item--no-hover":!n&&i}),onClick:E,style:m},r),c.createElement("span",{className:"FoldersModal__item-before","aria-hidden":"true"},c.createElement(_.FolderAvatar,{name:e.name,variant:"dark"})),c.createElement("span",{className:"FoldersModal__item-title"},e.name),c.createElement("span",{className:"FoldersModal__item-after"},c.createElement(l.Touch,{Component:"span",hidden:o,className:v()("FoldersModal__item-reorder",{"FoldersModal__item-reorder--visible":"one-column"===f.mode}),onStart:h,onEnd:p,onMove:d},c.createElement(s.Icon24DotsVertical,null))))},M=({initialPeerIds:e,showChips:t,onClose:n,onBack:a,onSubmit:o})=>{const[s,i]=(0,c.useState)(e),{lang:u}=(0,d.useBrowserEnv)();return c.createElement(m.ModalInterface,{title:u.use("me_folder_convo_select_title"),onClose:n,closeLabel:u.use("me_close"),onBack:a,backLabel:u.use("me_back"),withCustomLayout:!0,contextClass:"MEConfig",buttons:[c.createElement(l.Button,{key:"confirm",onClick:()=>o(s),disabled:0===s.length},u.use("me_folder_convo_select_confirm"))]},c.createElement("div",{className:"FoldersModal__convo-picker"},c.createElement(h.ConvoPicker,{searchRenderer:t?y.PeerChipsSearchInput:C.PickerSearchInput,selectedPeerIds:s,onSelectionChange:e=>i(e),strategy:"multiple",listFilter:r.canAddToFolder})))}},248758:(e,t,n)=>{n.d(t,{FoldersViewSettings:()=>r,FoldersViewSettingsVariants:()=>c});n(891695);var a=n(667294),o=n(294184),s=n.n(o),l=n(696023),i=n(87299);const r=()=>{const{lang:e}=(0,l.useBrowserEnv)();return a.createElement("div",{className:"FoldersViewSettings"},a.createElement("div",{className:"FoldersViewSettings__title"},e.use("me_folders_view_settings_title")),a.createElement(c,null))},c=()=>{const{settings:e}=(0,l.useViewer)(),t=(0,l.useDispatch)(),{lang:n}=(0,l.useBrowserEnv)(),o=e=>{t({type:"UserChangedSetting",setting:"verticalFoldersView",value:"vertical"===e})};return a.createElement("div",{className:"FoldersViewSettings__variants"},a.createElement("div",{className:s()("FoldersViewSettings__variant",{"FoldersViewSettings__variant--active":!e.verticalFoldersView}),onClick:()=>o("horizontal"),tabIndex:0,role:"button","aria-label":n.use("me_folders_view_settings_horizontal")},a.createElement("div",{className:"FoldersViewSettings__variantSkeleton"},a.createElement(i.FoldersViewSettingsSkeleton,{mode:"horizontal"})),a.createElement("div",{className:"FoldersViewSettings__variantTitle"},n.use("me_folders_view_settings_horizontal"))),a.createElement("div",{className:s()("FoldersViewSettings__variant",{"FoldersViewSettings__variant--active":e.verticalFoldersView}),onClick:()=>o("vertical"),tabIndex:0,role:"button","aria-label":n.use("me_folders_view_settings_vertical")},a.createElement("div",{className:"FoldersViewSettings__variantSkeleton"},a.createElement(i.FoldersViewSettingsSkeleton,{mode:"vertical"})),a.createElement("div",{className:"FoldersViewSettings__variantTitle"},n.use("me_folders_view_settings_vertical"))))}},87299:(e,t,n)=>{n.d(t,{FoldersViewSettingsSkeleton:()=>s});n(150637);var a=n(667294),o=n(86894);const s=({mode:e})=>{const t=(0,o.useAppearance)(),n=[...Array("vertical"===e?3:2)],s="vertical"===e?86:146,i="vertical"===e?56:82,r="dark"===t?"content_tint_background":"skeleton_foreground_to";return a.createElement("div",{className:`FoldersViewSettingsSkeleton FoldersViewSettingsSkeleton--${e}`},a.createElement("div",{className:"FoldersViewSettingsSkeleton__folders"},a.createElement(l,{width:32,height:"vertical"===e?32:8,bg:"accent"}),a.createElement(l,{width:32,height:"vertical"===e?32:8,bg:"accent"}),a.createElement(l,{width:32,height:"vertical"===e?32:8,bg:"accent"})),a.createElement("div",{className:"FoldersViewSettingsSkeleton__items"},n.map(((e,t)=>a.createElement("div",{className:"FoldersViewSettingsSkeleton__item",key:t},a.createElement("div",{className:"FoldersViewSettingsSkeleton__itemAvatar"},a.createElement(l,{width:40,height:40,bg:r})),a.createElement("div",{className:"FoldersViewSettingsSkeleton__itemContent"},a.createElement(l,{width:s,height:8,bg:r}),a.createElement(l,{width:i,height:8,bg:r})))))))},l=({width:e,height:t,bg:n})=>a.createElement("div",{style:{width:`${e}px`,height:`${t}px`,background:`var(--${n})`,borderRadius:`${t}px`}})},444831:(e,t,n)=>{n.d(t,{ImportContactModal:()=>i});var a=n(667294),o=n(410519),s=n(379656),l=n(210770);n(928910);const i=({onClose:e})=>{const t=(0,o.useModalGroup)(),n=(0,o.useModal)(t.id),i=(0,o.useModal)(t.id),[r,c]=(0,a.useState)(null);return(0,a.useLayoutEffect)((()=>(n.open(),()=>{t.closeGroup()})),[n.open,t.closeGroup]),a.createElement(a.Fragment,null,n.isActive&&a.createElement(s.InputContactModal,{openInviteModal:i.open,onClose:e,setContactPhone:c}),i.isActive&&r&&a.createElement(l.InviteContactModal,{contactPhone:r,onClose:e,onBack:()=>{i.close()}}))}},379656:(e,t,n)=>{n.d(t,{InputContactModal:()=>f});var a=n(11010),o=n(434788),s=n(667294),l=n(86894),i=n(294184),r=n.n(i),c=n(89131),m=n(96190),u=n(696023),d=n(364705),_=n(966933),h=n(276351),p=n(266864);n(522283);const g={status:"default",value:""},f=({onClose:e,openInviteModal:t,setContactPhone:i})=>{const{lang:f}=(0,u.useBrowserEnv)(),{navigate:v}=(0,d.useRouter)(),{mode:E}=(0,_.useLayoutData)(),{isLoading:C,importContact:y}=(0,h.useImportContact)(),[k,b]=(0,s.useState)(!0),[I,S]=(0,s.useState)({phone:g,name:g,surname:g}),w=(0,u.useDispatch)(),N=(0,s.useMemo)((()=>!(I.phone.value&&I.name.value.trim())),[I.name.value,I.phone.value]),F=(0,s.useRef)(null);(0,s.useEffect)((()=>{n.e(4387).then(n.bind(n,304387)).then((({getAsYouType:e})=>{F.current=e("RU"),b(!1)}))}),[]);const M=(0,s.useCallback)(((e,t)=>{S((n=>{const a=(0,o._)({},n);return a[e]=t,a}))}),[]),A=(0,s.useCallback)((0,a._)((function*(e){const t=e.target.name;var n,a;(n=t,["phone","name","surname"].some((e=>n===e))&&F.current)&&("phone"===t?(F.current.reset(e.target.value.replace(/[^\d+]/g,"")),M(t,{status:"default",value:null==(a=F.current)?void 0:a.number()})):M(t,{status:"default",value:e.target.value.trim()}))})),[M]),L=(0,s.useCallback)((0,a._)((function*(){const e=I.phone.value,n=I.name.value,a=I.surname.value;if(!(0,c.isValidPhoneNumber)(e))return M("phone",{status:"error",value:e});if(0===n.length)return M("name",{status:"error",value:n});const o=yield y({phone:e,name:n,surname:a});var s;o.hasFailed?(i(e),t()):(w({type:"ImportContact",profile:o.profile,contact:o.contact}),v({kind:"ConvoRoute",peerId:(null==(s=o.profile)?void 0:s.id)?m.resolveRealId("User",o.profile.id):m.resolveRealId("Contact",o.contact.id),entrypoint:"contacts_list"}))})),[w,I.name.value,I.phone.value,I.surname.value,y,v,t,i,M]),R=C||k,B="one-column"===E;return s.createElement(p.ModalInterface,{title:f.use("me_contacts_import_modal_title"),closeLabel:f.use("me_close"),onClose:e,buttons:s.createElement(l.Button,{disabled:N,loading:R,mode:"primary",onClick:L},f.use("me_contacts_import_add_button")),contextClass:"MEConfig",withCustomLayout:!0},s.createElement(l.FormLayout,{className:r()("ImportContactModal",{"ImportContactModal--fullScreen":B}),onSubmit:e=>{e.preventDefault(),L()}},s.createElement(l.FormItem,{top:s.createElement(s.Fragment,null,f.use("me_contacts_import_modal_phone_input")," ",s.createElement("span",{className:"InputContactModal__requiredSymbol"},"*")),status:I.phone.status},s.createElement(l.Input,{type:"tel",maxLength:250,autoComplete:"tel",name:"phone",value:I.phone.value,onChange:A,placeholder:f.use("me_contacts_import_tel_placeholder"),disabled:R,required:!0})),s.createElement(l.FormLayoutGroup,{mode:"horizontal"},s.createElement(l.FormItem,{top:s.createElement(s.Fragment,null,f.use("me_contacts_import_modal_name_input")," ",s.createElement("span",{className:"InputContactModal__requiredSymbol"},"*")),status:I.name.status},s.createElement(l.Input,{maxLength:250,type:"text",name:"name",autoComplete:"given-name",onChange:A,disabled:R,required:!0})),s.createElement(l.FormItem,{top:f.use("me_contacts_import_modal_surname_input")},s.createElement(l.Input,{maxLength:250,type:"text",name:"surname",autoComplete:"family-name",onChange:A,disabled:R})))))}},210770:(e,t,n)=>{n.d(t,{InviteContactModal:()=>_});var a=n(667294),o=n(86894),s=n(294184),l=n.n(s),i=n(95154),r=n(696023),c=n(966933),m=n(266864),u=n(143573),d=(n(950652),n(388918));const _=({contactPhone:e,onClose:t,onBack:n})=>{const{lang:s}=(0,r.useBrowserEnv)(),{mode:_}=(0,c.useLayoutData)(),[h,p]=(0,a.useState)(!1),g=(0,a.useRef)(null);(0,a.useEffect)((()=>()=>{g.current&&clearTimeout(g.current)}),[]);const f="one-column"===_;return a.createElement(m.ModalInterface,{title:s.use("me_contacts_invite_modal_title"),closeLabel:s.use("me_close"),onClose:t,contextClass:"MEConfig",backLabel:s.use("me_back"),onBack:n,withCustomLayout:!0},a.createElement("div",{className:l()("InviteContactModal",{"InviteContactModal--fullScreen":f})},a.createElement("div",{className:"InviteContactModal__textWrapper"},a.createElement("p",{className:"InviteContactModal__text"},a.createElement(d.FormattedLangKey,{langkey:"me_contacts_invite_modal_user_not_found",values:{phone:a.createElement("span",{className:"InviteContactModal__phone"},e)}})),a.createElement("p",{className:"InviteContactModal__text"},s.use("me_contacts_invite_modal_app_promo"))),a.createElement(o.Input,{className:"InviteContactModal__linkBox",value:i.VKME_APP_INSTALL_LINK,readOnly:!0,autoFocus:!0,type:"text"}),a.createElement("div",{className:"InviteContactModal__linkCopyWrapper"},a.createElement(u.CopyText,{onCopyDone:()=>{p(!0),g.current&&clearTimeout(g.current),g.current=setTimeout((()=>p(!1)),2e3)},text:i.VKME_APP_INSTALL_LINK},a.createElement(o.Button,{mode:"secondary",size:"m"},s.use("me_contacts_invite_modal_link_copy"))),a.createElement("span",{className:l()("InviteContactModal__linkCopyNotice",{"InviteContactModal__linkCopyNotice--blink":h})},s.use("me_contacts_invite_modal_link_copied")))))}},276351:(e,t,n)=>{n.d(t,{useImportContact:()=>i});var a=n(11010),o=n(696023),s=n(95154),l=n(667294);const i=()=>{const{api:e}=(0,o.useBrowserEnv)(),[t,n]=(0,l.useState)(!1);return{isLoading:t,importContact:(0,l.useCallback)((0,a._)((function*({phone:t,name:a,surname:o}){var l,i;n(!0);const r=o?a+" "+o:a,c=yield e.fetch("account.importMessagesContacts",{contacts:JSON.stringify([{phones:[t],name:r}]),extended:1,device_id:s.CLIENT_ID.toString()});return 0!==c.items.synced.length&&(null==(l=c.contacts)?void 0:l[0])?(n(!1),{items:c.items,profile:null==(i=c.profiles)?void 0:i[0],contact:c.contacts[0],hasFailed:!1}):{hasFailed:!0}})),[e])}}},803220:(e,t,n)=>{n.d(t,{OptionsListItem:()=>i,OptionsListItemWrapper:()=>c});n(181362);var a=n(667294),o=n(294184),s=n.n(o),l=n(658508);const i=({icon:e,title:t,description:n,aside:o,isPadded:i=!0,isInteractive:r,hasChevron:m,hasIconBackground:u,onClick:d,className:_})=>a.createElement(c,{onClick:d,isInteractive:r,className:_,isPadded:i},a.createElement("div",{className:s()("OptionsListItem__icon",{"OptionsListItem__icon--withBG":u}),"aria-hidden":!0},e),a.createElement("div",{className:"OptionsListItem__main"},a.createElement("div",{className:"OptionsListItem__title"},t),n&&a.createElement("div",{className:"OptionsListItem__description"},n)),m&&a.createElement("div",{className:"OptionsListItem__aside OptionsListItem__aside--chevron"},a.createElement(l.Icon28ChevronRightOutline,null)),o&&a.createElement("div",{className:"OptionsListItem__aside"},o));function r(e){e.preventDefault()}const c=({children:e,className:t,isInteractive:n,isPadded:o=!0,onClick:l})=>{const i=s()("OptionsListItem",t,{"OptionsListItem--interactive":null!=n?n:l,"OptionsListItem--padded":o});return a.createElement("li",{className:i,onClick:l,tabIndex:l?0:void 0,onMouseDown:l?r:void 0},e)}},689494:(e,t,n)=>{n.d(t,{PickerSearchInput:()=>i});var a=n(667294),o=(n(726566),n(696023)),s=n(195192),l=n(966933);const i=({onQueryChange:e,placeholder:t,selection:n})=>{const{lang:i}=(0,o.useBrowserEnv)(),r=(0,a.useRef)(null),[c,m]=(0,a.useState)(""),{isTouchOnly:u}=(0,l.useDeviceData)();return(0,a.useEffect)((()=>{e(c)}),[c]),(0,a.useEffect)((()=>{r.current&&(u||r.current.focus())}),[u,n]),a.createElement("div",{className:"PickerSearchInput"},a.createElement(s.Icon16SearchOutline,{className:"PickerSearchInput__icon"}),a.createElement("input",{ref:r,className:"PickerSearchInput__input",placeholder:t||i.use("me_picker_peer_search_placeholder"),onChange:e=>{m(e.currentTarget.value)},value:c}))}},574018:(e,t,n)=>{n.d(t,{ProfileInfoModal:()=>E});var a=n(11010),o=n(354943),s=n(86894),l=n(696023),i=n(294184),r=n.n(i),c=n(667294),m=(n(929894),n(89131)),u=n(96190),d=n(597990),_=n(882670),h=n(906978),p=n(402423),g=n(95154),f=n(927411),v=n(597298);const E=({onBack:e,isVKIDHidden:t=!1})=>{const{viewer:n,profileInfo:{phoneNumber:i,id:E,avatarPhoto:C,screenName:y="",firstName:k,lastName:b}}=(0,l.useViewer)(),I=(0,l.useFeatureFlags)(),{api:S,lang:w,uploader:N}=(0,l.useBrowserEnv)(),[F,M]=(0,c.useState)(),[A,L]=(0,c.useState)(!1),[R,B]=(0,c.useState)(y),[z,x]=(0,c.useState)(!1),[O,P]=(0,c.useState)(!1),[D,V]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[G,H]=(0,c.useState)(!1),[W,K]=(0,c.useState)(!1),[$,Z]=(0,c.useState)(),q=(0,c.useMemo)((()=>n.photoId&&Number(n.photoId)),[n.photoId]),j=(0,c.useMemo)((()=>null==i?void 0:i.replace(/\*/g,"·")),[i]),Y=(0,l.useDispatch)(),J=(0,c.useCallback)((0,a._)((function*(){V(!0);try{const[e,t]=yield S.fetchMany([{method:"account.getProfileInfo",params:{}},{method:"users.get",params:{user_ids:u.toRealId(E).toString(),extended:1}}]),n=(0,d.fromApiViewerProfileInfo)(e),a=t[0],{user:o}=a?(0,_.fromApiUser)(a):{};Y({type:"UserProfileInfo_Update",profileInfo:n,user:o})}catch(e){}finally{V(!1)}})),[E,Y,S]),Q=(0,a._)((function*(){P(!0);try{yield S.fetch("photos.delete",{photo_id:Number(q),owner_id:E}),yield J()}catch(e){}finally{P(!1)}})),X=(0,a._)((function*(){U(!0);try{return yield S.fetch("account.saveProfileInfo",{screen_name:R}),!0}catch(t){var e;if(t instanceof f.IApi.RequestError)t.code===h.API_ERROR_AUTH_VALIDATION&&"string"==typeof(null==(e=t.payload)?void 0:e.redirect_uri)&&window.open(t.payload.redirect_uri);return!1}finally{U(!1)}})),ee=(0,a._)((function*(e){H(!0);try{return yield new Promise(((t,n)=>{N.uploadFiles([e],{asOwnerPhoto:!0},{viewerId:E},{onUploadFinish:t,onError:n})})),!0}catch(e){return!1}finally{H(!1)}}));(0,c.useEffect)((()=>{Z(C?{kind:"current"}:void 0)}),[C]),(0,c.useEffect)((()=>{B(y||"")}),[y]);const te=!("current"===(null==$?void 0:$.kind)&&R===y||F||z||O||D||T||G),ne=(0,c.useRef)(R);ne.current=R;const ae=(0,c.useMemo)((()=>(0,m.debounce)((e=>{S.fetch("utils.checkScreenName",{screen_name:e}).then((t=>{ne.current===e&&(0===t.status?(L(!1),M(t.reason)):1===t.status&&(L(!0),M(void 0)))})).catch((()=>{})).finally((()=>{ne.current===e&&x(!1)}))}),500,!1)),[S]);(0,c.useEffect)((()=>{const e=()=>{document.hidden||J().catch((()=>{}))};return document.addEventListener("visibilitychange",e),()=>document.removeEventListener("visibilitychange",e)}),[Y,E,J]);const oe=(0,a._)((function*(){if(!te)return;K(!0);const t="preview"===(null==$?void 0:$.kind)&&$.photo,n=R!==y,[a,o]=yield Promise.all([n&&X(),t&&ee($.photo)]);a||o?(yield J(),K(!1),e()):K(!1)})),se=(0,a._)((function*(e){Z({kind:"preview",photo:e})})),le=(0,c.useMemo)((()=>F?"error":A?"valid":"default"),[F,A]),ie=(0,c.useMemo)((()=>{switch(le){case"error":return F;case"valid":return w.use("me_profile_info_shortname_avaliable");default:return""}}),[F,w,le]);return c.createElement(c.Fragment,null,c.createElement(s.FormLayout,{className:"MEApp__settings ProfileInfo__container",onSubmitCapture:oe},t?null:c.createElement("div",{className:r()("ProfileInfo__VKID",!I.vkm_profile_info_screen_name&&"ProfileInfo__VKID--noScreenName")},c.createElement("div",{className:"ProfileInfo__VKIDAvatar"},c.createElement(p.AvatarSelector,{isLoading:O,key:C,size:64,onSelection:se,onRemove:()=>{"current"===(null==$?void 0:$.kind)&&q?Q().catch((()=>{})):"preview"===(null==$?void 0:$.kind)&&Z(C?{kind:"current"}:void 0)},peerId:n.id,isDisabled:O})),c.createElement(v.ExternalLink,{href:`${g.ID_VK_COM_BASE}/account/#/personal`,className:"ProfileInfo__VKIDDetailsCard"},c.createElement("p",{className:"ProfileInfo__name"},k," ",b),c.createElement("p",{className:"ProfileInfo__phoneNumber"},j),c.createElement("p",{className:"ProfileInfo__VKIDSettings"},w.use("me_vkid_settings")),c.createElement(o.Icon24ChevronCompactRight,{className:"ProfileInfo__chevron"}))),I.vkm_profile_info_screen_name&&c.createElement(c.Fragment,null,c.createElement(s.FormItem,{className:"ProfileInfo__noVKUIFormItemPadding ProfileInfo__shortNameBox",top:c.createElement("div",{className:"ProfileInfo__screenNameInputTop"},c.createElement("span",null,w.use("me_profile_info_shortname")),c.createElement("span",null,R.length," / ",25)),status:le,bottom:ie},c.createElement(s.Input,{after:z&&c.createElement(s.Spinner,{size:"small"}),value:R,maxLength:25,onChange:e=>{const{value:t}=e.target;L(!1),M(void 0),x(!1),B(t),t!==y&&(x(!0),ae(t))}})),c.createElement("div",{className:"ProfileInfo__screenNameDescription"},c.createElement("p",null,w.use("me_profile_info_shortname_description")," ",y||A?c.createElement(c.Fragment,null,w.use("me_profile_info_your_shortname")," ",A?c.createElement("span",{className:"ProfileInfo__avaliableScreenName"},"@",R):c.createElement("span",{onClick:()=>navigator.clipboard.writeText(`@${y}`),className:"ProfileInfo__screenName"},"@",y)):null),c.createElement("p",{className:"ProfileInfo__screenNameValidationInfo"},w.use("me_profile_info_shortname_validation_rules")," ",c.createElement("span",{className:"ProfileInfo__a-z0-9"},"a-z"),","," ",w.use("me_profile_info_shortname_validation_rules_digits")," ",c.createElement("span",{className:"ProfileInfo__a-z0-9"},"0-9")," ",w.use("me_profile_info_shortname_validation_rules_point"),"."," ",w.use("me_profile_info_shortname_validation_rules_min_length"))))),c.createElement("footer",{className:"ChatSettings__footer"},c.createElement(s.Button,{disabled:!te,loading:W,onClick:oe},w.use("me_save"))))}},266295:(e,t,n)=>{n.d(t,{SearchInput:()=>m});var a=n(434788),o=n(820224),s=n(667294),l=n(294184),i=n.n(l),r=n(250237),c=n(858016);n(471376);const m=e=>{var{query:t,onChange:n,onKeyDown:l,onFocus:m,onBlur:u,onReset:d,active:_,htmlInputRef:h}=e,p=(0,o._)(e,["query","onChange","onKeyDown","onFocus","onBlur","onReset","active","htmlInputRef"]);return s.createElement("label",{className:i()("SearchInput__searchControl",{"SearchInput__searchControl--active":_})},s.createElement("span",{className:"SearchInput__searchIcon"},s.createElement(r.Icon16Search,{style:{color:"var(--icon_medium)"}})),s.createElement("input",(0,a._)({type:"search",className:"SearchInput__searchInput",ref:h,value:t||"",onChange:n,onKeyDown:l,onFocus:m,onBlur:u},p)),s.createElement("button",{className:"SearchInput__searchCancel",tabIndex:-1,onClick:d},s.createElement(c.Icon16Clear,null)))}},369379:(e,t,n)=>{n.d(t,{ProfileInfoControl:()=>M,Settings:()=>I});n(252495);var a=n(667294),o=n(597298),s=n(803220),l=n(743597),i=n(778816),r=n(951891),c=n(284069),m=n(851594),u=n(19675),d=n(926128),_=n(538649),h=n(386835),p=n(315226),g=n(141343),f=n(571150),v=n(354943),E=n(86894),C=n(311323),y=n(696023),k=n(126528),b=n(895043);const I=({isLoading:e,set:t=new Set(["ctrSubmit","soundNotifications","showRecommendations","countOnlyNotMuted","autoUnarchive","transcriptAutoShow","theme","push"]),profileInfoControl:n})=>{const{lang:g,browserNotifications:f}=(0,y.useBrowserEnv)(),{settings:v}=(0,y.useViewer)(),C=(0,y.useFeatureFlags)(),I=(0,y.useDispatch)();return(0,b.useStatsOnMount)({type:"type_navgo",type_navgo:{screen:"settings",subtype:"go"}}),a.createElement("ul",{className:"Settings"},e&&a.createElement(k.OptimizedSpinner,{className:"Settings__loader"}),n&&a.createElement(s.OptionsListItemWrapper,{className:"Settings__profileOptionItem",isPadded:!1},n),t.has("ctrSubmit")&&a.createElement(s.OptionsListItem,{icon:a.createElement(l.Icon28SendCircleFillGray,null),title:g.use("me_settings_message_submit"),aside:a.createElement(S,{isCtrSubmitSelected:v.ctrSubmit,onChange:e=>I({type:"UserChangedSetting",setting:"ctrSubmit",value:e})})}),t.has("soundNotifications")&&a.createElement(s.OptionsListItem,{icon:a.createElement(i.Icon28VolumeCircleFillGray,null),title:g.use("me_settings_sound_notifications"),aside:a.createElement(E.Switch,{className:"Settings__switch",checked:v.soundNotifications,onChange:e=>I({type:"UserChangedSetting",setting:"soundNotifications",value:Boolean(e.target.checked)})})}),t.has("showRecommendations")&&a.createElement(s.OptionsListItem,{icon:a.createElement(r.Icon28UsersCircleFillGray,null),title:g.use("me_settings_show_recommendations"),aside:a.createElement(E.Switch,{className:"Settings__switch",checked:v.showRecommendations,onChange:e=>I({type:"UserChangedSetting",setting:"showRecommendations",value:Boolean(e.target.checked)})})}),t.has("countOnlyNotMuted")&&a.createElement(s.OptionsListItem,{icon:a.createElement(c.Icon28MessageUnreadCircleFillGray,null),title:g.use("me_settings_count_not_muted"),description:g.use("me_settings_count_not_muted_note"),aside:a.createElement(E.Switch,{className:"Settings__switch",checked:!v.countOnlyNotMuted,onChange:e=>I({type:"UserChangedSetting",setting:"countOnlyNotMuted",value:!Boolean(e.target.checked)})})}),t.has("autoUnarchive")&&a.createElement(s.OptionsListItem,{icon:a.createElement(m.Icon28ArchiveCircleFillGray,null),title:g.use("me_settings_auto_unarchive"),description:g.use("me_settings_auto_unarchive_note"),aside:a.createElement(E.Switch,{className:"Settings__switch",checked:v.autoUnarchive,onChange:e=>I({type:"UserChangedSetting",setting:"autoUnarchive",value:Boolean(e.target.checked)})})}),f&&a.createElement(s.OptionsListItem,{icon:a.createElement(u.Icon28NotificationCircleFillGray,null),title:g.use("me_settings_browser_notifications"),aside:a.createElement(w,{browserNotifications:f})}),v.teacherVerification&&a.createElement(s.OptionsListItem,{icon:a.createElement(d.Icon28EducationCircleFillGray,null),title:g.use("me_settings_teacher_verification_title"),description:g.use("me_settings_teacher_verification"),aside:a.createElement(o.ExternalLink,{href:"https://sferum.ru/?s=me",className:"Settings__link"},g.use("me_settings_teacher_verification_link"))}),t.has("transcriptAutoShow")&&a.createElement(s.OptionsListItem,{icon:a.createElement(_.Icon28TextCircleFillGray,null),title:g.use("me_settings_auto_transcript"),aside:a.createElement(E.Switch,{className:"Settings__switch",checked:v.transcriptAutoShow,onChange:e=>I({type:"UserChangedSetting",setting:"transcriptAutoShow",value:Boolean(e.target.checked)})})}),C.vkm_reactions&&t.has("messageReactionAnimation")&&a.createElement(s.OptionsListItem,{icon:a.createElement(h.Icon16Stars,{fill:"var(--white)"}),hasIconBackground:!0,title:g.use("me_settings_message_reactions_animation"),aside:a.createElement(E.Switch,{className:"Settings__switch",checked:v.messageReactionAnimation,onChange:e=>I({type:"UserChangedSetting",setting:"messageReactionAnimation",value:Boolean(e.target.checked)})})}),C.vkm_reactions&&t.has("push")&&a.createElement(s.OptionsListItem,{icon:a.createElement(u.Icon28NotificationCircleFillGray,null),title:g.use("me_settings_reaction_notifications"),aside:a.createElement(E.Switch,{className:"Settings__switch",checked:v.push.messageReaction.isEnabled,onChange:e=>I({type:"UserChangedPushSetting",setting:"messageReaction",value:{isEnabled:Boolean(e.target.checked),withMessageText:!0}})})}),t.has("theme")&&a.createElement(s.OptionsListItem,{icon:a.createElement(p.Icon28SunglassesCircleFillGray,null),title:g.use("me_settings_theme"),aside:a.createElement(F,{theme:v.theme,onChange:e=>I({type:"SettingThemeUpdated",value:e})})}))},S=({isCtrSubmitSelected:e,onChange:t})=>{const{lang:n}=(0,y.useBrowserEnv)(),o=(0,a.useRef)(null),[s,l]=(0,a.useState)(!1),i=(0,a.useCallback)((e=>{if(!(e.target instanceof HTMLInputElement))return;const n=Boolean(Number(e.target.value));t(n)}),[t]),r=e?n.use("me_settings_message_submit_option_ctr"):n.use("me_settings_message_submit_option_default");return a.createElement("div",{className:"Settings__select"},a.createElement(C.PopoutRoot,{popout:s?a.createElement(E.ActionSheet,{onClose:()=>l(!1),toggleRef:o,popupDirection:"bottom"},a.createElement(E.ActionSheetItem,{autoclose:!0,subtitle:n.use("me_settings_message_submit_option_default_note"),selectable:!0,checked:!e,value:"0",onChange:i},n.use("me_settings_message_submit_option_default")),a.createElement(E.ActionSheetItem,{autoclose:!0,subtitle:n.use("me_settings_message_submit_option_ctr_note"),selectable:!0,checked:e,value:"1",onChange:i},n.use("me_settings_message_submit_option_ctr"))):null},a.createElement("button",{className:"Settings__button",ref:o,onClick:()=>l(!0)},r,a.createElement("span",{className:"Settings__buttonChevron"},a.createElement(g.Icon12Dropdown,null)))))},w=({browserNotifications:e})=>{const t=(0,y.useDispatch)(),{settings:n}=(0,y.useViewer)(),{lang:o}=(0,y.useBrowserEnv)();return"external"===n.browserNotifications?a.createElement("button",{className:"Settings__button",onClick:e.onExternal},o.use("me_settings_browser_notifications_external")," ",a.createElement("span",{className:"Settings__buttonChevron"},a.createElement(f.Icon12Chevron,null))):a.createElement(E.Switch,{className:"Settings__switch",checked:n.browserNotifications,onChange:n=>e.onChange(Boolean(n.target.checked)).then((e=>t({type:"UserChangedBrowserNotifications",value:e})))})},N=["light","dark","system"],F=({theme:e,onChange:t})=>{const{lang:n}=(0,y.useBrowserEnv)(),o=(0,a.useRef)(null),[s,l]=(0,a.useState)(!1),i=(0,a.useCallback)((e=>{if(e.target instanceof HTMLInputElement)switch(e.target.value){case"light":case"dark":case"system":t(e.target.value)}}),[t]);return a.createElement("div",{className:"Settings__select"},a.createElement(C.PopoutRoot,{popout:s?a.createElement(E.ActionSheet,{onClose:()=>l(!1),toggleRef:o,popupDirection:"top"},N.map((t=>a.createElement(E.ActionSheetItem,{key:t,autoclose:!0,selectable:!0,checked:e===t,value:t,onChange:i},n.use(`me_settings_theme_${t}`))))):null},a.createElement("button",{className:"Settings__button",ref:o,onClick:()=>l(!0)},n.use(`me_settings_theme_${e}`),a.createElement("span",{className:"Settings__buttonChevron"},a.createElement(g.Icon12Dropdown,null)))))},M=({profileInfo:e,onClick:t})=>a.createElement(E.Cell,{className:"Settings__profile",onClick:t,before:a.createElement(E.Avatar,{className:"Settings__profileAvatar",size:64,src:e.avatarPhoto}),after:a.createElement(v.Icon24ChevronCompactRight,{className:"Settings__chevron"})},a.createElement("p",{className:"Settings__name"},e.firstName," ",e.lastName),e.screenName&&a.createElement("p",{className:"Settings__screenName"},"@",e.screenName))},324247:(e,t,n)=>{n.d(t,{SettingsContent:()=>L,VKCOMSettingsContent:()=>G});var a=n(11010),o=(n(321248),n(667294)),s=n(294184),l=n.n(s),i=n(24087),r=n(387613),c=n(661980),m=n(519979),u=n(141343),d=n(571150),_=n(86894),h=n(696023),p=n(966933),g=n(597298),f=n(920582),v=n(402423),E=n(574018),C=n(410519),y=n(266864),k=n(320672),b=n(599660),I=n(89131),S=n(96190),w=n(95154),N=n(597990),F=n(882670),M=n(163332),A=n(15285);const L=({route:e,convos:t,locks:n,folders:a,onLogout:s,foldersView:c})=>{const{mode:m}=(0,p.useLayoutData)(),{lang:u}=(0,h.useBrowserEnv)(),{section:d="main"}=e,_=(0,o.useMemo)((()=>{switch(d){case"account":return u.use("me_account");case"main":return u.use("me_settings_menu_main");case"folders":return u.use("me_settings_menu_folders");case"notifications":return u.use("me_settings_menu_notifications");case"theme":return u.use("me_settings_menu_theme");case"about":return u.use("me_settings_menu_about");default:(0,I.exhaustivenessCheck)(d)}}),[d,u]);return o.createElement(i.default,{className:l()("SettingsContent",{"SettingsContent--mobile":"one-column"===m})},o.createElement("header",{className:"SettingsContent__header"},o.createElement(g.Link,{className:"SettingsContent__header-back",to:{kind:"SettingsRoute"}},o.createElement(r.Icon24Back,null)),o.createElement("h2",{className:"SettingsContent__header-text"},_)),o.createElement("div",{className:"SettingsContent__body"},(()=>{switch(d){case"account":return o.createElement(O,{onLogout:s});case"main":return o.createElement(R,null);case"folders":return o.createElement(z,{folders:a,convos:t,locks:n,foldersView:c});case"notifications":return o.createElement(B,null);case"theme":return o.createElement(x,{themeControl:!0});case"about":return null;default:(0,I.exhaustivenessCheck)(d)}})()))},R=()=>{const{lang:e}=(0,h.useBrowserEnv)(),{settings:t}=(0,h.useViewer)(),n=(0,h.useDispatch)(),a=(0,h.useFeatureFlags)();return o.createElement(o.Fragment,null,o.createElement(f.FieldGroup,{title:e.use("me_settings_input_mode")},o.createElement(f.FieldGroupItem,{after:o.createElement(P,{isCtrSubmitSelected:t.ctrSubmit,onChange:e=>n({type:"UserChangedSetting",setting:"ctrSubmit",value:e})}),content:e.use("me_settings_message_submit")}),a.vkm_message_context_menu&&o.createElement(f.FieldGroupItem,{after:o.createElement(D,{isContextMenuEnabled:t.messageActionsContextMenu,onChange:e=>n({type:"UserChangedSetting",setting:"messageActionsContextMenu",value:e})}),content:e.use("me_settings_message_actions_control")})),o.createElement(f.FieldGroup,{title:e.use("me_settings_voice_messages")},o.createElement(f.FieldGroupItem,{content:e.use("me_settings_auto_transcript"),after:o.createElement(_.Switch,{checked:t.transcriptAutoShow,onChange:e=>n({type:"UserChangedSetting",setting:"transcriptAutoShow",value:Boolean(e.target.checked)})})})),o.createElement(f.FieldGroup,{title:e.use("me_settings_archive")},o.createElement(f.FieldGroupItem,{content:e.use("me_settings_auto_unarchive"),hint:e.use("me_settings_auto_unarchive_note"),after:o.createElement(_.Switch,{checked:t.autoUnarchive,onChange:e=>n({type:"UserChangedSetting",setting:"autoUnarchive",value:Boolean(e.target.checked)})})})))},B=({countOnlyNotMutedControl:e})=>{const{lang:t,browserNotifications:n}=(0,h.useBrowserEnv)(),{settings:a}=(0,h.useViewer)(),s=(0,h.useDispatch)(),l=(0,h.useFeatureFlags)();return o.createElement(o.Fragment,null,o.createElement(f.FieldGroup,{title:t.use("me_settings_application")},o.createElement(f.FieldGroupItem,{content:t.use("me_settings_sound_notifications"),after:o.createElement(_.Switch,{checked:a.soundNotifications,onChange:e=>s({type:"UserChangedSetting",setting:"soundNotifications",value:Boolean(e.target.checked)})})}),e&&o.createElement(f.FieldGroupItem,{content:t.use("me_settings_count_not_muted"),after:o.createElement(_.Switch,{checked:!a.countOnlyNotMuted,onChange:e=>s({type:"UserChangedSetting",setting:"countOnlyNotMuted",value:!Boolean(e.target.checked)})})}),n&&o.createElement(f.FieldGroupItem,{content:t.use("me_settings_browser_notifications"),after:o.createElement(V,{browserNotifications:n})}),l.vkm_reactions&&o.createElement(f.FieldGroupItem,{content:t.use("me_settings_reaction_notifications"),after:o.createElement(_.Switch,{checked:a.push.messageReaction.isEnabled,onChange:e=>s({type:"UserChangedPushSetting",setting:"messageReaction",value:{isEnabled:Boolean(e.target.checked),withMessageText:!0}})})})))},z=({folders:e,convos:t,locks:n,foldersView:a})=>o.createElement(k.FoldersModal,{onClose:()=>{},convos:t,locks:n,folders:e,foldersView:a}),x=({themeControl:e})=>{const{lang:t}=(0,h.useBrowserEnv)(),{settings:n}=(0,h.useViewer)(),a=(0,h.useDispatch)(),s=(0,h.useFeatureFlags)();return o.createElement(f.FieldGroup,null,e&&o.createElement(f.FieldGroupItem,{content:t.use("me_settings_theme"),after:o.createElement(U,{theme:n.theme,onChange:e=>a({type:"SettingThemeUpdated",value:e})})}),s.vkm_reactions&&o.createElement(f.FieldGroupItem,{content:t.use("me_settings_message_reactions_animation"),after:o.createElement(_.Switch,{checked:n.messageReactionAnimation,onChange:e=>a({type:"UserChangedSetting",setting:"messageReactionAnimation",value:Boolean(e.target.checked)})})}))},O=({onLogout:e})=>{const t=(0,C.useModal)(),[n,s]=(0,o.useState)(!1),[l,i]=(0,o.useState)(!1),r=(0,h.useFeatureFlags)(),{lang:m,uploader:u,api:d}=(0,h.useBrowserEnv)(),p=(0,h.useDispatch)(),{viewer:k,profileInfo:{phoneNumber:I,id:M,firstName:A,lastName:L,screenName:R,avatarPhoto:B}}=(0,h.useViewer)(),[z,x]=(0,o.useState)(),O=(0,o.useMemo)((()=>null==I?void 0:I.replace(/\*/g,"•")),[I]),P=(0,o.useMemo)((()=>k.photoId&&Number(k.photoId)),[k.photoId]),D=(0,o.useCallback)((0,a._)((function*(){try{const[e,t]=yield d.fetchMany([{method:"account.getProfileInfo",params:{}},{method:"users.get",params:{user_ids:S.toRealId(M).toString(),extended:1}}]),n=(0,N.fromApiViewerProfileInfo)(e),a=t[0],{user:o}=a?(0,F.fromApiUser)(a):{};p({type:"UserProfileInfo_Update",profileInfo:n,user:o})}catch(e){}})),[M,p,d]),V=(0,a._)((function*(){i(!0);try{yield d.fetch("photos.delete",{photo_id:Number(P),owner_id:M}),yield D()}catch(e){}finally{i(!1)}})),T=(0,a._)((function*(){if("preview"===(null==z?void 0:z.kind)&&z.photo){s(!0);try{yield new Promise(((e,t)=>{u.uploadFiles([z.photo],{asOwnerPhoto:!0},{viewerId:M},{onUploadFinish:e,onError:t})})),yield D()}catch(e){}finally{s(!1)}}})),U=(0,a._)((function*(e){x({kind:"preview",photo:e})}));return(0,o.useEffect)((()=>{x(B?{kind:"current"}:void 0)}),[B]),o.createElement(o.Fragment,null,o.createElement("div",{className:"SettingsContent__avatar"},o.createElement(v.AvatarSelector,{isLoading:n||l,key:B,size:80,onSelection:U,onRemove:()=>{"current"===(null==z?void 0:z.kind)&&P?V().catch((()=>{})):"preview"===(null==z?void 0:z.kind)&&x(B?{kind:"current"}:void 0)},onUpload:T,peerId:M,isDisabled:n||l})),o.createElement(f.FieldGroup,null,o.createElement(f.FieldGroupItem,{content:`${A} ${L}`,hint:O,after:o.createElement(_.Button,{Component:g.ExternalLink,href:`${w.ID_VK_COM_BASE}/account/#/personal`,target:"_blank",mode:"tertiary"},m.use("me_change_in_vkid"))}),r.vkm_profile_info_screen_name?o.createElement(f.FieldGroupItem,{content:m.use("me_profile_info_shortname"),hint:o.createElement("span",{className:"SettingsContent__accent"},"@",R),after:o.createElement(_.Button,{mode:"tertiary",onClick:t.open},m.use("me_edit"))}):null),o.createElement(f.FieldGroup,null,o.createElement(f.FieldGroupContentOverlap,null,o.createElement(b.ActionsMenuAction,{leftIcon:o.createElement(c.Icon20DoorArrowRightOutline,null),onClick:e,title:m.use("me_account_logout"),type:"primary",size:"large"}))),t.isActive&&o.createElement(y.ModalInterface,{onClose:t.close,closeLabel:m.use("me_close"),backLabel:m.use("me_back"),title:m.use("me_account_editing"),withCustomLayout:!0},o.createElement(E.ProfileInfoModal,{isVKIDHidden:!0,onBack:t.close})))},P=({isCtrSubmitSelected:e,onChange:t})=>{const{lang:n}=(0,h.useBrowserEnv)(),a="Enter",s=A.isMac?"Cmd + Enter":"Ctrl + Enter",l=e?s:a;return o.createElement(M.Dropdown,{openType:"click",hideOnClick:!0,content:o.createElement(b.ActionsMenu,null,o.createElement(b.ActionsMenuAction,{onClick:()=>t(!1),title:a,subtitle:n.use("me_settings_message_submit_option_default_note"),rightIcon:o.createElement(m.Icon16Done,{style:{visibility:e?"hidden":"visible"}}),type:"primary"}),o.createElement(b.ActionsMenuAction,{onClick:()=>t(!0),title:s,subtitle:n.use("me_settings_message_submit_option_ctr_note"),rightIcon:o.createElement(m.Icon16Done,{style:{visibility:e?"visible":"hidden"}}),type:"primary"})),align:"right",position:"bottom"},o.createElement(_.Button,{mode:"tertiary",after:o.createElement(u.Icon12Dropdown,null)},l))},D=({isContextMenuEnabled:e,onChange:t})=>{const{lang:n}=(0,h.useBrowserEnv)(),a=e?n.use("me_settings_message_actions_control_context_menu"):n.use("me_settings_message_actions_control_button");return o.createElement(M.Dropdown,{openType:"click",hideOnClick:!0,content:o.createElement(b.ActionsMenu,null,o.createElement(b.ActionsMenuAction,{onClick:()=>t(!1),title:n.use("me_settings_message_actions_control_button"),rightIcon:o.createElement(m.Icon16Done,{style:{visibility:e?"hidden":"visible"}}),type:"primary"}),o.createElement(b.ActionsMenuAction,{onClick:()=>t(!0),title:n.use("me_settings_message_actions_control_context_menu"),rightIcon:o.createElement(m.Icon16Done,{style:{visibility:e?"visible":"hidden"}}),type:"primary"})),align:"right",position:"bottom"},o.createElement(_.Button,{mode:"tertiary",after:o.createElement(u.Icon12Dropdown,null)},a))},V=({browserNotifications:e})=>{const t=(0,h.useDispatch)(),{settings:n}=(0,h.useViewer)(),{lang:a}=(0,h.useBrowserEnv)();return"external"===n.browserNotifications?o.createElement(_.Button,{mode:"tertiary",after:o.createElement(d.Icon12Chevron,null),onClick:e.onExternal},a.use("me_settings_browser_notifications_external")):o.createElement(_.Switch,{checked:n.browserNotifications,onChange:n=>e.onChange(Boolean(n.target.checked)).then((e=>t({type:"UserChangedBrowserNotifications",value:e})))})},T=["system","light","dark"],U=({theme:e,onChange:t})=>{const{lang:n}=(0,h.useBrowserEnv)();return o.createElement(M.Dropdown,{openType:"click",hideOnClick:!0,content:o.createElement(b.ActionsMenu,null,T.map((a=>o.createElement(b.ActionsMenuAction,{key:a,onClick:()=>t(a),title:n.use(`me_settings_theme_${a}`),rightIcon:o.createElement(m.Icon16Done,{style:{visibility:e===a?"visible":"hidden"}}),type:"primary"})))),align:"right",position:"bottom"},o.createElement(_.Button,{mode:"tertiary",after:o.createElement(u.Icon12Dropdown,null)},n.use(`me_settings_theme_${e}`)))},G=({activeSection:e,convos:t,locks:n,folders:a,foldersView:s})=>{const l=(0,o.useMemo)((()=>{switch(e){case"account":case"about":return null;case"main":return o.createElement(R,null);case"folders":return o.createElement(z,{folders:a,convos:t,locks:n,foldersView:s});case"notifications":return o.createElement(B,{countOnlyNotMutedControl:!0});case"theme":return o.createElement(x,null);default:(0,I.exhaustivenessCheck)(e)}}),[e,t,a,s,n]);return o.createElement(i.default,{className:"SettingsContent"},o.createElement("div",{className:"SettingsContent__body"},l))}},635402:(e,t,n)=>{n.d(t,{SettingsMenu:()=>E,VKCOMSettingsMenu:()=>C});n(661342);var a=n(667294),o=n(24087),s=n(294184),l=n.n(s),i=n(387613),r=n(784118),c=n(661620),m=n(707599),u=n(644695),d=n(735166),_=n(86894),h=n(696023),p=n(966933),g=n(597298),f=n(599660),v=n(611654);const E=({route:e})=>{const{mode:t}=(0,p.useLayoutData)(),{lang:n,router:s}=(0,h.useBrowserEnv)(),{profileInfo:d}=(0,h.useViewer)(),v=(0,a.useMemo)((()=>{var e;return null==d||null==(e=d.phoneNumber)?void 0:e.replace(/\*/g,"•")}),[null==d?void 0:d.phoneNumber]);return a.createElement(o.default,{className:l()("SettingsMenu",{"SettingsMenu--mobile":"one-column"===t})},a.createElement("header",{className:"SettingsMenu__header"},a.createElement(g.Link,{className:"SettingsMenu__back",to:"two-column"!==t&&e.section&&"main"!==e.section?{kind:"SettingsRoute"}:{kind:"MainRoute"}},a.createElement(i.Icon24Back,null)),a.createElement("h3",{className:"SettingsMenu__title"},n.use("me_route_settings"))),a.createElement("div",{className:"SettingsMenu__content"},a.createElement(f.ActionsMenuAction,{size:"large",isActive:"account"===e.section,onClick:()=>s.push({kind:"SettingsRoute",section:"account"}),leftIcon:a.createElement(_.Avatar,{className:"Settings__profileAvatar",size:48,src:d.avatarPhoto}),title:a.createElement("div",{className:"SettingsMenu__profileInfo-content"},a.createElement("p",{className:"SettingsMenu__name"},d.firstName," ",d.lastName),v&&a.createElement("p",{className:"SettingsMenu__phone"},v),d.screenName&&a.createElement("p",{className:"Settings__screenName"},"@",d.screenName))}),a.createElement(f.ActionsMenuAction,{onClick:()=>s.push({kind:"SettingsRoute",section:"main"}),title:n.use("me_settings_menu_main"),leftIcon:a.createElement(r.Icon20GearOutline,null),type:"primary",size:"large",isActive:"two-column"===t&&!e.section||"main"===e.section}),a.createElement(f.ActionsMenuAction,{onClick:()=>s.push({kind:"SettingsRoute",section:"folders"}),title:n.use("me_settings_menu_folders"),leftIcon:a.createElement(c.Icon20FolderOutline,null),type:"primary",size:"large",isActive:"folders"===e.section}),a.createElement(f.ActionsMenuSeparator,null),a.createElement(f.ActionsMenuAction,{onClick:()=>s.push({kind:"SettingsRoute",section:"notifications"}),title:n.use("me_settings_menu_notifications"),leftIcon:a.createElement(m.Icon20NotificationOutline,null),type:"primary",size:"large",isActive:"notifications"===e.section}),a.createElement(f.ActionsMenuAction,{onClick:()=>s.push({kind:"SettingsRoute",section:"theme"}),title:n.use("me_settings_menu_theme"),leftIcon:a.createElement(u.Icon20PalleteOutline,null),type:"primary",size:"large",isActive:"theme"===e.section})))},C=({activeSection:e})=>{const{lang:t,router:n}=(0,h.useBrowserEnv)(),o=(0,h.useFeatureFlags)(),s=(0,a.useCallback)((e=>{"back"!==e?n.push({kind:"SettingsRoute",section:e}):n.push({kind:"MainRoute"})}),[n]),l=(0,a.useMemo)((()=>{const e=[{type:"item",id:"back",before:a.createElement(d.Icon20ArrowLeftOutline,{fill:"var(--icon_secondary)"}),label:t.use("me_return_in_messenger")},{type:"separator"},{type:"item",id:"main",before:a.createElement(r.Icon20GearOutline,{fill:"var(--icon_secondary)"}),label:t.use("me_settings_menu_main")},{type:"item",id:"folders",before:a.createElement(c.Icon20FolderOutline,{fill:"var(--icon_secondary)"}),label:t.use("me_settings_menu_folders")},{type:"separator"},{type:"item",id:"notifications",before:a.createElement(m.Icon20NotificationOutline,{fill:"var(--icon_secondary)"}),label:t.use("me_settings_menu_notifications")}];return(o.vkm_reactions||o.vkm_message_context_menu)&&e.push({type:"item",id:"theme",before:a.createElement(u.Icon20PalleteOutline,{fill:"var(--icon_secondary)"}),label:t.use("me_settings_menu_theme")}),e}),[o.vkm_message_context_menu,o.vkm_reactions,t]);return a.createElement(v.RightMenu,{className:"VKCOMSettingsMenu",selectedId:e,items:l,onSelect:s})}}}]);try{stManager.done("dist/6371cbc4dd835690f02354240daa0a3d.549824445c54d0ddf377.js")}catch(e){}