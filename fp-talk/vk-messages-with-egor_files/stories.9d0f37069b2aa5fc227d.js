(()=>{"use strict";var __webpack_modules__={20403:(e,t,i)=>{i.d(t,{Icon12Favorite:()=>s});var s=(0,i(825028).makeIcon)("Icon12Favorite","favorite_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="favorite_12"><path d="m4.559 2.876-.277.653a.337.337 0 0 1-.044.086.15.15 0 0 1-.048.037.322.322 0 0 1-.093.02l-.403.059c-1.136.163-1.703.245-1.942.516a1.015 1.015 0 0 0-.233.866c.07.357.518.723 1.412 1.454l.153.124c.04.033.06.05.074.07.011.02.019.04.022.062a.344.344 0 0 1-.011.103l-.046.245c-.25 1.347-.375 2.02-.178 2.35.17.285.47.465.796.479.378.016.895-.423 1.93-1.3l.177-.15a.351.351 0 0 1 .111-.077.146.146 0 0 1 .082 0c.03.008.057.031.111.077l.178.15c1.034.877 1.55 1.316 1.929 1.3a.979.979 0 0 0 .796-.479c.197-.33.072-1.003-.178-2.35l-.046-.245a.344.344 0 0 1-.01-.103.154.154 0 0 1 .021-.061.339.339 0 0 1 .074-.07l.153-.125c.894-.731 1.342-1.097 1.412-1.454.06-.31-.025-.631-.233-.866-.239-.27-.806-.353-1.942-.516l-.403-.058c-.048-.007-.072-.01-.093-.02a.15.15 0 0 1-.048-.038c-.015-.018-.024-.04-.044-.086l-.277-.653c-.455-1.071-.682-1.607-1-1.77a.965.965 0 0 0-.881 0c-.319.163-.546.699-1.001 1.77Z" /></symbol>',12,12,!1,void 0)},600820:(e,t,i)=>{i.d(t,{Icon12VerifiedAlt:()=>s});var s=(0,i(825028).makeIcon)("Icon12VerifiedAlt","verified_alt_12","0 0 12 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 12 12" id="verified_alt_12"><path d="M4.5 7.586 2.957 6.043a1 1 0 0 0-1.414 1.414l2.25 2.25a1 1 0 0 0 1.414 0l5.25-5.25a1 1 0 0 0-1.414-1.414L4.5 7.586Z" /></symbol>',12,12,!1,void 0)},74106:(e,t,i)=>{i.d(t,{Icon16ChevronOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon16ChevronOutline","chevron_outline_16","0 0 12 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 16" id="chevron_outline_16"><path fill="currentColor" fill-rule="evenodd" d="M4.22 3.47a.75.75 0 0 1 1.06 0l4 4a.75.75 0 0 1 0 1.06l-4 4a.75.75 0 0 1-1.06-1.06L7.69 8 4.22 4.53a.75.75 0 0 1 0-1.06z" clip-rule="evenodd" /></symbol>',12,16,!1,void 0)},742783:(e,t,i)=>{i.d(t,{Icon16Pin:()=>s});var s=(0,i(825028).makeIcon)("Icon16Pin","pin_16","0 0 16 16",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16" id="pin_16"><path fill="currentColor" d="m10.235 2.106 3.657 3.663c.225.226.064.633-.263.633h-.523a.895.895 0 0 0-.633.263L10.758 8.38a.896.896 0 0 0-.262.633v2.996c0 .554-.7.858-1.1.456l-2.301-2.3-3.57 3.57a.893.893 0 1 1-1.264-1.263L5.83 8.898l-2.29-2.29c-.391-.392-.109-1.102.456-1.102H6.99a.895.895 0 0 0 .633-.262L9.338 3.53a.896.896 0 0 0 .263-.634V2.37c0-.32.403-.495.634-.263z" /></symbol>',16,16,!1,void 0)},530036:(e,t,i)=>{i.d(t,{Icon20MarketOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon20MarketOutline","market_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="market_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M7.25 5.75a2.75 2.75 0 0 1 5.5 0V6h-5.5zm-1.5.254V5.75a4.25 4.25 0 0 1 8.5 0v.254c1.013.014 1.62.073 2.112.323a3 3 0 0 1 1.311 1.311C18 8.28 18 9.12 18 10.8v.5c0 2.52 0 3.78-.49 4.743a4.5 4.5 0 0 1-1.967 1.966c-.963.491-2.223.491-4.743.491H9.2c-2.52 0-3.78 0-4.743-.49a4.5 4.5 0 0 1-1.967-1.967C2 15.08 2 13.82 2 11.3v-.5c0-1.68 0-2.52.327-3.162a3 3 0 0 1 1.311-1.311c.492-.25 1.1-.31 2.112-.323zm-.798 1.532C5.377 7.5 5.935 7.5 6.8 7.5h6.4c.865 0 1.423.001 1.848.036.408.033.559.09.633.127a1.5 1.5 0 0 1 .655.656c.038.074.095.225.128.633.035.425.036.983.036 1.848v.5c0 1.285-.001 2.158-.056 2.833-.054.658-.151.994-.271 1.229a3 3 0 0 1-1.311 1.311c-.235.12-.57.217-1.229.27C12.958 17 12.085 17 10.8 17H9.2c-1.285 0-2.158-.001-2.833-.056-.658-.054-.994-.151-1.229-.271a3 3 0 0 1-1.311-1.311c-.12-.235-.217-.57-.27-1.229C3.5 13.458 3.5 12.585 3.5 11.3v-.5c0-.865.001-1.423.036-1.848.033-.408.09-.559.127-.633a1.5 1.5 0 0 1 .656-.656c.074-.037.225-.094.633-.127zm.798 2.339a.875.875 0 1 1 1.75 0 .875.875 0 0 1-1.75 0zM13.375 9a.875.875 0 1 0 0 1.75.875.875 0 0 0 0-1.75z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},763242:(e,t,i)=>{i.d(t,{Icon24MessageOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon24MessageOutline","message_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="message_outline_24"><path fill="currentColor" d="M7.713 18.202a.9.9 0 0 1 1-.259A9.364 9.364 0 0 0 12 18.53c4.502 0 8.1-3.085 8.1-6.815S16.502 4.9 12 4.9s-8.1 3.084-8.1 6.814c0 1.283.423 2.515 1.214 3.586a.9.9 0 0 1 .176.538c-.003.893-.376 2.179-1.114 3.915 1.654-.184 2.82-.71 3.537-1.551zm-4.324 3.413c-.914.036-1.594-.943-1.209-1.795.776-1.715 1.203-2.974 1.292-3.724-.891-1.312-1.372-2.815-1.372-4.382C2.1 6.924 6.56 3.1 12 3.1s9.9 3.823 9.9 8.614-4.46 8.615-9.9 8.615c-1.157 0-2.287-.173-3.353-.506-1.21 1.116-2.975 1.703-5.258 1.792z" /></symbol>',24,24,!1,void 0)},729400:(e,t,i)=>{i.d(t,{Icon24NarrativeOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon24NarrativeOutline","narrative_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="narrative_outline_24"><path fill="currentColor" d="M14.298 1.435c.732.17 1.377.543 1.891 1.092.521.556.825 1.145 1.151 2.298l.79 2.944a1 1 0 1 1-1.931.518l-.72-2.69-.113-.401c-.215-.729-.377-1.024-.636-1.302a1.726 1.726 0 0 0-.887-.512c-.37-.086-.707-.078-1.445.1l-.405.104L6.866 4.96c-.854.228-1.254.394-1.51.583l-.06.047-.134.119c-.26.243-.43.539-.512.886-.093.4-.076.763.148 1.638l2.723 10.17.113.401c.215.729.377 1.024.636 1.302.244.26.54.43.887.512.401.093.745.076 1.607-.14a1 1 0 1 1 .487 1.94c-1.148.288-1.805.32-2.549.147a3.726 3.726 0 0 1-1.891-1.092c-.521-.556-.825-1.145-1.151-2.298L2.922 8.963c-.355-1.324-.405-2.027-.22-2.823a3.722 3.722 0 0 1 .93-1.728l.183-.182.179-.157c.496-.412 1.077-.685 2.091-.973l.263-.072 5.128-1.374c1.323-.355 2.026-.405 2.822-.22zM18.368 11c2 0 3.632 1.592 3.632 3.567 0 1.91-.772 2.851-3.78 5.134l-1.328 1.007c-.527.4-1.257.4-1.784 0l-1.328-1.007C10.772 17.418 10 16.476 10 14.567 10 12.592 11.631 11 13.632 11c.829 0 1.595.224 2.282.66l.086.057.086-.057a4.174 4.174 0 0 1 2.036-.653zm0 2c-.63 0-1.17.228-1.67.716l-.349.34a.5.5 0 0 1-.698 0l-.35-.34c-.5-.488-1.04-.716-1.67-.716-.906 0-1.631.707-1.631 1.567 0 .993.4 1.546 2.524 3.185L16 18.875l1.012-.767c2.45-1.859 2.957-2.442 2.988-3.44l.001-.1c0-.86-.725-1.568-1.632-1.568z" /></symbol>',24,24,!1,void 0)},898366:(e,t,i)=>{i.d(t,{Icon24ShareOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon24ShareOutline","share_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="share_outline_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" fill-rule="nonzero" d="M11.996 3.725A2.15 2.15 0 0 0 10 5.87l-.001 2.117-.02.005a9.904 9.904 0 0 0-7.827 10.721c.083.811 1.116 1.103 1.611.455l.187-.237a9.082 9.082 0 0 1 5.836-3.265l.213-.026.001 2.494a2.15 2.15 0 0 0 3.476 1.692l7.824-6.132a2.15 2.15 0 0 0 0-3.384l-7.824-6.132a2.15 2.15 0 0 0-1.326-.458zm.154 1.795a.35.35 0 0 1 .216.075l7.824 6.132a.35.35 0 0 1 0 .55l-7.824 6.133a.35.35 0 0 1-.566-.276l-.001-3.447a.9.9 0 0 0-.915-.9l-.233.004-.342.017a10.88 10.88 0 0 0-6.119 2.365l-.174.144.024-.135a8.103 8.103 0 0 1 6.968-6.537.9.9 0 0 0 .791-.893L11.8 5.87a.35.35 0 0 1 .35-.35z" /></g></symbol>',24,24,!1,void 0)},427323:(e,t,i)=>{i.d(t,{Icon24SmileOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon24SmileOutline","smile_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="smile_outline_24"><path d="M8.438 14.297a.9.9 0 0 1 1.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 0 0 1.773-.488c.191-.12.382-.26.53-.432a.9.9 0 0 1 1.4 1.132 4.045 4.045 0 0 1-.976.826A5.094 5.094 0 0 1 12 17.15a5.094 5.094 0 0 1-2.727-.762 3.987 3.987 0 0 1-.976-.826.9.9 0 0 1 .14-1.265Zm1.812-4.047a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0ZM15 11.5A1.25 1.25 0 1 0 15 9a1.25 1.25 0 0 0 0 2.5Zm-3-9.4c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9ZM3.9 12a8.1 8.1 0 1 1 16.2 0 8.1 8.1 0 0 1-16.2 0Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},648184:(e,t,i)=>{i.d(t,{Icon24StoryOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon24StoryOutline","story_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" id="story_outline_24"><path fill="currentColor" fill-rule="evenodd" d="M10.3 3h-.039C9.174 3 8.303 3 7.6 3.058c-.723.059-1.349.183-1.924.476a4.9 4.9 0 0 0-2.142 2.141c-.293.576-.418 1.202-.477 1.924C3 8.303 3 9.175 3 10.261v3.478c0 1.087 0 1.958.058 2.661.059.723.183 1.349.476 1.925a4.9 4.9 0 0 0 2.141 2.14c.576.294 1.202.419 1.924.478.704.057 1.575.057 2.662.057h3.478c1.087 0 1.958 0 2.661-.058.723-.059 1.349-.183 1.925-.476a4.9 4.9 0 0 0 2.14-2.141c.294-.576.419-1.202.478-1.925.057-.703.057-1.574.057-2.661v-3.478c0-1.087 0-1.958-.058-2.661-.059-.723-.183-1.349-.476-1.924a4.9 4.9 0 0 0-2.141-2.142c-.576-.293-1.202-.417-1.925-.476C15.697 3 14.826 3 13.74 3H10.3ZM6.493 5.138c.28-.143.642-.236 1.253-.286C8.368 4.8 9.166 4.8 10.3 4.8h3.4c1.135 0 1.932 0 2.554.051.611.05.974.144 1.253.287a3.1 3.1 0 0 1 1.355 1.355c.143.28.237.642.287 1.253.05.622.051 1.42.051 2.554v3.4c0 1.135 0 1.932-.051 2.554-.05.611-.144.974-.287 1.253a3.1 3.1 0 0 1-1.355 1.355c-.28.143-.642.237-1.253.287-.622.05-1.419.051-2.554.051h-3.4c-1.135 0-1.932 0-2.554-.051-.611-.05-.974-.144-1.253-.287a3.1 3.1 0 0 1-1.355-1.355c-.143-.28-.236-.642-.286-1.253C4.8 15.632 4.8 14.835 4.8 13.7v-3.4c0-1.135 0-1.932.051-2.554.05-.611.144-.974.287-1.253a3.1 3.1 0 0 1 1.355-1.355ZM9.8 12a2.199 2.199 0 1 1 4.398 0A2.199 2.199 0 0 1 9.8 12ZM12 8.001a3.999 3.999 0 1 0 0 7.998 3.999 3.999 0 0 0 0-7.998Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},449909:(e,t,i)=>{i.d(t,{Icon24ViewOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon24ViewOutline","view_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="view_outline_24"><path d="M12 4.6c5.2 0 10.4 4.237 10.4 7.4 0 3.163-5.2 7.4-10.4 7.4S1.6 15.163 1.6 12c0-3.163 5.2-7.4 10.4-7.4Zm0 1.8c-4.278 0-8.6 3.522-8.6 5.6s4.322 5.6 8.6 5.6 8.6-3.522 8.6-5.6-4.322-5.6-8.6-5.6Zm0 2.2a3.4 3.4 0 1 1 0 6.8 3.4 3.4 0 0 1 0-6.8Zm0 1.8a1.6 1.6 0 1 0 0 3.2 1.6 1.6 0 0 0 0-3.2Z" /></symbol>',24,24,!1,void 0)},376175:(e,t,i)=>{i.d(t,{Icon28AddOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon28AddOutline","add_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="add_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path fill="currentColor" fill-rule="nonzero" d="M14 4a1 1 0 0 1 1 1v8h8a1 1 0 0 1 0 2h-8v8a1 1 0 0 1-2 0v-8H5a1 1 0 0 1 0-2h8V5a1 1 0 0 1 1-1Z" /></g></symbol>',28,28,!1,void 0)},566631:(e,t,i)=>{i.d(t,{Icon28CommentOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon28CommentOutline","comment_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="comment_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path fill="currentColor" fill-rule="nonzero" d="M16.06 20.354c.298-.26.68-.404 1.076-.404h4.447c1.17 0 1.867-.697 1.867-1.867V8.75c0-1.17-.697-1.867-1.867-1.867h-14c-1.17 0-1.866.697-1.866 1.867v9.333c0 1.17.696 1.867 1.866 1.867H10.5c.816.235.816.235 1.051 1.051v3.3l4.51-3.947Zm-5.752 5.934c-.551-.413-.858-1.142-.858-1.788v-2.45H7.583c-2.33 0-3.966-1.637-3.966-3.967V8.75c0-2.33 1.636-3.967 3.966-3.967h14c2.33 0 3.967 1.637 3.967 3.967v9.333c0 2.33-1.637 3.967-3.967 3.967h-4.272l-4.345 3.802c-.855.839-1.854 1.04-2.659.436Z" /></g></symbol>',28,28,!1,void 0)},738219:(e,t,i)=>{i.d(t,{Icon28Like:()=>s});var s=(0,i(825028).makeIcon)("Icon28Like","like_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 28 28" id="like_28"><path fill="currentColor" d="M9.026 4.88A6.526 6.526 0 0 0 2.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 0 0 2.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 0 0-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88z" /></symbol>',28,28,!1,void 0)},668088:(e,t,i)=>{i.d(t,{Icon28LikeOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon28LikeOutline","like_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="like_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path fill="currentColor" fill-rule="nonzero" d="M9.026 4.88A6.526 6.526 0 0 0 2.5 11.406c0 3.613 1.445 5.421 7.493 10.126l2.78 2.16a2 2 0 0 0 2.455 0l2.779-2.16c6.048-4.705 7.493-6.513 7.493-10.126a6.526 6.526 0 0 0-6.526-6.526c-1.872 0-3.538.85-4.974 2.487C12.564 5.73 10.898 4.88 9.026 4.88Zm0 2c1.52 0 2.889.858 4.152 2.683l.205.298a.75.75 0 0 0 1.234 0l.205-.298c1.263-1.825 2.633-2.683 4.152-2.683 2.5 0 4.526 2.027 4.526 4.526 0 2.78-1.137 4.204-6.721 8.547L14 22.114l-2.779-2.161C5.637 15.61 4.5 14.187 4.5 11.406c0-2.5 2.027-4.526 4.526-4.526Z" /></g></symbol>',28,28,!1,void 0)},936739:(e,t,i)=>{i.d(t,{Icon28ServicesOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon28ServicesOutline","services_outline_28","0 0 28 28",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" id="services_outline_28"><g fill="none" fill-rule="evenodd"><path d="M0 0h28v28H0z" /><path fill="currentColor" fill-rule="nonzero" d="M9.116 15c1.065 0 1.623.108 2.205.419.54.289.971.72 1.26 1.26.311.582.419 1.14.419 2.205v2.232c0 1.065-.108 1.623-.419 2.205-.289.54-.72.971-1.26 1.26-.582.311-1.14.419-2.205.419H6.884c-1.065 0-1.623-.108-2.205-.419-.54-.289-.971-.72-1.26-1.26C3.108 22.739 3 22.18 3 21.116v-2.232c0-1.065.108-1.623.419-2.205.289-.54.72-.971 1.26-1.26.582-.311 1.14-.419 2.205-.419h2.232Zm12 0c1.065 0 1.623.108 2.205.419.54.289.971.72 1.26 1.26.311.582.419 1.14.419 2.205v2.232c0 1.065-.108 1.623-.419 2.205-.289.54-.72.971-1.26 1.26-.582.311-1.14.419-2.205.419h-2.232c-1.065 0-1.623-.108-2.205-.419-.54-.289-.971-.72-1.26-1.26-.311-.582-.419-1.14-.419-2.205v-2.232c0-1.065.108-1.623.419-2.205.289-.54.72-.971 1.26-1.26.582-.311 1.14-.419 2.205-.419h2.232Zm-12 2H6.884c-.763 0-1.01.048-1.261.182a1.045 1.045 0 0 0-.44.44c-.135.253-.183.499-.183 1.262v2.232c0 .763.048 1.01.182 1.261.103.193.248.338.44.44.253.135.499.183 1.262.183h2.232c.763 0 1.01-.048 1.261-.182.193-.103.338-.248.44-.44.135-.253.183-.499.183-1.262v-2.232c0-.763-.048-1.01-.182-1.261a1.045 1.045 0 0 0-.44-.44c-.253-.135-.499-.183-1.262-.183Zm12 0h-2.232c-.763 0-1.01.048-1.261.182a1.045 1.045 0 0 0-.44.44c-.135.253-.183.499-.183 1.262v2.232c0 .763.048 1.01.182 1.261.103.193.248.338.44.44.253.135.499.183 1.262.183h2.232c.763 0 1.01-.048 1.261-.182.193-.103.338-.248.44-.44.135-.253.183-.499.183-1.262v-2.232c0-.763-.048-1.01-.182-1.261a1.045 1.045 0 0 0-.44-.44c-.253-.135-.499-.183-1.262-.183ZM20.89 2.413c.631.19 1.102.51 1.856 1.263l1.577 1.577c.754.754 1.072 1.225 1.263 1.856a3.044 3.044 0 0 1 0 1.782c-.19.631-.51 1.102-1.263 1.856l-1.577 1.577c-.754.754-1.225 1.072-1.856 1.263a3.044 3.044 0 0 1-1.782 0c-.631-.19-1.102-.51-1.856-1.263l-1.577-1.577c-.754-.754-1.072-1.225-1.263-1.856a3.044 3.044 0 0 1 0-1.782c.19-.631.51-1.102 1.263-1.856l1.577-1.577c.754-.754 1.225-1.072 1.856-1.263a3.044 3.044 0 0 1 1.782 0ZM9.116 3c1.065 0 1.623.108 2.205.419.54.289.971.72 1.26 1.26.311.582.419 1.14.419 2.205v2.232c0 1.065-.108 1.623-.419 2.205-.289.54-.72.971-1.26 1.26-.582.311-1.14.419-2.205.419H6.884c-1.065 0-1.623-.108-2.205-.419-.54-.289-.971-.72-1.26-1.26C3.108 10.739 3 10.18 3 9.116V6.884c0-1.065.108-1.623.419-2.205.289-.54.72-.971 1.26-1.26C5.261 3.108 5.82 3 6.884 3h2.232Zm10.573 1.327c-.274.082-.482.223-1.021.763L17.09 6.668c-.54.54-.68.747-.763 1.02a1.045 1.045 0 0 0 0 .623c.082.274.223.482.763 1.021l1.578 1.578c.54.54.747.68 1.02.763.21.064.415.064.623 0 .274-.082.482-.223 1.021-.763l1.578-1.578c.54-.54.68-.747.763-1.02a1.045 1.045 0 0 0 0-.623c-.082-.274-.223-.482-.763-1.021L21.332 5.09c-.54-.54-.747-.68-1.02-.763a1.045 1.045 0 0 0-.623 0ZM9.116 5H6.884c-.763 0-1.01.048-1.261.182a1.045 1.045 0 0 0-.44.44C5.047 5.876 5 6.122 5 6.885v2.232c0 .763.048 1.01.182 1.261.103.193.248.338.44.44.253.135.499.183 1.262.183h2.232c.763 0 1.01-.048 1.261-.182.193-.103.338-.248.44-.44.135-.253.183-.499.183-1.262V6.884c0-.763-.048-1.01-.182-1.261a1.045 1.045 0 0 0-.44-.44C10.124 5.047 9.878 5 9.115 5Z" /></g></symbol>',28,28,!1,void 0)},816271:(e,t,i)=>{i.d(t,{Icon56CompassOutline:()=>s});var s=(0,i(825028).makeIcon)("Icon56CompassOutline","compass_outline_56","0 0 56 56",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 56 56" id="compass_outline_56"><g fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"><path d="M36.92 21.207c.406-1.307-.82-2.533-2.127-2.127l-11.036 3.425a1.9 1.9 0 0 0-1.252 1.252L19.08 34.791c-.406 1.307.82 2.534 2.128 2.128l11.036-3.425a1.9 1.9 0 0 0 1.251-1.252zM25.199 25.2l8.124-2.522-2.522 8.124-8.124 2.522z" /><path d="M52 28c0 13.255-10.745 24-24 24S4 41.255 4 28 14.745 4 28 4s24 10.745 24 24zm-3 0c0 11.598-9.402 21-21 21S7 39.598 7 28 16.402 7 28 7s21 9.402 21 21z" /></g></symbol>',56,56,!1,void 0)},58255:(e,t,i)=>{i.d(t,{default:()=>o});var s=i(111132);function o(e,t){e.classList?e.classList.add(t):(0,s.default)(e,t)||("string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t))}},111132:(e,t,i)=>{function s(e,t){return e.classList?!!t&&e.classList.contains(t):-1!==(" "+(e.className.baseVal||e.className)+" ").indexOf(" "+t+" ")}i.d(t,{default:()=>s})},374277:(e,t,i)=>{function s(e,t){return e.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,"")}function o(e,t){e.classList?e.classList.remove(t):"string"==typeof e.className?e.className=s(e.className,t):e.setAttribute("class",s(e.className&&e.className.baseVal||"",t))}i.d(t,{default:()=>o})},891047:(e,t,i)=>{function s(e){return new Promise(((t,i)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>i(e.error)}))}function o(e,t){const i=indexedDB.open(e);i.onupgradeneeded=()=>i.result.createObjectStore(t);const o=s(i);return(e,i)=>o.then((s=>i(s.transaction(t,e).objectStore(t))))}let r;function n(){return r||(r=o("keyval-store","keyval")),r}function a(e,t=n()){return t("readonly",(t=>s(t.get(e))))}function l(e,t,i=n()){return i("readwrite",(i=>(i.put(t,e),s(i.transaction))))}function d(e,t,i=n()){return i("readwrite",(i=>new Promise(((o,r)=>{i.get(e).onsuccess=function(){try{i.put(t(this.result),e),o(s(i.transaction))}catch(e){r(e)}}}))))}function c(e,t=n()){return t("readwrite",(t=>(t.delete(e),s(t.transaction))))}function _(e=n()){return e("readwrite",(e=>(e.clear(),s(e.transaction))))}i.d(t,{clear:()=>_,createStore:()=>o,del:()=>c,get:()=>a,set:()=>l,update:()=>d})},961783:(e,t,i)=>{i.d(t,{default:()=>s});const s={wrapper:"PinnedMessage-module__wrapper--D7CDk",container:"PinnedMessage-module__container--FwKqh",comment:"PinnedMessage-module__comment--qfvL_",pinIcon:"PinnedMessage-module__pinIcon--RLEnF",author:"PinnedMessage-module__author--pAhIg",authorWithBackground:"PinnedMessage-module__authorWithBackground--OBIz9",authorWithoutMargin:"PinnedMessage-module__authorWithoutMargin--QEqUg",moreAction:"PinnedMessage-module__moreAction--rxW0h"}},429697:(e,t,i)=>{i.d(t,{default:()=>u});var s=i(487462),o=i(263366),r=i(894578),n=i(58255),a=i(374277),l=i(667294),d=i(696630),c=i(559391),_=function(e,t){return e&&t&&t.split(" ").forEach((function(t){return(0,a.default)(e,t)}))},h=function(e){function t(){for(var t,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(t=e.call.apply(e,[this].concat(s))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,i){var s=t.resolveArguments(e,i),o=s[0],r=s[1];t.removeClasses(o,"exit"),t.addClass(o,r?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,i)},t.onEntering=function(e,i){var s=t.resolveArguments(e,i),o=s[0],r=s[1]?"appear":"enter";t.addClass(o,r,"active"),t.props.onEntering&&t.props.onEntering(e,i)},t.onEntered=function(e,i){var s=t.resolveArguments(e,i),o=s[0],r=s[1]?"appear":"enter";t.removeClasses(o,r),t.addClass(o,r,"done"),t.props.onEntered&&t.props.onEntered(e,i)},t.onExit=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"appear"),t.removeClasses(i,"enter"),t.addClass(i,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var i=t.resolveArguments(e)[0];t.addClass(i,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var i=t.resolveArguments(e)[0];t.removeClasses(i,"exit"),t.addClass(i,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,i){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,i]},t.getClassNames=function(e){var i=t.props.classNames,s="string"==typeof i,o=s?""+(s&&i?i+"-":"")+e:i[e];return{baseClassName:o,activeClassName:s?o+"-active":i[e+"Active"],doneClassName:s?o+"-done":i[e+"Done"]}},t}(0,r.default)(t,e);var i=t.prototype;return i.addClass=function(e,t,i){var s=this.getClassNames(t)[i+"ClassName"],o=this.getClassNames("enter").doneClassName;"appear"===t&&"done"===i&&o&&(s+=" "+o),"active"===i&&e&&(0,c.forceReflow)(e),s&&(this.appliedClasses[t][i]=s,function(e,t){e&&t&&t.split(" ").forEach((function(t){return(0,n.default)(e,t)}))}(e,s))},i.removeClasses=function(e,t){var i=this.appliedClasses[t],s=i.base,o=i.active,r=i.done;this.appliedClasses[t]={},s&&_(e,s),o&&_(e,o),r&&_(e,r)},i.render=function(){var e=this.props,t=(e.classNames,(0,o.default)(e,["classNames"]));return l.createElement(d.default,(0,s.default)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(l.Component);h.defaultProps={classNames:""},h.propTypes={};const u=h},696630:(e,t,i)=>{i.d(t,{default:()=>v});var s=i(263366),o=i(894578),r=i(667294),n=i(973935),a=i(806035),l=i(500220),d=i(559391),c="unmounted",_="exited",h="entering",u="entered",p="exiting",m=function(e){function t(t,i){var s;s=e.call(this,t,i)||this;var o,r=i&&!i.isMounting?t.enter:t.appear;return s.appearStatus=null,t.in?r?(o=_,s.appearStatus=h):o=u:o=t.unmountOnExit||t.mountOnEnter?c:_,s.state={status:o},s.nextCallback=null,s}(0,o.default)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===c?{status:_}:null};var i=t.prototype;return i.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},i.componentDidUpdate=function(e){var t=null;if(e!==this.props){var i=this.state.status;this.props.in?i!==h&&i!==u&&(t=h):i!==h&&i!==u||(t=p)}this.updateStatus(!1,t)},i.componentWillUnmount=function(){this.cancelNextCallback()},i.getTimeouts=function(){var e,t,i,s=this.props.timeout;return e=t=i=s,null!=s&&"number"!=typeof s&&(e=s.exit,t=s.enter,i=void 0!==s.appear?s.appear:t),{exit:e,enter:t,appear:i}},i.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t)if(this.cancelNextCallback(),t===h){if(this.props.unmountOnExit||this.props.mountOnEnter){var i=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this);i&&(0,d.forceReflow)(i)}this.performEnter(e)}else this.performExit();else this.props.unmountOnExit&&this.state.status===_&&this.setState({status:c})},i.performEnter=function(e){var t=this,i=this.props.enter,s=this.context?this.context.isMounting:e,o=this.props.nodeRef?[s]:[n.findDOMNode(this),s],r=o[0],l=o[1],d=this.getTimeouts(),c=s?d.appear:d.enter;!e&&!i||a.default.disabled?this.safeSetState({status:u},(function(){t.props.onEntered(r)})):(this.props.onEnter(r,l),this.safeSetState({status:h},(function(){t.props.onEntering(r,l),t.onTransitionEnd(c,(function(){t.safeSetState({status:u},(function(){t.props.onEntered(r,l)}))}))})))},i.performExit=function(){var e=this,t=this.props.exit,i=this.getTimeouts(),s=this.props.nodeRef?void 0:n.findDOMNode(this);t&&!a.default.disabled?(this.props.onExit(s),this.safeSetState({status:p},(function(){e.props.onExiting(s),e.onTransitionEnd(i.exit,(function(){e.safeSetState({status:_},(function(){e.props.onExited(s)}))}))}))):this.safeSetState({status:_},(function(){e.props.onExited(s)}))},i.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},i.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},i.setNextCallback=function(e){var t=this,i=!0;return this.nextCallback=function(s){i&&(i=!1,t.nextCallback=null,e(s))},this.nextCallback.cancel=function(){i=!1},this.nextCallback},i.onTransitionEnd=function(e,t){this.setNextCallback(t);var i=this.props.nodeRef?this.props.nodeRef.current:n.findDOMNode(this),s=null==e&&!this.props.addEndListener;if(i&&!s){if(this.props.addEndListener){var o=this.props.nodeRef?[this.nextCallback]:[i,this.nextCallback],r=o[0],a=o[1];this.props.addEndListener(r,a)}null!=e&&setTimeout(this.nextCallback,e)}else setTimeout(this.nextCallback,0)},i.render=function(){var e=this.state.status;if(e===c)return null;var t=this.props,i=t.children,o=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,s.default)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return r.createElement(l.default.Provider,{value:null},"function"==typeof i?i(e,o):r.cloneElement(r.Children.only(i),o))},t}(r.Component);function g(){}m.contextType=l.default,m.propTypes={},m.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:g,onEntering:g,onEntered:g,onExit:g,onExiting:g,onExited:g},m.UNMOUNTED=c,m.EXITED=_,m.ENTERING=h,m.ENTERED=u,m.EXITING=p;const v=m},500220:(e,t,i)=>{i.d(t,{default:()=>s});const s=i(667294).createContext(null)},806035:(e,t,i)=>{i.d(t,{default:()=>s});const s={disabled:!1}},559391:(e,t,i)=>{i.d(t,{forceReflow:()=>s});var s=function(e){return e.scrollTop}},892547:(e,t,i)=>{i.d(t,{ABUSE_MODULE:()=>n,GROUP_INFO_MODULE:()=>o,SPAMFEED_MODULE:()=>r,USER_INFO_MODULE:()=>s});const s="user_personal_card",o="group_personal_card",r="sf",n="abuse"},13112:(e,t,i)=>{i.d(t,{isEnvConfigEnabled:()=>o});var s=i(839470);function o(e){return(0,s.partConfigEnabled)(e)}},300886:(e,t,i)=>{i.d(t,{isUserAuthorized:()=>o});var s=i(931917);function o(){var e;const t=(null==window||null==(e=window.vk)?void 0:e.id)||0;return!s.Ranges.isZeroOwner(t)}},172721:(e,t,i)=>{i.d(t,{apiFaveAddNarrative:()=>o,apiFaveRemoveNarrative:()=>r});var s=i(599809);function o(e){return(0,s.api)("fave.addNarrative",e)}function r(e){return(0,s.api)("fave.removeNarrative",e)}},65856:(e,t,i)=>{i.d(t,{createFaveService:()=>s.createFaveService});i(172721);var s=i(34570)},34570:(e,t,i)=>{i.d(t,{createFaveService:()=>r});var s=i(210929),o=i(172721);const r=({domain:e})=>{const t=e.createEvent("fire/faveAddNarrative"),i=e.createEvent("fire/faveRemoveNarrative"),r=e.createEffect("fx/faveAddNarrative"),n=e.createEffect("fx/faveRemoveNarrative");return r.use(o.apiFaveAddNarrative),n.use(o.apiFaveRemoveNarrative),(0,s.sample)({clock:t,target:r}),(0,s.sample)({clock:i,target:n}),{fireAddNarrative:t,fireRemoveNarrative:i,addNarrativeFx:r,removeNarrativeFx:n}}},137363:(e,t,i)=>{i.d(t,{ANALYTICS_SCREEN_OTHER:()=>r,ANALYTICS_SCREEN_SETTINGS:()=>o,GroupAdminLevel:()=>s});const s={USER:0,MODERATOR:1,EDITOR:2,ADMINISTRATOR:3,HOST:4,EVENT_CREATOR:5,CREATOR:6,PSEUDO_LEVEL_ADVERTISER:100},o="settings",r="other"},230059:(e,t,i)=>{i.d(t,{drawRoundedImage:()=>o,getCoverSize:()=>n,getCroppedImage:()=>a,getZeroFrameFromGif:()=>l,roundRect:()=>r});var s=i(404145);const o=(e,t,i,s,o,r,n,a,l,d,c)=>{const _=a||s,h=l||o,u=d||r||t.naturalWidth,p=c||n||t.naturalHeight;e.beginPath(),e.arc(_+i,h+i,i,Math.PI,Math.PI+Math.PI/2),e.lineTo(_+u-i,h),e.arc(_+u-i,h+i,i,Math.PI+Math.PI/2,2*Math.PI),e.lineTo(_+u,h+p-i),e.arc(_+u-i,h+p-i,i,2*Math.PI,Math.PI/2),e.lineTo(_+i,h+p),e.arc(_+i,h+p-i,i,Math.PI/2,Math.PI),e.closePath(),e.save(),e.clip(),e.drawImage(t,s,o,r,n,a,l,d,c),e.restore()},r=(e,t,i,s,o,r)=>{let n={};if("number"==typeof r)n={tl:r,tr:r,br:r,bl:r};else{const e={tl:0,tr:0,br:0,bl:0};for(let t in e)n[t]=n[t]||e[t]}e.save(),e.beginPath(),e.moveTo(t+n.tl,i),e.lineTo(t+s-n.tr,i),e.quadraticCurveTo(t+s,i,t+s,i+n.tr),e.lineTo(t+s,i+o-n.br),e.quadraticCurveTo(t+s,i+o,t+s-n.br,i+o),e.lineTo(t+n.bl,i+o),e.quadraticCurveTo(t,i+o,t,i+o-n.bl),e.lineTo(t,i+n.tl),e.quadraticCurveTo(t,i,t+n.tl,i),e.closePath(),e.restore()},n=(e,t,i,s,o,r)=>{const n=e/t;let a,l;return n>i/s?(a=s,l=s*n):(l=i,a=i/n),{width:l,height:a,offsetLeft:(i-l)*(o=void 0===o?.5:o),offsetTop:(s-a)*(r=void 0===r?.5:r)}};function a(e,t,i,o,r,n=0){return new Promise(((a,l)=>{("string"==typeof e?(0,s.loadImage)(e):Promise.resolve(e)).then((e=>{const d=document.createElement("canvas");d.width=90===n||270===n?e.naturalHeight:e.naturalWidth,d.height=90===n||270===n?e.naturalWidth:e.naturalHeight;const c=d.getContext("2d");if(!c)return void a(e);c.fillStyle="#fff",c.fillRect(0,0,c.canvas.width,c.canvas.height),n?(c.translate(d.width/2,d.height/2),c.rotate(n*Math.PI/180),c.drawImage(e,-e.naturalWidth/2,-e.naturalHeight/2)):c.drawImage(e,0,0);const _=c.getImageData(t,i,o,r),h=document.createElement("canvas");h.width=o,h.height=r;const u=h.getContext("2d");if(u)return u.putImageData(_,0,0),(0,s.loadImage)(h.toDataURL("image/jpeg",1)).then(a).catch(l);a(e)})).catch(l)}))}const l=(e,t,i)=>new Promise((o=>{"image/gif"!==e.type&&o({file:e,image:t,imageUrl:i});let r=document.createElement("canvas"),n=r.getContext("2d");if(!n)return o({file:e,image:t,imageUrl:i});r.width=t.width,r.height=t.height,n.drawImage(t,0,0),r.toBlob((r=>{if(null===r)return void o({file:e,image:t,imageUrl:i});const n=URL.createObjectURL(r);(0,s.loadImage)(i).then((e=>{o({file:r,image:e,imageUrl:n})})).catch((s=>{console.log(s),o({file:e,image:t,imageUrl:i})}))}))}))},650969:(e,t,i)=>{i.d(t,{swapObject:()=>s});const s=e=>{const t={};return Object.keys(e).forEach((i=>{t[e[i]]=i})),t}},517366:(e,t,i)=>{var s,o,r,n,a;i.d(t,{StoryBlockType:()=>n,StoryEntryPoint:()=>o,StoryListName:()=>a,StorySource:()=>r,StoryType:()=>s}),function(e){e.PHOTO="photo",e.VIDEO="video",e.LIVE="live"}(s||(s={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(o||(o={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar",e.MY_QUESTIONS="question_story"}(r||(r={})),function(e){e.stories="stories",e.communityGroupedStories="community_grouped_stories",e.appGroupedStories="app_grouped_stories",e.discover="discover"}(n||(n={})),function(e){e.feed="feed",e.groups="groups",e.apps="apps",e.discover="discover"}(a||(a={}))},389920:(e,t,i)=>{i.d(t,{apiLikesAdd:()=>o,apiLikesDelete:()=>r});var s=i(599809);function o(e){return(0,s.api)("likes.add",e)}function r(e){return(0,s.api)("likes.delete",e)}},274857:(e,t,i)=>{var s;!function(e){e.Story="story"}(s||(s={}))},655555:(e,t,i)=>{i.d(t,{createLikesService:()=>s.createLikesService});var s=i(202269);i(389920),i(274857)},202269:(e,t,i)=>{i.d(t,{createLikesService:()=>r});var s=i(210929),o=i(389920);const r=({domain:e})=>{const t=e.createEvent("fire/likesAdd"),i=e.createEvent("fire/likesDelete"),r=e.createEffect("fx/likesAdd"),n=e.createEffect("fx/likesDelete");return r.use(o.apiLikesAdd),n.use(o.apiLikesDelete),(0,s.sample)({clock:t,target:r}),(0,s.sample)({clock:i,target:n}),{fireAdd:t,fireDelete:i,addFx:r,deleteFx:n}}},543384:(e,t,i)=>{i.d(t,{apiMessagesSend:()=>o});var s=i(599809);function o(e){return(0,s.api)("messages.send",e)}},105338:(e,t,i)=>{i.d(t,{createMessagesService:()=>s.createMessagesService});i(543384);var s=i(429128)},429128:(e,t,i)=>{i.d(t,{createMessagesService:()=>r});var s=i(210929),o=i(543384);const r=({domain:e})=>{const t=e.createEvent("fire/messageSend"),i=e.createEffect("fx/messageSend");return i.use(o.apiMessagesSend),(0,s.sample)({clock:t,target:i}),{fireMessagesSend:t,sendFx:i}}},494810:(e,t,i)=>{i.d(t,{apiNarrativesBatchEdit:()=>n,apiNarrativesCreate:()=>o,apiNarrativesDelete:()=>a,apiNarrativesEdit:()=>r,apiNarrativesReorder:()=>d,apiNarrativesSaveCustomCover:()=>l});var s=i(599809);function o(e){return(0,s.api)("narratives.create",e)}function r(e){return(0,s.api)("narratives.edit",e)}function n(e){return(0,s.api)("narratives.batchEdit",e)}function a(e){return(0,s.api)("narratives.delete",e)}function l(e){return(0,s.api)("narratives.saveCustomCover",e)}function d(e){return(0,s.api)("narratives.reorder",e)}},683313:(e,t,i)=>{i.d(t,{createNarrativesService:()=>s.createNarrativesService});var s=i(382983);i(494810)},382983:(e,t,i)=>{i.d(t,{createNarrativesService:()=>r});var s=i(210929),o=i(494810);const r=({domain:e})=>{const t=e.createEvent("fire/narrativesCreate"),i=e.createEvent("fire/narrativesEdit"),r=e.createEvent("fire/narrativesBatchEdit"),n=e.createEvent("fire/narrativesDelete"),a=e.createEvent("fire/narrativesSaveCustomCover"),l=e.createEvent("fire/narrativesReorder"),d=e.createEffect("fx/narrativesCreate"),c=e.createEffect("fx/narrativesEdit"),_=e.createEffect("fx/narrativesBatchEdit"),h=e.createEffect("fx/narrativesDelete"),u=e.createEffect("fx/narrativesSaveCustomCover"),p=e.createEffect("fx/narrativesReorder");return d.use(o.apiNarrativesCreate),c.use(o.apiNarrativesEdit),_.use(o.apiNarrativesBatchEdit),h.use(o.apiNarrativesDelete),u.use(o.apiNarrativesSaveCustomCover),p.use(o.apiNarrativesReorder),(0,s.sample)({clock:t,target:d}),(0,s.sample)({clock:i,target:c}),(0,s.sample)({clock:r,target:_}),(0,s.sample)({clock:n,target:h}),(0,s.sample)({clock:a,target:u}),(0,s.sample)({clock:l,target:p}),{fireCreate:t,fireEdit:i,fireBatchEdit:r,fireDelete:n,fireSaveCustomCover:a,fireReorder:l,createFx:d,editFx:c,batchEditFx:_,deleteFx:h,saveCustomCoverFx:u,reorderFx:p}}},630330:(e,t,i)=>{i.d(t,{apiPollsCreate:()=>r,apiPollsGetById:()=>o});var s=i(599809);function o(e){return(0,s.api)("polls.getById",e)}function r(e){return(0,s.api)("polls.create",e)}},527487:(e,t,i)=>{i.d(t,{createPollsService:()=>s.createPollsService});i(630330);var s=i(892883)},892883:(e,t,i)=>{i.d(t,{createPollsService:()=>r});var s=i(210929),o=i(630330);const r=({domain:e})=>{const t=e.createEvent("fire/pollsGetById"),i=e.createEvent("fire/pollsCreate"),r=e.createEffect("fx/pollsGetById"),n=e.createEffect("fx/pollsCreate");return r.use(o.apiPollsGetById),n.use(o.apiPollsCreate),(0,s.sample)({clock:t,target:r}),(0,s.sample)({clock:i,target:n}),{fireGetById:t,fireCreate:i,getByIdFx:r,createFx:n}}},362641:(e,t,i)=>{i.d(t,{getEnabledMvkTabs:()=>u,getEnabledWebTabs:()=>_,getMainDataLoadParams:()=>a,getOwnerContentTabsDataRequestParams:()=>d,getSupportedMvkTabs:()=>h,getSupportedWebTabs:()=>c,getViewerDataLoadParams:()=>l,makeUserFields:()=>r});var s=i(13112),o=i(300886);function r(e){return e.join(",")}const n=r(["is_sber_verified","is_tinkoff_verified","is_esia_verified","can_ban","can_see_gifts","followers_count","no_index","about","activities","activity","bdate","no_index","blacklisted","blacklisted_by_me","books","buttons","can_call","can_invite_to_chats","can_post","can_see_all_posts","can_see_wishes","can_send_friend_request","can_subscribe_stories","can_write_private_message","career","city","connections","counters","country","emoji_status","first_name_acc","first_name_dat","first_name_gen","first_name_ins","friend_status","games","gifts_tooltip","has_photo","home_town","image_status","interests","is_dead","is_favorite","is_hidden_from_feed","is_subscribed","is_subscribed_stories","last_name_acc","last_name_dat","last_name_gen","last_name_ins","last_seen","military","movies","music","mutual","occupation","online","online_info","owner_state","personal","quotes","relation","relatives","schools","screen_name","domain","sex","site","status","trending","tv","universities","verified","video_live","wall_default","bdate_visibility","contacts","photo_max","photo_medium_rec","photo_rec","can_ask_question","can_subscribe_posts","cover","first_name_nom","lists","maiden_name","nickname","photo_200","photo_400","photo_avg_color","photo_id","photo_max_size","profile_buttons","stories_archive_count","third_party_buttons","service_description","is_best_friend","is_nft","is_followers_mode_on"]);function a(e,t,i){const s=e===t,o={"photos.get":{owner_id:e,album_id:"profile",rev:1,count:1},"users.getSubscriptions":{fields:r(["photo_200","photo_100","description","status","is_nft"]),count:5,extended:1,user_id:e},"users.getFollowers":{fields:r(["photo_200","photo_100","photo_50","is_friend","sex"]),count:s?8:3,user_id:e},"gifts.get":{user_id:e,count:6}};return t&&(i.withoutFriends||(o["friends.get"]={user_id:e,count:12,fields:r(["domain","photo_100","photo_200","online","is_nft"]),order:"hints"}),o["stories.get"]={owner_id:e},o["account.getHelpHints"]={}),s&&(o["friends.getRequests"]={need_count:1,count:3,need_viewed:0,fields:r(["photo_100","photo_200","sex"]),extended:1},i.withOnlineFriends&&(o["friends.getOnline"]={user_id:e,count:8,order:"hints"}),o["account.getPrivacySettings"]={privacy_keys:"friends_requests,audios,stories,gifts",need_default:0},o["account.getSilentModeStatus"]={}),i.withoutUser||(o["users.get"]={user_ids:e.toString(),fields:n}),o}function l(e){return{user_ids:String(e),fields:r(["is_followers_mode_on","social_button_type"])}}function d(e,t,i={}){const s={};return t.forEach((t=>{switch(t){case"photos":i.isPhotoFeedEnabled?s["photos.photoFeedGet"]={owner_id:e,extended:1,photo_sizes:1,count:6}:s["photos.getAll"]={owner_id:e,photo_sizes:1,extended:1,skip_hidden:1};break;case"videos":s["video.get"]={owner_id:e,need_privacy:1,count:9};break;case"music":s["audio.get"]={owner_id:e,photo_sizes:1,count:8},s["audio.getPlaylists"]={owner_id:e,photo_sizes:1,count:9};break;case"short_videos":s["shortVideo.getOwnerVideos"]={owner_id:e,count:9};break;case"articles":s["articles.getOwnerPublished"]={owner_id:e,count:3};break;case"narratives":s["narratives.getFromOwner"]={owner_id:e,limit:9};break;case"nfts":s["nft.getCollection"]={owner_id:e};break;case"albums":s["photos.getAlbums"]={owner_id:e,count:9,need_system:1,need_covers:1,photo_sizes:1}}})),s}function c(){const e=(0,o.isUserAuthorized)(),t=e?["photos","short_videos","videos","music","articles","narratives","nfts"]:["short_videos"];return(0,s.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}function _(){const e=(0,o.isUserAuthorized)(),t=e?["photos","short_videos","music","articles","nfts"]:["short_videos"];return(0,s.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}function h(){const e=(0,o.isUserAuthorized)(),t=e?["photos","short_videos","videos","music","narratives","articles","nfts"]:["short_videos"];return(0,s.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}function u(){const e=(0,o.isUserAuthorized)(),t=e?["photos","short_videos","videos","music","narratives","articles","nfts"]:["short_videos"];return(0,s.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}},59985:(e,t,i)=>{i.d(t,{HIDE_TOOLTIP_TIMEOUT:()=>s,OPENED_REACTED_USERS_DEFAULT_REACTION_ID:()=>c,REACTION_ID_DEFAULT:()=>r,REACTION_ID_MAX:()=>n,REACTION_ID_MIN:()=>a,REACTION_ID_UNSET:()=>l,REACTION_SET_ITEMS_MIN_COUNT:()=>d,SHOW_TOOLTIP_TIMEOUT:()=>o});const s=600,o=140,r=0,n=7,a=0,l=void 0,d=2,c=r},457972:(e,t,i)=>{i.d(t,{isDebugEnabled:()=>r});var s=i(531730);let o;const r=()=>(void 0!==o||(o=!!s.ls.get("reactions.debug_enabled")),o)},192441:(e,t,i)=>{i.d(t,{reactionCountsBrandUnwrap:()=>o,reactionCountsBrandWrap:()=>r});var s=i(640971);const o=e=>(0,s.unwrap)(e),r=e=>(0,s.wrap)(e)},698216:(e,t,i)=>{i.d(t,{reactionLogError:()=>r});var s=i(970978);const o="reactions";function r({error:e,reportError:t=!1}){t&&(0,s.logError)(e,{environment:o}),console.error(e)}},822715:(e,t,i)=>{i.d(t,{areCountersEqual:()=>C,calcCounters:()=>S,calcCountersSum:()=>f,calcCountersWeightedSum:()=>E,counterForReactionId:()=>T,getDefaultReaction:()=>d,getDefaultReactionTitle:()=>c,getReaction:()=>l,hasReactionsForCounts:()=>b,isReactionIdSet:()=>u,isReactionIdUnset:()=>p,isUnknownObject:()=>a,isValidReactionId:()=>m,parseReactionId:()=>g,parseReactionIdOrUnset:()=>v,parseReactionMenuConfig:()=>w,prepareReactionMenuSet:()=>h,validateReactionSetPayloaditems:()=>y});var s=i(59985),o=i(192441),r=i(659397);const n=Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e),a=e=>null!==e&&"object"==typeof e,l=(e,t)=>e.itemsById[t],d=e=>l(e,s.REACTION_ID_DEFAULT),c=e=>{var t;return null==(t=d(e))?void 0:t.title},_=(e,t)=>0===e.length?"":((e,t,i=!0)=>e.reduce(((e,s)=>{const o=t(s),r=t(e);return r===o?i?e:s:r<o?e:s})))(e,(e=>Math.pow(t.width-e.width,2)+Math.pow(t.height-e.height,2)),!1).url,h=(e,t,i)=>{const s=t.map((({asset:e,color_sets:t,id:s,score:o,title:r})=>({animationURL:e.animation_url||void 0,backgroundColor:null==t?void 0:t.background,id:s,imageMenuURL:_(e.images,i.imageMenuSize),imagePreviewURL:"imagePreviewSize"in i?_(e.images,i.imagePreviewSize):void 0,imageStoryPanelURL:"imageStoryPanelSize"in i?_(e.images,i.imageStoryPanelSize):void 0,imageStoryPreviewURL:"imageStoryPreviewSize"in i?_(e.images,i.imageStoryPreviewSize):void 0,score:o,title:r,titleColor:null==t?void 0:t.foreground}))),o={};return s.forEach((e=>{o[e.id]=e})),{id:e,items:s,itemsById:o}},u=e=>e!==s.REACTION_ID_UNSET,p=e=>e===s.REACTION_ID_UNSET,m=e=>n(e)&&e>=s.REACTION_ID_MIN&&e<=s.REACTION_ID_MAX,g=e=>{const t=parseInt(e,10);return m(t)?{isValid:!0,value:t}:{isValid:!1}},v=e=>{const t=g(e);return t.isValid?t.value:s.REACTION_ID_UNSET},y=(e,t)=>{if(e.length<s.REACTION_SET_ITEMS_MIN_COUNT)return{error:new Error(`Invalid reactions items count in set '${t}': ${e.length}`)}},w=e=>{if(!a(e))return;const t={},{animationShowStaticAfterEnd:i,menuShowDelay:o,openedDefaultReactionId:r,reportJsErrors:n}=e;return"number"!=typeof o&&void 0!==o||(t.menuShowDelay=o),"boolean"==typeof i&&(t.animationShowStaticAfterEnd=i),"boolean"==typeof n&&(t.reportJsErrors=n),"number"==typeof r||null===r?null===r?t.openedDefaultReactionId=void 0:m(r)&&(t.openedDefaultReactionId=r):t.openedDefaultReactionId=s.OPENED_REACTED_USERS_DEFAULT_REACTION_ID,t},S=(e,t)=>{const i=(0,o.reactionCountsBrandWrap)({});return Object.entries((0,o.reactionCountsBrandUnwrap)(e)).forEach((([e,s])=>{var o,r;const n=e;var a;const l=null!=(a=null==t||null==(o=t.itemsById)||null==(r=o[n])?void 0:r.score)?a:1;i[n]=l*(s||0)})),i},f=e=>Object.values((0,o.reactionCountsBrandUnwrap)(e)).reduce(((e,t)=>e+(t||0)),0),E=e=>f((0,o.reactionCountsBrandWrap)(e)),b=e=>f(e)>0;var k;const T=(e,t)=>null!=(k=e[t])?k:void 0,C=(e,t)=>e&&t?(0,r.isEqual)(e,t):e===t},640971:(e,t,i)=>{i.d(t,{unwrap:()=>s,wrap:()=>o});const s=e=>e,o=e=>e},852063:(e,t,i)=>{i.d(t,{apiStatsTrackEvents:()=>o});var s=i(599809);function o(e){return(0,s.api)("stats.trackEvents",e)}},168298:(e,t,i)=>{i.d(t,{STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION:()=>s,STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME:()=>o,STATS_EVENT_TYPE_VIDEO_ONBOARDING:()=>r});const s="stories_viewer_navigation",o="stories_viewing_start_time",r="video_onboarding"},697227:(e,t,i)=>{i.d(t,{STATS_EVENT_TYPE_VIDEO_ONBOARDING:()=>s.STATS_EVENT_TYPE_VIDEO_ONBOARDING,apiStatsTrackEvents:()=>o.apiStatsTrackEvents,createStatsService:()=>r.createStatsService});var s=i(168298),o=i(852063),r=i(513234)},513234:(e,t,i)=>{i.d(t,{createStatsService:()=>r});var s=i(210929),o=i(852063);const r=({domain:e})=>{const t=e.createEvent("fire/statsTrackEvents"),i=e.createEffect("fx/statsTrackEvents");return i.use(o.apiStatsTrackEvents),(0,s.sample)({clock:t,target:i}),{fireTrackEvents:t,trackEventsFx:i}}},874162:(e,t,i)=>{i.d(t,{DEFAULT_CACHE:()=>l,ORDER_ERRORS:()=>c,ORDER_ITEM_ERRORS:()=>_,SAMPLE_RECIPIENT_ID:()=>d,STICKER_ANIMATION:()=>a,STICKER_IMAGE:()=>n,STICKER_PACK_ICON:()=>o,STICKER_PACK_THUMB:()=>r});var s=i(899033);const o={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},r={"102_png":{id:"102.png",width:102,height:102,theme:s.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:s.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:s.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:s.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:s.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:s.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:s.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:s.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:s.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:s.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:s.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:s.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},n={"64_png":{id:"64.png",width:64,height:64,theme:s.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:s.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:s.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:s.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:s.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:s.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:s.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:s.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:s.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:s.Theme.DARK}},a={[s.Theme.LIGHT]:"animation.json",[s.Theme.DARK]:"animation.b.json"},l={products:(0,s.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},d=-1;var c,_;!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(c||(c={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(_||(_={}))},899033:(e,t,i)=>{var s;i.d(t,{ProductsByType:()=>h,Theme:()=>s,UserProductStateKey:()=>a,createProductsMap:()=>n,imageSizeCache:()=>r,imageSizesIndex:()=>o,isBasePack:()=>l,isPackProduct:()=>c,isStyleProduct:()=>d}),function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(s||(s={}));const o=Symbol(),r=Symbol(),n=e=>new Map(e);var a;!function(e){e.IsNew="is_new"}(a||(a={}));const l=e=>void 0!==e.sticker_ids,d=e=>void 0!==e.base_id,c=e=>l(e)&&!d(e);var _;!function(e){e.Pack="pack",e.Style="style"}(_||(_={}));class h{add(e){e&&(c(e)?this.pack.add(e):d(e)&&this.style.add(e))}getPack(){return this.pack.values().next().value}getStyles(){return Array.from(this.style.values())}getCount(){return this.pack.size+this.style.size}constructor(e=[]){this.pack=new Set,this.style=new Set,e.forEach((e=>this.add(e)))}}},396316:(e,t,i)=>{i.d(t,{STICKERS_CONFDATA_KEY:()=>s,isNewStickerPicker:()=>r,isUGCStickersEnabled:()=>n});var s,o=i(839470);function r(){return(0,o.partConfigEnabled)("new_sticker_picker")}function n(){return(0,o.partConfigEnabled)("stickers.ugc")}!function(e){e.UGC="stickers.ugc",e.NEW_STICKER_PICKER="new_sticker_picker",e.MVK_NEW_KEYBOARD="stickers_mvk_new_keyboard"}(s||(s={}))},457299:(e,t,i)=>{i.d(t,{getStickerAnimationUrl:()=>c,getStickerImageUrl:()=>d,getStickerPackIconUrl:()=>_,getStickersKitModule:()=>u,isSampleOrderItem:()=>h,logStickersError:()=>p});var s=i(899033),o=i(874162),r=i(970978);const n=(e,t,i,o=s.Theme.DEFAULT)=>{const r=window.devicePixelRatio,n=[t*=r,i*=r,o].toString();let a=e[s.imageSizeCache];if(a&&a.has(n)){const e=a.get(n);if(e)return e}a||(a=new Map,e[s.imageSizeCache]=a);const l=(e=>{let t=e[s.imageSizesIndex];return t||(t=Object.values(e).sort(((e,t)=>e.width-t.width||e.height-t.height)),e[s.imageSizesIndex]=t),t})(e).filter((e=>!e.theme||e.theme===o)),d=l.find((e=>e.width>=t&&e.height>=i))||l[l.length-1];return a.set(n,d),d},a=(e,t,i=s.Theme.DEFAULT)=>n(o.STICKER_IMAGE,e,t,i),l=(e,t)=>e.image.base_url+"/"+t.id+(e.image.version?`?${e.image.version}`:"");function d(e,t,i,o=s.Theme.DEFAULT){var r;if(null==(r=e.render)?void 0:r.images){const{images:s}=e.render;let r;s.sort(((e,t)=>e.width-t.width||e.height-t.height));for(const e of s)if(e.width>=t&&e.height>=i){if(e.theme===o)return e.url;r=e}if(r)return r.url}return l(e,a(t,i,o))}const c=(e,t=s.Theme.DEFAULT)=>e.animation?e.animation.base_url+"/"+o.STICKER_ANIMATION[t]+(e.animation.version?`?${e.animation.version}`:""):"",_=(e,t,i,r=s.Theme.DEFAULT)=>((e,t)=>e.icon.base_url+"/"+t.id+(e.thumb.version?`?${e.thumb.version}`:""))(e,((e,t,i=s.Theme.DEFAULT)=>n(o.STICKER_PACK_ICON,e,t,i))(t,i,r)),h=e=>e.recipient_id===o.SAMPLE_RECIPIENT_ID,u=()=>i.e(51162).then(i.bind(i,406857)),p=e=>{(0,r.logError)(new Error(`Stickers: ${e}`))}},911622:(e,t,i)=>{i.d(t,{apiStoriesAskQuestion:()=>g,apiStoriesBanQuestionAuthor:()=>y,apiStoriesDelete:()=>m,apiStoriesDeleteQuestion:()=>v,apiStoriesGet:()=>o,apiStoriesGetArchive:()=>r,apiStoriesGetDetailedStats:()=>c,apiStoriesGetPhotoUploadServer:()=>E,apiStoriesGetQuestions:()=>l,apiStoriesGetReplies:()=>a,apiStoriesGetStats:()=>d,apiStoriesGetVideoUploadServer:()=>b,apiStoriesGetViewers:()=>n,apiStoriesHidePrivacyBlock:()=>p,apiStoriesMarkAppNotificationsSeen:()=>S,apiStoriesMarkNotInterested:()=>h,apiStoriesMarkSeen:()=>u,apiStoriesMarkSkipped:()=>_,apiStoriesSave:()=>k,apiStoriesSubscribeUserToApp:()=>f,apiStoriesUnbanQuestionAuthor:()=>w});var s=i(599809);function o(e){return(0,s.api)("stories.get",e)}function r(e){return(0,s.api)("stories.getArchive",e)}function n(e){return(0,s.api)("stories.getViewers",e)}function a(e){return(0,s.api)("stories.getReplies",e)}function l(e){return(0,s.api)("stories.getQuestions",e)}function d(e){return(0,s.api)("stories.getStats",e)}function c(e){return(0,s.api)("stories.getDetailedStats",e)}function _(e){return(0,s.api)("stories.markSkipped",e)}function h(e){return(0,s.api)("stories.markNotInterested",e)}function u(e){return(0,s.api)("stories.markSeen",e)}function p(e){return(0,s.api)("stories.hidePrivacyBlock",e)}function m(e){return(0,s.api)("stories.delete",e)}function g(e){return(0,s.api)("stories.askQuestion",e)}function v(e){return(0,s.api)("stories.deleteQuestion",e)}function y(e){return(0,s.api)("stories.banQuestionAuthor",e)}function w(e){return(0,s.api)("stories.unbanQuestionAuthor",e)}function S(e){return(0,s.api)("stories.markAppNotificationsSeen",e)}function f(e){return(0,s.api)("stories.subscribeUserToApp",e)}function E(e){return(0,s.api)("stories.getPhotoUploadServer",e)}function b(e){return(0,s.api)("stories.getVideoUploadServer",e)}function k(e){return(0,s.api)("stories.save",e)}},446731:(e,t,i)=>{i.d(t,{StoriesLoadMethods:()=>o,getStoriesLoadParams:()=>r});var s=i(362641);var o;!function(e){e[e.getViewers=0]="getViewers",e[e.getReplies=1]="getReplies",e[e.getQuestions=2]="getQuestions",e[e.getDetailedStats=3]="getDetailedStats",e[e.getStats=4]="getStats"}(o||(o={}));const r=(e,t)=>({0:{owner_id:e,story_id:t,extended:1,count:100,fields:(0,s.makeUserFields)(["domain","photo_100"])},1:{owner_id:e,story_id:t,extended:1,fields:(0,s.makeUserFields)(["is_nft","domain","photo"])},2:{owner_id:e,story_id:t,extended:1,fields:(0,s.makeUserFields)(["domain","first_name_dat","first_name_ins","last_name_ins","last_name_dat","first_name_gen","last_name_gen"]),count:30},3:{owner_id:e,story_id:t},4:{owner_id:e,story_id:t}})},332268:(e,t,i)=>{i.d(t,{StoriesLoadMethods:()=>r.StoriesLoadMethods,clearStoriesLoadingStats:()=>o.clearStoriesLoadingStats,clearStoriesNavigationStats:()=>o.clearStoriesNavigationStats,createStoriesService:()=>s.createStoriesService,getConnectionType:()=>o.getConnectionType,getStoriesLoadParams:()=>r.getStoriesLoadParams,getStoriesLoadingStats:()=>o.getStoriesLoadingStats,getStoriesNavigationStats:()=>o.getStoriesNavigationStats,saveNavigationStatEvent:()=>o.saveNavigationStatEvent,saveViewerStartTime:()=>o.saveViewerStartTime,serializeLoadingStats:()=>o.serializeLoadingStats,serializeNavigationStats:()=>o.serializeNavigationStats,statsService:()=>n.statsService,storiesService:()=>n.storiesService});var s=i(558231),o=i(386694),r=(i(911622),i(446731)),n=i(735369)},558231:(e,t,i)=>{i.d(t,{createStoriesService:()=>r});var s=i(210929),o=i(911622);const r=({domain:e})=>{const t=e.createEvent("fire/storiesGet"),i=e.createEvent("fire/storiesGetArchive"),r=e.createEvent("fire/storiesGetViewers"),n=e.createEvent("fire/storiesGetReplies"),a=e.createEvent("fire/storiesGetQuestions"),l=e.createEvent("fire/storiesGetStats"),d=e.createEvent("fire/storiesGetDetailedStats"),c=e.createEvent("fire/storiesMarkSkipped"),_=e.createEvent("fire/storiesMarkNotInterested"),h=e.createEvent("fire/storiesMarkSeen"),u=e.createEvent("fire/storiesHidePrivacyBlock"),p=e.createEvent("fire/storiesDelete"),m=e.createEvent("fire/storiesAskQuestion"),g=e.createEvent("fire/storiesDeleteQuestion"),v=e.createEvent("fire/storiesBanQuestionAuthor"),y=e.createEvent("fire/storiesUnbanQuestionAuthor"),w=e.createEvent("fire/storiesMarkAppNotificationsSeen"),S=e.createEvent("fire/storiesSubscribeUserToApp"),f=e.createEvent("fire/storiesGetPhotoUploadServer"),E=e.createEvent("fire/storiesGetVideoUploadServer"),b=e.createEvent("fire/storiesSave"),k=e.createEffect("fx/storiesGet"),T=e.createEffect("fx/storiesGetArchive"),C=e.createEffect("fx/storiesGetViewers"),M=e.createEffect("fx/storiesGetReplies"),L=e.createEffect("fx/storiesGetQuestions"),P=e.createEffect("fx/storiesGetStats"),I=e.createEffect("fx/storiesGetDetailedStats"),A=e.createEffect("fx/storiesMarkSkipped"),B=e.createEffect("fx/storiesMarkNotInterested"),D=e.createEffect("fx/storiesMarkSeen"),x=e.createEffect("fx/storiesHidePrivacyBlock"),O=e.createEffect("fx/storiesDelete"),N=e.createEffect("fx/storiesAskQuestion"),R=e.createEffect("fx/storiesDeleteQuestion"),F=e.createEffect("fx/storiesBanQuestionAuthor"),U=e.createEffect("fx/storiesUnbanQuestionAuthor"),j=e.createEffect("fx/storiesMarkAppNotificationsSeen"),H=e.createEffect("fx/storiesSubscribeUserToApp"),W=e.createEffect("fx/storiesGetPhotoUploadServer"),K=e.createEffect("fx/storiesGetVideoUploadServer"),V=e.createEffect("fx/storiesSave");return k.use(o.apiStoriesGet),T.use(o.apiStoriesGetArchive),C.use(o.apiStoriesGetViewers),M.use(o.apiStoriesGetReplies),L.use(o.apiStoriesGetQuestions),P.use(o.apiStoriesGetStats),I.use(o.apiStoriesGetDetailedStats),A.use(o.apiStoriesMarkSkipped),B.use(o.apiStoriesMarkNotInterested),D.use(o.apiStoriesMarkSeen),x.use(o.apiStoriesHidePrivacyBlock),O.use(o.apiStoriesDelete),N.use(o.apiStoriesAskQuestion),R.use(o.apiStoriesDeleteQuestion),F.use(o.apiStoriesBanQuestionAuthor),U.use(o.apiStoriesUnbanQuestionAuthor),j.use(o.apiStoriesMarkAppNotificationsSeen),H.use(o.apiStoriesSubscribeUserToApp),W.use(o.apiStoriesGetPhotoUploadServer),K.use(o.apiStoriesGetVideoUploadServer),V.use(o.apiStoriesSave),(0,s.sample)({clock:t,target:k}),(0,s.sample)({clock:i,target:T}),(0,s.sample)({clock:r,target:C}),(0,s.sample)({clock:n,target:M}),(0,s.sample)({clock:a,target:L}),(0,s.sample)({clock:l,target:P}),(0,s.sample)({clock:d,target:I}),(0,s.sample)({clock:c,target:A}),(0,s.sample)({clock:_,target:B}),(0,s.sample)({clock:h,target:D}),(0,s.sample)({clock:u,target:x}),(0,s.sample)({clock:p,target:O}),(0,s.sample)({clock:m,target:N}),(0,s.sample)({clock:g,target:R}),(0,s.sample)({clock:v,target:F}),(0,s.sample)({clock:y,target:U}),(0,s.sample)({clock:w,target:j}),(0,s.sample)({clock:S,target:H}),(0,s.sample)({clock:f,target:W}),(0,s.sample)({clock:E,target:K}),(0,s.sample)({clock:b,target:V}),{fireGet:t,fireGetArchive:i,fireGetViewers:r,fireGetReplies:n,fireGetQuestions:a,fireGetStats:l,fireGetDetailedStats:d,fireMarkSkipped:c,fireMarkNotInterested:_,fireMarkSeen:h,fireHidePrivacyBlock:u,fireDelete:p,fireAskQuestion:m,fireDeleteQuestion:g,fireBanQuestionAuthor:v,fireUnbanQuestionAuthor:y,fireMarkAppNotificationsSeen:w,fireSubscribeUserToApp:S,fireGetPhotoUploadServer:f,fireGetVideoUploadServer:E,fireSave:b,getFx:k,getArchiveFx:T,getViewersFx:C,getRepliesFx:M,getQuestionsFx:L,getStatsFx:P,getDetailedStatsFx:I,markSkippedFx:A,markNotInterestedFx:B,markSeenFx:D,hidePrivacyBlockFx:x,deleteFx:O,askQuestionFx:N,deleteQuestionFx:R,banQuestionAuthorFx:F,unbanQuestionAuthorFx:U,markAppNotificationsSeenFx:j,subscribeUserToAppFx:H,getPhotoUploadServerFx:W,getVideoUploadServerFx:K,saveFx:V}}},735369:(e,t,i)=>{i.d(t,{statsService:()=>u,storiesService:()=>h});var s=i(210929),o=i(332268),r=i(697227),n=i(683313),a=i(655555),l=i(105338),d=i(65856),c=i(527487);const _=(0,s.createDomain)("mvk/Stories"),h=(0,o.createStoriesService)({domain:_}),u=(0,r.createStatsService)({domain:_}),p=((0,n.createNarrativesService)({domain:_}),(0,a.createLikesService)({domain:_}),(0,l.createMessagesService)({domain:_}),(0,d.createFaveService)({domain:_}),(0,c.createPollsService)({domain:_}));_.createEffect("fire/storiesGetFeedback").use((({ownerId:e,storyId:t,pollId:i})=>{const s=(0,o.getStoriesLoadParams)(e,t);return Promise.allSettled([h.getViewersFx(s[o.StoriesLoadMethods.getViewers]),h.getRepliesFx(s[o.StoriesLoadMethods.getReplies]),h.getQuestionsFx(s[o.StoriesLoadMethods.getQuestions]),i?p.getByIdFx({owner_id:e,poll_id:i}):Promise.resolve(null),h.getDetailedStatsFx(s[o.StoriesLoadMethods.getDetailedStats]),h.getStatsFx(s[o.StoriesLoadMethods.getStats])]).then((e=>Promise.resolve(e.map((e=>"fulfilled"===e.status?null==e?void 0:e.value:null)))))}))},477932:(e,t,i)=>{function s(e){var t;return(null!=(t=null==e?void 0:e.split("_"))?t:[]).map(Number)}i.d(t,{splitStoryRawId:()=>s})},729838:(e,t,i)=>{i.d(t,{UploadPhoto:()=>s.UploadPhoto});var s=i(876547)},704585:(e,t,i)=>{var s,o,r;i.d(t,{OwnerAvatarEditorModes:()=>r,OwnerAvatarEditorPhotoTypes:()=>o,UploadPhotoErrorCodes:()=>s}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.UPLOAD=1]="UPLOAD",e[e.NOT_ALLOWED_EXTENSION=2]="NOT_ALLOWED_EXTENSION",e[e.IMAGE_TOO_SMALL=3]="IMAGE_TOO_SMALL",e[e.IMAGE_TOO_BIG=4]="IMAGE_TOO_BIG",e[e.BAD_ASPECT_RATIO=5]="BAD_ASPECT_RATIO"}(s||(s={})),function(e){e.UPLOADED="uploaded",e.EXISTED="existed"}(o||(o={})),function(e){e[e.UPLOAD=1]="UPLOAD",e[e.SELECT=2]="SELECT",e[e.EDIT=3]="EDIT",e[e.NFT=4]="NFT",e[e.NFT_EDIT=5]="NFT_EDIT"}(r||(r={}))},876547:(e,t,i)=>{i.d(t,{UploadPhoto:()=>n});var s=i(434788),o=i(704585),r=i(674721);class n{validate(e){const{constraints:t,allowedTypes:i,lang:s}=this.config;let n=!1;return i&&(n=i.some((function(t){return"*"===t||t===e.type}))),n?t?(0,r.getImageSizeByBlob)(e).then((function(e){const{maxWidth:i,minWidth:r,maxHeight:n,minHeight:a,maxAspectRatio:l,minAspectRatio:d}=t,[c,_]=e,h=c/_;if(c>i||_>n){const e=(s[`error_${o.UploadPhotoErrorCodes.IMAGE_TOO_BIG}`]||"").replace("{width}",String(i)).replace("{height}",String(n));return Promise.reject({code:o.UploadPhotoErrorCodes.IMAGE_TOO_BIG,text:e})}if(c<r||_<a){const e=(s[`error_${o.UploadPhotoErrorCodes.IMAGE_TOO_SMALL}`]||"").replace("{width}",String(r)).replace("{height}",String(a));return Promise.reject({code:o.UploadPhotoErrorCodes.IMAGE_TOO_SMALL,text:e})}return d&&d>h||l&&h>l?Promise.reject({code:o.UploadPhotoErrorCodes.BAD_ASPECT_RATIO,text:s[`error_${o.UploadPhotoErrorCodes.BAD_ASPECT_RATIO}`]}):Promise.resolve(null)})).catch((function(e){return e&&e.text&&e.code?Promise.reject(e):Promise.reject({code:o.UploadPhotoErrorCodes.UNKNOWN,text:s[`error_${o.UploadPhotoErrorCodes.UNKNOWN}`]})})):Promise.resolve(null):Promise.reject({code:o.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION,text:s[`error_${o.UploadPhotoErrorCodes.NOT_ALLOWED_EXTENSION}`]})}upload(e,t,i="file1"){return this.validate(e).then((()=>new Promise(((s,r)=>{const n=new XMLHttpRequest,a=new FormData;a.append(i,e),n.open("POST",t||this.config.url,!0),n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE&&200===n.status){let e;try{n.responseText&&(e=JSON.parse(n.responseText))}catch(e){r({code:o.UploadPhotoErrorCodes.UNKNOWN,text:this.config.lang[`error_${o.UploadPhotoErrorCodes.UNKNOWN}`]})}s(e)}},n.onerror=()=>{r({code:o.UploadPhotoErrorCodes.UPLOAD,text:this.config.lang[`error_${o.UploadPhotoErrorCodes.UPLOAD}`]})},n.upload.onprogress=e=>{this.progressCallback&&this.progressCallback(e.loaded,e.total)},n.send(a)}))))}constructor(e,t){this.config=(0,s._)({allowedTypes:["*"]},e),this.progressCallback=t}}},674721:(e,t,i)=>{function s(e){return t=URL.createObjectURL(e),new Promise((function(e,i){const s=new Image;s.onload=function(){const t=Number(s.height),i=Number(s.width);e([i,t])},s.onerror=function(){i()},s.onabort=function(){i()},s.src=t}));var t}i.d(t,{getImageSizeByBlob:()=>s})},898776:(e,t,i)=>{i.d(t,{logViewMarketItemInStories:()=>n});var s=i(382671),o=i(865142),r=i(706259);function n(e){const t=new URL(`${document.location.origin}${e}`).searchParams.get("w");if(t){const[e,i]=t.slice(8).split("_");s.viewAnalytics.logMarketItemView({view:{start_view:"0",end_view:"0"},screen:(0,o.getStatScreen)(),ref_source:r.RefSource.STORIES,params:{item_id:Number(i),owner_id:Number(e),search_query_id:0,item_idx:0}})}}},880431:(e,t,i)=>{var s,o,r,n=i(418056);(null==(s=window.vk)||null==(o=s.pe)?void 0:o.static_manager_dynamic_imports)&&(null==(r=window.vk)?void 0:r.stDomain)&&(i.p=window.vk.stDomain+"/dist/"),window.Stories=n.Stories;try{window.stManager.done(window.jsc("web/stories.js"))}catch(e){}},667794:(e,t,i)=>{i.d(t,{PinnedMessageComponent:()=>m});var s,o,r,n=i(434788),a=i(785893),l=i(786006),d=i(293579),c=i(973935),_=i(283452),h=i(321850);(null==(s=window.vk)||null==(o=s.pe)?void 0:o.static_manager_dynamic_imports)&&(null==(r=window.vk)?void 0:r.stDomain)&&(i.p=window.vk.stDomain+"/dist/");const u="PinnedMessage";try{window.stManager.done(window.jsc("web/video_pinned_message.js")),(0,d.registerReactApplication)(u,(e=>{const t=(0,d.getReactRootEl)(u);(0,h.pushNavDestroy)((()=>{t&&c.unmountComponentAtNode(t)})),c.render((0,a.jsx)(l.PinnedMessage,(0,n._)({},e)),t)})),(0,_.tq)().setStartupHandler("VideoPinnedMessage/init",(({payload:e})=>{p({ownerId:e.data.owner_id,commentId:e.data.comment_id,canUnpin:!!e.data.can_unpin,canDelete:!!e.data.can_delete,canReport:!!e.data.can_report,text:e.data.text||"",authorId:e.data.author_id,authorName:e.data.author_name||"",authorVerified:!!e.data.author_verified,authorHref:e.data.author_href||""})}))}catch(e){}function p(e){window.initReactApplication(u,e||{})}const m={init:p}},780041:(e,t,i)=>{i.d(t,{AVATAR_SIZES:()=>h,COMMON_FRIENDS_IMAGE_STATUS_INDEX:()=>a,FOLLOWERS_SECTION_NAME:()=>_,FRIENDS_IMAGE_STATUS_INDEX:()=>n,FRIENDS_LIMIT_PER_PAGE:()=>u,FRIENDS_LIST_FRIEND_IS_NFT_INDEX:()=>l,FRIENDS_LIST_FRIEND_OPTIONS_INDEX:()=>s,FRIENDS_REQUESTS_FRIEND_IS_NFT_INDEX:()=>d,FRIENDS_REQUESTS_TO_SUBSCRIBERS_CLASSES:()=>p,FRIENDS_STATUS_NOT_FRIENDS:()=>o,FRIENDS_STATUS_REQUEST_FROM_USER:()=>r,PHONEBOOK_SECTION_NAME:()=>c});const s=13,o=0,r=1,n=9,a=8,l=14,d=11,c="phonebook",_="followers",h={normal:80,small:48},u=2e3,p={ROOT:"friends_requests_to_subscribers",DESCRIPTION_STEP:"friends_requests_to_subscribers_description_step",DONE_STEP:"friends_requests_to_subscribers_done_step"}},13555:(e,t,i)=>{i.d(t,{FRIENDS_LIST_LOADING_MARK_START:()=>r,FRIENDS_LIST_LOADING_STATLOG:()=>l,FRIENDS_LOAD_MORE_MARK_START:()=>a,FRIENDS_OUT_REQUESTS_LOADING_MARK_START:()=>n,FriendsListLoadingType:()=>_,sendLoadingStats:()=>u,trackEndWithMarkName:()=>c,trackStartWithMarkName:()=>d});var s=i(434788),o=i(215066);const r="FRIENDS_LIST_LOADING_MARK_START",n="FRIENDS_OUT_REQUESTS_LOADING_MARK_START",a="FRIENDS_LOAD_MORE_MARK_START",l="friends_list_loading";function d(e){window.cur.friendsPerformanceMarks||(window.cur.friendsPerformanceMarks={}),window.cur.friendsPerformanceMarks[e]=performance.now()}function c(e){return{duration:performance.now()-+window.cur.friendsPerformanceMarks[e]}}var _;!function(e){e.INIT_BLOCKING="init_blocking",e.INIT_PARALLEL="init_parallel",e.OUT_REQUESTS_BLOCKING="out_requests_blocking",e.LOAD_MORE="load_more"}(_||(_={}));const h=()=>{var e,t;return{isSameUser:(null==(e=window.vk)?void 0:e.id)===(null==(t=window.cur)?void 0:t.oid)?"true":"false"}};function u(e,t,i){const r=h(),n=(0,s._)({},i,r);(0,o.statlogsValueEvent)(e,t,n)}},371911:(e,t,i)=>{i.d(t,{FriendsListLoadingMode:()=>s,fillFriendsListWithDataFromServer:()=>v,isFriendsLoadingBugfixEnabled:()=>m,removeUnseenStories:()=>p});var s,o=i(434788),r=i(266014),n=i(514995),a=i(75272),l=i(892644),d=i(839470),c=i(780041),_=i(82161),h=i(363444),u=i(13555);function p(e){window.cur&&window.cur.hasUnseenStories&&delete window.cur.hasUnseenStories[e];const t=document.querySelectorAll(".friends_photo_stories_unseen"+e);for(const s of t){var i;s.classList.remove("friends_photo_stories_unseen","friends_photo_stories_unseen"+e),null==(i=s.closest(".friends_photo"))||i.removeAttribute("onclick")}window.Friends&&window.Friends.addSeenStories(e),(0,r.removeAvatarRichOutlineAtNode)(document.body,String(e),n.AvatarRichOutlineType.STORIES_UNSEEN)}function m(e=!1){return(0,d.partConfigEnabled)("friends_list_loading_bugfix")&&e}function g(e){return(t=0,i=e,Array.from(Array(i).keys()).map((e=>e+t))).map((e=>{var t,i,s;return s={queryParams:{id:null!=(t=window.cur.oid)?t:0,gid:null!=(i=window.cur.gid)?i:0,sort:window.nav.objLoc.sort,platform_id:window.nav.objLoc.platform_id,section:window.cur.section,chunk_index:e,chunk_size:c.FRIENDS_LIMIT_PER_PAGE}},new Promise(((e,t)=>{h.ajax.post("al_friends.php",(0,o._)({act:"load_friends_silent"},s.queryParams),{onDone:(t,i,s)=>{e({friendsData:t,occupations:i,filters:s})},onFail:(e,i)=>{t({error:e,status:i})},local:1})}))}));var t,i}function v(e){const{showMore:t,filter:i,indexAll:s}=e.friendsMethods,o=function(e){const{icon:t}=(0,l.getIcon32Spinner)(),i=document.createElement("div");i.classList.add("friends_wide_loading");const s=(0,a.createElementFromHTML)(t);return s&&(i.append(s),null==e||e.append(i)),()=>{i.remove()}}(document.querySelector("#list_content"));var r,n;let d=g((r=[window.cur.allFriendsCount,window.cur.allRequestsCount,window.cur.requestsCount,window.cur.followersCount],n=c.FRIENDS_LIMIT_PER_PAGE,Math.ceil(Math.max(...r)/n)));!function(){for(let e in window.cur.friendsList)window.cur.friendsList.hasOwnProperty(e)&&(window.cur.friendsList[e]=[])}(),Promise.allSettled(d).then((e=>{o(),window.cur.silent=!1;const r=[];let n=200,a="",l="false";for(let o of e){if("rejected"===o.status){var d,c,h,p,m;n=null!=(p=null==(d=o.reason)?void 0:d.status)?p:"unknown",a=null!=(m=null==(c=o.reason)||null==(h=c.error)?void 0:h.message)?m:"",l="true";continue}const{friendsData:e,occupations:u,filters:g}=o.value;if(e){window.cur.occupations=(0,_.extend)(window.cur.occupations||{},u);for(let t in e)e.hasOwnProperty(t)&&(window.cur.friendsList[t]=Array.isArray(window.cur.friendsList[t])?window.cur.friendsList[t].concat(e[t]):e[t]);s((function(){"list"==window.cur.section.substr(0,4)&&(window.cur.friendsList[window.cur.section]=Array.isArray(window.cur.friendsList[window.cur.section])?window.cur.friendsList[window.cur.section].concat(i(window.cur.friendsList.all,window.cur.section)):i(window.cur.friendsList.all,window.cur.section)),(window.cur.onSilentLoad||t)()})),g.cities&&r.push(g.cities)}}const g=r.flat().reduce(((e,t)=>{const i=function(e){if("string"==typeof e)return e;return`${e[0]}_${e[1]}`}(t);return e[i]||(e[i]=t),e}),{});!function(e){window.stManager.add(["ui_controls.js","ui_controls.css"],(function(){if(window.cur.cityFilter.setData(e),window.cur.cityFilterOpened){const e=document.getElementById("friends_fltr_progress");e&&(e.style.display="none"),window.cur.cityFilter.showDefaultList()}}))}(Object.values(g));const v=(0,u.trackEndWithMarkName)(u.FRIENDS_LIST_LOADING_MARK_START);(0,u.sendLoadingStats)(u.FRIENDS_LIST_LOADING_STATLOG,v.duration,{allFriendsListCount:window.cur.allFriendsCount,fansCount:window.cur.allRequestsCount,requestsCount:window.cur.requestsCount,followersCount:window.cur.followersCount,outRequestsCount:window.cur.outRequestsCount,mode:"silent",httpStatus:n,section:window.cur.curList,errorMessage:a,loadingType:u.FriendsListLoadingType.INIT_PARALLEL,userId:window.vk.id,hasError:l})}))}!function(e){e.SILENT="silent",e.DEFAULT="default"}(s||(s={}))},957518:(e,t,i)=>{i.d(t,{isKeyboardActivationEvent:()=>o});var s=i(953908);const o=e=>!!(window.KeyboardEvent&&e instanceof window.KeyboardEvent)&&(!(e.ctrlKey||e.altKey||e.metaKey)&&!![s.KEY.ENTER,s.KEY.SPACE].includes(e.keyCode))},15080:(e,t,i)=>{i.d(t,{createModule:()=>n,createMutations:()=>r,destroyModule:()=>a});var s=i(850989),o=i(953908);function r(e){return{callMutations(){if("function"==typeof e)throw console.trace(),new Error("Mutations are not initialized");return e},bindMutations(...t){if("function"!=typeof e)throw console.trace(),new Error("Mutations are already initialized");return e=e(...t)}}}function n(e){const t={_registeredHandlers:[]};return e.handlers(((...e)=>function(e,t,i,s){(0,o.addEvent)(t,i,s),e._registeredHandlers.push({handlerType:"bind",elem:t,types:i,handler:s})}(t,...e)),((...e)=>function(e,t,i,o,r,n){(0,s.addDelegateEvent)(t,i,o,r,n),e._registeredHandlers.push({handlerType:"delegate",elem:t,types:i,selector:o,handler:r})}(t,...e))),t}function a(e){e._registeredHandlers.forEach((e=>{const{handlerType:t,elem:i,types:r,handler:n}=e;"delegate"===t?(0,s.removeDelegateEvent)(i,r,e.selector,n):(0,o.removeEvent)(i,r,n)})),e._registeredHandlers=[]}},863727:(e,t,i)=>{i.d(t,{checkPostLen:()=>p,getPostAvatarString:()=>m,removeUnseenStories:()=>h});var s=i(795558),o=i(82161),r=i(854099),n=i(29271),a=i(170864),l=i(266014),d=i(514995),c=i(12468),_=i(555510);function h(e){var t;if(u(document,e),null==(t=window.wkcur)?void 0:t.pageReplaced)for(let t of window.wkcur.pageReplaced)u(t[0],e)}function u(e,t){const i=e.querySelectorAll(".reply_image_stories_unseen"+t);for(const e of i){var s;e.classList.remove("reply_image_stories_unseen","reply_image_stories_unseen"+t),null==(s=(0,a.replyUserImageLinkClosest)(e))||s.removeAttribute("onclick")}(0,l.removeAvatarRichOutlineAtNode)(e,String(t),d.AvatarRichOutlineType.STORIES_UNSEEN);const o=e.querySelectorAll(".post_image_stories_unseen"+t);for(const e of o){var r;e.classList.remove("post_image_stories_unseen","post_image_stories_unseen"+t),null==(r=e.closest(".post_image, ._post_image"))||r.removeAttribute("onclick")}}function p(e,t,i,a){var l;if(!e)return;const d=null==(l=window.cur.options)?void 0:l.max_post_full_length;if(!d)return!0;const c=(0,s.ge)(e);if(!c)return;let _=(0,o.trim)(window.Emoji.val(c)).replace(/\n\n\n+/g,"\n\n");if(c.lastLen===_.length&&!a)return c.lastLen<=d;const h=c.lastLen=_.length;if(t=(0,s.ge)(t),h>d-100){const e=h>d;if(t&&(e?(i&&(r.FlatButton.isFlatButton(i)?r.FlatButton.setDisabled(i,!0):(0,s.toggleClass)(i,"button_disabled",!0)),t.innerHTML=n.getLang("text_exceeds_symbol_limit",h-d),(0,s.toggleClass)(t,"post_field_warning_red",!0)):t.innerHTML=n.getLang("text_N_symbols_remain",d-h),(0,s.show)(t)),e)return!1}else t&&(0,s.hide)(t);return t&&(0,s.toggleClass)(t,"post_field_warning_red",!1),i&&(r.FlatButton.isFlatButton(i)?r.FlatButton.setDisabled(i,!1):(0,s.toggleClass)(i,"button_disabled",!1)),!0}const m=(e,t,i=_.REPLY_IMAGE_DEFAULT_SIZE,s=!1,o)=>{const r=[t,"_post_field_image"];return o&&r.push(o),(0,c.renderAvatarToString)(e,i,null,r,null,void 0,!1,void 0,"",!(i<_.MIN_NFT_IMAGE_SIZE)&&s)}},512637:(e,t,i)=>{i.d(t,{ENABLED_IN_POST_REPLY:()=>o,isDebugEnabled:()=>s.isDebugEnabled});var s=i(457972);const o=!1},403702:(e,t,i)=>{i.d(t,{reactionLogError:()=>r});var s=i(698216),o=i(908088);const r=({error:e})=>{const t=(0,o.getReactionConfig)();var i;const r=null!=(i=null==t?void 0:t.reportJsErrors)&&i;(0,s.reactionLogError)({error:e,reportError:r})}},908088:(e,t,i)=>{i.d(t,{getReactionConfig:()=>m,getReactionSet:()=>u,storageAddSets:()=>h,storageSetConfig:()=>p});var s=i(434788),o=i(659397),r=i(822715),n=i(212368),a=i(403702),l=i(682951),d=i(512637);const c=(0,n.makeSharedState)("reactions-storage",(()=>new Map),{version:0}),_=(0,n.makeSharedState)("reactions-config",(()=>({config:void 0})),{version:0}),h=e=>{(0,d.isDebugEnabled)()&&console.log(e),Object.entries(e).forEach((([e,t])=>{const i=(0,r.validateReactionSetPayloaditems)(t,e);if(i)return void(0,a.reactionLogError)({error:i.error});const n=t.map((e=>(0,s._)({},e,{title:(0,o.decodeHTMLEntities)(e.title)})));c().set(e,(0,r.prepareReactionMenuSet)(e,n,{imageMenuSize:l.SIZE_96,imagePreviewSize:l.SIZE_32,imageStoryPanelSize:l.SIZE_128,imageStoryPreviewSize:l.SIZE_40}))}))},u=e=>{const t=c().get(e);if(t)return t;{const t=new Error(`Reaction set not found: ${e}`);(0,a.reactionLogError)({error:t})}},p=e=>{(0,d.isDebugEnabled)()&&console.log(e);const t=(0,r.parseReactionMenuConfig)(e);t?_().config=t:console.warn("Reactions: invalid menu config passed",e)},m=()=>{var e;return null==(e=_())?void 0:e.config}},965109:(e,t,i)=>{i.d(t,{ReportReasonIds:()=>m,afterCommentReportSubmit:()=>v,showReportForm:()=>g});var s,o,r=i(434788),n=i(785893),a=i(643897),l=i(29271),d=i(647941),c=i(599809),_=i(879552),h=i(895145),u=i(359639);(0,d.makeAuthAndApiGlobal)();const p=window.vk;var m;function g(e,t,s,o,a){const l=(0,h.asyncComponent)((()=>Promise.all([i.e(75514),i.e(98066),i.e(24509),i.e(68592),i.e(29019)]).then(i.bind(i,517186))),(({ReportForm:e})=>e));(0,u.showMessageBoxModalSuspense)((i=>(0,n.jsx)(l,(0,r._)({},i,{reportSource:e,reportSourceOwnerId:t,reportSourceId:s,onSubmit:o}))),{onDestroy:a})}function v(e,t,i){const s=function(e,t,i){switch(e){case"photo":return`#post${t}photo_${i}`;case"video":return`#post${t}video_${i}mv`;case"market":return`#post${t}market_${i}`}}(e,t,i);if("photo"===e){const e=document.querySelector(`${s} .dld`);null!==e&&(e.outerHTML="")}const o=document.querySelector(`${s} .reply_wrap`);null!==o?(o.style.display="none",o.outerHTML+=`<div class="dld">${l.getLang("global_report_sent")}</div>`):(0,a.debugLog)(`Unable to hide report button for ${e} comment`)}(0,c.setLoginConfig)({onCaptcha:_.handleCaptcha,domain:null==p||null==(s=p.apiConfigDomains)?void 0:s.loginDomain,onCaptchaSuccess:_.handleCaptchaSuccess}),(0,c.setApiConfig)({onCaptcha:_.handleCaptcha,domain:null==p||null==(o=p.apiConfigDomains)?void 0:o.apiDomain,onCaptchaSuccess:_.handleCaptchaSuccess}),function(e){e[e.NotOriginalContent=28]="NotOriginalContent"}(m||(m={}))},111958:(e,t,i)=>{i.d(t,{removeUnseenStories:()=>n});var s=i(266014),o=i(514995),r=i(839470);function n(e){const t=document.querySelectorAll(".search_item_img_stories_unseen"+e);for(const s of t){var i;s.classList.remove("search_item_img_stories_unseen","search_item_img_stories_unseen"+e),null==(i=s.closest(".search_item_img_link"))||i.removeAttribute("onclick")}(0,r.partConfigEnabled)("avatar_component_refactor_web")&&(0,s.removeAvatarRichOutlineAtNode)(document.body,String(e),o.AvatarRichOutlineType.STORIES_UNSEEN)}},252886:(e,t,i)=>{i.d(t,{AppsMetaStory:()=>c});var s=i(785893),o=i(973935),r=i(601618),n=i(517366),a=i(29271),l=i(914263),d=i(934346);class c extends r.MetaStory{update(){o.render((0,s.jsx)(l.MetaStory,{metaStoryInfo:(0,s.jsx)(d.MetaStoryInfo,{url:this.app.url,icon:this.app.photoUrl,header:this.app.name,urlText:a.getLang("stories_go_to_app")}),list:this.block.grouped,listName:n.StoryListName.apps,isPaused:this.isPaused.bind(this),onLongTap:this.options.onLongTap,onScroll:this.onScroll,pause:this.options.pause,play:this.options.play,playNextStory:this.options.playNextStory,playPrevStory:this.options.playPrevStory}),this.wrapper)}constructor(e,t){if(super(e,t),!this.block.app)throw new Error("There is not an app info");this.app=this.block.app}}},761417:(e,t,i)=>{i.d(t,{BaseStory:()=>s});class s{play(){this.paused=!1,this.isLoaded()&&this.options.onPlay()}pause(){this.paused=!0,this.options.onPause()}isPaused(){return this.paused}isLoaded(){return this.loaded}onStartLoading(){var e,t;null==(t=(e=this.options).onLoadingStart)||t.call(e)}canPlay(){var e,t;if(null==(t=(e=this.options).onLoadingEnd)||t.call(e),this.loaded=!0,this.startTs=Date.now(),!this.isPaused()){if("visible"!==document.visibilityState)return;this.play()}}constructor(e){this.paused=!0,this.loaded=!1,this.startTs=0,this.failed=!1,this.options=e}}},145298:(e,t,i)=>{i.d(t,{ActionsButton:()=>p});var s=i(785893),o=i(667294),r=i(29271),n=i(981582),a=i(82161),l=i(892726),d=i(584356),c=i(432483),_=i(517366),h=i(659397),u=i(964262);const p=({story:e})=>{if(!e.getCurStoryData())return null;const t=function(e){const t=e.getCurStoryData(),i=e.getCurrentNarrative(),s=e.layer.listName,o=[];if(!t)return o;const{raw_id:n,can_hide_reply:c,report_hash:h,can_remove:u,isAds:p,canMarkNotInterested:m}=t,{can_blacklist:g}=e.data,[v,y]=n.split("_").map((e=>(0,a.intval)(e)));(null==i?void 0:i.canEdit)&&o.push({label:r.getLang("stories_narrative_edit_button"),onClick:()=>e.sendNarrativeEditButtonDidPress()});v===window.vk.id||!g||i||p||o.push({label:r.getLang("stories_add_blacklist_button"),onClick:()=>e.addToBlacklist()});m&&o.push({label:r.getLang("stories_mark_not_interested"),onClick:t=>{var i;const s=new MouseEvent("mouseout",{bubbles:!0});null==(i=t.nativeEvent.target)||i.dispatchEvent(s),e.markNotInterested()}});c&&o.push({label:r.getLang("stories_hide_reply_button"),onClick:()=>e.hideReply()});i&&(o.push({label:i.isBookmarked?r.getLang("stories_narrative_remove_bookmark_button"):r.getLang("stories_narrative_add_bookmark_button"),onClick:()=>e.sendNarrativeBookmarkButtonDidPress()}),o.push({label:r.getLang("stories_narrative_copy_link"),onClick:()=>{const e=`${location.protocol}//${location.host}/narrative${v}_${i.id}_${y}`;(0,l.copyToClipboard)(e),(0,d.showDoneBox)(r.getLang("stories_narrative_copy_link_done"))}}));h&&o.push({label:r.getLang("stories_report"),onClick:()=>e.report()});v===window.vk.id||i||o.push({label:r.getLang("stories_settings"),onClick:()=>window.Stories.showBlackList()});u&&i&&o.push({red:!0,label:r.getLang("stories_remove_from_narrative"),onClick:()=>e.removeStoryFromNarrative()});u&&o.push({red:!0,label:i?r.getLang("global_narrative_delete"):r.getLang("global_delete"),onClick:()=>i?e.removeNarrativeBox():e.removeStoryBox()});s===_.StoryListName.discover&&o.push({red:!0,label:r.getLang("stories_hide_discover"),onClick:()=>e.hideDiscover()});return o}(e);if(0===t.length)return null;let i,p=(0,o.createRef)();const m=(0,u.isNewDesignEnabled)();return(0,s.jsxs)("div",{className:(0,h.classNames)("ui_actions_menu_wrap _ui_menu_wrap",{"StoryButton StoryButton--more StoryBottomControl ui_actions_menu_top":!m,ui_actions_menu_bottom:m}),onMouseEnter:t=>{clearTimeout(i),e.pauseStory(),n.default.show(p.current,t)},onMouseLeave:()=>{n.default.hide(p.current),clearTimeout(i),i=setTimeout((()=>e.autoResumeStory()),300)},ref:p,children:[(0,s.jsx)("div",{className:"ui_actions_menu _ui_menu",children:t.map((({label:e,onClick:t,red:i,disable:o})=>(0,s.jsx)("div",{className:(0,h.classNames)("StoryMenuItem ui_actions_menu_item",{"StoryMenuItem--red":i,"StoryMenuItem--disable":o}),onClick:t,children:e},e)))}),(0,s.jsx)(c.Icon24MoreHorizontal,{})]})}},384354:(e,t,i)=>{i.d(t,{default:()=>n});var s=i(785893),o=i(920905),r=i(682615);const n=({title:e,additionalTitle:t,needSeparator:i=!0,className:n,children:a})=>(0,s.jsxs)("div",{className:(0,r.classNames)("FeedbackBaseBlock",n,{"FeedbackSeparator FeedbackSeparator--top":i}),children:[(0,s.jsx)(o.default,{title:e,additionalTitle:t}),a]})},860214:(e,t,i)=>{i.d(t,{default:()=>n});var s=i(785893),o=i(590517),r=i(384354);const n=({poll:e})=>(0,s.jsx)(r.default,{className:"FeedbackPollBlock",title:e.title,children:(0,s.jsx)("div",{className:"FeedbackPollBlock__poll",children:(0,s.jsx)(o.default,{poll:e.data})})})},895186:(e,t,i)=>{i.d(t,{default:()=>l});var s=i(785893),o=i(667294),r=i(392845),n=i(384354),a=i(795558);class l extends o.Component{render(){const{questions:e}=this.props,{scrollBlockPosition:t}=this.state,{items:i}=e;return(0,s.jsx)(n.default,{className:"FeedbackQuestionsBlock",title:e.title,children:(0,s.jsx)("div",{className:"FeedbackQuestionsBlock__questions",children:(0,s.jsx)("div",{className:"FeedbackQuestionsBlock__wrapper",ref:this.scrollElement,children:(0,s.jsxs)("div",{className:"FeedbackQuestionsBlock__items",style:{transform:`translateX(-${t}px)`},ref:this.positionElement,children:[(0,s.jsx)("div",{className:"FeedbackQuestionsBlock__gap"}),i.map(((e,t)=>(0,s.jsx)(r.default,{question:e,storyUrl:this.props.storyUrl,showMessage:this.props.showMessage,removeQuestion:this.removeQuestion,getReportReasons:this.getReportReasons},t))),(0,s.jsx)("div",{className:"FeedbackQuestionsBlock__gap"})]})})})})}constructor(e){super(e),this.componentDidMount=()=>{const{current:e}=this.scrollElement;e&&e.addEventListener("wheel",this.questionsMouseWheel)},this.componentWillUnmount=()=>{const{current:e}=this.positionElement;e&&e.removeEventListener("wheel",this.questionsMouseWheel)},this.questionsMouseWheel=e=>{e.preventDefault(),this.props.questions.items.length<=1||this.setPosition(Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX)},this.setPosition=e=>{const{current:t}=this.positionElement;if(!t)return;const{scrollBlockPosition:i}=this.state,[s]=(0,a.getSize)(t),o=Math.max(0,Math.min(i+e,t.scrollWidth-s));this.setState({scrollBlockPosition:o})},this.removeQuestion=e=>{const{storyOwnerId:t,storyId:i,id:s,removeHash:o}=e;window.ajax.post("al_stories.php",{act:"remove_question",story_owner_id:t,story_id:i,question_id:s,remove_hash:o},{onDone:()=>{this.props.sendNavigationStatEvents("question_delete",!0,{question_id:s}),this.props.questions.items.length?this.setPosition(0):this.props.onQuestionRemove(s)}})},this.getReportReasons=()=>new Promise(((e,t)=>{this.reportReasons.length?e(this.reportReasons):window.ajax.post("al_stories.php",{act:"question_report_box"},{onDone:t=>(this.reportReasons=t,e(this.reportReasons),!0),onFail:e=>(t(e),!0)})})),this.state={scrollBlockPosition:0},this.reportReasons=[],this.scrollElement=(0,o.createRef)(),this.positionElement=(0,o.createRef)()}}},274818:(e,t,i)=>{i.d(t,{default:()=>l});var s=i(785893),o=i(384354),r=i(211365),n=i(589897),a=i(29271);const l=({replies:e,showMore:t})=>{const{list:i}=e,l=Boolean(e.moreRepliesCount);return(0,s.jsxs)(o.default,{className:"FeedbackRepliesBlock",title:e.title,additionalTitle:e.additionalTitle,children:[(0,s.jsx)("div",{className:"FeedbackRepliesBlock__replies",children:null==i?void 0:i.map((t=>{var i;return(0,s.jsx)(r.default,{storyPack:t,listName:e.listName,source:e.source},null==(i=t.author)?void 0:i.id)}))}),l&&(0,s.jsx)(n.default,{size:"m",className:"FeedbackRepliesBlock__showMore",mode:"tertiary",onClick:t,children:(0,a.langNumeric)(e.moreRepliesCount||0,a.getLang("stories_replies_more_button","raw"))})]})}},149917:(e,t,i)=>{i.d(t,{default:()=>d});var s=i(785893),o=i(464281),r=i(384354),n=i(29271),a=i(700200),l=i(354943);const d=({stats:e,extendedStats:t,onExtendedStatsPreviewClick:i,onSettingsBtnClick:d,onPrivacyHintHide:c})=>(0,s.jsxs)(r.default,{className:"FeedbackStatsBlock",title:e.title,children:[t&&(0,s.jsxs)("div",{className:"FeedbackStatsBlock__extendedStatsPreview FeedbackSeparator FeedbackSeparator--top",onClick:i,role:"button",children:[(0,s.jsx)(o.default,{appearance:"preview",title:n.getLang("stories_detailed_stats"),subtitle:t.preview}),(0,s.jsx)("div",{className:"FeedbackStatsBlock__chevron",children:(0,s.jsx)(l.Icon24ChevronCompactRight,{})})]}),e.showPrivacyHint&&(0,s.jsxs)("div",{className:"FeedbackStatsBlock__privacyHint FeedbackSeparator FeedbackSeparator--top",children:[n.getLang("stories_privacy_feedback_hint"),(0,s.jsxs)("div",{className:"FeedbackStatsBlock__links",children:[(0,s.jsx)(a.default,{href:"/settings?act=privacy",onClick:d,children:n.getLang("stories_go_to_settings")}),(0,s.jsx)("span",{className:"dvd"}),(0,s.jsx)(a.default,{onClick:c,children:n.getLang("global_hide_notify")})]})]}),e.showEmptyStatsPrivacyHint&&(0,s.jsxs)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyHint",children:[(0,s.jsx)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyIcon"}),(0,s.jsx)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyText",children:n.getLang("stories_privacy_empty_views_hint")}),(0,s.jsx)("div",{className:"FeedbackStatsBlock__emptyStatsPrivacyLink",children:(0,s.jsx)(a.default,{href:"/settings?act=privacy",onClick:d,children:n.getLang("stories_go_to_settings")})})]})]})},920905:(e,t,i)=>{i.d(t,{default:()=>r});var s=i(785893),o=i(5163);const r=({title:e,additionalTitle:t})=>(0,s.jsxs)("div",{className:"FeedbackTitle",children:[(0,s.jsx)(o.default,{children:e}),t&&(0,s.jsx)(o.default,{className:"FeedbackTitle__additional",children:t})]})},711680:(e,t,i)=>{i.d(t,{default:()=>f});var s=i(785893),o=i(667294),r=i(910434),n=i(464281),a=i(895186),l=i(384354),d=i(149917),c=i(274818),_=i(860214),h=i(54445),u=i(682615),p=i(936134),m=i(514986),g=i(29271),v=i(659397),y=i(315954),w=i(624879);class S extends o.Component{render(){const{feedback:e,showMessage:t,sendNavigationStatEvents:i,storyImageUrl:p,showMoreReplies:m,needShowEmptyStats:S,className:f,reactionSet:E}=this.props,{isViewersLoading:b,extendedStatsActive:k}=this.state,T=null==e?void 0:e.stats,C=null==T?void 0:T.extendedStats,M=null==e?void 0:e.replies,L=null==e?void 0:e.poll,P=null==e?void 0:e.questions,I=null==e?void 0:e.viewers;return(0,s.jsx)("div",{className:(0,u.classNames)("FeedbackTooltip",f,{"FeedbackTooltip--empty":S}),onClick:e=>e.stopPropagation(),children:(0,s.jsxs)("div",{className:"FeedbackTooltip__wrapper",children:[(0,s.jsx)("div",{className:"FeedbackTooltip__close",onClick:this.close,children:(0,s.jsx)(y.Icon24Cancel,{})}),!e&&(0,s.jsx)("div",{className:"FeedbackTooltip__spinner",children:(0,s.jsx)(r.default,{size:36,color:"#6590c7",strokeWidth:3})}),e&&(0,s.jsxs)(o.Fragment,{children:[!k&&(0,s.jsx)("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef,children:(0,s.jsxs)("div",{className:"FeedbackTooltip__content",children:[T&&(0,s.jsx)(d.default,{stats:T,extendedStats:C,onExtendedStatsPreviewClick:this.onExtendedStatsPreviewClick,onSettingsBtnClick:this.onSettingsBtnClick,onPrivacyHintHide:this.onPrivacyHintHide}),M&&(0,s.jsx)(c.default,{replies:M,showMore:m}),L&&(0,s.jsx)(_.default,{poll:L}),P&&(0,s.jsx)(a.default,{showMessage:t,storyUrl:p,questions:P,sendNavigationStatEvents:i,onQuestionRemove:this.onQuestionRemove}),I&&(0,s.jsx)(h.default,{viewers:I,reactionSet:E,isLoading:b,needSeparator:!e.questions}),Boolean(null==I?void 0:I.nextFrom)&&(0,s.jsx)("div",{className:"FeedbackTooltip__sentinel",ref:this.viewsSentinelRef})]})}),C&&k&&(0,s.jsxs)(o.Fragment,{children:[(0,s.jsxs)("div",{className:"FeedbackTooltip__header FeedbackSeparator FeedbackSeparator--bottom",children:[(0,s.jsxs)("div",{className:"FeedbackTooltip__back",onClick:this.onBackBtnClick,children:[(0,s.jsx)("div",{className:"FeedbackTooltip__backIcon",children:(0,s.jsx)(w.Icon24ChevronCompactLeft,{})}),g.getLang("global_back")]}),g.getLang("stories_detailed_stats")]}),(0,s.jsx)("div",{className:"FeedbackTooltip__inner",ref:this.scrollContainerRef,children:(0,s.jsxs)("div",{className:"FeedbackTooltip__content",children:[C.achievement&&(0,s.jsx)("div",{className:"FeedbackTooltip__achievement",children:(0,s.jsx)(n.default,{appearance:"achievement",title:C.achievement,subtitle:C.achievementSubtitle})}),C.categories.map(((e,t)=>(0,s.jsx)(l.default,{title:e.title,children:(0,s.jsx)("div",{className:"FeedbackTooltip__lines",children:e.lines.map(((e,t)=>(0,s.jsxs)("div",{className:"FeedbackTooltip__line",children:[(0,s.jsx)("div",{className:"FeedbackStatName",children:(0,v.decodeHTMLEntities)(e.name)}),(0,s.jsx)("div",{className:"FeedbackStatCounter",dangerouslySetInnerHTML:{__html:e.counter}})]},t)))})},t)))]})})]})]})]})})}componentDidMount(){const{feedback:e,storyRawId:t,onFetchFeedbackData:i}=this.props;if(this.mounted=!0,e)return this.observeTitleChanges(),void this.observeViewerScrollIfNeeded();window.ajax.post("al_stories.php",{act:"get_feedback",story_raw:t},{onDone:e=>{this.mounted&&i(e)},onFail:()=>((0,m.showFastBox)(g.getLang("global_error"),g.getLang("global_unknown_error")),this.close(),!0)})}componentDidUpdate(e,t){!e.feedback&&this.props.feedback&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded()),!t.extendedStatsActive&&this.state.extendedStatsActive?this.observeTitleChanges():t.extendedStatsActive&&!this.state.extendedStatsActive&&(this.observeTitleChanges(),this.observeViewerScrollIfNeeded())}componentWillUnmount(){this.unObserveTitleChanges(),this.unObserveViewerScroll(),this.mounted=!1}loadViewers(){var e;const{storyRawId:t,feedback:i,onFetchViewers:s}=this.props,{isViewersLoading:o}=this.state;o||(null==i||null==(e=i.viewers)?void 0:e.nextFrom)&&(this.setState({isViewersLoading:!0}),window.ajax.post("al_stories.php",{act:"get_viewers",story_raw:t,offset:i.viewers.nextFrom},{onDone:e=>{s(e),this.setState({isViewersLoading:!1})},onFail:()=>((0,m.showFastBox)(g.getLang("global_error"),g.getLang("global_unknown_error")),this.setState({isViewersLoading:!1}),!0)}))}observeViewerScrollIfNeeded(){var e;const{feedback:t}=this.props;if(null==t||null==(e=t.viewers)?void 0:e.nextFrom){const e=this.scrollContainerRef.current,t=this.viewsSentinelRef.current;if(!t)return;this.viewsObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.intersectionRatio>0&&this.loadViewers()}))}),{threshold:[0,1],root:e,rootMargin:"0px 0px 336px 0px"}),this.viewsObserver.observe(t)}}unObserveViewerScroll(){this.viewsObserver&&this.viewsObserver.disconnect()}observeTitleChanges(){const e=this.scrollContainerRef.current;e&&(this.updateTitles(),this.onScrollHandler=(0,p.debounce)((()=>{!this.titles.some(((e,t)=>{if(e.offsetTop)return e===this.activeHeader||this.setActiveHeader(e),!0;if(this.titles[t+1]){const i=this.titles[t+1],s=this.titles[t+1].parentElement,o=s&&s.offsetHeight;return!!o&&(i.offsetTop+i.offsetHeight===o&&(e===this.activeHeader||this.setActiveHeader(e),!0))}return!1}))&&this.activeHeader&&(this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=null)}),5),e.addEventListener("scroll",this.onScrollHandler))}updateTitles(){const e=this.scrollContainerRef.current;e&&(this.titles=Array.from(e.querySelectorAll(".FeedbackTitle")),this.titles.reverse())}unObserveTitleChanges(){this.scrollContainerRef.current&&this.onScrollHandler&&this.scrollContainerRef.current.removeEventListener("scroll",this.onScrollHandler),this.onScrollHandler=null,this.titles=[]}setActiveHeader(e){this.activeHeader&&this.activeHeader.classList.remove("FeedbackTitle--active"),this.activeHeader=e,e.classList.add("FeedbackTitle--active")}constructor(e){super(e),this.onQuestionRemove=e=>{this.props.onQuestionRemove(e)},this.close=()=>{this.props.toggleFeedbackTooltip(!1)},this.onSettingsBtnClick=()=>{this.props.sendNavigationStatEvents("go_to_settings")},this.onPrivacyHintHide=()=>{this.props.onPrivacyHintHide()},this.onExtendedStatsPreviewClick=()=>{const{sendNavigationStatEvents:e}=this.props;this.unObserveViewerScroll(),this.unObserveTitleChanges(),this.setState({extendedStatsActive:!0}),e("open_advanced_statistic")},this.onBackBtnClick=()=>{this.unObserveTitleChanges(),this.setState({extendedStatsActive:!1})},this.state={isViewersLoading:!1,extendedStatsActive:!1},this.mounted=!1,this.scrollContainerRef=(0,o.createRef)(),this.viewsSentinelRef=(0,o.createRef)(),this.titles=[],this.viewsObserver=null,this.activeHeader=null,this.onScrollHandler=null}}const f=S},54445:(e,t,i)=>{i.d(t,{default:()=>a});var s=i(785893),o=i(833239),r=i(910434),n=i(384354);const a=({viewers:e,isLoading:t=!1,needSeparator:i=!0,reactionSet:a})=>(0,s.jsxs)(n.default,{className:"FeedbackViewersBlock",title:e.title,needSeparator:i,children:[e.hiddenReason&&(0,s.jsx)("span",{className:"FeedbackViewersBlock__hiddenReason",children:e.hiddenReason}),(0,s.jsx)("div",{className:"FeedbackViewersBlock__items",children:e.items.map(((e,t)=>(0,s.jsx)(o.default,{user:e,reactionSet:a},t)))}),t&&(0,s.jsx)("div",{className:"FeedbackViewersBlock__spinner",children:(0,s.jsx)(r.default,{size:18,color:"#6590c7",strokeWidth:2})})]})},464281:(e,t,i)=>{i.d(t,{default:()=>r});var s=i(785893),o=i(659397);const r=({title:e,subtitle:t,appearance:i="preview"})=>(0,s.jsxs)("div",{className:`InfoAside InfoAside--${i}`,children:[(0,s.jsx)("div",{className:"InfoAside__image"}),(0,s.jsxs)("div",{className:"InfoAside__description",children:[(0,s.jsx)("span",{className:"InfoAside__title",children:(0,o.decodeHTMLEntities)(e)}),(0,s.jsx)("span",{className:"InfoAside__subtitle",children:(0,o.decodeHTMLEntities)(t)})]})]})},590517:(e,t,i)=>{i.d(t,{default:()=>h});var s=i(785893),o=i(682615),r=i(29271),n=i(379610),a=i(95432),l=i(538131),d=i(659397);function c(e){let t="";if(e.type===l.PollBackgroundType.photo)t=`#${e.backgroundColor}`;else if(e.type===l.PollBackgroundType.gradient){t=`linear-gradient(${e.angle-90}deg, ${e.points.map((e=>`#${e.color} ${Math.round(100*e.position)}%`)).join(", ")})`}return t}function _(e){const{ownerId:t,pollId:i,needShowResults:s}=e;s?(0,a.showWiki)({w:`poll${t}_${i}`},!1,void 0,{customRef:"story"}):(0,n.showPollBox)(i,{ref:"story",className:"story_poll"})}const h=({poll:e})=>{const t=function(e){const{background:t}=e;return(0,s.jsx)("div",{className:"PollSnippet__background",style:{background:c(t)},children:t.type===l.PollBackgroundType.photo&&(0,s.jsx)("div",{className:"PollSnippet__photo",style:{backgroundImage:`url(${t.photoUrl})`}})})}(e);return(0,s.jsxs)("div",{className:(0,o.classNames)("PollSnippet",{"PollSnippet--default":e.background.type===l.PollBackgroundType.default}),children:[t,(0,s.jsx)("div",{className:"PollSnippet__question",children:(0,d.decodeHTMLEntities)(e.question)}),(0,s.jsx)("div",{className:"PollSnippet__countVoters",children:(0,d.decodeHTMLEntities)(e.votersCountText)}),(0,s.jsx)("div",{className:"PollSnippet__showResult",onClick:_.bind(null,e),children:r.getLang("stories_voting_show_result")})]})}},392845:(e,t,i)=>{i.d(t,{default:()=>m});var s=i(785893),o=i(667294),r=i(589448),n=i(589897),a=i(816328),l=i(682615),d=i(29271),c=i(659397),_=i(82161),h=i(953908),u=i(965109),p=i(492496);class m extends o.Component{constructor(e){super(e),this.componentDidMount=()=>{const e=this.questionTextEl.current;e&&this.adjustQuestionTextSize(e)},this.componentDidUpdate=()=>{this.replyTextareaEl.current&&this.replyTextareaEl.current.focus()},this.render=()=>{const{isOpenReplyModal:e,replyText:t}=this.state,{question:i,storyUrl:o}=this.props,{author:a,canAnswer:_,text:h}=i,u=(0,c.decodeHTMLEntities)(h),p=(0,l.classNames)("StoryQuestion__title",{"StoryQuestion__title--free":!_});return(0,s.jsxs)("div",{className:"StoryQuestion",children:[(0,s.jsxs)("div",{className:"StoryQuestion__content",children:[this.renderAuthor(),(0,s.jsx)("span",{className:p,title:u,ref:this.questionTextEl,children:u})]}),(0,s.jsx)("div",{className:"StoryQuestion__controls",children:_&&(0,s.jsx)(n.default,{className:"StoryQuestion__reply",mode:i.isPublished?"secondary":"primary",size:"s",stretched:!0,onClick:this.openReplyModal,children:d.getLang("stories_question_reply")})}),e&&(0,s.jsx)(r.default,{title:d.getLang("stories_question_reply_box_title").replace("{name}",(0,c.decodeHTMLEntities)(a.nameDat)),actionButtons:this.getReplyModalActions(),className:"StoryQuestion__replyModal",onClose:this.closeReplyModal,appearance:"blue",children:(0,s.jsxs)("div",{className:"StoryQuestion__inner",children:[(0,s.jsx)("textarea",{ref:this.replyTextareaEl,className:"StoryQuestion__textarea",placeholder:d.getLang("stories_question_reply_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown,value:t}),(0,s.jsx)("img",{srcSet:o,className:"StoryQuestion__image"})]})})]})},this.renderAuthor=()=>{const{id:e,isAnonymous:t,author:i}=this.props.question,o="StoryQuestion__author",r=(0,c.decodeHTMLEntities)(i.name);return(0,s.jsxs)("div",{className:"StoryQuestion__header",children:[t&&(0,s.jsx)("span",{className:o,children:r}),!t&&(0,s.jsx)("a",{href:i.link,className:o,onClick:()=>window.cur.storyLayer.sendNavigationStatEvents("question_go_to_author",!0,{questionId:e}),children:r}),(0,s.jsx)(a.default,{position:"b",align:"right",trigger:"hover",data:this.getActions(),children:(0,s.jsx)("span",{className:"StoryQuestion__actions",children:(0,s.jsx)(p.Icon20Dropdown,{})})})]})},this.getActions=()=>{const{question:e}=this.props,{isAuthorBan:t}=this.state,i=[{text:d.getLang("stories_question_delete"),onClick:()=>this.props.removeQuestion(e)}];return e.canBlocked&&(t?i.push({text:d.getLang("stories_question_author_unban"),onClick:this.unbanAuthor}):i.push({text:d.getLang("stories_question_author_ban"),onClick:this.banAuthor}),i.push({text:d.getLang("stories_question_author_report"),onClick:this.showReportForm})),i},this.adjustQuestionTextSize=e=>{if(e.scrollHeight>e.offsetHeight){const t=getComputedStyle(e),i=parseInt(t.fontSize)-.5,s=i+2.5,o=Math.floor(parseInt(t.height)/s);i>10&&(e.setAttribute("style",`font-size: ${i}px; line-height: ${s}px; -webkit-line-clamp: ${o};`),setTimeout((()=>{this.adjustQuestionTextSize(e)}),0))}},this.getReplyModalActions=()=>{const{isReplyButtonLoading:e,replyText:t}=this.state;return[(0,s.jsx)(n.default,{size:"m",mode:"tertiary",onClick:this.closeReplyModal,children:d.getLang("global_cancel")},"closeReplyModal"),(0,s.jsx)(n.default,{size:"m",mode:"primary",loading:e,disabled:!(0,_.trim)(t),onClick:this.sendReply,children:d.getLang("stories_question_reply_send")},"replySend")]},this.openReplyModal=()=>{this.setState({isOpenReplyModal:!0})},this.closeReplyModal=()=>{this.setState({isOpenReplyModal:!1})},this.handleChange=e=>{this.setState({replyText:e.target.value})},this.handleKeyDown=e=>{const{replyText:t}=this.state;(0,_.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==h.KEY.RETURN&&this.sendReply()},this.resetReplyText=()=>{this.setState({replyText:""})},this.sendReply=()=>{const{replyText:e}=this.state,{question:t,showMessage:i}=this.props,{text:s,id:o,ownerId:r,storyOwnerId:n,storyId:a,sendHash:l}=t,c=`${e}\n\n🗣 ${(0,_.unclean)(s)}`,h=`story:${n}_${a}`;window.ajax.post("al_im.php",{act:"a_send",msg:c,hash:l,media:h,to:r,entrypoint:"stories_comment"},{onDone:()=>{this.closeReplyModal(),this.resetReplyText(),i(d.getLang("stories_answer_sent")),window.cur.storyLayer.sendNavigationStatEvents("question_send_message",!0,{questionId:o})},onFail:e=>(this.closeReplyModal(),this.resetReplyText(),i(e),!0),showProgress:()=>this.setState({isReplyButtonLoading:!0}),hideProgress:()=>this.setState({isReplyButtonLoading:!1})})},this.banAuthor=()=>{const{question:e,showMessage:t}=this.props,{storyOwnerId:i,storyId:s,id:o,banHash:r,isAnonymous:n}=e;window.ajax.post("al_stories.php",{act:"ban_author_question",story_owner_id:i,story_id:s,question_id:o,ban_hash:r},{onDone:()=>{this.setState({isAuthorBan:!0}),t(d.getLang("stories_question_author_blocked"));let e="question_ban_author";n&&(e="question_ban_anonymous_author"),window.cur.storyLayer.sendNavigationStatEvents(e,!0,{questionId:o})},onFail:e=>(t(e),!0)})},this.unbanAuthor=()=>{const{question:e,showMessage:t}=this.props,{storyOwnerId:i,storyId:s,id:o,banHash:r}=e;window.ajax.post("al_stories.php",{act:"unban_author_question",story_owner_id:i,story_id:s,question_id:o,ban_hash:r},{onDone:()=>{this.setState({isAuthorBan:!1}),t(d.getLang("stories_question_author_unblocked"))},onFail:e=>(t(e),!0)})},this.showReportForm=()=>{(0,u.showReportForm)("story_question",this.props.question.ownerId,this.props.question.id,(()=>this.props.showMessage(d.getLang("stories_report_sent"))))},this.state={isAuthorBan:e.question.isOwnerBlocked,replyText:"",isOpenReplyModal:!1,isReplyButtonLoading:!1,isReportButtonLoading:!1,selectReasons:0},this.replyTextareaEl=(0,o.createRef)(),this.questionTextEl=(0,o.createRef)()}}},211365:(e,t,i)=>{i.d(t,{default:()=>l});var s=i(785893),o=i(682615),r=i(10781),n=i(659397);function a(e){return e.items.some((e=>e.unread))}const l=({storyPack:e,listName:t,source:i})=>(0,s.jsxs)("a",{href:e.author.href,className:(0,o.classNames)("StoryReply",{"StoryReply--new":a(e)}),onClick:s=>{s.metaKey||s.ctrlKey||((0,r.showStory)(`${e.author.id}/${t}`,{fromEl:s.target,source:i}),s.preventDefault())},role:"button",children:[(0,s.jsx)("div",{className:"StoryReply__avatar",children:(0,s.jsx)("div",{className:"StoryReply__image",style:{backgroundImage:`url(${e.author.photo})`}})}),(0,s.jsx)("div",{className:"StoryReply__caption",children:(0,n.decodeHTMLEntities)(e.author.firstName)})]})},833239:(e,t,i)=>{i.d(t,{default:()=>c});var s=i(785893),o=i(328415),r=i(682615),n=i(659397),a=i(822715),l=i(839470),d=i(514995);const c=({user:e,reactionSet:t})=>{const i=(0,n.decodeHTMLEntities)(e.name),c=(0,l.partConfigEnabled)("avatar_component_refactor_web");let _;var h;t&&null!=e.reaction_id&&(_=null==(h=(0,a.getReaction)(t,e.reaction_id))?void 0:h.imageStoryPreviewURL);return(0,s.jsxs)("a",{href:e.url,className:"Viewer",role:"button",children:[c&&(0,s.jsx)(d.AvatarRich,{src:e.photoUrl,isNFT:Boolean(e.nft),size:40,wrapperClassName:(0,r.classNames)("Viewer__avatar",{"Viewer__avatar--isLiked":e.isLiked&&!_}),badge:_?(0,s.jsx)("div",{className:"Viewer__reaction Viewer__reaction--nft",style:{backgroundImage:`url(${_})`}}):void 0}),!c&&(0,s.jsxs)("div",{className:(0,r.classNames)("Viewer__avatar",{"Viewer__avatar--isLiked":e.isLiked&&!_}),title:i,children:[(0,s.jsx)("img",{className:"Viewer__img",src:e.photoUrl,alt:i}),Boolean(_)&&(0,s.jsx)("div",{className:"Viewer__reaction",style:{backgroundImage:`url(${_})`}})]}),(0,s.jsx)(o.default,{className:"Viewer__name",isVerified:e.isVerified,children:i})]})}},538131:(e,t,i)=>{var s;i.d(t,{PollBackgroundType:()=>s}),function(e){e.photo="photo",e.gradient="gradient",e.default="default"}(s||(s={}))},914263:(e,t,i)=>{i.d(t,{MetaStory:()=>_});var s=i(785893),o=i(667294),r=i(664988),n=i(365035),a=i(659397),l=i(592129),d=i(983745),c=i(625533);class _ extends o.Component{render(){const{metaStoryInfo:e,list:t,listName:i,source:o}=this.props,{isScrolling:r}=this.state,n=!t||!t.length;return(0,s.jsxs)("div",{className:"MetaStory",children:[(0,s.jsx)("div",{className:"MetaStory__infoWrapper",style:{paddingBottom:"286px"},ref:this.infoRef,children:(0,s.jsx)("div",{className:"MetaStory__info",children:e})}),(0,s.jsx)("div",{className:(0,a.classNames)("MetaStory__pane",{"MetaStory__pane--scrolling":r}),children:(0,s.jsxs)(c.default,{className:(0,a.classNames)("MetaStory__container",{"MetaStory__container--isEmpty":n}),hasMore:this.hasMore(),loadMore:this.loadMore,onScroll:this.onScroll,threshold:500,spinnerColor:"#fff",children:[(0,s.jsxs)("div",{className:"MetaStory__navigation",onMouseDown:this.onClickableAreaMouseDown,onMouseUp:this.onClickableAreaMouseUp,children:[(0,s.jsx)("div",{className:"MetaStory__navigationArea MetaStory__navigationArea--back"}),(0,s.jsx)("div",{className:"MetaStory__navigationArea MetaStory__navigationArea--next"})]}),(0,s.jsxs)("div",{className:"MetaStory__grid",style:{minHeight:"calc(100% - 286px"},children:[t&&t.map((e=>(0,s.jsx)(l.MetaStoryItemPreview,{block:e,list:t,listName:i,source:o},e.id))),n&&[...Array(9)].map(((e,t)=>(0,s.jsx)(d.MetaStoryItemPreviewSkeleton,{},t)))]})]})})]})}componentWillUnmount(){clearTimeout(this.longTapTimer)}hasMore(){return!!this.props.hasMore&&this.props.hasMore()}constructor(e){super(e),this.infoRef=(0,o.createRef)(),this.onScroll=e=>{if(this.infoRef.current){var t,i;const s=e.currentTarget,o=Boolean(s.scrollTop),r=o?Math.min(s.scrollTop/286,1):0;null==(i=(t=this.props).onTopScrolled)||i.call(t,r>=1),this.props.onScroll(o),this.setState({isScrolling:o}),o?this.props.pause():this.props.play();const n=.6,a=o?Math.max(n-r,0):1;this.infoRef.current.style.opacity=`${a}`}},this.onClickableAreaMouseDown=()=>{this.downTs=(0,r.vkNow)(),this.longTapTimer=setTimeout(this.props.onLongTap,n.LONG_PRESS_DELAY_MS)},this.onClickableAreaMouseUp=e=>{clearTimeout(this.longTapTimer);const t=e.target,i=!((0,r.vkNow)()-this.downTs<n.LONG_PRESS_DELAY_MS);if(t.classList.contains("MetaStory__navigationArea--back")&&!i)return this.props.playPrevStory();i?this.props.isPaused()&&this.props.play(!1,!!this.downTs):this.props.playNextStory()},this.loadMore=()=>this.props.loadMore?this.props.loadMore():Promise.resolve(),this.state={isScrolling:!1}}}},934346:(e,t,i)=>{i.d(t,{MetaStoryInfo:()=>r});var s=i(785893),o=i(659397);const r=({header:e,subheader:t,url:i,urlText:r,icon:n})=>{const a=(0,s.jsxs)(s.Fragment,{children:[n&&"string"==typeof n&&(0,s.jsx)("div",{className:"MetaStoryInfo__icon",style:{backgroundImage:`url(${n})`}}),n&&"object"==typeof n&&(0,s.jsx)("div",{className:"MetaStoryInfo__icon MetaStoryInfo__icon--inline",children:n}),(0,s.jsx)("div",{className:"MetaStoryInfo__header",children:(0,o.decodeHTMLEntities)(e)}),t&&(0,s.jsx)("div",{className:"MetaStoryInfo__subheader",children:(0,o.decodeHTMLEntities)(t)}),i&&r&&(0,s.jsx)("div",{className:"MetaStoryInfo__pseudoLink",children:r})]});return i?(0,s.jsx)("a",{href:i,className:"MetaStoryInfo",target:"_blank",children:a}):(0,s.jsx)("div",{className:"MetaStoryInfo",children:a})}},592129:(e,t,i)=>{i.d(t,{MetaStoryItemPreview:()=>_});var s=i(434788),o=i(785893),r=i(667294),n=i(659397),a=i(964262),l=i(517366),d=i(839470),c=i(514995);class _ extends r.Component{render(){var e;const{block:t,className:i}=this.props,{isFullImageLoadedMap:s}=this.state;let r=this.getCurrentStory(),a=r.unread,_="",h=Boolean(null==(e=t.author)?void 0:e.nft),u=r.type===l.StoryType.LIVE;const p=(0,d.partConfigEnabled)("avatar_component_refactor_web");let m;return u?m=c.AvatarRichOutlineType.LIVE:a&&(m=c.AvatarRichOutlineType.STORIES_UNSEEN),_=s[r.raw_id]||!r.preview_url?r.small_preview:r.preview_url,(0,o.jsx)("span",{className:(0,n.classNames)("MetaStoryItemPreview",{"MetaStoryItemPreview--live":u},"MetaStoryItemPreviewLayout",i),onClick:this.onClick,children:t.author&&(0,o.jsxs)("div",{className:"MetaStoryItemPreview__inner",children:[(0,o.jsx)("img",{src:_,className:"MetaStoryItemPreview__image",alt:"",loading:"lazy"}),p&&(0,o.jsx)(c.AvatarRich,{src:t.author.photo,href:t.author.href,isNFT:h,size:28,outlineType:m,wrapperClassName:"MetaStoryItemPreview__avatar"}),!p&&(0,o.jsx)("a",{href:t.author.href,className:(0,n.classNames)("MetaStoryItemPreview__author",{"MetaStoryItemPreview__author--unread":a}),style:{backgroundImage:`url('${t.author.photo}')`}}),(0,o.jsx)("span",{className:"MetaStoryItemPreview__title",children:(0,n.decodeHTMLEntities)(t.author.name)})]})})}componentDidMount(){this.isMount=!0,this.loadCurrentStoryPreviewIfNeeded()}componentDidUpdate(){this.loadCurrentStoryPreviewIfNeeded()}loadCurrentStoryPreviewIfNeeded(){const e=this.getCurrentStory();if(e.raw_id===this.currentStoryRawId)return;if(this.currentStoryRawId=e.raw_id,this.state.isFullImageLoadedMap[e.raw_id])return;const t=new Image;t.src=e.small_preview,t.onload=()=>this.onImageLoad(e.raw_id)}getCurrentStory(){const{block:e}=this.props;let t=e.items.find((e=>e.unread));return t||(t=e.items[0]),t}constructor(e){super(e),this.isMount=!1,this.currentStoryRawId="",this.onClick=e=>{const{source:t}=this.props;window.Stories.show(`${(0,a.getStoryBlockKey)(this.props.block)}/${this.props.listName}`,{fromEl:e.target,source:t},this.props.list)},this.onImageLoad=e=>{const{isFullImageLoadedMap:t}=this.state;this.isMount&&(t[e]||this.setState({isFullImageLoadedMap:(0,s._)({},t,{[e]:!0})}))},this.state={isFullImageLoadedMap:{}}}}},983745:(e,t,i)=>{i.d(t,{MetaStoryItemPreviewSkeleton:()=>o});var s=i(785893);const o=()=>(0,s.jsx)("div",{className:"MetaStoryItemPreviewSkeleton MetaStoryItemPreviewLayout",children:(0,s.jsxs)("div",{className:"MetaStoryItemPreviewSkeleton__inner",children:[(0,s.jsx)("div",{className:"MetaStoryItemPreviewSkeleton__author"}),(0,s.jsx)("div",{className:"MetaStoryItemPreviewSkeleton__title"})]})})},75869:(e,t,i)=>{i.d(t,{ReactionsPanel:()=>n});var s=i(785893),o=i(814323),r=i(682615);const n=({className:e,stickers:t,onStickerClick:i,title:n})=>{const a=e=>{o.StickersAnimation.loadAndPlaySticker(e.currentTarget)};return(0,s.jsx)("div",{className:(0,r.classNames)("ReactionsPanel",e),children:(0,s.jsxs)("div",{className:"ReactionsPanel__container",children:[Boolean(n)&&(0,s.jsx)("div",{className:"ReactionsPanel__title",children:n}),(0,s.jsx)("div",{className:"ReactionsPanel__items",children:t.map(((e,t)=>((e,t)=>{const o=e.animationUrl?"sticker_img":"";return(0,s.jsx)("div",{className:"ReactionsPanel__item","data-pack-id":e.packId,"data-sticker-id":e.id,"data-uniq-id":e.uniqId,"data-animation-path":e.animationUrl,"data-animation-class":"ReactionsPanel__itemAnimation",onMouseDown:()=>i(e.id,t),onMouseEnter:a,children:(0,s.jsx)("div",{className:(0,r.classNames)("ReactionsPanel__itemImage",o),style:{backgroundImage:`url(${e.imageUrl})`}})},e.id)})(e,t)))})]})})}},329462:(e,t,i)=>{i.d(t,{StickerItem:()=>E});var s=i(434788),o=i(785893),r=i(667294),n=i(530036),a=i(365035),l=i(659397),d=i(682615),c=i(29271),_=i(10781),h=i(95432),u=i(9480),p=i(866310),m=i(514986),g=i(650969),v=i(531730),y=i(898776),w=i(84543),S=i(839470),f=i(931917);class E extends r.Component{constructor(e){super(e),this.componentDidMount=()=>{const{sticker:e,story:t}=this.props;if(e.audioRestriction&&t.data.needMute&&t.video&&(t.video.muted=!0),this.playlist.on(this,p.events.ADDED,(()=>{this.props.showMessage(c.getLang("stories_audio_added")),this.props.playStory()})),this.playlist.on(this,p.events.REMOVED,(()=>{this.props.showMessage(c.getLang("stories_audio_deleted")),this.props.playStory()})),e.type===a.StickerTypes.marketItem&&(0,y.logViewMarketItemInStories)(e.link),(0,S.partConfigEnabled)("stories_share_playlist")){const t=e.audioHint||e.playlistHint,i=this.stickerRef.current;t&&i&&this.props.showHelpHint(t,i,{width:e.audioHint?156:191,type:w.default.TYPE_VERTICAL,forceSide:"bottom",align:"center",offset:[0,16],appendToParent:!0,withCloseButton:!1,autoAdjustToViewport:!0,noAutoHideOnWindowClick:!1,cls:"feature_intro_tt feature_intro_blue_tt"})}},this.componentWillUnmount=()=>{this.playlist.off(this),this.props.hideHelpHint()},this.render=()=>{const{story:e,sticker:t}=this.props,{needMute:i}=e.data,{audioRestriction:s}=t,n=(0,g.swapObject)(a.StickerTypes),l=v.ls.get("story_show_clickable_zones"),c=(0,d.classNames)("StorySticker",{"StorySticker--clickableZones":l});return(0,o.jsxs)(r.Fragment,{children:[(0,o.jsx)("div",{ref:this.stickerRef,"data-type":n[t.type],className:c,style:this.getStickerStyle(),onMouseDown:e=>this.props.onMouseDownHandle(e),onMouseUp:e=>this.props.onMouseUpHandle(e,(()=>this.handleClick(e)))}),s&&i&&this.renderRestriction()]})},this.renderRestriction=()=>{const{audioRestriction:e}=this.props.sticker;return e?(0,o.jsx)("div",{className:"StoryRestriction",children:(0,o.jsxs)("div",{className:"StoryRestriction__inner",children:[(0,o.jsx)("span",{className:"StoryRestriction__title",children:e.title}),e.buttonUrl&&(0,o.jsx)("a",{className:"StoryRestriction__link",href:e.buttonUrl,children:e.buttonText})]})}):null},this.getStickerStyle=()=>{const{sticker:e,originalWidth:t,originalHeight:i,widthViewBox:s,heightViewBox:o}=this.props,{top:r,left:n,width:a,height:l,rotate:d}=e;let c=s,_=o;return o/s>1.77?c=t*o/i:_=i*s/t,{top:r*_-(_-o)/2,left:n*c-(c-s)/2,width:a*c,height:l*_,transform:`rotate(${d}deg)`}},this.handleClick=e=>{const{sticker:t}=this.props;switch(t.type){case a.StickerTypes.hashtag:this.handleClickHashtag(e);break;case a.StickerTypes.mention:this.handleClickMention(e);break;case a.StickerTypes.question:this.handleClickQuestion();break;case a.StickerTypes.place:this.handleClickPlace(e);break;case a.StickerTypes.music:this.handleClickMusic(e);break;case a.StickerTypes.marketItem:this.handleClickMarketItem(e);break;case a.StickerTypes.storyReply:this.handleClickStoryReply(e);break;case a.StickerTypes.owner:this.handleClickOwner(e);break;case a.StickerTypes.link:this.handleClickLink(e);break;case a.StickerTypes.post:this.handleClickPost(e);break;case a.StickerTypes.poll:this.handleClickPoll();break;case a.StickerTypes.app:this.handleClickApp();break;case a.StickerTypes.sticker:this.handleClickSticker(e);break;case a.StickerTypes.situationalTheme:this.handleClickStickerSituationalTheme();break;case a.StickerTypes.playlist:this.handleClickPlaylist(e);break;case a.StickerTypes.videoButton:this.handleClickVideo(e)}},this.handleClickHashtag=e=>{const{hashtag:t}=this.props.sticker,i=t.replace("#","%23"),s=c.getLang("stories_show_hashtag_link"),r="hashtag",n=(0,o.jsx)("a",{href:`/feed?q=${i}&section=search`,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickMention=e=>{const{mentionedOwnerHref:t,mentionedText:i,mentionedPhotoUrl:s}=this.props.sticker,r="mention",n=(0,o.jsx)("a",{href:t,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link StoriesTooltip__link--mention",children:(0,o.jsxs)("div",{className:"StoriesTooltipMention",children:[(0,o.jsx)("div",{className:"StoriesTooltipMention__avatar",style:{backgroundImage:`url(${s})`}}),(0,o.jsx)("span",{className:"StoriesTooltipMention__text",children:(0,l.decodeHTMLEntities)(i)})]})});this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickQuestion=()=>{this.props.showQuestionModal(),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"question"}})},this.handleClickPlace=e=>{const{sticker:t,list:i}=this.props,{placeId:s}=t,r=c.getLang("stories_go_to_place"),n="place";if(window.layerQueue.count()||i.includes("archive")){const t="/feed?section=search&w=place"+s,i=(0,o.jsx)("a",{href:`${t}`,onClick:()=>this.onClickToTooltip(n),target:"_blank",className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,i)}else{const t=()=>{this.onClickToTooltip(n),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),(0,h.showWiki)({w:"place"+s})},i=(0,o.jsx)("div",{className:"StoriesTooltip__link",onClick:t,children:r});this.props.toggleTooltip(e,i)}this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:t.id,type:n}})},this.handleClickMusic=e=>{const{story:t,sticker:i}=this.props,{needMute:s}=t.data,{audioId:r,audioData:n,audioRestriction:a}=i;if(a)return void(s||u.AudioUtils.showAudioRestriction(JSON.parse(n),{onShow:()=>{this.props.pauseStory()},onHide:()=>{this.props.playStory()}}));const l="added"===(u.AudioUtils.getAddRestoreInfo()[r]||{}).state?c.getLang("stories_audio_delete"):c.getLang("stories_audio_add"),d=(0,o.jsxs)("ul",{className:"StoriesTooltipActions _audio_row","data-audio":n,children:[(0,o.jsx)("li",{className:"StoriesTooltipActions__item",onClick:this.addAudio,children:l}),(0,o.jsx)("li",{className:"StoriesTooltipActions__item",onClick:this.setNext,children:c.getLang("stories_audio_next_audio")})]});this.props.toggleTooltip(e,d,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:i.id,type:"music"}})},this.handleClickPlaylist=e=>{const{playlistOwnerId:t,playlistId:i,playlistCreatorId:s,playlistFollowed:r}=this.props.sticker,n=window.vk.id===s,a=`${t}_${i}`,l=u.AudioUtils.getPlaylistAddRestoreInfo()[a]||{},d=l.state?"followed"===l.state:r,_=d?c.getLang("stories_playlist_unfollow"):c.getLang("stories_playlist_follow"),h=d?this.unfollowPlaylist:this.followPlaylist,p=(0,o.jsxs)("ul",{className:"StoriesTooltipActions",children:[!n&&(0,o.jsx)("li",{className:"StoriesTooltipActions__item",onClick:h,children:_}),(0,o.jsx)("li",{className:"StoriesTooltipActions__item",onClick:this.setNextPlaylist,children:c.getLang("stories_playlist_next")})]});this.props.toggleTooltip(e,p,"b"),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.handleClickMarketItem=e=>{const{photoUrl:t,link:i,isRestricted:r}=this.props.sticker,a="market_item",l=new URL(`${document.location.origin}${i}`).searchParams.get("w")?"&ref=stories":"",d=r?{onClick:()=>{(0,m.showFastBox)(c.getLang("stories_market_access_error_title"),c.getLang("stories_market_access_error_text")),this.onClickToTooltip(a)}}:{onClick:()=>this.onClickToTooltip(a),href:`${i}${l}`},_=(0,o.jsxs)("a",(0,s._)({},d,{target:"_blank",className:"StoriesTooltip__link",children:[t&&!r?(0,o.jsx)("img",{className:"StoriesTooltip__marketItemThumb",src:t,alt:""}):(0,o.jsx)("div",{className:"StoriesTooltip__marketItemThumb StoriesTooltip__marketItemThumb--stub",children:(0,o.jsx)(n.Icon20MarketOutline,{})}),(0,o.jsx)("span",{className:"StoriesTooltip__marketItemText",children:c.getLang("stories_go_to_market_item")})]}));this.props.toggleTooltip(e,_),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:a}})},this.handleClickStoryReply=e=>{const{sticker:t}=this.props,{ownerId:i,storyId:s,isExpired:r}=t,n="story_reply";if(r)return void this.handleClickOwner(e);const a=(0,o.jsx)("a",{className:"StoriesTooltip__link",onClick:()=>{const e=`${i}_${s}`;(0,_.showStory)(`story${e}/${e}/context:owner`),this.onClickToTooltip(n)},children:c.getLang("stories_go_to_story")});this.props.toggleTooltip(e,a),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:t.id,type:n}})},this.handleClickOwner=e=>{const{ownerId:t,link:i}=this.props.sticker,s=f.Ranges.isUserIdTransitional(t)?c.getLang("stories_go_to_profile"):c.getLang("stories_go_to_group"),r=(0,o.jsx)("a",{href:i,target:"_blank",className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,r)},this.handleClickLink=e=>{const{link:t,tooltipText:i}=this.props.sticker,s="link",r=(0,o.jsx)("a",{href:t,onClick:()=>this.onClickToTooltip(s),target:"_blank",className:"StoriesTooltip__link",children:i});this.props.toggleTooltip(e,r),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:s}})},this.handleClickPost=e=>{const{postOwnerId:t,postId:i}=this.props.sticker,s=c.getLang("stories_go_to_post"),r="post",n=(0,o.jsx)("a",{href:`/wall${t}_${i}`,onClick:()=>this.onClickToTooltip(r),target:"_blank",className:"StoriesTooltip__link",children:s});this.props.toggleTooltip(e,n),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:r}})},this.handleClickPoll=()=>{const{pollId:e}=this.props.sticker;this.props.pauseStory();let t={act:"get_layout",voting_id:e,ref:"story",for_box:!0},i={containerClass:"story_poll",params:{hideButtons:!0,width:510,onDestroy:()=>{this.props.playStory()}}};(0,m.showBox)("al_voting.php",t,i),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"poll"}})},this.handleClickApp=()=>{this.props.markAppNotificationsSeen(this.props.sticker),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"app"}})},this.handleClickStickerSituationalTheme=()=>{const{situationalAppId:e,situationalThemeId:t}=this.props.sticker;window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),this.props.pauseStory(),(0,h.showWiki)({w:`app${e}#${t}`}),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"situational_theme"}})},this.addAudio=e=>{u.AudioUtils.addAudio(e.target,void 0,(()=>{this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})})),this.props.hideTooltip()},this.followPlaylist=e=>{const{playlistOwnerId:t,playlistId:i,playlistFollowHash:s}=this.props.sticker;u.AudioUtils.followPlaylist(e.target,t,i,s);const o=`${t}_${i}`;u.AudioUtils.getPlaylistAddRestoreInfo()[o]={state:"followed"},this.props.playStory(),this.props.hideTooltip(),this.props.sendNavigationStatEvents("music_added",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.unfollowPlaylist=e=>{const{playlistOwnerId:t,playlistId:i,playlistFollowHash:s}=this.props.sticker;u.AudioUtils.followPlaylist(e.target,t,i,s);const o=`${t}_${i}`;u.AudioUtils.getPlaylistAddRestoreInfo()[o]={state:"unfollowed"},this.props.playStory(),this.props.hideTooltip()},this.handleClickSticker=e=>{const{stickerPackId:t,tooltipText:i}=this.props.sticker,s=(0,o.jsx)("span",{onClick:this.onClickToStickerTooltip.bind(this,t),className:"StoriesTooltip__link",children:i});this.props.toggleTooltip(e,s),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:"sticker"}})},this.onClickToStickerTooltip=(e,t)=>{window.Emoji.previewSticker(e,this,!1,t),this.onClickToTooltip("sticker")},this.setNext=e=>{const t=JSON.parse(this.props.sticker.audioData||"{}"),i=u.AudioUtils.audioTupleToAudioObject(t);this.playlist.setNext(e.currentTarget.parentNode,i,t),this.props.story.data.isMusicCover||this.playlist.pause(),this.props.hideTooltip(),this.props.playStory(),this.props.sendNavigationStatEvents("play_next",!0,{clickable_sticker:{id:this.props.sticker.id,type:"music"}})},this.setNextPlaylist=()=>{const{playlistOwnerId:e,playlistId:t,playlistAccessHash:i}=this.props.sticker;this.playlist.setNextPlaylist(e,t,i),this.props.story.data.isMusicCover||this.playlist.pause(),this.props.hideTooltip(),this.props.playStory(),this.props.sendNavigationStatEvents("play_next",!0,{clickable_sticker:{id:this.props.sticker.id,type:"playlist"}})},this.onClickToTooltip=e=>{this.props.sendNavigationStatEvents("click_to_tooltip",!0,{clickable_sticker:{id:this.props.sticker.id,type:e}})},this.handleClickVideo=e=>{const{videoOwnerId:t,videoId:i,videoType:s,tooltipText:r}=this.props.sticker,n=`/${s}${t}_${i}`,a="video";if("clip"===s){const t=(0,o.jsx)("a",{href:n,onClick:()=>this.onClickToTooltip(a),target:"_blank",className:"StoriesTooltip__link",children:r});this.props.toggleTooltip(e,t),this.props.sendNavigationStatEvents("click_on_clickable_sticker",!0,{clickable_sticker:{id:this.props.sticker.id,type:a}})}},this.stickerRef=(0,r.createRef)(),this.playlist=(0,h.getAudioPlayer)()}}},604632:(e,t,i)=>{i.d(t,{StickerTooltip:()=>a});var s=i(785893),o=i(667294),r=i(973935),n=i(682615);const a=({clientX:e=0,clientY:t=0,position:i="t",layerEl:a,children:l})=>{const d=(0,n.classNames)("StoriesTooltip",`StoriesTooltip--${i}`);return(0,s.jsx)(o.Fragment,{children:r.createPortal((0,s.jsx)("div",{className:d,style:{top:t,left:e},children:l}),a)})}},102499:(e,t,i)=>{i.d(t,{StoryBottom:()=>U});var s,o=i(434788),r=i(785893),n=i(95432),a=i(667294),l=i(145298),d=i(920934),c=i(75869),_=i(365035),h=i(472207),u=i(809915),p=i(96756),m=i(10781),g=i(795558),v=i(953908),y=i(29271),w=i(320422),S=i(82161),f=i(970978),E=i(659397),b=i(566631),k=i(936739),T=i(74106),C=i(898366),M=i(611695),L=i(729400),P=i(738219),I=i(668088),A=i(763242),B=i(427323),D=i(52373),x=i(752654),O=i(429697),N=i(964262),R=i(908088),F=i(711680);!function(e){e[e.STEP_LEFT=0]="STEP_LEFT",e[e.STEP_RIGHT=1]="STEP_RIGHT",e[e.STEP_PAUSE=2]="STEP_PAUSE"}(s||(s={}));class U extends a.Component{componentDidMount(){this.emojiInit(),this.isMount=!0,requestAnimationFrame((()=>{this.startLinkArrowAnimation()}))}componentWillUnmount(){this.isMount=!1,this.emojiId&&(window.Emoji.destroy(this.emojiId),delete this.emojiId)}componentDidUpdate(e,t){const{isMessageFormExpanded:i,sendFormFocused:s}=this.state;this.emojiInit(),!t.isMessageFormExpanded&&i?(window.Emoji.focus(this.refs.messageInput),this.pauseLinkArrowAnimation()):t.isMessageFormExpanded&&!i&&this.startLinkArrowAnimation(),(0,N.isNewDesignEnabled)()&&t.sendFormFocused!==s&&this.setState({isNewMessageFormActiveAnimating:!0})}render(){if((0,N.isNewDesignEnabled)())return this.renderByNewDesign();const{story:e}=this.props,t=this.props.story.getCurStoryData();if(!e.story||!t)return"";const i={left_side_empty:this.leftSideIsEmpty()},{canLike:s,canAddToNarrative:o,reaction_set_id:n}=t,c=e.getSticker(_.StickerTypes.app),h=this.needShowSendFormSeparately();let u;return null!=n&&(u=(0,R.getReactionSet)(n)),(0,r.jsx)(a.Fragment,{children:(0,r.jsx)("div",{className:(0,E.classNames)("stories_story_bottom",i),children:(0,r.jsxs)("div",{className:"stories_story_bottom_controls StoryBottomControls",children:[(s||c||h)&&(0,r.jsxs)("div",{className:"StoryBottom__line StoryBottom__line--2",children:[h&&(0,r.jsxs)(r.Fragment,{children:[this.renderMessageButton(),this.renderMessageForm()]}),s&&this.renderLike(),!s&&c&&this.renderAppButton()]}),c&&s&&(0,r.jsx)("div",{className:"StoryBottom__line StoryBottom__line--3",children:this.renderAppButton()}),(0,r.jsx)(d.ViewsButton,{className:"StoryBottomControl",story:e,reactionSet:u}),!h&&this.renderMessageForm(),this.renderLink(),o&&this.renderAddToNarrativeBtn(),this.renderShare(),(0,r.jsx)(l.ActionsButton,{story:e})]})})})}renderByNewDesign(){const{story:e}=this.props,t=this.props.story.getCurStoryData(),{isMessageFormExpanded:i}=this.state;if(!e.story||!t)return"";const{isFeedbackTooltipShow:s,toggleFeedbackTooltip:o,onFetchFeedbackData:n,onFetchViewers:a,onQuestionRemove:l,feedback:c,showMoreReplies:_,onPrivacyHintHide:h}=e,{needShowEmptyStats:u,small_preview:p,canLike:m,canAddToNarrative:g,reaction_set_id:v}=t,y=e.getRawId(),w=e.showMessage.bind(e),S=e.layer.sendNavigationStatEvents.bind(e.layer);let f;return null!=v&&(f=(0,R.getReactionSet)(v)),(0,r.jsxs)("div",{className:"StoryBottom",children:[(0,r.jsx)(O.default,{in:!i,classNames:{enter:"StoryBottom__panels--enter",enterActive:"StoryBottom__panels--enterActive",exitActive:"StoryBottom__panels--exitActive",exit:"StoryBottom__panels--exit"},addEndListener:(e,t)=>{e.addEventListener("transitionend",(e=>{e.target===e.currentTarget&&t()}),!1)},unmountOnExit:!0,children:(0,r.jsxs)("div",{className:"StoryBottom__panels",children:[m&&(0,r.jsx)("div",{className:"StoryBottom__floor StoryBottom__floor--2",children:this.renderLike()}),(0,r.jsxs)("div",{className:"StoryBottom__floor StoryBottom__floor--1",children:[(0,r.jsx)(d.ViewsButton,{className:"StoryViewerBottomControl StoryViewerBottomControl--feedback",story:e,reactionSet:f}),this.renderLink(),this.renderNewMessageButton(),g&&this.renderAddToNarrativeBtn(),this.renderShare()]})]})}),this.renderMessageForm(),(0,r.jsx)(O.default,{in:s,timeout:200,classNames:{enter:"FeedbackTooltipTransitionWrapper--enter",enterActive:"FeedbackTooltipTransitionWrapper--enterActive",exit:"FeedbackTooltipTransitionWrapper--exit",exitActive:"FeedbackTooltipTransitionWrapper--exitActive"},unmountOnExit:!0,children:(0,r.jsx)(F.default,{className:"StoryBottom__feedback",feedback:c,reactionSet:f,storyRawId:y,storyImageUrl:p,toggleFeedbackTooltip:o,onFetchFeedbackData:n,onFetchViewers:a,showMessage:w,sendNavigationStatEvents:S,onQuestionRemove:l,showMoreReplies:_,onPrivacyHintHide:h,needShowEmptyStats:u})}),!this.isActiveLive()&&(0,r.jsx)("div",{className:(0,E.classNames)("StoryBottom__overlay",{"StoryBottom__overlay--shown":this.needShowOverlay()}),onTransitionEnd:this.onOverlayTransitionEnd})]})}needRenderNewMessageFormAsActive(){return this.state.sendFormFocused||(0,N.isNewDesignEnabled)()&&this.state.isNewMessageFormActiveAnimating}needShowOverlay(){const{sendFormFocused:e}=this.state;return e}renderMessageButton(){const e=this.props.story;if(!e.getCurStoryData()){return e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: renderMessageButton"),{environment:"stories"}),!1}if(!this.needShowSendFormSeparately())return;const{isMessageFormExpanded:t,isSendFormAnimating:i}=this.state;return t||i||(0,N.isNewDesignEnabled)()?void 0:(0,r.jsx)(x.default,{className:"StoryViewerTooltip",text:y.getLang("stories_write_message"),position:"t",marginTop:-8,children:(0,r.jsx)("div",{className:"StoryButton StoryBottomControl StoryButtonMessage StoryButton--round",onClick:()=>this.toggleMessageForm(),children:(0,r.jsx)(b.Icon28CommentOutline,{className:"StoryButton__icon"})})})}needShowSendFormSeparately(){return this._canMessage()&&(this.hasLink()||(0,N.isNewDesignEnabled)())}renderAppButton(){const e=this.props.story;if((0,N.isNewDesignEnabled)())return;const t=e.getSticker(_.StickerTypes.app);if(!t)return;const{isMessageFormExpanded:i,isStickerPanelShow:s}=this.state,o=!(s||this.needShowSendFormSeparately()&&i);return(0,r.jsx)(O.default,{in:o,timeout:200,classNames:{enter:"StoryButtonApp--enter",enterActive:"StoryButtonApp--enterActive",exitActive:"StoryButtonApp--exitActive",exit:"StoryButtonApp--exit"},unmountOnExit:!0,children:(0,r.jsx)(x.default,{className:"StoryViewerTooltip",text:y.getLang("stories_app"),position:"t",marginTop:-8,children:(0,r.jsxs)("div",{className:"StoryButtonApp StoryButton StoryBottomControl StoryButton--round",onClick:()=>this.props.markAppNotificationsSeen(t),children:[(0,r.jsx)(k.Icon28ServicesOutline,{}),t.hasNewInteractions&&(0,r.jsx)("span",{className:"StoryButtonBadge StoryButtonBadge--orange StoryButton__badge"})]})})})}renderLink(){const e=this.props.story,t=this.props.story.getCurStoryData();if(!t){return void(e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: _renderLink"),{environment:"stories"}))}const{linkArrowAnimationStep:i}=this.state,{link:s}=t;if(!(0,S.isObject)(s))return;let o=(0,E.decodeHTMLEntities)(s.url),n="stories_link";if(s.object_type&&(n+=` story_link_object_${s.object_type}`),this.state.linkObjectAudioPlaying&&(n+=" story_link_object_audio_playing"),t.isProfileQuestion){const e=new URL(o);e.searchParams.set("ref","story"),o=e.toString()}const a=(0,N.isNewDesignEnabled)();return(0,r.jsx)("div",{className:(0,E.classNames)("StoryLinkButton stories_link_wrap",{StoryBottomControl:!a,"StoryViewerBottomControl StoryViewerButton StoryViewerButton--wide StoryViewerButton--dark StoryViewerButton--link":a}),onMouseEnter:this.pauseLinkArrowAnimation,onMouseLeave:this.onLinkArrowMouseLeave,children:(0,r.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",className:n,href:o,title:s.text,onClick:e=>{this.linkDidPress(e,s)},onTransitionEnd:this.onLinkArrowTransitionEnd,children:[(0,r.jsx)("span",{className:"stories_link__inner",dangerouslySetInnerHTML:{__html:s.text}}),!this.state.linkObjectAudioPlaying&&(0,r.jsx)(T.Icon16ChevronOutline,{className:(0,E.classNames)("StoryLinkButton__icon",{"StoryLinkButton__icon--right":1===i})})]})})}renderShare(){const{story:e}=this.props,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: _renderShare"),{environment:"stories"}),""}const{can_share:i}=t;if(!i)return"";const s=(0,N.isNewDesignEnabled)();return(0,r.jsx)("div",{className:(0,E.classNames)({"StoryButton StoryButton--share StoryBottomControl":!s,"StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl":s}),onMouseEnter:e=>(0,w.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:y.getLang("stories_share")}),onClick:this._shareButtonDidPress.bind(this),children:(0,r.jsx)(C.Icon24ShareOutline,{className:(0,E.classNames)({StoryButton__icon:!s,StoryViewerButton__icon:s})})})}renderAddToNarrativeBtn(){const e=this.props.story,t=this.props.story.getCurStoryData(),i=this.props.story.getCurrentNarrative();if(!t){return e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: renderAddToNarrativeBtn"),{environment:"stories"}),null}if(i)return null;const s=(0,N.isNewDesignEnabled)();return(0,r.jsxs)("div",{className:(0,E.classNames)({"StoryButton StoryBottomControl":!s,"StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl":s}),onMouseEnter:e=>(0,w.showTooltip)(e.target,{black:1,center:1,shift:[1,13,0],text:y.getLang("stories_add_to_narrative")}),onClick:this.addToNarrativePress,ref:this.addToNarrativeRef,children:[t.isPartOfNarrative&&(0,r.jsx)(M.Icon24NarrativeActiveOutline,{className:(0,E.classNames)({StoryButton__icon:!s,StoryViewerButton__icon:s})}),!t.isPartOfNarrative&&(0,r.jsx)(L.Icon24NarrativeOutline,{className:(0,E.classNames)({StoryButton__icon:!s,StoryViewerButton__icon:s})})]})}renderLike(){const e=this.props.story,t=this.props.story.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: _renderLike"),{environment:"stories"}),""}const{isLiked:i}=t,{isMessageFormExpanded:s,needAnimateLikeButton:o,isStickerPanelShow:n}=this.state,a=(0,N.isNewDesignEnabled)(),l=!(n||this.needShowSendFormSeparately()&&s);return(0,r.jsx)(O.default,{in:l,timeout:200,classNames:{enter:"StoryButtonLike--enter",enterActive:"StoryButtonLike--enterActive",exitActive:"StoryButtonLike--exitActive",exit:"StoryButtonLike--exit"},unmountOnExit:!0,children:(0,r.jsx)(x.default,{className:"StoryViewerTooltip",text:y.getLang("stories_like"),position:"t",delay:180,marginTop:-8,children:(0,r.jsxs)("div",{className:(0,E.classNames)("StoryButtonLike",{"StoryButton StoryButton--like StoryButton--round StoryBottomControl":!a,"StoryViewerButton StoryViewerButton--dark StoryViewerButton--round StoryViewerBottomControl":a,"StoryButtonLike--liked":i,"StoryButtonLike--animation":o,"StoryViewerButton--big":!0}),onClick:this._likeButtonDidPress.bind(this),onAnimationEnd:this.onLikeAnimationEnd,children:[i&&(0,r.jsx)(P.Icon28Like,{className:"StoryButton__icon"}),!i&&(0,r.jsx)(I.Icon28LikeOutline,{className:"StoryButton__icon"})]})})})}_canMessage(){const e=this.props.story,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: _canMessage"),{environment:"stories"}),!1}const{can_comment:i}=t;return i&&!e.isLiveEnded()}hasLink(){const e=this.props.story,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: hasLink"),{environment:"stories"}),!1}return(0,S.isObject)(t.link)}renderNewMessageButton(){if(this._canMessage())return this.hasLink()?(0,r.jsx)(x.default,{className:"StoryViewerTooltip",text:y.getLang("stories_write_message"),position:"t",marginTop:-8,children:(0,r.jsx)("button",{className:"StoryViewerBottomControl StoryViewerButton StoryViewerButton--dark StoryViewerButton--round",onClick:this.onNewMessageButtonClick,children:(0,r.jsx)("div",{className:"StoryViewerButton__icon",children:(0,r.jsx)(A.Icon24MessageOutline,{})})})}):(0,r.jsx)("button",{className:"StoryViewerBottomControl StoryViewerButton StoryViewerButton--message StoryViewerButton--wide StoryViewerButton--dark",onClick:this.onNewMessageButtonClick,children:(0,r.jsx)("span",{className:"StoryViewerButton__text",children:y.getLang("stories_answer_placeholder")})})}renderMessageForm(){const{sendFormFocused:e,isMessageFormExpanded:t,panelStickers:i}=this.state,s=this.needShowSendFormSeparately(),o=this.needRenderNewMessageFormAsActive();if(!this._canMessage())return;const n=(0,N.isNewDesignEnabled)();let a=(0,r.jsx)("div",{className:(0,E.classNames)("StorySendForm stories_send_form _emoji_field_wrap emoji_rpointer",{"StorySendForm--focus":e,"StorySendForm--separately":s,"StorySendForm--expanded":t,"StorySendForm--isNewDesign":n}),ref:"sendForm",children:(0,r.jsxs)("div",{className:"StorySendForm__wrapper",children:[(0,r.jsx)("div",{className:"StorySendForm__background"}),(0,r.jsxs)("div",{className:"StorySendForm__in",children:[(0,r.jsx)("div",{className:"stories_send_form_text_wrap",children:(0,r.jsx)("div",{contentEditable:!0,ref:"messageInput",className:"stories_send_form_text",placeholder:y.getLang("stories_answer_placeholder"),onFocus:this._sendFormDidFocus.bind(this),onBlur:this._sendFormDidBlur.bind(this),onInput:this._checkReactionsPanel.bind(this)})}),(0,r.jsx)("div",{className:"stories_send_form_helper",ref:"smileWrapper",onMouseDown:this.onSendFormButtonsMouseDown,children:(0,r.jsxs)("div",{className:(0,E.classNames)("stories_send_form_buttons _emoji_wrap",{shown:this.state.sendFormFocused||this.state.sendFormHasText}),children:[(0,r.jsx)("div",{ref:"smileButton",className:"stories_send_form_button smile _emoji_btn emoji_smile",onMouseEnter:e=>{window.Emoji.clearSizeCached(this.refs.smileButton),window.Emoji.show(this.refs.smileButton,e.nativeEvent)},onMouseLeave:e=>window.Emoji.hide(this.refs.smileButton,e.nativeEvent),onMouseDown:e=>(0,v.cancelEvent)(e.nativeEvent),children:(0,r.jsx)(B.Icon24SmileOutline,{})}),(0,r.jsx)("div",{className:(0,E.classNames)("stories_send_form_button send",{active:this.state.sendFormHasText}),onClick:this._onSendMessageButtonCLick.bind(this),children:(0,r.jsx)(D.Icon24Send,{})})]})})]}),this.renderDummyMessageIfNeeded()]})});const l=n?y.getLang("stories_fast_answer"):y.getLang("stories_reactions_title"),d=(0,r.jsx)(O.default,{in:this.state.isStickerPanelShow&&i.length>0,timeout:200,classNames:{enter:"StoryBottom__stickerPanel--enter",enterActive:"StoryBottom__stickerPanel--enterActive",exitActive:"StoryBottom__stickerPanel--exitActive",exit:"StoryBottom__stickerPanel--exit"},unmountOnExit:!0,children:(0,r.jsx)(c.ReactionsPanel,{className:"StoryBottom__stickerPanel",stickers:i,title:l,onStickerClick:this.onPanelStickerClick})});return n?(0,r.jsx)(O.default,{in:t,classNames:{enter:"StoryBottom__messageForm--enter",enterActive:"StoryBottom__messageForm--enterActive",exitActive:"StoryBottom__messageForm--exitActive",exit:"StoryBottom__messageForm--exit"},onEntered:this.onSendFormEntered,onExited:this.onSendFormExited,addEndListener:(e,t)=>{e.addEventListener("transitionend",(e=>{e.target===e.currentTarget&&t()}),!1)},unmountOnExit:!0,children:(0,r.jsxs)("div",{className:(0,E.classNames)("StoryBottom__messageForm",{"StoryBottom__messageForm--active":o}),children:[d,a]})}):(s&&(a=(0,r.jsx)(O.default,{in:t,classNames:{enter:"StorySendForm--enter",enterActive:"StorySendForm--enterActive",exitActive:"StorySendForm--exitActive",exit:"StorySendForm--exit"},onEntered:this.onSendFormEntered,onExited:this.onSendFormExited,addEndListener:(e,t)=>{e.addEventListener("transitionend",t,!1)},unmountOnExit:!0,children:a})),(0,r.jsxs)("div",{className:"StoryBottom__sendFormWrapper StoryBottomControl",children:[d,a]}))}renderDummyMessageIfNeeded(){const{isSendFormAnimating:e}=this.state;if(this.needShowSendFormSeparately()&&e&&!(0,N.isNewDesignEnabled)())return(0,r.jsx)("div",{className:"DummyRoundButton DummyRoundButton--message",children:(0,r.jsx)(b.Icon28CommentOutline,{})})}isActiveLive(){return this.props.story.isActiveLive()}isStickerPanelAvailable(){return!this.isActiveLive()}onChangeStickerPanelVisibility(e=!1){this.isStickerPanelAvailable()&&this.setState({isStickerPanelShow:e})}_checkLoadedStickers(){return this.getPanelStickers().length>=_.EMOJI_REACTIONS_ARR.length}leftSideIsEmpty(){const e=this.props.story,t=e.getCurStoryData();if(!t){return e.isActiveMetaStory()||(0,f.logError)(new Error("Fail: _leftSideIsEmpty"),{environment:"stories"}),!1}const{can_manage:i,link:s,can_comment:o}=t,r=e.getReplies(),n=e.getViews();return!(n&&0!==parseInt(n))&&(!r||!i)&&!(0,S.isObject)(s)&&!o||e.isLiveEnded()}_sendFormDidFocus(){const{story:e}=this.props;this.setState({sendFormFocused:!0}),this.isStickerPanelAvailable()&&this._checkReactionsPanel(),e.onSendFormFocus(),e.layer.sendNavigationStatEvents("comment_tap")}_sendFormDidBlur(){this.props.story.onSendFormBlur(),this.setState({sendFormFocused:!1}),this.isStickerPanelAvailable()&&this._hideReactionPanel(),!this.getMessageText()&&this.needShowSendFormSeparately()&&this.toggleMessageForm(!1),this._emojiDidKeyAction()}_emojiDidKeyAction(){var e;const t=this.getMessageText();this.setState({sendFormHasText:t.length>0}),null==(e=this.refs.messageInput)||e.check()}getMessageText(){return(0,S.trim)(window.Emoji.editableVal(this.refs.messageInput))}_hideReactionPanel(){this.onChangeStickerPanelVisibility(!1)}_showReactionPanel(){this.onChangeStickerPanelVisibility(!0)}_checkReactionsPanel(){if(!this.isStickerPanelAvailable())return;this.props.story.getSendText().length?this._hideReactionPanel():this._showReactionPanel()}_shareButtonDidPress(){this.props.story.shareBox()}_likeButtonDidPress(){this.setState({needAnimateLikeButton:!0}),this.props.story.toggleLikeStory()}updatePanelStickers(){this.isMount&&(this.setState({panelStickers:this.getPanelStickers()}),this.preloadStickerImages())}preloadStickers(e){const t=(0,S.isRetina)()?"256b":"128b";window.Emoji.emojiPreloadMore({sizes:{[t]:!0}},e)}preloadStickerImages(){const{panelStickers:e}=this.state;e.forEach((e=>{(new Image).src=e.imageUrl}))}getPanelStickers(){const e=[];if(window.stickersKeywords&&window.Emoji.stickersById){const t=window.Emoji.stickersById,i=(0,S.isRetina)()?"256b":"128b",s={};_.EMOJI_REACTIONS_ARR.forEach((o=>{const r=window.stickersKeywords[(0,h.emojiRemoveSkinToneModifiers)(window.Emoji.codeToChr(o.code))],n=r&&window.Emoji.sortStickersHints(r);let a={};n&&n.every((e=>!(e>0&&t[e]&&t[e].sticker&&!s[e])||(a=t[e].sticker,!1))),a[6]&&a[6][i]&&(e.push({id:a[0],packId:0,uniqId:(0,S.irand)(0,1e5),imageUrl:a[6][i],animationUrl:a[3]}),s[a[0]]=!0)}))}return e}_hideStickerHints(){const e=(0,g.geByClass1)("_sticker_hints",(0,g.domPN)(this.refs.messageInput));e&&"number"==typeof this.emojiId&&window.Emoji.stickersHintsHide(e,window.Emoji.opts[this.emojiId],100)}_onSendMessageButtonCLick(){this._sendMessage()}_sendMessage(e=[],t={},i={}){const s=e.length;this._hideStickerHints(),this.props.story.onAnswerSend((()=>{this._emojiDidKeyAction(),s&&this.updatePanelStickers(),this.needShowSendFormSeparately()&&this.state.isMessageFormExpanded&&this.toggleMessageForm(!1)}),e,t,i)}constructor(e){super(e),this.isMount=!1,this.onOverlayTransitionEnd=e=>{e.target===e.currentTarget&&this.state.isNewMessageFormActiveAnimating&&this.setState({isNewMessageFormActiveAnimating:!1})},this.onNewMessageButtonClick=()=>{this.toggleMessageForm(!0)},this.onSendFormButtonsMouseDown=e=>{this.needShowSendFormSeparately()&&!this.getMessageText()&&e.preventDefault()},this.onPanelStickerClick=(e,t)=>{this._sendMessage([["sticker",e,""]],{sticker_referrer:"story_reaction"},{reactionName:_.EMOJI_REACTIONS_ARR[t].name})},this.emojiInit=()=>{if(!this.emojiId&&this.refs.messageInput){const e=this.isStickerPanelAvailable();if(this.emojiId=window.Emoji.init(this.refs.messageInput,{ttDiff:29,ref:"stories",ttWrap:this.refs.smileWrapper,checkEditable:()=>{this.props.story.isActiveLive()&&u.VideoChat.checkTextLen(this.refs.messageInput)},noStickers:!e,noStickersStore:!e,onSend:()=>this._sendMessage(),onStickerSend:(e,t,i)=>{this._sendMessage([["sticker",e,i]],{sticker_referrer:t}),this.needShowSendFormSeparately()&&this.state.isMessageFormExpanded&&this.toggleMessageForm(!1)},forceUp:!0,controlsCont:this.refs.sendForm,onKeyAction:()=>this._emojiDidKeyAction(),onEmojiAdded:()=>this._emojiDidKeyAction(),onStoreHide:()=>{this.updatePanelStickers(),this.props.story.autoResumeStory()}}),(0,v.addEvent)(this.refs.smileButton,"click",v.cancelEvent),(0,p.placeholderInit)(this.refs.messageInput,{editable:!0}),this._checkLoadedStickers())this.preloadStickerImages();else{const e=(0,S.isRetina)()?"256b":"128b";window.Emoji.emojiLoadMore(this.emojiId,{sizes:{[e]:!0}},(()=>{this.updatePanelStickers()}))}}else this.emojiId&&!this.refs.messageInput&&this.destroyEmoji();this._canMessage()&&(0,N.isNewDesignEnabled)()&&!this._checkLoadedStickers()&&this.preloadStickers((()=>{this.updatePanelStickers()}))},this.onSendFormEntered=()=>{this.setState({isSendFormAnimating:!1})},this.onSendFormExited=()=>{this.setState({isSendFormAnimating:!1}),this.destroyEmoji()},this.destroyEmoji=()=>{(0,v.removeEvent)(this.refs.smileButton,"click",v.cancelEvent),this.emojiId&&(window.Emoji.destroy(this.emojiId),delete this.emojiId)},this.toggleMessageForm=(e=!0)=>{this.state.isMessageFormExpanded!==e&&this.setState({isMessageFormExpanded:e,isSendFormAnimating:!0})},this.addToNarrativePress=()=>{this.props.story.onAddToNarrativeBtnClick()},this.onLikeAnimationEnd=()=>{this.setState({needAnimateLikeButton:!1})},this.linkDidPress=(e,t)=>{if(!t)return;const{story:i}=this.props,s=t.object_type,r=t.object,a=t.url.match(/\/narrative(-?\d+)_(\d+)/);if(a){e.preventDefault();const[,t,s]=a;t&&s&&(i.pauseStory(),(0,m.showNarrative)(t,s,0,"",{fromEl:i.wrapEl,source:"narrative_story"}))}else i.layer.sendNavigationStatEvents("link_click"),i.sendStatEvent("url_view");if("audio"===s)this.state.linkObjectAudioPlaying?((0,n.getAudioPlayer)().pause(),this.setState({story:(0,o._)({},this.state.story,{audioPlaying:!1})}),window.cur.storyLayer.resumeLayer()):((0,n.getAudioPlayer)().playAudio(r),this.setState({story:(0,o._)({},this.state.story,{audioPlaying:!0})}),window.cur.storyLayer.pauseLayer()),this.setState({linkObjectAudioPlaying:!this.state.linkObjectAudioPlaying}),e.preventDefault()},this.startLinkArrowAnimation=()=>{this.isMount&&this.setState({linkArrowAnimationStep:1})},this.pauseLinkArrowAnimation=()=>{this.setState({linkArrowAnimationStep:2})},this.onLinkArrowTransitionEnd=()=>{const{linkArrowAnimationStep:e}=this.state;1!==e?0!==e||this.setState({linkArrowAnimationStep:1}):this.setState({linkArrowAnimationStep:0})},this.onLinkArrowMouseLeave=()=>{const{isMessageFormExpanded:e}=this.state;e||this.startLinkArrowAnimation()},this.emojiId=!1,this.state={story:e.story,sendFormHasText:!1,sendFormFocused:!1,linkObjectAudioPlaying:!1,isStickerPanelShow:!1,panelStickers:this.getPanelStickers(),isMessageFormExpanded:!this.hasLink()&&!(0,N.isNewDesignEnabled)(),needAnimateLikeButton:!1,isSendFormAnimating:!1,linkArrowAnimationStep:0},this.addToNarrativeRef=(0,a.createRef)()}}},755495:(e,t,i)=>{i.d(t,{StoryStickers:()=>y});var s=i(785893),o=i(667294),r=i(329462),n=i(604632),a=i(589448),l=i(589897),d=i(627240),c=i(365035),_=i(795558),h=i(29271),u=i(82161),p=i(659397),m=i(320422),g=i(953908),v=i(931917);class y extends o.Component{constructor(e){super(e),this.componentDidMount=()=>{window.addEventListener("resize",this.handleResize)},this.componentWillUnmount=()=>{window.removeEventListener("resize",this.handleResize)},this.componentDidUpdate=()=>{this.askTextarea.current&&this.askTextarea.current.focus()},this.onDisableAreaMouseDown=e=>{this.props.onMouseDownHandle(e.target)},this.onDisableAreaMouseUp=(e,t=(()=>{}))=>{this.props.onMouseUpHandle(e.target,t)},this.render=()=>{const{story:e,storyData:t,author:i,layerEl:o,showMessage:l,playStory:d,pauseStory:c,list:_,sendNavigationStatEvents:u,markAppNotificationsSeen:m,showHelpHint:g,hideHelpHint:v}=this.props,{clickable_stickers:y}=t,{stickers:w,original_width:S,original_height:f}=y,{widthViewBox:E,heightViewBox:b,showTooltip:k,position:T,tooltipContent:C,showQuestionModal:M,clientX:L,clientY:P}=this.state;return(0,s.jsxs)("div",{className:"StoryStickers",children:[(0,s.jsx)("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--left",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp}),(0,s.jsx)("div",{className:"StoryStickers__disableArea StoryStickers__disableArea--right",onMouseDown:this.onDisableAreaMouseDown,onMouseUp:this.onDisableAreaMouseUp}),w.map(((t,i)=>(0,s.jsx)(r.StickerItem,{story:e,sticker:t,originalWidth:S,originalHeight:f,widthViewBox:E,heightViewBox:b,toggleTooltip:this.toggleTooltip,sendNavigationStatEvents:u,hideTooltip:this.hideTooltip,showQuestionModal:this.showQuestionModal,markAppNotificationsSeen:m,showMessage:l,playStory:d,pauseStory:c,list:_,onMouseDownHandle:this.onDisableAreaMouseDown,onMouseUpHandle:this.onDisableAreaMouseUp,showHelpHint:g,hideHelpHint:v},i))),k&&(0,s.jsx)(n.StickerTooltip,{clientX:L,clientY:P,layerEl:o,position:T,children:C}),M&&(0,s.jsx)(a.default,{title:h.getLang("stories_question_ask_box_title").replace("{name}",(0,p.decodeHTMLEntities)(i.name_get)),actionButtons:this.getQuestionModalActions(),className:"StoryQuestionAskForm",onClose:this.closeQuestionModal,appearance:"blue",children:(0,s.jsx)("div",{className:"StoryQuestionAskForm__inner",children:(0,s.jsx)("textarea",{ref:this.askTextarea,className:"StoryQuestionAskForm__textarea",maxLength:80,placeholder:h.getLang("stories_question_ask_placeholder"),onChange:this.handleChange,onKeyDown:this.handleKeyDown})})})]})},this.handleResize=()=>{const[e,t]=(0,_.getSize)(this.props.el);this.setState({widthViewBox:e,heightViewBox:t,showTooltip:!1})},this.toggleTooltip=(e,t,i="t")=>{e.preventDefault(),e.stopPropagation();const{clientX:s,clientY:o}=e,{pauseStory:r,playStory:n,hideFeedbackTooltip:a,sendNavigationStatEvents:l}=this.props;a(),this.setState({showTooltip:!this.state.showTooltip,tooltipContent:t,clientX:s,clientY:o,position:i}),setTimeout((()=>{this.state.showTooltip?(l("click_on_clickable_sticker"),r()):n()}),0)},this.hideTooltip=()=>{this.setState({showTooltip:!1})},this.isShownTooltip=()=>this.state.showTooltip||this.state.showQuestionModal,this.showQuestionModal=()=>{const{storyData:e,showMessage:t,pauseStory:i,onModalShownChange:s}=this.props,{can_ask:o}=e;if(!o)return t(h.getLang("stories_question_forbidden"));this.setState({showQuestionModal:!0}),this.hideTooltip(),s(!0),i()},this.closeQuestionModal=()=>{const{playStory:e,onModalShownChange:t}=this.props;this.setState({showQuestionModal:!1}),t(!1),e()},this.handleChange=e=>{this.setState({questionText:e.target.value})},this.handleKeyDown=e=>{const{questionText:t}=this.state;(0,u.trim)(t)&&"keydown"===e.type&&(e.ctrlKey||e.metaKey)&&e.keyCode==g.KEY.RETURN&&this.sendQuestion()},this.resetAskText=()=>{this.setState({questionText:""})},this.getQuestionModalActions=()=>{const{storyData:e}=this.props,{can_ask_anonymous:t}=e,{isQuestionButtonLoading:i,questionText:o}=this.state,r=[{value:c.QUESTION_SELECT_MODE.AUTHOR_ONLY,label:h.getLang("stories_question_select_author_only")},{value:c.QUESTION_SELECT_MODE.PUBLIC,label:h.getLang("stories_question_select_public")}];return t&&r.splice(1,0,{value:c.QUESTION_SELECT_MODE.ANONYMOUS,label:h.getLang("stories_question_select_anonymous")}),(0,s.jsxs)("div",{className:"StoryQuestionAskForm__footer",children:[(0,s.jsx)("div",{className:"StoryQuestionAskForm__cell StoryQuestionAskForm__cell--select",children:(0,s.jsx)(d.default,{value:this.state.selected,options:r,onChange:this.onSelectChange,onShow:this.onSelectShow,onHide:this.onSelectHide})}),(0,s.jsxs)("div",{className:"StoryQuestionAskForm__cell",children:[(0,s.jsx)(l.default,{size:"m",mode:"tertiary",onClick:this.closeQuestionModal,children:h.getLang("global_cancel")},"b"),(0,s.jsx)(l.default,{size:"m",mode:"primary",loading:i,disabled:!(0,u.trim)(o),onClick:this.sendQuestion,children:h.getLang("stories_question_reply_send")},"s")]})]})},this.onSelectChange=e=>{this.setState({selected:Number(e.selected.value)})},this.onSelectShow=()=>{const{storyData:e,author:t}=this.props,{can_ask_anonymous:i}=e,s=document.querySelector(".StoryQuestionAskForm__cell--select");if(!s)return;const o=i?h.getLang("stories_question_about_user_tooltip"):h.getLang("stories_question_about_user_tooltip_without_anon"),r=i?h.getLang("stories_question_about_group_tooltip"):h.getLang("stories_question_about_group_tooltip_without_anon");let n="";n=v.Ranges.isUserId(t.id)?o.replace(/{name}/g,(0,p.decodeHTMLEntities)(t.firstName)):r,(0,m.showTooltip)(s,{text:n,width:350,slideX:15,className:"",nohide:!0,asrtl:!0,shift:[350,-15],dir:"left",showdt:1e3})},this.onSelectHide=()=>{const e=document.querySelector(".StoryQuestionAskForm__cell--select");e&&e.tt&&e.tt.destroy()},this.sendQuestion=()=>{const{questionText:e}=this.state,{showMessage:t,storyData:i,author:s,sendNavigationStatEvents:o}=this.props,{raw_id:r,askQuestionHash:n}=i,[a,l]=r.split("_");let d=!1,_=!1;this.state.selected===c.QUESTION_SELECT_MODE.PUBLIC?d=!0:this.state.selected===c.QUESTION_SELECT_MODE.ANONYMOUS&&(_=!0),window.ajax.post("al_stories.php",{act:"ask_question",story_owner_id:a,story_id:l,question_text:e,is_anonymous:+_,with_mention:+d,hash:n},{onDone:()=>{switch(this.closeQuestionModal(),this.resetAskText(),t(h.getLang("stories_question_sent").replace("{name}",s.first_name_ins)),this.state.selected){case c.QUESTION_SELECT_MODE.PUBLIC:o("question_reply_publish");break;case c.QUESTION_SELECT_MODE.AUTHOR_ONLY:o("question_reply");break;case c.QUESTION_SELECT_MODE.ANONYMOUS:o("question_reply_anonymous")}},onFail:e=>(this.closeQuestionModal(),this.resetAskText(),t(e),!0),showProgress:()=>this.setState({isQuestionButtonLoading:!0}),hideProgress:()=>this.setState({isQuestionButtonLoading:!1})})};const[t,i]=(0,_.getSize)(this.props.el);this.askTextarea=(0,o.createRef)(),this.state={widthViewBox:t,heightViewBox:i,clientX:0,clientY:0,showTooltip:!1,tooltipContent:"",position:"t",showQuestionModal:!1,isQuestionButtonLoading:!1,selected:c.QUESTION_SELECT_MODE.AUTHOR_ONLY,questionText:""}}}},920934:(e,t,i)=>{i.d(t,{ViewsButton:()=>c});var s=i(785893),o=i(711680),r=i(429697),n=i(648184),a=i(449909),l=i(659397),d=i(964262);const c=({story:e,reactionSet:t,className:i=""})=>{const c=e.getReplies(),_=e.getViews()||"",h=e.getCurStoryData();if(!h)return null;const{can_manage:u,isNewQuestions:p,needShowEmptyStats:m,replies_new_counter:g,small_preview:v}=h,y=(0,d.isNewDesignEnabled)(),w=Boolean(u&&(_||m)),S=y?Boolean(!u&&c):Boolean(c),f=m||p||Boolean(y&&u&&g),E=e.isActiveLive(),b=e.getRawId(),{isFeedbackTooltipShow:k,toggleFeedbackTooltip:T,onFetchFeedbackData:C,onFetchViewers:M,onQuestionRemove:L,feedback:P,showMoreReplies:I,onPrivacyHintHide:A}=e;if(E||!_&&!c&&!m)return null;const B=e.showMessage.bind(e),D=e.layer.sendNavigationStatEvents.bind(e.layer);let x="",O="";return y?(O="StoryViewerButtonWrapper",x="StoryViewerButton StoryViewerButton--feedback StoryViewerButton--dark",k&&(x+=" StoryViewerButton--hover")):(O="StoryButtonWrapper StoryButtonWrapper--feedback",x="StoryButton StoryButton--feedback",k&&(x+=" StoryButton--hover")),(0,s.jsxs)("div",{className:(0,l.classNames)(O,i),children:[(0,s.jsxs)("div",{className:x,onClick:e=>{T(),m&&D("open_empty_feedback"),e.stopPropagation()},children:[S&&(0,s.jsxs)("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--replies",children:[(0,s.jsx)(n.Icon24StoryOutline,{}),(0,s.jsx)("span",{className:"StoryButtonFeedbackLabel__text",children:c})]}),w&&(0,s.jsxs)("div",{className:"StoryButtonFeedbackLabel StoryButtonFeedbackLabel--views",children:[(0,s.jsx)(a.Icon24ViewOutline,{}),Boolean(_)&&(0,s.jsx)("span",{className:"StoryButtonFeedbackLabel__text",children:_})]}),f&&(0,s.jsx)("span",{className:(0,l.classNames)("StoryButtonBadge StoryButton__badge",{"StoryButton__badge--isNewDesign":y,"StoryButtonBadge--orange":p&&!y,"StoryButtonBadge--blue":!p&&m||y})})]}),!y&&(0,s.jsx)(r.default,{in:k,timeout:200,classNames:{enter:"FeedbackTooltipTransitionWrapper--enter",enterActive:"FeedbackTooltipTransitionWrapper--enterActive",exit:"FeedbackTooltipTransitionWrapper--exit",exitActive:"FeedbackTooltipTransitionWrapper--exitActive"},unmountOnExit:!0,children:(0,s.jsx)(o.default,{className:"StoryButtonWrapper__feedback",reactionSet:t,feedback:P,storyRawId:b,storyImageUrl:v,toggleFeedbackTooltip:T,onFetchFeedbackData:C,onFetchViewers:M,showMessage:B,sendNavigationStatEvents:D,onQuestionRemove:L,showMoreReplies:I,onPrivacyHintHide:A,needShowEmptyStats:m})})]})}},481879:(e,t,i)=>{i.d(t,{DiscoverMetaStory:()=>u});var s=i(785893),o=i(973935),r=i(914263),n=i(934346),a=i(29271),l=i(517366),d=i(601618),c=i(816271),_=i(964262),h=i(970978);class u extends d.MetaStory{update(){var e;if(this.isDestroyed)return;Boolean(null==(e=this.block.grouped)?void 0:e.length)||(0,_.preloadDiscoverList)().then((()=>{this.update()})).catch((e=>{console.error(e),(0,h.logError)(new Error("Error with getDiscoverList in DiscoverMetaStory"+(e?`: ${e}`:"")))})),o.render((0,s.jsx)(r.MetaStory,{metaStoryInfo:(0,s.jsx)(n.MetaStoryInfo,{icon:(0,s.jsx)("div",{className:"MetaStoryInfo__discoverIcon",children:(0,s.jsx)(c.Icon56CompassOutline,{})}),header:a.getLang("stories_interesting_stories"),subheader:a.getLang("stories_interesting_stories_description")}),list:this.block.grouped,listName:l.StoryListName.discover,source:l.StorySource.DISCOVER,isPaused:this.isPaused.bind(this),onLongTap:this.options.onLongTap,onScroll:this.onScroll,hasMore:this.hasMore,loadMore:this.loadMore,pause:this.options.pause,play:this.options.play,playNextStory:this.options.playNextStory,playPrevStory:this.options.playPrevStory,onTopScrolled:this.options.toggleMetaStoryTitle}),this.wrapper)}constructor(...e){super(...e),this.viewEventType="discover_feed_view",this.hasMore=()=>Boolean(this.block.next_from),this.loadMore=()=>this.hasMore()?(0,_.fetchDiscover)(this.block.next_from,this.block.track_code,!1).then((([e,t])=>{this.block.grouped=[...this.block.grouped||[],...e],this.block.next_from=t,this.update()})):Promise.resolve()}}},907215:(e,t,i)=>{i.d(t,{GroupsMetaStory:()=>c});var s=i(785893),o=i(973935),r=i(601618),n=i(517366),a=i(29271),l=i(914263),d=i(934346);class c extends r.MetaStory{update(){o.render((0,s.jsx)(l.MetaStory,{metaStoryInfo:(0,s.jsx)(d.MetaStoryInfo,{header:a.getLang("stories_groups_grid_title"),subheader:a.getLang("stories_groups_grid_text")}),list:this.block.grouped,listName:n.StoryListName.groups,isPaused:this.isPaused.bind(this),onLongTap:this.options.onLongTap,onScroll:this.onScroll,pause:this.options.pause,play:this.options.play,playNextStory:this.options.playNextStory,playPrevStory:this.options.playPrevStory,onTopScrolled:this.options.toggleMetaStoryTitle}),this.wrapper)}}},391128:(e,t,i)=>{i.d(t,{StoryLayer:()=>A});var s=i(584356),o=i(672948),r=i(517366),n=i(676499),a=i(273302),l=i(713417),d=i(964262),c=i(28131),_=i(839470),h=i(892547),u=i(365035),p=i(196026),m=i(332268),g=i(504867),v=i(112100),y=i(95432),w=i(82161),S=i(29271),f=i(953908),E=i(438221),b=i(643897),k=i(795558),T=i(970978),C=i(863727),M=i(371911),L=i(111958),P=i(601618),I=i(930776);class A{_init(e,t,i,s,o,n,a){var l,d;s||(s=e?i?`${e}${i}`:(null==(l=n.find((t=>{var i;return(null==t||null==(i=t.author)?void 0:i.id)===e})))?void 0:l.id)||"":(null==(d=n[0])?void 0:d.id)||"");if(!s)throw this.destroy(),new Error("blockKey is undefined");this.blockKey=s,e&&t&&(this.startStoryRaw=`${e}_${t}`),this.listName=o,this.renderedStoryList=n,this.storyList=n,this.extra=A.parseExtra(a),this.extraRaw=a||"",this.hasUnloadedDiscover=Boolean(n.find((e=>{var t;return e.type===r.StoryBlockType.discover&&!(null==(t=e.grouped)?void 0:t.length)}))),this.initStories().catch((e=>{(0,b.debugLog)(e)}))}initStories(){return new Promise((e=>{this.renderedStoryBlockKeys=this.renderedStoryList.map((e=>this.getBlockKey(e)));let t=!1;const i=this.renderedStoryBlockKeys.indexOf(this.blockKey);if(i>-1){const e=this.renderedStoryList[i];t=this.isBlockUnread(e)}if(this.extra)switch(this.extra.context){case"new":t=!0;break;case"all":t=!1}if(t&&"replies"===this.listName.substr(0,7)&&(t=!1),t){const e=[];for(let t=0;t<this.renderedStoryList.length;t++){const i=this.renderedStoryList[t];(i&&this.isBlockUnread(i)||0===t&&this._hasContext("new"))&&e.push(i)}e.length&&(this.renderedStoryList=e,this.renderedStoryBlockKeys=this.renderedStoryList.map((e=>this.getBlockKey(e))))}this.renderedStories={};const{activeStory:s}=this._renderStories();this.scrollToStory(s,!0),1===this.renderedStoryList.length&&(0,k.addClass)(this.stories,"one_story"),this._startFirstStory(s,this.extra.story_id),(0,k.addClass)(this.stories,"inited"),e()}))}getBlockKey(e){var t,i,s;return(null==e||null==(t=e.author)?void 0:t.id)&&(null==e||null==(i=e.narrative)?void 0:i.id)?`${e.author.id}narrative${null==(s=e.narrative)?void 0:s.id}`:`${e.id}`}isBlockUnread(e){var t;let i=!1;var s;e.items[e.items.length-1]&&(i=null==(s=e.items[e.items.length-1])?void 0:s.unread);return(null==(t=e.grouped)?void 0:t.length)?i||(i=e.grouped.some((e=>{var t;return null==(t=e.items[e.items.length-1])?void 0:t.unread}))):e.type===r.StoryBlockType.discover&&(i=!0),i}_renderStories(){const e=[];for(let t=0;t<this.renderedStoryList.length;t++)this.renderedStoryList[t]&&e.push(this.renderedStoryList[t]);const t=this._getScreenStoriesCount(),i=this._getCurStoryPos(e.map((e=>this.getBlockKey(e)))),s=Math.floor(t/2),o=e.slice(Math.max(0,i-s)).slice(0,t),r=o.map((e=>this.getBlockKey(e)));for(const e in this.renderedStories){if(!this.renderedStories.hasOwnProperty(e))continue;const t=this.renderedStories[e];r.includes(e)||(t.story.destroy(),delete this.renderedStories[e])}let a=null;if(o.map(((e,t)=>{var i,o;const r=this.getBlockKey(e);if(this.renderedStories[r])return;const l=this.renderedStoryBlockKeys.indexOf(r),d=new n.Story(e,{id:t,layer:this,onSelect:this._onSelectStory.bind(this),onStoriesEnd:this._onStoriesEnd.bind(this,l),playPrevOwner:this._playPrevOwner.bind(this,l),onPlayStory:this._onPlayStory.bind(this,l),onSeen:this._readStories.bind(this),onVideoPlay:this._onVideoPlay.bind(this),restoreAudioPlay:this._restoreAudioPlay.bind(this),onStartStory:this._onStartStory.bind(this),removeCurrentList:()=>window.Stories.removeList(this.listName),onStoryBlockRemoved:(e,t)=>this.onStoryBlockRemoved(l,e,t),afterNarrativeRemoved:null==(i=this.options)?void 0:i.afterNarrativeRemoved,afterNarrativeEdited:null==(o=this.options)?void 0:o.afterNarrativeEdited});t<=s&&this.stories.children[t]?this.stories.insertBefore(d.render(),this.stories.children[t]):this.stories.appendChild(d.render()),this.renderedStories[r]={story:d,index:l},r===this.blockKey&&(a=d)})),!a){const e=r[0];a=this.renderedStories[e].story}return{activeStory:a}}_sendOpeningEvents(){if(!this._source)return;let e;switch(this._source){case"narrative_story":e="narrative_open_stories";break;case"narrative_snippet":case"narrative_link":e="narrative_open";break;case"narrative_recommendations":e="narrative_other"}if(e&&this.sendNavigationStatEvents(e,!1),"narrative_fave"===this._source){const e=this.activeStory.getCurrentNarrative();if(e){const{ownerId:t,id:i}=e;(0,g.statlogsValueEvent)("bookmarks_product_analytics",{item_type:"narrative",item_owner_id:t,item_id:i,time:(0,o.getServerTime)()})}}}_destroyStories(){for(const e in this.renderedStories){if(!this.renderedStories.hasOwnProperty(e))continue;this.renderedStories[e].story.destroy()}}destroy(){clearTimeout(this.timer),clearTimeout(this.animationTimer),this._destroyStories(),this._onVideoEnd(),(0,f.removeEvent)(this.volumeControl),(0,f.removeEvent)(this.layerEl),delete this.activeStory,delete this.volumeControl,delete this.renderedStories;try{this.layerEl&&document.body.removeChild(this.layerEl)}catch(e){}delete window.cur.storyLayer}getList(){return`story${this.activeStory.getRawId()}/${this.listName}${this.extraRaw?`/${this.extraRaw}`:""}`}getStoryRaw(){return!!this.activeStory&&this.activeStory.getRawId()}initDOM(){this.layerEl=(0,k.ce)("div",{className:"stories_layer"});const e=(0,k.ce)("div",{className:"stories_layer_cont"});this.layerEl.appendChild(e),e.appendChild(this._renderBackButton()),e.appendChild(this._renderVolumeControl()),this._updateVolumeButton(),this.stories=(0,k.ce)("div",{id:"stories_list",className:"stories_list"}),e.appendChild(this.stories),e.appendChild((0,k.ce)("div",{className:"stories_layer_close"})),(0,f.addEvent)(this.layerEl,"click",this._onLayerClick.bind(this)),document.body.appendChild(this.layerEl)}show(){window.onBodyResize()}hide(e){(0,k.addClass)(this.layerEl,"stories_layer_hiding"),this.hideAllLayers||a.layerHide(),this._source&&this._source.startsWith("narrative")&&this.sendNavigationStatEvents("narrative_close",!1),this.activeStory&&(this.activeStory.pauseStory(),this.activeStory.hideTooltip(),this.activeStory.isActiveLive()&&this.sendNavigationStatEvents("live_player_close",!1),this._readStoriesIfNeeded(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.listName)),!0!==e&&this.activeStory?this.animateStory("minimize").then((()=>this.doHide())).catch((()=>{(0,b.debugLog)("error animate story")})):this.doHide(e),(0,k.removeClass)(this.layerEl,"shown")}doHide(e){this.destroy(),e||a.removeLayer(),window.wkcur&&window.wkcur.shown&&window.WkView.restoreLayer({}),"group_stories"===this.listName&&window.Stories.groupStoriesBlockUpdate(),this.listName.startsWith("archive")&&window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition&&window.updateStoriesArchiveBoxPosition(),(0,v.clear)()}back(){this.hideAllLayers=!1;const e=(0,p.getCancelStack)(),t=e[e.length-1];t&&"stories_form_focus"===t.name&&(0,p.cancelStackPop)(),this.hide(!1)}_getScreenStoriesCount(){return 2*Math.floor(window.innerWidth/(window.innerHeight*l.STORY_HORIZONTAL_RATIO))+1}_getCurStoryPos(e){return(e||this.renderedStoryBlockKeys).indexOf(this.blockKey)}_startFirstStory(e,t){this.activeStory=e,(0,k.addClass)(e.getWrap(),"active"),this.scrollToStory(),t||(t=this._hasContext("new")?t:this.startStoryRaw),e.indexToStoryById(t),this._startActiveStory(),setTimeout((()=>{(0,k.addClass)(this.stories,"animated"),this.inited=!0,"open"===this.extra.replies&&this.activeStory.showFeedbackTooltip()}))}_markReadRestStories(e){e.hasMetaStory()?this.onMetaStoryViewEnd(e):(this._markReadStoriesInRange(e,e.index,e.getFullItemsLength()),this._updateBadge(e))}onMetaStoryViewEnd(e){if(!e.data.grouped)return;for(let t of e.data.items)t.unread=!1;const t=(0,k.ge)("feed_story_"+this.getBlockKey(e.data));let i=[];for(let t of e.data.grouped)if(t){for(let e of t.items)e.unread=!1,i.push(e.raw_id);t.author&&((0,I.markSeenStoriesInProfile)(t.author.id),(0,C.removeUnseenStories)(t.author.id),(0,M.removeUnseenStories)(t.author.id),(0,L.removeUnseenStories)(t.author.id))}this.markStoriesSkipped(i),e.data.has_unseen=!1,e.data.type===r.StoryBlockType.communityGroupedStories&&this._resetGroupsBlockPreview(e.data,t),this.updateMetaStoryItems(),(0,k.removeClass)(t,"story_feed_new_item")}markStoriesSkipped(e){window.ajax.post("al_stories.php",{act:"mark_skipped",stories:e.join(","),hash:this.storiesReadHash})}_resetGroupsBlockPreview(e,t){var i;if(!t||!t.classList.contains("stories_feed_preview_item"))return;if(!(null==(i=e.grouped)?void 0:i.length))return;const s=e.grouped[0].items[0];s&&s.small_preview&&(0,k.setStyle)(t,"background-image",`url(${s.small_preview})`)}_onSelectStory(e){let t;this.activeStory&&(t=this.activeStory.getWrap(),this.activeStory.stop()),e.id-this.activeStory.id>0&&this._markReadRestStories(this.activeStory),this.activeStory=e,e.indexToUnread(),e.isActiveLive()||e.fillTimeLine(),this.blockKey=this.getBlockKey(e.data),clearTimeout(this.timer),(0,k.addClass)(this.stories,"animated"),this.timer=setTimeout((()=>{(0,k.removeClass)(t,"active"),(0,k.addClass)(e.getWrap(),"active"),this.scrollToStory(),this.timer=setTimeout((()=>{this.activeStory&&e.id!==this.activeStory.id||!this.activeStory||(e.indexToUnread(),this._startActiveStory(),this._renderStories(),this.scrollToStory(e,!0))}),200)}),0)}_startActiveStory(){const{activeStory:e}=this;e.markAsActive(),e.playStory(!0)}_onStartStory(){this.updateLocation()}updateLocation(){const{activeStory:e,listName:t}=this;if(!e)return;const i=this.activeStory.getCurStoryData(),s=this.activeStory.getCurrentNarrative(),o=this.activeStory.isActiveMetaStory();if(!i&&!o)return void(0,T.logError)(new Error("Fail: _onStartStory"),{environment:"stories"});const r=window.nav.objLoc;if(i){if(r.w=`story${e.getRawId()}`,t.match(/^-?(\d+)_(\d+)$/)||(r.w+="/"+t),t.match(/^narrative[s]?-?\d+(_\d+)?/)){const{raw_id:e}=i,[,t]=e.split("_");r.w=`narrative${null==s?void 0:s.rawId}_${t}`}}else delete r.w;window.nav.setLoc(window.nav.toStr(r))}scrollToStory(e,t){const i=this._getScrollLeft(e);t?((0,k.removeClass)(this.stories,"animated"),this._setScrollLeft(i)):this.inited&&(0,k.addClass)(this.stories,"animated"),setTimeout((()=>{this._setScrollLeft(i)}))}_setScrollLeft(e){(0,k.setStyle)(this.stories,"transform",`translateX(${Math.round(e)}px) translateZ(0)`)}_getScrollLeft(e){return e=e||this.activeStory,window.innerWidth/2-e.getOffsetLeft()}_onStoriesEnd(e,t){let i=-1;for(let t=e+1;t<this.renderedStoryList.length;t++){if(this.renderedStoryList[t]){i=t;break}}const s=this._getStoryBlockByIndex(i);if(this.activeStory.isActiveMetaStory()&&this.onMetaStoryViewEnd(this.activeStory),this.activeStory.isActiveStoryOneTime()&&window.Stories.removeList(this.listName),i>-1&&s)t&&this.sendNavigationStatEvents("go_to_next_story_auto_by_time"),this._onSelectStory(s);else{const e=(0,p.getCancelStack)(),i=e[e.length-1];i&&"stories_form_focus"===i.name&&(0,p.cancelStackPop)(),(0,p.cancelStackPop)({byTimer:t})}}preloadDiscoverIfNeeded(){if(!this.hasUnloadedDiscover)return;if(d.isDiscoverLoading())return;if(!this.activeStory)return;const e=this.getBlockKey(this.activeStory.data);if(!this.renderedStories[e])return;let t=this.renderedStories[e].index,i=Math.min(t+3,this.renderedStoryBlockKeys.length-1);for(let e=t+1;e<=i;e++){var s,o;if((null==(s=this.renderedStoryList[e])?void 0:s.type)===r.StoryBlockType.discover)return(null==(o=this.renderedStoryList[e].grouped)?void 0:o.length)?void(this.hasUnloadedDiscover=!1):void d.preloadDiscoverList().then((()=>{this.hasUnloadedDiscover=!1})).catch((e=>{console.error(e),(0,T.logError)(new Error("Error with getDiscoverList in preloadDiscoverIfNeeded"+(e?`: ${e}`:"")))}))}}_playPrevOwner(e){let t=-1;for(let i=e-1;i>=0;i--){if(this.renderedStoryList[i]){t=i;break}}const i=this._getStoryBlockByIndex(t);t>-1&&i?this._onSelectStory(i):(0,p.cancelStackPop)()}_markReadStoriesInRange(e,t,i){var s;const o=e.data.items;for(let e=t;e<i;e++){const t=o[e];t.unread&&(t.unread=!1)}(null==(s=e.data.grouped)?void 0:s.length)&&i>=e.getFullItemsLength()&&(e.data.grouped.forEach((e=>e.items.forEach((e=>e.unread=!1)))),e.data.has_unseen=!1)}_markReadPrevStories(e){this._markReadStoriesInRange(e,0,e.index)}_updateBadge(e){var t;const i=(0,k.ge)("feed_story_"+this.getBlockKey(e.data)),s=(0,k.geByClass1)("_stories_feed_item_replies",i);if(e.hasUnloadedMetaStory())return;const o=e.data.items||[];(o[e.index]||{}).unread=!1;let r=!0;o.forEach((e=>{e.unread&&(r=!1)})),r&&(null==(t=e.data.grouped)?void 0:t.length)&&(r=e.data.grouped.every((e=>e&&e.items.every((e=>!(null==e?void 0:e.unread)))))),(0,k.val)(s,""),r&&((0,k.removeClass)(i,"story_feed_new_item"),(0,k.removeClass)(i,"story_feed_new_item_promo"),e.data.author&&((0,I.markSeenStoriesInProfile)(e.data.author.id),(0,C.removeUnseenStories)(e.data.author.id),(0,M.removeUnseenStories)(e.data.author.id),(0,L.removeUnseenStories)(e.data.author.id)))}_onPlayStory(e){const t=this._getStoryBlockByIndex(e);t&&(this.storiesReadHash=t.getReadHash(),t.isActiveMetaStory()||t.isActiveStoryOneTime()||(this._readStories(t),this._markReadPrevStories(t)),this._updateBadge(t));const i=this._getStoryBlockByIndex(e+1);i&&(t&&0===t.getIndex()&&this.preloadDiscoverIfNeeded(),i.preloadNextStory(i.getIndex()))}_getStoryBlockByIndex(e){const t=this.renderedStoryList[e];if(!t)return!1;const i=this.getBlockKey(t);return this.renderedStories[i].story}onStoryBlockRemoved(e,t,i){const s=this.renderedStoryList[e],o=this.getBlockKey(s),r=this.storyList.findIndex((e=>e&&o===this.getBlockKey(e)));delete this.renderedStoryList[e],delete this.storyList[r],!t&&this._onStoriesEnd(e),window.Stories.updateFeedStories(void 0,{cb:i})}onVisibilityChange(){"visible"===document.visibilityState?window.cur.storyLayer&&window.cur.storyLayer.playStory():window.cur.storyLayer&&window.cur.storyLayer.pauseStory()}onResize(){this.activeStory&&window.cur.storyLayer.scrollToStory(this.activeStory,!0)}pauseStory(e){this.activeStory&&this.activeStory.pauseStory(e)}playStory(e=!1){this.activeStory&&this.activeStory.autoResumeStory(e)}_onLayerClick(e){const t=(0,k.hasClass)(e.target,"stories_layer_close");if((0,k.hasClass)(e.target,"stories_layer_cont")||t){if(this.renderedStoryBlockKeys.length-1===this._getCurStoryPos()&&!t){const e=[];for(let t of this.activeStory.data.items)e.push(t.raw_id),t.unread=!1;this.markStoriesSkipped(e),this._markReadRestStories(this.activeStory)}(0,p.cancelStackPop)({isCloseBtnClick:t})}}_checkKeyEvents(e){return!((0,k.attr)(e.target,"contenteditable")||(0,w.inArray)(e.target.tagName,["INPUT","TEXTAREA"])||(0,s.curBox)())}onKeyDown(e){if(window.cur.storiesKeyDown)window.cur.storyLayer&&window.cur.storyLayer._checkKeyEvents(e)&&(0,f.cancelEvent)(e);else if(window.cur.storiesKeyDown=e.keyCode!==f.KEY.ESC,[f.KEY.PAGEDOWN,f.KEY.PAGEUP].includes(e.keyCode))(0,f.cancelEvent)(e);else if(window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)){switch(e.keyCode){case f.KEY.LEFT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.prevStory();break;case f.KEY.RIGHT:this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory();break;case f.KEY.SPACE:(0,f.cancelEvent)(e);const t=window.cur.storyLayer.activeStory;t.isSpaceLongTabAvailable()&&(window.cur.storiesKeyDownLong=setTimeout(t.longTapHandle.bind(t),u.LONG_PRESS_DELAY_MS))}window.cur.storiesKeyDownTs=(0,w.vkNow)()}}onKeyUp(e){window.cur.storiesKeyDown=!1,clearTimeout(window.cur.storiesKeyDownLong),window.cur.storyLayer&&window.cur.storyLayer.inited&&window.cur.storyLayer._checkKeyEvents(e)&&e.keyCode===f.KEY.SPACE&&((0,f.cancelEvent)(e),(0,w.vkNow)()-window.cur.storiesKeyDownTs>u.LONG_PRESS_DELAY_MS?window.cur.storyLayer.playStory(!0):(this._readStoriesIfNeeded(this.activeStory),window.cur.storyLayer.nextStory()))}nextStory(){this.activeStory&&this.activeStory.nextStory()}prevStory(){this.activeStory&&this.activeStory.prevStory()}changeStory(e){this.activeStory&&this.activeStory.changeStory(e)}_readStoriesIfNeeded(e){e.isActiveStoryOneTime()&&this._readStories(e)}_readStories(e){if(!e)return;const t=e.getOwnerId(),i=e.getStoryId(),s=e.getRawId(),o=e.getCurrentNarrative();if(!s||!e.isLoaded())return;let r=e.getTrackCode(),n=0;e.isActiveStoryOneTime()&&(n=Math.max(Math.round(e.getStoryProgressPercent()),1)),r||(r=""),(0,_.partConfigEnabled)("web_stories_use_api_mark_seen")?(m.storiesService.markSeenFx({owner_id:t,story_id:i,track_code:r,source:this._getSource(),progress:n,all:0}).catch((e=>{var t;(0,T.logError)(new Error(`error mark seen story: ${null==e||null==(t=e.error)?void 0:t.error_msg}`))})),m.statsService.fireTrackEvents({events:JSON.stringify([...(0,m.getStoriesNavigationStats)(),...(0,m.getStoriesLoadingStats)()])}),(0,m.clearStoriesNavigationStats)(),(0,m.clearStoriesLoadingStats)()):window.ajax.post("al_stories.php",{act:"read_stories",story_id:s,track_code:r,progress:n,source:this._getSource(),navigation_stats:(0,m.serializeNavigationStats)(),loading_stats:(0,m.serializeLoadingStats)(),connection_type:(0,m.getConnectionType)(),hash:e.getReadHash(),narrative_id:null==o?void 0:o.id},{onFail:e=>((0,T.logError)(new Error(`error mark seen story: ${String(e)}`)),!0)})}_getSource(){return[h.USER_INFO_MODULE,h.GROUP_INFO_MODULE,u.STORIES_MANAGE_MODULE,h.SPAMFEED_MODULE,h.ABUSE_MODULE,u.ADMIN_STORY_VIEW_MODULE].includes(window.cur.module)?window.cur.module:this._source?this._source:"list"}sendNavigationStatEvents(e,t=!0,i={}){var s;const o=this.activeStory;if(!o)return;const r=this.getStoryRaw()||(null==(s=o.getCurStoryData())?void 0:s.raw_id),n=this._getSource();t&&this._sendProductAnalyticEvents(e,i),this._updateLastStoryOpenAction(e),(0,m.saveNavigationStatEvent)({storyRawId:r,source:n,action:e})}_sendProductAnalyticEvents(e,t={}){var i;const s=this.activeStory;if(!s)return;const o=s.isActiveMetaStory(),n=this.getStoryRaw()||(null==(i=s.getCurStoryData())?void 0:i.raw_id);if(!n&&!o)return void(0,T.logError)(new Error("_sendProductAnalyticEvents: storyRawId is undefined"),{environment:"stories"});let a=0,l=0,h=0;if(n){const e=n.split("_");a=Number(e[0]),l=Number(e[1])}const u=s.getIndex(),p=s.getFullItemsLength()-u,{story:m}=s,v=this._getSource(),y=s.getCurrentNarrative();if(!e||!s)return;if(!(o||m&&a&&l))return;this.listName!==r.StoryListName.groups&&this.listName!==r.StoryListName.apps||(h=1);const w={event_type:e,story_owner_id:a,story_id:l,time:window.vk.ts+Math.floor(((new Date).getTime()-window.vk.started)/1e3),volume:100*d.getVolume(),view_entry_point:v,stories_author_before:u,stories_author_after:p,nav_screen:window.cur.module,view_event_timeline_position:m.getCurrentTime(),story_type:o?"group_feed":"",is_grouped:h,track_code:s.getTrackCode()};y&&Object.assign(w,{narrative_id:y.id,narrative_owner_id:y.ownerId}),Object.assign(w,t),(0,_.partConfigEnabled)("web_stats_transport_story_view")?(0,c.saveStoryViewStats)(w):(0,g.statlogsValueEvent)("story_product_analytics",w)}_updateLastStoryOpenAction(e){switch(e){case"go_to_next_story_tap":case"go_to_next_story_click":case"go_to_next_story_auto_by_time":this.viewerSource="next_story";break;case"go_to_previous_story":this.viewerSource="previous_story";break;case"go_to_next_author":this.viewerSource="next_author";break;case"go_to_previous_author":this.viewerSource="previous_author"}}_initViewerSource(){const e=this._getSource();switch(e){case"reply":this.viewerSource="replies_list";break;case"feed":this.viewerSource=window.cur.section;break;default:this.viewerSource=e}}sendViewerStartTime(e,t){const i=this.viewerSource;(0,m.saveViewerStartTime)({storyRawId:e,source:i,time:t})}_onVideoPlay(){const e=this.activeStory.getCurStoryData();if(!e)return void(0,T.logError)(new Error("Fail: _onVideoPlay"),{environment:"stories"});const{noSound:t}=e;t||(window.Notifier.lcSend("stories_video_start"),window.getAudioPlayer().isPlaying()&&((0,y.getAudioPlayer)().pause(),this.needAudioReset=!0))}_onVideoEnd(){this._restoreAudioPlay()}_restoreAudioPlay(){window.Notifier.lcSend("stories_video_end"),this.needAudioReset&&(window.getAudioPlayer().play(),delete this.needAudioReset)}_renderBackButton(){return this.backButton=(0,k.se)(`<div class="stories_back_button_wrap">\n  <div class="stories_back_button">\n    <div class="stories_back_button_icon"></div>\n    <div class="stories_back_button_text">${S.getLang("global_back")}</div>\n  </div>\n</div>`),(0,f.addEvent)(this.backButton,"click",(()=>{(0,p.cancelStackPop)()})),this.backButton}showBackButton(){(0,k.show)(this.backButton),this.hideAllLayers=!0,(0,k.addClass)(this.layerEl,"with_back_button")}static parseExtra(e){const t={},i=String(e).split(";");for(let e of i){const[i,s]=e.split(":");i&&s&&(t[i]=s)}return t}getAnimateFromElem(){if(!this.hideAllLayers){const e=this.getBlockKey(this.activeStory.data);if((0,k.hasClass)(this.animateFromEl,"stories_feed_reply_item")){const t=(0,k.domQuery)("#feed_story_"+e,(0,k.domPN)(this.animateFromEl))[0];if(t)return t}else if("feed"===window.cur.module&&!(0,k.isVisible)(this.backButton)){const t=(0,k.ge)("feed_story_"+e);if(t)return window.Stories.feedScrollToOwner(e),t}}return this.animateFromEl}animateStory(e,t){return new Promise((i=>{if("expand"===e&&!t||"minimize"===e&&(!this.animateFromEl||!document.body.contains(this.animateFromEl)))return(0,k.setStyle)("stories_layers_background","opacity",1),i();this.pauseStory(),(0,k.addClass)(this.layerEl,"animation"),(0,k.removeClass)(this.stories,"animated");let s="expand"===e?t:this.getAnimateFromElem();if(this.hideAllLayers&&"minimize"===e){const e=a.getFirstLayer();s=e.getAnimateFromElem(),a.slicePrevLayers(),a.layerHide()}(0,k.removeClass)(s,"stories_feed_item_ava_animate");let[o,r]=(0,k.getXY)(s);const n=(0,k.getSize)(s),d=window.innerHeight,c=Math.min(l.STORY_MAX_WIDTH,Math.max(l.STORY_MAX_HEIGHT,d*l.STORY_HORIZONTAL_RATIO)),_=c*l.STORY_VERTICAL_RATIO,h=Math.max(0,(d-_)/2),u=Math.max(0,(window.innerWidth-c)/2);o=u-o+c/2-n[0]/2+Number((0,E.scrollGetX)()),r=h-r+_/2-n[1]/2+Number((0,E.scrollGetY)()),o=-o,r=-r;let p={};"expand"===e&&(p.transform=`translate(${o}px, ${r}px) scale(0)`,this.animateFromEl=t),(0,k.setStyle)(this.activeStory.wrapEl,p),"minimize"===e&&(0,k.setStyle)(s,"transform","scale(0)"),this.animationTimer=setTimeout((()=>{(0,k.addClass)(this.stories,"animated"),(0,k.addClass)(s,"stories_feed_item_ava_animate"),this.animationTimer=setTimeout((()=>{"expand"===e?((0,k.setStyle)("stories_layers_background","opacity",1),(0,k.setStyle)(this.activeStory.wrapEl,"transform","translate(0, 0) scale(1)")):((0,k.setStyle)(this.activeStory.wrapEl,"transform",`translate(${o}px, ${r}px) scale(0.01)`),(0,k.setStyle)(s,"transform","scale(1)")),this.animationTimer=setTimeout((()=>{i(),"expand"===e?((0,k.setStyle)(this.activeStory.wrapEl,"transform",""),(0,k.removeClass)(this.layerEl,"animation"),(0,k.removeClass)(this.stories,"animated"),this.playStory(),a.layerShown()):((0,k.removeClass)(s,"stories_feed_item_ava_animate"),(0,k.setStyle)(s,"transform",""))}),330)}),30)}),30)}))}pauseLayer(){this.pauseStory(),(0,k.addClass)(this.layerEl,"paused")}resumeLayer(){this._updateVolumeButton(),this.activeStory.volumeUpdate(),this.activeStory&&(this.updateLocation(),window.cur.storyLayer.activeStory.isActiveMetaStory()&&this.updateMetaStoryItems(),this.activeStory.isFeedbackTooltipShow&&this.activeStory.updateBottom(),this.playStory(),(0,k.removeClass)(this.layerEl,"paused"))}updateMetaStoryItems(){var e,t;if(!(null==(e=window.cur.storyLayer)||null==(t=e.activeStory)?void 0:t.isActiveMetaStory()))return;if(!(this.activeStory.story instanceof P.MetaStory))return;const i=this.activeStory.story.getList();if(!i||!i.length||i.every((e=>!e)))return window.cur.storyLayer.activeStory.remove(),this.hideAllLayers=!0,void this.hide();this.activeStory.updateMetaStory()}setLayerVisibility(e){(0,k.toggle)(this.layerEl,e)}_renderVolumeControl(){return this.volumeControl=(0,k.se)('<div class="stories_volume_control">\n  <div class="stories_volume_control_slide_wrap">\n    <div class="stories_volume_control_slide">\n      <div class="stories_volume_control_slide_indicator"></div>\n    </div>\n  </div>\n</div>'),(0,f.addEvent)((0,k.geByClass1)("stories_volume_control_slide_wrap",this.volumeControl),"mousedown",this._volumeControlOnMouseDown.bind(this)),(0,f.addEvent)(this.volumeControl,"mousedown",this._volumeControlOnClick.bind(this)),this.volumeControlContainer=(0,k.ce)("div",{className:"stories_volume_control_container"}),this.volumeControlContainer.appendChild(this.volumeControl),this.volumeControlContainer}_volumeControlOnMouseDown(e){(0,k.addClass)(this.volumeControlContainer,"changing");const t=(0,k.geByClass1)("stories_volume_control_slide",this.volumeControl),i=(0,k.geByClass1)("stories_volume_control_slide_indicator",t),[s]=(0,k.getXY)(t),[o]=(0,k.getSize)(t),r=e=>{const t=Math.max(0,Math.min(e.pageX-s,o))/o*100;(0,k.setStyle)(i,"width",`${t}%`),d.setVolume(t/100),this.activeStory.volumeUpdate()},n=()=>{(0,f.removeEvent)(window,"mousemove",r),(0,f.removeEvent)(window,"mouseup",n),this._updateVolumeButton(),(0,k.removeClass)(this.volumeControlContainer,"changing")};(0,f.addEvent)(window,"mousemove",r),(0,f.addEvent)(window,"mouseup",n),r(e)}_updateVolumeButton(){let e=100*d.getVolume();(0,k.toggleClass)(this.volumeControl,"low",e>0&&e<50),(0,k.toggleClass)(this.volumeControl,"high",e>=50);const t=(0,k.geByClass1)("stories_volume_control_slide_indicator",this.volumeControl);(0,k.setStyle)(t,"width",`${e}%`)}_volumeControlOnClick(e){if((0,k.hasClass)(e.target,"stories_volume_control_slide_wrap")||(0,k.hasClass)(this.volumeControlContainer,"changing"))return;let t=d.getVolume();t=t?0:1,d.setVolume(t),this._updateVolumeButton(),this.activeStory.volumeUpdate()}onReplyDeleted(e){this.activeStory&&this.activeStory.onReplyDeleted(e)}_hasContext(e){return this.extra&&this.extra.context&&this.extra.context===e}constructor(e=0,t=0,i="",s="",o,r,n,a){this.hasUnloadedDiscover=!1,this.options={},this.options=a;try{window.Videoview&&window.Videoview.togglePlay(!1)}catch(e){}this.initDOM(),this.show(),this._init(e,t,i,s,o,r,n),(0,k.addClass)(this.layerEl,"shown"),this._source=a.source,this._initViewerSource(),this._sendOpeningEvents()}}},706789:(e,t,i)=>{i.d(t,{default:()=>_});var s=i(338384),o=i(964262),r=i(652027),n=i(809915),a=i(29271),l=i(795558),d=i(930776),c=i(931917);class _ extends s.MediaStory{render(){this.onStartLoading(),this.el=(0,l.ce)("div",{className:"stories_live"});const e=(0,l.ce)("div",{className:"stories_live_player"},{height:"100%",width:"100%"});return this.el.appendChild(e),this.chatEl=(0,l.se)('\n      <div class="stories_live_chat">\n        <div class="mv_chat_messages_wrap">\n          <div class="mv_chat_messages"></div>\n        </div>\n        <div class="mv_chat_stickers_wrap"></div>\n      </div>\n    '),this.el.appendChild(this.chatEl),window.mvcur&&window.mvcur.player&&window.Videoview.hide(!1,!0),setTimeout((()=>{(0,r.showInlineVideo)(this.videoRaw,"",{autoplay:1,module:"story",onLoaded:()=>{this._onPlayerInited()}},!1,e)})),this.el}destroy(){super.destroy(),this._resetTimer(),window.mvcur={},this.player&&(this.player.destroy(),n.VideoChat.destroy()),window.cur.storyLayer.sendNavigationStatEvents("live_player_close",!1),delete this.el}getContainer(){return this.el||this.render()}onLiveEnded(){this.liveEnded=!0,(0,l.hide)((0,l.geByClass1)("_error_msg",(0,l.geByClass1)("videoplayer_error")));let e=c.Ranges.isGroupId(this.mvData.oid)?a.getLang("stories_live_ended_desc_club"):(0,a.langSex)(this.mvData.author_sex,a.getLang("stories_live_ended_desc_user","raw"));e=e.replace("{name}",this.mvData.md_author);const t=c.Ranges.isGroupId(this.mvData.oid)?a.getLang("stories_live_ended_open_club"):a.getLang("stories_live_ended_open_user");(0,l.hide)(this.chatEl),(0,l.hide)((0,l.domByClass)(this.player.ui.thumb,"videoplayer_big_play_btn"));const i=window.cur.storyLayer.renderedStoryBlockKeys.length>1;this.el.appendChild((0,l.se)(`\n    <div class="stories_live_end">\n      <div class="stories_live_end_author_photo" style="background-image: url(${this.mvData.author_photo})"></div>\n      <div class="stories_live_end_title">${a.getLang("stories_live_ended_title")}</div>\n      <div class="stories_live_end_desc">${e}</div>\n      <a href="${this.mvData.author_href}" class="stories_live_end_open_owner">${t}</a>\n      <div class="stories_live_end_timer" onclick="cur.storyLayer.nextStory()" style="${i?"":"display: none;"}">\n        <canvas class="_timer_canvas" width="100" height="100"></canvas>\n        <div class="stories_live_end_timer_text">${a.getLang("stories_live_ended_watch_next")}</div>\n      </div>\n    </div>\n    `)),i&&setTimeout((()=>{this._startTimer()})),(0,d.markLiveInStoriesFinished)(this.data.owner_id)}pause(){}play(){this.player&&!this.liveEnded&&(super.play(),this.player&&this.player.play())}sendMessage(e,t){e.length>window.mvcur.maxChatReplyLength||(window.ajax.post("al_video.php?act=post_comment",{comment:e,video:this.videoRaw,hash:this.mvData.hash,videoviewer_chat:1}),window.cur.storyLayer.activeStory.onAnswerSent(t))}volumeUpdate(){this.player.setVolume(o.getVolume())}canPlay(){super.canPlay(),(0,l.setStyle)(this.el,"opacity",1)}_onPlayerInited(){this.canPlay(),this.player=window.cur.videoInlinePlayer,this.play(),window.cur.storyLayer.sendNavigationStatEvents("live_player_show",!1),window.browser.safari&&this.player.toggleMute(!0,!1),this.mvData=window.Videoview.getMvData(),window.mvcur={chatMode:!0,maxChatReplyLength:this.mvData.maxChatReplyLength,mvData:this.mvData,mvShown:!0,queueKey:this.mvData.queue_params.key,qversion:this.mvData.qversion},n.VideoChat.init(this.chatEl,{scrollHidden:!0}),window.Videoview.queueCheckUpdates(this.mvData.queue_params)}_startTimer(){if(!window.CanvasRenderingContext2D)return;const e=(0,l.domByClass)(this.el,"_timer_canvas"),t=e.getContext("2d");t.lineWidth=6,t.lineCap="round",t.strokeStyle="#fff";const i=Date.now(),s=()=>{const e=(Date.now()-i)/5e3;e<1?(t.clearRect(0,0,100,100),t.beginPath(),t.arc(50,50,47,-Math.PI/2,-Math.PI/2+2*Math.PI*e),t.stroke(),this._nextTO=setTimeout(s,16)):window.cur.storyLayer.nextStory()};(0,l.show)(e),this.timerInProgress=!0,s()}_resetTimer(){window.CanvasRenderingContext2D&&(clearTimeout(this._nextTO),this.timerInProgress=!1,(0,l.hide)((0,l.domByClass)(this.el,"_timer_canvas")))}setCurrentTime(){}getCurrentTime(){return 0}getDuration(){return 0}constructor(e,t,i){super(e,t),this.wrapEl=i,this.videoRaw=`${this.data.video.owner_id}_${this.data.video.video_id}`}}},232630:(e,t,i)=>{i.d(t,{default:()=>u,loadMedia:()=>h});var s=i(795558);const o={},r={},n=[];let a,l=!1,d=!1;function c(e,t,i){const s=r[e];if(s)for(let e=0;e<s.length;e++){const o=s[e];t?o.resolve(i):o.reject(),s.splice(e,1),e--}}function _(e){l&&l.postMessage({cmd:"load",url:e})}function h(e){return l||(l=new Worker("/dist/workers/stories_loader_worker.js"),l.onmessage=e=>{const t=e.data;switch(t.type){case"loaded":o[t.url]=t.data,c(t.url,!0,t.data);break;case"error":c(t.url,!1);break;case"inited":d=!0;for(let e=0;e<n.length;e++)_(n[e])}}),new Promise(((t,i)=>{if(e||t(""),o[e])return t(o[e]);const s=function(e){return e.match(/\.mp4/)?"video":e.match(/\.(png|jpg|jpeg|gif)/)||e.match(/\.mycdn\.me\/getVideoPreview/)?"image":void 0}(e);switch(s){case"video":case"image":r[e]||(r[e]=[]);const s=0===r[e].length;if(r[e].push({resolve:t,reject:i}),!s)return;d?_(e):n.push(e);break;default:window.vk.dev&&console.error("wrong media url")}}))}function u(e,t){return a||function(){const e=function(e){try{if(e.contentDocument)return e.contentDocument;if(e.contentWindow&&e.contentWindow.document)return e.contentWindow.document}catch(e){}return!1}(window.utilsNode.appendChild(document.createElement("iframe")));a=e&&e.body?e.body:window.utilsNode.appendChild((0,s.ce)("div",{},{display:"none"}))}(),"video"===t||e.match(/\.mp4/)?function(e){return new Promise(((t,i)=>{const o=(0,s.ce)("video",{});o.oncanplay=()=>{t(),(0,s.re)(o)},o.onerror=()=>{i(),(0,s.re)(o)},a.appendChild(o),o.src=e}))}(e):function(e){return new Promise(((t,i)=>{const o=new Image;o.onload=()=>{t(),(0,s.re)(o)},o.onerror=()=>{i(),(0,s.re)(o)},a.appendChild(o),o.src=e}))}(e)}},338384:(e,t,i)=>{i.d(t,{MediaStory:()=>o});var s=i(761417);class o extends s.BaseStory{destroy(){clearTimeout(this.longLoadingTimer)}getId(){return this.data.raw_id}getTrackCode(){return this.data.track_code}getDate(){return this.data.date}getViews(){return this.data.views}getReplies(){return this.data.replies}setViews(e){this.data.views=e}setReplies(e){this.data.repliesCountText=e}isOneTime(){return this.data.isOneTime&&this.data.authorId!==window.vk.id}onStartLoading(){this.longLoadingTimer=setTimeout((()=>{var e,t;this.isLoaded()||null==(t=(e=this.options).onLongLoading)||t.call(e)}),1e3),super.onStartLoading()}canPlay(){clearTimeout(this.longLoadingTimer),this.data.seenProgress&&this.isOneTime()&&this.setCurrentTime(+(this.data.seenProgress*this.getDuration()/100).toFixed(1)),super.canPlay()}_loadingError(){this._error("load")}_isFailed(){return this.failed}_error(e){var t,i;clearTimeout(this.longLoadingTimer),null==(i=(t=this.options).onError)||i.call(t,e)}constructor(e,t,i){super(t),this.longTapInfoWrapper=()=>{window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.longTapHandle()},this.data=e;const{is_expired:s,is_deleted:o,is_private:r,isOneTimeSeen:n}=e;s?this._error("expired"):o?i?this._error("deleted-narrative"):this._error("deleted"):n?this._error("isOneTimeSeen"):r&&(i?this._error("private-narrative"):this._error("private")),(s||o||r||n)&&(this.failed=!0)}}},601618:(e,t,i)=>{i.d(t,{MetaStory:()=>n});var s=i(160416),o=i(761417),r=i(973935);class n extends o.BaseStory{getCurrentTime(){return Date.now()-this.startTs||0}getDuration(){return s.STORY_DURATION}play(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),super.play()}pause(){this.isPaused()||(super.pause(),this.pauseTime=this.getCurrentTime())}setCurrentTime(e=0){this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)}render(){return this.canPlay(),this.wrapper=document.createElement("div"),this.wrapper.classList.add("MetaStoryWrapper"),this.update(),this.wrapper}canPlay(){setTimeout((()=>{super.canPlay(),window.cur.storyLayer.sendNavigationStatEvents(this.viewEventType,!0)}))}getList(){return this.block.grouped}destroy(){r.unmountComponentAtNode(this.wrapper),this.isDestroyed=!0,this.wrapper.remove()}constructor(e,t){super(t),this.pauseTime=0,this.isDestroyed=!1,this.viewEventType="group_feed_view",this.isPausedByMetaScroll=!1,this.onScroll=e=>{this.isPausedByMetaScroll=e},this.block=e}}},21338:(e,t,i)=>{i.d(t,{default:()=>a});var s=i(160416),o=i(232630),r=i(338384),n=i(795558);class a extends r.MediaStory{render(){if(this.onStartLoading(),this.photo)return this.photo;const{photo_url:e}=this.data;return this.photo=document.createElement("div"),this.photo.setAttribute("class","stories_photo"),this._isFailed()||(0,o.loadMedia)(e).then((e=>{this.photo&&((0,n.setStyle)(this.photo,"backgroundImage",`url('${e}')`),this.canPlay())})).catch((()=>{this._loadingError()})),this.photo}getContainer(){return this.photo||this.render()}destroy(){super.destroy(),delete this.photo}play(){(0===this.startTs||this.pauseTime>0)&&(this.startTs=Date.now()-this.pauseTime,this.pauseTime=0),super.play()}pause(){this.isPaused()||(super.pause(),this.pauseTime=this.getCurrentTime())}setCurrentTime(e=0){this.startTs=Date.now()-e,this.isPaused()&&(this.pauseTime=e)}getCurrentTime(){return Date.now()-this.startTs||0}getDuration(){return s.STORY_DURATION}canPlay(){super.canPlay(),window.cur.storyLayer.sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0}),(0,n.setStyle)(this.photo,"opacity",1)}constructor(e,t,i){super(e,t,i),this.pauseTime=0}}},418056:(e,t,i)=>{i.d(t,{Stories:()=>f});var s=i(517366),o=i(391128),r=i(232630),n=i(273302),a=i(795558),l=i(258016),d=i(258810),c=i(953908),_=i(672132),h=i(29271),u=i(82161),p=i(584356),m=i(514986),g=i(725296),v=i(970978),y=i(964262),w=i(321850);const S={},f={show(e,t={},i){f.getPreparedList(e,i,t).then((({ownerId:e,storyId:i,uniqKey:s,blockKey:r,listName:a,list:l,extra:d})=>{n.isOpeningLocked()||(n.checkAndPrepareBoxQueue(t),n.addLayer(new o.StoryLayer(e,i,s,r,a,l,d,t),t))})).catch((e=>{console.error(e),(0,v.logError)(e),(0,m.showFastBox)(h.getLang("global_error"),h.getLang("global_unknown_error"))}))},_getUnreadStory(e,t){e=(0,u.intval)(e);let i=!1;for(let s=0;s<t.length;s++)if(t[s].author.id===e){const e=t[s].items;for(let t=0;t<e.length;t++)if(e[t].unread){i=e[t];break}i||(i=e[0]);break}return i},getPreparedList(e,t,i){return new Promise(((o,r)=>{const[n,a,l,d,c,_]=this.parseList(e);if(!n&&!d&&!c)return void r(`Can not find a correct block key or list name in: ${e}`);let h={ownerId:(0,u.intval)(n),storyId:(0,u.intval)(a),uniqKey:l||"",blockKey:d||"",listName:c,extra:_,list:[]};if(!t)switch(c){case s.StoryListName.discover:if(!(t=(0,y.getStoryList)(c))){let e;const i=(0,y.getStoryList)(s.StoryListName.feed);if(i&&(e=i.find((e=>e.type===s.StoryBlockType.discover)),(null==e?void 0:e.grouped)&&(t=e.grouped)),!t)return void(0,y.preloadDiscoverList)(!0).then((e=>{h.list=e,o(h)})).catch(r)}break;case s.StoryListName.groups:case s.StoryListName.apps:{const e=e=>{const t=e.find((e=>c===s.StoryListName.groups?e.type===s.StoryBlockType.communityGroupedStories:e.type===s.StoryBlockType.appGroupedStories));(null==t?void 0:t.grouped)?(h.list=null==t?void 0:t.grouped,o(h)):r()},t=(0,y.getStoryList)(s.StoryListName.feed);return void(t?e(t):f.fetchList(s.StoryListName.feed,n,_,null==i?void 0:i.trackCode).then(e).catch(r))}default:t=(0,y.getStoryList)(c)}t?(h.list=t,o(h)):f.fetchList(c,n,_,null==i?void 0:i.trackCode).then((e=>{e&&(h.list=e,o(h))})).catch(r)}))},setList(e,t){window.cur[`stories_list_${e}`]=t},fetchList:(e,t,i,s)=>new Promise(((o,r)=>{window.ajax.post("al_stories.php",{act:"get_list",list:e,owner_id:t,extra:i,track_code:s},{loader:!0,onDone(t){f.setList(e,t),o(t)},onFail:e=>(r(e),!0)})})),removeList(e){delete window.cur[`stories_list_${e}`]},parseList(e){e.match(/story/)&&(e=decodeURIComponent(e));const t=e.match(/^(?:story)?(?:(-?\d+)(?:_(\d+))?(?:&([a-z0-9]+))?|([a-z0-9]+))?(?:\/([a-z0-9_\-]+))?(?:\/([a-z0-9_:;\-]+))?$/i);if(!t)return[];const[,i,s,o,r,n,a]=t;return[i,s,o,r,n,a]},initFeed(e="stories_feed_items_container"){"string"==typeof e&&(e=(0,a.ge)(e));let t=(0,a.geByClass1)("stories_feed_items",e),i=(0,a.attr)(t,"id");f.updateFeedArrows(i);const s=()=>{(0,c.addEvent)(e,"wheel",this.feedMouseWheel)},o=()=>{(0,c.removeEvent)(e,"wheel",this.feedMouseWheel)};(0,c.addEvent)(e,"mouseenter",s),(0,c.addEvent)(e,"mouseleave",o),(0,w.pushNavDestroy)((()=>{(0,c.removeEvent)(e,"wheel",this.feedMouseWheel),(0,c.removeEvent)(e,"mouseenter",s),(0,c.removeEvent)(e,"mouseleave",o)}))},feedNext(e){let t=(0,a.ge)("stories_feed_wrap");return e&&(t=(0,a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("next",null,t)},feedPrev(e){let t=(0,a.ge)("stories_feed_wrap");return e&&(t=(0,a.domClosest)("stories_feed_wrap",e.target)),this.feedPaging("prev",null,t)},feedPaging(e,t,i){i||(i=(0,a.ge)("stories_feed_wrap"));let s=(0,a.geByClass1)("stories_feed_items",i),o=(0,a.attr)(s,"id"),r=`${o}_position`,n=S[r]||0;const l=(0,a.getSize)(i)[0];if((0,u.isNumeric)(e))n+=Number(e);else{const t=l-100;"next"===e?n+=t:n-=t}S[r]=Math.max(0,Math.min(n,s.scrollWidth-l)),t?(0,a.removeClass)(s,"animated"):(0,a.addClass)(s,"animated"),(0,a.setStyle)(s,"transform",`translateX(-${S[r]}px)`),f.updateFeedArrows(o)},feedScrollToOwner(e){const t=(0,a.ge)(`feed_story_${e}`);if(!t)return;const i=(0,a.domClosest)("stories_feed_items",t),s=i.offsetWidth,o=`${(0,a.attr)(i,"id")}_position`,r=t.offsetWidth,n=t.offsetLeft,l=(0,a.domClosest)("stories_feed_wrap",i);S[o]=n-s+s/2+r/2,f.feedPaging(0,!0,l)},updateFeedStories(e,t,i="stories_feed_items"){let s=(0,a.ge)(i),o=(0,a.domClosest)("stories_feed_wrap",s);if(e=e||"news",!s)return;if(!(0,u.inArray)(e,["news","search"]))return void(0,a.hide)(o);const r=(e,s)=>{t&&t.cb&&t.cb(),this.setList("feed",s),window.cur.storyLayer&&window.cur.storyLayer.updateMetaStoryItems();const r=(0,a.ge)(i);r&&(e?((0,a.setStyle)(r,"transform","translateX(0px)"),(0,a.val)(r,e),r.children.length<6?(0,a.addClass)(o,"stories_feed_not_nav_buttons"):(0,a.removeClass)(o,"stories_feed_not_nav_buttons"),S[i+"_position"]=0,f.updateFeedArrows(i),(0,a.show)(o)):(0,a.hide)(o))};if(t&&t.stories){const{section:e,q:i,stories:s}=t,{html:n,js:l}=s,d=l.feed?l.feed:[];return"search"!==e||i&&d.length?void r(n,l):void(0,a.hide)(o)}window.ajax.post("al_stories.php",{act:"feed_stories"},{onDone:r})},feedMouseWheel(e){const t=(0,a.domClosest)("stories_feed_wrap",e.target);if((0,a.hasClass)(t,"stories_feed_not_nav_buttons"))return;(0,c.cancelEvent)(e);const i=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;f.feedPaging(i,!0,t)},updateFeedArrows(e="stories_feed_items"){let t=(0,a.ge)(e),i=e+"_position";if(!t)return;S[i]||(S[i]=0);const s=(0,a.geByClass1)("stories_feed_wrap").offsetWidth,o=t.scrollWidth-s,r=(0,a.geByClass1)("stories_feed_arrow_left",(0,a.domPN)(t)),n=(0,a.geByClass1)("stories_feed_arrow_right",(0,a.domPN)(t));0===S[i]?(0,a.addClass)(r,"disabled"):(0,a.removeClass)(r,"disabled"),S[i]===o||o<=0?(0,a.addClass)(n,"disabled"):(0,a.removeClass)(n,"disabled")},showBlackList(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory(),(0,m.showBox)("al_stories.php",{act:"black_list"},{onDone(){window.cur.storiesBlackListScroll=new d.default("stories_black_list_result")},params:{onHide:()=>{window.cur.storyLayer&&window.cur.storyLayer.playStory()}}})},blackListItemClick(e,t){(0,c.cancelEvent)(t);const i=(0,u.intval)((0,a.attr)(e,"data-id"));window.cur.storiesBlackListShown[i]?(delete window.cur.storiesBlackListShown[i],(0,a.removeClass)(e,"olist_item_wrap_on")):(window.cur.storiesBlackListShown[i]=1,(0,a.addClass)(e,"olist_item_wrap_on"))},saveBlackList(e){const t=Object.keys(window.cur.storiesBlackListShown);0!==t.length?window.ajax.post("al_stories.php",{act:"save_blacklist",hash:window.cur.storiesBlackList.hash,list:t.join(",")},{onDone(){f.updateFeedStories(),(0,p.curBox)().hide()},showProgress:()=>(0,g.lockButton)(e),hideProgress:()=>(0,g.unlockButton)(e)}):(0,p.curBox)().hide()},blacklistUpdateUsers(e){const t=e;if(e=(0,u.trim)(e).toLowerCase(),window.cur.storiesBlacklistLastQ===e)return;window.cur.storiesBlacklistLastQ=e;const i=e?window.cur.storiesIndexer.search(e):window.cur.storiesBlackList.users,s=[];if(e)for(let t=0;t<e.length;t++)s.push(e.substr(t,1));const o=new RegExp(s.join(".*?"),"i");let r="";for(let t=0;t<i.length;t++){const s=i[t],n=e?s.name.replace(o,(e=>`<em>${e}</em>`)):s.name;r+=window.cur.storiesBlackList.tpl.replace(/\{id\}/g,s.id).replace("{photo}",s.photo).replace("{name}",n).replace("{href}",s.href).replace("{class_name}",window.cur.storiesBlackListShown[s.id]?" olist_item_wrap_on":"")}r||(r=`<div class="no_rows">${h.getLang("global_search_not_found").replace("{search}",(0,u.clean)(t))}</div>`),(0,a.val)((0,a.geByClass1)("olist","stories_black_list_result"),r)},blackListInit(e){window.cur.storiesBlackListShown={},window.cur.storiesBlackList=e,(0,p.curBox)().setOptions({width:450,bodyStyle:"padding: 0px",onClean:function(){this.storyLayer&&this.storyLayer.playStory(),window.cur.storiesBlackListScroll&&window.cur.storiesBlackListScroll.destroy()}}).removeButtons(),window.cur.storiesBlackList.users.length?(window.cur.storiesBlacklistLastQ=!1,window.cur.storiesIndexer=new _.vkIndexer(window.cur.storiesBlackList.users,(e=>e.name),(()=>{f.blacklistUpdateUsers("")})),l.default.init("stories_blacklist"),l.default.focus("stories_blacklist"),(0,p.curBox)().addButton(h.getLang("global_save"),this.saveBlackList).addButton(h.getLang("global_cancel"),void 0,"no")):(0,p.curBox)().addButton(h.getLang("global_close"))},preloadUrl(e){(0,r.loadMedia)(e).catch((e=>{(0,v.logError)(e)}))},groupStoriesBlockUpdate(){const e=(0,y.getStoryList)("group_stories"),t=e&&e[0]&&e[0].items;if(!t)return;let i=0;for(let e=0;e<t.length;e++){t[e].unread&&i++}const s=(0,a.geByClass1)("stories_groups_block_stories_wrap"),o=(0,a.geByClass1)("stories_groups_block_stories_button",s);(0,a.toggleClass)(s,"has_unread",i>0),(0,a.toggleClass)(s,"has_stories",t.length>0),(0,a.toggleClass)(o,"has_stories",t.length>0);const r=(0,u.clone)(window.cur.storiesPreviews);let n=r.splice(r.length-i,3);n.length<3&&(n=n.concat(r.slice(0,3-n.length))),n.reverse();let l="";for(let e=n.length-1;e>=0;e--)l+=window.cur.storiesPreviewsRowHtml.replace("{url}",n[e]);(0,a.val)((0,a.geByClass1)("stories_groups_block_stories_rows",s),l)},isLiveShown(e){if(!window.cur.storyLayer||!window.cur.storyLayer.activeStory||!window.cur.storyLayer.activeStory.isActiveLive())return!1;return window.cur.storyLayer.activeStory.story.videoRaw===e},activeLiveEnded(e){window.cur.storyLayer.activeStory.onLiveEnded(e)},updateLiveViewersCount(e){const t=e?h.getLang("stories_live_N_watching",e,!0):"";window.cur.storyLayer.activeStory.updateLiveViewersCount(t)},updatePagePhotosModule:()=>new Promise(((e,t)=>{window.ajax.post("al_profile.php",{act:"get_page_photos_module"},{onDone:t=>{const{Stories:i}=window;(0,a.val)("page_photos_module",t),t||(0,a.hide)("profile_photos_module"),null==i||i.removeList("profile"),e()},onFail:()=>(t(),!0)})}))}},713417:(e,t,i)=>{i.d(t,{STORY_HORIZONTAL_RATIO:()=>s,STORY_MAX_HEIGHT:()=>n,STORY_MAX_WIDTH:()=>r,STORY_VERTICAL_RATIO:()=>o});const s=.563,o=1.78,r=540,n=320},273302:(e,t,i)=>{i.d(t,{addLayer:()=>c,checkAndPrepareBoxQueue:()=>S,getFirstLayer:()=>m,getPrevLayer:()=>g,hideAllLayers:()=>p,isOpeningLocked:()=>f,layerHide:()=>u,layerShown:()=>h,onReplyDeleted:()=>y,removeLayer:()=>_,slicePrevLayers:()=>v});var s=i(196026),o=i(953908),r=i(795558),n=i(584356);let a=[],l=!1;const d={visibilitychange:()=>{window.cur.storyLayer&&window.cur.storyLayer.onVisibilityChange()},resize:()=>{window.cur.storyLayer&&window.cur.storyLayer.onResize()},keydown:e=>{window.cur.storyLayer&&window.cur.storyLayer.onKeyDown(e)},keyup:e=>{window.cur.storyLayer&&window.cur.storyLayer.onKeyUp(e)}};function c(e,t){window.cur.storyLayer&&window.cur.storyLayer.pauseLayer(),(0,r.ge)("stories_layers_background")||(document.body.appendChild((0,r.ce)("div",{id:"stories_layers_background",className:"stories_layers_background"})),window.layerQueue.hide(),window.layerQueue.push(),window.layers.fullhide=p,(0,o.addEvent)(window,"visibilitychange",d.visibilitychange,void 0,void 0,!0),(0,o.addEvent)(window,"resize",d.resize),(0,o.addEvent)(document,"keydown",d.keydown),(0,o.addEvent)(document,"keyup",d.keyup)),window.cur.storyLayer=e,l=!0,e.animateStory("expand",t.fromEl).catch((()=>{})).finally((()=>{l=!1})),a.push(e),(0,r.addClass)(document.body,"stories_layer_shown"),(0,s.cancelStackPush)(`stories_layer_close${a.length}`,((t={})=>{t.byTimer?e.sendNavigationStatEvents("close_auto_by_time"):e.sendNavigationStatEvents("close_tap"),a.length>1&&!t.isCloseBtnClick?e.back():(e.hideAllLayers=t.isCloseBtnClick,e.hide(!1))}))}function _(){a.pop(),window.cur.storyLayer=a[a.length-1],window.cur.storyLayer?window.cur.storyLayer.resumeLayer():(p(!0),window.layerQueue.pop(),window.cur.storiesCashedBoxQueueData&&((0,n.restoreBoxQueue)(window.cur.storiesCashedBoxQueueData),function(){const e=w();e&&(e.forceHide=!1,e._show(!0,!1,!0))}(),delete window.cur.storiesCashedBoxQueueData))}function h(){a.length>1&&(a[a.length-2].setLayerVisibility(!1),a[a.length-1].showBackButton())}function u(){a.length>1?a[a.length-2].setLayerVisibility(!0):(0,r.setStyle)("stories_layers_background","opacity",0)}function p(e=!1){for(let e=0;e<a.length;e++)a[e].hide(!0);if(window.layers.fullhide=!1,(0,r.removeClass)(document.body,"stories_layer_shown"),(0,r.re)("stories_layers_background"),(0,o.removeEvent)(window,"visibilitychange",d.visibilitychange),(0,o.removeEvent)(window,"resize",d.resize),(0,o.removeEvent)(document,"keydown",d.keydown),(0,o.removeEvent)(document,"keyup",d.keyup),e){const e=window.nav.objLoc;delete e.w,window.nav.setLoc(e)}window.cur.needUpdateFeedStories&&window.Stories.updateFeedStories(),a=[]}function m(){return a[0]}function g(){return a[a.length-2]}function v(){for(let e=a.length-2;e>=0;e--)a[e].doHide(!0);a.splice(0,a.length-1)}function y(e){for(let t=0;t<a.length;t++)a[t].onReplyDeleted(e)}function w(){var e;if(!(null==(e=window._message_boxes)?void 0:e.length))return null;const t=window._message_boxes.filter(Boolean);return t.length?t[t.length-1]:null}function S(e){(0,n.curBox)()&&(e.fromEl=null,function(){const e=w();e&&(e._hide(!1,!0,!0),e.forceHide=!0)}(),window.cur.storiesCashedBoxQueueData=(0,n.getAndCleanBoxQueueData)())}function f(){return l}window.LayersX=a},964262:(e,t,i)=>{i.d(t,{createUserStackMaskIfNeeded:()=>m,fetchDiscover:()=>h,getStoryBlockKey:()=>p,getStoryList:()=>d,getVolume:()=>a,isDiscoverLoading:()=>u,isNewDesignEnabled:()=>g,preloadDiscoverList:()=>_,removeStoryList:()=>c,setVolume:()=>l});var s=i(517366),o=i(795558),r=i(839470),n=i(321850);function a(){const e=window.ls.get("video_volume");return"number"==typeof e?Math.min(1,Math.max(0,e)):1}function l(e){window.ls.set("video_volume",e)}function d(e){return window.cur[`stories_list_${e}`]}function c(e){delete window.cur[`stories_list_${e}`]}function _(e=!1){if(window.cur.storiesDiscoverFetchingPromise)return window.cur.storiesDiscoverFetchingPromise;let t,i;const o=d(s.StoryListName.feed);return o&&(i=o.find((e=>e.type===s.StoryBlockType.discover)),i&&(t=i.track_code)),window.cur.storiesDiscoverFetchingPromise=h("",t,e).then((([e,t])=>(i&&(i.grouped=e,i.next_from=t),e))).finally((()=>{delete window.cur.storiesDiscoverFetchingPromise})),window.cur.storiesDiscoverFetchingPromise}function h(e="",t="",i=!1,s=15){return new Promise(((o,r)=>{window.ajax.post("al_stories.php",{act:"get_discover",start_from:e,count:s,track_code:t},{loader:i,onDone:(e,t)=>{o([e,t])},onFail:e=>(r(e),!0)})}))}function u(){return Boolean(window.cur.storiesDiscoverFetchingPromise)}function p(e){var t,i,s;return(null==e||null==(t=e.author)?void 0:t.id)&&(null==e||null==(i=e.narrative)?void 0:i.id)?`${e.author.id}narrative${null==(s=e.narrative)?void 0:s.id}`:`${e.id}`}function m(){const e="users_stack_stories_mask";let t=document.getElementById(e);t||(t=(0,o.se)(`\n        <svg width="0" height="0">\n          <defs>\n            <clipPath id="${e}">\n              <path transform="translate(1.5 0)" d="M1.20772 8C1.20772 6.32671 0.768742 4.75626 0 3.39821C1.44342 1.34278 3.8277 0 6.52463 0C10.9293 0 14.5 3.58172 14.5 8C14.5 12.4183 10.9293 16 6.52463 16C3.8277 16 1.44342 14.6572 0 12.6018C0.768742 11.2437 1.20772 9.6733 1.20772 8Z"></path>\n            </clipPath>\n          </defs>  \n        </svg>  \n      `),t&&(document.body.appendChild(t),(0,n.pushNavDestroy)((()=>{null==t||t.remove()}))))}function g(){return(0,r.partConfigEnabled)("story_reactions_sending_feature_web")}},676499:(e,t,i)=>{i.d(t,{Story:()=>ie});var s=i(785893),o=i(517366),r=i(667294),n=i(973935),a=i(232630),l=i(273302),d=i(755495),c=i(102499),_=i(706789),h=i(191157),u=i(21338),p=i(112100),m=i(398695),g=i(365035),v=i(795558),y=i(790287),w=i(84543),S=i(196026),f=i(725296),E=i(953908),b=i(82161),k=i(221780),T=i(514986),C=i(584356),M=i(320422),L=i(755320),P=i(705758),I=i(10645),A=i(95432),B=i(970978),D=i(630892),x=i(839470),O=i(880660),N=i(858069),R=i(965109),F=i(338384),U=i(601618),j=i(907215),H=i(252886),W=i(481879),K=i(750555),V=i(289758),q=i(464701),$=i(380713),z=i(145298),G=i(964262),Q=i(599809),Y=i(42977),X=i(514995),Z=i(930776),J=i(321850),ee=i(104677),te=i(931917);class ie{destroy(){if(this._destroyStory(),(0,x.partConfigEnabled)("avatar_component_refactor_web")){const e=this.wrapEl.querySelector(".stories_author_avatar");e&&n.unmountComponentAtNode(e)}(0,E.removeEvent)((0,v.geByClass1)("stories_item_cont",this.contWrap)),(0,E.removeEvent)(this.shareButton),delete this.shareButton,(0,E.removeEvent)(this.followBtn),delete this.followBtn,(0,E.removeEvent)(this.answersEl),delete this.answersEl,clearTimeout(this.showMessageTimer);const e=(0,v.geByClass)("stories_time_line",this.timeLineEl);for(let t=0;t<e.length;t++)(0,E.removeEvent)(e[t]);(0,E.removeEvent)(this.viewsButton),(0,E.removeEvent)((0,v.geByClass1)("stories_link",this.wrapEl)),delete this.contWrap,delete this.backButton,delete this.descEl,delete this.timeLineEl,delete this.authorButtons,delete this.inlineLoader,this.wrapEl&&this.wrapEl.parentNode&&this.wrapEl.parentNode.removeChild(this.wrapEl),delete this.wrapEl,(0,p.clear)()}_destroyTimeLine(){const e=(0,v.geByClass)("stories_time_line",this.timeLineEl);for(let t=0;t<e.length;t++)(0,E.removeEvent)(e[t])}getOwnerId(){var e,t;return null==(e=this.data)||null==(t=e.author)?void 0:t.id}getIndex(){return this.index}getRawId(){return this.story instanceof F.MediaStory&&this.story?this.story.getId():""}getStoryId(){var e;const t=this.getRawId();return Number(null==(e=null==t?void 0:t.split("_"))?void 0:e[1])||0}getTrackCode(){if(this.story instanceof F.MediaStory)return this.story?this.story.getTrackCode():""}getReadHash(){return this.data.read_hash}getItems(){return this.data.items}getItemsLength(){return this.getItems().length}getFullItemsLength(){return this.getItems().length+(this.hasMetaStory()?1:0)}render(){this.wrapEl=(0,v.ce)("div",{className:"stories_item"}),this.contWrap=(0,v.ce)("div",{className:"stories_item_cont_wrap"}),this.contStickers=(0,v.ce)("div",{className:"stories_item_cont_sticker"}),this.contWrap.appendChild(this.contStickers),this.wrapEl.appendChild(this.contWrap);const e=(0,v.ce)("div",{className:"stories_item_cont"});return(0,E.addEvent)(e,"mousedown",(e=>{this._onMouseDownHandle(e.target)})),(0,E.addEvent)(e,"mouseup",(e=>{this._onMouseUpHandle(e.target)})),this.contWrap.appendChild(e),this.contWrap.appendChild(this.renderHeader()),this.storySendFormOverlay=(0,v.ce)("div",{className:"stories_bottom_overlay"}),this.storySendFormOverlay.appendChild((0,v.ce)("div",{className:"stories_bottom_wrap"})),this.contWrap.appendChild(this.storySendFormOverlay),this.contWrap.appendChild(this._renderPreview()),this.indexToUnread(),window.cur.noStoriesBack||(this.backButton=(0,v.ce)("div",{className:"stories_item_back"}),e.appendChild(this.backButton)),this.inlineLoader=e.appendChild((0,v.ce)("div",{className:"stories_inline_loader",innerHTML:(0,I.getProgressHtml)()})),this.contWrap.appendChild((0,v.ce)("div",{className:"stories_play_button video_thumb_play",onclick:()=>{this.story&&this.story.play()}})),this.isActiveLive()?(0,v.addClass)(this.wrapEl,"live"):this.data.type!==o.StoryBlockType.discover&&this._initTimeLine(),(0,v.toggleClass)(this.wrapEl,"multi_stories",this.data.items.length>1),this.wrapEl}updateMetaStory(){this.isActiveMetaStory()&&this.story instanceof U.MetaStory&&this.story.update()}resetNewRepliesCounterIfNeeded(){var e,t;if(null==(e=this.feedback)||null==(t=e.replies)?void 0:t.listName){const e=this.getCurStoryData();if(null==e?void 0:e.replies_new_counter){const t=(0,G.getStoryList)(this.feedback.replies.listName);if(t){Boolean(t.find((e=>e.items.find((e=>e.unread)))))||(e.replies_new_counter=0)}}}}_canForceDeleteStories(){return this.data.moder_remove_hash&&!this.data.items[0].is_deleted}_initTimeLine(){this.timeLineEl&&(this._destroyTimeLine(),(0,v.re)(this.timeLineEl)),this.storiesHeader.appendChild(this._renderTimeLine())}_isActionsShown(){const e=(0,v.domClosest)("_ui_menu_wrap",this.wrapEl);return(0,v.hasClass)(e,"shown")}_renderPreview(){return(0,v.se)('<div class="stories_preview"></div>')}_renderMessage(e){return(0,v.se)(`<div class="stories_message">\n  <div class="stories_message_text">${e}</div>\n</div>`)}showMessage(e){(0,v.re)((0,v.geByClass1)("stories_message",this.contWrap));const t=this._renderMessage(e);return this.contWrap.appendChild(t),clearTimeout(this.showMessageTimer),new Promise((e=>{this.showMessageTimer=setTimeout((()=>{this.contWrap.removeChild(t),e()}),3e3)}))}_setPreview(e,t){const{index:i}=this,s=this.data.items[i];if(!s)return;const{preview_url:o}=s;o!==this.curPreviewUrl&&o&&(e=e||(0,v.geByClass1)("stories_preview",this.contWrap),(0,a.loadMedia)(o).then((s=>{i===this.index&&o!==this.curPreviewUrl&&(this.curPreviewUrl=o,(0,v.setStyle)(e,"backgroundImage","url("+s+")")),(0,v.setStyle)(e,"opacity",1),t&&setTimeout(t,0)})).catch((e=>{(0,B.logError)(e)})))}renderHeader(){if(this.storiesHeader=document.createElement("div"),this.storiesHeader.classList.add("stories_header"),this.storiesHeaderContent=document.createElement("div"),this.storiesHeaderContent.classList.add("stories_header_content"),this.storiesHeader.appendChild(this.storiesHeaderContent),this.data.type===o.StoryBlockType.communityGroupedStories){const e=(0,v.se)(`<span class="MetaStoryBlockTitle">${k.getLang("stories_groups_feed_block")}</span>`);this.storiesHeaderContent.appendChild(e)}else if(this.data.type===o.StoryBlockType.discover){const e=(0,v.se)(`<span class="MetaStoryBlockTitle">${k.getLang("stories_block_discover")}</span>`);this.storiesHeaderContent.appendChild(e)}if(!this.data.author)return this.storiesHeader;const{href:e,name:t,verify:i}=this.data.author,r=this.getCurStoryData(),a=this.getCurrentNarrative();let l,d,c="_self",_="";this.layer.listName.includes("place")&&(c="_blank"),l=this.data.is_narrative?null==a?void 0:a.coverUrl:this.data.author.photo;let h="",u="",p=(0,x.partConfigEnabled)("avatar_component_refactor_web");p?(h="stories_author_avatar",u=`<a href="${e}" target="${c}" class="stories_author_avatar"></a>`):(h="stories_author_photo",u=`<a href="${e}" target="${c}" class="stories_author_photo_wrap"><img src="${l}" class="${h}" /></a>`),_=a&&r?`<div class="StoryInfo__title"><span>${a.title}</span></div>`:`<a class="StoryInfo__title StoryInfo__title--author" href="${e}" target="${c}">${t}${i||""}</a>`,d=this.getHeaderBottomHtml();const m=`\n      <div class="stories_author_cont">\n        ${u}\n        <div class="StoryInfo">\n          <div class="StoryInfo__top">\n            ${_}\n          </div>\n          <div class="StoryInfo__subtitle">${d}</div>\n        </div>\n      </div>`,g=(0,v.se)(`\n      <div class="stories_author_cont_wrap">\n        <div class="stories_author_inner">${m}</div>\n        <div class="stories_author_buttons"></div>\n       </div>\n    `);if(p){const e=g.querySelector(".stories_author_avatar");n.render((0,s.jsx)(X.AvatarRich,{src:l,isNFT:Boolean(this.data.author.nft),size:36,outlineType:this.isActiveLive()?X.AvatarRichOutlineType.LIVE:void 0}),e)}return(0,E.addEvent)(g,"click",(e=>{(0,v.domClosestByTag)("a",e.target)&&this.layer.sendNavigationStatEvents("go_to_author")})),this.descEl=(0,v.geByClass1)("StoryInfo__subtitle",g),this.authorButtons=(0,v.geByClass1)("stories_author_buttons",g),this.storiesHeaderContent.appendChild(g),this.authorImg=g.querySelector(`.${h}`),this.storiesHeader}showFeatureTooltipIfNeed(e){window.cur.showStoriesFeatureTooltip&&!window.cur.storiesFeatureTooltip&&e&&(window.cur.storiesFeatureTooltipTimeoutId=setTimeout((()=>{const t=(0,v.se)(`\n        <div>\n          <div class="stories_feature_tt_close" onclick="window.cur.storiesFeatureTooltip.hide(); cancelEvent(event);"></div>\n          <div>${k.getLang("intro_hint_title_stories_subscribe_hint_2")}</div>\n        </div>\n     `);(0,E.addEvent)(t,"click",(()=>{window.cur.storiesFeatureTooltip.hide()})),window.cur.storiesFeatureTooltip=new w.ElementTooltip(e,{appendToParent:!0,autoShow:!1,forceSide:"bottom",cls:"eltt_fancy stories_feature_tt",offset:[1,-2],content:t,align:"right",onHide:this.closeFeatureTooltip.bind(this)}),window.cur.storiesFeatureTooltip.show(),clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)}),2e3),(0,J.pushNavDestroy)((()=>{clearTimeout(window.cur.storiesFeatureTooltipTimeoutId)})))}showHelpHint(e,t,i){var s;if(null!=(s=window.cur).storiesHelpHintsInactive||(s.storiesHelpHintsInactive={}),window.cur.storiesHelpHintsInactive[e.id]||window.cur.storiesHelpHintTooltip)return;const{tooltip:o}=(0,ee.helpHintTooltip)(t,{helpHintId:e.id,helpHintHash:e.hash,content:`<div class="ta_c">${e.content}</div>`},i);o.show(),window.cur.storiesHelpHintsInactive[e.id]=!0,window.cur.storiesHelpHintTooltip=o}hideHelpHint(){var e;null==(e=window.cur.storiesHelpHintTooltip)||e.hide(!1),window.cur.storiesHelpHintTooltip=null}getHeaderBottomHtml(){if(!this.data.author)return;const{href:e,also_subscribed:t}=this.data.author,i=this.getCurStoryData(),s=this.getCurrentNarrative();let o="",r="_self";this.layer.listName.includes("place")&&(r="_blank");let n="";const a="StoryInfoLink";if(i){if(o=i.date,i.maskOwnerDomain){const e=i.maskOwnerDomain,t=`<a href='/${e}' target='${r}' class="StoryInfo__maskLink ${a}">@${e}</a>`;n=`<span class="StoryInfo__maskInfo">${(0,k.langSex)(i.maskOwnerSex||Y.BaseSexEnumNames.UNKNOWN,k.getLang("stories_mask_from","raw")).replace("{domain}",t)}</span><span class='dvd'></span>`}if(i.isPromo)o=i.promoCaption;else if(s)o=`<span class='dvd'></span><span>${o}</span>`,o=`${n}<a href='${e}' target='${r}' class='StoryInfo__narrativeOwnerName ${a}'>${s.ownerName}</a>${o}`;else if(i.isAds)o=k.getLang("stories_is_ad");else if(t){(0,G.createUserStackMaskIfNeeded)();let e="",i="",s="";t.owners.forEach((e=>{i+=`\n            <a href="${e.href}" class="StorySubscribedUsersStack__photo ${a}" title="${e.name}">\n              <img src="${e.photo_url}" class="StorySubscribedUsersStack__img" alt="">  \n            </a>\n          `})),e=`<div class="StorySubscribedUsersStack__photos">${i}</div>`;const r=t.owners[0],n=`<a href="${r.href}" class="StorySubscribedUsersStack__link ${a}">${r.name}</a>`,l=t.total_count;s=1===l?(0,k.langStr)((0,k.langSex)(r.sex,k.getLang("stories_also_subscribed_one_person","raw")),"name",n):(0,k.langStr)(k.getLang("stories_also_subscribed_multiple_persons"),"name",n,"total_count",l-1),s=`<div class="StorySubscribedUsersStack__label">${s}</div>`,o=`<div class="StorySubscribedUsersStack">${e}${s}</div>`}else n&&(o=`${n}<span>${o}</span>`);if((0,x.partConfigEnabled)("profile_questions_enabled")&&i.isProfileQuestion){const{icon:e}=(0,K.getIcon12Question)(),t=`<span class="StoryInfo__icon">${e}</span>${k.getLang("stories_profile_question_label")}`;o=`${`<a href="/question?ref=story" class="StoryProfileQuestionLink ${a}" target="_blank">${t}</a>`}<span class='dvd'></span>${o}`}}return o}closeFeatureTooltip(e=!1){window.cur.storiesFeatureTooltip&&(window.cur.showStoriesFeatureTooltip=!1,window.cur.storiesFeatureTooltip.destroy(),window.cur.storiesFeatureTooltip=null,e&&this.playStory(),window.ajax.post("al_index.php",{act:"help_hints_hide",hint_id:window.cur.storiesFeatureTooltipKey,hash:window.cur.storiesFeatureTooltipHash},{onDone:()=>{}}))}_renderFollowButton(){const e=this.data.author;if(!e)return;let t;t=te.Ranges.isUserId(e.id)?(0,V.getIcon24UserAddOutline)():(0,q.getIcon24AddSquareOutline)();const i=(0,G.isNewDesignEnabled)();return this.followBtn=(0,v.ce)("div",{className:i?"StoryViewerHeaderButton":"StoryButton StoryButton--follow"}),this.followBtn.innerHTML=t.icon,(0,E.addEvent)(this.followBtn,"click",this._onFollowBtnClick.bind(this)),(0,E.addEvent)(this.followBtn,"mouseover",(()=>{if(!e)return;this.closeFeatureTooltip();const t=e.can_follow?k.getLang("stories_follow"):k.getLang("stories_unfollow");(0,M.showTooltip)(this.followBtn,{black:1,center:1,forcetodown:!0,shift:i?[0,13,6]:[0,13,13],text:t,appendEl:this.contWrap})})),this.showFeatureTooltipIfNeed(this.followBtn),this.followBtn}renderActionButtons(){return this.actionButtons=document.createElement("div"),this.actionButtons.classList.add("StoryViewerHeaderButton"),n.render((0,s.jsx)(z.ActionsButton,{story:this}),this.actionButtons),this.actionButtons}destroyActionButton(){this.actionButtons&&(n.unmountComponentAtNode(this.actionButtons),delete this.actionButtons)}_renderTimeLine(){var e,t,i;this.timeLineEl=(0,v.ce)("div",{className:"stories_time_line"+(this.data.items.length>50?" stories_time_line_many_items":"")});const s=null==(e=this.data)||null==(t=e.author)?void 0:t.id,o=null==(i=this.data.items[0])?void 0:i.isOneTime,r=e=>{const t=(0,v.ce)("div",{className:"stories_time_line_item"});(0,E.addEvent)(t,"click",(()=>{this.layer.sendNavigationStatEvents("go_to_story_click"),this.changeStory(e)}));const i=(0,v.ce)("div",{className:"stories_time_line_item_cont"});i.appendChild((0,v.ce)("div",{className:"stories_time_line_item_cont_active"})),t.appendChild(i),o&&window.vk.id!==s&&(t.appendChild((0,v.ce)("div",{className:"stories_time_line_item_wick"})),(0,v.addClass)(t,"stories_time_line_item_is_one_time")),this.timeLineEl.appendChild(t)};return this.data.items.forEach(((e,t)=>r(t))),this.hasMetaStory()&&r(this.data.items.length),this.timeLineEl}isPaused(){return!this.story||this.story.isPaused()}isLoaded(){return!this.story||this.story.isLoaded()}_onMouseDownHandle(e){this.pressedStory=e,this.isActive&&(this.isLocked()||((0,v.hasClass)(e,"stories_item_cont")||(0,v.hasClass)(e,"stories_item_back")||(0,v.hasClass)(e,"StoryStickers__disableArea")||(0,v.hasClass)(e,"StorySticker"))&&!this.downTs&&(this.downTs=(0,b.vkNow)(),this.longTapTimer=setTimeout(this.longTapHandle.bind(this),g.LONG_PRESS_DELAY_MS)))}_onMouseUpHandle(e,t=(()=>{})){clearTimeout(this.longTapTimer);const{downTs:i}=this;if(delete this.downTs,e!==this.pressedStory)return;this.pressedStory=null;const s=(0,b.vkNow)()-i>=g.LONG_PRESS_DELAY_MS,o=s||this.isSendFormFocused||(0,v.hasClass)(this.wrapEl,"autoplay_failed");if(this.isActive&&((0,v.hasClass)(e,"stories_item_back")||(0,v.hasClass)(e,"StoryStickers__disableArea--left"))&&!o&&!this.isTooltipOpened())return this.prevStory();if(s||!(0,v.hasClass)(e,"StorySticker")){if((0,v.hasClass)(e,"stories_item_cont")||(0,v.hasClass)(e,"stories_item_back")||(0,v.hasClass)(e,"StoryStickers__disableArea")||(0,v.hasClass)(e,"StorySticker"))if(this.isFeedbackTooltipShow)this.hideFeedbackTooltip();else if((0,v.removeClass)(this.wrapEl,"paused"),this.isTooltipOpened())this.hideTooltip();else{if(!this.isActive){if(this.id>=this.layer.activeStory.id){let e=[];for(let t of this.layer.activeStory.data.items)e.push(t.raw_id),t.unread=!1;this.layer.markStoriesSkipped(e)}const e=this.layer.renderedStoryBlockKeys;return e.indexOf(this.layer.getBlockKey(this.data))>e.indexOf(this.layer.blockKey)?this.layer.sendNavigationStatEvents("go_to_next_author"):this.layer.sendNavigationStatEvents("go_to_previous_author"),void this.opts.onSelect(this)}o?this.isPaused()&&this.playStory(!1,!!i):this._onPlayEnd()}}else t()}_markSeenIfNeeded(){this.isActiveStoryOneTime()&&this._markSeenCurrentStory()}_markSeenCurrentStory(){this.opts.onSeen(this.layer.activeStory)}isLocked(){return!!(this.getSendText()||!this.isActive||this.isSendFormFocused||this.isModalShown||this.isFeedbackTooltipShow||this.isFooterPanelsActive||document.hidden||this._isActionsShown()||(0,v.isVisible)(this.inlineLoader)||(0,v.hasClass)(this.wrapEl,"hiding_reply")||(0,C.curBox)()||this.isPausedByMetaScroll())}isSpaceLongTabAvailable(){return!this.isPaused()}isPausedByMetaScroll(){if(this.story instanceof U.MetaStory)return this.story.isPausedByMetaScroll}isPausedByFooterScroll(){if(this.story instanceof U.MetaStory)return this.story.isPausedByMetaScroll}autoResumeStory(e=!1){this.audioPlaying||this.isTooltipOpened()||this.playStory(!1,e)}changeStory(e){this.index===e||this.isSendFormFocused||(this._destroyStory(),this.index=e,this.hideTooltip(),this._setPreview(),this.playStory())}getWrap(){return this.wrapEl}stop(){this._destroyFeedBackTT(),this.isActive=!1,this._destroyStory(),this._stopLoader(),(0,v.val)((0,v.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),(0,v.removeClass)(this.wrapEl,"autoplay_failed")}getCurStoryData(){const e=this.data.items[this.index],t=this.isActiveMetaStory();return e||t||(0,B.logError)(new Error("getCurStoryData: data is undefined"),{environment:"stories"}),e}isActiveMetaStory(){var e;return!!this.hasMetaStory()&&(!(!this.hasUnloadedMetaStory()||this.data.items.length)||(null==(e=this.data.grouped)?void 0:e.length)&&this.getFullItemsLength()-1===this.index)}hasMetaStory(){return this.data.type===o.StoryBlockType.communityGroupedStories||this.data.type===o.StoryBlockType.discover||this.data.type===o.StoryBlockType.appGroupedStories}hasUnloadedMetaStory(){var e;return this.hasMetaStory()&&!(null==(e=this.data.grouped)?void 0:e.length)}getCurrentNarrative(){return this.data.narrative}isActiveLive(){var e;return"live"===(null==(e=this.getCurStoryData())?void 0:e.type)}isLiveEnded(){return!!this.story&&(this.isActiveLive()&&this.story.liveEnded)}_initStory(){const e=this.getCurStoryData(),t=this.getCurrentNarrative(),i=this.isActiveMetaStory();if(!e&&!i)return void(0,B.logError)(new Error("Fail: _initStory"),{environment:"stories"});const r={onLoadingStart:this._onLoadingStart.bind(this),onLoadingEnd:this._onLoadingEnd.bind(this),onPlay:this._onPlay.bind(this),onPause:this._onPause.bind(this),onError:this._showError.bind(this),toggleMetaStoryTitle:this.toggleMetaStoryTitle,onLongLoading:this._showLoader.bind(this),onAutoPlayFail:this._onAutoPlayFail.bind(this),play:this.playStory,pause:this.pauseStory,playPrevStory:this.prevStory,playNextStory:this.nextStory,onLongTap:this.longTapHandle};if(e){var a,l;const{type:i,noSound:o}=e;let g;if(this.story&&this._destroyStory(),(0,m.onPlayerChange)(this),Object.assign(e,{authorId:this.getOwnerId()}),"live"===i?g=new _.default(e,r,this.wrapEl):("video"===i?(g=new h.default(e,r,t),o&&this.opts.restoreAudioPlay(),(0,v.addClass)(this.wrapEl,"video")):(g=new u.default(e,r,t),this.opts.restoreAudioPlay(),(0,v.removeClass)(this.wrapEl,"video")),this.descEl&&(this.descEl.innerHTML=this.getHeaderBottomHtml()||"",this.initProfileQuestionTooltipIfNeeded()),this.fillTimeLine()),this.story=g,"live"===i||"video"===i){(0,G.getVolume)()>0&&this.opts.onVideoPlay()}if((0,v.toggleClass)(this.wrapEl,"stories_can_comment",e.can_comment),(null==(a=this.data)||null==(l=a.author)?void 0:l.can_follow)&&!this.data.is_promo&&!this.isActiveLive()){const e=this._renderFollowButton();var c;if(e)null==(c=this.authorButtons)||c.appendChild(e)}if((0,G.isNewDesignEnabled)()){var p;const e=this.renderActionButtons();null==(p=this.authorButtons)||p.appendChild(e)}this._destroyFeedBackTT(),this.updateBottom(),e.clickable_stickers&&this.data.author&&n.render((0,s.jsx)(d.StoryStickers,{ref:e=>{e&&(this.stickerLayers=e)},story:g,storyData:e,author:this.data.author,showMessage:this.showMessage.bind(this),playStory:this.playStory.bind(this),pauseStory:this.pauseStory.bind(this),hideFeedbackTooltip:this.hideFeedbackTooltip.bind(this),onModalShownChange:this._onModalsShownChange.bind(this),onMouseUpHandle:this._onMouseUpHandle.bind(this),onMouseDownHandle:this._onMouseDownHandle.bind(this),sendNavigationStatEvents:this.layer.sendNavigationStatEvents.bind(this.layer),markAppNotificationsSeen:this.markAppNotificationsSeen,showHelpHint:this.showHelpHint,hideHelpHint:this.hideHelpHint,list:this.layer.listName,layerEl:this.layer.layerEl,el:this.contWrap}),this.contStickers)}else if(this.hasMetaStory()){this._destroyFeedBackTT();let e="";this.data.type===o.StoryBlockType.communityGroupedStories?(this.story=new j.GroupsMetaStory(this.data,r),e=k.getLang("stories_groups_grid_title")):this.data.type===o.StoryBlockType.discover?(this.story=new W.DiscoverMetaStory(this.data,r),e=k.getLang("stories_interesting_stories")):(this.story=new H.AppsMetaStory(this.data,r),(0,v.setStyle)((0,v.geByClass1)("stories_preview",this.contWrap),{backgroundImage:""})),e&&(this.metaStoryTitle=(0,v.ce)("div",{className:"MetaStoryTitle MetaStoryTitle--hide",innerHTML:e}),this.storiesHeaderContent.appendChild(this.metaStoryTitle)),(0,v.re)((0,v.geByClass1)("stories_photo",this.contWrap)),(0,v.re)((0,v.geByClass1)("stories_video",this.contWrap)),this.fillTimeLine()}this.opts.onStartStory(),this.contWrap.appendChild(this.story.render())}hasSticker(e){const t=this.getCurStoryData();if(!t||!t.clickable_stickers)return!1;const{stickers:i}=t.clickable_stickers;return!!Array.isArray(i)&&i.some((t=>t.type===e))}getSticker(e){const t=this.getCurStoryData();if(!t||!t.clickable_stickers)return;const{stickers:i}=t.clickable_stickers;return Array.isArray(i)?i.find((t=>t.type===e)):void 0}isTooltipOpened(){return this.stickerLayers&&this.stickerLayers.isShownTooltip()}hideTooltip(e=!1){this.isTooltipOpened()&&(this.stickerLayers&&this.stickerLayers.hideTooltip(),e||this.playStory())}getReplies(){if(this.story instanceof F.MediaStory)return this.story&&this.story.getReplies()}getViews(){if(this.story instanceof F.MediaStory)return this.story&&this.story.getViews()}setReplies(e){if(this.story instanceof F.MediaStory)return this.story&&this.story.setReplies(e)}setViews(e){if(this.story instanceof F.MediaStory)return this.story&&this.story.setViews(e)}indexToUnread(e=!1){var t;const{items:i}=this.data;let s=null;for(let e in i)if(i[e].unread&&!this.layer._hasContext("all")){s=Number(e);break}if(null==s&&(null==(t=this.data.grouped)?void 0:t.some((e=>e.items.some((e=>e.unread)))))&&(s=this.getFullItemsLength()-1),null==s&&(s=0),e)return s;this.index=s,this._setPreview()}indexToStoryById(e){const{items:t}=this.data;let i=-1;for(let s in t)if(t[s].raw_id===e){i=Number(s);break}this.layer._hasContext("all")&&(i=0),i>-1?(this.index=i,this._setPreview()):this.indexToUnread()}fillTimeLine(){const{timeLineEl:e}=this;if(e&&this.data.type!==o.StoryBlockType.discover)for(let t=0;t<e.children.length;t++){const i=(0,v.geByClass1)("stories_time_line_item_cont_active",e.children[t]);t===this.index&&(this._currentTimeLineEl=i,this._currentTimeLineAdditionalEl=(0,v.geByClass1)("stories_time_line_item_wick",e.children[t]));const s=t<this.index?100:0;(0,v.setStyle)(i,"transform",`translateX(${s}%)`)}}_destroyStory(){var e;if(!this.story)return;const t=this.getCurStoryData();this.isFooterPanelsActive=!1,this.needHideSentReactions&&(this.needHideSentReactions=!1,(null==t?void 0:t.new_reactions)&&delete t.new_reactions),this.updateBottom(!0),window.tooltips&&window.tooltips.hideAll(),this.hideTooltip(),this.destroyProfileQuestionTooltipIfNeeded(),this._resetErrors(),this._destroyFeedBackTT(),this.closeFeatureTooltip(!1),this.story.pause(),t&&t.clickable_stickers&&(n.unmountComponentAtNode(this.contStickers),this.stickerLayers=null),cancelAnimationFrame(this.timeLineAnim);try{this.story instanceof F.MediaStory&&this.contWrap.removeChild(this.story.getContainer()),this.story.destroy()}catch(e){(0,B.logError)(e)}this._replyHideEnd(),(0,E.removeEvent)(this.followBtn),this.authorButtons&&(this.authorButtons.innerHTML=""),null==(e=this.metaStoryTitle)||e.remove(),(0,E.removeEvent)(this.answersEl),this.hideInlineLoader(),this.destroyActionButton(),delete this.story}_timeLineUpdate(){const{story:e}=this;if(!e||e.isPaused()||this.isActiveLive()||this.data.type===o.StoryBlockType.discover)return;const t=this.getStoryProgressPercent(),i=t/100;if((0,v.setStyle)(this._currentTimeLineEl,"transform",`translateX(${t}%) translateZ(0)`),this._currentTimeLineAdditionalEl&&this._currentTimeLineEl){const e=this._currentTimeLineEl.clientWidth*i;(0,v.setStyle)(this._currentTimeLineAdditionalEl,"transform",`translateX(${e}px) translateZ(0)`)}t<100?this.timeLineAnim=requestAnimationFrame(this._timeLineUpdate.bind(this)):this._onPlayEnd(!0)}getStoryProgressPercent(){if(!this.story)return 0;const e=this.story.getCurrentTime(),t=this.story.getDuration();return Math.max(0,Math.min(100,e/t*100))}_onLoadingStart(){this._loadingStartTime=+new Date}_onLoadingEnd(){const e=this.getRawId();e&&this._loadingStartTime&&(this.loadingTime=+Date.now()-this._loadingStartTime,this.layer.sendViewerStartTime(e,this.loadingTime),this._loadingStartTime=0)}_onPlay(){this._resetErrors(),this._stopLoader(),this._timeLineUpdate(),this.preloadNextStory(),this.opts.onPlayStory(),(0,v.removeClass)(this.wrapEl,"animate_story"),(0,v.removeClass)(this.wrapEl,"autoplay_failed");const e=this.data.items[this.getIndex()];e&&(e.unread=!1),this._updateFeedStoryPreview(),(0,m.onPlayerChange)(this)}_onPause(){cancelAnimationFrame(this.timeLineAnim),(0,m.onPlayerChange)(this)}_onPlayEnd(e=!1){this._markSeenIfNeeded(),this.nextStory(e)}getOffsetLeft(){return this.wrapEl.offsetLeft+this.wrapEl.offsetWidth/2}getWidth(){return this.wrapEl.offsetWidth}removeStoryBox(){const e=this.getCurStoryData();if(!e)return void(0,B.logError)(new Error("Fail: removeStoryBox"),{environment:"stories"});const t=e.isPartOfNarrative?k.getLang("stories_remove_from_narrative_warning"):k.getLang("stories_remove_warning");this.hideFeedbackTooltip(),this.pauseStory();const i=(0,T.showFastBox)({title:k.getLang("global_warning")},t,k.getLang("stories_remove_confirm"),this.removeStory.bind(this),k.getLang("global_cancel"),(()=>{i.hide(),this.playStory()}))}removeStoryFromNarrative(){const e=this.getCurStoryData();if(!e)return void(0,B.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"});const t=k.getLang("stories_remove_only_from_narrative_warning");this.hideFeedbackTooltip(),this.pauseStory();const i=(0,T.showFastBox)({title:k.getLang("global_warning")},t,k.getLang("stories_remove_confirm"),(t=>{const i=this.getCurrentNarrative();if(!i)return;const s=this.getIndex();i.stories=i.stories.filter((t=>t.rawId!==e.raw_id)),(0,f.lockButton)(t),this.editNarrativeRequest(i).then((()=>{const e=(0,C.curBox)();e&&e.hide(),i.storiesCount=i.stories.length,this._popStoryAndClearList(s),this.updateNarrativeBlockIfNeeded(),this.layer.sendNavigationStatEvents("delete_from_narrative")})).catch((()=>{const e=(0,C.curBox)();e&&e.hide(),(0,B.logError)(new Error("Fail: removeStoryFromNarrative"),{environment:"stories"})}))}),k.getLang("global_cancel"),(()=>{i.hide(),this.playStory()}))}removeStory(e){this.pauseStory();const t=this.getIndex(),i=this.getRawId(),s={act:"remove_story",story_raw:i,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash};(0,P.isClaimContent)()&&(s.claim=window.nav.objLoc.claim),window.ajax.post("al_stories.php",s,{onDone:()=>{var e;(this.layer.sendNavigationStatEvents("delete"),(0,C.curBox)().hide(),this._popStoryAndClearList(t),1!==this.layer.renderedStoryList.length||this.layer.renderedStoryList[0]||this.opts.removeCurrentList(),this.updateNarrativeBlockIfNeeded(),(0,Z.isVKCOMProfileRedesignedEnabled)()&&"profile"===window.cur.module)&&(null==(e=window.Profile)||e.updateStories());null==window||window.removeStoryFromStoriesArchive(i)},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})}removeNarrativeBox(){this.hideFeedbackTooltip(),this.pauseStory();const e=(0,T.showFastBox)({title:k.getLang("global_warning")},k.getLang("stories_narrative_remove_warning"),k.getLang("stories_remove_confirm"),this.removeNarrative.bind(this),k.getLang("global_cancel"),(()=>{e.hide(),this.playStory()}))}removeNarrative(e){this.pauseStory();const t=this.getCurrentNarrative();if(!t)return void(0,B.logError)(new Error("Fail: removeNarrative"),{environment:"stories"});const{ownerId:i,id:s}=t;window.ajax.post("al_stories.php",{act:"remove_narrative",narrative_raw:`${i}_${s}`,hash:this.data.remove_hash,moder_remove_hash:this.data.moder_remove_hash},{onDone:()=>{var e,t;(0,C.curBox)().hide(),this.opts.removeCurrentList(),this.remove(),this.updateNarrativeBlockIfNeeded(),null==(t=(e=this.opts).afterNarrativeRemoved)||t.call(e)},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})}hideDiscover(){this.data.discover_hide_hash&&(this.pauseStory(),(0,T.showFastBox)({title:k.getLang("stories_discover_hiding_title"),onHide:()=>{this.playStory()}},k.getLang("stories_discover_hiding_warning").replace("{link}",'<a href="/settings" target="_blank">').replace("{/link}","</a>"),k.getLang("stories_add_blacklist_button"),(e=>{window.ajax.post("al_settings.php",{act:"toggle_story_discover_visible",hash:this.data.discover_hide_hash,enabled:0},{onDone:()=>{var e,t;const i=(0,C.curBox)();i&&i.hide(),this.layer.sendNavigationStatEvents("hide_discover");const s=l.getPrevLayer();var r;(null==s||null==(e=s.activeStory)||null==(t=e.data)?void 0:t.type)===o.StoryBlockType.discover&&(null==s||null==(r=s.activeStory)||r.remove(!0,(()=>{(0,C.showDoneBox)(k.getLang("stories_discover_hidden_text"))})));l.hideAllLayers(!0)},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})}),k.getLang("global_cancel")))}sendNarrativeBookmarkButtonDidPress(){const e=this.getCurrentNarrative();e?window.ajax.post("al_bookmarks.php",{act:"bookmark",owner_id:e.ownerId,object_id:e.id,type:"narrative",state:e.isBookmarked?1:0,hash:e.bookmarkHash,ref:window.cur.module},{onDone:t=>{(0,C.showDoneBox)(t||k.getLang("stories_narrative_bookmark_deleted"),{className:"stories_done_msg"}),e.isBookmarked||(0,N.sendNarrativeAnalytic)(N.NarrativeAnalyticEventType.addToBookmarks,e,N.NarrativeAnalyticNavScreen.storyViewer),e.isBookmarked=!e.isBookmarked,this.updateBottom()}}):(0,B.logError)(new Error("Fail: sendNarrativeBookmarkButtonDidPress"),{environment:"stories"})}sendNarrativeEditButtonDidPress(){const e=this.getCurrentNarrative();if(!this.data.author)return;const t=this.data.author.id,i=this.data.author.href;e?((0,N.sendNarrativeAnalytic)(N.NarrativeAnalyticEventType.clickToEditNarrative,e,N.NarrativeAnalyticNavScreen.storyViewer),te.Ranges.isUserId(t)?this.editCurrentNarrative():window.nav.go(`${i}?act=narrative_edit&nid=${e.id}`)):(0,B.logError)(new Error("Fail: sendNarrativeEditButtonDidPress"),{environment:"stories"})}editNarrativeRequest(e){const{id:t,ownerId:i,editHash:s,title:o,stories:r,coverStoryRawId:n}=e;let a;return n&&([,a]=null==n?void 0:n.split("_")),new Promise(((e,n)=>{window.ajax.post("al_stories.php",{act:"edit_narrative",owner_id:i,title:o,cover_story_id:a,hash:s,story_ids:(0,O.prepareStoriesForPublishing)(r),narrative_id:t},{onDone:()=>{e()},onFail:e=>((0,C.showDoneBox)(e||k.getLang("global_error")),n(),!0)})}))}_popStoryAndClearList(e){if(this._removeStoryFromMemoryByIndex(e),0===this.data.items.length){const e=this.getOwnerId();e&&l.onReplyDeleted(e)}}_removeStoryFromMemoryByIndex(e,t=!1){if(!this.data.items[e])return;this.data.items.splice(e,1);const i=this.getFullItemsLength();i?(this._initTimeLine(),i>e?this.isActive&&this.playStory(!0):this.isActive&&this.nextStory()):this.remove(t)}remove(e,t){var i,s;null==(s=(i=this.opts).onStoryBlockRemoved)||s.call(i,e,t)}shareBox(){if(!(this.story instanceof F.MediaStory))return;if(!this.getCurStoryData())return void(0,B.logError)(new Error("Fail: shareBox"),{environment:"stories"});const e=this.getCurrentNarrative();let t;t=e?`narrative${e.rawId}`:`story${this.story.getId()}`,this.pauseStory(),(0,T.showBox)("like.php",{act:"publish_box",object:t,from:"wkview"},{onDone:()=>{this.autoResumeStory()},params:{onHide:()=>{this.autoResumeStory()}}})}toggleLikeStory(){if(!(this.story instanceof F.MediaStory))return;const{data:e}=this.story,{isLiked:t,likeHash:i}=e,s=this.getRawId(),o={act:t?"delete_like":"like",hash:i,story_raw_id:s};e.isLiked=!t,this.updateBottom(),window.ajax.post("al_stories.php",o,{onDone:()=>{this.layer.sendNavigationStatEvents(t?"click_to_unlike":"click_to_like")},onFail:()=>(e.isLiked=t,this.updateBottom(),!0)})}toggleReaction(e){if(!(this.story instanceof F.MediaStory))return;const{data:t}=this.story,{user_reaction_id:i,reaction_set_id:s}=t,[o,r]=this.getRawId().split("_");i===e?delete this.story.data.user_reaction_id:this.story.data.user_reaction_id=e,this.updateBottom(),void 0!==this.story.data.user_reaction_id?(0,Q.api)("likes.add",{type:"story",owner_id:Number(o),item_id:Number(r),reaction_id:e}).then((()=>{this.layer.sendNavigationStatEvents("reaction_send",!0,{reaction_set_id:s,reaction_id:e})}),(()=>{t.user_reaction_id=i,this.updateBottom()})):(0,Q.api)("likes.delete",{type:"story",owner_id:Number(o),item_id:Number(r)}).then((()=>{this.layer.sendNavigationStatEvents("reaction_remove",!0,{reaction_set_id:s,reaction_id:e})}),(()=>{t.user_reaction_id=i,this.updateBottom()}))}onAnswerSend(e,t=[],i={},s={}){const o=this.getSendText();if(!(this.story instanceof F.MediaStory))return;if(!o&&!t.length||!this.story)return;if(this.isActiveLive())return void this.story.sendMessage(o,e);const r=this.getCurrentNarrative();r?t.push(["narrative",`${r.ownerId}_${r.id}`]):t.push(["story",this.story.getId()]),window.ajax.post("al_im.php",Object.assign({act:"a_send",msg:o,hash:this.data.send_hash,media:(0,L.convertAttachesToPhpMedia)(t),entrypoint:"stories_comment",to:this.getOwnerId()},i),{onDone:()=>{this.onAnswerSent(e,i,s)},onFail:e=>(this.showMessage(e).catch((e=>{(0,B.logError)(e)})),!0),showProgress:()=>{(0,v.val)(this.sendFormButton,this._getLoaderHtml()),(0,v.addClass)(this.sendFormButton,"sending")},hideProgress:()=>{(0,v.val)(this.sendFormButton,""),(0,v.removeClass)(this.sendFormButton,"sending")}})}onAnswerSent(e=(()=>{}),t={},i={}){if(!this.isActiveLive()){this.showMessage(k.getLang("stories_answer_sent")).then((()=>{this.playStory()})).catch((e=>{(0,B.logError)(e)}));const e=t.sticker_referrer||"",s={};let o="";"story_keyboard"===e?o="sticker_keyboard_send":e.startsWith("story_suggestion_")?o="sticker_suggestion_send":"story_reaction"===e?(o="sticker_reaction_send",s.reaction_name=i.reactionName):o="comment_send",this.layer.sendNavigationStatEvents(o,!0,s)}(0,v.val)((0,v.geByClass1)("stories_send_form_text",this.wrapEl),""),(0,S.cancelStackPop)(),this.pauseStory(),e&&e()}onSendFormFocus(){this.pauseStory(),this.isActiveLive()||this._toggleSendFormOverlay(!0),this.hideTooltip(!0),this.hideFeedbackTooltip(),(0,S.cancelStackPush)("stories_form_focus",(()=>{y.Emoji.shown||(this.resetSendForm(),this._blurSendForm())}))}_toggleSendFormOverlay(e=!1){this.isSendFormFocused=e,(0,G.isNewDesignEnabled)()||(0,v.toggleClass)(this.storySendFormOverlay,"stories_bottom_overlay_available",this.isSendFormFocused)}toggleFooterPanelsActive(e){this.isFooterPanelsActive=e,e&&this.toggleFeedbackTooltip(!1),e&&this.pauseStory(),e||this.playStory()}_blurSendForm(){const e=(0,v.geByClass1)("stories_send_form_text",this.wrapEl);e&&e.blur()}getSendText(){const e=y.Emoji.editableVal((0,v.geByClass1)("stories_send_form_text",this.wrapEl));return(0,b.trim)(e)}onSendFormBlur(){const e=this.getSendText();this.isActiveLive()||this._toggleSendFormOverlay(!1),e||this.resetSendForm()}_unlockSendForm(){this.isSendFormFocused&&(this.isSendFormFocused=!1)}resetSendForm(){(0,v.val)((0,v.geByClass1)("stories_send_form_text",this.wrapEl),""),this._unlockSendForm(),this.playStory()}_getLoaderHtml(){return'<svg class="stories_view_loader_circular" viewBox="25 25 50 50">\n      <circle class="stories_view_loader_circular_path" cx="50" cy="50" r="20" fill="none" stroke-width="4" stroke-miterlimit="10"/>\n    </svg>'}preloadNextStory(e=this.index+1){if(this.preloadedStories[e])return;const t=this.data.items[e];if(!t)return;this.preloadedStories[e]=!0;const i="video"===t.type?t.video_url:t.photo_url;i&&("video"===t.type?(0,x.partConfigEnabled)("web_stories_use_api_mark_seen")?(0,a.default)(i,t.type).catch((e=>(0,B.logError)(e))):(0,a.default)(i).catch((e=>(0,B.logError)(e))):(0,a.loadMedia)(i).catch((e=>(0,B.logError)(e))))}addToBlacklist(){window.cur.storyLayer&&window.cur.storyLayer.pauseStory();const e=this.getOwnerId();e&&(0,T.showFastBox)({title:k.getLang("stories_add_blacklist_title"),onHide:()=>{window.cur.storyLayer&&window.cur.storyLayer.playStory()}},te.Ranges.isGroupId(e)?k.getLang("stories_add_blacklist_message_group"):k.getLang("stories_add_blacklist_message"),k.getLang("stories_add_blacklist_button"),this._doAddToBlacklist.bind(this),k.getLang("global_cancel"))}_doAddToBlacklist(e){window.ajax.post("al_stories.php",{act:"blacklist_add",owner_id:this.getOwnerId(),hash:this.data.blacklist_hash,source_story:this.getRawId(),track_code:this.getTrackCode()},{onDone:()=>{this.data.can_blacklist=!1,this.layer.sendNavigationStatEvents("hide_from_stories"),(0,C.curBox)().hide(),this.opts.removeCurrentList(),this.remove()},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})}markNotInterested(){const e=this.getCurStoryData();if(e)if(e.isAds){let t="";const i=e.track_code,s=(0,T.showBox)("reports.php",{act:"hide_ad_box",track_code:i,type:"story"},{onDone(){const e=(0,v.geByClass)("radiobtn","ad_hide");window.radioBtns.ad_hide={val:0,els:e};const i=(0,v.ge)("ad_csrf");t=i?i.value:t},params:{onClean:()=>{delete window.radioBtns.ad_hide,this.playStory()}},stat:["reports.css"]});s.removeButtons(),s.addButton(k.getLang("box_send"),(o=>{(0,f.lockButton)(o),window.ajax.post("reports.php",{act:"hide_ad",track_code:i,reason_id:window.radioBtns.ad_hide.val,hash:t},{onDone:()=>{(0,f.unlockButton)(o),s.hide(),this._markNotInterested(e.track_code,e.canMarkNotInterestedHash)}})})),s.addButton(k.getLang("global_cancel"),!1,"no")}else this._markNotInterested(e.track_code,e.canMarkNotInterestedHash);else(0,B.logError)(new Error("Fail: markNotInterested"),{environment:"stories"})}_markNotInterested(e,t){this.showMessage(k.getLang("stories_thanks_feedback")).catch((e=>{(0,B.logError)(e)})),window.ajax.post("al_stories.php",{act:"mark_not_interested",story_raw_id:this.getRawId(),track_code:e,hash:t},{onDone:()=>{this.layer.sendNavigationStatEvents("mark_not_interested")}})}_resetErrors(){const e=(0,v.geByClass1)("stories_error_wrap",this.contWrap);e&&((0,E.removeEvent)((0,v.geByClass1)("stories_error_button",e)),(0,v.re)(e)),(0,v.removeClass)(this.wrapEl,"failed"),(0,v.removeClass)(this.wrapEl,"fatal_error")}_showError(e){if(!this.contWrap)return;const t=e;let i,s;switch(e){case"load":i=k.getLang("stories_error_cant_load"),s=(0,v.ce)("div",{className:"stories_error_button",innerHTML:k.getLang("stories_try_again")}),(0,E.addEvent)(s,"click",(()=>{this._destroyStory(),this.playStory()}));break;case"expired":i=k.getLang("stories_error_expired");break;case"deleted":i=k.getLang("stories_error_deleted");break;case"private":i=k.getLang("stories_error_private");break;case"deleted-narrative":i=k.getLang("stories_error_deleted_narrative");break;case"private-narrative":i=k.getLang("stories_error_private_narrative");break;case"isOneTimeSeen":i=k.getLang("stories_error_one_time_seen");break;default:i=k.getLang("global_unknown_error")}this._resetErrors(),this._stopLoader();const o=(0,v.ce)("div",{className:"stories_error_wrap"}),r=(0,v.ce)("div",{className:"stories_error"}),n=(0,v.ce)("div",{className:"stories_error_cont"});r.appendChild(n),n.appendChild((0,v.ce)("div",{className:"stories_error_icon "+t})),n.appendChild((0,v.ce)("div",{className:"stories_error_caption",innerHTML:i})),s&&n.appendChild(s),o.appendChild(r),this.contWrap.appendChild(o),(0,v.addClass)(this.wrapEl,"failed"),(0,b.inArray)(e,["expired","deleted","private","deleted-narrative","private-narrative"])&&(0,v.addClass)(this.wrapEl,"fatal_error")}_stopLoader(){setTimeout((()=>{(0,v.re)((0,v.geByClass1)("stories_loader",this.contWrap))}),0)}_showLoader(){if(this._stopLoader(),!this.isActive||this.isLoaded()&&!this.isPaused()||!this.contWrap)return;const e=(0,v.ce)("div",{className:"stories_loader",innerHTML:this._getLoaderHtml()});this.contWrap.appendChild(e)}_onFollowBtnClick(){if(this.pauseStory(),this.followBtnLock)return;if(this.followBtnLock=!0,!this.data.author)return;const e=this.data.author.id;let t,i;te.Ranges.isUserIdTransitional(e)?(i="al_friends",t=this.data.author.can_follow?"add":"remove"):(i="al_groups",t=this.data.author.can_follow?"a_enter":"a_leave"),window.ajax.post(`${i}.php`,{act:t,mid:e,gid:-e,hash:this.data.author.hash,from:"stories"},{onDone:()=>{if(this.data.author){if(this.data.author.can_follow&&this.sendStatEvent("follow"),this.data.author.can_follow=!this.data.author.can_follow,this.data.author.can_follow){const e=(0,V.getIcon24UserAddOutline)();this.followBtn.innerHTML=e.icon}else{const e=(0,$.getIcon24UserAddedOutline)();this.followBtn.innerHTML=e.icon,this.layer.listName===o.StoryListName.discover&&this.layer.sendNavigationStatEvents("add_to_friends")}this.showMessage(this.data.author.can_follow?k.getLang("stories_unfollowed"):k.getLang("stories_followed")).then((()=>this.playStory())).catch((e=>{(0,B.logError)(e)})),window.tooltips&&window.tooltips.destroy(this.followBtn),(0,E.triggerEvent)(this.followBtn,"mouseover")}},showProgress:()=>this.showInlineLoader(),hideProgress:()=>{this.hideInlineLoader(),this.followBtnLock=!1}})}markAsActive(){this.isActive=!0,(0,v.addClass)(this.wrapEl,"animate_story")}_destroyFeedBackTT(){delete this.feedback,this.hideFeedbackTooltip()}hideFeedbackTooltip(e=!0){this.isFeedbackTooltipShow&&(this.isFeedbackTooltipShow=!1,this.autoResumeStory(),this.updateBottom(),e&&(0,S.cancelStackPop)())}showFeedbackTooltip(){const e=this.getCurStoryData();e?this.isFeedbackTooltipShow||(this.needHideSentReactions=Boolean(e.new_reactions),this.hideTooltip(),this.pauseStory(),this.isFeedbackTooltipShow=!0,this.updateBottom(),this.layer.sendNavigationStatEvents("open_replies_list"),(0,S.cancelStackPush)("stories_feedback_tt",(e=>{this.hideFeedbackTooltip(!1),(null==e?void 0:e.isCloseBtnClick)&&(0,S.cancelStackPop)(e)}))):(0,B.logError)(new Error("Fail: showFeedbackTooltip"),{environment:"stories"})}initProfileQuestionTooltipIfNeeded(){if((0,x.partConfigEnabled)("profile_questions_enabled")&&this.descEl){const e=this.getCurStoryData();if(null==e?void 0:e.isProfileQuestion){const e=this.descEl.querySelector(".StoryProfileQuestionLink"),t=null==e?void 0:e.querySelector(".StoryInfo__icon");if(!e||!t)return;this.profileQuestionTooltipContent=(0,v.se)(`\n          <div class="StoryProfileQuestionTooltip__inner">\n            <div class="StoryProfileQuestionTooltip__title">${k.getLang("global_ask_feature")}</div>\n            <div class="StoryProfileQuestionTooltip__text">${k.getLang("stories_profile_question_tooltip_description")}</div>\n            <a href="/question?ref=story" class="StoryProfileQuestionTooltip__btn" target="_blank">${k.getLang("stories_profile_question_tooltip_btn")}</a>\n          </div>\n        `);let i=!1;this.profileQuestionTooltip=new w.ElementTooltip(t,{appendTo:this.wrapEl,forceSide:"bottom",align:"left",centerShift:(0,v.getXY)(this.authorImg)[0]-(0,v.getXY)(t)[0],cls:"StoryProfileQuestionTooltip",noHideOnClick:!0,width:291,content:this.profileQuestionTooltipContent,onShow:()=>{this.isPaused()?i=!0:this.pauseStory()},onHide:()=>{i||this.playStory()}}),null==e||e.addEventListener("mouseenter",this.showMyProfileQuestionsTooltip)}}}destroyProfileQuestionTooltipIfNeeded(){var e;if(!this.profileQuestionTooltip)return;const t=null==(e=this.descEl)?void 0:e.querySelector(".StoryProfileQuestionLink");null==t||t.removeEventListener("mouseenter",this.showMyProfileQuestionsTooltip),this.profileQuestionTooltip.destroy()}_onModalsShownChange(e=!1){this.isModalShown=e}showInlineLoader(){(0,v.show)(this.inlineLoader)}hideInlineLoader(){(0,v.hide)(this.inlineLoader)}volumeUpdate(){const e=this.story;e&&e.volumeUpdate&&e.volumeUpdate()}_onAutoPlayFail(){(0,v.addClass)(this.wrapEl,"autoplay_failed")}hideReply(){(0,T.showFastBox)({title:k.getLang("global_warning"),onHide:()=>{this.autoResumeStory()}},k.getLang("stories_hide_reply_warning"),k.getLang("global_continue"),this._doHideReply.bind(this),k.getLang("global_cancel"))}_doHideReply(){if(!this.data.author)return;this.pauseStory(),(0,v.addClass)(this.wrapEl,"hiding_reply"),(0,C.curBox)().hide();const e=this.getIndex(),t=this.data.author.gender,i=(0,v.se)(`<div class="stories_hide_reply_wrap loading">\n  <div class="stories_inline_loader">${(0,I.getProgressHtml)()}</div>\n  <div class="stories_hide_reply_cont">\n    <div class="stories_hide_reply_icon"></div>\n    <div class="stories_hide_reply_info">${k.getLang("stories_reply_hidden")}</div>\n    <div class="stories_hide_reply_continue_button _stories_reply_continue">${k.getLang("stories_hide_reply_continue")}</div>\n  </div>\n  <div class="stories_hide_reply_other_actions">\n    <div class="stories_hide_reply_other_action _stories_hide_replies">${(0,k.langSex)(t,k.getLang("stories_hide_all_replies"))}</div>\n    <div></div>\n    <div class="stories_hide_reply_other_action _stories_reply_ban">${k.getLang("stories_reply_add_to_blacklist")}</div>\n  </div>\n</div>`);(0,E.addEvent)((0,v.geByClass1)("_stories_reply_restore",i),"click",this._restoreReply.bind(this)),(0,E.addEvent)((0,v.geByClass1)("_stories_reply_continue",i),"click",(()=>this._replyHideEnd(e))),(0,E.addEvent)((0,v.geByClass1)("_stories_hide_replies",i),"click",this._hideAllReplies.bind(this)),(0,E.addEvent)((0,v.geByClass1)("_stories_reply_ban",i),"click",this._ban.bind(this)),this.contWrap.appendChild(i),window.ajax.post("al_stories.php",{act:"hide_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:()=>{this.opts.removeCurrentList(),window.cur.needUpdateFeedStories=!0,(0,v.removeClass)(i,"loading")},onFail:()=>(this._resetReplyHide(),this.playStory(),!0)})}_restoreReply(e){(0,E.cancelEvent)(e);const t=(0,v.geByClass1)("stories_hide_reply_wrap",this.contWrap);window.ajax.post("al_stories.php",{act:"restore_reply",raw_id:this.getRawId(),hash:this.data.reply_hide_hash},{onDone:()=>{this._resetReplyHide(),this.playStory()},showProgress:()=>(0,v.addClass)(t,"loading"),hideProgress:()=>(0,v.removeClass)(t,"loading")})}_resetReplyHide(){(0,v.re)((0,v.geByClass1)("stories_hide_reply_wrap",this.contWrap)),(0,v.removeClass)(this.wrapEl,"hiding_reply")}_hideAllReplies(){if(!this.data.author)return;const e=this.data.author.first_name_gen;(0,T.showFastBox)({title:k.getLang("global_warning")},k.getLang("stories_delete_all_replies_confirm").replace("{name}",e),k.getLang("global_continue"),this._doHideAllReplies.bind(this),k.getLang("global_cancel"))}_doHideAllReplies(e){window.ajax.post("al_stories.php",{act:"hide_all_replies",owner_id:this.getOwnerId(),hash:this.data.reply_hide_hash},{onDone:()=>{(0,C.curBox)().hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,v.geByClass1)("_stories_hide_replies",this.contWrap);(0,v.val)(e,k.getLang("stories_all_replies_hidden")),(0,v.addClass)(e,"disabled")},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})}_ban(){if(!this.data.author)return;const e=this.data.author.first_name_gen;(0,T.showFastBox)({title:k.getLang("global_warning")},k.getLang("stories_ban_confirm").replace("{name}",e),k.getLang("global_continue"),this._doBan.bind(this),k.getLang("global_cancel"))}_doBan(e){window.ajax.post("al_stories.php",{act:"ban",owner_id:this.getOwnerId(),hash:this.data.stories_ban_hash},{onDone:()=>{(0,C.curBox)().hide(),this.opts.removeCurrentList(),this.data.items=[];const e=(0,v.geByClass1)("_stories_reply_ban",this.contWrap);(0,v.val)(e,k.getLang("stories_banned")),(0,v.addClass)(e,"disabled")},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})}_replyHideEnd(e){if((0,v.geByClass1)("stories_hide_reply_wrap",this.contWrap)){if(this.data.items.length<=1){const e=this.getOwnerId();e&&l.onReplyDeleted(e)}this._resetReplyHide(),this._removeStoryFromMemoryByIndex(e||this.getIndex(),!(0,b.isNumeric)(e))}}_feedbackRemoveReplyFromDom(e){const t=(0,v.geByClass1)("stories_feedback_content",this.wrapEl);if(!t)return;const i=t.querySelector(`#feed_story_${e}`);i&&(0,v.addClass)(i,"removed")}onReplyDeleted(e){this._feedbackRemoveReplyFromDom(e)}_updateFeedStoryPreview(){let e=(0,v.ge)(`feed_story_${this.layer.getBlockKey(this.data)}`);if(!e||e.classList.contains("stories_feed_reply_item")||!e.classList.contains("stories_feed_preview_item"))return;let t=this.indexToUnread(!0);if(t){var i;let s=this.data.items[t];!s&&this.getFullItemsLength()-1===t&&(null==(i=this.data.grouped)?void 0:i.length)&&this.data.grouped.some((e=>e.items.some((e=>{if(e.unread)return s=e,!0})))),s&&s.small_preview&&(0,v.setStyle)(e,"background-image",`url(${s.small_preview})`)}}sendStatEvent(e){const t=this.getCurStoryData();if(t)window.ajax.post("al_stories.php",(0,b.extend)({act:"stat",source_story:this.getRawId(),track_code:this.getTrackCode()},t.stats[e]));else{this.isActiveMetaStory()||(0,B.logError)(new Error("Fail: sendStatEvent"),{environment:"stories"})}}report(){const e=this.getCurStoryData(),t=this.getCurrentNarrative();if(e)if(e.isAds){const i=e.track_code;let s="";const r=(0,T.showBox)("/reports.php",{act:"report_ad_box",track_code:i,type:"story"},{onDone(){const e=(0,v.geByClass)("radiobtn","ad_report");window.radioBtns.ad_report={val:0,els:e};const t=(0,v.ge)("ad_csrf");s=t?t.value:s},params:{onClean:()=>{delete window.radioBtns.ad_report,this.playStory()}},stat:["reports.css"]});r.removeButtons(),r.addButton(k.getLang("box_send"),(e=>{window.ajax.post("reports.php",{act:"report_ad_common",track_code:i,reason:window.radioBtns.ad_report.val,hash:s},{onDone:()=>{const e=this.index,i=this.layer.listName===o.StoryListName.groups;r.hide(),this.layer.sendNavigationStatEvents("claim"),i||t||this._popStoryAndClearList(e),(0,C.showDoneBox)(k.getLang("stories_report_sent"),{className:"stories_done_msg"}),this.updateNarrativeBlockIfNeeded()},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})})),r.addButton(k.getLang("global_cancel"),!1,"no")}else{if(this.isActiveLive())return void this.showReportLiveBox();const e=()=>this.playStory();if(t)(0,R.showReportForm)("narrative",t.ownerId,t.id,void 0,e);else{const[t,i]=this.getRawId().split("_"),s=parseInt(t),o=parseInt(i);(0,R.showReportForm)("story",s,o,void 0,e)}}else(0,B.logError)(new Error("Fail: report"),{environment:"stories"})}showReportLiveBox(){const e=(0,T.showBox)("al_stories.php",{act:"report_box"},{onDone:()=>{const e=(0,v.geByClass)("radiobtn","stories_report");window.radioBtns.stories_report={val:0,els:e}},params:{onClean:()=>{delete window.radioBtns.stories_report,this.playStory()}}});e.removeButtons(),e.addButton(k.getLang("box_send"),this._sendReportButtonDidPress.bind(this)),e.addButton(k.getLang("global_cancel"),!1,"no")}_sendReportButtonDidPress(e){const t=this.getCurStoryData();if(!t)return void(0,B.logError)(new Error("Fail: _sendReportButtonDidPress"),{environment:"stories"});const i=this.index,{report_hash:s}=t,r=this.getCurrentNarrative(),n=this.layer.listName===o.StoryListName.groups;let a,l;r?(a=`${r.rawId}`,l=r.reportHash):(a=this.getRawId(),l=s),window.ajax.post("al_stories.php",{act:"report",type:r?"narrative":"story",item_raw:a,reason:window.radioBtns.stories_report.val,hash:l},{onDone:()=>{(0,C.curBox)().hide(),this.layer.sendNavigationStatEvents("claim"),n||r||this._popStoryAndClearList(i),(0,C.showDoneBox)(k.getLang("stories_report_sent"),{className:"stories_done_msg"})},showProgress:()=>(0,f.lockButton)(e),hideProgress:()=>(0,f.unlockButton)(e)})}onLiveEnded(e=!1){this.isActiveLive()&&(this.data.items[this.index]&&(this.data.items[this.index].can_share=!e),this.story&&this.story.onLiveEnded(),this.updateBottom())}updateLiveViewersCount(e){this.descEl&&(this.descEl.innerHTML=e)}isActiveStoryOneTime(){return this.story instanceof F.MediaStory&&(this.story&&this.story.isOneTime())}buildStoryArchiveByActive(){const e=this.getRawId(),t=this.getCurStoryData();if(!e||!t)return;const[,i]=e.split("_");return{id:Number(i),rawId:e,listId:this.layer.listName,preview:t.small_preview,originalPreviewUrl:t.small_preview,time:t.time}}editCurrentNarrative(){const e=this.getCurStoryData(),t=this.getCurrentNarrative(),i=this.getOwnerId();if(!e||!i)return;if(this.pauseStory(),this.isModalShown=!0,!t)return;let s=[];(null==t?void 0:t.stories.length)&&(s=[...t.stories]);const o={selectedStories:s,narrative:t,onSave:()=>{var e,t;null==(t=(e=this.opts).afterNarrativeEdited)||t.call(e)},onClose:e=>{this.isModalShown=!1,this.updateBottom(),e&&(this.updateNarrativeBlockIfNeeded(),this.opts.removeCurrentList(),this.remove(!1))},navScreen:N.NarrativeAnalyticNavScreen.storyViewer};(0,D.showNarrativeEditorBox)(i,o)}updateNarrativeBlockIfNeeded(){(0,O.updateNarrativeBlock)()}showDoneBox(e){(0,C.showDoneBox)(e,{className:"stories_done_msg"})}constructor(e,t){this.storyBottomRef=(0,r.createRef)(),this.updateBottom=e=>{const t=(0,v.geByClass1)("stories_bottom_wrap",this.wrapEl);this.isActive&&!e&&this.story&&!this.isActiveMetaStory()?(this.resetNewRepliesCounterIfNeeded(),n.render((0,s.jsx)(c.StoryBottom,{story:this,markAppNotificationsSeen:this.markAppNotificationsSeen,ref:this.storyBottomRef}),t)):(n.unmountComponentAtNode(t),(0,v.val)(t,""))},this.longTapHandle=()=>{this.isActiveStoryOneTime()||(this.story&&this.story.pause(),(0,v.addClass)(this.wrapEl,"paused"),this.isTooltipOpened()||this.layer.sendNavigationStatEvents("pause_long_tap"))},this.playStory=(e=!1,t=!1)=>{this.isLocked()||((0,v.removeClass)(this.wrapEl,"paused"),this.story&&!e||this._initStory(),this.story&&this.story.play(),t&&this.layer.sendNavigationStatEvents("resume_release"),delete this.downTs)},this.pauseStory=e=>{this.story&&(this.isPaused()||(e&&(0,v.addClass)(this.wrapEl,"paused"),this.story.pause()))},this.toggleMetaStoryTitle=e=>{this.metaStoryTitle&&this.metaStoryTitle.classList.toggle("MetaStoryTitle--hide",!e)},this.nextStory=(e=!1)=>{if(this.isLocked())return;e||this.layer.sendNavigationStatEvents("go_to_next_story_tap");let t=this.index+1;t<this.getFullItemsLength()?(e&&this.layer.sendNavigationStatEvents("go_to_next_story_auto_by_time"),this.changeStory(t)):(this.opts.onStoriesEnd(e),this._destroyStory())},this.prevStory=()=>{if(this.isFeedbackTooltipShow&&this.hideFeedbackTooltip(),this.isLocked())return;this.layer.sendNavigationStatEvents("go_to_previous_story");let e=this.index-1;e>=0?this.changeStory(e):(this.opts.playPrevOwner(),this._destroyStory())},this.showMyProfileQuestionsTooltip=()=>{var e;null==(e=this.profileQuestionTooltip)||e.show()},this.markAppNotificationsSeen=e=>{const t=this.getCurStoryData();if(!t)return void(0,B.logError)(new Error("Fail: markAppNotificationsSeen"),{environment:"stories"});const{raw_id:i=""}=t;if(!e.appId||!e.appRef)return;const[s,o]=i.split("_");e.hasNewInteractions&&window.ajax.post("al_stories.php",{act:"mark_app_notifications_seen",owner_id:s,story_id:o,sticker_id:e.id,hash:e.hash},{onDone:()=>{t.clickable_stickers&&t.clickable_stickers.stickers&&t.clickable_stickers.stickers.forEach((t=>{t.id===e.id&&t.type===g.StickerTypes.app&&(t.hasNewInteractions=!1)})),this.updateBottom();const i=document.querySelector(`#feed_story_${s} .stories_feed_preview_app`);i&&i.classList.contains("has_new")&&i.classList.remove("has_new")}}),window.layerQueue.count()?window.layerQueue.pop():window.layerQueue.push(),this.pauseStory(),(0,A.showWiki)({w:`app${e.appId}`,app_ref:e.appRef,app_hash:e.appHash}),this.layer.sendNavigationStatEvents("click_to_app",!0,{clickable_sticker:{id:e.id,type:"app"}})},this.toggleFeedbackTooltip=(e=!this.isFeedbackTooltipShow)=>{e?this.showFeedbackTooltip():this.hideFeedbackTooltip()},this.onFetchFeedbackData=e=>{var t,i;this.feedback=e;const s=null==e||null==(t=e.replies)?void 0:t.repliesTotalCountText,o=null==e||null==(i=e.viewers)?void 0:i.viewsTotalCountText,r=null==e?void 0:e.replies,n=null==r?void 0:r.listName,a=null==r?void 0:r.list;s&&this.setReplies(s),o&&this.setViews(o),r&&a&&(window.cur=(0,b.extend)(window.cur,{[`stories_list_${n}`]:a}),r.list=a.length>g.INIT_MAX_FEEDBACK_STORIES_COUNT?a.slice(0,g.INIT_MAX_FEEDBACK_STORIES_COUNT):a,r.moreRepliesCount=a.length-r.list.length),this.updateBottom()},this.showMoreReplies=()=>{var e;const t=null==(e=this.feedback)?void 0:e.replies,i=null==t?void 0:t.listName,s=null==t?void 0:t.list;if(i&&t&&s){const e=(0,G.getStoryList)(i);if(!e)return;t.list=e.slice(0,t.list.length+g.MAX_FEEDBACK_STORIES_SLICE_COUNT),t.moreRepliesCount=e.length-t.list.length,this.updateBottom()}},this.onFetchViewers=e=>{var t,i;(null==(t=this.feedback)||null==(i=t.viewers)?void 0:i.items)&&(this.feedback.viewers.items=this.feedback.viewers.items.concat(e.viewers),this.feedback.viewers.nextFrom=e.nextFrom,this.updateBottom())},this.onQuestionRemove=e=>{var t,i;(null==(t=this.feedback)||null==(i=t.questions)?void 0:i.items)&&(this.feedback.questions.items=this.feedback.questions.items.filter((t=>t.id!==e)),this.feedback.questions.items.length||delete this.feedback.questions,this.updateBottom())},this.onPrivacyHintHide=()=>{var e,t;(null==(e=this.feedback)||null==(t=e.stats)?void 0:t.showPrivacyHint)&&(window.ajax.post("al_stories.php",{act:"hide_privacy_hint",privacy_hint_hash:this.feedback.stats.privacyHintHash}),this.feedback.stats.extendedStats?this.feedback.stats.showPrivacyHint=!1:delete this.feedback.stats,this.updateBottom())},this.onAddToNarrativeBtnClick=()=>{const e=this.getCurStoryData();if(!e)return;this.pauseStory(),this.isModalShown=!0;const t=this.getOwnerId(),i=this.buildStoryArchiveByActive();if(!i||!t)return;const s={ownerId:t,story:i,onClose:e=>{this.isModalShown=!1,this.updateBottom(),this.playStory(),e&&this.updateNarrativeBlockIfNeeded()},onSave:t=>{e.isPartOfNarrative=t},navScreen:N.NarrativeAnalyticNavScreen.storyViewer};(0,D.showNarrativeChooseBox)(s),(0,N.sendNarrativeAnalytic)(N.NarrativeAnalyticEventType.clickToAddToNarrative,{ownerId:t},N.NarrativeAnalyticNavScreen.storyViewer)},this.data=e,this.opts=t,this.id=t.id,this.isActive=!1,this.isSendFormFocused=!1,this.isModalShown=!1,this.isFeedbackTooltipShow=!1,this.pressedStory=null,this.index=0,this._currentTimeLineAdditionalEl=null,this._currentTimeLineEl=null,this.preloadedStories={},this.layer=t.layer}}},398695:(e,t,i)=>{i.d(t,{onPlayerChange:()=>l});var s=i(112100),o=i(504867),r=i(659397),n=i(970978);let a;function l(e){if(!s.HAS_MEDIA_SESSION)return;a=e;const t=a.getCurStoryData(),i=a.isActiveMetaStory();if(!t)return void(i||(0,n.logError)(new Error("Fail story media session"),{environment:"stories"}));if(!["video"].includes(t.type)||t.noSound)return void(0,s.clear)();const o=a.data.author?(0,r.decodeHTMLEntities)(a.data.author.name):"",l=(0,r.decodeHTMLEntities)(t.date),u=t.small_preview||t.photo_url||t.first_frame||t.preview_url,p=u?[{sizes:"800x1497",src:u}]:[];!function(){if(!s.HAS_MEDIA_SESSION)return;navigator.mediaSession.setActionHandler("play",d),navigator.mediaSession.setActionHandler("pause",c),navigator.mediaSession.setActionHandler("seekbackward",null),navigator.mediaSession.setActionHandler("seekforward",null),navigator.mediaSession.setActionHandler("previoustrack",_),navigator.mediaSession.setActionHandler("nexttrack",h)}(),(0,s.updateMediaSessionMetadata)({title:o,artist:l,album:"",artwork:p})}function d(){a.playStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","play")}function c(){a.pauseStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","pause")}function _(){a.prevStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","previous_track")}function h(){a.nextStory(),(0,o.statlogsValueEvent)("global_media_controls","story_player","next_track")}},160416:(e,t,i)=>{i.d(t,{STORY_DURATION:()=>s});const s=5e3},191157:(e,t,i)=>{i.d(t,{default:()=>l});var s=i(338384),o=i(964262),r=i(795558),n=i(95432),a=i(953908);class l extends s.MediaStory{render(){if(this.onStartLoading(),this.video)return this.video;const{video_url:e}=this.data;return this.video=document.createElement("video"),this.video.setAttribute("class","stories_video"),this.video.setAttribute("autoplay","false"),this.video.setAttribute("volume",(0,n.getAudioPlayer)().getVolume()),this.video.setAttribute("x-yandex-pip","false"),this.video.setAttribute("disablePictureInPicture","true"),(0,a.addEvent)(this.video,"error",(()=>{this._loadingError()})),this._isFailed()||(this.loaded&&(this.video.currentTime=0),(0,a.addEvent)(this.video,"canplay",this.canPlay.bind(this)),this.video.src=e,this.volumeUpdate()),this.video}getContainer(){return this.video||this.render()}getImage(){const e=(0,r.getSize)(this.video),t=document.createElement("canvas");t.setAttribute("width",e[0].toString()),t.setAttribute("height",e[1].toString());const i=t.getContext("2d");return i&&i.drawImage(this.video,0,0,e[0],e[1]),t.toDataURL()}destroy(){super.destroy(),(0,a.removeEvent)(this.video),delete this.video}play(){if(super.play(),this.loaded&&this.video){const e=this.video.play();void 0!==e&&e.catch((()=>{var e,t;null==(t=(e=this.options).onAutoPlayFail)||t.call(e)}))}}pause(){super.pause(),this.video&&this.video.pause()}setCurrentTime(e=0){e=+(e/1e3).toFixed(1),this.loaded&&this.video.currentTime<e&&(this.video.currentTime=e)}getCurrentTime(){return 1e3*this.video.currentTime}getDuration(){return 1e3*this.video.duration}volumeUpdate(){this.video.volume=o.getVolume()}canPlay(){super.canPlay(),!this.isFirstChunkLoaded&&window.cur.storyLayer&&(this.isFirstChunkLoaded=!0,window.cur.storyLayer.sendNavigationStatEvents("view_story",!0,{preloading_duration:window.cur.storyLayer.activeStory&&window.cur.storyLayer.activeStory.loadingTime||0})),(0,r.setStyle)(this.video,"opacity",1),(0,a.removeEvent)(this.video,"canplay")}constructor(e,t,i){super(e,t,i),this.isFirstChunkLoaded=!1}}},786006:(e,t,i)=>{i.d(t,{PinnedMessage:()=>m});var s=i(785893),o=i(667294),r=i(600820),n=i(20403),a=i(742783),l=i(629932),d=i(86894),c=i(961783),_=i(659397),h=i(108705),u=i(82161),p=i(821103);const m=({ownerId:e,commentId:t,text:i,authorId:m,authorName:g,authorHref:v,authorVerified:y=!1,canUnpin:w,canDelete:S,canReport:f})=>{const E=(0,o.useRef)(null),[b,k]=(0,o.useState)(!1),T=(0,_.debounce)((()=>!b&&E.current?k(!0):null),500),C=m===e;if((0,o.useEffect)((()=>{const e=document.querySelector("#mv_chat_messages_wrap .ui_scroll_content");var i;e&&(e.style.paddingTop=t?`${(null==(i=E.current)?void 0:i.offsetHeight)||0}px`:"0")}),[t,E,b]),(0,o.useEffect)((()=>{var e,t;return null==(e=window.VideoChat)||null==(t=e.scroll)||t.scroller.addEventListener("scroll",T),()=>{var e,t;null==(e=window.VideoChat)||null==(t=e.scroll)||t.scroller.removeEventListener("scroll",T)}}),[]),!t)return null;const M=(0,s.jsxs)("a",{href:v,target:"_blank",onClick:e=>e.stopPropagation(),className:(0,_.classNames)(c.default.author,{[c.default.authorWithBackground]:C,[c.default.authorWithoutMargin]:C&&b}),children:[g,y&&(0,s.jsx)(r.Icon12VerifiedAlt,{}),C&&(0,s.jsx)(n.Icon12Favorite,{})]}),L=(0,u.getTemplate)("video_chat_pinned_message_actions_menu",{owner_id:e,comment_id:t,show_delete:!!S,show_report:!!f,show_unpin:!!w,show_hide:!w});return(0,s.jsx)("div",{id:`pinned_message${(0,h.joinFullId)(e,t)}`,className:c.default.wrapper,onClick:()=>{b||k(!0);const i=(0,p.getMsgElement)(e,t);i&&(window.VideoChat.scroll.scrollIntoView(i),i.classList.add("mv_chat_message_selected"),setTimeout((()=>{i.classList.remove("mv_chat_message_selected")}),1e3))},ref:E,children:(0,s.jsxs)("div",{className:c.default.container,children:[(0,s.jsx)(a.Icon16Pin,{className:c.default.pinIcon}),(0,s.jsx)("div",{className:c.default.comment,children:(0,s.jsxs)(d.Caption,{weight:"2",children:[!b&&M,(0,s.jsxs)(l.TextClamp,{lines:b?1:5,children:[b&&M,(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:i}})]})]})}),(0,s.jsx)("div",{className:c.default.moreAction,dangerouslySetInnerHTML:{__html:L},onClick:e=>e.stopPropagation()})]})})}},821103:(e,t,i)=>{i.d(t,{getMsgElement:()=>s});const s=(e,t)=>document.querySelector(`#mv_chat_msg${e}_${t}`)},170864:(e,t,i)=>{i.d(t,{getPostElem:()=>r,replyUserImageImg:()=>d,replyUserImageLinkClosest:()=>a});var s,o;const r=(e,t)=>null!=(o=null!=(s=(e=>{var t;if("string"==typeof e)return null!=(t=document.querySelector(`#post${e}`))?t:void 0})(e))?s:null==t?void 0:t.closest("._post, .wl_post"))?o:void 0;var n;const a=e=>null!=(n=e.closest(".reply_image, ._reply_image"))?n:void 0;var l;const d=e=>null!=(l=e.querySelector("img.reply_img"))?l:void 0},42977:(e,t,i)=>{i.d(t,{BaseSexEnumNames:()=>s});const s={UNKNOWN:0,FEMALE:1,MALE:2}},750555:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M12 5.54C12 2.48 9.32 0 6.01 0 2.71 0 .02 2.48.02 5.54c0 1.09.34 2.1.93 2.95 0 .95-.41 1.91-.78 2.78l-.15.35c-.07.18.06.39.24.38 1.56-.07 2.74-.53 3.35-1.39.74.3 1.55.47 2.4.47 3.3 0 5.99-2.48 5.99-5.54zM6 3.25a.5.5 0 0 0-.49.39.75.75 0 0 1-1.46-.35A2 2 0 0 1 6 1.75c1.14 0 1.97.94 1.97 2.04a2 2 0 0 1-.28 1.06c-.16.27-.38.47-.52.6-.28.26-.39.36-.43.65a.75.75 0 0 1-1.48-.2c.1-.83.57-1.26.86-1.52l.04-.04c.14-.13.2-.2.24-.26a.52.52 0 0 0 .07-.29c0-.36-.24-.54-.47-.54zm.9 5.26a.9.9 0 1 1-1.8 0 .9.9 0 0 1 1.8 0z" fill="currentColor" fill-rule="evenodd"/></svg>',name:"question_12"}}i.d(t,{getIcon12Question:()=>s})},618337:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg>',name:"verified_12"}}i.d(t,{getIcon12Verified:()=>s})},464701:(e,t,i)=>{function s(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M12 7a.9.9 0 0 1 .9.9v3.2h3.2a.9.9 0 0 1 .9.9.9.9 0 0 1-.9.9h-3.2v3.2a.9.9 0 0 1-.9.9.9.9 0 0 1-.9-.9v-3.2H7.9A.9.9 0 0 1 7 12a.9.9 0 0 1 .9-.9h3.2V7.9A.9.9 0 0 1 12 7ZM9.46 3h5.08c.95 0 1.71 0 2.33.05.64.05 1.2.16 1.73.43a4.4 4.4 0 0 1 1.92 1.92c.27.52.38 1.09.43 1.73.05.62.05 1.38.05 2.33v5.08c0 .95 0 1.71-.05 2.33-.05.64-.16 1.2-.43 1.73a4.4 4.4 0 0 1-1.92 1.92 4.5 4.5 0 0 1-1.73.43c-.62.05-1.38.05-2.33.05H9.46c-.95 0-1.71 0-2.33-.05a4.5 4.5 0 0 1-1.73-.43 4.4 4.4 0 0 1-1.92-1.92 4.5 4.5 0 0 1-.43-1.73C3 16.25 3 15.5 3 14.54V9.46c0-.95 0-1.71.05-2.33.05-.64.16-1.2.43-1.73A4.4 4.4 0 0 1 5.4 3.48a4.51 4.51 0 0 1 1.73-.43C7.75 3 8.5 3 9.46 3ZM7.27 4.84c-.52.05-.82.13-1.05.24a2.6 2.6 0 0 0-1.14 1.14c-.11.23-.2.53-.24 1.05-.04.54-.04 1.24-.04 2.23v5c0 1 0 1.69.04 2.23.05.52.13.82.24 1.05a2.6 2.6 0 0 0 1.14 1.14c.23.11.53.2 1.05.24.54.04 1.24.04 2.23.04h5c1 0 1.69 0 2.23-.04.52-.05.82-.13 1.05-.24a2.6 2.6 0 0 0 1.14-1.14c.11-.23.2-.53.24-1.05.04-.54.04-1.24.04-2.23v-5c0-1 0-1.69-.04-2.23a2.77 2.77 0 0 0-.24-1.05 2.6 2.6 0 0 0-1.14-1.14c-.23-.11-.53-.2-1.05-.24-.54-.04-1.24-.04-2.23-.04h-5c-1 0-1.69 0-2.23.04Z" clip-rule="evenodd"/></svg>',name:"add_square_outline_24"}}i.d(t,{getIcon24AddSquareOutline:()=>s})},91525:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M15.88 18.12a1.25 1.25 0 0 1-1.76 1.76l-7-7a1.25 1.25 0 0 1 0-1.76l7-7a1.25 1.25 0 0 1 1.76 1.76L9.77 12z" fill="currentColor"/></svg>',name:"chevron_left_24"}}i.d(t,{getIcon24ChevronLeft:()=>s})},475117:(e,t,i)=>{function s(){return{icon:'<svg fill="none" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M14.23 12 8.12 5.88a1.25 1.25 0 1 1 1.76-1.76l7 7c.5.48.5 1.28 0 1.76l-7 7a1.25 1.25 0 0 1-1.76-1.76z" fill="currentColor"/></svg>',name:"chevron_right_24"}}i.d(t,{getIcon24ChevronRight:()=>s})},289758:(e,t,i)=>{function s(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_add_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_add_outline_24__user_add_outline_24"><path id="user_add_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 1 0-5.7 0 2.85 2.85 0 0 0 5.7 0Zm1.8 0a4.65 4.65 0 1 1-9.3 0 4.65 4.65 0 0 1 9.3 0ZM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-4-8.33h2.7a.9.9 0 1 1 0 1.8H5.9v2.7a.9.9 0 1 1-1.8 0v-2.7H1.4a.9.9 0 1 1 0-1.8h2.7V7.4a.9.9 0 1 1 1.8 0v2.7Zm2.2 8.33c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47Z" id="user_add_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_add_outline_24"}}i.d(t,{getIcon24UserAddOutline:()=>s})},380713:(e,t,i)=>{function s(){return{icon:'<svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g id="user_added_outline_24__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="user_added_outline_24__user_added_outline_24"><path id="user_added_outline_24__Bounds" d="M0 0h24v24H0z"/><path d="M18.85 7.95a2.85 2.85 0 1 0-5.7 0 2.85 2.85 0 0 0 5.7 0Zm1.8 0a4.65 4.65 0 1 1-9.3 0 4.65 4.65 0 0 1 9.3 0ZM9.9 18.43c0 .77-.1.67.34.67h11.52c.43 0 .34.1.34-.67 0-1.9-2.78-3.03-6.1-3.03s-6.1 1.14-6.1 3.03Zm-1.8 0c0-3.33 3.67-4.83 7.9-4.83s7.9 1.5 7.9 4.83c0 1.73-.69 2.47-2.14 2.47H10.24c-1.45 0-2.14-.74-2.14-2.47Zm.26-9.57a.9.9 0 1 1 1.28 1.28l-5 5a.9.9 0 0 1-1.28 0l-2.5-2.5a.9.9 0 1 1 1.28-1.28L4 13.23l4.36-4.37Z" id="user_added_outline_24__Mask" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"user_added_outline_24"}}i.d(t,{getIcon24UserAddedOutline:()=>s})},892644:(e,t,i)=>{function s(){return{icon:'<svg width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M16 32a1.5 1.5 0 0 1 0-3 13 13 0 1 0-12.2-8.5 1.5 1.5 0 1 1-2.81 1.04A15.97 15.97 0 0 1 0 16a16 16 0 1 1 16 16Z" fill="currentColor"/></svg>',name:"spinner_32"}}i.d(t,{getIcon32Spinner:()=>s})},386694:(e,t,i)=>{i.d(t,{clearStoriesLoadingStats:()=>m,clearStoriesNavigationStats:()=>c,getConnectionType:()=>n,getStoriesLoadingStats:()=>p,getStoriesNavigationStats:()=>d,saveNavigationStatEvent:()=>l,saveViewerStartTime:()=>u,serializeLoadingStats:()=>g,serializeNavigationStats:()=>_});var s=i(659397),o=i(168298),r=i(477932);function n(){const{connection:e}=navigator;if(!e)return"";const{effectiveType:t,downlink:i}=e;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return i>8?"wi-fi":"LTE"}return""}let a=[];function l({storyRawId:e,source:t,action:i}){let s=0,n=0;e&&([s,n]=(0,r.splitStoryRawId)(e)),"reply"===t&&(t="replies_list");const l={e:o.STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION,owner_id:s,story_id:n,source:t,action:i};a.push(l)}function d(){return(0,s.isArray)(a)?a:[]}function c(){a=[]}function _(){const e=a.map((({owner_id:e,story_id:t,source:i,action:s})=>[e,t,i,s].join(","))).join(";");return a=[],e}let h=[];function u({storyRawId:e,source:t,time:i}){const[s,a]=(0,r.splitStoryRawId)(e),l={e:o.STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME,owner_id:s,story_id:a,source:t,time:i,internet_type:n()};h.push(l)}function p(){return(0,s.isArray)(h)?h:[]}function m(){h=[]}function g(){const e=h.map((({owner_id:e,story_id:t,source:i,time:s})=>[e,t,i,s].join(","))).join(";");return h=[],e}},981582:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _web_legacy_ui_ui_actions_menu_utils__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(957518),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(953908),_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(795558),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(82161),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(438221),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(643897),_web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(258810);const uiActionsMenu={keyToggle:function(e,t){if(!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.checkKeyboardEvent)(t))return!1;const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);i&&uiActionsMenu.toggle(i,!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(i,"shown"))},keyboardToggle:function(e,t,i){if(!(0,_web_legacy_ui_ui_actions_menu_utils__WEBPACK_IMPORTED_MODULE_0__.isKeyboardActivationEvent)(t))return!1;const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);s&&uiActionsMenu.toggle(s,!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(s,"shown")),(null==i?void 0:i.preventKeyboardClickEvent)&&(null==t||null==t.preventDefault||t.preventDefault())},toggle:function(el,s,options){const dummyMenu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(el,"dummyMenu");dummyMenu&&(el=dummyMenu),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(el,"shown",s);const onhide=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.attr)(el,"onHide");if(onhide&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(el,"shown"))try{eval(onhide)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,onhide)}if(options&&options.onToggle){const script=options.onToggle.replace("{isShow}",""+s);try{eval(script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_5__.logEvalError)(e,script)}}},show:function(e,t,i){let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer");s&&(clearTimeout(s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0));const o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");if(o&&(s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"hidetimer"))&&(clearTimeout(s),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)),i&&i.delay){cur.uiActionsMenuShowTimeout&&clearTimeout(cur.uiActionsMenuShowTimeout);const s=i.delay;return delete i.delay,void(cur.uiActionsMenuShowTimeout=setTimeout(uiActionsMenu.show.pbind(e,t,i),s))}if(cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout),i&&i.appendParentCls){let t,s,o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_ui_menu",e);if(o){s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(i.appendParentCls,o),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",e);const r=Object.entries(i.wrapAttrs||{}).reduce(((e,[t,i])=>(e.push(`${t}="${i}"`),e)),[]).join(" "),n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.se)(`<div class="${t.className} ui_actions_menu_dummy_wrap" onmouseover="uiActionsMenu.show(this);" onmouseout="uiActionsMenu.hide(this);" ${r}></div>`);if(n.appendChild(o),s.appendChild(n),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu",n),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(n,"origMenu",e),e=n,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"top",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(o,"top"))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"left",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(o,"left"))),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"right",(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getStyle)(o,"right"))),i.processHoverCls){const s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(i.processHoverCls,t);(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseover",_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass.pbind(s,"hover")),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_1__.addEvent)(e,"mouseout",_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass.pbind(s,"hover"))}}else e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"dummyMenu");const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"origMenu");o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_ui_menu",e),t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)("_ui_menu_wrap",r),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.domClosest)(i.appendParentCls,o),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.setStyle)(o,{display:"block"});const n=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(s),a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(t),l=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"top"),d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"left"),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(o,"right"),_={top:a[1]-n[1]+l};c?_.right=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(s)[0]+n[0]-a[0]-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(t)[0]+c:_.left=a[0]-n[0]+d,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.setStyle)(o,_)}const r=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.geByClass1)("_ui_menu",e);if(i&&i.autopos&&r&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(e,"shown")){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_left");const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(e)[1],s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(e)[1],o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)(r)[1],n=i.dy||10,a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getXY)(r)[0];(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_top"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass)(e,"no_transition"),t+s+n+o>(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_4__.scrollGetY)()+(window.lastWindowHeight||0)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass)(e,"ui_actions_menu_top"),t-n-o<(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_4__.scrollGetY)()+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.getSize)("page_header_wrap")[1]&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_top"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.toggleClass)(e,"ui_actions_menu_left",a<0),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"no_transition")}i&&i.hasOwnProperty("alwaysTop")&&r&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.hasClass)(e,"shown")&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.removeClass)(e,"ui_actions_menu_top"),i.alwaysTop&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.addClass)(e,"ui_actions_menu_top")),i&&i.scroll&&i.maxHeight&&(r.style.maxHeight=((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_3__.intval)(i.maxHeight)||200)+"px",r.__uiScroll__||new _web_legacy_ui_ui_scroll__WEBPACK_IMPORTED_MODULE_6__.default(r)),uiActionsMenu.toggle(e,!0,i)},hide:function(e,t,i){cur.uiActionsMenuShowTimeout&&(clearTimeout(cur.uiActionsMenuShowTimeout),delete cur.uiActionsMenuShowTimeout);let s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay");s?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",!1):s=200;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",setTimeout((function(){uiActionsMenu.toggle(e,!1,i),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidetimer",0)}),s))},hideDelay:function(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_2__.data)(e,"hidedelay",t)}},__WEBPACK_DEFAULT_EXPORT__=uiActionsMenu},258810:(e,t,i)=>{i.r(t),i.d(t,{UiScroll:()=>c,default:()=>_});var s=i(301230),o=i(664988),r=i(82161),n=i(795558),a=i(953908),l=i(893106),d=i(332066);class c{init(){if(this.options.stopScrollPropagation&&this.fixBlocker(),!this.inited){if(!this.el.container.scrollWidth||this.disabled)return;this.fixSize(!0),this.options.autoresize&&this.startResizeListening(),this.options.global||cur.destroy.push(this.destroy.bind(this)),this.inited=!0}return this.update(!0),this.api}addEvent(e,t,i,s){return this.removeEvents.push([e,t,i]),(0,a.addEvent)(e,t,i,void 0,void 0,s?{passive:!0}:void 0),i}destroy(){if(this.disabled=!0,this.fixSize(),this.animation&&this.animation.stop(),this.moreTimeout&&clearTimeout(this.moreTimeout),this.dragstopHandler&&(0,a.removeEvent)(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&(0,a.removeEvent)(document,"mousemove",this.dragHandler),(0,r.each)(this.removeEvents,(function(e,t){a.removeEvent.apply(null,t)})),this.el.overflow.parentNode==this.el.container){const e=(0,n.cf)();for(;this.el.content.firstChild;)e.appendChild(this.el.content.firstChild);this.el.container.appendChild(e)}return(0,n.removeData)(this.el.container,"ui-scroll"),this.el.container.className=this.el.container.className.replace(/\bui_scroll_.+?\b/g," "),(0,r.each)(this.removeElements,(function(e,t){(0,n.re)(t)})),this.el.container.scrollTop=this.api.data.scrollTop,delete this.el.container.__uiScroll__,this.api}updateAbove(e){if((0,r.isFunction)(e)){this.animation&&this.animation.stop();const t=this.el.outer.scrollHeight-this.el.outer.scrollTop-this.el.overflow.offsetHeight;e(),this.el.outer.scrollTop=this.el.outer.scrollHeight-this.el.overflow.offsetHeight-t}return this.api}updateBelow(e){if((0,r.isFunction)(e)){this.animation&&this.animation.stop();const t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;e(),t&&this.scrollBottom(!1)}return this.api}fixBlocker(){s.browser.chrome&&!this.options.noForceReFlow&&this.forceReFlow(),this.el.blocker.scrollTop=this.blockerScrollTop}forceReFlow(){this.el.blocker.style.display="inline-block",this.el.blocker.offsetHeight,this.el.blocker.style.display=""}fixSize(e){this.options.native||(e&&null==this.fixSizeDefault&&(this.fixSizeDefault=this.el.container.style.width),(0,n.setStyle)(this.el.container,"width",e?(0,n.getSize)(this.el.container,!0)[0]||this.fixSizeDefault||"":this.fixSizeDefault||""))}emitEvent(e){this.disabled||this.inited&&this.emitter.emitEvent(e,[this.api])}static scrollEventDelta(e){let t=0;const i=void 0!==e.deltaMode?e.deltaMode:"MozMousePixelScroll"==e.type?0:1;return"wheel"==e.type?t=e.deltaY:void 0!==e.wheelDeltaX&&void 0!==e.wheelDeltaY?(t=1/40*-e.wheelDeltaY,s.browser.mac&&s.browser.opera&&(t*=.1)):void 0!==e.wheelDelta?t=1/40*-e.wheelDelta:e.detail&&2===e.axis&&(t=e.detail),t*(1==i?15:2==i?450:1)}isScrollEventUnused(e){return c.scrollEventDelta(e)>0?!this.api.data.scrollBottom:!this.api.data.scrollTop}resize(e){if(!e&&this.options.preserveEdgeBelow){const t=this.options.preserveEdgeBelow&&this.api.data.scrollBottom<=this.options.preserveEdgeBelowThreshold;this.update(!0)&&(this.emitEvent("resize"),t&&this.scrollBottom(),this.options.stopScrollPropagation&&!e&&this.fixBlocker())}else this.update(!0)&&(this.options.stopScrollPropagation&&!e&&this.fixBlocker(),this.emitEvent("resize"))}disable(e){return this.disabled=!!e,e?(this.animation&&this.animation.stop(),this.fixSize()):(this.fixSize(!0),this.options.stopScrollPropagation&&this.fixBlocker(),this.update(!0)),(0,n.toggleClass)(this.el.container,"ui_scroll_disabled",this.disabled),this.api}dragstart(e){if(!(this.disabled||this.dragging||this.options.native))return e||(e=window.event),this.dragging=!0,this.animation&&this.animation.stop(),this.options.reversed&&(this.noMore=!0),(0,a.addEvent)(document,"mouseup contextmenu",this.dragstartHandler=this.dragstop.bind(this)),(0,a.addEvent)(document,"mousemove",this.dragHandler=this.drag.bind(this)),this.dragScroll=this.options.reversed?this.api.data.scrollBottom:this.api.data.scrollTop,this.dragY=e.screenY,(0,a.cancelEvent)(e),this.emitEvent("dragstart"),this.api}dragstop(e){if(!this.disabled&&this.dragging&&!this.options.native){if(e||(e=window.event),this.dragging=!1,this.dragstopHandler&&(0,a.removeEvent)(document,"mouseup contextmenu",this.dragstopHandler),this.dragHandler&&(0,a.removeEvent)(document,"mousemove",this.dragHandler),(0,n.setStyle)(document.body,"cursor",""),(0,n.removeClass)(this.el.container,"ui_scroll_dragging"),this.dragged)this.noMore&&(this.noMore=!1,this.more());else{this.options.reversed&&(this.noMore=!0);const t=(e.pageY-(0,n.getXY)(this.el.barOuter)[1]-this.barInnerHeight/2)*(Math.max(this.options.minContentHeight,this.api.data.scrollHeight)-this.api.data.viewportHeight)/(this.barOuterHeight-this.barInnerHeight);this.scrollTop(!1,t,0,function(){this.noMore&&(this.noMore=!1,this.more())}.bind(this))}return this.dragged=!1,e&&"contextmenu"!==e.type&&(0,a.cancelEvent)(e),this.emitEvent("dragstop"),this.api}}drag(e){if(this.disabled||!this.dragging||this.options.native)return;e||(e=window.event);const t=(e.screenY-this.dragY)*(this.api.data.scrollHeight/this.el.barOuter.scrollHeight);return this.el.outer.scrollTop=this.options.reversed?this.el.outer.scrollHeight-this.el.overflow.offsetHeight-this.dragScroll+t:this.dragScroll+t,this.dragged||(this.dragged=!0,(0,n.setStyle)(document.body,"cursor","pointer"),(0,n.addClass)(this.el.container,"ui_scroll_dragging")),(0,a.cancelEvent)(e),this.emitEvent("drag"),this.api}scroll(e,t,i){return this.animation&&this.animation.stop(),this.el.outer.scrollTop==e&&this.update(!0),t?(t="number"!=typeof t||!isFinite(t)||t%1?300:Math.abs(t),this.animation=new l.Fx.Base({scrollTop:this.el.outer.scrollTop},{transition:l.Fx.Transitions.easeOutCubic,onStep:function(e){this.el.outer.scrollTop=e.scrollTop}.bind(this),duration:t,onComplete:(0,r.isFunction)(i)?i.pbind(this.api):void 0}).start({scrollTop:this.el.outer.scrollTop},{scrollTop:e})):(this.el.outer.scrollTop=e,(0,r.isFunction)(i)&&i(this.api)),this.api}scrollTop(e,t,i,s){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll((0,r.intval)(t),i,s)}scrollBottom(e,t,i,s){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollHeight-this.el.overflow.offsetHeight-(0,r.intval)(t),i,s)}scrollBy(e,t,i){if(!this.disabled&&!this.dragging)return this.scroll(this.el.outer.scrollTop+(0,r.intval)(e),t,i)}scrollIntoView(e,t,i,s){if(e&&this.options.stopScrollPropagation&&this.fixBlocker(),(t=(0,d.getScrollElement)(t))&&t.compareDocumentPosition&&t.compareDocumentPosition(this.el.content)&Node.DOCUMENT_POSITION_CONTAINS){const e=(0,n.getXY)(t)[1],o=(0,n.getXY)(this.el.overflow)[1],a=(0,n.getSize)(t)[1];if(e<=o&&e+a>=o+this.api.data.viewportHeight||e>=o&&e+a<=o+this.api.data.viewportHeight)(0,r.isFunction)(s)&&(i?setTimeout(s.bind(this.api),0):s(this.api));else if(a>this.api.data.viewportHeight||e<o)this.scrollTop(!1,e-o+this.api.data.scrollTop-(this.options.shadows?(0,n.getSize)(this.el.shadowTop)[1]:0),i,s);else{const t=this.options.shadows?(0,n.getSize)(this.el.shadowBottom)[1]:0;this.scrollTop(!1,e-o+this.api.data.scrollTop+a-this.api.data.viewportHeight+t,i,s)}}return this.api}update(e){let t,i;this.el.container&&!this.el.container.updateScroll&&(this.el.container.updateScroll=this.update.bind(this,!1));const s=this.el.outer.scrollTop;if(this.inited&&!this.disabled&&(e&&(t=this.el.inner.offsetHeight,this.api.data.viewportHeight!==(this.api.data.viewportHeight=this.el.overflow.offsetHeight)||this.api.data.scrollHeight!==t)||this.api.data.scrollTop!==s)){if(e&&(this.api.data.scrollHeight=t),this.api.data.scrollTop=Math.max(0,Math.min(this.api.data.scrollHeight-this.api.data.viewportHeight,Math.max(0,s))),this.api.data.scrollBottom=Math.max(0,this.api.data.scrollHeight-this.api.data.scrollTop-this.api.data.viewportHeight),!this.options.native){if(t=Math.max(this.options.minContentHeight,this.api.data.scrollHeight),i=t<=this.api.data.viewportHeight,!i){const i=this.el.barOuter.offsetHeight;(e||this.barOuterHeight!==i)&&(this.barOuterHeight=i,this.barInnerHeight=Math.max(this.options.barMinHeight,this.barOuterHeight*this.api.data.viewportHeight/t),this.el.barInner.style.height=this.barInnerHeight+"px"),(0,d.nextFrame)((()=>{const e=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight);this.el.barInner.style.transform=`translateY(${e}px)`}))}this.options.shadows&&(this.shadowTop!=(this.api.data.scrollTop&&!i)&&(0,n.toggleClass)(this.el.container,"ui_scroll_shadow_top_visible",this.shadowTop=this.api.data.scrollTop&&!i),this.shadowBottom!=(this.api.data.scrollBottom&&!i)&&(0,n.toggleClass)(this.el.container,"ui_scroll_shadow_bottom_visible",this.shadowBottom=this.api.data.scrollBottom&&!i)),this.unnecessary!==i&&((0,n.toggleClass)(this.el.container,"ui_scroll_unnecessary",i),this.unnecessary=i,this.options.stopScrollPropagation&&this.fixBlocker(),i&&this.barInnerHeight&&this.barOuterHeight&&(0,d.nextFrame)(function(e){this.el.barInner.style.height=100*this.barInnerHeight/this.barOuterHeight+"%";const i=(this.barOuterHeight-this.barInnerHeight)*this.api.data.scrollTop/(t-this.api.data.viewportHeight)*100/this.barInnerHeight;this.el.barInner.style.transform=`translateY(${i}%)`}.bind(this)))}return this.emitEvent("update"),(!this.options.reversed||s>=0)&&this.more(),!0}return!1}more(){const e=this.options.reversed?this.api.data.scrollTop:this.api.data.scrollBottom,t=null!==this.options.onmoreThreshold?this.options.onmoreThreshold:2*this.api.data.viewportHeight;!this.noMore&&e<=t&&this.emitEvent("more")}constructor(e,t){if(!(e=(0,d.getScrollElement)(e)))throw new Error("uiScroll container is undefined");e.__uiScroll__&&e.__uiScroll__.destroy(),this.options=(0,r.extend)({global:!1,native:!1,theme:"default",reversed:!1,autoresize:!0,preserveEdgeBelow:!1,barMinHeight:30,preserveEdgeBelowThreshold:20,stopScrollPropagation:!0,stopScrollPropagationAlways:!1,minContentHeight:0,onmoreThreshold:null,hidden:!1,shadows:!1,scrollElements:[],onresize:null,onscroll:null,onscrollstart:null,onscrollstop:null,ondrag:null,ondragstart:null,ondragstop:null,onupdate:null,onmore:null,noForceReFlow:!1},t),this.options.native&&(this.options.shadows=!1),s.browser.mobile&&(this.options.stopScrollPropagation=!1),(0,o.isArray)(this.options.scrollElements)||(this.options.scrollElements=[]),this.removeEvents=[],this.removeElements=[],this.dragging=!1,this.dragged=!1,this.released=!0,this.noMore=!1,this.dragY=null,this.dragScroll=null,this.shadowTop=!1,this.shadowBottom=!1,this.unnecessary=!1,this.disabled=!1,this.stopped=!0,this.stoppedTimeout=null,this.fixSizeDefault=null,this.animation=null,this.barOuterHeight=null,this.barInnerHeight=null,this.currentFrame=null,this.blockerScrollTop=500,this.emitter=new EventEmitter,(0,r.isFunction)(this.options.onresize)&&this.emitter.addListener("resize",this.options.onresize),(0,r.isFunction)(this.options.onscroll)&&this.emitter.addListener("scroll",this.options.onscroll),(0,r.isFunction)(this.options.onscrollstart)&&this.emitter.addListener("scrollstart",this.options.onscrollstart),(0,r.isFunction)(this.options.onscrollstop)&&this.emitter.addListener("scrollstop",this.options.onscrollstop),(0,r.isFunction)(this.options.ondrag)&&this.emitter.addListener("drag",this.options.ondrag),(0,r.isFunction)(this.options.ondragstart)&&this.emitter.addListener("dragstart",this.options.ondragstart),(0,r.isFunction)(this.options.ondragstop)&&this.emitter.addListener("dragstop",this.options.ondragstop),(0,r.isFunction)(this.options.onupdate)&&this.emitter.addListener("update",this.options.onupdate),(0,r.isFunction)(this.options.onmore)&&this.emitter.addListener("more",this.options.onmore),this.el={container:e,overflow:(0,n.ce)("div",{className:"ui_scroll_overflow"}),outer:(0,n.ce)("div",{className:"ui_scroll_outer"},{margin:this.options.stopScrollPropagation?this.blockerScrollTop+"px 0":void 0}),inner:(0,n.ce)("div",{className:"ui_scroll_inner tt_noappend"}),shadowTop:(0,n.ce)("div",{className:"ui_scroll_shadow_top"}),shadowBottom:(0,n.ce)("div",{className:"ui_scroll_shadow_bottom"}),content:(0,n.ce)("div",{className:"ui_scroll_content clear_fix"}),barContainer:(0,n.ce)("div",{className:"ui_scroll_bar_container"}),barOuter:(0,n.ce)("div",{className:"ui_scroll_bar_outer"}),barInner:(0,n.ce)("div",{className:"ui_scroll_bar_inner"})},(0,n.data)(this.el.container,"ui-scroll",this);const i=(0,n.cf)(),l=["ui_scroll_container"];for((0,r.each)((0,o.isArray)(this.options.theme)?this.options.theme:(0,r.trim)(this.options.theme+"").split(/\s+/),(function(e,t){t&&l.push("ui_scroll_"+t+"_theme")})),(0,n.addClass)(this.el.container,l.join(" ")),this.options.hidden&&(0,n.addClass)(this.el.container,"ui_scroll_hidden");this.el.container.firstChild;)this.el.content.appendChild(this.el.container.firstChild);if(this.el.outer.appendChild(this.el.inner),this.el.inner.appendChild(this.el.content),this.options.stopScrollPropagation?(this.el.blocker=(0,n.ce)("div",{className:"ui_scroll_blocker"}),this.addEvent(this.el.blocker,"scroll",this.fixBlocker.bind(this),!0),this.el.blocker.appendChild(this.el.outer),this.el.overflow.appendChild(this.el.blocker)):this.el.overflow.appendChild(this.el.outer),i.appendChild(this.el.overflow),this.options.native?(0,n.addClass)(this.el.container,"ui_scroll_native"):(this.el.barOuter.appendChild(this.el.barInner),this.el.barContainer.appendChild(this.el.barOuter),i.appendChild(this.el.barContainer),this.options.shadows&&(this.el.overflow.appendChild(this.el.shadowTop),this.el.overflow.appendChild(this.el.shadowBottom)),s.browser.mobile||this.options.scrollElements.push(this.el.barContainer)),this.options.autoresize){const e=(0,d.addResizeSensor)(this.el.inner,this.resize.bind(this,!0)),t=(0,d.addResizeSensor)(this.el.overflow,this.resize.bind(this,!1));this.removeElements.push(e[0]),this.removeElements.push(t[0]),this.startResizeListening=function(){e[1](),t[1]()}}this.removeElements.push(this.el.overflow,this.el.barContainer),this.el.container.appendChild(i),this.options.reversed&&(this.el.outer.scrollTop=this.el.outer.scrollHeight),this.el.container.__uiScroll__=this.api={container:this.el.container,scroller:this.el.outer,content:this.el.content,emitter:this.emitter,ondragstart:this.dragstart.bind(this),ondragstop:this.dragstop.bind(this),ondrag:this.drag.bind(this),destroy:this.destroy.bind(this),disable:this.disable.bind(this,!0),enable:this.disable.bind(this,!1),scrollTop:this.scrollTop.bind(this,!0),scrollBottom:this.scrollBottom.bind(this,!0),scrollBy:this.scrollBy.bind(this),scrollIntoView:this.scrollIntoView.bind(this,!0),update:this.init.bind(this),updateAbove:this.updateAbove.bind(this),updateBelow:this.updateBelow.bind(this),data:{scrollTop:null,scrollBottom:null,scrollHeight:null,viewportHeight:null}},this.init();const _="onwheel"in this.el.outer?"wheel":void 0!==document.onmousewheel?"mousewheel":s.browser.mozilla?"MozMousePixelScroll":"DOMMouseScroll";return this.addEvent(this.el.container,_,function(e){this.animation&&this.animation.stop(),!this.disabled&&this.options.stopScrollPropagation&&(this.unnecessary?this.options.stopScrollPropagationAlways&&(0,a.cancelEvent)(e):this.isScrollEventUnused(e)?(0,a.cancelEvent)(e):(0,a.stopEvent)(e))}.bind(this),!this.options.stopScrollPropagation),this.options.native||this.addEvent(this.el.barContainer,"mousedown",this.dragstart.bind(this)),(0,r.each)(this.options.scrollElements,function(e,t){this.addEvent(t,_,function(e){this.disabled||this.unnecessary||(this.scrollBy(c.scrollEventDelta(e)),!this.options.stopScrollPropagation&&this.isScrollEventUnused(e)||(0,a.cancelEvent)(e))}.bind(this))}.bind(this)),this.options.reversed&&this.addEvent(this.el.container,"mousedown touchstart pointerdown",function(e){this.released=!1,this.noMore=!0;const t=this.addEvent(document,"mouseup contextmenu touchend pointerup",function(e){(0,a.removeEvent)(document,"mouseup contextmenu touchend pointerup",t),this.released=!0,this.noMore&&this.stopped&&!this.dragging&&(this.noMore=!1,this.more())}.bind(this))}.bind(this)),this.addEvent(this.el.outer,"scroll",function(){this.update()&&(this.stopped?(this.stopped=!1,this.emitEvent("scrollstart")):this.options.native||!1!==this.stopped||(this.stopped=0,(0,n.addClass)(this.el.container,"ui_scroll_scrolled")),this.emitEvent("scroll"),this.stoppedTimeout&&clearTimeout(this.stoppedTimeout),this.stoppedTimeout=setTimeout(function(){this.stopped||(this.stopped=!0,this.options.native||(0,n.removeClass)(this.el.container,"ui_scroll_scrolled"),this.emitEvent("scrollstop"),this.noMore&&this.released&&!this.dragging&&(this.noMore=!1,this.more()))}.bind(this),200))}.bind(this)),this.api}}c.addResizeSensor=d.addResizeSensor;const _=c},332066:(e,t,i)=>{i.d(t,{addResizeSensor:()=>_,getScrollElement:()=>c,nextFrame:()=>d});var s=i(82161),o=i(795558),r=i(301230);let n;const a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||(e=>setTimeout(e,1)),l=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout;function d(e){n&&l(n),n=a(e)}function c(e){return(0,s.isString)(e)&&"_"===e[0]?(0,o.geByClass1)(e):(0,o.ge)(e)}function _(e,t){if((e=c(e))&&(0,s.isFunction)(t)){if(r.browser.msie9||r.browser.opera&&r.browser.version<13){let i=!1,n=!1;const a=(0,o.ce)("object",{type:"text/html",className:"ui_scroll_resize_object",data:"about:blank",onload:function(){n=!0,i&&l()}});function l(){if(!a.contentDocument)return setTimeout(l,100);a.contentDocument.defaultView.removeEventListener("resize",t),a.contentDocument.defaultView.addEventListener("resize",t),t()}return e.appendChild(a),e.__resizeSensor__=[a,function(){i=!0,n&&l()}]}{const d=(0,o.ce)("div",{className:"ui_scroll_resize_sensor"}),_=(0,o.ce)("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_expand"}),h=(0,o.ce)("div",{className:"ui_scroll_resize_sensor ui_scroll_resize_shrink"}),u=(0,o.ce)("div"),p=(0,o.ce)("div");let m=null;return _.appendChild(u),h.appendChild(p),d.appendChild(_),d.appendChild(h),e.appendChild(d),e.__resizeSensor__=[d,_.onscroll=h.onscroll=function(){const i=(e.offsetWidth||1e4)+10,s=(e.offsetHeight||1e4)+10;u.style.width=i+"px",u.style.height=s+"px",_.scrollLeft=i,_.scrollTop=s,h.scrollLeft=i,h.scrollTop=s,m!==(m=i+" "+s)&&t()}]}}}},258016:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _swc_helpers_extends__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(434788),_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(795558),_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(96756),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(82161),_web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(84543),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(953908),_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(478381),_shared_lib_browser__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(301230),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(643897),_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(438221);const SEARCH_FOCUSED_CLASS="search_focused",uiSearch={destroy:function(e){const t=uiSearch.getFieldEl(e);uiSearch.stopEvents(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeData)(t)},getWrapEl:function(e){return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domClosest)("_wrap",e)},getFieldEl:function(e){return e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)("_field",e)?e:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domByClass)(uiSearch.getWrapEl(e),"_field")},stopEvents:function(e){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(t,(function(e,t){t.stop()}))},startEvents:function(e){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[];(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(t,(function(e,t){t.stop(),t.start()}))},init:function(el,options){if(!el)return;if(el=uiSearch.getFieldEl(el),!el)return;const wrapEl=uiSearch.getWrapEl(el),delayedInitOptions=!options&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(wrapEl,"init-options");if(delayedInitOptions){const evalScript="(function() { return "+delayedInitOptions+" })()";try{var _initOptions_suggester;const initOptions=eval(evalScript);(null==initOptions||null==(_initOptions_suggester=initOptions.suggester)?void 0:_initOptions_suggester.useCatalogSuggest)?setTimeout((()=>(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(wrapEl,"init-options",null)),0):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(wrapEl,"init-options",null),uiSearch.init(el,initOptions)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_7__.logEvalError)(e,evalScript)}return}if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"inited"))return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"inited",1);const onKeyDown=uiSearch.onKeyDown.pbind(el),onBuffer=function(e){if("input"===e.type&&_shared_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.msie){const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(el);if(e===((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(el,"prev-value")||""))return;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(el,"prev-value",e)}setTimeout(uiSearch.onChanged.pbind(el,!1,e),0)};(0,_web_lib_input_utils__WEBPACK_IMPORTED_MODULE_1__.placeholderInit)(el),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"opts",options);const onFocus=e=>{if(options.focusedModifierTargetSelector){const e=document.querySelector(options.focusedModifierTargetSelector);null==e||e.classList.add(SEARCH_FOCUSED_CLASS)}null==options.onFocus||options.onFocus(e)},onBlur=e=>{if(options.focusedModifierTargetSelector){const e=document.querySelector(options.focusedModifierTargetSelector);null==e||e.classList.remove(SEARCH_FOCUSED_CLASS)}null==options.onBlur||options.onBlur(e)};let mainHandler;if(options.suggester){var _options_suggester;options.suggester.useCatalogSuggest=!!(null==options||null==(_options_suggester=options.suggester)?void 0:_options_suggester.useCatalogSuggest),options.suggester.useCatalogSuggest||(options.suggester.instance=new Suggester(el,(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.extend)(options.suggester,{type:options.suggester.type,historyItems:!!options.suggester.history&&options.suggester.historyItems,onSearch:function(e,t,i,s,o){e||(options.allowFiltersForEmpty||uiSearch.removeAllFilters(el),uiSearch.hideProgress(el)),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(wrapEl,"ui_search_field_empty",!e),uiSearch.handleAriaAttributes(wrapEl,e),options.onChange&&options.onChange.call(el,e,t,i,s,o)}}))),mainHandler={start:function(){onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"focus",onFocus)},stop:function(){onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"focus",onFocus)}}}else{const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_ui_search_button_search",wrapEl),t=function(e){uiSearch.onEnter(el,e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.elfocus)(el)};mainHandler={start:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"keydown",onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"paste cut input",onBuffer),onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(el,"focus",onFocus),e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(e,"click",t)},stop:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"keydown",onKeyDown),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"paste cut input",onBuffer),onBlur&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"blur",onBlur),onFocus&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(el,"focus",onFocus),e&&(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent)(e,"click",t)}}}if(mainHandler.start(),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(el,"eventHandlers",[mainHandler]),options.params){var _options_suggester1,_options_suggester2;const content=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.se)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(options.params.html)),newOptions=(null==options||null==(_options_suggester1=options.suggester)?void 0:_options_suggester1.useCatalogSuggest)?{forceSide:"bottom",setPos:()=>({left:"auto",top:"52px"})}:{};options.paramsTooltip=new _web_lib_element_tooltip__WEBPACK_IMPORTED_MODULE_3__.ElementTooltip((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_ui_search_params_button",wrapEl),(0,_swc_helpers_extends__WEBPACK_IMPORTED_MODULE_9__._)({appendTo:wrapEl,content,autoShow:!1,customShow:!0,shift:options.params.shift?options.params.shift:0,offset:[0,-2]},newOptions)),options.paramsTooltip.build(),(null==options||null==(_options_suggester2=options.suggester)?void 0:_options_suggester2.useCatalogSuggest)&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(options.paramsTooltip._ttel,{right:0}),setTimeout((function(){(function initScript(){try{eval(options.params.script)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_7__.logEvalError)(e,options.params.script)}}).call(el)}))}options.fixed&&uiSearch.setFixed(el),options.noAutoDestroy||cur.destroy.push(uiSearch.stopEvents.pbind(el)),uiSearch.initFilters(el,options),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.isFunction)(options.onInit)&&options.onInit(el,options)},getOptions:function(e){let t;if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(e,"_field"))t=e;else{const i=uiSearch.getWrapEl(e);t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("_field",i)}return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(t,"opts")||{}},toggleParameters:function(e){const t=uiSearch.getOptions(e);t.paramsTooltip&&t.paramsTooltip.toggle()},hideParameters:function(e){const t=uiSearch.getOptions(e);t&&t.paramsTooltip&&t.paramsTooltip.hide()},saveHistorySearch:function(e,t,i,s,o,r){t||(t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e));const n=uiSearch.getOptions(e);n.suggester&&n.suggester.instance&&n.suggester.instance.saveHistoryItem(t,i,s,o,r)},onEnter:function(e,t){e=uiSearch.getFieldEl(e);const i=uiSearch.getOptions(e),s=e.getValue?e.getValue():e.value;return i.onEnter&&i.onEnter(e,s,t),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t)},onKeyDown:function(e,t){if(cur.preventInputActions&&-1!=[_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.RETURN,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.ESC,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.DOWN,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.UP].indexOf(t.keyCode))return(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t);if(t.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.RETURN)return uiSearch.onEnter(e,t);if(t.keyCode==_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.KEY.ESC){const i=!!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e);return uiSearch.reset(e,!1,t),!i||(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.cancelEvent)(t)}setTimeout.pbind(uiSearch.onChanged.pbind(e,!1,t),0)},onChanged:function(e,t,i){e=uiSearch.getFieldEl(e);const s=uiSearch.getOptions(e),o=uiSearch.getWrapEl(e),r=e.getValue?e.getValue():e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(o,"ui_search_field_empty",!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(r)),uiSearch.handleAriaAttributes(o,r),r||s.allowFiltersForEmpty||uiSearch.removeAllFilters(e),t||s.onChange&&s.onChange.call(e,r,i)},focus:function(e){e=uiSearch.getFieldEl(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.elfocus)(e)},reset:function(e,t,i){e=uiSearch.getFieldEl(e);const s=uiSearch.getOptions(e),o=uiSearch.getWrapEl(e);(e.getValue?e.getValue():e.value)?((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.val)(e,""),uiSearch.onChanged(e,t,i),t||s.onEnter&&s.onEnter(e,""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.elfocus)(e)):s.in_tabs&&_web_legacy_ui_ui_tabs__WEBPACK_IMPORTED_MODULE_5__.default.hideSearch(o),window.tooltips&&tooltips.destroyAll()},showProgress:function(e){e=uiSearch.getFieldEl(e);const t=uiSearch.getWrapEl(e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(t,"ui_search_loading");const i=e.getValue?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(e.getValue()):e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(t,"ui_search_field_empty",!i),uiSearch.handleAriaAttributes(t,i)},hideProgress:function(e){e=uiSearch.getFieldEl(e);const t=uiSearch.getWrapEl(e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"ui_search_loading");const i=e.getValue?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(e.getValue()):e.value;(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(t,"ui_search_field_empty",!i),uiSearch.handleAriaAttributes(t,i)},handleAriaAttributes:function(e,t){const i=e.querySelector(".ui_search_controls"),s=!(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.trim)(t);null==i||i.setAttribute("aria-hidden",s)},scrollResize:function(e){if(_shared_lib_browser__WEBPACK_IMPORTED_MODULE_6__.browser.mobile)return;e=uiSearch.getFieldEl(e);const t=uiSearch.getWrapEl(e),i=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(t),s=t&&t.classList.contains("ui_search_fixed"),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)(cur.uiSearchPageBlock)||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("page_block",e),r=vk.staticheader?Math.max(0,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("page_header"))[1]-scrollNode.scrollTop):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("page_header"))[1];let n;const a=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isAncestor)(t,boxLayerWrap);if(!t||!i||!a&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("scroll_fix",t)||e.ignoreFixed&&!s||!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isVisible)(i))return;if(a?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getXY)(i,!0)[1]<0:(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getXY)(i,!0)[1]<r){const a=(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.intval)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getStyle)(t.classList.contains("ui_search_new")?t:e,"width"));!s&&a&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"height",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)(t)[1]),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,"width",a),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClass)(t,"ui_search_fixed"));const l=Math.min(0,Math.max(-document.body.scrollLeft,document.body.clientWidth-(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.ge)("page_layout"))[0]));if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,{marginLeft:l}),o){const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getXY)(o)[1]+(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.getSize)(o)[1]-(0,_web_lib_scroll__WEBPACK_IMPORTED_MODULE_8__.scrollGetY)()-e.offsetHeight;n=Math.min(r,Math.max(-e.offsetHeight,i)),n!==cur.lastUISearchPos&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,"top",n),cur.lastUISearchPos=n)}}else s&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"height",""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"ui_search_fixed"))},setStatic:function(e){e.ignoreFixed=!0;const t=uiSearch.getWrapEl(e),i=t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domPN)(t);t&&i&&((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(i,"height",""),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.setStyle)(t,{top:"",marginLeft:""}),cur.lastUISearchPos=!1,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"ui_search_fixed"))},setFixed:function(e){if(e.ignoreFixed=!1,!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"resizeEventHandler")){const t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.isAncestor)(e,boxLayerWrap)?boxLayerWrap:window,i=uiSearch.scrollResize.pbind(e),s={stop:_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent.pbind(t,"scroll",i),start:_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent.pbind(t,"scroll",i)};(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers",((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[]).concat([s])),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"resizeEventHandler",!0),s.start()}uiSearch.scrollResize(e)},initFilters:function(e,t){if(!e)return;const i=uiSearch.getWrapEl(e),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ui_search_fltr_control",i),o={start:function(){(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(s,"click",(function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(s,"shown")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(e.target,"ui_search_fltr_control")||r(s)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(s,"mouseover",(function(){if(!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(s,"shown"))return;const e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"hidetimer");e&&(clearTimeout(e),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"hidetimer",0)),r(s,!0)})),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(s,"mouseout",(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"hidetimer")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"hidetimer",setTimeout((function(){r(s,!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"hidetimer",0)}),200))}))},stop:_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.removeEvent.pbind(s,"click mouseover mouseout")};function r(e,t){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.toggleClass)(e,"shown",t)}(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers",((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"eventHandlers")||[]).concat([o])),o.start();const n=uiSearch._getFiltersPane(e);(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_4__.addEvent)(n,"click",(function(t){if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(t.target,"token_title")||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hasClass)(t.target,"token_del")){const i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.gpeByClass)("token",t.target),s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.domData)(i,"id");uiSearch.removeFilter(e,s)}}))},removeAllFilters:function(e){const t=uiSearch._getFiltersPane(e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(t,"cur_filters");(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.extend)({},i),(function(t){uiSearch.removeFilter(e,t,!0)}))},toggleFilter:function(e,t,i,s){s?uiSearch.addFilter(e,t,i):uiSearch.removeFilter(e,t)},addFilter:function(e,t,i){if(!t||!i)return;const s=uiSearch._getFiltersPane(e),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"cur_filters")||{};o[t]=i,(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"cur_filters",o);const r=uiSearch.getOptions(e);r.onFiltersChanged&&r.onFiltersChanged(o),uiSearch._renderFilters(e)},removeFilter:function(e,t,i){const s=uiSearch._getFiltersPane(e),o=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"cur_filters")||{};if(o[t]){delete o[t],(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(s,"cur_filters",o);const r=uiSearch.getOptions(e);r.onFilterRemoved&&r.onFilterRemoved(t,e,i),r.onFiltersChanged&&r.onFiltersChanged(o),uiSearch._renderFilters(e)}},_getFiltersPane:function(e){const t=uiSearch.getWrapEl(e)||e;return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ui_search_filters_pane",t)},_renderFilters:function(e){clearTimeout((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"renderFiltersTO")),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(e,"renderFiltersTO",setTimeout(uiSearch._doRenderFilters.pbind(e)))},_doRenderFilters:function(e){const t=uiSearch._getFiltersPane(e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.data)(t,"cur_filters")||{},s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.geByClass1)("ui_search_filters",t);if(s)if((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.isEmpty)(i))(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.removeClass)(t,"expanded"),setTimeout((function(){s.innerHTML="",(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.hide)(t)}),200);else{(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.show)(t),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_0__.addClassDelayed)(t,"expanded");const e=[],o={};let r=0;(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.each)(i,(function(t,i){let s=!1,n=!1,a=t.match(/(.*?)_([^_]+)$/);const l=a&&a[2]||!1;a=a&&a[1]||!1,a&&(void 0!==o[a]&&"from"===l?n=o[a]:void 0!==o[a]&&(s=o[a]+1),o[a]=r);const d=`<div class="token" id="token${t}" data-id="${t}">\n                         <div class="token_title">${(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.replaceEntities)((0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_2__.clean)(i))}</div>\n                         <div class="token_del"></div>\n                       </div>`;!1!==n?e.splice(n,0,d):!1!==s?e.splice(s,0,d):e.push(d),r++})),s.innerHTML=e.join("")}}},__WEBPACK_DEFAULT_EXPORT__=uiSearch},478381:(e,t,i)=>{i.d(t,{default:()=>_});var s=i(795558),o=i(82161),r=i(301230),n=i(953908),a=i(936134),l=i(459474),d=i(321850);const c={initTabs:function(e,t,i=!0){if(r.browser.msie&&(0,o.intval)(r.browser.version)<10)return;if(r.browser.opera&&(0,o.intval)(r.browser.version)<15)return;if((0,s.hasClass)(e,"ui_tabs_sliding"))return;const n=(0,s.getSize)(t)[0],a=t.offsetLeft,l=(0,s.geByClass1)("_ui_tabs_slider",e);if(l&&!(0,s.domData)(e,"inited")){const e={width:n+"px",marginLeft:a};(0,s.setStyle)(l,e)}i&&c.tryInitTabsScroll(e)},tryInitTabsScroll:function(e){const t=e.querySelector(".js-tabs-scroll:not(.js-tabs-scroll-inited)");if(!t)return;t.classList.add("js-tabs-scroll-inited");const i=new l.UIGallery(t,{scrollY:!1}),s=(0,a.debounce)((()=>{i.refresh()}),200);window.addEventListener("resize",s),(0,d.pushNavDestroy)((()=>{i.destroy(),window.removeEventListener("resize",s)}))},tryInit:function(e,t=!0){if((0,s.domData)(e,"inited"))return;const i=(0,s.geByClass1)("ui_tab_group_sel",e)||(0,s.geByClass1)("ui_tab_sel",e);i&&c.initTabs(e,i,t),(0,s.domData)(e,"inited",1)},goTab:function(e,t,i,o=!1){if((0,n.checkEvent)(t))return!0;const r=(0,s.gpeByClass)("ui_tabs",e);return!(!i&&(0,s.geByClass1)("ui_tab_sel",r)==e)&&(c.switchTab(e),c.showProgress(r),nav.go(e,t,{tab:e,noframe:o}))},switchTab:function(e,t){let i=(0,s.gpeByClass)("ui_tabs",e);const r=(0,s.geByClass1)("ui_tab_sel",i);let n=null,a=null;const l=(0,s.hasClass)(r,"ui_tab_group_item")?a=(0,s.gpeByClass)("ui_tab_group",r):r,d=(0,s.hasClass)(e,"ui_tab_group_item")?n=(0,s.gpeByClass)("ui_tab_group",e):e;if(e!=r){if(e!=d&&(c.toggleGroup(d,!1),c.resetLabel(d,e)),l){c.initTabs(i,l),t=t||{};const e=(0,s.geByClass1)("_ui_tabs_slider",i);if(e){t.noAnim||d===l||((0,s.addClass)(i,"ui_tabs_sliding"),clearTimeout(cur.tabSlidingTO),cur.tabSlidingTO=setTimeout(s.removeClass.pbind(i,"ui_tabs_sliding"),300));const r=(0,o.intval)(e.style.marginLeft),n={width:(0,s.getSize)(d)[0]+"px"};n[cssTransformProp]="translateX("+(d.offsetLeft-r)+"px)",(0,s.setStyle)(e,n)}r!=l&&d!=l&&c.resetLabel(l),l!=r&&(0,s.removeClass)(l,"ui_tab_group_sel"),(0,s.removeClass)(r,"ui_tab_sel")}if(d!=e&&(0,s.addClass)(d,"ui_tab_group_sel"),(0,s.addClass)(e,"ui_tab_sel"),a&&(0,s.removeClass)(a,"ui_tab_hide_separator"),n){i=(0,s.geByClass1)("ui_tab_group_items",n,"div").children;let e=null;(0,o.each)(i,(function(t,i){"SPAN"===i.tagName?e=i:(0,s.hasClass)((0,s.domFC)(i),"ui_tab_sel")||(0,s.hasClass)(i,"unshown")||(e=null)})),e&&(0,s.addClass)(n,"ui_tab_hide_separator")}}return!1},resetLabel:function(e,t){const i=(0,s.geByClass1)("ui_tab_group_label",e,"span");i&&(i.innerHTML=(t||i).getAttribute("data-default-label"))},toggleGroup:function(e,t){const i=(0,s.data)(e,"visibletimer");i&&clearTimeout(i),(0,s.data)(e,"visibletimer",setTimeout(s.toggleClass.pbind(e,"visible",t),t?0:100)),(0,s.toggleClass)(e,"shown",t)},showGroup:function(e){const t=(0,s.data)(e,"hidetimer");t&&(clearTimeout(t),(0,s.data)(e,"hidetimer",0)),c.toggleGroup(e,!0)},hideGroup:function(e){(0,s.data)(e,"hidetimer")||(0,s.data)(e,"hidetimer",setTimeout((function(){c.toggleGroup(e,!1),(0,s.data)(e,"hidetimer",0)}),200))},showProgress:function(e){(0,s.hasClass)(e,"ui_tabs")||(e=(0,s.gpeByClass)("ui_tabs",e)),(0,s.addClass)(e,"ui_tabs_loading")},hideProgress:function(e){(0,s.hasClass)(e,"ui_tabs")||(e=(0,s.gpeByClass)("ui_tabs",e)),(0,s.removeClass)(e,"ui_tabs_loading")},showSearch:function(e,t){if(cur.viewAsBox)return cur.viewAsBox();if((0,n.checkEvent)(t))return!0;const i=(0,s.gpeByClass)("ui_tabs",e),o=(0,s.domByClass)(i,"_field");return(0,s.addClass)(i,"ui_tabs_search_opened"),uiSearch.focus(o),!1},hideSearch:function(e,t){if((0,n.checkEvent)(t))return!0;const i=(0,s.gpeByClass)("ui_tabs",e);return(0,s.removeClass)(i,"ui_tabs_search_opened"),!1},scrollToActiveTab(e){const t=document.querySelector(`#${e}`);if(!t)return;const i=t.querySelector(".ui_tab_sel, .ui_tab_group_sel"),s=t.querySelector(`.${l.UI_GALLERY_CONTENT_CLASSNAME}`);if(!i||!s)return;const o=i.offsetLeft,r=o+i.offsetWidth,n=s.scrollLeft,a=s.clientWidth,d=n+a,c=o-20,_=r+20;c<n?s.scrollTo({left:c}):_>d&&s.scrollTo({left:_-a})}},_=c},850989:(e,t,i)=>{i.d(t,{addDelegateEvent:()=>a,removeDelegateEvent:()=>l});var s=i(795558),o=i(953908);let r=new window.Map;function n(e){let t=r.get(e.currentTarget);if(!t)return;let i,o=t[e.type];if(o)for(let t=0;t<o.length;t++){let r,[n,a]=o[t];if((0,s.hasClass)(e.target,n)?r=a(e,e.target):(i=(0,s.gpeByClass)(n,e.target,e.currentTarget))&&(r=a(e,i)),!1===r)break}}function a(e,t,i,s,a){let l=r.get(e);l||(r.set(e,{}),l=r.get(e));let d=t.split(" ");for(let t=0;t<d.length;t++){let r=d[t];l[r]||(l[r]=[],a?(0,o.addEvent)(e,r,n,!1,!1,a):(0,o.addEvent)(e,r,n)),l[r].push([i,s])}}function l(e,t,i,s){let a=r.get(e);if(!a)return;t.split(" ").forEach((t=>{a[t]&&(a[t]=a[t].filter((e=>e[0]!==i||e[1]!==s)),0===a[t].length&&(0,o.removeEvent)(e,t,n))}));0===Object.keys(a).map((e=>a[e].length)).reduce(((e,t)=>e+t))&&r.delete(e)}},2914:(e,t,i)=>{i.d(t,{createScroll:()=>d,getNativeOption:()=>r});var s=i(15080),o=i(438221);function r(e,t){return document.body[e]||document.documentElement[e]}class n{update(){}resize(){this.innerHeight=window.innerHeight}scrollTop(e){if(void 0===e)return r("scrollTop",this.el);!function(e,t,i){"scrollTop"===e&&window.scrollTo(0,t)}("scrollTop",e,this.el)}contHeight(){return r("scrollHeight")}smoothScroll(e){(0,o.scrollToY)(e+this.scrollTop(),300)}getContainer(){return this.el}getScroller(){return null}scrollBottom(e){if(void 0===e)return this.contHeight()-this.scrollTop()-this.getScrollHeight();let t=this.contHeight()-e-this.getScrollHeight();this.scrollTop(t)}scrollBottomFixSave(e){let t=Date.now();const i=()=>{Date.now()-t<500&&this.scrollBottom(e),window.removeEventListener("scroll",i)};window.addEventListener("scroll",i),this.scrollBottom(e)}onScroll(e){let t=this.scrollTop(),i=t-this.prevScroll,s=this.contHeight();this.opts.onScroll&&this.opts.onScroll(-i,this),this.opts.scrollChange&&this.opts.scrollChange(t),this.opts.more&&s-t<2*this.innerHeight&&this.opts.more(this),this.prevScroll=t}getScrollHeight(){return this.innerHeight}destroy(){(0,s.destroyModule)(this.module)}constructor(e,t){this.el=e,this.opts=t,this.module=(0,s.createModule)({handlers:(e,t)=>{e(window,"scroll",this.onScroll.bind(this)),e(window,"resize",this.resize.bind(this))}}),this.innerHeight=window.innerHeight,this.prevScroll=this.scrollTop()}}class a{update(){this.scroll.update("sync")}scrollTop(e){return void 0!==e?this.scroll.scrollTop(e):this.scroll.data.scrollTop}getContainer(){return this.scroll.content}getScroller(){return this.scroll.scroller}contHeight(){return this.scroll.data.scrollHeight}smoothScroll(e){this.scroll.scrollTop(this.scrollTop()+e,300)}scrollBottom(e){return void 0!==e?this.scroll.scrollBottom(e):this.scroll.data.scrollBottom}scrollBottomFixSave(e){let t=Date.now();this.scroll.emitter.addOnceListener("resize",(()=>{Date.now()-t<500&&this.scroll&&this.scrollBottom(e)})),this.scrollBottom(e)}getScrollHeight(){return this.scroll.data.viewportHeight}destroy(){this.scroll.destroy()}constructor(e,t){this.prevTop=0,this.scroll=new uiScroll(e,{hidden:void 0===t.hidden||t.hidden,shadows:t.shadows,stopScrollPropagation:!1,theme:t.scrollTheme,onmore:()=>t.more&&t.more(this),onscroll:e=>{const i=this.scrollTop(),s=this.prevTop-i;this.prevTop=i,t.scrollChange&&t.scrollChange(i),t.onScroll&&t.onScroll(s,this)}})}}class l{update(){}getContainer(){return this.el}getScroller(){return null}scrollTop(e){return 0}contHeight(){return 0}smoothScroll(e){}scrollBottom(e){return 0}scrollBottomFixSave(e){}getScrollHeight(){return 0}destroy(){}constructor(e,t){this.el=e}}function d(e,t){return t.noScroll?new l(e):t.nativeScroll?new n(e,t):new a(e,t)}},824111:(e,t,i)=>{i.d(t,{Scroll:()=>c});var s=i(434788),o=i(820224),r=i(785893),n=(i(667294),i(191521)),a=i(2914),l=i(45697),d=i.n(l);const c=e=>{var{children:t}=e,i=(0,o._)(e,["children"]);return(0,r.jsx)(n.ScrollContext.Provider,{value:{createScroll:a.createScroll},children:(0,r.jsx)(n.Scroll,(0,s._)({},i,{children:t}))})};c.propTypes={className:d().string,children:d().oneOfType([d().element,d().string]).isRequired,isNative:d().bool,isShadows:d().bool,neverHide:d().bool,onScroll:d().func},c.defaultProps={isNative:!1,isShadows:!1,neverHide:!1,onScroll:null}},555510:(e,t,i)=>{i.d(t,{EVENT_REPLY_FIELD_IS_NFT_INDEX:()=>a,MIN_NFT_IMAGE_SIZE:()=>o,REPLY_IMAGE_DEFAULT_SIZE:()=>r,REPLY_IMAGE_SMALL_SIZE:()=>n,VISIBILITY_ACCESS_OPTIONS:()=>s});const s={PUBLIC:0,ONLY_FRIENDS:1,ONLY_BEST_FRIENDS:2},o=29,r=34,n=24,a=16},809915:(e,t,i)=>{i.d(t,{VideoChat:()=>w});var s=i(795558),o=i(664988),r=i(96756),n=i(953908),a=i(82161),l=i(320422),d=i(40256),c=i(965109),_=i(29271),h=i(137363),u=i(618337),p=i(599809),m=i(839470),g=i(667794),v=i(821103),y=i(931917);const w={SCROLL_EDGE_BELOW_THRESHOLD:20,MAX_COMMENTS_NUM:(0,m.partConfigEnabled)("video_show_less_msg_in_live")?50:150,MAX_LIKES_PER_BATCH:5,MAX_STICKERS_PER_BATCH:5,init(e,t){w.block&&w.destroy(),e&&(w.block=e,w.options=(0,a.extend)({},t),w.messagesWrap=(0,s.domByClass)(e,"mv_chat_messages_wrap"),w.stickersWrap=(0,s.domByClass)(e,"mv_chat_stickers_wrap"),w.scroll=new uiScroll((0,s.domFC)(w.messagesWrap),{global:!0,hidden:t.scrollHidden,reversed:!0,preserveEdgeBelow:!0,preserveEdgeBelowThreshold:w.SCROLL_EDGE_BELOW_THRESHOLD,theme:"videoview",noForceReFlow:!0,onupdate:w.onScrollUpdate}),this.scrollBottomBtnWrap=(0,s.domByClass)(e,"mv_chat_new_messages_btn_wrap"),w.replyForm=(0,s.domByClass)(e,"mv_chat_reply_form"),w.replyForm&&(w.replyInput=(0,s.domByClass)(e,"mv_chat_reply_input"),w.initReplyInput()),w.firstMsgIntro=(0,s.domByClass)(e,"mv_chat_first_message_intro"))},initReplyInput(){(0,r.placeholderInit)(w.replyInput,{editable:!0,global:!0}),window.stManager.add([window.jsc("web/emoji.js"),"notifier.css"],(function(){const e=Emoji.init(w.replyInput,{forceStickerPack:w.options.forceStickerPack,controlsCont:w.replyForm,noLineBreaks:1,noCtrlSend:1,noStickers:!!w.options.noStickers,ref:"video_chat",onSend:function(){w.sendMessage()},checkEditable:function(){w.checkFormHeight(),w.checkTextLen()},onStickerSend:function(e){w.sendSticker(e)}});(0,s.data)(w.replyForm,"optId",e)}))},checkFormHeight(){const e=w.replyForm,t=e.offsetHeight;if(e.lastHeight===t)return;e.lastHeight=t;const i=!w.scroll.data.scrollBottom;(0,s.setStyle)(w.messagesWrap,{bottom:t+"px"}),i&&w.scroll.scrollBottom()},checkTextLen(e=w.replyInput){const t=(0,a.trim)(Emoji.editableVal(e));if(e.lastLen===t.length)return;if((e.lastLen=t.length)>mvcur.maxChatReplyLength){const t=cur.storyLayer?_.getLang("stories_live_chat_msg_too_long"):_.getLang("video_live_chat_msg_too_long");(0,l.showTooltip)(e,{black:1,text:t,shift:!!cur.storyLayer&&[-30,10]})}else window.tooltips&&tooltips.destroy(e)},stickerClick:(e,t,i)=>(window.stManager.add([window.jsc("web/emoji.js"),"notifier.css"],(function(){Emoji.clickSticker(e,t,i)})),!1),onScrollUpdate(e){e.data.scrollBottom<w.SCROLL_EDGE_BELOW_THRESHOLD&&w.toggleScrollBottomBtn(!1)},getMessageAccessFlags(e,t){const{adminLevel:i,canDeleteComments:s,canPinComments:o}=Videoview.getMvData(),r=i>h.GroupAdminLevel.USER;let n=!1;window.replyAsList&&window.replyAsList.length&&(n=window.replyAsList.some((e=>e[0]===t)));return{canDeleteComment:r||!!s||e==vk.id||t==vk.id||n,canReportComment:e!=t&&t!=vk.id&&!n,canPinComment:!!o}},receiveMessage(e,t,i,s,o,r,n,l,d,c,_){if((0,a.intval)(d))return void w.appendSticker(d,i);const{canDeleteComment:h,canReportComment:p,canPinComment:g}=w.getMessageAccessFlags(e,i);let v="";(0,m.partConfigEnabled)("video_live_pinned_message")&&g?v+=(0,a.getTemplate)("video_chat_message_actions_menu",{owner_id:e,author_id:i,author_name:s,author_href:r,author_verified:!!_,comment_id:t,show_delete:!!h,show_report:!!p}):(p&&(v+=(0,a.getTemplate)("video_chat_message_action_report",{video_owner_id:e,msg_id:t})),h&&(v+=(0,a.getTemplate)("video_chat_message_action_del",{video_owner_id:e,msg_id:t})));let y=s;_&&(y+='<div class="mv_page_verified">'+(0,u.getIcon12Verified)().icon+"</div>");const S=(0,a.getTemplate)("video_chat_message",{author_href:r,author_photo:o,author_name:y,message:l,video_owner_id:e,msg_id:t,actions:v,classes:i==e?"mv_chat_admin_message":""});w.appendMessage(S,t)},receiveDelete(e,t){const i="#mv_chat_msg"+mvcur.mvData.oid+"_"+t;let o=w._messagesBatch&&w._messagesBatch.querySelector(i);o?o.remove():(o=w.messagesWrap.querySelector(i),o&&!(0,s.hasClass)(o,"_deleted")&&w.scroll.updateBelow((function(){o.remove()})))},checkStickerFlood(e,t){const i=mvcur.queueBatchId;w._stickersLimits&&w._stickersLimits.batch==i||(w._stickersLimits={batch:i,like:0,sticker:0},w._stickersDelay=0);const s="like"==e?"like":"sticker",o="like"==s?w.MAX_LIKES_PER_BATCH:w.MAX_STICKERS_PER_BATCH;return!(++w._stickersLimits[s]>o&&t!=vk.id)},appendSticker(e,t,i=!0){if(!w.isHidden()&&!Videoview.isFS&&"hidden"!=document.visibilityState&&"animation"in document.body.style&&"onanimationend"in window){if(t==vk.id){const t=w.recentlySentSticker;if(t&&t.stickerId==e&&t.fromQueue!=i&&Date.now()-t.time<3e3)return;w.recentlySentSticker={stickerId:e,fromQueue:i,time:Date.now()}}else if(!w.checkStickerFlood(e,t))return;if("like"==e){const e=(0,s.ce)("div",{className:"mv_chat_like"});r(e),(0,n.addEvent)(e,"animationend",d),l(e)}else{const t=(0,s.ce)("img",{className:"mv_chat_sticker",src:Stickers.getStickerUrl(e,((0,o.isRetina)()?128:64)+"b")});r(t),(0,n.addEvent)(t,"error animationend",d),(0,n.addEvent)(t,"load",l)}}function r(e){let i="",r=0,n=0,l=0,d=(0,a.intval)((w.getHeight()-80)/6);for(let e=0;e<=100;e+=20){e>0&&(r+=(0,o.irand)(-4,4),n-=d,l+=(0,o.irand)(-4,4),d=(0,a.intval)(.9*d));i+=`\n          ${e}% {\n            transform: translate(${r}px, ${n}px) rotate(${l}deg) scale(${e?1:.7});\n            opacity: ${0==e||100==e?0:1};\n          }\n        `}const c="mv_chat_sticker_animation_"+Date.now()+"_"+(0,o.irand)(0,1e9);i=`@keyframes ${c} {${i}}`,e.appendChild((0,s.ce)("style",{innerHTML:i}));const _=(0,o.irand)(1500,2500)+"ms",h=(t==vk.id?0:w._stickersDelay+=100)+"ms";(0,s.setStyle)(e,{animation:[c,_,h,"linear"].join(" ")})}function l(e){const t=e.currentTarget||e;(w._stickersBatch||(w._stickersBatch=document.createDocumentFragment())).appendChild(t),w._appendStickerTimeout||(w._appendStickerTimeout=setTimeout((function(){w.appendStickersBatch(),w._appendStickerTimeout=null}),0))}function d(e){const t=e.currentTarget||e;(0,n.removeEvent)(t),t.remove()}},appendStickersBatch(){var e;const t=w._stickersBatch;if(t&&(w._stickersBatch=null,!w.isHidden())){if(!w.stickersWrap){const e=document.createElement("div");e.classList.add("mv_chat_stickers_wrap");const t=document.querySelector(".videoplayer");t&&(t.append(e),w.stickersWrap=e)}null==(e=w.stickersWrap)||e.appendChild(t)}},removeStickers(){if(w.stickersWrap)for(let e;e=(0,s.domFC)(w.stickersWrap);)(0,n.removeEvent)(e),e.remove()},appendMessage(e,t){const i=w._messagesBatch||(w._messagesBatch=document.createDocumentFragment()),o="#mv_chat_msg"+mvcur.mvData.oid+"_"+t;if(w.messagesWrap.querySelector(o)||i.querySelector(o))return;i.appendChild((0,s.se)(e));const r=i.childNodes;for(;i.childNodes.length>w.MAX_COMMENTS_NUM;)r[0].remove();w.isHidden()||w._appendMessageTimeout||(w._appendMessageTimeout=setTimeout((function(){w.appendMessagesBatch(),w._appendMessageTimeout=null}),0))},appendMessagesBatch(){if(w.isHidden()||window.Videoview.isFS||"hidden"===document.visibilityState)return;const e=w._messagesBatch;if(!e)return;w._messagesBatch=null,w.firstMsgIntro&&(w.firstMsgIntro.remove(),w.firstMsgIntro=null);const t=w.scroll.content,i=t.childNodes;let s=t.childNodes.length+e.children.length-w.MAX_COMMENTS_NUM;if(i.length&&s>0)for(;s>0;)i[0].remove(),s--;w.scroll.updateBelow((function(){t.appendChild(e)})),w.scroll.data.scrollBottom>100&&w.toggleScrollBottomBtn(!0)},toggleScrollBottomBtn(e){(0,s.toggleClass)(this.scrollBottomBtnWrap,"hidden",!e)},scrollBottom(){w.scroll.scrollBottom(0)},replyAsAnimate(e,t,i){const o=e&&(0,s.geByClass1)("mv_chat_reply_author_photo",e),r=o&&(0,s.geByClass)("mv_chat_reply_author_photo_img",o),n=(0,s.hasClass)(e,"mv_chat_author_secondary")?0:1;r&&r[n]&&(r[n].src=i),(0,s.toggleClass)(e,"mv_chat_author_secondary")},replyAsGroup(e,t){window.replyAsList?w.replyAsGroupTT(e,t):(window.replyAsList=[],window.replyAsData={},(0,s.domData)(e,"can_reply_as_any_group")?ajax.post("/al_groups.php?act=get_editor_clubs",{},{cache:1,onDone:function(i){window.replyAsList=i,(0,a.each)(i,(function(e,[t,i,s,o]){window.replyAsData[t]=this})),w.replyAsGroupTT(e,t)}}):w.replyAsGroupTT(e,t))},replyAsGroupList(e,t,i){const o=[i];let r=(0,s.domByClass)(e,"mv_chat_reply_group_data");if(r){let e=[(0,s.domData)(r,"group_id"),(0,s.domData)(r,"group_photo"),(0,s.domData)(r,"group_href"),(0,s.domData)(r,"group_name")];o.push(e),window.replyAsData[e[0]]=e}return(0,a.each)(window.replyAsList,(function(e,[i,s,r,n]){i!=t&&o.push(this)})),o},replyAsGroupOver(e){const t=(0,s.gpeByClass)("mv_chat_reply_form",e);(0,l.showTooltip)(e,{text:function(){return(0,s.domData)(t,"from-oid")<0?_.getLang("global_on_behalf_group"):_.getLang("global_on_behalf_me")},black:1,shift:[9,8,8]})},replyAsGroupTT(e,t){const i=w.replyAsProfileData(),o=(0,s.gpeByClass)("mv_chat_reply_form",e),r=o&&(0,s.domData)(o,"from-oid");let l=(0,s.data)(e,"tt");if(!i)return!1;if(!l){const o=w.replyAsGroupList(e,t,i);let d="";(0,a.each)(o,(function(e,[t,i,s,o]){d+=(0,a.getTemplate)("video_chat_message_author_select_row",{author_id:t,author_href:s,author_photo:i,author_name:o,classes:r==t?" active":""})})),l=new ElementTooltip(e,{content:'<div class="post_from_tt_choose _post_scroll_wrap">'+d+"</div>",appendToParent:!0,autoHide:!0,customShow:!0,defaultSide:"top",offset:function(){return[0,-5]},onFirstTimeShow:function(t){const i=(0,s.geByClass)("post_from_tt_row",t);(0,a.each)(i,(function(t,i){(0,n.addEvent)(i,"click",w.setReplyAsGroup.pbind(e,{from:(0,s.domData)(this,"from-oid")}))})),this.rows=i,this.scroll=new uiScroll((0,s.geByClass1)("_post_scroll_wrap",t)),setTimeout((function(){l.scroll.update(),l.updatePosition()}),0)},onShow:function(e){setTimeout((function(){if(!l.scroll)return;const t=(0,s.geByClass1)("active",e),i=t?t.offsetTop-(l.scroll.data.viewportHeight-(0,s.getSize)(t)[1])/2:0;l.scroll.scrollTop(i)}),0)},onHide:function(e){}}),(0,s.data)(e,"tt",l)}t&&l.isShown()&&w.setReplyAsGroup(e,{from:r==vk.id?t:vk.id}),e.tt&&e.tt.hide&&e.tt.hide(),l.isShown()||l.show()},replyAsProfileData:()=>window.mvcur&&mvcur.wallTpl&&mvcur.wallTpl.profileData,setReplyAsGroup(e,t){if(!e)return!1;const i=(0,s.domClosest)("mv_chat_reply_form",e),o=(0,s.data)(e,"tt"),r=t.from||(t.fromGroup?cur.oid:vk.id),n=r==vk.id?w.replyAsProfileData():window.replyAsData&&window.replyAsData[r];return!((0,s.domData)(i,"from-oid")==r||!n||n[0]!=r)&&((0,s.domData)(i,"from-oid",r),w.replyAsAnimate(i,n[2],n[1]),o&&o.rows&&(0,a.each)(o.rows,(function(){(0,s.toggleClass)(this,"active",(0,s.domData)(this,"from-oid")==r)})),e.setAttribute("aria-label",y.Ranges.isGroupId(r)?_.getLang("wall_reply_as_group"):_.getLang("wall_reply_as_user")),!1)},sendMessage(){if(w.messageSending)return;const e={Message:(0,a.trim)(Emoji.val(w.replyInput))};if(!e.Message)return void(0,s.elfocus)(w.replyInput);if(Date.now()-w.lastMsgSent<1e3)return window.tooltips&&tooltips.destroy(w.replyInput),void(0,l.showTooltip)(w.replyInput,{text:_.getLang("video_live_chat_too_fast"),black:1});const t=Videoview.getMvData(),i=(0,s.geByClass1)("mv_chat_reply_form",this.block);i&&(0,s.domData)(i,"from-oid")&&(e.from_oid=(0,s.domData)(i,"from-oid")),ajax.post("al_video.php?act=post_comment",(0,a.extend)(e,{video:t.videoRaw,hash:t.hash,videoviewer_chat:1,item_access_hash:mvcur.mvData.itemAccessHash}),{onDone:function(e,t){w.messageSending=!1,e&&t&&w.appendMessage(e,t),Emoji.val(w.replyInput,""),w.checkFormHeight(),w.scroll.data.scrollBottom&&w.scrollBottom(),w.lastMsgSent=Date.now(),mvcur.player&&mvcur.player.vars.stats_tmr&&(0,d.tmrTrackCustomGoal)("comment_in_sport_broadcast")},onFail:function(e){if(w.messageSending=!1,w.replyInput)return window.tooltips&&tooltips.destroy(w.replyInput),(0,l.showTooltip)(w.replyInput,{text:e,showdt:200,forcetodown:0,slide:15,black:1}),(0,s.elfocus)(w.replyInput),!0}}),w.messageSending=!0},sendSticker(e){const t=Videoview.getMvData();ajax.post("al_video.php?act=live_send_sticker",{sticker_id:e,owner_id:t.oid,video_id:t.vid,hash:t.hash,item_access_hash:mvcur.mvData.itemAccessHash},{onDone(){w.appendSticker(e,vk.id,!1)}})},showActionsMenu(e,t){const i=(0,v.getMsgElement)(e,t);(null==i?void 0:i.querySelector(".mv_chat_message_actions")).style.visibility="visible"},hideActionsMenu(e,t){const i=(0,v.getMsgElement)(e,t);(null==i?void 0:i.querySelector(".mv_chat_message_actions")).style.visibility=""},hidePinnedMessage(){g.PinnedMessageComponent.init()},showPinnedMessage(e,t,i,s,o,r,n=!1,a=!1,l=!1){const d=(0,v.getMsgElement)(e,r),c=null==d?void 0:d.querySelector(".mv_chat_message_text");g.PinnedMessageComponent.init({ownerId:e,commentId:r,text:(null==c?void 0:c.innerHTML)||"",authorId:t,authorName:i,authorHref:s,authorVerified:o,canUnpin:n,canDelete:a,canReport:l})},deleteMessage(e,t){const i=document.querySelector(`#mv_chat_msg${e}`);i&&(i.classList.add("_deleted"),ajax.post("al_video.php?act=delete_comment",{comment:e,hash:t,videoview_chat:1},{onDone(t){i&&(i.classList.add("_show_deleted_stub"),(0,s.val)((0,s.domByClass)(i,"mv_chat_message_content"),t));document.querySelector(`#pinned_message${e}`)&&w.hidePinnedMessage()}}))},showReportVideoChatCommentForm(e,t){(0,c.showReportForm)("video_comment",e,t,(()=>{const i=(0,v.getMsgElement)(e,t);i&&(i.classList.add("_deleted"),i.classList.add("_show_deleted_stub"),(0,s.val)((0,s.domByClass)(i,"mv_chat_message_content"),_.getLang("global_report_sent")))}))},pinMessage(e,t,i,s,o,r,n,a){(0,p.api)("video.pinComment",{owner_id:e,comment_id:r}).then((()=>{w.showPinnedMessage(e,t,i,s,o,r,!0,n,a)}))},unpinMessage(e,t){(0,p.api)("video.unpinComment",{owner_id:e,comment_id:t}).then((()=>{w.hidePinnedMessage()}))},isHidden(){return!!this.hidden||Videoview.isMinimized()},setHidden(e){this.hidden=e},toggle(){const e=w.isHidden();this.setHidden(!e),w.toggleStateClasses(),e&&w.scroll&&(w.appendMessagesBatch(),w.updateScroll()),e||w.removeStickers(),e&&window.Videoview.queueReconnect()},onFullscreenChange(e){window.VideoChat.onResize(),window.VideoChat.updateScroll(),e||window.Videoview.queueReconnect()},toggleStateClasses(){const e=!!this.block,t=w.isHidden(),i=Videoview.isMinimized();(0,s.toggleClass)("mv_box","_has_chat",e&&!i),(0,s.toggleClass)("mv_box","_hide_chat",e&&!i&&t);let o="";e&&(w.appendMessagesBatch(),o=t?_.getLang("video_aria_expand_chat"):_.getLang("video_aria_minimize_chat"));(0,s.ge)("mv_top_pl_toggle")&&(0,s.attr)("mv_top_pl_toggle","aria-label",o)},updateScroll(){w.scroll.update(),w.scroll.scrollBottom(),w.toggleScrollBottomBtn(!1)},onResize(){w.block&&(w._chatHeight=w.block.offsetHeight)},getHeight:()=>w.block?w._chatHeight||(w._chatHeight=w.block.offsetHeight):0,destroy(){if(w.block){if(w.scroll&&(w.scroll.destroy(),w.scroll=null),w.replyForm){const e=(0,s.data)(w.replyForm,"optId");void 0!==e&&Emoji.destroy(e),(0,s.removeData)(w.replyForm),(0,s.removeData)(w.replyInput),w.replyForm=w.replyInput=null}w.removeStickers(),(0,s.removeData)(w.block),w.block.remove(),w.block=null,w.messagesWrap=null,w.stickersWrap=null,w.options=null,clearTimeout(w._appendMessageTimeout),clearTimeout(w._appendStickerTimeout),w._appendMessageTimeout=null,w._appendStickerTimeout=null,w._messagesBatch=null,w.firstMsgIntro=null,w.messageSending=!1,w.toggleStateClasses()}}}},108705:(e,t,i)=>{i.d(t,{joinFullId:()=>s,joinRawId:()=>o});const s=(e,t)=>`${e}_${t}`,o=({ownerId:e,itemId:t,externalId:i})=>[e,t,i].filter(Boolean).join("_")},348354:(e,t,i)=>{i.d(t,{stickersEmojiKeyboard:()=>s});const s=(0,i(210929).createDomain)()},616912:(e,t,i)=>{i.d(t,{$userEnv:()=>r,setUserEnv:()=>o});var s=i(348354);const o=s.stickersEmojiKeyboard.createEvent(),r=s.stickersEmojiKeyboard.createStore({}).on(o,((e,t)=>t))},997650:(e,t,i)=>{i.d(t,{observe:()=>d,useInView:()=>c});var s=i(667294);const o=new Map,r=new WeakMap;let n,a=0;function l(e){return Object.keys(e).sort().filter((t=>void 0!==e[t])).map((t=>{return`${t}_${"root"===t?(i=e.root,i?(r.has(i)||(a+=1,r.set(i,a.toString())),r.get(i)):"0"):e[t]}`;var i})).toString()}function d(e,t,i={},s=n){if(void 0===window.IntersectionObserver&&void 0!==s){const o=e.getBoundingClientRect();return t(s,{isIntersecting:s,target:e,intersectionRatio:"number"==typeof i.threshold?i.threshold:0,time:0,boundingClientRect:o,intersectionRect:o,rootBounds:o}),()=>{}}const{id:r,observer:a,elements:d}=function(e){let t=l(e),i=o.get(t);if(!i){const s=new Map;let r;const n=new IntersectionObserver((t=>{t.forEach((t=>{var i;const o=t.isIntersecting&&r.some((e=>t.intersectionRatio>=e));e.trackVisibility&&void 0===t.isVisible&&(t.isVisible=o),null==(i=s.get(t.target))||i.forEach((e=>{e(o,t)}))}))}),e);r=n.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:t,observer:n,elements:s},o.set(t,i)}return i}(i);let c=d.get(e)||[];return d.has(e)||d.set(e,c),c.push(t),a.observe(e),function(){c.splice(c.indexOf(t),1),0===c.length&&(d.delete(e),a.unobserve(e)),0===d.size&&(a.disconnect(),o.delete(r))}}s.Component;function c({threshold:e,delay:t,trackVisibility:i,rootMargin:o,root:r,triggerOnce:n,skip:a,initialInView:l,fallbackInView:c,onChange:_}={}){var h;const[u,p]=s.useState(null),m=s.useRef(),[g,v]=s.useState({inView:!!l,entry:void 0});m.current=_,s.useEffect((()=>{if(a||!u)return;let s;return s=d(u,((e,t)=>{v({inView:e,entry:t}),m.current&&m.current(e,t),t.isIntersecting&&n&&s&&(s(),s=void 0)}),{root:r,rootMargin:o,threshold:e,trackVisibility:i,delay:t},c),()=>{s&&s()}}),[Array.isArray(e)?e.toString():e,u,r,o,n,a,i,c,t]);const y=null==(h=g.entry)?void 0:h.target,w=s.useRef();u||!y||n||a||w.current===y||(w.current=y,v({inView:!!l,entry:void 0}));const S=[p,g.inView,g.entry];return S.ref=S[0],S.inView=S[1],S.entry=S[2],S}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,i,s)=>{if(!t){var o=1/0;for(l=0;l<deferred.length;l++){for(var[t,i,s]=deferred[l],r=!0,n=0;n<t.length;n++)(!1&s||o>=s)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[n])))?t.splice(n--,1):(r=!1,s<o&&(o=s));if(r){deferred.splice(l--,1);var a=i();void 0!==a&&(e=a)}}return e}s=s||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>s;l--)deferred[l]=deferred[l-1];deferred[l]=[t,i,s]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var i=Object.create(null);__webpack_require__.r(i);var s={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var o=2&t&&e;"object"==typeof o&&!~leafPrototypes.indexOf(o);o=getProto(o))Object.getOwnPropertyNames(o).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,__webpack_require__.d(i,s),i},__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,i)=>(__webpack_require__.f[i](e,t),t)),[])),__webpack_require__.u=e=>75980===e?"menu_settings.fe841ee6e9d1770c7df7.js":9375===e?"voice_message_player.050d74b181d5db2642f0.js":28762===e?"speech.5c7a8bafaa4c80a92840.js":57468===e?"SilentModeForms.8425705394906aebc7de.js":96248===e?"feed-skeleton.6830e5b139046f63a92d.js":29019===e?"ReportForm.bca17ba3f106ecbaeea6.js":51162===e?"StickersKit.4339d749c3a9af1c83c0.js":79344===e?"sticker.8572aa685d86819d0a97.js":55489===e?"lottie-light.48f1a65d83e7d0217b60.js":7103===e?"stickers-layer-view.0f9e18fceeb83717335e.js":37211===e?"stickers-layer-purchase-details-view.ecd9d8e01b1f803b4eeb.js":39457===e?"stickers-random-selector-view.15fbf277235a4f58c348.js":78177===e?"stickers-random-selector-packs-view.82e74823176d3ebdeb11.js":34757===e?"stickers-random-selector-result-view.1613cb988c705d7da5ab.js":68346===e?"NewStickerPicker.861dc89b3c6eea368742.js":59240===e?"performance-stats.d89fb0a11246583657a4.js":24195===e?e+".13b2fb10985a55b7af12.js":63371===e?e+".be0b8c0c48a4a1b02a8e.js":62638===e?"183ae8612f6fc4f939669ff68939db2e.051ab845cc7544fd28c7.js":87448===e?"df5f2238430381af4073776990037d9a.442712de4c33add780bb.js":72809===e?"70b318539525aae4f37779c8dacf0473.deb135de08144aaa1549.js":35699===e?"5b9871f5e48dc927cf0229bdc83c9099.34760922f2bef30c3e9c.js":60514===e?"36663761e4c963339956e18f6140595c.059d39c9a857698a1410.js":31848===e?"f79ca980fcc26ca55859ad5158f5fea8.6879ee938d1351b5ed4c.js":882===e?"fba43c7a1c8ad19aa306e4c66812a52a.73a4f57c56bf469f3cd0.js":void 0,__webpack_require__.miniCssF=e=>882===e?"fba43c7a1c8ad19aa306e4c66812a52a.e8339c192951ae3223aa.css":e+"."+{7103:"40a7e407b709ab3e6fbf",29019:"673778676fc8f6a95111",34757:"b5be4318cc62f878564e",37211:"765824321a7e8c9308b4",39457:"76704ef5d1a34fea5625",57468:"e8a9b5d3b4a38f45d2ec",75980:"519f671449550110bbb1",78177:"28f0e479ab7f49cdada2",79344:"39ec17015c909fafa936"}[e]+".css",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,i,s)=>{if(inProgress[e])inProgress[e].push(t);else{var o,r;if(void 0!==i)for(var n=document.getElementsByTagName("script"),a=0;a<n.length;a++){var l=n[a];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")=="vk:"+i){o=l;break}}o||(r=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,__webpack_require__.nc&&o.setAttribute("nonce",__webpack_require__.nc),o.setAttribute("data-webpack","vk:"+i),o.src=e),inProgress[e]=[t];var d=(t,i)=>{o.onerror=o.onload=null,clearTimeout(c);var s=inProgress[e];if(delete inProgress[e],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((e=>e(i))),t)return t(i)},c=setTimeout(d.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=d.bind(null,o.onerror),o.onload=d.bind(null,o.onload),r&&document.head.appendChild(o)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),__webpack_require__.p="/dist/",loadStylesheet=e=>new Promise(((t,i)=>{var s=__webpack_require__.miniCssF(e),o=__webpack_require__.p+s;if(((e,t)=>{for(var i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var o=(n=i[s]).getAttribute("data-href")||n.getAttribute("href");if("stylesheet"===n.rel&&(o===e||o===t))return n}var r=document.getElementsByTagName("style");for(s=0;s<r.length;s++){var n;if((o=(n=r[s]).getAttribute("data-href"))===e||o===t)return n}})(s,o))return t();((e,t,i,s)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.onerror=o.onload=r=>{if(o.onerror=o.onload=null,"load"===r.type)i();else{var n=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=n,l.request=a,o.parentNode.removeChild(o),s(l)}},o.href=t,document.head.appendChild(o)})(e,o,t,i)})),installedCssChunks={75583:0},__webpack_require__.f.miniCss=(e,t)=>{installedCssChunks[e]?t.push(installedCssChunks[e]):0!==installedCssChunks[e]&&{882:1,7103:1,29019:1,34757:1,37211:1,39457:1,57468:1,75980:1,78177:1,79344:1}[e]&&t.push(installedCssChunks[e]=loadStylesheet(e).then((()=>{installedCssChunks[e]=0}),(t=>{throw delete installedCssChunks[e],t})))},(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={75583:0};__webpack_require__.f.j=(t,i)=>{var s=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==s)if(s)i.push(s[2]);else if(/^(75980|882)$/.test(t))e[t]=0;else{var o=new Promise(((i,o)=>s=e[t]=[i,o]));i.push(s[2]=o);var r=__webpack_require__.p+__webpack_require__.u(t),n=new Error;__webpack_require__.l(r,(i=>{if(__webpack_require__.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var o=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;n.message="Loading chunk "+t+" failed.\n("+o+": "+r+")",n.name="ChunkLoadError",n.type=o,n.request=r,s[1](n)}}),"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,i)=>{var s,o,[r,n,a]=i,l=0;if(r.some((t=>0!==e[t]))){for(s in n)__webpack_require__.o(n,s)&&(__webpack_require__.m[s]=n[s]);if(a)var d=a(__webpack_require__)}for(t&&t(i);l<r.length;l++)o=r[l],__webpack_require__.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return __webpack_require__.O(d)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var __webpack_exports__=__webpack_require__.O(void 0,[75514,98066,56990,76429,24509,76400,40885,38288,68592,86164,63489,43639],(()=>__webpack_require__(880431)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();