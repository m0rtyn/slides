(()=>{"use strict";var e,t,r,i,s,o,a={13112:(e,t,r)=>{r.d(t,{isEnvConfigEnabled:()=>s});var i=r(839470);function s(e){return(0,i.partConfigEnabled)(e)}},300886:(e,t,r)=>{r.d(t,{isUserAuthorized:()=>s});var i=r(931917);function s(){var e;const t=(null==window||null==(e=window.vk)?void 0:e.id)||0;return!i.Ranges.isZeroOwner(t)}},172721:(e,t,r)=>{r.d(t,{apiFaveAddNarrative:()=>s,apiFaveRemoveNarrative:()=>o});var i=r(599809);function s(e){return(0,i.api)("fave.addNarrative",e)}function o(e){return(0,i.api)("fave.removeNarrative",e)}},65856:(e,t,r)=>{r.d(t,{createFaveService:()=>i.createFaveService});r(172721);var i=r(34570)},34570:(e,t,r)=>{r.d(t,{createFaveService:()=>o});var i=r(210929),s=r(172721);const o=({domain:e})=>{const t=e.createEvent("fire/faveAddNarrative"),r=e.createEvent("fire/faveRemoveNarrative"),o=e.createEffect("fx/faveAddNarrative"),a=e.createEffect("fx/faveRemoveNarrative");return o.use(s.apiFaveAddNarrative),a.use(s.apiFaveRemoveNarrative),(0,i.sample)({clock:t,target:o}),(0,i.sample)({clock:r,target:a}),{fireAddNarrative:t,fireRemoveNarrative:r,addNarrativeFx:o,removeNarrativeFx:a}}},346805:(e,t,r)=>{r.d(t,{sendUploadRequest:()=>i});const i=(e,t,r)=>new Promise(((i,s)=>{const o=new XMLHttpRequest;o.open("POST",e,!0),r&&(o.upload.onloadstart=e=>{r(e)},o.upload.onprogress=e=>{r(e)}),o.onerror=()=>{s("Unknown error")},o.onreadystatechange=()=>{o.readyState===XMLHttpRequest.DONE&&(200===o.status?i(o.responseText):s())},o.send(t)}))},296195:(e,t,r)=>{r.d(t,{MAX_STORY_VIDEO_DURATION:()=>l,getStoryUploadUrl:()=>v,getStoryUploadUrlApi:()=>_,saveStoryOnServer:()=>S,uploadStoryBlobToServer:()=>f});var i=r(434788),s=r(664988),o=r(404145),a=r(839470),n=r(332268),c=r(517366),d=r(346805);const l=16,u=(0,o.isMvk)()?(0,a.partConfigEnabled)("mvk_stories-publisher_move-to-api-and-go-upload"):(0,a.partConfigEnabled)("web_stories-publisher_move-to-api-and-go-upload"),p=(e,t)=>{const{id:r,entry_point:i,ref:s,clickable_stickers:o,question_id:a,mini_app_id:n,live_cover:c,add_to_news:d=1,analytics:l,attachment:u,situational_suggest_id:p,live_cover_position:_}=e,v={group_id:r,add_to_news:d,entry_point:i,ref:s,clickable_stickers:o,question_id:a,mini_app_id:n,live_cover:c,analytics:l,situational_suggest_id:p};if(u){const e=JSON.parse(u);e.type&&!["url","playlist"].includes(e.type)&&(v.attach_type=e.type),(null==e?void 0:e.url)&&(v.link_url=e.url),(null==e?void 0:e.text)&&(v.link_text=e.text),(null==e?void 0:e.owner_id)&&(v.attach_owner_id=e.owner_id),(null==e?void 0:e.id)&&(v.attach_id=e.id),(null==e?void 0:e.access_key)&&(v.attach_access_key=e.access_key)}return v.attach_type||(v.attach_type=t),c&&_&&(v.live_cover_position=_),v};function _(e,t){return t===c.StoryType.PHOTO?n.storiesService.getPhotoUploadServerFx((0,i._)({},e,{upload_v2:1})).then((({upload_url:e})=>e)):n.storiesService.getVideoUploadServerFx(e).then((({upload_url:e})=>e))}function v(e,t){if(u){return _(p(e,t),t)}return new Promise(((t,r)=>{window.ajax.post((0,o.isMvk)()?"stories.php":"al_stories.php",(0,i._)({act:"get_upload_url"},e),{onDone:t,onError:r,onFail:r})}))}function f(e,t,r){const i=new FormData,o=encodeURIComponent(`edited_${(0,s.irand)(0,99999)}.jpg`);return i.append(u?"file":"file0",e,o),(0,d.sendUploadRequest)(t,i,r)}function S(e,t,r){if(u){var i,s;const r=t===c.StoryType.PHOTO?e:null==(i=JSON.parse(e))||null==(s=i.response)?void 0:s.upload_result;return n.storiesService.saveFx({upload_results_json:JSON.stringify([{upload_result:r}])}).then((({items:e})=>({story:e[0]})))}return new Promise(((t,i)=>{var s,a;window.ajax.post((0,o.isMvk)()?"stories.php":"al_stories.php",{act:"save",upload_result:null==(s=JSON.parse(e))||null==(a=s.response)?void 0:a.upload_result,hash:r},{onDone:t,onError:i,onFail:i})}))}},517366:(e,t,r)=>{var i,s,o,a,n;r.d(t,{StoryBlockType:()=>a,StoryEntryPoint:()=>s,StoryListName:()=>n,StorySource:()=>o,StoryType:()=>i}),function(e){e.PHOTO="photo",e.VIDEO="video",e.LIVE="live"}(i||(i={})),function(e){e.SWIPE="swipe",e.NAVIGATION_BUTTON="navigation_button",e.SIT_POSTING="sit_posting",e.LINK="link",e.STORY_REPLY="story_reply",e.STORY_REPOST="story_repost",e.CATALOG_ADD="catalog_add",e.DIALOG="dialog",e.STORY_LIVE_FINISHED="story_live_finished",e.DIALOG_VKME="dialog_vkme",e.STORY_VIEWER_FINISHED="story_viewer_finished",e.PUSH_TRY_MASK="push_try_mask",e.STORY_VIEWER_TRY_MASK="story_viewer_try_mask",e.LINK_MASK="link_mask",e.POSTING="posting",e.NEW_STORY_AVATAR="new_story_avatar",e.STORY_REPLIES_LIST="story_replies_list",e.STORIES_FEED="stories_feed",e.STORIES_SEARCH_NEWS="stories_search_news",e.QUESTION_STICKER="question_sticker",e.LIST_MIDDLE="list_middle",e.ARCHIVE_EMPTY_BUTTON="archive_empty_button",e.ARCHIVE_MENU_BUTTON="archive_menu_button",e.IM="im",e.PROFILE_BUTTON="profile_button",e.SHARE="share",e.MINI_APP="mini_app",e.SYSTEM_SHARING="system_sharing",e.SHORTCUT="shortcut",e.ARCHIVE_SHARING="archive_sharing",e.STORY_VIEWER_CAMERA_BUTTON="story_viewer_camera_button",e.STORY_VIEWER_MUSIC="story_viewer_music",e.STORY_VIEWER_MUSIC_SHEET="story_viewer_music_sheet",e.REPOST_TO_STORY_ACTIVITY="repost_to_story_activity",e.CHANGE_AVATAR="change_avatar"}(s||(s={})),function(e){e.FEED="feed",e.FEED_MIDDLE="feed_middle",e.LINK="link",e.PROFILE="profile",e.IM_DIALOGS="im_dialogs",e.IM_DIALOG_HEADER="im_dialog_header",e.SNIPPET="snippet",e.REPLY="reply",e.REPLIES_LIST="replies_list",e.REPLY_STORY="reply_story",e.DISCOVER="discover",e.STORIES_MANAGE="stories_manage",e.USER_PERSONAL_CARD="user_personal_card",e.GROUP_PERSONAL_CARD="group_personal_card",e.NARRATIVE_SNIPPET="narrative_snippet",e.NARRATIVE_STORY="narrative_story",e.NARRATIVE_LINK="narrative_link",e.NARRATIVE_RECOMMENDATIONS="narrative_recommendations",e.NARRATIVE_SECTION="narrative_section",e.FAVE="fave",e.SPAMFEED="sf",e.ADS_PREVIEW="ads_preview",e.LIST_MIDDLE="list_middle",e.PLACE_STORY_LIST="place_story_list",e.SEARCH_STORY_LIST="search_story_list",e.STORY_ARCHIVE="story_archive",e.IM_MSG_LIST="im_msg_list",e.NOSPAM="nospam",e.PROFILE_SNACKBAR="profile_snackbar",e.MY_QUESTIONS="question_story"}(o||(o={})),function(e){e.stories="stories",e.communityGroupedStories="community_grouped_stories",e.appGroupedStories="app_grouped_stories",e.discover="discover"}(a||(a={})),function(e){e.feed="feed",e.groups="groups",e.apps="apps",e.discover="discover"}(n||(n={}))},389920:(e,t,r)=>{r.d(t,{apiLikesAdd:()=>s,apiLikesDelete:()=>o});var i=r(599809);function s(e){return(0,i.api)("likes.add",e)}function o(e){return(0,i.api)("likes.delete",e)}},274857:(e,t,r)=>{var i;!function(e){e.Story="story"}(i||(i={}))},655555:(e,t,r)=>{r.d(t,{createLikesService:()=>i.createLikesService});var i=r(202269);r(389920),r(274857)},202269:(e,t,r)=>{r.d(t,{createLikesService:()=>o});var i=r(210929),s=r(389920);const o=({domain:e})=>{const t=e.createEvent("fire/likesAdd"),r=e.createEvent("fire/likesDelete"),o=e.createEffect("fx/likesAdd"),a=e.createEffect("fx/likesDelete");return o.use(s.apiLikesAdd),a.use(s.apiLikesDelete),(0,i.sample)({clock:t,target:o}),(0,i.sample)({clock:r,target:a}),{fireAdd:t,fireDelete:r,addFx:o,deleteFx:a}}},543384:(e,t,r)=>{r.d(t,{apiMessagesSend:()=>s});var i=r(599809);function s(e){return(0,i.api)("messages.send",e)}},105338:(e,t,r)=>{r.d(t,{createMessagesService:()=>i.createMessagesService});r(543384);var i=r(429128)},429128:(e,t,r)=>{r.d(t,{createMessagesService:()=>o});var i=r(210929),s=r(543384);const o=({domain:e})=>{const t=e.createEvent("fire/messageSend"),r=e.createEffect("fx/messageSend");return r.use(s.apiMessagesSend),(0,i.sample)({clock:t,target:r}),{fireMessagesSend:t,sendFx:r}}},494810:(e,t,r)=>{r.d(t,{apiNarrativesBatchEdit:()=>a,apiNarrativesCreate:()=>s,apiNarrativesDelete:()=>n,apiNarrativesEdit:()=>o,apiNarrativesReorder:()=>d,apiNarrativesSaveCustomCover:()=>c});var i=r(599809);function s(e){return(0,i.api)("narratives.create",e)}function o(e){return(0,i.api)("narratives.edit",e)}function a(e){return(0,i.api)("narratives.batchEdit",e)}function n(e){return(0,i.api)("narratives.delete",e)}function c(e){return(0,i.api)("narratives.saveCustomCover",e)}function d(e){return(0,i.api)("narratives.reorder",e)}},683313:(e,t,r)=>{r.d(t,{createNarrativesService:()=>i.createNarrativesService});var i=r(382983);r(494810)},382983:(e,t,r)=>{r.d(t,{createNarrativesService:()=>o});var i=r(210929),s=r(494810);const o=({domain:e})=>{const t=e.createEvent("fire/narrativesCreate"),r=e.createEvent("fire/narrativesEdit"),o=e.createEvent("fire/narrativesBatchEdit"),a=e.createEvent("fire/narrativesDelete"),n=e.createEvent("fire/narrativesSaveCustomCover"),c=e.createEvent("fire/narrativesReorder"),d=e.createEffect("fx/narrativesCreate"),l=e.createEffect("fx/narrativesEdit"),u=e.createEffect("fx/narrativesBatchEdit"),p=e.createEffect("fx/narrativesDelete"),_=e.createEffect("fx/narrativesSaveCustomCover"),v=e.createEffect("fx/narrativesReorder");return d.use(s.apiNarrativesCreate),l.use(s.apiNarrativesEdit),u.use(s.apiNarrativesBatchEdit),p.use(s.apiNarrativesDelete),_.use(s.apiNarrativesSaveCustomCover),v.use(s.apiNarrativesReorder),(0,i.sample)({clock:t,target:d}),(0,i.sample)({clock:r,target:l}),(0,i.sample)({clock:o,target:u}),(0,i.sample)({clock:a,target:p}),(0,i.sample)({clock:n,target:_}),(0,i.sample)({clock:c,target:v}),{fireCreate:t,fireEdit:r,fireBatchEdit:o,fireDelete:a,fireSaveCustomCover:n,fireReorder:c,createFx:d,editFx:l,batchEditFx:u,deleteFx:p,saveCustomCoverFx:_,reorderFx:v}}},630330:(e,t,r)=>{r.d(t,{apiPollsCreate:()=>o,apiPollsGetById:()=>s});var i=r(599809);function s(e){return(0,i.api)("polls.getById",e)}function o(e){return(0,i.api)("polls.create",e)}},527487:(e,t,r)=>{r.d(t,{createPollsService:()=>i.createPollsService});r(630330);var i=r(892883)},892883:(e,t,r)=>{r.d(t,{createPollsService:()=>o});var i=r(210929),s=r(630330);const o=({domain:e})=>{const t=e.createEvent("fire/pollsGetById"),r=e.createEvent("fire/pollsCreate"),o=e.createEffect("fx/pollsGetById"),a=e.createEffect("fx/pollsCreate");return o.use(s.apiPollsGetById),a.use(s.apiPollsCreate),(0,i.sample)({clock:t,target:o}),(0,i.sample)({clock:r,target:a}),{fireGetById:t,fireCreate:r,getByIdFx:o,createFx:a}}},362641:(e,t,r)=>{r.d(t,{getEnabledMvkTabs:()=>_,getEnabledWebTabs:()=>u,getMainDataLoadParams:()=>n,getOwnerContentTabsDataRequestParams:()=>d,getSupportedMvkTabs:()=>p,getSupportedWebTabs:()=>l,getViewerDataLoadParams:()=>c,makeUserFields:()=>o});var i=r(13112),s=r(300886);function o(e){return e.join(",")}const a=o(["is_sber_verified","is_tinkoff_verified","is_esia_verified","can_ban","can_see_gifts","followers_count","no_index","about","activities","activity","bdate","no_index","blacklisted","blacklisted_by_me","books","buttons","can_call","can_invite_to_chats","can_post","can_see_all_posts","can_see_wishes","can_send_friend_request","can_subscribe_stories","can_write_private_message","career","city","connections","counters","country","emoji_status","first_name_acc","first_name_dat","first_name_gen","first_name_ins","friend_status","games","gifts_tooltip","has_photo","home_town","image_status","interests","is_dead","is_favorite","is_hidden_from_feed","is_subscribed","is_subscribed_stories","last_name_acc","last_name_dat","last_name_gen","last_name_ins","last_seen","military","movies","music","mutual","occupation","online","online_info","owner_state","personal","quotes","relation","relatives","schools","screen_name","domain","sex","site","status","trending","tv","universities","verified","video_live","wall_default","bdate_visibility","contacts","photo_max","photo_medium_rec","photo_rec","can_ask_question","can_subscribe_posts","cover","first_name_nom","lists","maiden_name","nickname","photo_200","photo_400","photo_avg_color","photo_id","photo_max_size","profile_buttons","stories_archive_count","third_party_buttons","service_description","is_best_friend","is_nft","is_followers_mode_on"]);function n(e,t,r){const i=e===t,s={"photos.get":{owner_id:e,album_id:"profile",rev:1,count:1},"users.getSubscriptions":{fields:o(["photo_200","photo_100","description","status","is_nft"]),count:5,extended:1,user_id:e},"users.getFollowers":{fields:o(["photo_200","photo_100","photo_50","is_friend","sex"]),count:i?8:3,user_id:e},"gifts.get":{user_id:e,count:6}};return t&&(r.withoutFriends||(s["friends.get"]={user_id:e,count:12,fields:o(["domain","photo_100","photo_200","online","is_nft"]),order:"hints"}),s["stories.get"]={owner_id:e},s["account.getHelpHints"]={}),i&&(s["friends.getRequests"]={need_count:1,count:3,need_viewed:0,fields:o(["photo_100","photo_200","sex"]),extended:1},r.withOnlineFriends&&(s["friends.getOnline"]={user_id:e,count:8,order:"hints"}),s["account.getPrivacySettings"]={privacy_keys:"friends_requests,audios,stories,gifts",need_default:0},s["account.getSilentModeStatus"]={}),r.withoutUser||(s["users.get"]={user_ids:e.toString(),fields:a}),s}function c(e){return{user_ids:String(e),fields:o(["is_followers_mode_on","social_button_type"])}}function d(e,t,r={}){const i={};return t.forEach((t=>{switch(t){case"photos":r.isPhotoFeedEnabled?i["photos.photoFeedGet"]={owner_id:e,extended:1,photo_sizes:1,count:6}:i["photos.getAll"]={owner_id:e,photo_sizes:1,extended:1,skip_hidden:1};break;case"videos":i["video.get"]={owner_id:e,need_privacy:1,count:9};break;case"music":i["audio.get"]={owner_id:e,photo_sizes:1,count:8},i["audio.getPlaylists"]={owner_id:e,photo_sizes:1,count:9};break;case"short_videos":i["shortVideo.getOwnerVideos"]={owner_id:e,count:9};break;case"articles":i["articles.getOwnerPublished"]={owner_id:e,count:3};break;case"narratives":i["narratives.getFromOwner"]={owner_id:e,limit:9};break;case"nfts":i["nft.getCollection"]={owner_id:e};break;case"albums":i["photos.getAlbums"]={owner_id:e,count:9,need_system:1,need_covers:1,photo_sizes:1}}})),i}function l(){const e=(0,s.isUserAuthorized)(),t=e?["photos","short_videos","videos","music","articles","narratives","nfts"]:["short_videos"];return(0,i.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}function u(){const e=(0,s.isUserAuthorized)(),t=e?["photos","short_videos","music","articles","nfts"]:["short_videos"];return(0,i.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}function p(){const e=(0,s.isUserAuthorized)(),t=e?["photos","short_videos","videos","music","narratives","articles","nfts"]:["short_videos"];return(0,i.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}function _(){const e=(0,s.isUserAuthorized)(),t=e?["photos","short_videos","videos","music","narratives","articles","nfts"]:["short_videos"];return(0,i.isEnvConfigEnabled)("profile_enable_album_tabs")&&e&&t.push("albums"),t}},852063:(e,t,r)=>{r.d(t,{apiStatsTrackEvents:()=>s});var i=r(599809);function s(e){return(0,i.api)("stats.trackEvents",e)}},168298:(e,t,r)=>{r.d(t,{STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION:()=>i,STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME:()=>s,STATS_EVENT_TYPE_VIDEO_ONBOARDING:()=>o});const i="stories_viewer_navigation",s="stories_viewing_start_time",o="video_onboarding"},697227:(e,t,r)=>{r.d(t,{STATS_EVENT_TYPE_VIDEO_ONBOARDING:()=>i.STATS_EVENT_TYPE_VIDEO_ONBOARDING,apiStatsTrackEvents:()=>s.apiStatsTrackEvents,createStatsService:()=>o.createStatsService});var i=r(168298),s=r(852063),o=r(513234)},513234:(e,t,r)=>{r.d(t,{createStatsService:()=>o});var i=r(210929),s=r(852063);const o=({domain:e})=>{const t=e.createEvent("fire/statsTrackEvents"),r=e.createEffect("fx/statsTrackEvents");return r.use(s.apiStatsTrackEvents),(0,i.sample)({clock:t,target:r}),{fireTrackEvents:t,trackEventsFx:r}}},911622:(e,t,r)=>{r.d(t,{apiStoriesAskQuestion:()=>S,apiStoriesBanQuestionAuthor:()=>g,apiStoriesDelete:()=>f,apiStoriesDeleteQuestion:()=>h,apiStoriesGet:()=>s,apiStoriesGetArchive:()=>o,apiStoriesGetDetailedStats:()=>l,apiStoriesGetPhotoUploadServer:()=>k,apiStoriesGetQuestions:()=>c,apiStoriesGetReplies:()=>n,apiStoriesGetStats:()=>d,apiStoriesGetVideoUploadServer:()=>y,apiStoriesGetViewers:()=>a,apiStoriesHidePrivacyBlock:()=>v,apiStoriesMarkAppNotificationsSeen:()=>E,apiStoriesMarkNotInterested:()=>p,apiStoriesMarkSeen:()=>_,apiStoriesMarkSkipped:()=>u,apiStoriesSave:()=>w,apiStoriesSubscribeUserToApp:()=>b,apiStoriesUnbanQuestionAuthor:()=>m});var i=r(599809);function s(e){return(0,i.api)("stories.get",e)}function o(e){return(0,i.api)("stories.getArchive",e)}function a(e){return(0,i.api)("stories.getViewers",e)}function n(e){return(0,i.api)("stories.getReplies",e)}function c(e){return(0,i.api)("stories.getQuestions",e)}function d(e){return(0,i.api)("stories.getStats",e)}function l(e){return(0,i.api)("stories.getDetailedStats",e)}function u(e){return(0,i.api)("stories.markSkipped",e)}function p(e){return(0,i.api)("stories.markNotInterested",e)}function _(e){return(0,i.api)("stories.markSeen",e)}function v(e){return(0,i.api)("stories.hidePrivacyBlock",e)}function f(e){return(0,i.api)("stories.delete",e)}function S(e){return(0,i.api)("stories.askQuestion",e)}function h(e){return(0,i.api)("stories.deleteQuestion",e)}function g(e){return(0,i.api)("stories.banQuestionAuthor",e)}function m(e){return(0,i.api)("stories.unbanQuestionAuthor",e)}function E(e){return(0,i.api)("stories.markAppNotificationsSeen",e)}function b(e){return(0,i.api)("stories.subscribeUserToApp",e)}function k(e){return(0,i.api)("stories.getPhotoUploadServer",e)}function y(e){return(0,i.api)("stories.getVideoUploadServer",e)}function w(e){return(0,i.api)("stories.save",e)}},446731:(e,t,r)=>{r.d(t,{StoriesLoadMethods:()=>s,getStoriesLoadParams:()=>o});var i=r(362641);var s;!function(e){e[e.getViewers=0]="getViewers",e[e.getReplies=1]="getReplies",e[e.getQuestions=2]="getQuestions",e[e.getDetailedStats=3]="getDetailedStats",e[e.getStats=4]="getStats"}(s||(s={}));const o=(e,t)=>({0:{owner_id:e,story_id:t,extended:1,count:100,fields:(0,i.makeUserFields)(["domain","photo_100"])},1:{owner_id:e,story_id:t,extended:1,fields:(0,i.makeUserFields)(["is_nft","domain","photo"])},2:{owner_id:e,story_id:t,extended:1,fields:(0,i.makeUserFields)(["domain","first_name_dat","first_name_ins","last_name_ins","last_name_dat","first_name_gen","last_name_gen"]),count:30},3:{owner_id:e,story_id:t},4:{owner_id:e,story_id:t}})},332268:(e,t,r)=>{r.d(t,{StoriesLoadMethods:()=>o.StoriesLoadMethods,clearStoriesLoadingStats:()=>s.clearStoriesLoadingStats,clearStoriesNavigationStats:()=>s.clearStoriesNavigationStats,createStoriesService:()=>i.createStoriesService,getConnectionType:()=>s.getConnectionType,getStoriesLoadParams:()=>o.getStoriesLoadParams,getStoriesLoadingStats:()=>s.getStoriesLoadingStats,getStoriesNavigationStats:()=>s.getStoriesNavigationStats,saveNavigationStatEvent:()=>s.saveNavigationStatEvent,saveViewerStartTime:()=>s.saveViewerStartTime,serializeLoadingStats:()=>s.serializeLoadingStats,serializeNavigationStats:()=>s.serializeNavigationStats,statsService:()=>a.statsService,storiesService:()=>a.storiesService});var i=r(558231),s=r(386694),o=(r(911622),r(446731)),a=r(735369)},558231:(e,t,r)=>{r.d(t,{createStoriesService:()=>o});var i=r(210929),s=r(911622);const o=({domain:e})=>{const t=e.createEvent("fire/storiesGet"),r=e.createEvent("fire/storiesGetArchive"),o=e.createEvent("fire/storiesGetViewers"),a=e.createEvent("fire/storiesGetReplies"),n=e.createEvent("fire/storiesGetQuestions"),c=e.createEvent("fire/storiesGetStats"),d=e.createEvent("fire/storiesGetDetailedStats"),l=e.createEvent("fire/storiesMarkSkipped"),u=e.createEvent("fire/storiesMarkNotInterested"),p=e.createEvent("fire/storiesMarkSeen"),_=e.createEvent("fire/storiesHidePrivacyBlock"),v=e.createEvent("fire/storiesDelete"),f=e.createEvent("fire/storiesAskQuestion"),S=e.createEvent("fire/storiesDeleteQuestion"),h=e.createEvent("fire/storiesBanQuestionAuthor"),g=e.createEvent("fire/storiesUnbanQuestionAuthor"),m=e.createEvent("fire/storiesMarkAppNotificationsSeen"),E=e.createEvent("fire/storiesSubscribeUserToApp"),b=e.createEvent("fire/storiesGetPhotoUploadServer"),k=e.createEvent("fire/storiesGetVideoUploadServer"),y=e.createEvent("fire/storiesSave"),w=e.createEffect("fx/storiesGet"),T=e.createEffect("fx/storiesGetArchive"),A=e.createEffect("fx/storiesGetViewers"),I=e.createEffect("fx/storiesGetReplies"),N=e.createEffect("fx/storiesGetQuestions"),x=e.createEffect("fx/storiesGetStats"),O=e.createEffect("fx/storiesGetDetailedStats"),R=e.createEffect("fx/storiesMarkSkipped"),P=e.createEffect("fx/storiesMarkNotInterested"),C=e.createEffect("fx/storiesMarkSeen"),F=e.createEffect("fx/storiesHidePrivacyBlock"),M=e.createEffect("fx/storiesDelete"),D=e.createEffect("fx/storiesAskQuestion"),L=e.createEffect("fx/storiesDeleteQuestion"),G=e.createEffect("fx/storiesBanQuestionAuthor"),U=e.createEffect("fx/storiesUnbanQuestionAuthor"),V=e.createEffect("fx/storiesMarkAppNotificationsSeen"),B=e.createEffect("fx/storiesSubscribeUserToApp"),j=e.createEffect("fx/storiesGetPhotoUploadServer"),H=e.createEffect("fx/storiesGetVideoUploadServer"),Q=e.createEffect("fx/storiesSave");return w.use(s.apiStoriesGet),T.use(s.apiStoriesGetArchive),A.use(s.apiStoriesGetViewers),I.use(s.apiStoriesGetReplies),N.use(s.apiStoriesGetQuestions),x.use(s.apiStoriesGetStats),O.use(s.apiStoriesGetDetailedStats),R.use(s.apiStoriesMarkSkipped),P.use(s.apiStoriesMarkNotInterested),C.use(s.apiStoriesMarkSeen),F.use(s.apiStoriesHidePrivacyBlock),M.use(s.apiStoriesDelete),D.use(s.apiStoriesAskQuestion),L.use(s.apiStoriesDeleteQuestion),G.use(s.apiStoriesBanQuestionAuthor),U.use(s.apiStoriesUnbanQuestionAuthor),V.use(s.apiStoriesMarkAppNotificationsSeen),B.use(s.apiStoriesSubscribeUserToApp),j.use(s.apiStoriesGetPhotoUploadServer),H.use(s.apiStoriesGetVideoUploadServer),Q.use(s.apiStoriesSave),(0,i.sample)({clock:t,target:w}),(0,i.sample)({clock:r,target:T}),(0,i.sample)({clock:o,target:A}),(0,i.sample)({clock:a,target:I}),(0,i.sample)({clock:n,target:N}),(0,i.sample)({clock:c,target:x}),(0,i.sample)({clock:d,target:O}),(0,i.sample)({clock:l,target:R}),(0,i.sample)({clock:u,target:P}),(0,i.sample)({clock:p,target:C}),(0,i.sample)({clock:_,target:F}),(0,i.sample)({clock:v,target:M}),(0,i.sample)({clock:f,target:D}),(0,i.sample)({clock:S,target:L}),(0,i.sample)({clock:h,target:G}),(0,i.sample)({clock:g,target:U}),(0,i.sample)({clock:m,target:V}),(0,i.sample)({clock:E,target:B}),(0,i.sample)({clock:b,target:j}),(0,i.sample)({clock:k,target:H}),(0,i.sample)({clock:y,target:Q}),{fireGet:t,fireGetArchive:r,fireGetViewers:o,fireGetReplies:a,fireGetQuestions:n,fireGetStats:c,fireGetDetailedStats:d,fireMarkSkipped:l,fireMarkNotInterested:u,fireMarkSeen:p,fireHidePrivacyBlock:_,fireDelete:v,fireAskQuestion:f,fireDeleteQuestion:S,fireBanQuestionAuthor:h,fireUnbanQuestionAuthor:g,fireMarkAppNotificationsSeen:m,fireSubscribeUserToApp:E,fireGetPhotoUploadServer:b,fireGetVideoUploadServer:k,fireSave:y,getFx:w,getArchiveFx:T,getViewersFx:A,getRepliesFx:I,getQuestionsFx:N,getStatsFx:x,getDetailedStatsFx:O,markSkippedFx:R,markNotInterestedFx:P,markSeenFx:C,hidePrivacyBlockFx:F,deleteFx:M,askQuestionFx:D,deleteQuestionFx:L,banQuestionAuthorFx:G,unbanQuestionAuthorFx:U,markAppNotificationsSeenFx:V,subscribeUserToAppFx:B,getPhotoUploadServerFx:j,getVideoUploadServerFx:H,saveFx:Q}}},735369:(e,t,r)=>{r.d(t,{statsService:()=>_,storiesService:()=>p});var i=r(210929),s=r(332268),o=r(697227),a=r(683313),n=r(655555),c=r(105338),d=r(65856),l=r(527487);const u=(0,i.createDomain)("mvk/Stories"),p=(0,s.createStoriesService)({domain:u}),_=(0,o.createStatsService)({domain:u}),v=((0,a.createNarrativesService)({domain:u}),(0,n.createLikesService)({domain:u}),(0,c.createMessagesService)({domain:u}),(0,d.createFaveService)({domain:u}),(0,l.createPollsService)({domain:u}));u.createEffect("fire/storiesGetFeedback").use((({ownerId:e,storyId:t,pollId:r})=>{const i=(0,s.getStoriesLoadParams)(e,t);return Promise.allSettled([p.getViewersFx(i[s.StoriesLoadMethods.getViewers]),p.getRepliesFx(i[s.StoriesLoadMethods.getReplies]),p.getQuestionsFx(i[s.StoriesLoadMethods.getQuestions]),r?v.getByIdFx({owner_id:e,poll_id:r}):Promise.resolve(null),p.getDetailedStatsFx(i[s.StoriesLoadMethods.getDetailedStats]),p.getStatsFx(i[s.StoriesLoadMethods.getStats])]).then((e=>Promise.resolve(e.map((e=>"fulfilled"===e.status?null==e?void 0:e.value:null)))))}))},477932:(e,t,r)=>{function i(e){var t;return(null!=(t=null==e?void 0:e.split("_"))?t:[]).map(Number)}r.d(t,{splitStoryRawId:()=>i})},844469:(e,t,r)=>{r.d(t,{Publisher:()=>m});var i=r(785893),s=r(667294),o=r(514986),a=r(584356),n=r(937107),c=r(29271),d=r(517366),l=r(296195),u=r(970978),p=r(404145),_=r(540394),v=r(856505),f=r(227340),S=r(869048),h=r(86894),g=r(769824);class m extends s.Component{render(){const e=Math.min(900,window.innerHeight-100),t=e/1.78,r=(0,v.getPhotoEditorLangMap)();return(0,i.jsx)(S.AppRootProvider,{mode:"embedded",platform:h.Platform.VKCOM,viewWidth:h.ViewWidth.DESKTOP,children:(0,i.jsx)(n.default,{disableBodyScroll:!0,onClose:()=>this.onClose(),className:"Publisher PhotoEditorTheme",children:(0,i.jsx)(g.PhotoEditor,{context:"story",photoUrl:this.props.photoUrl,backgroundId:this.props.backgroundId,artboardWidth:t,artboardHeight:e,save:this.save,close:()=>this.onClose(),attachment:this.props.attachment,stickers:this.props.stickers,serviceInfo:this.props.serviceInfo,showStatusActions:!0,helpers:{showErrorBox:(e,t)=>(0,o.showFastBox)({title:e},t),logError:e=>(0,u.logError)(e,{environment:"photoEditor"}),getHostName:p.getHostName,prepareStat:_.prepareStat,prepareMediaEditorStat:_.prepareMediaEditorStat,sendStat:_.sendStat,showStickerShop:f.showStickerShop,fetchStickers:f.fetchStickers,getPhotoEditorData:f.getPhotoEditorData},langMap:r,locked:this.props.locked,storeInit:e=>window.cur.photoEditorStore=e,onDestroy:()=>{delete window.cur.photoEditorStore,delete window.cur.storyPublishContext}})})})}saveStory(e,t,r){return(0,l.getStoryUploadUrl)(t,d.StoryType.PHOTO).then((t=>(0,l.uploadStoryBlobToServer)(e,t))).then((e=>(0,l.saveStoryOnServer)(e,d.StoryType.PHOTO,r)))}constructor(...e){super(...e),this.errorHandler=(e,t)=>{const r=e||c.getLang("global_error");(0,o.showFastBox)({title:c.getLang("global_error")},r,c.getLang("global_close"),(()=>{t(),(0,a.curBox)().hide()}))},this.save=(e,t,r={})=>{var i;this.props.onClickSave(),this.saveStory(e,{attachment:JSON.stringify(this.props.attachment),clickable_stickers:r.clickableStickers,mini_app_id:this.props.miniAppId,question_id:this.props.questionId,situational_suggest_id:null==(i=this.props.serviceInfo)?void 0:i.situational_suggest_id,analytics:r.analytics,mediaEditorAnalytics:r.mediaEditorAnalytics,hash:r.storyUploadUrlHash,entry_point:this.props.entrypoint,ref:window.cur.module},r.storySaveHash).then((e=>{this.onClose(!0,!1,e),t()})).catch((e=>(this.errorHandler(e,t),!0)))},this.onClose=(e,t,r)=>{if(t)this.props.onClose(!1);else if(e)window.Stories&&window.Stories.updateFeedStories&&window.Stories.updateFeedStories(),this.props.onClose(!0,r);else{var i,s;(null==(i=null==(s=window.cur.photoEditorStore)?void 0:s.getState())?void 0:i.past.length)>1?(0,o.showFastBox)({title:c.getLang("photos_pe_story_editor_close_title"),bodyStyle:"padding: 20px; line-height: 160%;",onShow:()=>{window.cur._noEscHide=!0},onClean:()=>{window.cur._noEscHide=!1}},c.getLang("photos_pe_story_editor_close_text"),c.getLang("box_yes"),(()=>{(0,a.curBox)().hide(),this.props.onClose(!1)}),c.getLang("box_no"),(()=>{(0,a.curBox)().hide()})):this.props.onClose(!1)}}}}},213344:(e,t,r)=>{r.d(t,{StoryPublisher:()=>u});var i=r(785893),s=r(973935),o=r(844469),a=r(584356),n=r(29271),c=r(514986),d=r(540394),l=r(856505);const u={init(e,t,r){this.onClickSave=t||(()=>{}),this.cb=r,Promise.all([this.loadStatic(),(0,l.loadPhotoEditorLangs)()]).then((()=>{this.render(e)})).catch((()=>{(0,c.showFastBox)({title:n.getLang("global_error")},n.getLang("global_error"),n.getLang("global_close"),(()=>{(0,a.curBox)().hide()}))}))},loadStatic:()=>window.stManager.add([window.jsc("web/story_publisher.js"),"photo_editor.css"]),render(e){const t=(null==e?void 0:e.entrypoint)||"",r=(null==e?void 0:e.miniAppId)||0;window.cur.storyPublishContext=!0,"story_repost"===t?(0,d.sendStat)(d.EVENTS.ADD_STORY_FROM_SHARING):(0,d.sendStat)(d.EVENTS.ADD_STORY);let a=document.querySelector(".StoryPublisher");a||(a=document.createElement("div"),a.classList.add("StoryPublisher"),document.body.appendChild(a)),s.render((0,i.jsx)(o.Publisher,{entrypoint:t,miniAppId:r,onClose:this.destroy.bind(this),onClickSave:this.onClickSave.bind(this),photoUrl:null==e?void 0:e.photoUrl,attachment:null==e?void 0:e.attachment,stickers:null==e?void 0:e.stickers,serviceInfo:null==e?void 0:e.serviceInfo,questionId:null==e?void 0:e.questionId,backgroundId:null==e?void 0:e.backgroundId,locked:null==e?void 0:e.locked}),a)},destroy(e,t){const r=document.querySelector(".StoryPublisher");r&&s.unmountComponentAtNode(r),this.cb&&this.cb(e,t),delete window.cur.photoEditorStore,delete window.cur.renderImageFromState,e&&(0,a.showDoneBox)(n.getLang("photos_pe_story_published"))}}},645858:(e,t,r)=>{var i,s,o,a=r(213344);(null==(i=window.vk)||null==(s=i.pe)?void 0:s.static_manager_dynamic_imports)&&(null==(o=window.vk)?void 0:o.stDomain)&&(r.p=window.vk.stDomain+"/dist/"),window.StoryPublisher=a.StoryPublisher;try{window.stManager.done(window.jsc("web/story_publisher.js"))}catch(e){}},386694:(e,t,r)=>{r.d(t,{clearStoriesLoadingStats:()=>f,clearStoriesNavigationStats:()=>l,getConnectionType:()=>a,getStoriesLoadingStats:()=>v,getStoriesNavigationStats:()=>d,saveNavigationStatEvent:()=>c,saveViewerStartTime:()=>_,serializeLoadingStats:()=>S,serializeNavigationStats:()=>u});var i=r(659397),s=r(168298),o=r(477932);function a(){const{connection:e}=navigator;if(!e)return"";const{effectiveType:t,downlink:r}=e;switch(t){case"slow-2g":return"GPRS";case"2g":return"EDGE";case"3g":return"3G";case"4g":return r>8?"wi-fi":"LTE"}return""}let n=[];function c({storyRawId:e,source:t,action:r}){let i=0,a=0;e&&([i,a]=(0,o.splitStoryRawId)(e)),"reply"===t&&(t="replies_list");const c={e:s.STATS_EVENT_TYPE_STORIES_VIEWER_NAVIGATION,owner_id:i,story_id:a,source:t,action:r};n.push(c)}function d(){return(0,i.isArray)(n)?n:[]}function l(){n=[]}function u(){const e=n.map((({owner_id:e,story_id:t,source:r,action:i})=>[e,t,r,i].join(","))).join(";");return n=[],e}let p=[];function _({storyRawId:e,source:t,time:r}){const[i,n]=(0,o.splitStoryRawId)(e),c={e:s.STATS_EVENT_TYPE_STORIES_VIEWING_START_TIME,owner_id:i,story_id:n,source:t,time:r,internet_type:a()};p.push(c)}function v(){return(0,i.isArray)(p)?p:[]}function f(){p=[]}function S(){const e=p.map((({owner_id:e,story_id:t,source:r,time:i})=>[e,t,r,i].join(","))).join(";");return p=[],e}}},n={};function c(e){var t=n[e];if(void 0!==t)return t.exports;var r=n[e]={id:e,loaded:!1,exports:{}};return a[e].call(r.exports,r,r.exports,c),r.loaded=!0,r.exports}c.m=a,e=[],c.O=(t,r,i,s)=>{if(!r){var o=1/0;for(l=0;l<e.length;l++){for(var[r,i,s]=e[l],a=!0,n=0;n<r.length;n++)(!1&s||o>=s)&&Object.keys(c.O).every((e=>c.O[e](r[n])))?r.splice(n--,1):(a=!1,s<o&&(o=s));if(a){e.splice(l--,1);var d=i();void 0!==d&&(t=d)}}return t}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[r,i,s]},c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},r=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,c.t=function(e,i){if(1&i&&(e=this(e)),8&i)return e;if("object"==typeof e&&e){if(4&i&&e.__esModule)return e;if(16&i&&"function"==typeof e.then)return e}var s=Object.create(null);c.r(s);var o={};t=t||[null,r({}),r([]),r(r)];for(var a=2&i&&e;"object"==typeof a&&!~t.indexOf(a);a=r(a))Object.getOwnPropertyNames(a).forEach((t=>o[t]=()=>e[t]));return o.default=()=>e,c.d(s,o),s},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.f={},c.e=e=>Promise.all(Object.keys(c.f).reduce(((t,r)=>(c.f[r](e,t),t)),[])),c.u=e=>75980===e?"menu_settings.fe841ee6e9d1770c7df7.js":9375===e?"voice_message_player.050d74b181d5db2642f0.js":28762===e?"speech.5c7a8bafaa4c80a92840.js":57468===e?"SilentModeForms.8425705394906aebc7de.js":96248===e?"feed-skeleton.6830e5b139046f63a92d.js":59240===e?"performance-stats.d89fb0a11246583657a4.js":void 0,c.miniCssF=e=>e+"."+{57468:"e8a9b5d3b4a38f45d2ec",75980:"519f671449550110bbb1"}[e]+".css",c.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),c.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},c.l=(e,t,r,s)=>{if(i[e])i[e].push(t);else{var o,a;if(void 0!==r)for(var n=document.getElementsByTagName("script"),d=0;d<n.length;d++){var l=n[d];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")=="vk:"+r){o=l;break}}o||(a=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,c.nc&&o.setAttribute("nonce",c.nc),o.setAttribute("data-webpack","vk:"+r),o.src=e),i[e]=[t];var u=(t,r)=>{o.onerror=o.onload=null,clearTimeout(p);var s=i[e];if(delete i[e],o.parentNode&&o.parentNode.removeChild(o),s&&s.forEach((e=>e(r))),t)return t(r)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),a&&document.head.appendChild(o)}},c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),c.p="/dist/",s=e=>new Promise(((t,r)=>{var i=c.miniCssF(e),s=c.p+i;if(((e,t)=>{for(var r=document.getElementsByTagName("link"),i=0;i<r.length;i++){var s=(a=r[i]).getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(s===e||s===t))return a}var o=document.getElementsByTagName("style");for(i=0;i<o.length;i++){var a;if((s=(a=o[i]).getAttribute("data-href"))===e||s===t)return a}})(i,s))return t();((e,t,r,i)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",s.onerror=s.onload=o=>{if(s.onerror=s.onload=null,"load"===o.type)r();else{var a=o&&("load"===o.type?"missing":o.type),n=o&&o.target&&o.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=n,s.parentNode.removeChild(s),i(c)}},s.href=t,document.head.appendChild(s)})(e,s,t,r)})),o={55198:0},c.f.miniCss=(e,t)=>{o[e]?t.push(o[e]):0!==o[e]&&{57468:1,75980:1}[e]&&t.push(o[e]=s(e).then((()=>{o[e]=0}),(t=>{throw delete o[e],t})))},(()=>{var e={55198:0};c.f.j=(t,r)=>{var i=c.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else if(75980!=t){var s=new Promise(((r,s)=>i=e[t]=[r,s]));r.push(i[2]=s);var o=c.p+c.u(t),a=new Error;c.l(o,(r=>{if(c.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var s=r&&("load"===r.type?"missing":r.type),o=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,i[1](a)}}),"chunk-"+t,t)}else e[t]=0},c.O.j=t=>0===e[t];var t=(t,r)=>{var i,s,[o,a,n]=r,d=0;if(o.some((t=>0!==e[t]))){for(i in a)c.o(a,i)&&(c.m[i]=a[i]);if(n)var l=n(c)}for(t&&t(r);d<o.length;d++)s=o[d],c.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return c.O(l)},r=self.webpackChunkvk=self.webpackChunkvk||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var d=c.O(void 0,[75514,98066,56990,76429,24509,76400,40885,68592,25901],(()=>c(645858)));d=c.O(d)})();