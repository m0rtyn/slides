/*! For license information please see edb23b5a688004c0bd3cdad4a7949c7a.f35a429d1b798a8bdff2.js.LICENSE.txt */
"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[65401],{774351:(e,t,r)=>{function n(e,t){return new Promise((function(r){setTimeout(r.bind(null,t),1e3*e)}))}r.d(t,{pause:()=>n})},788822:(e,t,r)=>{r.d(t,{decodeHTMLEntities:()=>o,escape:()=>a});var n=[["&amp;","&"],["&lt;","<"],["&gt;",">"],["&quot;",'"']];function a(e){return n.reduce((function(e,t){var r=t[0],n=t[1];return e.replace(new RegExp(n,"ig"),r)}),e)}function o(e){return n.reduce((function(e,t){var r=t[0],n=t[1];return e.replace(new RegExp(r,"ig"),n)}),e).replace(/&#(\d+);/g,(function(e,t){return String.fromCodePoint(t)}))}},271831:(e,t,r)=>{function n(e){return e>0&&e<2e9}function a(e){return e>2e9}r.d(t,{isChatPeer:()=>a,isUserPeer:()=>n})},108679:(e,t,r)=>{var n=r(121296),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},o={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return n.isMemo(e)?i:s[e.$$typeof]||a}s[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[n.Memo]=i;var c=Object.defineProperty,u=Object.getOwnPropertyNames,d=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,m=Object.getPrototypeOf,_=Object.prototype;e.exports=function e(t,r,n){if("string"!=typeof r){if(_){var a=m(r);a&&a!==_&&e(t,a,n)}var i=u(r);d&&(i=i.concat(d(r)));for(var s=l(t),f=l(r),h=0;h<i.length;++h){var S=i[h];if(!(o[S]||n&&n[S]||f&&f[S]||s&&s[S])){var g=p(r,S);try{c(t,S,g)}catch(e){}}}}return t}},396103:(e,t)=>{var r="function"==typeof Symbol&&Symbol.for,n=r?Symbol.for("react.element"):60103,a=r?Symbol.for("react.portal"):60106,o=r?Symbol.for("react.fragment"):60107,i=r?Symbol.for("react.strict_mode"):60108,s=r?Symbol.for("react.profiler"):60114,l=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,u=r?Symbol.for("react.async_mode"):60111,d=r?Symbol.for("react.concurrent_mode"):60111,p=r?Symbol.for("react.forward_ref"):60112,m=r?Symbol.for("react.suspense"):60113,_=r?Symbol.for("react.suspense_list"):60120,f=r?Symbol.for("react.memo"):60115,h=r?Symbol.for("react.lazy"):60116,S=r?Symbol.for("react.block"):60121,g=r?Symbol.for("react.fundamental"):60117,E=r?Symbol.for("react.responder"):60118,v=r?Symbol.for("react.scope"):60119;function y(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case n:switch(e=e.type){case u:case d:case o:case s:case i:case m:return e;default:switch(e=e&&e.$$typeof){case c:case p:case h:case f:case l:return e;default:return t}}case a:return t}}}function I(e){return y(e)===d}t.AsyncMode=u,t.ConcurrentMode=d,t.ContextConsumer=c,t.ContextProvider=l,t.Element=n,t.ForwardRef=p,t.Fragment=o,t.Lazy=h,t.Memo=f,t.Portal=a,t.Profiler=s,t.StrictMode=i,t.Suspense=m,t.isAsyncMode=function(e){return I(e)||y(e)===u},t.isConcurrentMode=I,t.isContextConsumer=function(e){return y(e)===c},t.isContextProvider=function(e){return y(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===n},t.isForwardRef=function(e){return y(e)===p},t.isFragment=function(e){return y(e)===o},t.isLazy=function(e){return y(e)===h},t.isMemo=function(e){return y(e)===f},t.isPortal=function(e){return y(e)===a},t.isProfiler=function(e){return y(e)===s},t.isStrictMode=function(e){return y(e)===i},t.isSuspense=function(e){return y(e)===m},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===d||e===s||e===i||e===m||e===_||"object"==typeof e&&null!==e&&(e.$$typeof===h||e.$$typeof===f||e.$$typeof===l||e.$$typeof===c||e.$$typeof===p||e.$$typeof===g||e.$$typeof===E||e.$$typeof===v||e.$$typeof===S)},t.typeOf=y},121296:(e,t,r)=>{e.exports=r(396103)},441143:e=>{e.exports=function(e,t,r,n,a,o,i,s){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,n,a,o,i,s],u=0;(l=new Error(t.replace(/%s/g,(function(){return c[u++]})))).name="Invariant Violation"}throw l.framesToPop=1,l}}},495457:(e,t,r)=>{r.d(t,{getCallsCount:()=>h,getDefaultConversation:()=>p,getMediaOptions:()=>_,increaseCallsCount:()=>S,isActiveGroupCallMessage:()=>c,isAuthedByGroupId:()=>m,isGroupCallByPeer:()=>l,isIAmSpeaking:()=>f,isRequireAuthToJoin:()=>u,isWaitingHallEnabled:()=>d});var n=r(271831),a=r(22412),o=r(464380),i=r(659397),s=(r(878198),r(496111));const l=e=>0===e||(0,n.isChatPeer)(e)||null===e;function c(e){return e&&e.attaches&&e.attaches[0]&&"group_call_in_progress"===e.attaches[0].type}function u(e){return e.conversationOptions.includes(o.ConversationOption.REQUIRE_AUTH_TO_JOIN)}function d(e){return e.conversationOptions.includes(o.ConversationOption.WAITING_HALL)}function p(e){return{peerId:0,canAddMembers:!0,tab:e("calls_new_call_title"),photo:a.DEFAULT_GROUP_CALL_PHOTO}}function m(e){return!!e.groupId}function _({audio:e,video:t,animoji:r}){const n=[];return e&&n.push(o.MediaOption.AUDIO),t&&n.push(o.MediaOption.VIDEO),r&&n.push(o.MediaOption.ANIMOJI),n}function f(e){return!!e.externalId&&!!e.speakers[(0,s.externalIdToString)(e.externalId)]}function h(){var e;return Number(null!=(e=i.localStorage.getItem(a.CALLS_DESKTOP_APP_NOTIFICATION))?e:0)}function S(){var e;const t=Number(null!=(e=i.localStorage.getItem(a.CALLS_DESKTOP_APP_NOTIFICATION))?e:0)+1;i.localStorage.setItem(a.CALLS_DESKTOP_APP_NOTIFICATION,String(t))}},878198:(e,t,r)=>{r.d(t,{anyMatchInArray:()=>X,binarySearch:()=>J,calculateCallDuration:()=>T,capitalize:()=>K,compose:()=>M,conditionalPausedPromise:()=>V,convertCallerFromLongpoll:()=>v,convertChatFromLongpoll:()=>y,convertClientData:()=>g,convertServerData:()=>E,createImmediate:()=>ae,createPayload:()=>A,createTimeout:()=>ne,deepClone:()=>te,exponentialRetry:()=>D,fetchUserShortName:()=>S,getCallable:()=>z,getParticipantsListLabel:()=>x,getPeerIdFromLongpoll:()=>I,getTextForApiErrorByCode:()=>P,getTextForClientError:()=>O,getTextForServerError:()=>C,hasIn:()=>k,isAnyoneWithVideo:()=>R,isArraysEqual:()=>Z,isBoolean:()=>Q,isEmpty:()=>U,isGroupCallEvent:()=>b,isInReconnect:()=>N,isSameFeatureEndedNotification:()=>ie,last:()=>ee,minmax:()=>Y,noop:()=>W,normalizePreviewData:()=>L,objectFilter:()=>G,objectForEach:()=>$,objectMap:()=>F,objectReduce:()=>H,objectSome:()=>B,shallowEqual:()=>f.shallowEqual,shorten:()=>q,shuffle:()=>re,tokenValidateRetryWrapper:()=>w,unpackState:()=>j,vou:()=>oe});var n=r(434788),a=r(820224),o=r(271831),i=r(495457),s=r(22412),l=r(774351),c=r(659397),u=r(788822),d=r(455319),p=r(464380),m=r(496111),_=r(723062),f=r(50533);function h(e){let t=e.shortName,r=e.firstName,a=e.lastName;return t&&r||([r,a]=e.name.split(" "),t=S(r,a,e.name)),(0,n._)({},e,{peerId:+e.id,tab:e.name,shortName:t,firstName:r})}function S(e,t,r){if(e){const r=t?t.length>2?t.substring(0,1)+".":t:"";return r?`${e} ${r}`:e}return r}function g([e,t]){const r=e&&function(e){var{callInProgress:t=!1}=e,r=(0,a._)(e,["callInProgress"]);return!r.call_in_progress&&t&&(r.call_in_progress=t),r}(e);return[r&&("peerId"in r?r:h(r)),t?t.map(h):[]]}function E({items:e,profiles:t=[]}){const[r]=e,a=function(e){if(e.chat_settings){let t={peerId:e.peer.id,tab:e.chat_settings.title,name:e.chat_settings.title,canAddMembers:e.chat_settings.acl.can_invite,adminIds:e.chat_settings.admin_ids,ownerId:e.chat_settings.owner_id||-1};return e.chat_settings.photo&&(t.photo=e.chat_settings.photo.photo_200||e.chat_settings.photo.photo_100),t}return{canAddMembers:!0,peerId:e.peer.id}}(r),i=function(e){return e.map(d.normalizeUser)}(t);var s;return[(0,n._)({},a,{tab:a.name}),(0,o.isUserPeer)(null!=(s=a.peerId)?s:0)?[(0,n._)({},i&&i.filter((({peerId:e})=>e===a.peerId))[0],a)]:i,r]}function v(e){const t=e.caller_info,r=t.first_name+" "+t.last_name;return{peerId:+t.user_id,name:r,tab:r,photo:t.photo_400||t.photo_200,firstName:t.first_name,lastName:t.last_name,shortName:S(t.first_name,t.last_name,r),is_nft:!!t.is_nft}}function y(e){const t=e.chat_info;return{peerId:_.Ranges.convertChatIdToChatPeerId(t.chat_id),tab:t.title,name:t.title,photo:t.photo_400||t.photo_200}}function I(e){const t=e.caller_info,r=e.chat_info;return r?_.Ranges.convertChatIdToChatPeerId(r.chat_id):t.user_id}function b(e){return!!e.payload.chat_info}function R(e){return!!(0,m.isParticipantWithVideo)(e.localDevice)||B(e.devices,(e=>!(!e.wasConnected||!(0,m.isParticipantWithVideo)(e))))}function T(e){const t=Date.now(),r=Math.max(0,Math.floor((t-e)/1e3));return 0===r?"00:00":r<=599?"0"+(0,c.formatDuration)(r):(0,c.formatDuration)(r)}function P(e,t,r){switch(+e){case s.SERVER_ERROR_MESSAGES_CALL_JOIN_NOT_ALLOWED:return r("calls_join_error_require_access");case s.SERVER_ERROR_MESSAGES_CALL_NOT_FOUND:return r("calls_join_error_text");case s.SERVER_ERROR_MESSAGES_CALL_INVALID_JOIN_LINK:return r("calls_invalid_join_link");case s.SERVER_ERROR_PRIVACY:return r("calls_privacy_error");case s.SERVER_ERROR_BUSY:return r(t?"calls_chat_busy_error":"calls_busy_error");case s.SERVER_ERROR_FLOOD_CONTROL:return r("calls_flood_error");case s.SERVER_ERROR_REQUIRE_AUTH:return r("calls_join_error_require_auth");case s.SERVER_ERROR_UNKNOWN:case s.SERVER_ERROR_INVALID_REQUEST:case s.SERVER_ERROR_INTERNAL:case s.SERVER_ERROR_OLD_RECEIVER_APP:default:return r("calls_start_error")}}function C(e,t,r){var n,a;const o=0===e.search("EXTERNAL_API_ERROR"),i=e.match(/\d+/g),l=i?Number(null==(n=e.match(/\d+/g))?void 0:n[1]):s.CLIENT_ERROR_UNKNOWN,c=i?Number(null==(a=e.match(/\d+/g))?void 0:a[0]):s.CLIENT_ERROR_UNKNOWN;if(!o||Number.isNaN(l))return c===s.SDK_ERROR_AUTH?r("calls_start_error_auth"):function(e,t,r){switch(!0){case-1!==e.search("error.webrtc.auth.required"):return r("calls_join_error_require_auth");case-1!==e.search("error.webrtc.auth.banned"):case-1!==e.search("error.webrtc.participant.check.privacy"):return r("calls_join_error_banned");case-1!==e.search("error.webrtc.participant.check.killed_call"):return r("calls_join_error_killed_call");case-1!==e.search("not.found.webrtc.conversation"):return r("calls_join_error_not_found_conversation");default:return r("calls_start_error")}}(e,0,r);switch(e){case p.HangupType.CANCELED:return r("calls_hangup_error_canceled");case p.HangupType.REJECTED:return r("calls_hangup_error_rejected");case p.HangupType.REMOVED:return r("calls_hangup_error_removed");case p.HangupType.HUNGUP:return r("calls_hangup_error_hangup");case p.HangupType.MISSED:return r("calls_hangup_error_missed");case p.HangupType.BUSY:return r("calls_hangup_error_busy");case p.HangupType.FAILED:return r("calls_hangup_error_failed");case p.HangupType.NETWORK_ERROR:return r("calls_hangup_error_network_error");case p.HangupType.CALLER_IS_BLOCKED:return r("calls_hangup_error_caller_is_blocked");case p.HangupType.NOT_FRIENDS:return r("calls_hangup_error_not_friends");case p.HangupType.CALLEE_IS_OFFLINE:return r("calls_hangup_error_callee_is_offline");case p.HangupType.UNKNOWN_ERROR:return r("calls_hangup_error_unknown_error");case p.HangupType.UNSUPPORTED:return r("calls_hangup_error_unsupported");case p.HangupType.OLD_VERSION:return r("calls_hangup_error_old_version");case p.HangupType.SERVICE_DISABLED:return r("calls_hangup_error_service_disabled");case p.HangupType.EXTERNAL_API_ERROR:return r("calls_hangup_error_external_api_error");case p.HangupType.SOCKET_CLOSED:return r("calls_hangup_error_socket_closed");case p.HangupType.NOT_FOUND:return r("calls_hangup_error_not_found")}return P(+l,t,r)}function O(e,t,r){return r("calls_sorry_error")}function A(e,t,r=0){const n={is_video:t.includes(p.MediaOption.VIDEO),chat_id:(0,o.isChatPeer)(e)?_.Ranges.convertChatPeerIdToChatId(e):void 0,with_join_link:(0,i.isGroupCallByPeer)(e),join_by_link:(0,i.isGroupCallByPeer)(e),community_user_id:r};return JSON.stringify(n)}function N(e){return e.localDevice.status===p.ParticipantStatus.RECONNECT||B(e.devices,(e=>e.status===p.ParticipantStatus.RECONNECT))}const M=(e,...t)=>(...r)=>t.reduce(((e,t)=>t(e)),e)(...r);function D(e,t={attempts:10,timeout:0}){return(...r)=>t.attempts>0?(0,l.pause)(t.timeout,null).then((()=>e(...r))).catch((n=>(!t.timeout&&(t.timeout=1),t.attempts=n.type===s.SdkErrorType.API?0:t.attempts-1,t.timeout=Math.min(2*t.timeout,300),D(e,t)(...r)))):Promise.reject(s.CallErrorType.CANT_REACH_API)}const w=(e,t)=>(...r)=>t(...r).catch((n=>{if(n.error===s.FatalError.AUTH)return e().then((()=>t(...r)));throw n}));function x(e,t,r,n,a,o=0,i=3){const s=e=>(0,u.decodeHTMLEntities)(r(e)||"");if(0===o&&e.length>0&&(o=e.length),o>t.length){const r=o-t.length,l=e.slice(0,i).map(s).join(", ");return a(r,"calls_members_list_label",n("calls_members_list_label",r)).replace("{name}",l)}if(t.length>1){const r=t.length>2?e.slice(0,2).map(s).join(", "):s(e[0]),a=s(e[t.length-1]);return n("calls_and").replace("{before}",r).replace("{after}",a)}return 1===t.length?s(e[0]):""}function j(e){return"current"in e?e.current:e}function L(e,{join_link:t,preview:r,profiles:n,anonyms:a,call_id:o}){var i,l;const c=[...a||[],...n||[]].map(d.normalizeUser);return{joinLink:t,callId:o,title:null==r?void 0:r.title,membersCount:null==r?void 0:r.members_count,photo_100:null==r||null==(i=r.photo)?void 0:i.photo_100,photo_200:null==r||null==(l=r.photo)?void 0:l.photo_200,members:c,conversationData:{peerId:0,canAddMembers:!0,tab:e("calls_new_call_title"),photo:s.DEFAULT_GROUP_CALL_PHOTO}}}const V=e=>"number"!=typeof e||Number.isNaN(e)?Promise.resolve():(0,l.pause)(e,void 0),k=(e,...t)=>t.includes(e),U=e=>{switch(typeof e){case"boolean":case"string":case"undefined":case"number":return!e;case"function":case"bigint":case"symbol":return!0;case"object":return null!==e&&(Array.isArray(e)?!e.length:!Object.keys(e).length)}},G=(e,t)=>{const r=[];for(const n in e)e.hasOwnProperty(n)&&t(e[n])&&r.push(e[n]);return r},F=(e,t)=>{const r=[];for(const n in e)e.hasOwnProperty(n)&&r.push(t(e[n],n));return r},H=(e,t,r)=>{let n=r;for(const r in e)e.hasOwnProperty(r)&&(n=t(n,e[r],r));return n},$=(e,t)=>{for(const r in e)e.hasOwnProperty(r)&&t(e[r],r)};function B(e,t){for(const r in e)if(e.hasOwnProperty(r)&&t(e[r],r))return!0;return!1}const W=(...e)=>{},K=e=>{var t;return e.length?(null==(t=e.charAt(0))?void 0:t.toLocaleUpperCase())+e.slice(1):""},q=(e,t)=>e.length<=t?e:e.slice(0,Math.max(t-3,0)).trim().concat("..."),z=e=>"function"==typeof e?e():e;function J(e,t){let r=0,n=e.length,a=!1;for(;r<n;){const o=Math.floor((r+n)/2),i=t(e[o],o);i>0?r=o+1:(n=o,a=!i)}return a?r:~r}const Q=e=>"boolean"==typeof e,Y=(e,t,r,n=!0)=>n?e>=t&&e<=r:e>t&&e<r,X=(e,t)=>{if(!e||!t)return!1;const r=Array.isArray(t)?t:[t];if(!e.length&&!r.length)return!0;if(e.length&&!r.length)return!1;const n=new Set(e);return r.every((e=>n.has(e)))},Z=(e,t)=>!e&&!t||!(!e||!t)&&(e.length===t.length&&e.every(((e,r)=>e===t[r]))),ee=e=>{if(e.length)return e[e.length-1]},te=e=>Array.isArray(e)?e.map((e=>te(e))):e instanceof Date?new Date(e.getTime()):e&&"object"==typeof e?Object.getOwnPropertyNames(e).reduce(((t,r)=>{const n=Object.getOwnPropertyDescriptor(e,r);return n&&Object.defineProperty(t,r,n),t[r]=te(e[r]),t}),Object.create(Object.getPrototypeOf(e))):e,re=e=>{const t=e.length,r=e.slice();let n=-1;for(;++n<t;){const e=Math.floor(Math.random()*t),a=r[e];r[e]=r[n],r[n]=a}return r},ne=(e,t)=>{const r=setTimeout(e,t);return()=>clearTimeout(r)},ae=e=>{setTimeout(e,0)};function oe(e,t){return e?t:void 0}const ie=(e,t)=>Boolean(t&&t===e)},496111:(e,t,r)=>{r.d(t,{PARTICIPANTS_LIST_BUFFER_SIZE:()=>m,canMuteParticipants:()=>A,canPinParticipants:()=>P,convertParticipantStateFromSDK:()=>J,externalIdToString:()=>G,getActiveDevices:()=>y,getActiveDevicesCount:()=>W,getActiveParticipantsCount:()=>I,getAvailableStreamModes:()=>Z,getCallVisibleParticipant:()=>E,getDefaultExternalId:()=>K,getDeviceFromStoreById:()=>Y,getFirstMatchedId:()=>$,getMeId:()=>x,getMediaSettingsWithStreamMode:()=>ne,getNewStreamModeByDevice:()=>X,getNonAnonymousConnectParticipantsCount:()=>R,getOrator:()=>U,getParticipantExternalId:()=>h,getParticipantsInfo:()=>b,getPeerIdDeviceInfo:()=>F,getPreviousAvailableStreamMode:()=>ee,getRaisedHands:()=>N,getSausageStream:()=>L,getSelectedDevice:()=>q,getStream:()=>j,isAdmin:()=>C,isCallHaveOtherParticipants:()=>z,isCreator:()=>O,isParticipantAnonym:()=>_,isParticipantGroup:()=>f,isParticipantInCall:()=>S,isParticipantUnavailableToCallFromGroup:()=>g,isParticipantWithMovie:()=>k,isParticipantWithVideo:()=>V,isSameExternalId:()=>H,isStreamModeAvailable:()=>re,kickParticipant:()=>M,participantIsAdmin:()=>w,participantIsChatAdmin:()=>D,someDeviceByParticipant:()=>B,toggleScreenSharing:()=>Q});var n=r(434788),a=r(22412),o=r(495457),i=r(464380),s=r(878198),l=r(971),c=r(438655),u=r(743679),d=r(723062),p=r(227336);const m={ORATOR:30,GRID:60},_=e=>{const t="object"==typeof e?+e.id:Number(e);return d.Ranges.isAnonymousCallPeerId(t)},f=e=>{const t=Number(e);return d.Ranges.isGroupId(t)},h=e=>(null==e?void 0:e.peerId)?{id:e.peerId.toString(),type:i.ExternalIdType.USER}:null,S=(e,t)=>{if(t===e.me)return!0;const r=e.participants[t];return!!r&&B(r,(e=>!!e.status))},g=(e,t)=>!!e.unableToCallGroupMembersIds&&e.unableToCallGroupMembersIds.indexOf(t)>-1;function E(e,t){const r=(0,o.isGroupCallByPeer)(e.peer)?$(e.adminPinnedParticipant,(0,u.getWatchTogetherPinnedParticipant)(e),e.screenSharingPinnedParticipant,e.pinnedParticipant,e.orator):e.peer;let a=null;if(null!==r&&(a="object"==typeof r?G(r):r.toString()),a&&e.devices[a])return e.devices[a];let i=null;for(const r in e.devices){if(!e.devices.hasOwnProperty(r))continue;const n=e.devices[r];if(!H(n.externalId,e.externalId)&&n.wasConnected&&(i||(i=n),!t||V(n)))return n}return i||(i=(0,n._)({},e.localDevice,{externalId:e.externalId||K()})),i}let v=[];function y(e){const t=e.devices,r=e.adminPinnedParticipant,a=[],o=[],i=[],s=[],l=[],u=[],d=[],m=t=>{var n,c,m,_,f;t.status&&((null==(n=t.statusData)||null==(c=n.hand)?void 0:c.state)?a.push(t):H(t.externalId,r)?o.push(t):H(t.externalId,e.externalId)?i.push(t):(null==(m=t.mediaSettings)?void 0:m.isScreenSharingEnabled)?s.push(t):(null==(_=t.mediaSettings)?void 0:_.isVideoEnabled)?l.push(t):(null==(f=t.mediaSettings)?void 0:f.isAnimojiEnabled)?u.push(t):d.push(t)),t.screenSharingStream&&p.screenShareNotVisibleStat.measure(t.externalId)};var _;const f=null!=(_=e.rooms.roomParticipantIds[(0,c.roomIdToString)(e.rooms.roomId)])?_:[];for(const e of f)t[e.idString]&&m(t[e.idString]);var h,S;e.externalId&&m((0,n._)({},e.localDevice,{externalId:e.externalId}));const g=[...a.sort(((e,t)=>{var r,n,a,o;return(null!=(h=null==(r=e.statusData)||null==(n=r.hand)?void 0:n.ts)?h:0)-(null!=(S=null==t||null==(a=t.statusData)||null==(o=a.hand)?void 0:o.ts)?S:0)})),...o,...i,...s,...l,...u,...d];if(g.length!==v.length)v=g;else for(let e=0;e<g.length;e++)if(g[e]!==v[e]){v=g;break}return{activeDevices:v}}function I(e){const t=e.participants;let r=0;for(const n in t)t.hasOwnProperty(n)&&T(e.me,t[n])&&r++;return r}const b=({excludeAnonymFromCount:e,participants:t,me:r})=>{const n={membersCount:0,creatorPeerId:0};for(const o in t){var a;t.hasOwnProperty(o)&&(!n.creatorPeerId&&(null==(a=t[o].roles)?void 0:a.includes(i.UserRole.CREATOR))&&(n.creatorPeerId=+o),e&&_(+o)||T(r,t[o])&&n.membersCount++)}return n};function R(){const{devices:e,participants:t,me:r}=l.GlobalStore.getCallsState();return(0,s.objectReduce)(e,((e,n)=>{if(+n.externalId.id===r)return e;if(n.status!==i.ParticipantStatus.CONNECTED)return e;if(_(n.externalId))return e;const a=t[n.externalId.id];return(C(a)||O(a))&&e.admins++,e.users++,e}),{users:0,admins:0})}function T(e,t){return t.peerId===e||B(t,(e=>!!e.status))}function P(e){return C(e)||O(e)}function C(e){return!!(null==e?void 0:e.roles)&&e.roles.some((e=>e===i.UserRole.ADMIN))}function O(e){return!!(null==e?void 0:e.roles)&&e.roles.some((e=>e===i.UserRole.CREATOR))}function A(e){return!!e.roles&&(O(e)||C(e))}function N({devices:e,localDevice:t,handState:r,rooms:n}){var a;const o=r?Object.keys(r).length:(0,s.objectReduce)(e,((e,t)=>{var r,a;return t.status&&(null==(r=t.statusData)||null==(a=r.hand)?void 0:a.state)&&t.roomId===n.roomId&&e++,e}),0);return(null==(a=t.statusData.hand)?void 0:a.state)?o+1:o}function M(e,t=!1){const r=h(e);return r?(0,i.removeParticipant)(r,t):Promise.resolve()}function D(e,t){if(!t)return!1;const r=null==e?void 0:e.peerId;return!!r&&(r===t.ownerId||!!t.adminIds&&t.adminIds.includes(r))}function w(e){return C(e)||O(e)}function x(e){return(0,o.isAuthedByGroupId)(e)?e.groupId:e.me}function j(e,t){const{stream:r,screenSharingStream:n,animojiStream:a,movieStream:o,streamMode:s,mediaSettings:l,movieStreamInfo:c}=e,u=!!n&&l.isScreenSharingEnabled,d=!!a&&l.isAnimojiEnabled,p=!!r&&(l.isVideoEnabled||l.isAnimojiEnabled&&!!(null==t?void 0:t.animojiBackendRender)),m=!!o&&c;if(null==t?void 0:t.onlyVideo)return p||d?{data:p?r:a,type:i.MediaType.CAMERA}:null;switch(s){case i.MediaType.CAMERA:return p||d?{data:p?r:a,type:s}:null;case i.MediaType.SCREEN:return u?{data:n,type:s}:null;case i.MediaType.STREAM:case i.MediaType.MOVIE:return m?{data:o,type:s}:null;default:return p||d?{data:p?r:a,type:i.MediaType.CAMERA}:null}}function L(e,{isOrator:t,animojiBackendRender:r}){const{stream:n,screenSharingStream:a,animojiStream:o,movieStream:i,streamMode:s,mediaSettings:l,movieStreamInfo:c}=e,u=!(!a||!l.isScreenSharingEnabled),d=!(!o||!l.isAnimojiEnabled),p=!(!n||!(l.isVideoEnabled||l.isAnimojiEnabled&&r)),m=!(!i||!c);return t?j(e,{onlyVideo:p||d,animojiBackendRender:r}):s?m?{data:i,type:s}:u?{data:a,type:s}:p||d?{data:p?n:o,type:s}:null:null}function V(e){var t;return!!(null==(t=e.mediaSettings)?void 0:t.isVideoEnabled)||function(e){var t;return!(!(null==(t=e.mediaSettings)?void 0:t.isAnimojiEnabled)||!e.animojiStream&&!e.stream)}(e)||function(e){var t;return!!(null==(t=e.mediaSettings)?void 0:t.isScreenSharingEnabled)&&!!e.screenSharingStream}(e)}function k(e){return!!e.movieStream&&!!e.movieStreamInfo}function U(e){const t=$(e.adminPinnedParticipant,(0,u.getWatchTogetherPinnedParticipant)(e),e.screenSharingPinnedParticipant,e.pinnedParticipant,e.orator);if(t&&!H(e.externalId,t)){const r=e.devices[G(t)],n=e.participants[t.id];if(r&&n)return{device:r,participant:n,externalId:t}}return{device:e.localDevice,participant:e.participants[e.me],externalId:e.externalId}}function G(e){if(!e)throw new Error("externalId is null or undefined");let t=e.id;return"number"==typeof e.deviceIdx&&(t+=":d"+e.deviceIdx),t}const F=(e,t)=>{let r=0,n=null;for(const a in t){if(!t.hasOwnProperty(a))continue;if(r++,r>1)break;const o=t[a];+o.externalId.id===e&&(n=o)}return n};function H(e,t){return!(!e||!t)&&(e.deviceIdx===t.deviceIdx&&e.id===t.id)}function $(...e){for(const t of e)if(null!=t)return t;return null}function B(e,t){if(!e)return!1;const{maps:{vkIdToDevices:r},devices:n}=l.GlobalStore.getCallsState(),a=r.get(e.peerId);if(!a)return!1;for(const e of a){const r=n[e];if(r&&(null==t?void 0:t(r)))return!0}return!1}function W(e,t,r){if(r){const e=Math.max(0,r.countBefore),t=Math.max(0,r.countAfter);return 1+e+r.ids.length+t}let n=1;var a;const o=null!=(a=t.roomParticipantIds[(0,c.roomIdToString)(t.roomId)])?a:[];for(const t of o){const r=e[t.idString];r&&r.status&&n++}return n}function K(e){return{deviceIdx:0,id:null!=e?e:"0",type:i.ExternalIdType.USER}}const q=e=>{const{device:t}=U(e);return"externalId"in t?t:(0,n._)({},t,{externalId:e.externalId||K()})},z=()=>{const{devices:e,externalId:t,me:r}=l.GlobalStore.getCallsState(),n=(null==t?void 0:t.id)||r.toString();return(0,s.objectSome)(e,(e=>e.externalId.id!==n))};function J(e){let t=(0,s.deepClone)(e);var r,n,o,i;t.hand&&(t.hand={state:(null==e||null==(r=e.hand)?void 0:r.state)===a.SdkHandType.RAISED,ts:null==e||null==(n=e.hand)?void 0:n.ts});e.drat&&(t.drat={state:(null==e||null==(o=e.drat)?void 0:o.state)===a.SdkDratType.REQUESTED,ts:null==e||null==(i=e.drat)?void 0:i.ts});return t}function Q(e,t,r,n,o){var i;if(!(0,c.isInMyRoom)(n))return;const l=(0,s.objectReduce)(e.screenSharers,((e,t)=>t?e+1:e),0),d=(r,n)=>{const o=e=>{t({type:a.E_ACTION.TOGGLE_ORATOR_MODE,isOratorMode:e})},i=e=>{t({type:a.E_ACTION.SET_PINNED_PARTICIPANT,pinnedParticipant:e})};r&&!e.isOratorMode&&o(!0),!r&&e.screenSharingNeedDisableOratorModeAfterStop&&o(!1),t({type:a.E_ACTION.SET_SCREEN_SHARING_PINNED_PARTICIPANT,screenSharingPinnedParticipant:(0,u.getWatchTogetherPinnedParticipant)(e)?null:n,screenSharingNeedDisableOratorModeAfterStop:!e.isOratorMode,screenSharingOldPinnedParticipant:e.pinnedParticipant}),n&&e.pinnedParticipant&&i(null),n||e.pinnedParticipant||!e.screenSharingOldPinnedParticipant||i(e.screenSharingOldPinnedParticipant)};0===l&&r?d(!0,n):1!==l||r||d(!(!e.adminPinnedParticipant&&!e.pinnedParticipant),null);const p=null==(i=e.devices[G(n)])?void 0:i.mediaSettings;!!(null==p?void 0:p.isScreenSharingEnabled)!==r&&t({type:a.E_ACTION.SET_SCREEN_SHARER,participantId:n,isScreenSharingEnabled:r}),r&&o&&t({type:a.E_ACTION.CALL_NOTIFICATION,notification:{type:a.NotificationType.SCREEN_SHARING_STARTED,data:n}})}function Y(e,t){const r=G(t);return e.getState().devices[r]}function X(e,t,r){if(!t)return e;const{streamMode:n}=t;switch(e){case i.MediaType.STREAM:case i.MediaType.MOVIE:return te(e,t,r);case i.MediaType.SCREEN:return n===i.MediaType.MOVIE||n===i.MediaType.STREAM?n:te(e,t,r);case i.MediaType.CAMERA:return n===i.MediaType.MOVIE||n===i.MediaType.STREAM||n===i.MediaType.SCREEN?n:te(e,t,r);default:return null}}function Z(e){const t=[];return e.movieStreamInfo&&e.movieStream&&t.push(e.movieStreamInfo.source),e.mediaSettings.isScreenSharingEnabled&&e.screenSharingStream&&t.push(i.MediaType.SCREEN),(e.mediaSettings.isVideoEnabled&&e.stream||e.mediaSettings.isAnimojiEnabled&&(e.animojiStream||e.stream))&&t.push(i.MediaType.CAMERA),t}function ee(e,t){return Z(e).filter((e=>e!==t))[0]||null}function te(e,t,r){return r?e:ee(t,e)}function re(e,t,r=t.mediaSettings){switch(e){case i.MediaType.STREAM:case i.MediaType.MOVIE:return!(!t.movieStream||!t.movieStreamInfo);case i.MediaType.SCREEN:return!(!t.screenSharingStream||!r.isScreenSharingEnabled);case i.MediaType.CAMERA:return!!(t.stream&&r.isVideoEnabled||(t.animojiStream||t.stream)&&r.isAnimojiEnabled);default:return!1}}function ne(e,t){const r={mediaSettings:e};return t?(e.isVideoEnabled||e.isAnimojiEnabled||t.streamMode!==i.MediaType.CAMERA||(r.streamMode=X(i.MediaType.CAMERA,t,!1)),e.isScreenSharingEnabled||t.streamMode!==i.MediaType.SCREEN||(r.streamMode=X(i.MediaType.SCREEN,t,!1)),t.streamMode||(e.isScreenSharingEnabled&&t.screenSharingStream?r.streamMode=X(i.MediaType.SCREEN,t,!0):(e.isVideoEnabled&&t.stream||e.isAnimojiEnabled&&(t.stream||t.animojiStream))&&(r.streamMode=X(i.MediaType.CAMERA,t,!0))),r):r}},438655:(e,t,r)=>{r.d(t,{changeParticipantRoom:()=>u,equalsToMyRoom:()=>l,findRelatedRoom:()=>c,isInMyRoom:()=>s,roomIdToString:()=>i});var n=r(496111),a=r(971),o=r(366854);const i=e=>String(e),s=e=>{const t=a.GlobalStore.getCallsStore().getState(),r=t.rooms.roomParticipantIds[i(t.rooms.roomId)];return r&&r.some((t=>(0,n.isSameExternalId)(t,e)))},l=(e,t)=>{const r=(0,o.getRoomId)(e);return!r&&!t||r===t},c=(e,t)=>Object.values(t).find((t=>t.participantIds.some((t=>(0,n.isSameExternalId)(t,e))))),u=(e,t,r,n,a=!1)=>{if(a)e.switchRoom(r,n);else{const a=[],o=c(n,t);o&&a.push({id:o.id,removeParticipantIds:[n]}),r&&a.push({id:r,addParticipantIds:[n]}),e.updateRooms(a)}}},455319:(e,t,r)=>{r.d(t,{createFriendsCache:()=>u,getExternalIdByUserId:()=>p,getMemberForUserStack:()=>m,getUserName:()=>_,getUserShortName:()=>f,mergeGroupToParticipant:()=>d,normalizeGroup:()=>c,normalizeUser:()=>l});var n=r(434788),a=r(878198),o=r(788822),i=r(496111),s=r(464380);const l=({id:e,sex:t,first_name:r,last_name:n,screen_name:s,first_name_gen:l,name:c,photo_400:u,photo_200:d,can_call:p,online_info:m,is_nft:_,animated_avatar:f,custom_names_for_calls:h})=>{var S;let g;(0,i.isParticipantGroup)(+e)&&(r=(0,o.escape)(r)),s?g=`/${s}`:(0,i.isParticipantAnonym)(e)||(0,i.isParticipantGroup)(+e)||(g=`/id${e}`);const E={id:+e,peerId:+e,name:c||`${r} ${n}`,firstName:r,shortName:(0,a.fetchUserShortName)(r,n,c),shortNameGen:(0,a.fetchUserShortName)(l,n,c),link:g,sex:t,canCall:p,photo:u||d,onlineInfo:m||null,is_nft:_,animated_avatar:f};var v;(null==h||null==(S=h[0])?void 0:S.name)&&(E.customName=null==h||null==(v=h[0])?void 0:v.name);return E},c=({id:e,name:t,screen_name:r,photo_400:n,photo_200:a,photo_100:i})=>({id:-e,peerId:-e,name:(0,o.escape)(t),firstName:"",lastName:"",shortName:"",shortNameGen:"",link:r&&`/${r}`,photo:n||a||i,photo_100:i});function u(e){return e.reduce(((e,t)=>(e[t.id]=!0,e)),{})}function d(e,t){let r=(0,n._)({},t);return e.photo&&(r.photo=e.photo),e.name&&(r.name=e.name),e.link&&(r.link=e.link),r}function p(e){let t=s.ExternalIdType.USER;return(0,i.isParticipantGroup)(e)&&(t=s.ExternalIdType.GROUP),{id:e.toString(),type:t}}function m(e){const t=e.name||"";return e.photo?{src:e.photo,alt:t,key:e.peerId}:{id:e.peerId,text:t.slice(0,1)}}const _=e=>{const t=(null==e?void 0:e.customName)||(null==e?void 0:e.name)||(null==e?void 0:e.shortName)||"";return(0,o.decodeHTMLEntities)(t)},f=e=>{const t=(null==e?void 0:e.customName)||(null==e?void 0:e.shortName)||(null==e?void 0:e.name)||"";return(0,o.decodeHTMLEntities)(t)}},971:(e,t,r)=>{r.d(t,{GlobalStore:()=>n});class n{static setCallsStore(e){n._callsStore=e}static getCallsStore(){if(!n._callsStore)throw new Error("store was not initiated!");return n._callsStore}static isSet(){return Boolean(n._callsStore)}static getCallsState(){return n.getCallsStore().getState()}}n._callsStore=null},366854:(e,t,r)=>{r.d(t,{getRoomId:()=>n});const n=e=>e.rooms.roomId},743679:(e,t,r)=>{r.d(t,{getWatchTogetherInfo:()=>o,getWatchTogetherMovieState:()=>i,getWatchTogetherOwner:()=>a,getWatchTogetherPinnedParticipant:()=>n});const n=e=>{var t,r;return null!=(r=null==(t=e.watchTogether)?void 0:t.pinnedParticipant)?r:null},a=e=>{var t,r;return null!=(r=null==(t=e.watchTogether)?void 0:t.owner)?r:null},o=e=>{var t,r;return null!=(r=null==(t=e.watchTogether)?void 0:t.movieInfo)?r:null},i=e=>{var t,r;return null!=(r=null==(t=e.watchTogether)?void 0:t.movieState)?r:null}},227336:(e,t,r)=>{r.d(t,{screenShareNotVisibleStat:()=>d,useScreenShareNotVisibleStat:()=>p,useVisibleDeviceScreenShareNotVisibleStat:()=>m});var n=r(667294),a=r(464380),o=r(659397),i=r(732297),s=r(971),l=r(22412),c=r(495457),u=r(496111);const d=new class{init(){const e=s.GlobalStore.getCallsState();this._isEnabled=!!e.config.enableScreenShareNotVisibleStat}destroy(){for(const e of this._timers.values())clearTimeout(e.timer);this._timers.clear()}checkLayoutDiff(e){if(this._isEnabled)for(const t of e){if((0,o.isString)(t.uid))continue;if(t.mediaType!==a.MediaType.SCREEN)continue;const e=(0,u.externalIdToString)(t.uid);"stopStream"in t?this._clearMark(e):this._mark(e)}}measure(e){this._isEnabled&&this._collectStat((0,u.externalIdToString)(e))}_mark(e){this._clearMark(e),this._timers.set(e,{timer:setTimeout(this._collectStat.bind(this,e),3e4),ts:Date.now()})}_clearMark(e){this._getTimerValue(e)}_getTimerValue(e){const t=this._timers.get(e);return t?(clearTimeout(t.timer),this._timers.delete(e),t.ts):null}_collectStat(e){const t=this._getTimerValue(e);if(null===t)return;const r=Date.now()-t;if(r<1e4)return;const n=s.GlobalStore.getCallsState();i.callStats.logEvent({call_event_type:l.CallActionEventType.SCREEN_SHARE_NOT_VISIBLE,is_group_call:(0,c.isGroupCallByPeer)(n.peer),peer_id:n.peer,session_id:n.callData.callId,event_param:r})}constructor(){this._timers=new Map,this._isEnabled=!1}};function p(e){(0,n.useEffect)((()=>{if(e)return d.init(),()=>d.destroy()}),[e])}function m(e){(0,n.useEffect)((()=>{e&&e.screenSharingStream&&d.measure(e.externalId)}),[e])}},732297:(e,t,r)=>{r.d(t,{callStats:()=>i});var n=r(434788),a=r(496111);const o="type_voip_call_item";const i=new class{setActionStatCollector(e){this.actionStatCollector=e}setEventCommonData(e={}){this.eventCommonData=e}logEvent(e){var t;const r=e.peer_id,i=(0,a.isParticipantGroup)(r)?r:0,s=(0,n._)({},e,{peer_id:null==(t=e.peer_id)?void 0:t.toString(),session_id:e.session_id||"",lib_version:"calls_v2",group_id:i},this.eventCommonData);this.actionStatCollector&&this.actionStatCollector.logEvent({type:o,[o]:s})}constructor(){this.eventCommonData={}}}},427164:(e,t,r)=>{r.d(t,{default:()=>o});var n,a=r(310396);e=r.hmd(e),n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:e;const o=(0,a.default)(n)},310396:(e,t,r)=>{function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}r.d(t,{default:()=>n})}}]);try{stManager.done("dist/edb23b5a688004c0bd3cdad4a7949c7a.f35a429d1b798a8bdff2.js")}catch(e){}