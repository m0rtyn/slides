"use strict";(self.webpackChunkvk=self.webpackChunkvk||[]).push([[63489],{401703:(e,t,s)=>{s.d(t,{Icon24Gift:()=>r});var r=(0,s(825028).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" /></g></symbol>',24,24,!1,void 0)},494774:(e,t,s)=>{s.d(t,{RANDOM_PRODUCT_ID:()=>r,StickersGroup:()=>c,UGC_STICKERS_APP_ID:()=>i});const r=10101,i=51538586;var c;!function(e){e.LAYER="layer"}(c||(c={}))},582389:(e,t,s)=>{s.d(t,{moveStickersHintsToStickerPicker:()=>i});const r="StickersHints__marginTransition",i=(e,t)=>{const s=window.Emoji.opts[e];if(!(null==s?void 0:s.txt))return;const i=s.txt.parentNode.querySelector("._sticker_hints");if(!i)return;if(!("none"!==getComputedStyle(i).getPropertyValue("display")))return;t&&(i.classList.add(r),requestAnimationFrame((()=>i.classList.remove(r)))),i.style.setProperty("margin-left","0px");const{right:c}=i.getBoundingClientRect();if(window.StickerPickerViewer){const{isShown:e,isDown:t,wrapper:s}=window.StickerPickerViewer;if(!e||!s||t)return;const r=-(c-s.getBoundingClientRect().left+10);i.style.setProperty("margin-left",`${r}px`)}}},898718:(e,t,s)=>{s.d(t,{getCache:()=>l,getPackByStickerId:()=>p,getSticker:()=>u,getStickers:()=>_,updateCache:()=>d});var r=s(434788),i=s(363444),c=s(874162),n=s(899033),a=s(581522),o=s(531730);const l=()=>{if(!window.stickersCache){const e=o.ls.get("stickers_cache");window.stickersCache=(0,r._)({},c.DEFAULT_CACHE,e)}return window.stickersCache},d=e=>{window.stickersCache=(0,r._)({},l(),e)},u=e=>l().stickers.get(e),_=e=>{const{stickers:t}=l();return e.map((e=>t.get(e)))},g=e=>{const t=u(e);if(!t||!t.pack_id)return null;const s=(0,a.getProductFromCache)(t.pack_id);return s&&(0,n.isBasePack)(s)?s:null},p=e=>{const t=g(e);return t?Promise.resolve(t):new Promise((t=>{i.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone(s){(0,a.cacheProductsData)(s),t(g(e))},onFail:e=>(console.error(e),t(null),!0)})}))}},902220:(e,t,s)=>{s.d(t,{Cart:()=>d});var r=s(434788),i=s(820224),c=s(363444),n=s(383320),a=s(874162),o=s(581522),l=s(584356);class d{static create(e,t=[]){const s=e.map((e=>({product_id:e,amount:1})));return new d(s,t)}copy(){const e=new d(this.getItems(),this.getRecipientIds());return e.setOrder(this.getOrder()),e}getItems(){return Array.from(this.items.values())}setItems(e){this.items=new Map(e.map((e=>[e.product_id,e])))}loadItems(){const e=Array.from(this.items.keys());return(0,o.getProducts)(e).then((()=>{for(const e of Array.from(this.items.values()))e.product=(0,o.getProductFromCache)(e.product_id)}))}getProducts(){return(0,o.getProductsFromCache)(Array.from(this.items.keys()))}hasProduct(e){return this.items.has(e)}addProduct(e,t=!1){if(!this.hasProduct(e)){const s={product_id:e,amount:1};t?this.setItems([...this.getItems(),s]):this.setItems([s,...this.getItems()]),this.onChange&&this.onChange()}}removeProduct(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())}getRecipientIds(e=!1){return this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[a.SAMPLE_RECIPIENT_ID]:[]}setRecipientIds(e){this.recipientIds=new Set(e)}hasRecipientId(e){return this.recipientIds.has(e)}addRecipientId(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())}removeRecipientId(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())}setOrder(e){if(this._order=e,e){this.recipientIds.clear();for(const t of e.items)t.recipient_id!==a.SAMPLE_RECIPIENT_ID&&this.recipientIds.add(t.recipient_id)}}loadOrder(e){const t=e.items.map((e=>e.product_id));return(0,o.getProducts)(t).then((t=>(0,r._)({},e,{items:e.items.map(((e,s)=>(0,r._)({},e,{product:t[s]})))})),(()=>e))}getOrder(){return this._order}getRecipientsMap(){return this.recipients}getRecipients(){return Array.from(this.recipients.values())}getRecipientById(e){return this.recipients.get(e)}addRecipients(e){this.recipients=new Map([...this.getRecipients(),...e].map((e=>[e[0],e])))}getJSON(){return JSON.stringify({items:this.getItems().map((e=>(0,r._)({},e,{product:void 0}))),recipient_ids:this.getRecipientIds(!0)})}isLoaded(){return null!==this.getOrder()}cancelLoad(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)}load(e=!1){return this.cancelLoad(),new Promise((t=>{this.loadTimeout=window.setTimeout((()=>{this.loadCancellationToken=new n.AjaxCancellationToken,c.ajax.post("stickers.php",{act:"preview_products_order",cart:this.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:this.loadCancellationToken,onDone:e=>{(0,o.cacheProductsData)(e),Promise.all([this.loadItems(),this.loadOrder(e.order)]).then((([,s])=>{this.setOrder(s),e.recipients&&this.addRecipients(e.recipients),t(this)}),(()=>{}))},onFail:e=>(e&&window.__dev&&console.error(e),t(this),!0)})}),300)}))}order(e={}){var{ignoreEmptyError:t,emptyErrorLoader:s}=e,r=(0,i._)(e,["ignoreEmptyError","emptyErrorLoader"]);return new Promise((e=>{var i;c.ajax.post("stickers.php",{act:"order_products",cart:this.getJSON(),hash:r.hash||(null==(i=this.getOrder())?void 0:i.hash),message:r.message,is_private:r.is_private?1:0,ref:r.ref,gift_ref:r.gift_ref,v:r.v},{onDone:t=>{requestAnimationFrame((()=>{(0,l.hideBoxLoader)()})),(0,o.cacheProductsData)(t),t.result.random_selector_result=t.random_selector_result,Promise.all([this.loadOrder(t.order),this.loadOrder(t.result)]).then((([t,s])=>{this.setOrder(t),e(s)}),(()=>{}))},onFail:r=>!r&&t?(s&&requestAnimationFrame((()=>{(0,l.showBoxLoader)()})),!0):(r&&console.error(r),e(null),!0)})}))}constructor(e,t=[]){this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}}},34672:(e,t,s)=>{s.d(t,{default:()=>d});var r=s(785893),i=s(667294),c=s(997650),n=s(682615),a=s(899033),o=s(263031),l=s(821126);const d=({className:e,sticker:t,theme:s=a.Theme.LIGHT,width:d,height:u})=>{const[_,g]=(0,c.useInView)({threshold:0}),p=void 0!==t.animation,[h,m]=(0,i.useState)(!1);return(0,r.jsx)("div",{className:(0,n.classNames)("Sticker",e),ref:_,onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)},children:p?(0,r.jsx)(l.default,{sticker:t,theme:s,width:d,height:u,isInView:g,play:h}):(0,r.jsx)(o.default,{sticker:t,theme:s,width:d,height:u,isInView:g})})}},821126:(e,t,s)=>{s.d(t,{default:()=>d});var r=s(434788),i=s(785893),c=s(667294),n=s(682615),a=s(211248),o=s.n(a),l=s(457299);const d=({className:e,sticker:t,theme:s,width:a,height:d,isInView:u=!0,play:_=!1})=>{const g=(0,c.useRef)(null),[p,h]=(0,c.useState)(null),m=(0,l.getStickerAnimationUrl)(t,s);return(0,c.useEffect)((()=>{if(!p||!p.isLoaded)return;const e=_&&u;e&&!p.playing&&(p.item.play(),h((0,r._)({},p,{playing:!0}))),!e&&p.playing&&(p.item.pause(),h((0,r._)({},p,{playing:!1})))}),[p,_,u]),(0,c.useEffect)((()=>{if(!p||p.url!==m)if(p&&p.item.destroy(),m&&u){const e=o().loadAnimation({container:g.current,path:m,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:m,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(()=>{h((0,r._)({},t,{isLoaded:!0}))})),h(t)}else h(null)}),[m,u]),(0,i.jsx)("div",{className:(0,n.classNames)("StickerAnimation",e),style:{width:a,height:d},ref:g})}},263031:(e,t,s)=>{s.d(t,{default:()=>a});var r=s(785893),i=s(667294),c=s(682615),n=s(457299);const a=({className:e,sticker:t,theme:s,width:a,height:o,isInView:l=!0})=>{const d=(0,i.useRef)(null),u=(0,n.getStickerImageUrl)(t,a,o,s);return(0,i.useLayoutEffect)((()=>{d.current&&d.current.src!==u&&l&&(d.current.src=u)}),[l,u]),(0,r.jsx)("div",{className:(0,c.classNames)("StickerImage",e),style:{width:a,height:o},children:(0,r.jsx)("img",{className:"StickerImage__image",ref:d})})}},685463:(e,t,s)=>{s.d(t,{default:()=>I});var r=s(785893),i=s(667294),c=s(86894),n=s(584356),a=s(514986),o=s(221780),l=s(29271),d=s(331533),u=s(401703),_=s(899033),g=s(874162),p=s(898718),h=s(991243),m=s(86601),f=s(467558),k=s(617512),S=s(138255),v=s(34672),y=s(775680),P=s(142886),x=s(358740),w=s(753884),L=s(68003),j=s(659397),N=s(359639);const I=({pack:e,cart:t,options:{recipientIds:s=[],ref:I,gift_ref:C},closeBox:b})=>{const[R]=(0,m.usePack)(e.id);R&&(e=R);const[B,M]=(0,f.useStyles)(e.style_ids||[]),[G,T]=(0,S.useCart)((()=>t)),[D]=(0,k.useWithProducts)(G.getItems()),A=G.getProducts(),E=G.getOrder(),O=(0,p.getSticker)(e.sticker_ids[0]),H=function(e){if(!e)return null;const t=[],s=[];for(const r of e.items){const{product:e,error:i}=r;e&&!i&&((0,_.isPackProduct)(e)?t.push(r):(0,_.isStyleProduct)(e)&&s.push(r))}const r=s.reduce(((e,t)=>{var s;return e+((null==(s=t.price)?void 0:s.current)||0)}),0);if(t.length){const e=t.reduce(((e,t)=>{var s;return e+((null==(s=t.price)?void 0:s.current)||0)}),0);return e?s.length?r?(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_for_styles_for",s.length),"pack_price",l.getLang("global_n_votes",e),"styles_num",s.length,"styles_price_sum",r):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_for_styles_free",s.length),"pack_price",l.getLang("global_n_votes",e),"styles_num",s.length):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_for"),"pack_price",l.getLang("global_n_votes",e)):s.length?r?(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_free_styles_for",s.length),"styles_num",s.length,"styles_price_sum",l.getLang("global_n_votes",r)):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_free_styles_free",s.length),"styles_num",s.length):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_free"))}if(s.length)return r?(0,o.langStr)(l.getLang("purchases_stickers_order_summary_styles_for",s.length),"styles_num",s.length,"styles_price_sum",l.getLang("global_n_votes",r)):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_styles_free",s.length),"styles_num",s.length);return null}(E),F=!T&&E&&!E.error,[W,z]=(0,i.useState)(!1);let U=null;if(E)if(E.error){if(E.error===g.ORDER_ERRORS.NOT_SIGNED_IN){const e=()=>{(0,n.showDoneBox)(l.getLang("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))};U=(0,r.jsx)(c.Button,{mode:"primary",size:"m",loading:T,onClick:e,children:l.getLang("purchases_stickers_get_pack_btn")})}else if(E.error===g.ORDER_ERRORS.NO_VALID_ITEMS){if(1===E.items.length){const{product:e,error:t}=E.items[0];if(e&&t!==g.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&e.purchase_details){const{label:t,title:s,text:i,button_title:n,button_url:o}=e.purchase_details,d=()=>{(0,a.showFastBox)(s||l.getLang("purchases_stickers_catalog_purchase_details_title"),i,o&&n||void 0,o?()=>{window.location.href=o}:void 0)};U=(0,r.jsx)(c.Button,{mode:"primary",size:"m",loading:T,onClick:d,children:t||l.getLang("purchases_stickers_product_unavailable")})}}if(!U){const e=!E.items.find((e=>e.error!==g.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT));U=(0,r.jsx)(c.Button,{mode:"secondary",size:"m",disabled:!0,children:e?l.getLang("purchases_stickers_product_purchased"):l.getLang("purchases_stickers_product_unavailable")})}}}else{const e=()=>{W||(z(!0),G.order({ref:I,gift_ref:C}).then((e=>{z(!1),e&&!e.error&&(0,n.showDoneBox)((0,h.getPurchaseResult)(e))}),(()=>{})))},t=T||W;U=(0,r.jsx)(x.default,{mode:"primary",size:"m",loading:t,disabled:t,price:E.price,text:E.price.current?l.getLang("purchases_stickers_buy_for"):l.getLang("purchases_stickers_get_for_free"),onClick:e})}const V=!T&&void 0!==A.find((e=>null==e?void 0:e.can_gift)),$=D.reduce(((e,t)=>(t.product&&t.product.copyright&&e.add(t.product.copyright),e)),new Set),q=L.colorScheme.isDarkScheme()?_.Theme.DARK:_.Theme.LIGHT;return(0,r.jsxs)("article",{className:"StickerPackPreview",children:[(0,r.jsxs)("header",{className:"StickerPackPreview__header",children:[(0,r.jsx)(N.MessageBoxDismissButton,{onClick:b}),O&&(0,r.jsx)(v.default,{className:"StickerPackPreview__icon",sticker:O,theme:q,width:128,height:128}),(0,r.jsxs)("div",{className:"StickerPackPreview__info",children:[(0,r.jsx)(d.InnerHTML,{Component:"h1",className:"StickerPackPreview__title",children:e.title}),(0,r.jsx)(d.InnerHTML,{Component:"div",className:"StickerPackPreview__author",children:e.author}),(0,r.jsx)(d.InnerHTML,{Component:"div",className:"StickerPackPreview__description",children:e.description})]})]}),B.length>0&&(0,r.jsx)(y.default,{className:"StickerPackPreview__styles",styles:B,isLoading:M,isAdded:e=>G.hasProduct(e.id),add:e=>G.addProduct(e.id),remove:e=>G.removeProduct(e.id),gift:e=>{return t=e.id,void(0,w.giftStickerProducts)([t],s);var t}}),(0,r.jsxs)("div",{className:"StickerPackPreview__footerContainer",children:[(0,r.jsx)("section",{className:"StickerPackPreview__items",children:D.map((e=>(0,r.jsx)(P.default,{item:e,showHeader:B.length>0,remove:e.product&&(0,_.isStyleProduct)(e.product)?()=>G.removeProduct(e.product_id):void 0},e.product_id)))}),$.size>0&&(0,r.jsx)("section",{className:"StickerPackPreview__copyrights",children:Array.from($).map(((e,t)=>(0,r.jsx)("div",{className:"StickerPackPreview__copyright",children:(0,j.decodeHTMLEntities)(e)},t)))}),(0,r.jsxs)("footer",{className:"StickerPackPreview__footer",children:[!T&&(F||V)&&(0,r.jsx)("div",{className:"StickerPackPreview__footerNote",children:H}),(0,r.jsxs)(c.ButtonGroup,{children:[V&&(0,r.jsx)(c.Button,{mode:"primary",size:"m",onClick:()=>(()=>{const e=G.copy();e.setRecipientIds(s),(0,w.giftStickersCart)(e)})(),before:(0,r.jsx)(u.Icon24Gift,{width:20,height:20}),children:l.getLang("purchases_stickers_gift")}),U]})]})]})]})}},714117:(e,t,s)=>{s.d(t,{default:()=>y});var r=s(434788),i=s(785893),c=s(667294),n=s(86894),a=s(221780),o=s(29271),l=s(549309),d=s(910434),u=s(331533),_=s(899033),g=s(581522),p=s(902220),h=s(86601),m=s(467558),f=s(775680),k=s(740906),S=s(358740),v=s(753884);const y=({pack:e,options:t,closeBox:s,updateBox:y})=>{const[P,x]=(0,h.usePack)(e.id);P&&(e=P);const[w,L]=(0,m.useStyles)(e.style_ids||[]),j=x||L;(0,c.useEffect)((()=>{y()}),[j]);const N=(0,r._)({},e,{base_id:e.id,title:o.getLang("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:e.sticker_ids}),I=[N,...w],C=I.find((e=>e&&e.is_active))||N,[b,R]=(0,c.useState)(),B=b&&I.find((e=>e&&e.id===b)),M=e=>{R(e&&e.id)},G=B||C,T=G===N?o.getLang("purchases_stickers_product_preview_title_base_pack"):(0,a.langStr)(o.getLang("purchases_stickers_product_preview_title_style"),"title",G.title);(0,c.useEffect)((()=>{G.is_new&&(0,g.updateUserProductState)(G.id,_.UserProductStateKey.IsNew,0).finally((()=>{}))}),[G,G.is_new]);const[D,A]=(0,c.useState)(!1),[E,O]=(0,c.useState)(!1);return(0,i.jsxs)("article",{className:"StickerPackSettings",children:[(0,i.jsx)(l.ModalHeader,{className:"StickerPackSettings__header",title:e?(0,a.langStr)(o.getLang("purchases_stickers_style_selection_for_pack"),"title",e.title):"",onClose:s}),j?(0,i.jsx)("section",{className:"StickerPackSettings__content StickerPackSettings__content--loading",children:(0,i.jsx)(d.default,{size:24})}):(0,i.jsxs)(c.Fragment,{children:[I.length>0&&(0,i.jsx)(f.default,{className:"StickerPackSettings__styles",styles:I,isLoading:L,activeStyle:C,selectedStyle:G,select:e=>M(e)}),(0,i.jsxs)("div",{className:"StickerPackSettings__footerContainer",children:[(0,i.jsxs)("section",{className:"StickerPackSettings__stylePreview",children:[(0,i.jsx)(u.InnerHTML,{Component:"h2",className:"StickerPackSettings__stylePreviewTitle",children:T}),(0,i.jsx)(k.default,{product:G})]}),(0,i.jsx)("footer",{className:"StickerPackSettings__footer",children:(0,i.jsxs)(n.ButtonGroup,{children:[G.can_gift&&(0,i.jsx)(n.Button,{mode:"secondary",size:"m",onClick:()=>{return e=G.id,void(0,v.giftStickerProducts)([e],t.recipientIds||[]);var e}}),G.is_purchased?(0,i.jsx)(n.Button,{mode:"primary",size:"m",disabled:G===C,loading:E,onClick:()=>{return e=G,void(E||(O(!0),(0,g.activateProduct)(e).then((()=>{O(!1),M(void 0)}),(()=>{}))));var e},children:o.getLang("purchases_stickers_product_settings_save")}):(0,i.jsx)(S.default,{className:"StickerPackSettings__buy",mode:"primary",size:"m",price:G.price.purchase,text:G.price.purchase.current?o.getLang("purchases_stickers_buy_for"):o.getLang("purchases_stickers_get_for_free"),loading:D,onClick:()=>{return e=G,void(D||(A(!0),p.Cart.create([e.id]).load().then((e=>e.order())).then((()=>{A(!1)}),(()=>{}))));var e}})]})})]})]})]})}},580284:(e,t,s)=>{s.d(t,{default:()=>y});var r=s(785893),i=s(667294),c=s(584356),n=s(221780),a=s(29271),o=s(549309),l=s(910434),d=s(688731),u=s(635127),_=s(723170),g=s(671459),p=s(899033),h=s(457299),m=s(138255),f=s(445664),k=s(260795),S=s(358740),v=s(659397);const y=({cart:e,options:{ref:t,gift_ref:s},closeBox:y,updateBox:P})=>{const[x,w]=(0,m.useCart)(e),L=!x.isLoaded()&&w;(0,i.useEffect)((()=>{P()}),[L]);const j=x.getRecipientIds(),N=x.getOrder(),I=N&&!N.error&&N.items.find((e=>!e.error&&!(0,h.isSampleOrderItem)(e))),[C,b]=function(e){if(!e)return[null,null];let t;for(const s of e.items){const{product:e}=s;if(e&&(0,p.isPackProduct)(e)){t=e;break}}let s=e.items.filter((({product:e})=>null==e?void 0:e.can_gift));const r=s.filter((e=>!e.error&&!(0,h.isSampleOrderItem)(e)));r.length&&(s=r);const i=new p.ProductsByType(s.map((e=>e.product))),c=i.pack.values().next().value,o=Array.from(i.style);let l="",d="";if(1===o.length)l=(0,n.langStr)(a.getLang("purchases_stickers_gift_title_1_style"),"title",o[0].title),c?d=(0,n.langStr)(a.getLang("purchases_stickers_gift_description_with_pack"),"title",c.title):t&&(d=(0,n.langStr)(a.getLang("purchases_stickers_gift_description_for_pack"),"title",t.title));else if(c){if(l=(0,n.langStr)(a.getLang("purchases_stickers_gift_title_pack"),"title",c.title),o.length)switch(o.length){case 2:d=(0,n.langStr)(a.getLang("purchases_stickers_gift_description_with_2_styles"),"title1",o[0].title,"title2",o[1].title);break;case 3:d=(0,n.langStr)(a.getLang("purchases_stickers_gift_description_with_3_styles"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;case 4:d=(0,n.langStr)(a.getLang("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;default:const e=o.length-3;d=(0,n.langStr)(a.getLang("purchases_stickers_gift_description_with_3_styles_and_n_more",e),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title,"n",e)}}else if(o.length){switch(o.length){case 2:l=(0,n.langStr)(a.getLang("purchases_stickers_gift_title_2_styles"),"title1",o[0].title,"title2",o[1].title);break;case 3:l=(0,n.langStr)(a.getLang("purchases_stickers_gift_title_3_styles"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;case 4:l=(0,n.langStr)(a.getLang("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;default:const e=o.length-3;l=(0,n.langStr)(a.getLang("purchases_stickers_gift_title_3_styles_and_n_more",e),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title,"n",e)}t&&(d=(0,n.langStr)(a.getLang("purchases_stickers_gift_description_for_pack"),"title",t.title))}o.length?d+=" "+a.getLang("purchases_stickers_gift_description_styles"):d+=" "+a.getLang("purchases_stickers_gift_description");return[l,d]}(N),[,R]=(0,i.useState)(null);(0,i.useLayoutEffect)((()=>{const e=x.getRecipients();if(R(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:e,items:e,noResult:a.getLang("gifts_nobody_found"),introText:a.getLang("gifts_start_typing_recipient"),maxItems:20,onChange:(e,t)=>{1===e?x.addRecipientId(+t):x.removeRecipientId(+t)}})),j.length)for(const e of j){const t=x.getRecipientById(e);t&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,t)}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return()=>{window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[L]);const[B,M]=(0,i.useState)(""),[G,T]=(0,i.useState)(!1),[D,A]=(0,i.useState)(!1),E=()=>{D||(A(!0),x.order({message:B,is_private:G,ref:t,gift_ref:s}).then((e=>{A(!1),e&&!e.error&&((0,c.showDoneBox)(function(e,t){const s=new p.ProductsByType(e.items.filter((e=>!e.error)).map((e=>e.product))),r=function(e){const t=e.getPack(),s=e.getStyles();if(t)return s.length?(0,n.langStr)(a.getLang("purchases_stickers_gift_result_products_pack_and_styles",s.length),"title",t.title,"styles_num",s.length):(0,n.langStr)(a.getLang("purchases_stickers_gift_result_products_pack"),"title",t.title);if(s.length)switch(s.length){case 1:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_products_1_style"),"title",s[0].title);case 2:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_products_2_styles"),"title1",s[0].title,"title2",s[1].title);case 3:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_products_3_styles"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);case 4:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);default:{const e=s.length-3;return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_products_3_styles_and_n_more",e),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title,"n",e)}}return null}(s);if(!r)return null;const i=new Set;for(const s of e.items){const{error:e,recipient_id:r}=s;if(e)continue;const c=t(r);c&&i.add(c)}const c=function(e,t){const s=Array.from(e.values());switch(s.length){case 0:return null;case 1:{const e=1===t?a.getLang("purchases_stickers_gift_result_1_recipient_single","raw"):a.getLang("purchases_stickers_gift_result_1_recipient_multiple","raw");return(0,n.langStr)((0,a.langSex)(s[0][8],e),"name",s[0][8])}case 2:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_2_recipients",t),"name1",s[0][8],"name2",s[1][8]);case 3:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_3_recipients",t),"name1",s[0][8],"name2",s[1][8],"name3",s[2][8]);case 4:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_4_recipients",t),"name1",s[0][8],"name2",s[1][8],"name3",s[2][8],"name4",s[3][8]);case 5:return(0,n.langStr)(a.getLang("purchases_stickers_gift_result_5_recipients",t),"name1",s[0][8],"name2",s[1][8],"name3",s[2][8],"name4",s[3][8],"name5",s[4][8]);default:{const e=s.length-4,r=1===t?a.getLang("purchases_stickers_gift_result_4_recipients_and_n_more_single"):a.getLang("purchases_stickers_gift_result_4_recipients_and_n_more_multiple");return(0,n.langStr)(r,"name1",s[0][8],"name2",s[1][8],"name3",s[2][8],"name4",s[3][8],"n",e)}}return null}(i,s.getCount());if(!c)return null;return(0,n.langStr)(c,"products",r)}(e,(e=>x.getRecipientById(e)))),y())}),(()=>{})))};return(0,i.useEffect)((()=>{window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",D)}),[D]),(0,r.jsxs)("article",{className:"StickerProductsGift",children:[(0,r.jsx)(o.ModalHeader,{className:"StickerProductsGift__header",title:a.getLang("purchases_stickers_gift_box_title"),onClose:y}),L?(0,r.jsx)("section",{className:"StickerProductsGift__content StickerProductsGift__content--loading",children:(0,r.jsx)(l.default,{size:24})}):(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("section",{className:"StickerProductsGift__content",children:[(0,r.jsx)(f.default,{order:N,forceValid:!I}),(0,r.jsx)("h1",{className:"StickerProductsGift__productsTitle",children:(0,v.decodeHTMLEntities)(C||"")}),(0,r.jsx)("p",{className:"StickerProductsGift__productsDescription",children:(0,v.decodeHTMLEntities)(b||"")}),N&&(0,r.jsxs)(i.Fragment,{children:[(0,r.jsxs)("dl",{className:"StickerProductsGift__price",children:[(0,r.jsx)("dt",{className:"StickerProductsGift__priceLabel",children:a.getLang("purchases_gift_price_label")})," ",(0,r.jsx)("dd",{className:"StickerProductsGift__priceValue",children:a.getLang("global_n_votes",N.price.current)})]}),(0,r.jsx)("div",{className:"StickerProductsGift__balance",children:(0,n.langStr)(a.getLang("gifts_you_have_X_votes"),"votes",a.getLang("global_n_votes",N.balance))})]}),(0,r.jsxs)("div",{className:"StickerProductsGift__recipients",children:[(0,r.jsx)("label",{className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput",children:a.getLang("gifts_receiver")}),(0,r.jsxs)("div",{className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown",children:[(0,r.jsx)("div",{className:"fl_r wdd_arr"}),(0,r.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:a.getLang("gifts_choose_recipients")})]})]}),(0,r.jsxs)("div",{className:"StickerProductsGift__message",children:[(0,r.jsx)("label",{className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput",children:a.getLang("purchases_gift_your_message")}),(0,r.jsx)(d.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:B,onChange:e=>M(e.currentTarget.value),onResize:()=>P(),style:{height:80},disabled:D})]}),(0,r.jsx)(u.default,{className:"StickerProductsGift__isPrivate",checked:G,disabled:D,onChange:()=>T(!G),children:a.getLang("gifts_receiver_only")})]}),(0,r.jsxs)("footer",{className:"StickerProductsGift__footer",children:[(0,r.jsx)("div",{className:"StickerProductsGift__footerNote",children:!w&&N&&(0,r.jsxs)("div",{className:"StickerProductsGift__details",children:[a.getLang("purchases_stickers_gift_details_label"),(0,r.jsx)(g.default,{className:"StickerProductsGift__detailsTooltip",text:(0,r.jsx)(k.default,{order:N,recipients:x.getRecipientsMap()}),position:"t",align:"center",appearance:"light",children:(0,r.jsx)(_.default,{className:"StickerProductsGift__detailsHintIcon"})})]})}),(0,r.jsx)("div",{className:"StickerProductsGift__footerButtons",children:(0,r.jsx)(S.default,{className:"StickerProductsGift__gift",mode:I?"primary":"secondary",size:"m",loading:w||D,disabled:!I,price:null==N?void 0:N.price,text:I?(0,n.langStr)(a.getLang("purchases_stickers_gift_send_for"),"price",a.getLang("global_n_votes",null==N?void 0:N.price.current)):a.getLang("purchases_stickers_gift_send"),onClick:()=>E()})})]})]})]})}},260795:(e,t,s)=>{s.d(t,{default:()=>_});var r=s(785893),i=s(667294),c=s(221780),n=s(29271),a=s(331533),o=s(899033),l=s(457299),d=s(659397);function u(e){const t=e.getPack(),s=e.getStyles();let r="";return s.length&&(r=s.map((e=>(0,c.langStr)(n.getLang("purchases_stickers_gift_details_recipient_style_title"),"title",e.title))).join(", ")),t?r?(0,c.langStr)(n.getLang("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",r):(0,c.langStr)(n.getLang("purchases_stickers_gift_details_recipient_pack"),"title",t.title):r?(0,c.langStr)(n.getLang("purchases_stickers_gift_details_recipient_styles"),"style_titles",r):null}const _=({order:e,recipients:t})=>{const s=function(e){if(!e)return null;let t=e.items.filter((({product:e})=>null==e?void 0:e.can_gift));const s=t.filter((e=>!e.error&&!(0,l.isSampleOrderItem)(e)));s.length&&(t=s);const r=[],i=[];for(const e of t){const{product:t}=e;t&&((0,o.isPackProduct)(t)?r.push(e):(0,o.isStyleProduct)(t)&&i.push(e))}const a=i.reduce(((e,t)=>{var s;return e+((null==(s=t.price)?void 0:s.current)||0)}),0);if(r.length){const e=r.reduce(((e,t)=>{var s;return e+((null==(s=t.price)?void 0:s.current)||0)}),0);return i.length?(0,c.langStr)(n.getLang("purchases_stickers_gift_details_summary_pack_with_styles",i.length),"pack_price_sum",n.getLang("global_n_votes",e),"styles_num",i.length,"styles_price_sum",n.getLang("global_n_votes",a)):(0,c.langStr)(n.getLang("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",n.getLang("global_n_votes",e))}if(i.length)return(0,c.langStr)(n.getLang("purchases_stickers_gift_details_summary_styles",i.length),"styles_num",i.length,"styles_price_sum",n.getLang("global_n_votes",a));return null}(e),_=new Map;for(const s of e.items){const{error:e,product:r,recipient_id:i}=s;if(e)continue;const c=t.get(i);if(!c)continue;let n=_.get(c);n||(n=new o.ProductsByType,_.set(c,n)),n.add(r)}const g=Array.from(_.entries()),p=(0,i.useRef)(null);return(0,i.useEffect)((()=>{const e=p.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),(0,r.jsxs)("div",{className:"StickerProductsGiftDetails",ref:p,children:[s&&(0,r.jsx)(a.InnerHTML,{Component:"p",className:"StickerProductsGiftDetails__summary",children:s}),g.length>0&&(0,r.jsx)("ul",{className:"StickerProductsGiftDetails__recipients",children:g.map((([e,t])=>(0,r.jsxs)("li",{className:"StickerProductsGiftDetails__recipient",children:[(0,r.jsx)(a.InnerHTML,{Component:"div",className:"StickerProductsGiftDetails__recipientName",children:e[1]}),(0,r.jsx)("div",{className:"StickerProductsGiftDetails__recipientProducts",children:(0,d.decodeHTMLEntities)(u(t)||"")})]},e[0])))})]})}},445664:(e,t,s)=>{s.d(t,{default:()=>o});var r=s(785893),i=s(682615),c=s(899033),n=s(457299);const a={s:56,m:96,l:168},o=({order:e,forceValid:t=!1})=>{var s;const o=new Map,l=new Map;if(e)for(const t of e.items){const{product:e}=t;var d;if(e)if((0,c.isPackProduct)(e))if(o.has(e))null==(d=o.get(e))||d.push(t);else o.set(e,[t]);else if((0,c.isStyleProduct)(e)){var u;if(l.has(e))null==(u=l.get(e))||u.push(t);else l.set(e,[t])}}const _=o.keys().next().value,g=(_?1:0)+l.size,p=g>1?g>2?"s":"m":"l",h=a[p],m=Array.from(l.entries());t||m.sort((([,e],[,t])=>t.filter((e=>!e.error)).length-e.filter((e=>!e.error)).length));const f=m.slice(0,3);let k=m.slice(3),S=!0;if(!t){const e=k.filter((([,e])=>e.find((e=>!e.error))));e.length?k=e:S=!1}return(0,r.jsxs)("ul",{className:"StickerProductsGiftIcons",children:[_&&(0,r.jsx)("li",{className:(0,i.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${p}`,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!t&&!(null==(s=o.get(_))?void 0:s.find((e=>!e.error)))}),style:{backgroundImage:`url(${(0,n.getStickerPackIconUrl)(_,h,h)})`}},_.id),f.map((([e,s])=>(0,r.jsx)("li",{className:(0,i.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${p}`,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!t&&!s.find((e=>!e.error))}),style:{backgroundImage:`url(${(0,n.getStickerPackIconUrl)(e,h,h)})`}},e.id))),k.length?(0,r.jsxs)("li",{className:(0,i.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${p}`,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!S}),children:["+",k.length]},"more"):null]})}},333330:(e,t,s)=>{s.d(t,{default:()=>l});var r=s(785893),i=s(221780),c=s(29271),n=s(86894),a=s(549309),o=s(740906);const l=({style:e,options:{add:t},closeBox:s})=>(0,r.jsxs)("article",{className:"StickerStylePreview",children:[(0,r.jsx)(a.ModalHeader,{className:"StickerStylePreview__header",title:(0,i.langStr)(c.getLang("purchases_stickers_stickers_of_style"),"title",e.title),onClose:s}),(0,r.jsx)(o.default,{className:"StickerStylePreview__content",product:e}),(0,r.jsxs)("footer",{className:"StickerStylePreview__footer",children:[(0,r.jsx)(n.Button,{mode:"tertiary",size:"m",onClick:s,children:c.getLang("global_cancel")}),t&&(0,r.jsx)(n.Button,{mode:"primary",size:"m",onClick:()=>t(e),children:c.getLang("purchases_stickers_preview_add_item")})]})]})},775680:(e,t,s)=>{s.d(t,{default:()=>u});var r=s(785893),i=s(682615),c=s(29271),n=s(159868),a=s(671459),o=s(723170),l=s(206198),d=s(652219);const u=({className:e,styles:t,isLoading:s,isAdded:u,add:_,remove:g,gift:p,activeStyle:h,selectedStyle:m,select:f})=>{const k=(0,l.default)({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(s)return(0,r.jsx)("section",{className:(0,i.classNames)("StickerStylesMenu","StickerStylesMenu--loading",e),children:(0,r.jsx)(n.default,{className:"StickerStylesMenu__progress"})});const S=[{title:c.getLang("purchases_stickers_purchased_styles"),styles:t.filter((e=>e.is_purchased&&!e.is_disabled))},{title:c.getLang("purchases_stickers_other_styles"),styles:t.filter((e=>!e.is_purchased&&!e.is_disabled&&!e.is_hidden)),tooltip:c.getLang("purchases_stickers_styles_hint")}].filter((e=>e.styles.length));return S.length?(0,r.jsxs)("section",{className:(0,i.classNames)("StickerStylesMenu",e),ref:k.ref,onWheel:e=>k.onWheel(e),children:[(0,r.jsx)("a",{className:(0,i.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!k.hasPrev}),onClick:()=>k.prev()}),(0,r.jsx)("a",{className:(0,i.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!k.hasNext}),onClick:()=>k.next()}),(0,r.jsx)("div",{className:"StickerStylesMenu__wrapper",children:S.map(((e,t)=>(0,r.jsxs)("section",{className:"StickerStylesMenu__group",children:[(0,r.jsxs)("h2",{className:"StickerStylesMenu__groupTitle",children:[e.title,e.tooltip&&(0,r.jsx)(a.default,{className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light",children:(0,r.jsx)(o.default,{className:"StickerStylesMenu__groupTitleHintIcon"})})]}),(0,r.jsx)("div",{className:"StickerStylesMenu__groupItems",children:e.styles.map((e=>(0,r.jsx)(d.default,{className:"StickerStylesMenu__item",style:e,isLoading:s,isAdded:u&&u(e),add:_&&(()=>_(e)),remove:g&&(()=>g(e)),gift:p&&(()=>p(e)),isActive:void 0===h?void 0:e===h,isSelected:void 0===m?void 0:e===m,select:f&&(()=>f(e))},e.id)))})]},t)))})]}):null}},652219:(e,t,s)=>{s.d(t,{default:()=>u});var r=s(785893),i=s(682615),c=s(29271),n=s(589897),a=s(331533),o=s(898718),l=s(401703),d=s(34672);const u=({className:e,style:t,isAdded:s=!1,add:u,remove:_,gift:g,isActive:p,isSelected:h,select:m})=>{let f;f=t.is_new?t.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):t.title;const k=(0,o.getSticker)(t.style_sticker_ids[0]),S=e=>t=>{t.stopPropagation(),e()};return(0,r.jsxs)("div",{className:(0,i.classNames)("StickerStylesMenuItem",e,{"StickerStylesMenuItem--selected":Boolean(h),"StickerStylesMenuItem--added":Boolean(s),"StickerStylesMenuItem--new":t.is_new}),onClick:()=>{m?m():s?_&&_():u&&u()},children:[k&&(0,r.jsx)(d.default,{className:"StickerStylesMenuItem__icon",sticker:k,width:100,height:100}),(0,r.jsx)(a.InnerHTML,{Component:"div",className:"StickerStylesMenuItem__title",children:f}),t.is_purchased?void 0===p?(0,r.jsx)("div",{className:"StickerStylesMenuItem__notice",children:c.getLang("purchases_stickers_you_have_it")}):p&&(0,r.jsx)("div",{className:"StickerStylesMenuItem__notice",children:c.getLang("purchases_stickers_active_style")}):t.price.purchase.regular?(0,r.jsx)("div",{className:"StickerStylesMenuItem__price",children:c.getLang("global_n_votes",t.price.purchase.current)}):(0,r.jsx)("div",{className:"StickerStylesMenuItem__price",children:c.getLang("purchases_for_free_btn")}),(u||_||g&&t.can_gift)&&(0,r.jsxs)("div",{className:"StickerStylesMenuItem__actions",children:[s?_&&(0,r.jsx)(n.default,{className:"StickerStylesMenuItem__remove",mode:"secondary",size:"s",onClick:S(_),children:c.getLang("purchases_stickers_preview_remove_item")}):u&&(0,r.jsx)(n.default,{className:"StickerStylesMenuItem__add",mode:"primary",size:"s",onClick:S(u),children:c.getLang("purchases_stickers_preview_add_item")}),g&&t.can_gift&&(0,r.jsx)(n.default,{className:"StickerStylesMenuItem__gift",size:"s",mode:"primary",onClick:S(g),children:(0,r.jsx)(l.Icon24Gift,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"})})]})]})}},142886:(e,t,s)=>{s.d(t,{default:()=>l});var r=s(785893),i=s(221780),c=s(29271),n=s(331533),a=s(899033),o=s(740906);const l=({item:e,showHeader:t=!1,remove:s})=>{if(!e.product)return null;let l="";return(0,a.isPackProduct)(e.product)?l=(0,i.langStr)(c.getLang("purchases_stickers_product_preview_title_pack"),"title",e.product.title):(0,a.isStyleProduct)(e.product)&&(l=(0,i.langStr)(c.getLang("purchases_stickers_product_preview_title_style"),"title",e.product.title)),(0,r.jsxs)("div",{className:"StickersCartItem",children:[t&&(0,r.jsxs)("div",{className:"StickersCartItem__header",children:[(0,r.jsx)(n.InnerHTML,{Component:"span",className:"StickersCartItem__title",children:l}),s&&(0,r.jsx)("span",{className:"StickersCartItem__actions",children:(0,r.jsx)("button",{className:"StickersCartItem__remove",onClick:()=>s(),children:c.getLang("purchases_stickers_preview_remove_item")})})]}),(0,r.jsx)(o.default,{className:"StickersCartItem__preview",product:e.product})]})}},358740:(e,t,s)=>{s.d(t,{default:()=>_});var r=s(434788),i=s(820224),c=s(785893),n=s(667294),a=s(86894),o=s(221780),l=s(682615),d=s(29271);const u=e=>{var{className:t,price:s,text:u,placeholder:_}=e,g=(0,i._)(e,["className","price","text","placeholder"]);let p=(0,n.useMemo)((()=>{if(s){let e;s.current!==s.regular&&s.regular&&(e=(0,c.jsx)("span",{className:"StickersPriceButton__regular",children:s.current?s.regular:(0,o.langStr)(d.getLang("purchases_stickers_n_for_m"),"%n","","%m",d.getLang("global_n_votes",s.regular))},"regular"));const t=(0,c.jsx)("span",{className:"StickersPriceButton__current",children:s.current?d.getLang("global_n_votes",s.current):d.getLang("purchases_for_free_btn").toLowerCase()},"current");return u?u.split(/(\{regular_price\}|\{price\})/).map(((s,r)=>"{regular_price}"===s?e:"{price}"===s?t:s?(0,c.jsx)("span",{className:"StickersPriceButton__label",children:s},`label${r}`):void 0)):[e,t]}return[_]}),[u,_,null==s?void 0:s.regular,null==s?void 0:s.current]);return(0,c.jsx)(a.Button,(0,r._)({className:(0,l.classNames)("StickersPriceButton",t)},g,{children:p}))};u.defaultProps=(0,r._)({},a.Button.defaultProps);const _=u},740906:(e,t,s)=>{s.d(t,{default:()=>l});var r=s(785893),i=s(682615),c=s(68003),n=s(899033),a=s(898718),o=s(34672);const l=({className:e,product:t})=>{if(!(0,n.isPackProduct)(t)&&!(0,n.isStyleProduct)(t))return null;const s=(0,a.getStickers)((0,n.isStyleProduct)(t)?t.style_sticker_ids:t.sticker_ids),l=c.colorScheme.isDarkScheme()?n.Theme.DARK:n.Theme.LIGHT;return(0,r.jsx)("div",{className:(0,i.classNames)("StickersProductPreview",e),children:(0,r.jsx)("ul",{className:"StickersProductPreview__stickers",children:s.map((e=>e&&(0,r.jsx)(o.default,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:l},e.id)))})})}},138255:(e,t,s)=>{s.d(t,{useCart:()=>i});var r=s(667294);const i=e=>{const[t,s]=(0,r.useState)(e),[i,c]=(0,r.useState)(null),n=(0,r.useCallback)((()=>{const e=t.load();c(e),e.then((t=>{s(t),c((t=>t===e?null:t))}),(()=>{}))}),[t]);return(0,r.useEffect)((()=>(t.onChange=n,t.isLoaded()||n(),()=>{t.onChange=null,t.cancelLoad()})),[t]),[t,null!==i]}},86601:(e,t,s)=>{s.d(t,{usePack:()=>c});var r=s(899033),i=s(324502);const c=e=>{const[t,s]=(0,i.useProduct)(e);return t&&(0,r.isPackProduct)(t)?[t,s]:[void 0===t?void 0:null,s]}},324502:(e,t,s)=>{s.d(t,{useProduct:()=>c});var r=s(667294),i=s(581522);const c=e=>{const[,t]=(0,r.useState)({}),s=(0,i.getProductFromCache)(e);return void 0===s?((0,i.getProduct)(e,!1).then((()=>t({})),(()=>{})),[s,!0]):[s,!1]}},83877:(e,t,s)=>{s.d(t,{useProducts:()=>c});var r=s(667294),i=s(581522);const c=e=>{const[,t]=(0,r.useState)({}),s=(0,i.getProductsFromCache)(e);return s.some((e=>void 0===e))?((0,i.getProducts)(e,!1).then((()=>t({})),(()=>{})),[s,!0]):[s,!1]}},206198:(e,t,s)=>{s.d(t,{default:()=>l});var r=s(434788),i=s(667294);const c={getOffset:()=>({x:0,y:0}),scrollTo:()=>{},scrollBy:()=>{},onWheel:()=>{},updateItems:()=>{},hasPrev:!1,hasNext:!1,prev:()=>{},next:()=>{}};function n(e,t){switch(t.type){case"updateState":return(0,r._)({},e,t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?(0,r._)({},e,{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}const a=e=>{const t=Array.from(e.entries());for(let e=0;e<t.length;e++){const[s,r]=t[e];if(r&&r.intersectionRatio)return r.intersectionRatio<1?s:t[e-1]?t[e-1][0]:null}return null},o=e=>{const t=Array.from(e.entries());for(let e=t.length-1;e>=0;e--){const[s,r]=t[e];if(r&&r.intersectionRatio)return r.intersectionRatio<1?s:t[e+1]?t[e+1][0]:null}return null};const l=function(e){const t=(0,i.useRef)(null),[s,l]=(0,i.useReducer)(n,c),d=(0,i.useCallback)((e=>{l({type:"updateState",state:e})}),[l]),u=(0,i.useCallback)((i=>{if(t.current&&s.onMouseWheel&&t.current.removeEventListener("mousewheel",s.onMouseWheel),i){const t=i.querySelector(e.wrapperSelector);if(t){let c={x:0,y:0};const n=new Map,u=()=>c;let _;const g=()=>{_&&_.disconnect(),_=new IntersectionObserver((e=>{for(const t of e)n.has(t.target)&&n.set(t.target,t);l({type:"updateNav",hasPrev:null!==a(n),hasNext:null!==o(n)})}),{root:i,threshold:[0,1]}),n.clear();for(const t of i.querySelectorAll(e.itemSelector))n.set(t,null),_.observe(t)},p=s=>{let r=0;t.offsetWidth>i.offsetWidth&&(r=Math.max(0,Math.min(t.offsetWidth-i.offsetWidth,s.x)));let n=0;t.offsetHeight>i.offsetHeight&&(n=Math.max(0,Math.min(t.offsetHeight-i.offsetHeight,s.y))),t.style.transform=`translate3d(-${r}px, -${n}px, 0)`,t.style.transitionDuration=s.noTransition?"0s":"",c={x:r,y:n},e.onScroll&&e.onScroll(r,n)},h=e=>{p((0,r._)({},e,{x:c.x+e.x,y:c.y+e.y}))},m=e=>{h({x:e.deltaX,y:e.deltaY,noTransition:!0})},f=()=>{const e=a(n);if(e){const s=getComputedStyle(t),r=parseInt(s.paddingLeft)||0,i=parseInt(s.paddingTop)||0,c=t.getBoundingClientRect(),n=e.getBoundingClientRect();p({x:n.left-c.left-r,y:n.top-c.top-i})}},k=()=>{const e=o(n);if(e){const s=getComputedStyle(t),r=parseInt(s.paddingBottom)||0,c=parseInt(s.paddingRight)||0,n=i.getBoundingClientRect(),a=t.getBoundingClientRect(),o=e.getBoundingClientRect();p({x:o.left-a.left-n.width+o.width+c,y:o.top-a.top-n.height+o.height+r})}},S=e=>{e.deltaX&&e.preventDefault()};i.addEventListener("mousewheel",S),d((0,r._)({},s,{onMouseWheel:S,updateItems:g,getOffset:u,scrollTo:p,scrollBy:h,onWheel:m,prev:f,next:k}))}}t.current=i}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,i.useLayoutEffect)((()=>{s.updateItems()})),(0,r._)({ref:u},s)}},467558:(e,t,s)=>{s.d(t,{useStyles:()=>c});var r=s(899033),i=s(83877);const c=e=>{const[t,s]=(0,i.useProducts)(e),c=[];for(const e of t)e&&(0,r.isStyleProduct)(e)&&c.push(e);return[c,s]}},617512:(e,t,s)=>{s.d(t,{useWithProducts:()=>n});var r=s(434788),i=s(667294),c=s(83877);function n(e){const[t,s]=(0,c.useProducts)(e.map((e=>e.product_id)));return[(0,i.useMemo)((()=>e.map(((e,s)=>(0,r._)({},e,{product:t[s]})))),[e]),s]}},623348:(e,t,s)=>{s.d(t,{previewSticker:()=>k,previewStickerProduct:()=>S});var r=s(434788),i=s(785893),c=s(973935),n=s(869048),a=s(514986),o=s(29271),l=s(899033),d=s(581522),u=s(898718),_=s(902220),g=s(584356),p=s(685463),h=s(714117),m=s(333330);const f=new Map;function k(e,t){const s=(0,g.showBoxLoader)();(0,u.getPackByStickerId)(e).then((e=>{!(0,g.isBoxLoadingCancelled)(s)&&e&&((0,g.hideBoxLoader)(),S(e.id,t))}),(()=>{}))}function S(e,t){let s;const u=(0,r._)({},t);function k(){return null==s?void 0:s.bodyNode.querySelector(".StickersProductPreviewBox")}function S(){null==s||s.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function v(){null==s||s.updateBoxCoords()}function y(e,t){let s=null,r=null;if((0,l.isPackProduct)(e))s=e.is_purchased&&(null==u?void 0:u.settings)?(0,i.jsx)(h.default,{pack:e,options:u,closeBox:S,updateBox:v}):(0,i.jsx)(p.default,{pack:e,cart:t,options:u,closeBox:S,updateBox:v}),r=e.name;else if((0,l.isStyleProduct)(e)){const c=(0,d.getProductFromCache)(e.base_id);if(c)return t.addProduct(c.id,!0),void y(c,t);s=(0,i.jsx)(m.default,{style:e,options:u,closeBox:S,updateBox:v}),r=e.name}const a=k();if(a&&s&&(c.render((0,i.jsx)(n.AppRootProvider,{children:s}),a),r)){const e=window.nav.objLoc[0].split("/");"stickers"===e[0]&&e[1]!==r&&window.nav.setLoc({0:"stickers/"+r})}}const P=(0,g.showBoxLoader)(!1),x=_.Cart.create([e]);return Promise.all([x.load(),window.stManager.add(["stickers.css"])]).then((([t])=>{if((0,g.isBoxLoadingCancelled)(P))return;(0,g.hideBoxLoader)();const r=(0,d.getProductFromCache)(e);r&&!r.is_disabled?(s=new a.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow(){y(r,t),requestAnimationFrame((()=>{v(),function(){if(f.has(e)){const t=(0,g.getBoxLayerWrap)();t&&(t.scrollTop=f.get(e)||0),f.delete(e)}}()}))},onBeforeHide(){!function(){const t=(0,g.getBoxLayerWrap)();t&&f.set(e,t.scrollTop)}()},onHideAttempt:()=>(function(){const e=k();e&&c.unmountComponentAtNode(e)}(),!0)}),s.content('<div class="StickersProductPreviewBox"></div>'),s.show()):(0,a.showFastBox)(o.getLang("global_box_error_title"),o.getLang("purchases_stickers_product_not_found"))}),(()=>{})),{hide:S}}},581522:(e,t,s)=>{s.d(t,{activateProduct:()=>g,cacheProductsData:()=>n,getProduct:()=>_,getProductFromCache:()=>a,getProducts:()=>u,getProductsFromCache:()=>o,updateUserProductState:()=>p});var r=s(434788),i=s(363444),c=s(898718);const n=(e,t=[])=>{const s=(0,c.getCache)();if(e.stickers){const{stickers:t}=s;for(const s of e.stickers)t.has(s.id)?t.set(s.id,(0,r._)({},t.get(s.id),s)):t.set(s.id,s)}if(e.products)for(const t of e.products)s.products.set(t.id,t),s.productPromises.delete(t.id);for(const e of t)s.products.has(e)||s.products.set(e,null),s.productPromises.delete(e);e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),(0,c.updateCache)(s)},a=e=>(0,c.getCache)().products.get(e),o=e=>{const t=(0,c.getCache)().products;return e.map((e=>t.get(e)))};function l(){let{productsPromise:e}=(0,c.getCache)();return e||(e=new Promise((e=>setTimeout((()=>{const t=(0,c.getCache)().productIdsQueue,s=Array.from(t);t.clear(),(0,c.updateCache)({productIdsQueue:t,productsPromise:void 0}),i.ajax.post("stickers.php",{act:"get_products",product_ids:s},{onDone(t){n(t,s),e([])},onFail:t=>(console.error(t),n({},s),e([]),!0)})}),300))),(0,c.updateCache)({productsPromise:e})),e}const d=e=>{if(!e.length)return Promise.resolve([]);const{productPromises:t,productIdsQueue:s}=(0,c.getCache)(),r=new Set;for(const i of e)if(t.has(i)){const e=t.get(i);e&&r.add(e)}else{s.add(i);const e=l();t.set(i,e),r.add(e)}return(0,c.updateCache)({productIdsQueue:s,productPromises:t}),Promise.all(r).then((()=>o(e)))},u=(e,t=!0)=>{const s=t?e.filter((e=>void 0===a(e))):e;return s.length?d(s).then((()=>o(e))):Promise.resolve(o(e))},_=(e,t=!0)=>{if(t){const t=a(e);if(void 0!==t)return Promise.resolve(t)}return d([e]).then((()=>a(e)))},g=e=>new Promise((t=>{i.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone(e){n(e),t()},onFail:e=>(console.error(e),t(),!0)})})),p=(e,t,s,r=!0)=>new Promise((c=>{i.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:s},{onDone(e){r&&n(e),c()},onFail:e=>(console.error(e),c(),!0)})}))},753884:(e,t,s)=>{s.d(t,{giftStickerProducts:()=>g,giftStickersCart:()=>_});var r=s(434788),i=s(785893),c=s(973935),n=s(869048),a=s(514986),o=s(902220),l=s(991243),d=s(898718),u=s(580284);function _(e,t){const{productsGiftLock:s}=(0,d.getCache)();if(s)return null;let o;(0,d.updateCache)({productsGiftLock:!0});const _=(0,r._)({},t);function g(){return null==o?void 0:o.bodyNode.querySelector(".StickersProductsGift")}function p(){null==o||o.hide()}function h(){null==o||o.updateBoxCoords()}return(0,l.showLoader)(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css",window.jsc("web/wide_dd.js"),"wide_dd.css"])]).then((([e])=>{(0,l.hideLoader)(),o=new a.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow(){!function(e){const t=g();t&&c.render((0,i.jsx)(n.AppRootProvider,{children:(0,i.jsx)(u.default,{cart:e,options:_,closeBox:p,updateBox:h})}),t)}(e),requestAnimationFrame((()=>{h()}))},onHideAttempt:()=>(function(){const e=g();e&&c.unmountComponentAtNode(e)}(),!0),onHide(){(0,d.updateCache)({productsGiftLock:!1})}}),o.content('<div class="StickersProductsGift"></div>'),o.show()}),(()=>{})),{hide:p}}function g(e,t=[],s){return _(o.Cart.create(e,t),s)}},991243:(e,t,s)=>{s.d(t,{getBoxLayerWrap:()=>d,getLangCode:()=>h,getPurchaseResult:()=>g,hideLoader:()=>_,showLoader:()=>u,updateStickersFromQueue:()=>p});var r=s(221780),i=s(29271),c=s(68003),n=s(795558),a=s(584356),o=s(899033);function l(){return document.querySelector("#box_loader")}function d(){return document.querySelector("#box_layer_wrap")}function u(){const e=l();(0,a.boxRefreshCoords)(e),(0,n.show)(e),(0,n.show)(d())}function _(){(0,n.hide)(l())}function g(e){const t=new o.ProductsByType(e.items.filter((e=>!e.error)).map((e=>e.product))),s=t.getPack(),c=t.getStyles();if(s)return c.length?(0,r.langStr)(i.getLang("purchases_stickers_purchase_result_pack_and_styles",c.length),"pack_title",s.title,"n",c.length):(0,r.langStr)(i.getLang("purchases_stickers_purchase_result_pack"),"title",s.title);if(c.length)switch(c.length){case 1:return(0,r.langStr)(i.getLang("purchases_stickers_purchase_result_1_style"),"title",c[0].title);case 2:return(0,r.langStr)(i.getLang("purchases_stickers_purchase_result_2_styles"),"title1",c[0].title,"title2",c[1].title);case 3:return(0,r.langStr)(i.getLang("purchases_stickers_purchase_result_3_styles"),"title1",c[0].title,"title2",c[1].title,"title3",c[2].title);case 4:return(0,r.langStr)(i.getLang("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",c[0].title,"title2",c[1].title,"title3",c[2].title);default:const e=c.length-3;return(0,r.langStr)(i.getLang("purchases_stickers_purchase_result_3_styles_and_n_more",e),"title1",c[0].title,"title2",c[1].title,"title3",c[2].title,"n",e)}return null}function p(e){!function(e){const t=c.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light";e.querySelectorAll(`.sticker_img[${t}]`).forEach((e=>{const s=e.getAttribute(t);s&&(e.src=s)}))}(e)}const h=()=>window.vk.lang||"ru"},946331:(e,t,s)=>{s.d(t,{VmojiLangSection:()=>p,storeActivateProduct:()=>_,storeDeactivateProduct:()=>g,vmojiGetAvatar:()=>n,vmojiGetCharacterById:()=>d,vmojiGetLangs:()=>h,vmojiGetStickerPacks:()=>l,vmojiGetStickerPacksRecommendationBlock:()=>o,vmojiGetStickerPacksRecommendationBlocks:()=>a,vmojiPurchaseProduct:()=>c,vmojiSetAvatarState:()=>u,vmojiSubscribeToQueue:()=>i});var r=s(599809);const i=()=>(0,r.api)("vmoji.subscribeToQueue",{}),c=(e,t=!1)=>(0,r.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0}),n=e=>{const t={};return e&&Object.assign(t,{avatar_id:e}),(0,r.api)("vmoji.getAvatar",t)},a=e=>(0,r.api)("vmoji.getStickerPacksRecommendationBlocks",e),o=(e,t)=>{const s={block_id:e};return t&&Object.assign(s,{count:t}),(0,r.api)("vmoji.getStickerPacksRecommendationBlock",s)},l=e=>(0,r.api)("vmoji.getStickerPacks",e),d=(e,t)=>(0,r.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0}),u=(e,t)=>(0,r.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0}),_=e=>(0,r.api)("store.activateProduct",{type:"stickers",product_id:e}),g=e=>(0,r.api)("store.deactivateProduct",{type:"stickers",product_id:e});var p;!function(e){e.LAYER="layer",e.PURCHASE="purchase"}(p||(p={}));const h=e=>new Promise(((t,s)=>{window.ajax.post("al_vmoji.php",{act:"lang_keys",section:e},{onDone:()=>{t()},onFail:()=>(s(),!1)})}))}}]);try{stManager.done("dist/a06b27da62151ff102844c3e5fe0028a.bf7b4ad027bcb4e19f62.js")}catch(e){}